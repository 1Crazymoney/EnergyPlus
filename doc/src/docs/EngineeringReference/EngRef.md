![](EngineeringReference/media/ep.gif)

<br/>
<p><h1>EnergyPlus<sup>TM</sup> Documentation</h1></p>
<hr>
<h1>Engineering Reference</h1>
<h2>The Reference to EnergyPlus Calculations</h2>
<br/>
<p><i>(in case you want or need to know)</i></p>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<br/>
<p><small>COPYRIGHT (c) 1996-2015 THE BOARD OF TRUSTEES OF THE UNIVERSITY OF ILLINOIS AND THE REGENTS OF THE UNIVERSITY OF CALIFORNIA THROUGH THE ERNEST ORLANDO LAWRENCE BERKELEY NATIONAL LABORATORY. ALL RIGHTS RESERVED. NO PART OF THIS MATERIAL MAY BE REPRODUCED OR TRANSMITTED IN ANY FORM OR BY ANY MEANS WITHOUT THE PRIOR WRITTEN PERMISSION OF THE UNIVERSITY OF ILLINOIS OR THE ERNEST ORLANDO LAWRENCE BERKELEY NATIONAL LABORATORY. ENERGYPLUS IS A TRADEMARK OF THE US DEPARTMENT OF ENERGY.</small></p>
<p style="page-break-after:always;"></p>
<div id="generated-toc"></div>
<p style="page-break-after:always;"></p>


Overview
========

Document Overview
-----------------

This document is organized to give you the best possible look into the EnergyPlus calculations. First, the concepts of modeling in EnergyPlus are presented. These include descriptions of the zone heat balance process, air loop/plant loop processes as well as other important processes for the building simulation.

Discussions during the modeling process may reference specific “object names” as found in the Input/Output Reference document.

The remainder of the document focuses on individual models.

General Modeling Overview
-------------------------

The EnergyPlus program is a collection of many program modules that work together to calculate the energy required for heating and cooling a building using a variety of systems and energy sources. It does this by simulating the building and associated energy systems when they are exposed to different environmental and operating conditions. The core of the simulation is a model of the building that is based on fundamental heat balance principles. Since it is relatively meaningless to state: “based on fundamental heat balance principles”, the model will be described in greater detail in later sections of this document in concert with the FORTRAN code which is used to describe the model. It turns out that the model itself is relatively simple compared with the data organization and control that is needed to simulate the great many combinations of system types, primary energy plant arrangements, schedules, and environments. The next section shows this overall organization in schematic form. Later sections will expand on the details within the blocks of the schematic.

![](EngineeringReference/media/image1.png)

Figure 1. EnergyPlus Program Schematic

Simulation Manager
------------------

The simulation manager of EnergyPlus is contained in a single module. The main subroutine is shown below. Flow within the entire program is managed using a series of flags. These paired flags, in order (from the highest to the lowest) are:

Table 1. Simulation Flags

<table class="table table-striped">
<tr>
<td>BeginSimulationFlag</td>
<td>EndSimulationFlag</td>
</tr>
<tr>
<td>BeginEnvironmentFlag</td>
<td>EndEnvironmentFlag(one to many days)</td>
</tr>
<tr>
<td>BeginDayFlag</td>
<td>EndDayFlag</td>
</tr>
<tr>
<td>BeginHourFlag</td>
<td>EndHourFlag</td>
</tr>
<tr>
<td>BeginTimeStepFlag</td>
<td>EndTimeStepFlag</td>
</tr>
</table>

There is also a **WarmupFlag** to signal that the program is in warmup state. The operation of these flags can be seen in the following subroutine. The advantage of using the flag system is that any subroutine throughout the code can determine the exact state of the simulation by checking the status of the flags.

````
SUBROUTINE ManageSimulation     ! Main driver routine for this module
BeginSimFlag = .TRUE.
  EndSimFlag = .FALSE.
  CALL OpenOutputFiles
  CALL GetProjectData
  CALL GetEnvironmentInfo                 ! Get the number and type of Environments
  DO Envrn = 1, NumOfEnvrn        ! Begin environment loop ...
    BeginEnvrnFlag = .TRUE.
    EndEnvrnFlag   = .FALSE.
    WarmupFlag     = .TRUE.
    DayOfSim       =  0
    DO WHILE ((DayOfSim.LT.NumOfDayInEnvrn).OR.(WarmupFlag))  ! Begin day loop ...
      DayOfSim     = DayOfSim + 1
      BeginDayFlag = .TRUE.
      EndDayFlag   = .FALSE.
      DO HourOfDay = 1, 24      ! Begin hour loop ...
        BeginHourFlag = .TRUE.
        EndHourFlag   = .FALSE.
          DO TimeStep = 1, NumOfTimeStepInHour  ! Begin time step (TINC) loop ...
          BeginTimeStepFlag = .TRUE.
          EndTimeStepFlag   = .FALSE.
          ! Set the End\_\_Flag variables to true if necessary. Note that each flag builds on
          ! the previous level. EndDayFlag cannot be .true. unless EndHourFlag is also .true., etc.
          ! Note that the EndEnvrnFlag and the EndSimFlag cannot be set during warmup.
          ! Note also that BeginTimeStepFlag, EndTimeStepFlag, and the
          ! SubTimeStepFlags can/will be set/reset in the HVAC Manager.
          IF ((TimeStep.EQ.NumOfTimeStepInHour)) THEN
            EndHourFlag = .TRUE.
            IF (HourOfDay.EQ.24) THEN
              EndDayFlag = .TRUE.
              IF ((.NOT.WarmupFlag).AND.(DayOfSim.EQ.NumOfDayInEnvrn)) THEN
                EndEnvrnFlag = .TRUE.
                IF (Envrn.EQ.NumOfEnvrn) THEN
                  EndSimFlag = .TRUE.
                END IF
              END IF
            END IF
          END IF
          CALL ManageWeather
          CALL ManageHeatBalance
          BeginHourFlag  = .FALSE.
          BeginDayFlag   = .FALSE.
          BeginEnvrnFlag = .FALSE.
          BeginSimFlag   = .FALSE.
        END DO                              ! ... End time step (TINC) loop.
      END DO                    ! ... End hour loop.
    END DO                      ! ... End day loop.
  END DO                        ! ... End environment loop.
  CALL CloseOutputFiles
  RETURN
END SUBROUTINE ManageSimulation
````

Warmup Convergence
------------------

Since everything in EnergyPlus is based on the foundation of the loads simulation, it stands to reason that any inaccuracies in the loads calculation will result in inaccuracies of similar or larger magnitude in the HVAC calculations. In the presumably limited cases where convergence was not truly achieved before the actual simulation began, it is unknown how much error would be introduced into the results. While simulations that last longer (annual vs. design day) will hopefully have any initial condition problems balanced by the shear number of days in the simulation, shorter simulations—particularly those used for sizing—could result in relatively large errors. The simulation results could be unreliable and inaccurate when steady periodic conditions are not achieved. Therefore, it is important to properly determine when there is enough temperature and flux history terms to start an EnergyPlus simulation since this has a potential economic and energy impact on buildings that use EnergyPlus in design.

EnergyPlus determines warmup convergence in the following manner as shown in the Figure 2 below. The process of the convergence checks begins by tracking four parameters such including the maximum zone air temperature, the minimum zone air temperature, the maximum heating load, and the maximum cooling load for individual zone. It is note that these convergence checks are only in effective in simulations with at least one zone since the criteria is solely based on the maximum and minimum values obtained from an individual zone. Differences in these parameters between two consecutive days are then compared with the convergence tolerance values at the end of the day during the warmup period. For example, the maximum and minimum air temperature and the percentage difference of zone load for each zone at 9:00AM during the second to last warmup is compared to the values at 9:00AM last warmup day as follows:

<div>$${T_{\max ,prev}} - {T_{\max }} < {T_{tol}}$$</div>

<div>$${T_{\min ,prev}} - {T_{\min }} < {T_{tol}}$$</div>

<div>$$\frac{{{q_h} - {q_{h,prev}}}}{{{q_h}}} < {q_{tol}}$$</div>

<div>$$\frac{{{q_c} - {q_{c,prev}}}}{{{q_c}}} < {q_{tol}}$$</div>

where Tmax,prev is the maximum zone temperature of previous day, Tmax is the maximum zone temperature of current day, Ttol is the value of temperature tolerance, qh,prev is the maximum heating load of previous day, qh, is the maximum heating load of current day, qtol is the value of load tolerance, qc,prev is the maximum cooling load of previous day, and qc, is the maximum cooling load of current day.

Note that a minimum load of 100W is used to establish a fraction for the maximum loads when they are less than the minimum. This is done to avoid a false negative indication for the percentage load difference that may appear when zonal loads are very small. The convergence checks are repeated until passed for all zones. EnergyPlus assumes that the warmup period has been reached steady-periodic when these four parameters are within tolerance. Finally, temperature and load differences between the last two warmup days for individual zone at each time step in the last warmup day are reported so that users can easily track whether or not the warmup period has converged. The input parameters and output related to the warmup period are discussed in the Input-Output Reference.

![](EngineeringReference/media/image6.png)

Figure 2. Flows of Warmup Convergence Checks

Integrated Solution Manager
===========================

EnergyPlus is an integrated simulation. This means that all three of the major parts, building, system, and plant, must be solved simultaneously. In programs with sequential simulation, such as BLAST or DOE-2, the building zones, air handling systems, and central plant equipment are simulated sequentially with no feedback from one to the other. The sequential solution begins with a zone heat balance that updates the zone conditions and determines the heating/cooling loads at all time steps. This information is fed to the air handling simulation to determine the system response; but that response does not affect zone conditions. Similarly, the system information is passed to the plant simulation without feedback. This simulation technique works well when the system response is a well-defined function of the air temperature of the conditioned space. For a cooling situation, a typical supply and demand situation is shown schematically in the Figure 3. Here, the operating point is at the intersection of the supply and demand curves.

![](EngineeringReference/media/image7.png)

Figure 3. Sequential Simulation Supply/Demand Relationship.

However, in most situations the system capacity is dependent on outside conditions and/or other parameters of the conditioned space. The simple supply and demand situation above becomes a more complex relationship and the system curve is not fixed. The solution should move up and down the demand curve. This doesn’t happen in sequential simulation methods and the lack of feedback from the system to the building can lead to nonphysical results. For example, if the system provides too much cooling to a conditioned space the excess is reported by the program as "overcooling". Other categories of unmatched loads exist and are similarly reported by the program. While this kind of reporting enables the affected system or plant components to be properly sized, the system designer would, in most cases, prefer to see the actual change in zone temperature. The same mismatches can occur between the system and plant simulations when they are simulated sequentially.

To obtain a simulation that is physically realistic, the elements have to be linked in a simultaneous solution scheme. The entire integrated program can be represented as a series of functional elements connected by fluid loops as shown in Figure “Schematic of Simultaneous Solution Scheme”. In EnergyPlus all the elements are integrated and controlled by the Integrated Solution Manager. The loops are divided into supply and demand sides, and the solution scheme generally relies on successive substitution iteration to reconcile supply and demand using the Gauss-Seidell philosophy of continuous updating.

![](EngineeringReference/media/image8.png)

Figure 4. Schematic of Simultaneous Solution Scheme

In the sections which follow, the various individual functions of the integrated solution will be described.

Basis for the Zone and Air System Integration
---------------------------------------------

The basis for the zone and air system integration is to formulate energy and moisture balances for the zone air and solve the resulting ordinary differential equations using a predictor-corrector approach. The formulation of the solution scheme starts with a heat balance on the zone air.

<div>$${C_z}\frac{{d{T_z}}}{{dt}} = \sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}\left( {{T_{si}} - {T_z}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}\left( {{T_{zi}} - {T_z}} \right)\, + {\dot m_{\inf }}{C_p}\left( {{T_\infty } - {T_z}} \right) + {\dot Q_{sys}}$$</div>

where:

<span>$\sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}} $</span> = sum of the convective internal loads

<span>$\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}\left( {{T_{si}} - {T_z}} \right)$</span> = convective heat transfer from the zone surfaces

<span>${\dot m_{\inf }}{C_p}\left( {{T_\infty } - {T_z}} \right)$</span> = heat transfer due to infiltration of outside air

<span>$\sum_{i=1}^{N_{zones}} \dot m_i C_p\left( T_{zi} - {T_z} \right)$</span> = heat transfer due to interzone air mixing

<span>${\dot Q_{sys}}$</span> = air systems output

<span>${C_z}\frac{{d{T_z}}}{{dt}} = $</span>energy stored in zone air

C<sub>z</sub> = ρ<sub>air</sub>C<sub>p</sub>C<sub>T</sub>

ρ<sub>air</sub> = zone air density

C<sub>p</sub> = zone air specific heat

C<sub>T</sub> = sensible heat capacity multiplier (Detailed description is provided below)

If the air capacitance is neglected, the steady-state system output must be:

<div>$$ - {\dot Q_{sys}} = \sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}\left( {{T_{si}} - {T_z}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}\left( {{T_{zi}} - {T_z}} \right)\, + {\dot m_{\inf }}{C_p}\left( {{T_\infty } - {T_z}} \right)$$</div>

Air systems provide hot or cold air to the zones to meet heating or cooling loads. The system energy provided to the zone, Qsys, can thus be formulated from the difference between the supply air enthalpy and the enthalpy of the air leaving the zone as in Equation :

<div>$${\dot Q_{sys}} = {\dot m_{sys}}{C_p}\left( {{T_{\sup }} - {T_z}} \right)$$</div>

This equation assumes that the zone supply air mass flow rate is exactly equal to the sum of the air flow rates leaving the zone through the system return air plenum and being exhausted directly from the zone. Both air streams exit the zone at the zone mean air temperature. The result of substituting Equation for Qsys in the heat balance Equation is shown in Equation :

<div>$$
  \begin{array}{ll}
    {C_z}\frac{{d{T_z}}}{{dt}} &= \sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}\left( {{T_{si}} - {T_z}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}\left( {{T_{zi}} - {T_z}} \right) \\
                               &+ {{\dot m}_{\inf }}{C_p}\left( {{T_\infty } - {T_z}} \right) + {{\dot m}_{sys}}{C_p}\left( {{T_{\sup }} - {T_z}} \right)
  \end{array}
$$</div>

The sum of zone loads and air system output now equals the change in energy stored in the zone. Typically, the capacitance Cz would be that of the zone air only. However, thermal masses assumed to be in equilibrium with the zone air could be included in this term.

EnergyPlus provides three different solution algorithms to solve the zone air energy and moisture balance equations. These are defined in the Algorithm field in the ZoneAirHeatBalanceAlgorithm object: 3rdOrderBackwardDifference, EulerMethod and AnalyticalSolution. The first two methods to solve Equation use the finite difference approximation while the third uses an analytical solution. A short description is given below.

In order to calculate the derivative term with respect to time, a finite difference approximation may be used, such as:

<div>$$\frac{{dT}}{{dt}} = {\left( {\delta t} \right)^{ - 1}}\left( {{T_z}^t - {T_z}^{t - \delta t}} \right) + {\rm O}\left( {\delta t} \right)$$</div>

The use of numerical integration in a long time simulation is a cause for some concern due to the potential build-up of truncation error over many time steps. In this case, the finite difference approximation is of low order that further aggravates the problem. However, the cyclic nature of building energy simulations should cause truncation errors to cancel over each daily cycle so that no net accumulation of error occurs, even over many days of simulation (Walton, 1990). The Euler formula, Equation , was employed in Equation to replace the derivative term. All the terms containing the zone mean air temperature were then grouped on the left hand side of the equation.  Since the remaining terms are not known at the current time, they were lagged by one time step and collected on the right hand side. This manipulation resulted in Equation , the formula for updating the zone mean air temperature:

<div>$$\begin{array}{l}{C_z}\frac{{T_z^t - T_z^{t - \delta t}}}{{dt}} + T_z^t\left( {\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {{\dot m}_{\inf }}{C_p} + {{\dot m}_{sys}}{C_p}} \right) = \\\sum\limits_{i = 1}^{{N_{sl}}} {\dot Q_i^t}  + {{\dot m}_{sys}}{C_p}T_{{\rm{supply}}}^t + {\left( {\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}{T_{zi}} + {{\dot m}_{\inf }}{C_p}{T_\infty }} \right)^{t - \delta t}}\end{array}$$</div>

One final rearrangement was to move the lagged temperature in the derivative approximation to the right side of the equation. The explicit appearance of the zone air temperature was thus eliminated from one side of the equation. An energy balance equation that includes the effects of zone capacitance was then obtained by dividing both sides by the coefficient of Tz:

<div>$$T_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {\dot Q_i^t}  + {{\dot m}_{sys}}{C_p}T_{{\rm{supply}}}^t + {{\left( {{C_z}\frac{{T_z^{}}}{{\delta t}} + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}{T_{zi}} + {{\dot m}_{\inf }}{C_p}{T_\infty }} \right)}^{t - \delta t}}}}{{\frac{{{C_z}}}{{\delta t}} + \left( {\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {{\dot m}_{\inf }}{C_p} + {{\dot m}_{sys}}{C_p}} \right)}}$$</div>

Equation could be used to estimate zone air temperatures, and is defined as the EulerMethod, one of the three solution algorithms provided in the ZoneAirHeatBalanceAlgorithm object. However, it can severely limit the time step size under some conditions. To improve on this, higher order expressions for the first derivative, with corresponding higher-order truncation errors, were developed. The goal of this approach was to allow for the use of larger time steps in the simulation than would be possible using the first order Euler form, without experiencing instabilities. Approximations from second through fifth order were tried as reported by Taylor, et al. (1990) with the conclusion that the third order finite difference approximation, shown below, gave the best results:

<div>$${\left. {\frac{{d{T_z}}}{{dt}}} \right|_t} \approx {\left( {\delta t} \right)^{ - 1}}\left( {\frac{{11}}{6}T_z^t - 3T_z^{t - \delta t} + \frac{3}{2}T_z^{t - 2\delta t} - \frac{1}{3}T_z^{t - 3\delta t}} \right) + O\left( {\delta {t^3}} \right)$$</div>

When this form for the derivative is used, equation changes to:

<div>$$\begin{array}{l}{C_z}{\left( {\delta t} \right)^{ - 1}}\left( {\frac{{11}}{6}T_z^t - 3T_z^{t - \delta t} + \frac{3}{2}T_z^{t - 2\delta t} - \frac{1}{3}T_z^{t - 3\delta t}} \right) = \sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}\left( {{T_{si}} - {T_z}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}\left( {{T_{zi}} - {T_z}} \right)\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + {{\dot m}_{\inf }}{C_p}\left( {{T_\infty } - {T_z}} \right) + {{\dot m}_{sys}}{C_p}\left( {{T_{\sup }} - {T_z}} \right)\end{array}$$</div>

and the zone temperature update equation becomes:

<div>$$T_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}{T_{zi}}\, + {{\dot m}_{\inf }}{C_p}{T_\infty } + {{\dot m}_{sys}}{C_p}{T_{{\rm{supply}}}} - \left( {\frac{{{C_z}}}{{\delta t}}} \right)\left( { - 3T_z^{t - \delta t} + \frac{3}{2}T_z^{t - 2\delta t} - \frac{1}{3}T_z^{t - 3\delta t}} \right)}}{{\left( {\frac{{11}}{6}} \right)\frac{{{C_z}}}{{\delta t}} + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} A + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {{\dot m}_{\inf }}{C_p} + {{\dot m}_{sys}}C}}$$</div>

This is the form historically used in EnergyPlus and is the current default referred to as 3rdOrderBackwardDifference in the ZoneAirHeatBalanceAlgorithm object. This algorithm requires zone air temperatures at three previous time steps and uses constant temperature coefficients. The assumption is that three previous time steps lengths are the same.

The AnalyticalSolution algorithm is an integration approach. While the 3<sup>rd</sup> order finite difference approximation provides stability without requiring a prohibitively small time step, the method still has truncation errors and requires a fixed time step length for the previous three simulation time steps. Therefore, different time step lengths for the previous three simulation time steps may make the temperature coefficients invalid.

The AnalyticalSolution algorithm provides a possible way to obtain solutions without truncation errors and independent of time step length. In addition, the algorithm only requires the zone air temperature for one previous time step, instead of three previous time steps as required by the 3rdOrderBackwardDifference algorithm. The integrated (analytical) solution for Eq. (4) may be expressed as follows:

<div>$$\begin{array}{l}T_z^t = \left( {T_z^{t - \delta t} - \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}{T_{zi}} + {{\dot m}_{\inf }}{C_p}{T_\infty } + {{\dot m}_{sys}}{C_p}{T_{\sup }}}}{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {{\dot m}_{\inf }}{C_p} + {{\dot m}_{sys}}{C_p}}}} \right)\\\;\;\;\;\;\;\;*\exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {{\dot m}_{\inf }}{C_p} + {{\dot m}_{sys}}{C_p}}}{{{C_z}}}\delta t} \right)\\\;\;\;\;\;\;\; + \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}{T_{zi}} + {{\dot m}_{\inf }}{C_p}{T_\infty } + {{\dot m}_{sys}}{C_p}{T_{\sup }}}}{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {{\dot m}_{\inf }}{C_p} + {{\dot m}_{sys}}{C_p}}}\end{array}$$</div>

Since the load on the zone drives the entire process, that load is used as a starting point to give a demand to the air system. Then a simulation of the air system provides the actual supply capability and the zone temperature is adjusted if necessary. This process in EnergyPlus is referred to as a Predictor/Corrector process. It is summarized below.

Code Reference: the **ZoneTempPredictorCorrector** module performs the calculations.

### Zone Sensible Heat Capacity Multiplier

If the Zone Sensible Heat Capacity Multiplier = 1.0, this represents just the sensible heat capacitance of the air volume in the specified zone. If the value is not defined, it is set to 1.0. This multiplier can be greater than 1.0 if the zone air sensible heat capacity needs to be increased for stability of the simulation. This multiplier increases the capacitance of the air volume by increasing the zone volume that is used in the zone predictor-corrector algorithm in the simulation. This can be done for numerical reasons, such as to increase the stability by decreasing the zone air temperature deviations at the time step level. Or it can be increased to try and account for the additional capacitance in the air loop not specified in the zone, i.e. dampers, diffusers, duct work, etc., to see the effect on the dynamics of the simulation. See the Input/Output Reference for additional information (Object: ZoneCapacitanceMultiplier:ResearchSpecial).

In the source code below we see how the ZoneVolCapMultpSens increases the zone volume used for the air ratio at the time step in the air system. This multiplier is constant throughout the simulation.

````
    AIRRAT(ZoneNum) = Zone(ZoneNum)%Volume\***ZoneVolCapMultpSens**\* &
               PsyRhoAirFnPbTdbW(OutBaroPress,MAT(ZoneNum),ZoneAirHumRat(ZoneNum))\* &
               PsyCpAirFnWTdb(ZoneAirHumRat(ZoneNum),MAT(ZoneNum))/(TimeStepSys\*SecInHour)
````


Summary of Predictor-Corrector Procedure
----------------------------------------

The predictor-corrector scheme can be summarized as follows:

 - Using equation , an estimate is made of the air system energy required to balance the equation with the zone air temperature equal to the setpoint temperature.
 - With that quantity as a demand, the air system is simulated to determine its actual supply capability at the time of the simulation. This will include a plant simulation if necessary.
 - The actual air system capability is used in equation to calculate the resulting zone temperature.

Air System Control
------------------

Previously, the formulation of a new heat balance equation with an unsteady zone capacitance term was discussed Equation . In this equation the updated zone temperature was calculated by removing its explicit dependence from the right hand side and lagging, by one time step, the unknown terms on that side. However, the right hand side still contains implicit dependencies on the zone temperature through the air system control logic; the need for heating or cooling in the zones, is based on zone temperature. In real buildings the control system consists of one or more sensing units in the zone, such as a wall thermostat that samples the air temperature and sends signals to a control unit. The controller looks at the difference between the actual zone temperature and the desired temperature to ascertain if heating or cooling is required and then sends appropriate signals to the air system components to drive the zone temperature closer to the desired value.

Although many control systems use only the zone air temperature to control the air system, most modern energy management systems consider many other variables, such as outside environment conditions. Simulating such controllers would seem to be relatively straightforward in a simulation especially since some of the more complex control problems, such as managing duct pressures and flow rates, are not always modeled. However, real controllers have an advantage because they can sample zone conditions, and thus update air system response, on a time scale much shorter than any characteristic time of the air system or zone. Thus the feedback between zone and air system usually results in steady or, at worst, slowly oscillating zone conditions and air system operation unless the air system is grossly oversized. On the other hand, the numerical model is only able to sample zone conditions at discrete time intervals. In the interest of minimizing computation time, these intervals need to be as long as possible. Frequently, they are of the order of, or longer than, the characteristic times of the air system and zones, except in the case of small air system capacity in relation to zone capacitance. This situation has the potential for unstable feedback between the zone and air system, resulting in an oscillatory or diverging solution.

Prior to implementing the new heat balance method (3rdOrderBackwardDifference) in IBLAST, several air system control strategies were considered. The primary objective was selection of a control method that would be numerically stable over a reasonable range of conditions, realistic from the standpoint of looking and operating like an actual air system controller, and flexible enough to be applied to all current and projected systems. The method actually implemented in IBLAST, and later EnergyPlus, took advantage of the computational model's "knowledge" of how much energy enters or leaves the zone as a function of zone air temperature i.e., the zone load. The real controller, on the other hand, does not have this information. The net zone load is given by Equation :

<div>$${\dot Q_{load}} = \sum\limits_{i = 1}^{{N_{sl}}} {\dot Q_i^{}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}\left( {{T_{si}} - {T_z}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}\left( {{T_{zi}} - {T_z}} \right) + {\dot m_{\inf }}{C_p}\left( {{T_\infty } - {T_z}} \right)$$</div>

This is Equation without the term due to the air system. In addition, Tz is now the *desired* zone temperature as defined by the control system setpoints that must be specified for each zone. An assumption was made that if the air system has sufficient capacity (based on the desired zone air temperature) to meet the zone conditioning requirements (i.e. Qsys=Qload) at the desired zone air temperature then those requirements will be met. On the other hand, if the air system cannot provide enough conditioning to the zone to maintain the desired temperature, then the air system provides its maximum output to the zone and the zone air temperature is allowed to "float."  Equation was used to calculate the air system output required to maintain the desired zone air temperature; the actual zone temperature update was accomplished using Equation . This method was called *predictive system energy balance*. It has many characteristics of a predictor-corrector method since the air system response is first approximated based on a predicted zone temperature and then the actual change in zone temperature is determined from that air system response. The predictive air system energy balance method required that the system controls on air mass flow rate, supply air temperature, etc., be formulated as a function of the zone air temperature. However, this was not a serious drawback. The first example considered was a single zone draw through air system. Typically, such systems have a cooling coil and heating coil in series, and constant air volume flow rate. Single zone draw through systems run at maximum capacity when turned on; so the only way to regulate net air system output and keep the zone air temperature within the desired range is to turn the air system on and off. A simplified schematic of this system type is shown in Figure 5. Simplified Single Zone Draw Through Air System.

![](EngineeringReference/media/image31.svg.png)

Figure 5. Simplified Single Zone Draw Through Air System

The amount of heating or cooling provided by the air system in relation to the desired zone air temperature is given by:

<div>$${\dot Q_{sys}} = {\dot m_{sys}}{C_p}\eta \left( {{T_{\sup }} - {T_{z,\,desired}}} \right)$$</div>

where h is the fraction of the time step that the air system is turned on and varies between 0 and 1. The supply air temperature is also implicitly limited by the effectiveness of the coils and the operating parameters of the central plant components. These interactions are discussed later.

A far more complex, though again simplified, air system is the variable air volume (VAV) system, shown in Figure 6. Simplified Variable Volume Air System. In VAV systems, the supply air temperature, as well as the supply air volume, are continuous functions of zone air temperature. As shown in Figure 7. Idealized Variable Volume System Operation., when the zone air temperature is between Tcl and Tcu, cooling is required and the air system varies the supply air flow rate while maintaining a constant supply air temperature. When the zone air temperature is between Thl and Thu, heating is required and air is supplied at a constant minimum flow rate while the supply air temperature is varied.

![](EngineeringReference/media/image33.svg.png)

Figure 6. Simplified Variable Volume Air System.

The next figure (Idealized variable volume system operation) shows idealized behavior of a VAV system; in practice, the air flow rate and temperature are not exact linear functions of zone air temperature.

![](EngineeringReference/media/image34.svg.png)

Figure 7. Idealized Variable Volume System Operation.

As long as a VAV system has sufficient capacity, the zone air temperatures can be expected to vary within the limits defining the range of operation of the air damper, when cooling, or the throttling range of the reheat coil, when the air system is heating. This means that the desired zone air temperature, used to predict the air system response, is variable and must be calculated in order to determine the air system output. For the purposes of this calculation, the following definitions were found useful:

<div>$${\dot Q_0} = \sum\limits_{i = 1}^{{N_{sl}}} {{{\dot Q}_i}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p}{T_{zi}} + {\dot m_{\inf }}{C_p}{T_\infty }$$</div>

<div>$${\dot Q_{slope}} = \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_p} + {\dot m_{\inf }}{C_p}$$</div>

Equations and are derived, respectively, from the numerator and denominator of Equation but with the system related terms omitted. Also excluded from these expressions are the effects of zone capacitance.

When a zone requires cooling, the VAV system is designed to provide air to that zone at a constant supply air temperature. The amount of cooling is matched to the load by dampers in the supply air duct that vary the air volume flow rate of being supplied to the zone. Assuming that the volume flow rate varies linearly with zone air temperature, the volume flow rate of supply air normalized to the maximum flow rate, or supply air fraction, is given by:

<div>$${\eta_c} = {\eta_{c,\,\min }} + \left( {1 - {\eta_{c,\,\min }}} \right)\left( {\frac{{{T_z} - {T_{c,\,lower}}}}{{{T_{c,\,upper}} - {T_{c,\,lower}}}}} \right);\,{\eta_{c,\,\min }} \le {\eta_c} \le 1.0$$</div>

Normally, the minimum supply air fraction hc,min must be greater than zero to ensure a supply of fresh air sufficient to eliminate contaminants from the zone.

Conversely, when heating is required in a zone, the VAV system becomes a constant volume flow rate system with a variable supply air temperature. The dampers are set to provide air to the zone at the minimum supply air fraction. Throttling the hot water supply to the reheat coil, which effectively alters the coil’s heating capacity, modulates the supply air temperature. Again, assuming the heat energy output varies linearly with zone air temperature and normalizing with respect to the maximum coil output gives the following result:

<div>$${\eta_h} = \left( {\frac{{{T_{h,\,upper}} - {T_z}}}{{{T_{h,\,upper}} - {T_{h,\,lower}}}}} \right);\,0 \le {\eta_h} \le 1.0$$</div>

Observe that when hh is equal to zero, the zone is supplied with air at the cooling coil outlet temperature at the minimum air fraction. Because the control strategies of the VAV system are different whether the air system is heating or cooling, two equations are necessary to describe the air system output in terms of hh and hc. These expressions are as shown in Equations and :

<div>$${\dot Q_{sys,h}} = {\eta_h}{\dot Q_{h/c,\,\max }} + {C_p}\rho {\dot V_{\min }}\left( {{T_{c/c}} - {T_{z,pred,heat}}} \right)$$</div>

<div>$${\dot Q_{sys,c}} = {C_p}\rho \left( {{\eta_c}{{\dot V}_{\max }}} \right)\left( {{T_{c/c}} - {T_{z,pred,cool}}} \right)$$</div>

Equation is valid for zone air temperatures below Th,upper, while Equation is valid for all temperatures above this value. Equating the system output to the zone load, as given by Equation , the definitions of hc and hh were then used to develop expressions for the predicted zone air temperature in the cases of heating and cooling:

<div>$${T_{z,pred,heat}} = \frac{{{{\dot Q}_{h/c,\max }}{T_{h,upper}}}}{{{T_{h,upper}} - {T_{h,lower}}}} + {\dot Q_0} + \frac{{{C_p}\rho {{\dot V}_{\min }}{T_{c/c}}}}{{\frac{{{{\dot Q}_{h/c,\max }}}}{{{T_{h,upper}} - {T_{h,lower}}}} + {C_p}\rho {{\dot V}_{\min }} + {{\dot Q}_{slope}}}}$$</div>

<div>$${T_{z,pred,cool}} = \frac{{{B_1} + \sqrt {B_1^2 + {B_2}} }}{2}$$</div>

where,

<div>$${B_1} = {T_{c/c}} + {T_{c,lower}} - \frac{{{\eta_{c,\min }} - {C_2}}}{{{C_1}}}$$</div>

<div>$${B_2} = 4\left( {\frac{{{C_3}}}{{{C_1}}} + {T_{c/c}}\left( {\frac{{{\eta_{c,\min }}}}{{{C_1}}} - {T_{c,lower}}} \right)} \right)$$</div>

and,

<div>$${C_1} = \frac{{1 - {\eta_{c,\min }}}}{{{T_{c,upper}} - {T_{c,lower}}}}$$</div>

<div>$${C_2} = \frac{{{{\dot Q}_{slope}}}}{{{C_p}\rho {{\dot V}_{\max }}}}$$</div>

<div>$${C_3} = \frac{{{{\dot Q}_0}}}{{{C_p}\rho {{\dot V}_{\max }}}}$$</div>

Once the predicted zone air temperature has been calculated from Equations and , the air system response may be determined. When a zone requires cooling the system supply air temperature is constant at the cooling coil outlet temperature and the volume flow rate is given by:

<div>$${\dot V_{\sup ply}} = {\eta_c}{\dot V_{\max }}$$</div>

where the supply air fraction hc is computed from Equation . When heating is required by the zone, the air system provides air at the minimum volume flow rate and at a temperature given by:

<div>$${T_{\sup ply}} = {T_{c/c}} + \frac{{{\eta_h}{{\dot Q}_{h/c,\max }}}}{{{C_p}\rho {{\dot V}_{\min }}}}$$</div>

The reheat coil capacity fraction hh is determined by using Equation . Once Equation or , has been used, the supply air flow rate and temperature are known. These values are then used in Equation to calculate the updated zone air temperature. The equations describing VAV system operation may be solved without iteration if the cooling coil outlet temperature is constant, i.e. if the coil has infinite capacity, and if the reheat coil capacity varies linearly with zone air temperature. This is not the case, either in practice or in simulations, when realistic coil models are used. Therefore, an iteration scheme was developed that solved these equations simultaneously with the coil performance models.

Moisture Predictor-Corrector
----------------------------

The transient air mass balance equation for the change in the zone humidity ratio = sum of internal scheduled latent loads + infiltration + system + multizone airflows + convection to the zone surfaces may be expressed as follows:

<div>$$\begin{array}{l}{\rho_{air}}{V_z}{C_W}\frac{{d{W_z}}}{{dt}} = \sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}\left( {{W_{surf{s_i}}} - W_z^t} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{W_{zi}} - W_z^t} \right)\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; + {{\dot m}_{\inf }}\left( {{W_\infty } - W_z^t} \right) + {{\dot m}_{sys}}\left( {{W_{\sup }} - W_z^t} \right)\end{array}$$</div>

where

C<sub>W</sub> = humidity capacity multiplier (See the InputOutput Reference for additional information on the object ZoneCapacitanceMultiplier:ResearchSpecial)

In the same manner as described above for zone air temperature (ref. Basis for the Zone and Air System Integration), the solution algorithms provided in the ZoneAirHeatBalanceAlgorithm object are also applied to zone air moisture calculations.

In order to calculate the derivative term with respect to time, the first order backward finite difference method, defined as the EulerMethod in the ZoneAirHeatBalanceAlgorithm object, may be used:

 <div>$$\frac{{dW}}{{dt}} = {\left( {\delta t} \right)^{ - 1}}(W_z^t - W_z^{t - \delta t}) + O(\delta t)$$</div>

The zone air humidity ratio update at the current time step using the EulerMethod may be expressed as follows:

<div>$$\begin{array}{l}{\rho_{air}}V{C_W}{\left( {\delta t} \right)^{ - 1}}\left( {W_z^t - W_z^{t - \delta t}} \right) = \sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}\left( {{W_{surf{s_i}}} - W_z^t} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{W_{zi}} - W_z^t} \right)\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; + {{\dot m}_{\inf }}\left( {{W_\infty } - W_z^t} \right) + {{\dot m}_{sys}}\left( {{W_{\sup }} - W_z^t} \right)\end{array}$$</div>

To preserve the stability of the calculation of the zone humidity ratio, the third order differential approximation, derived by a Taylor Series and used in the calculation of the next time step’s zone air temperature, is also applied to the zone air humidity ratio calculations. This algorithm is the default choice and is defined as 3rdOrderBackwardDifference in the ZoneAirHeatBalanceAlgorithm object.

The third order derivative derived from a Taylor Series expansion is defined as:

<div>$${\left. {\frac{{d{W_z}}}{{dt}}} \right|_t} \approx \frac{{\left( {{\textstyle{{11} \over 6}}W_z^t - 3W_z^{t - \delta t} + {\textstyle{3 \over 2}}W_z^{t - 2\delta t} - {\textstyle{1 \over 3}}W_z^{t - 3\delta t}} \right)}}{{\delta t}} + O\left( {\delta {t^3}} \right)$$</div>.

The coefficients of the approximated derivative are very close to the coefficients of the analogous Adams-Bashforth algorithm. Then the approximated derivative is substituted into the mass balance and the terms with the humidity ratio at past time steps are all put on the right hand side of the equation. This third order derivative zone humidity ratio update increases the number of previous time steps that are used in calculating the new zone humidity ratio, and decreases the dependence on the most recent. The higher order derivative approximations have the potential to allow the use of larger time steps by smoothing transitions through sudden changes in zone operating conditions.

<div>$$\begin{array}{l}\frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\left( {\frac{{11}}{6}} \right)W_z^t + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}W_z^t + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} W_z^t + {{\dot m}_{\inf }}W_z^t + {{\dot m}_{sys}}W_z^t = \sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}}\\\;\;\;\;\;\;\;\;\;\; + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {{\dot m}_{\inf }}{W_\infty } + {{\dot m}_{sys}}{W_{\sup }} - \frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\left( { - 3W_z^{t - \delta t} + \frac{3}{2}W_z^{t - 2\delta t} - \frac{1}{2}W_z^{t - 3\delta t}} \right)\end{array}$$</div>

This gives us the basic air mass balance equation that will be solved two different ways, one way for the predict step and one way for the correct step.

Since the third choice of solution algorithms uses an integration approach, defined as AnalyticalSolution in the ZoneAirHeatBalanceAlgorithm object, it does not require any approximations and has no truncation errors. The solutions in both prediction and correction are provided below in detail.

### Moisture Prediction

For the moisture prediction case the equation is solved for the anticipated system response as shown below.

<div>$$
  \begin{array}{l}
    \rm{PredictedSystemLoad} = \dot{m}_{sys}*\left(W_z^t - W_{sup}\right) \\
    \rm{MassFlow * HumRat} = \frac{kg_{air}}{sec}\frac{kg_{water}}{kg_{air}} = \frac{kg_{water}}{sec}
  \end{array}
$$</div>

Since the program provides three solution algorithms, the moisture prediction from each solution algorithm is given below.

#### EulerMethod

For this solution algorithm, the air mass balance for the predicted air system load or response is:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[k{g_{Water}}/\sec ] = {\rho_{air}}{V_z}{C_W}{\left( {\delta t} \right)^{ - 1}}\left( {W_{{\rm{setpoint}}}^t - W_z^{t - \delta t}} \right)\\\;\;\;\; - \left[ {\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}\left( {{W_{surf{s_i}}} - W_{{\rm{setpoint}}}^t} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{W_{zi}} - W_{{\rm{setpoint}}}^t} \right) + {{\dot m}_{\inf }}\left( {{W_\infty } - W_{{\rm{setpoint}}}^t} \right)} \right]\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\end{array}$$</div>

#### ThirdOrderBackwardDifference

For this solution algorithm, the air mass balance for the predicted system load or response is given below:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[k{g_{Water}}/\sec ] = \left( {\frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\left( {\frac{{11}}{6}} \right) + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }}} \right)W_z^t - \\\;\;\;\left[ {\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {{\dot m}_{\inf }}{W_\infty } + \frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\left( {3W_z^{t - \delta t} - \frac{3}{2}W_z^{t - 2\delta t} + \frac{1}{3}W_z^{t - 3\delta t}} \right)} \right]\;\;\end{array}$$</div>

Then, using the following substitutions, the air mass balance equation becomes:

<div>$$A = \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {\dot m_{\inf }}$$</div>

<div>$$B = \;\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {\dot m_{\inf }}{W_\infty }\;$$</div>

<div>$$C = \frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\;$$</div>

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[k{g_{Water}}/\sec ] = \left[ {\frac{{11}}{6}*C + A} \right]\;*{W_{SetPo{\mathop{\rm int}} }} - \\\;\;\;\;\;\;\;\;\;\left[ {B + C*\left( {3W_z^{t - \delta t} - \frac{3}{2}W_z^{t - 2\delta t} + \frac{1}{3}W_z^{t - 3\delta t}} \right)} \right]\end{array}$$</div>

#### AnalyticalSolution

For this solution algorithm, the air mass balance for the predicted air system load or response is given below:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[k{g_{Water}}/\sec ] = \left[ {\sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}}\; + {{\dot m}_{\inf }}} \right]*\\\;\;\;\left[ {W_{{\rm{setpoint}}}^t - W_z^{t - \delta t}*\exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}}\; + {{\dot m}_{\inf }}}}{{{\rho_{air}}{V_z}{C_W}}}\delta t} \right)} \right]*\\\;\;\;{\left[ {1 - \exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }}}}{{{\rho_{air}}{V_z}{C_W}}}\delta t} \right)} \right]^{ - 1}} - \\\;\;\;\left( {\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}} \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}}\; + {{\dot m}_{\inf }}{W_\infty }} \right)\end{array}$$</div>

At the prediction point in the simulation, the system air mass flows are not known; therefore, the system response is approximated. The predicted air system moisture load is then used in the system simulation to achieve the best results possible. The system simulation components that have moisture control will try to meet this predicted moisture load. For example, humidifiers will look for positive moisture loads and add moisture at the specified rate to achieve the relative humidity setpoint. Likewise, dehumidification processes will try to remove moisture at the specified negative predicted moisture load to meet the relative humidity setpoint.

After the system simulation is completed the actual response from the air system is used in the moisture correction of step, which is shown next.

### Moisture Correction

For the correct step the expanded air mass balance equation is solved for the final zone humidity ratio at the current time step. When the air system is operating, the mass flow for the system outlet includes the infiltration mass flow rate, therefore the infiltration mass flow rate is not included as a separate term in the air mass balance equation. But when the air system is off, the infiltration mass flow in is then exhausted out of the zone directly.

In the same manner as described above for predicting the moisture load to be met by the air system, the zone air moisture correction calculation will be described individually for the three solution algorithms.

#### EulerMethod

<div>$$W_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {{\dot m}_{\inf }}{W_\infty } + {{\dot m}_{sys}}{W_{\sup }} + {\rho_{air}}{V_z}{C_W}\frac{{W_z^{t - \delta t}}}{{\delta t}}}}{{\frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}} + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}{\rho_{ai{r_z}}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}$$</div>

#### ThirdOrderBackwardDifference

<div>$$W_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {{\dot m}_{\inf }}{W_\infty } + {{\dot m}_{sys}}{W_{\sup }} + \frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}(3W_z^{t - \delta t} - \frac{3}{2}W_z^{t - 2\delta t} + \frac{1}{3}W_z^{t - 3\delta t})}}{{\frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\left( {\frac{{11}}{6}} \right) + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}{\rho_{ai{r_z}}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}$$</div>

Using the same A, B, and C parameters from the prediction step modified with actual zone mass flows with the air system ON and OFF result in:



**If** (ZoneSupplyAirMassFlowRate &gt; 0.0) **Then**

<div>$$A = \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {\dot m_{\inf }} + {\dot m_{sys}}$$</div>

<div>$$B = \;\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {\dot m_{\inf }}{W_\infty }\; + {\dot m_{sys}}{W_{\sup }}$$</div>

<div>$$C = \frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\;$$</div>

**Else If** (ZoneSupplyAirMassFlowRate &lt;= 0.0) **Then**

<div>$$A = \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {\dot m_{\inf }} + {\dot m_{Exhaust}}$$</div>

<div>$$B = \;\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}} + {\dot m_{\inf }}{W_\infty }\; + {\dot m_{Exhaust}}{W_\infty }$$</div>

<div>$$C = \frac{{{\rho_{air}}{V_z}{C_W}}}{{\delta t}}\;$$</div>

**End If**

Inserting in the parameters A, B and C above in the air mass balance equation, it simplifies to:

<div>$$W_z^t = \left[ {\frac{{B + C * \left( {3W_z^{t - \delta t} - {\textstyle{3 \over 2}}W_z^{t - 2\delta t} + {\textstyle{1 \over 3}}W_z^{t - 3\delta t}} \right)}}{{\left( {{\textstyle{{11} \over 6}}} \right) * C + A}}} \right]$$</div>

#### AnalyticalSolution

<div>$$\begin{array}{l}W_z^t = \left[ \begin{array}{l}W_z^{t - \delta t} - \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}}\; + {{\dot m}_{\inf }}{W_\infty } + {{\dot m}_{sys}}{W_{\sup }}}}{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}\\\end{array} \right]*\\\;\;\;\exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}{{{\rho_{air}}{V_z}{C_W}}}\delta t} \right) + \\\;\;\;\frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}}  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}}{W_{surf{s_i}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {W_{zi}}\; + {{\dot m}_{\inf }}{W_\infty } + {{\dot m}_{sys}}{W_{\sup }}}}{{\sum\limits_{i = 1}^{{N_{surfaces}}} {{A_i}{h_{mi}}} {\rho_{ai{r_z}}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}\end{array}$$</div>

The above solutions are implemented in the Correct Zone Air Humidity Ratio step in EnergyPlus. This moisture update equation is used for the Conduction Transfer Function (CTF) heat balance algorithm, in addition to the effective moisture penetration depth (EMPD) with conduction transfer function heat balance algorithm. The equations are identical except that the convection to the zone surfaces is non-zero for the moisture penetration depth case. This moisture update allows both methods to be updated in the same way, with the only difference being the additional moisture capacitance of the zone surfaces for the Effective Moisture Penetration Depth (EMPD) solution approach.

When the HAMT (Combined Heat And Moisture Finite Element) defined in the HeatBalanceAlgorithm object is applied, the moisture update equations are also the same as the equations used in the effective moisture penetration depth (EMPD) with conduction transfer function solution algorithm.

Carbon Dioxide Predictor-Corrector
----------------------------------

The transient air mass balance equation for the change in zone air carbon dioxide concentration may be expressed as follows:

<div>$${\rho_{air}}{V_z}{C_{CO2}}\frac{{dC_z^t}}{{dt}} = \sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{C_{zi}} - C_z^t} \right)\; + {\dot m_{\inf }}\left( {{C_\infty } - C_z^t} \right) + {\dot m_{sys}}\left( {{C_{\sup }} - C_z^t} \right)$$</div>

where:

<span>$\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}} $</span> = sum of scheduled internal carbon dioxide loads. The zone air density is used to convert the volumetric rate of carbon dioxide generation from user input into mass generation rate [kg/s].The coefficient of 10<sup>6</sup> is used to make the units of carbon dioxide as ppm.

<span>$ \sum_{i=1}^{N_{zones}} \dot m_i \left( C_{zi} - C_z^t \right) $</span> = carbon dioxide transfer due to interzone air mixing [ppm-kg/s]

<span>${C_{zi}}$</span> = carbon dioxide concentration in the zone air being transferred into this zone [ppm]

<span>${\dot m_{\inf }}\left( {{C_\infty } - C_z^t} \right)$</span> = carbon dioxide transfer due to infiltration and ventilation of outdoor air [ppm-kg/s]

<span>${C_\infty }$</span> = carbon dioxide concentration in outdoor air [ppm]

<span>${\dot m_{sys}}\left( {{C_{\sup }} - C_z^t} \right)$</span> = carbon dioxide transfer due to system supply [ppm-kg/s]

<span>${C_{\sup }}$</span> = carbon dioxide concentration in the system supply airstream [ppm]

<span>${\dot m_{sys}}$</span> = air system supply mass flow rate [kg/s]

<span>${\rho_{air}}{V_z}\frac{{dC_z^t}}{{dt}}$</span>= carbon dioxide storage term in zone air [kg/s]

<span>$C_z^t$</span> = zone air carbon dioxide concentration at the current time step [ppm]

<span>${\rho_{air}}$</span>= zone air density [kg/m<sup>3</sup>]

<span>${V_z}$</span>= zone volume [m<sup>3</sup>]

C<sub>CO2</sub> = carbon dioxide capacity multiplier [dimensionless] (See the InputOutput Reference for additional information on the object ZoneCapacitanceMultiplier:ResearchSpecial)

In the same manner as described above for zone air temperature (ref. Basis for the Zone and Air System Integration), the solution algorithms provided in the ZoneAirHeatBalanceAlgorithm object are also applied to the zone air carbon dioxide calculations.

In order to calculate the derivative term with respect to time, the first order backward finite difference method, defined as the EulerMethod in the ZoneAirHeatBalanceAlgorithm object, may be used:

<div>$$\frac{{dC_z^t}}{{dt}} = {\left( {\delta t} \right)^{ - 1}}(C_z^t - C_z^{t - \delta t}) + O(\delta t)$$</div>

The zone air carbon dioxide concentration update at the current time step using the EulerMethod may be expressed as follows:

<div>$${\rho_{air}}{V_Z}{C_{CO2}}{\left( {\delta t} \right)^{ - 1}}\left( {C_z^t - C_z^{t - \delta t}} \right) = \sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}} *{10^6} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{C_{zi}} - C_z^t} \right) + {\dot m_{\inf }}\left( {{C_\infty } - C_z^t} \right) + {\dot m_{sys}}\left( {{C_{\sup }} - C_z^t} \right)$$</div>

To preserve the stability of the calculation of the zone carbon dioxide concentration, the third order differential approximation, derived by a Taylor Series and used in the calculation of the next time step’s zone air temperature, is also applied to the zone air carbon dioxide calculations. This algorithm is the default choice and is defined as ThirdOrderBackwardDifference in the ZoneAirHeatBalanceAlgorithm object.

The third order derivative derived from a Taylor Series expansion is defined as:

<div>$$\frac{{dC_z^t}}{{dt}} \approx \frac{{\frac{{11}}{6}C_z^t - 3C_z^{t - \delta t} + \frac{3}{2}C_z^{t - 2\delta t} - \frac{1}{3}C_z^{t - 3\delta t}}}{{\delta t}} + O(\delta {t^3})$$</div>

The coefficients of the approximated derivative are very close to the coefficients of the analogous Adams-Bashforth algorithm. Then the approximated derivative is substituted into the mass balance and the terms with the carbon dioxide concentration at past time steps are all put on the right-hand side of the equation. This third order derivative zone carbon dioxide update increases the number of previous time steps that are used in calculating the new zone carbon dioxide concentration, and decreases the dependence on the most recent. The higher order derivative approximations have the potential to allow the use of larger time steps by smoothing transitions through sudden changes in zone operating conditions.

<div>$$\begin{array}{l}\frac{{{\rho_{air}}{V_z}{C_{CO2}}}}{{\delta t}}\left( {\frac{{11}}{6}} \right)C_z^t + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} C_z^t + {{\dot m}_{\inf }}C_z^t + {{\dot m}_{sys}}C_z^t = \sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}} *{10^6}\\\;\;\;\;\;\;\; + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}} + {{\dot m}_{\inf }}{C_\infty } + {{\dot m}_{sys}}{C_{\sup }} - \frac{{{\rho_{air}}{V_z}{C_{CO2}}}}{{\delta t}}( - 3C_z^{t - \delta t} + \frac{3}{2}C_z^{t - 2\delta t} - \frac{1}{3}C_z^{t - 3\delta t})\end{array}$$</div>

This gives us the basic air mass balance equation that will be solved two different ways, one way for the predict step and one way for the correct step.

Since the third choice of solution algorithms uses an integration approach, defined as AnalyticalSolution in the ZoneAirHeatBalanceAlgorithm object, it does not require any approximations and has no truncation errors. The solutions in both prediction and correction are provided below in detail.

### Carbon Dioxide Prediction

For the carbon dioxide concentration prediction case, the equation is solved for the anticipated system response as shown below.

<div>$${\rm{PredictedSystemLoad}} = {\dot m_{sys}}\left( {{C_{\sup }} - C_z^t} \right)$$</div>

Since the program provides three solution algorithms, the carbon dioxide prediction from each solution algorithm is given below.

#### EulerMethod

For this solution algorithm, the air mass balance for the predicted air system load or response is:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[kg/\sec ] = {\rho_{air}}{V_Z}{C_{CO2}}{\left( {\delta t} \right)^{ - 1}}\left( {C_{{\rm{setpoint}}}^t - C_z^{t - \delta t}} \right)\\\;\;\;\; - \left[ {\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}} *{{10}^6} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{C_{zi}} - C_{{\rm{setpoint}}}^t} \right) + {{\dot m}_{\inf }}\left( {{C_\infty } - C_{{\rm{setpoint}}}^t} \right)} \right]\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\end{array}$$</div>

#### ThirdOrderBackwardDifference

For this solution algorithm, the air mass balance for the predicted system load or response is given below:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[kg/\sec ] = \left[ {\frac{{{\rho_{air}}{V_z}{C_{CO2}}}}{{\delta t}}\left( {\frac{{11}}{6}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }}} \right]*C_{{\rm{setpoint}}}^t\\\;\;\;\; - \left[ {\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{10}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}} + {{\dot m}_{\inf }}{C_\infty } + \frac{{{\rho_{air}}{V_z}{C_{CO2}}}}{{\delta t}}\left( {3C_z^{t - \delta t} - \frac{3}{2}C_z^{t - 2\delta t} + \frac{1}{3}C_z^{t - 3\delta t}} \right)} \right]\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\end{array}$$</div>

#### AnalyticalSolution

For this solution algorithm, the air mass balance for the predicted air system load or response is given below:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[kg/\sec ] = \left[ {\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }}} \right]*\;\left[ {C_{{\rm{setpoint}}}^t - C_z^{t - \delta t}*\exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }}}}{{{\rho_{air}}{V_Z}{C_{CO2}}}}\delta t} \right)} \right]*\\\;\;\;{\left[ {1 - \exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }}}}{{{\rho_{air}}{V_Z}{C_{CO2}}}}\delta t} \right)} \right]^{ - 1}} - \;\left( {\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{10}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}}\; + {{\dot m}_{\inf }}{C_\infty }} \right)\end{array}$$</div>

At the prediction point in the simulation, the system air mass flows are not known; therefore, the system response is approximated. The predicted air system carbon dioxide load is then used in the system simulation to achieve the best results possible. If a central HVAC system provides the outdoor flow rate from a Controller:MechanicalVentilation object, the outdoor airflow rate may be approximated as:

<div>$${\rm{PredictedSystemLoad}} = {\dot m_{sys}}\left( {{C_{\sup }} - C_z^t} \right) \approx {\dot m_{OA,z}}\left( {{C_\infty } - C_{{\rm{setpoint}}}^t} \right)$$</div>

where:

<span>${\dot m_{OA,z}}$</span>= supply outdoor airflow rate into the controlled zone [kg/s]

The above approximation is based on the assumption that the carbon dioxide concentration at the outdoor air (OA) mixer inlet is equal to the zone air outlet concentration level, and the carbon dioxide level at the zone supply air inlet is equal to the level at the outlet node of the OA mixer.

After the system simulation is completed the actual response from the air system is used in the carbon dioxide correction step, which is shown next.

### Carbon Dioxide Correction

For the correct step the expanded air mass balance equation is solved for the final zone carbon dioxide concentration at the current time step. In the same manner as described above for predicting the carbon dioxide load to be met by the air system, the zone air carbon dioxide correction calculation will be described individually for the three solution algorithms.



#### EulerMethod

<div>$$C_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{10}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}} + {{\dot m}_{\inf }}{C_\infty } + {{\dot m}_{sys}}{C_{\sup }} + {\rho_{air}}{V_Z}{C_{CO2}}\frac{{C_z^{t - \delta t}}}{{\delta t}}}}{{\frac{{{\rho_{air}}{V_Z}{C_{CO2}}}}{{\delta t}} + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}$$</div>

#### ThirdOrderBackwardDifference

<div>$$C_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{10}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}} + {{\dot m}_{\inf }}{C_\infty } + {{\dot m}_{sys}}{C_{\sup }} + \frac{{{\rho_{air}}{V_Z}{C_{CO2}}}}{{\delta t}}(3C_z^{t - \delta t} - \frac{3}{2}C_z^{t - 2\delta t} + \frac{1}{3}C_z^{t - 3\delta t})}}{{\frac{{{\rho_{air}}{V_Z}{C_{CO2}}}}{{\delta t}}\left( {\frac{{11}}{6}} \right) + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}$$</div>

#### AnalyticalSolution

<div>$$\begin{array}{l}C_z^t = \left[ {C_z^{t - \delta t} - \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{10}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}}\; + {{\dot m}_{\inf }}{C_\infty } + {{\dot m}_{sys}}{C_{sys}}}}{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}} \right]*\exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}{{{\rho_{air}}{V_Z}{C_{CO2}}}}\delta t} \right) + \\\;\;\;\frac{{\sum\limits_{i = 1}^{{N_{sl}}} {k{g_{mas{s_{sched\;load}}}}*{{10}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{zi}}\; + {{\dot m}_{\inf }}{C_\infty } + {{\dot m}_{sys}}{C_{sys}}}}{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}}}}\end{array}$$</div>

The above solutions are implemented in the Correct Zone Air Carbon Dioxide step in the Zone Contaminant Predictor Corrector module of EnergyPlus.

Generic Contaminant Predictor-Corrector
---------------------------------------

The transient air mass balance equation for the change in zone air generic contaminant concentration may be expressed as follows:

<div>$$\begin{array}{l}{\rho_{air}}{V_z}{M_{for}}\frac{{dC_{f,z}^t}}{{dt}} = \sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6} - } {\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}{C_{f,z}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{C_{f,z,i}} - C_{f,z}^t} \right)\; + {{\dot m}_{\inf }}\left( {{C_{f,\infty }} - C_{f,z}^t} \right)\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; + {{\dot m}_{sys}}\left( {{C_{f,\sup }} - C_{f,z}^t} \right) + \sum\limits_j {{h_j}\rho {A_j}(\frac{{{C_{s,j}}}}{{{k_j}}} - {C_{f,z}})}  + {S_f}(C_{f,z}^{t - \delta t})\end{array}$$</div>

where:

<span>$\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}} $</span>=  Sum of internal generic contaminant loads from sources in a zone or interior surfaces.

The zone air density is used to convert the volumetric rate of generic contaminant generation from user input into mass generation rate [kg/s].The coefficient of 10<sup>6</sup> is used to make the units of generic contaminant as ppm.

<span>${\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}{C_{f,z}}} $</span>= Sum of removal rate from sinks in a zone or interior surfaces [ppm-kg/s]

<span>$\sum_{i=1}^{N_{zones}} \dot m_i \left( C_{f,z,i} - C_{f,z}^t \right)$</span> = Generic contaminant transfer due to interzone air mixing [ppm-kg/s]

<span>${C_{f,z,i}}$</span> = Generic contaminant concentration in the zone air being transferred into this zone [ppm]

<span>${\dot m_{\inf }}\left( {{C_{f,\infty }} - C_{f,z}^t} \right)$</span>   = Generic contaminant transfer due to infiltration and ventilation of outdoor air [ppm-kg/s]

<span>${C_{f,\infty }}$</span> = Generic contaminant concentration in outdoor air [ppm]

<span>${\dot m_{sys}}\left( {{C_{f,\sup }} - C_{f,z}^t} \right)$</span> = Generic contaminant transfer due to system supply [ppm-kg/s]

<span>${C_{f,\sup }}$</span> = Generic contaminant concentration in the system supply airstream [ppm]

<span>${\dot m_{sys}}$</span> = Air system supply mass flow rate [kg/s]

<span>${\rho_{air}}{V_z}\frac{{dC_{f,z}^t}}{{dt}}$</span>= Generic contaminant storage term in zone air [ppm-kg/s]

<span>$C_{f,z}^t$</span> = Zone air generic contaminant concentration at the current time step [ppm]

<span>${\rho_{air}}$</span>= Zone air density [kg/m<sup>3</sup>]

<span>${V_z}$</span>= Zone volume [m<sup>3</sup>]

<span>$\sum\limits_j {{h_j}\rho {A_j}(\frac{{{C_{s,j}}}}{{{k_j}}} - {C_{f,z}})} $</span>       = Generic contaminant transport through diffusion between interior surfaces and zone air

<span>${S_f}(C_{f,z}^{t - \delta t})$</span>= Generic contaminant generation or removal rate as a function of zone air generic contaminant level at the previous time step

Mfor = Generic contaminant capacity multiplier [dimensionless] (See the InputOutput Reference for additional information on the object ZoneCapacitanceMultiplier:ResearchSpecial)

In the same manner as described above for zone air temperature (ref. Basis for the Zone and Air System Integration), the solution algorithms provided in the ZoneAirHeatBalanceAlgorithm object are also applied to the zone air carbon dioxide calculations.

In order to calculate the derivative term with respect to time, the first order backward finite difference method, defined as the EulerMethod in the ZoneAirHeatBalanceAlgorithm object, may be used:

<div>$$\frac{{dC_{f,z}^t}}{{dt}} = {\left( {\delta t} \right)^{ - 1}}(C_{f,z}^t - C_{f,z}^{t - \delta t}) + O(\delta t)$$</div>

The zone air generic contaminant concentration update at the current time step using the EulerMethod may be expressed as follows:

<div>$$\begin{array}{l}{\rho_{air}}{V_z}{M_{for}}{\left( {\delta t} \right)^{ - 1}}\left( {C_{f,z}^t - C_{f,z}^{t - \delta t}} \right) = \sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6} - } {\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}{C_{f,z}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{C_{f,z,i}} - C_{f,z}^t} \right)\;\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; + {{\dot m}_{\inf }}\left( {{C_{f,\infty }} - C_{f,z}^t} \right) + {{\dot m}_{sys}}\left( {{C_{f,\sup }} - C_{f,z}^t} \right) + \sum\limits_j {{h_j}\rho {A_j}(\frac{{{C_{s,j}}}}{{{k_j}}} - {C_{f,z}})}  + {S_f}\end{array}$$</div>

To preserve the stability of the calculation of the zone generic contaminant concentration, the third order differential approximation, derived by a Taylor Series and used in the calculation of the next time step’s zone air temperature, is also applied to the zone air carbon dioxide calculations. This algorithm is the default choice and is defined as ThirdOrderBackwardDifference in the ZoneAirHeatBalanceAlgorithm object.

The third order derivative resulting from a Taylor Series expansion is defined as:

<div>$$\frac{{dC_{f,z}^t}}{{dt}} \approx \frac{{\frac{{11}}{6}C_{f,z}^t - 3C_{f,z}^{t - \delta t} + \frac{3}{2}C_{f,z}^{t - 2\delta t} - \frac{1}{3}C_{f,z}^{t - 3\delta t}}}{{\delta t}} + O(\delta {t^3})$$</div>

The coefficients of the approximated derivative are very close to the coefficients of the analogous Adams-Bashforth algorithm. Then the approximated derivative is substituted into the mass balance, and the terms with the carbon dioxide concentration at past time steps are all put on the right-hand side of the equation. This third order derivative zone carbon dioxide update increases the number of previous time steps that are used in calculating the new zone generic contaminant concentration and decreases the dependence on the most recent. The higher order derivative approximations have the potential to allow the use of larger time steps by smoothing transitions through sudden changes in zone operating conditions.

<div>$$\begin{array}{l}\frac{{{\rho_{air}}{V_z}{M_{for}}}}{{\delta t}}\left( {\frac{{11}}{6}} \right)C_{f,z}^t + {\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}C_{f,z}^t}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} C_{f,z}^t + {{\dot m}_{\inf }}C_{f,z}^t + {{\dot m}_{sys}}C_{f,z}^t + \sum\limits_j {{h_j}\rho {A_j}C_{f,z}^t} \\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; = \sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{f,z,i}} + {{\dot m}_{\inf }}{C_{f,\infty }} + {{\dot m}_{sys}}{C_{f,\sup }} + \sum\limits_j {{h_j}\rho {A_j}\frac{{{C_{s,j}}}}{{{k_j}}}}  + {S_f}\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; - \frac{{{\rho_{air}}{V_z}{M_{for}}}}{{\delta t}}\left( { - 3C_{f,z}^{t - \delta t} + \frac{3}{2}C_{f,z}^{t - 2\delta t} - \frac{1}{3}C_{f,z}^{t - 3\delta t}} \right)\end{array}$$</div>

This gives us the basic air mass balance equation that will be solved in two different ways, one way for the predict step and one way for the correct step.

Since the third choice of solution algorithms uses an integration approach, defined as AnalyticalSolution in the ZoneAirHeatBalanceAlgorithm object, it does not require any approximations and has no truncation errors. The solutions in both prediction and correction are provided below in detail.

### Generic Contaminant Prediction

For the generic contaminant concentration prediction case, the equation is solved for the anticipated system response as shown below.

<div>$${\rm{PredictedSystemLoad}} = {\dot m_{sys}}\left( {{C_{f,\sup }} - C_{f,z}^t} \right)$$</div>

Since the program provides three solution algorithms, the generic contaminant prediction from each solution algorithm is given below.

#### EulerMethod

For this solution algorithm, the air mass balance for the predicted air system load or response is:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[kg/\sec ] = {\rho_{air}}{V_z}{M_{for}}{\left( {\delta t} \right)^{ - 1}}\left( {{C_{{\rm{setpoint}}}} - C_{f,z}^{t - \delta t}} \right)\\\;\;\;\;\;\;\; - \left[ {\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6} - } {\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}{C_{{\rm{setpoint}}}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \left( {{C_{f,z,i}} - {C_{{\rm{setpoint}}}}} \right) + {S_f}} \right]\\\;\;\;\;\;\; - \left[ {{{\dot m}_{\inf }}\left( {{C_{f,\infty }} - {C_{{\rm{setpoint}}}}} \right) + \sum\limits_j {{h_j}\rho {A_j}(\frac{{{C_{s,j}}}}{{{k_j}}} - {C_{{\rm{setpoint}}}})} } \right]\;\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\end{array}$$</div>

#### ThirdOrderBackwardDifference

For this solution algorithm, the air mass balance for the predicted system load or response is given below:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[kg/\sec ] = \frac{{{\rho_{air}}{V_z}{M_{for}}}}{{\delta t}}\left( {\frac{{11}}{6}} \right){C_{{\rm{setpoint}}}} - \left[ {{\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}{C_{{\rm{setpoint}}}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{{\rm{setpoint}}}} + {{\dot m}_{\inf }}{C_{{\rm{setpoint}}}}} \right]\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; - \left[ {\sum\limits_j {{h_j}\rho {A_j}{C_{{\rm{setpoint}}}}}  + \sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{f,z,i}} + {{\dot m}_{\inf }}{C_{f,\infty }} + \sum\limits_j {{h_j}\rho {A_j}\frac{{{C_{s,j}}}}{{{k_j}}} + {S_f}} } \right]\\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; + \frac{{{\rho_{air}}{V_z}{M_{for}}}}{{\delta t}}\left( { - 3C_{f,z}^{t - \delta t} + \frac{3}{2}C_{f,z}^{t - 2\delta t} - \frac{1}{3}C_{f,z}^{t - 3\delta t}} \right)\end{array}$$</div>

#### AnalyticalSolution

For this solution algorithm, the air mass balance for the predicted air system load or response is given below:

<div>$$\begin{array}{l}{\rm{PredictedSystemLoad}}\;[kg/\sec ] = \left[ {\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {\rho_{air}}\sum\limits_i^{{N_{{\rm{sink}}}}} {{R_{f,i}} + \sum\limits_j {{h_j}\rho {A_j}} } } \right]*\\\;\;\;\;\;\;\;\;\;\;\;\left[ {C_{{\rm{setpoint}}}^t - C_z^{t - \delta t}*\exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {\rho_{air}}\sum\limits_i^{{N_{{\rm{sink}}}}} {{R_{f,i}} + \sum\limits_j {{h_j}\rho {A_j}} } }}{{{\rho_{air}}{V_Z}{M_{FOR}}}}\delta t} \right)} \right]*\\\;\;\;\;\;\;\;\;\;\;\;{\left[ {1 - \exp \left( { - \frac{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {\rho_{air}}\sum\limits_i^{{N_{{\rm{sink}}}}} {{R_{f,i}} + \sum\limits_j {{h_j}\rho {A_j}} } }}{{{\rho_{air}}{V_Z}{M_{FOR}}}}\delta t} \right)} \right]^{ - 1}} - \\\;\;\;\;\;\;\;\;\;\;\;\left( {\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{f,z,i}}\; + {{\dot m}_{\inf }}{C_{f,\infty }} + \sum\limits_j {{h_j}\rho {A_j}} \frac{{{C_{s,j}}}}{{{k_j}}} + {S_f}} \right)\end{array}$$</div>

At the prediction point in the simulation, the system air mass flows are not known; therefore, the system response is approximated. The predicted air system generic contaminant load is then used in the system simulation to achieve the best results possible. If a central HVAC system provides the outdoor flow rate from a Controller:MechanicalVentilation object, the outdoor airflow rate may be approximated as:

<div>$${\rm{PredictedSystemLoad}} = {\dot m_{sys}}\left( {{C_{f,\sup }} - C_{f,z}^t} \right) \approx {\dot m_{OA,z}}\left( {{C_{f,\infty }} - C_{{\rm{setpoint}}}^t} \right)$$</div>

where:

<span>${\dot m_{OA,z}}$</span>= Supply outdoor airflow rate into the controlled zone [kg/s]

The above approximation is based on the assumption that the generic contaminant concentration at the outdoor air (OA) mixer inlet is equal to the zone air outlet concentration level, and the generic contaminant level at the zone supply air inlet is equal to the level at the outlet node of the OA mixer.

After the system simulation is completed, the actual response from the air system is used in the generic contaminant correction step, which is shown next.

### Generic Contaminant Correction

For the correct step, the expanded air mass balance equation is solved for the final zone generic contaminant concentration at the current time step. In the same manner as described above for predicting the carbon dioxide load to be met by the air system, the zone air carbon dioxide correction calculation will be described individually for the three solution algorithms.

#### EulerMethod

<div>$$\begin{array}{l}C_{f,z}^t = \frac{{\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}{C_{f,z,i}}}  + {{\dot m}_{\inf }}{C_{f,\infty }} + {{\dot m}_{sys}}{C_{f,\sup }} + \sum\limits_j {{h_j}\rho {A_j}\frac{{{C_{s,j}}}}{{{k_j}}} + {\rho_{air}}{V_Z}{M_{FOR}}\frac{{C_{f,z}^{t - \delta t}}}{{\delta t}} + {S_f}} }}{{{\rho_{air}}{V_z}{M_{for}}{{\left( {\delta t} \right)}^{ - 1}} + {\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}} + \sum\limits_j {{h_j}\rho {A_j}} }}\\\end{array}$$</div>

#### ThirdOrderBackwardDifference

<div>$$\begin{array}{l}C_{f,z}^t = \frac{\begin{array}{l}\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}{C_{f,z,i}}}  + {{\dot m}_{\inf }}{C_{f,\infty }} + {{\dot m}_{sys}}{C_{f,\sup }}\\ + \sum\limits_j {{h_j}\rho {A_j}\frac{{{C_{s,j}}}}{{{k_j}}} + \frac{{{\rho_{air}}{V_Z}{M_{FOR}}}}{{\delta t}}(3C_{f,z}^{t - \delta t} - \frac{3}{2}C_{f,z}^{t - 2\delta t} + \frac{1}{3}C_{f,z}^{t - 3\delta t}) + {S_f}} \end{array}}{{{\rho_{air}}{V_z}{M_{for}}{{\left( {\delta t} \right)}^{ - 1}}\left( {\frac{{11}}{6}} \right) + {\rho_{air}}\sum\limits_i^{N{\rm{sink}}} {{R_{f,i}}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}} + \sum\limits_j {{h_j}\rho {A_j}} }}\\\end{array}$$</div>

#### AnalyticalSolution

<div>$$\begin{array}{l}C_{f,z}^t = \left[ {C_{f,z}^{t - \delta t} - \frac{{\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{f,z,i}}\; + {{\dot m}_{\inf }}{C_{f,\infty }} + {{\dot m}_{sys}}{C_{f,sys}} + \sum\limits_j {{h_j}\rho {A_j}} \frac{{{C_{s,j}}}}{{{k_j}}}}}{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} \; + {{\dot m}_{\inf }} + {{\dot m}_{sys}} + {\rho_{air}}\sum\limits_i^{{N_{{\rm{sink}}}}} {{R_{f,i}} + \sum\limits_j {{h_j}\rho {A_j}} } }}} \right]*\\\;\;\;\;\;\;\;\;\;\exp \left[ { - \frac{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}} + {\rho_{air}}\sum\limits_i^{{N_{{\rm{sink}}}}} {{R_{f,i}} + \sum\limits_j {{h_j}\rho {A_j}} } }}{{{\rho_{air}}{V_Z}{M_{FOR}}}}\delta t} \right] + \\\;\;\;\;\;\;\;\;\frac{{\sum\limits_{i = 1}^{{N_{source}}} {{\rho_{air}}{G_{f,i}}*{{1.0}^6}}  + \sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}} {C_{f,z,i}}\; + {{\dot m}_{\inf }}{C_{f,\infty }} + {{\dot m}_{sys}}{C_{f,sys}} + \sum\limits_j {{h_j}\rho {A_j}} \frac{{{C_{s,j}}}}{{{k_j}}} + {S_f}}}{{\sum\limits_{i = 1}^{{N_{zones}}} {{{\dot m}_i}}  + {{\dot m}_{\inf }} + {{\dot m}_{sys}} + {\rho_{air}}\sum\limits_i^{{N_{{\rm{sink}}}}} {{R_{f,i}} + \sum\limits_j {{h_j}\rho {A_j}} } }}\end{array}$$</div>

The above solutions are implemented in the Correct Zone Air Generic Contaminant step in the Zone Contaminant Predictor Corrector module of EnergyPlus.

Zone Air Mass Flow Conservation
-------------------------------

The zone air mass flow conservation object is intended to trigger zone air mass flow balance calculations.  This feature is available for zones defined in an air loop only and requires that zone mixing objects is defined.  If there are no zone mixing flows to adjacent zones, then the zone air mass flow is balanced by setting the Zone Mixing objects mass flow rate to zero. If there are no zone exhaust fans defined and there are no zone mixing objects specified, then a zone in an air loop is always balanced.  The zone simple flow objects (ventilation, ZoneCrossMixing etc.) with exception of zone mixing and infiltration are assumed to be self-balanced hence are not included in the zone air mass flow conservation calculation. Infiltration objects air mass flow is included in the zone air mass flow balance of zones that serve only as a source zone of zone mixing objects. And the infiltration mass flow rate used may be adjusted from the value calculated based on user inputs for zone air mass flow balance purpose. The zone air mass flow conservation equation includes: supply air flow rates, return air flow rates, zone exhaust fan flow rates, zone mixing objects flow rates and infiltration object flow rates. However, infiltration objects air mass flow rate are used to balance source zones only. Infiltration air mass flow is included in the zone air mass flow conservation only when the source zone supply air flow rate is not large enough to offset the source mass flow rate. A particular zone can be a source zone, receiving zone, or both depending on the number of ZoneMixing objects specified for that zone. Zone air mass flow balance calculation is performed when user specifies an optional object “ZoneAirMassFlowBalance” and set the input field “***Adjust Zone Mixing For Zone Air Mass Flow Balance***” to “Yes” and zones have at least one ZoneMixing object defined.  A zone may have multiple zone mixing objects connecting adjacent zones.  Zone air mass flow balance calculation is two steps procedure.  The modified return air mass flow rate calculation is given by:





<div>$${\dot m_R} = MAX\left( {0.0,\,{{\dot m}_S} + {{\dot m}_{XR}} - {{\dot m}_{EX}} - {{\dot m}_{XS}}} \right)$$</div>





where,

<span>${\dot m_R}$</span>   =    zone return air mass flow rate, (kg/s)

<span>${\dot m_{EX}}$</span>  =    zone exhaust air mass flow rate from exhaust fans, (kg/s)

<span>${\dot m_{XR}}$</span>  =    zone mixing mass flow rate as a receiving zone, (kg/s)

<span>${\dot m_{XS}}$</span>  =    zone mixing mass flow rate as a source zone, (kg/s)

<span>${\dot m_S}$</span>   =    zone supply air mass flow rate, (kg/s)





Figure 8 illustrates the zone mass flow components for an air loop system providing conditioned air to the two zones connected with a zone mixing object. Since Zone 1 is a source zone only, infiltration object is defined for zone 1 only.  The zone mixing object air flow rate depends on the user specified values and the zone air mass flow balance requirements.  When required the zone mixing object flow rate is adjusted from the user specified value for balancing purpose.



![](EngineeringReference/media/image134.svg.png)



Figure 8. Illustration of zone air mass flow balance components



Individual zone may be a source zone for multiple receiving zones, and at the same time the same source zone may receive mixing flows from multiple adjacent zones in an air loop.  The source and receiving mass flow rates of ZoneMixing objects are calculated from user defined mixing flow rates at the first HVAC iteration for each time step and adjusted in subsequent iterations to balance the zone air mass flow. The source zone mixing mass flow rate is calculated by tracking the mass flow rates of ZoneMixing objects connected to a zone and is given by:



<div>$${\dot m_{XS}} = \sum\nolimits_j {{{\dot m}_{XS,j}}} $$</div>



Determine the zone return air mass flow rate as follows:



<div>$${\dot m_R} = MAX\left( {0.0,\,{{\dot m}_S} + {{\dot m}_{XR}} - {{\dot m}_{EX}} - {{\dot m}_{XS}}} \right)$$</div>



Adjust the zone mixing mass flow rates based on the current zone return air mass flow rate as follows:



<div>$${\dot m_{XR,\,new}} = {\dot m_R} + {\dot m_{EX}} + {\dot m_{XS}} - {\dot m_S}$$</div>



Then this updated receiving zone mixing air mass flow rate is distributed to the mixing objects connected to the current zone proportional to user specified design flow rate. A single zone may be connected to more than one adjacent zone using multiple ZoneMixing objects.  Thus, the mixing flow rate of each contributing mixing objects defined in the current zone is updated as follows:



<div>$${\dot m_{XR,\,new,j}} = \left( {{{\dot m}_{XR,jDesign}}/{{\dot m}_{XR,Design}}} \right) \cdot {\dot m_{XR,\,new}}$$</div>



Zones serving as a source zone only are allowed to draw outside air using infiltration object.   Outdoor air is drawn via infiltration objects to replenish the the zone and when the zone’s return air flow rates is zero. The infiltration air mass flow rate is determined as follows:



<div>$${\dot m_{Inf}} = {\dot m_{XS}} + {\dot m_{EX}} - {\dot m_S}$$</div>

<div>$${\dot m_R} = 0;$$</div>



This infiltration air mass flow rate calculated is either added to the base infiltration air flow, which is calculated from user inputs, or overrides the base infiltration air flow depending on user choice. The two user Key choice inputs for Source Zone Infiltration Treatment are “**AddInfiltrationFlow**” and “**AdjustInfiltrationFlow**”.



There is an additional constraint to the return air mass flow rate calculation.  The sum of the return air mass flow rates of zones in air loop must satisfy the air loop return air mass flow balance.  The above four sets of equations are iterated for each zone in an air loop until the convergence criterion is satisfied or until the maximum iteration limit is exceeded.



The mass conservation calculations are performed in routine CalcZoneMassBalance in ZoneEquipmentManager module. The latest ZoneMixing object flow rate is communicated back to the zone air heat balance terms. This is done by re-simulating the simple flow objects as zone equipment during each HVAC iteration.  This requires calling the routine “CalcAirFlowSimple” in “SimZoneEquipment” routine as a zone equipment.



*Zone Mass Conservation Convergence*

The zone mass conservation calculation convergence criterion is based on the absolute difference of the zone mixing objects mass flow rates between successive iteration.  If the difference is above tolerance limits of 0.00001 then the HVAC Air loop is simulated again.





Summary of Time Marching Solution
---------------------------------

EnergyPlus models building performance over time spans of days to years using a time marching method based on *timesteps*. This section provides more information on issues related to timestep formulation.

### Summary of Timestep Model Formulation

An EnergyPlus simulation covers a certain period of time, such as a day or a year, that is broken down into a series of discrete bins of time that are referred to as *timesteps*. The program marches through time by recalculating model equations at each timestep. The figure below diagrams some of these basic concepts.

![TimeStepDataDefn](EngineeringReference/media/image141.png)

Figure 9. Diagram of TimeStep Formulation

Most models in EnergyPlus are quasi-steady energy balance equations used to predict the conditions present during each timestep. Various input data and boundary conditions for the models are time-varying and a “staircase” approach is used where such values are determined for a particular timestep and then essentially held constant over the entire timestep. Predictions for state variables, such as temperature, are averages over the timestep. Predictions for summed variables, such as energy use, are simple totals over the timestep.

EnergyPlus produces time-series results for selected output variables at selected frequencies. The time values associated with the time-series data, or timestamps, are output for the end of the timestep, but the values of the variables are for the entire bin of time prior to the timestamp. When data are reported at coarser frequencies such as hourly, then the results are averages or simple totals for all the timesteps that are contained within the larger bin of time.

To simplify solutions that would otherwise need to be simultaneous, models sometimes use data that are “lagged” which means that the values used in the calculations for the current timestep are actually results from the previous timestep. Many models just use the most current results available and so may use lagged data for a first iteration, but then use current data that are not lagged for subsequent iterations.

### Zone Update Method

A zone is not necessarily a single room but is usually defined as a region of the building or a collection of rooms subject to the same type of thermal control and having similar internal load profiles that, subsequently, can be grouped together. Zones can interact with each other thermally through adjacent surfaces and by intermixing of zone air. In EnergyPlus, the conditions in each zone are updated by Equation , which uses previously calculated values of the zone conditions. This means that EnergyPlus does not have to iterate to find a self-consistent solution of the updated zone conditions. However, because heat transfer through each zone's surfaces and interzone mixing of air still occur, the new space temperatures must be computed at the same simulation time and on the same time step in all zones, even though conditions in one zone may be changing much more rapidly than conditions in the other zones. We have previously documented the method used to update the zone temperature at each time step. This method, called the predictor corrector method, has proved to be satisfactory over a wide range of conditions.

### Variable Timestep

The need for a variable timestep in EnergyPlus was identified during development of its predecessor IBLAST. Prior to the integration of the central plant simulation in IBLAST, a time step Dt for the zone temperature update of 0.25 hours (15 minutes) was found to give stable results without a large increase in computation time. The first step in integrating plant was to implement the detailed coil models and coil control strategies without actually adding the plant models themselves. This meant that the user had to specify the coil water inlet temperature and the maximum coil inlet water flow rate to run the simulation. The real life analogy would be a chiller of very large, though not infinite, capacity. The coil capacity was controlled by adjusting the water flow rate, but the effect of the plant on the chilled water temperature was eliminated. After implementation of this step, experience with the program showed that updating the zone temperatures on a fixed time step frequently resulted in instabilities unless a very short time step was used. However, as the time step got shorter the time required to execute the program got prohibitively high.

Clearly, an adaptive time step was required. This would shorten the time step to maintain stability of the zone air energy balance calculation when zone conditions were changing rapidly and expand it to speed computation when zone conditions were relatively unchanging. But, the adaptive time step could not be applied easily to the surface heat transfer calculations, even using interpolation methods to determine new temperature and flux histories. The problem of updating the zone temperature was resolved by using a two-time-step approach in which the zone air temperature is updated using an adaptive time step that ensures stability. In this two time level scheme, the contributions to the zone loads from the surfaces, and user specified internal loads are updated at the default or user specified time step that is constant. This is often referred to as the “zone” time step. The contributions to the zone loads from HVAC system response, infiltration, and air mixing are updated at a second variable time step, referred to as the “system” time step. The system time step is limited to between one minute and the zone time step. The lower limit of the system time step can be increased to larger than one minute by the user with a System Convergence Limits object (which may be useful to decrease simulation run times at the expense of some accuracy).

The program’s decision to adapt the time step is made by first using the usual zone time step and executing the full predictor-corrector calculations to find resulting zone temperatures. The maximum temperature change experienced by any zone in the model is determined. If this maximum zone temperature change is more than a preset limit of 0.3°C, then the simulation switches to using the shorter system time step. The number of system time steps (within a particular zone time step) is modeled from the results for the maximum zone temperature change (just obtained from the corrector) by assuming that temperature change is linear.  The number of system time steps indicated by the temperatures is:

<div>$$\left( {\frac{{Maximum{\kern 1pt} \;Zone\;Temperature\;Change}}{{Maximum\;Zone\;Temperature\;Difference\;\{ .3C\} }}} \right) + 1.0$$</div>

The limit for the number of system time steps is:

<div>$$\left( {\frac{{Zone\;Time\;Step}}{{Minimum\;System\;Time\;Step}}} \right)$$</div>

EnergyPlus takes the smallest of these two, truncates them to a whole number and calculates a system time step as:

<div>$$System\;Time\;Step = \left( {\frac{{Zone\;Time\;Step}}{{Number\;of\;System\;Time\;Steps}}} \right)$$</div>

The same length of time is used for all the system time steps within a particular zone time step, but the system time step length can vary between different zone time steps. Report variables that use the “detailed” frequency show results at the system time step time scale.

This approach can be justified because the internal loads and surface temperatures vary on a different and longer time scale than the system response and the zone air temperature.

When the simulation down-steps from using the zone time step to the system time step, linear interpolation is used to generate zone condition history terms:

<div>$$
 \begin{array}{l}
  T_z^{t-\delta t} \\
  T_z^{t-2\delta t} \\
  T_z^{t-3\delta t}
 \end{array}
$$</div>

for the system time steps using the history data for the zone time step. If two consecutive zone time steps both down-step to have the same number of system time steps, then the system time step history is preserved and used directly rather than being interpolated from zone time step history. The zone temperature update is made for each system time step using the same equation as for the zone time step except that the zone temperature history and time difference (delta-t) terms are for the system time step instead of for the zone time step.

### Simultaneous Solution of Plant/System Water Loop

Simultaneous solution of the system and plant operating parameters required that the temperature of the water entering the coils must be the same as the temperature leaving the chillers or boilers. In addition, the temperature of the return water from the coils must be equal to the chiller or boiler entering water temperature. In practice so long as the plant is not out of capacity the leaving water temperature from chillers and boilers is constant and equal to the design value. No iteration was required to match system and plant boundary conditions. However, if either the chiller or boiler plant was overloaded then the temperature of the water leaving the plant was not equal to the design value and the maximum output of the plant could change because of the off-design conditions. An iterative scheme using the secant method to predict successive updates to the plant leaving water conditions was therefore employed to solve for the water loop conditions with the plant operating at its maximum capacity. The simulation of the system and plant loops is described in greater detail in the later sections.

### References

Ceylan, H. T., and G. E. Myers. 1980. Long-time Solutions to Heat Conduction Transients with Time-Dependent Inputs. ASME Journal of Heat Transfer, Volume 102, No. 1, pp. 115-120.

Hittle, D. C. 1979. Calculating Building Heating and Cooling Loads Using the Frequency Response of Multilayered Slabs, Ph.D. Thesis, University of Illinois, Urbana, IL.

Hittle, D. C., and R. Bishop. 1983. An Improved Root-Finding Procedure for Use in Calculating Transient Heat Flow Through Multilayered Slabs. International Journal of Heat and Mass Transfer, Vol. 26, No. 11, pp. 1685-1693.

Ouyang, K., and F. Haghighat. 1991. A Procedure for Calculating Thermal Response Factors of Multi-layered Walls--State Space Method. Building and Environment, Vol. 26, No. 2, pp. 173-177.

Seem, J. E. 1987. Modeling of Heat Transfer in Buildings, Ph.D. Thesis, University of Wisconsin, Madison, WI.

Strand, R. K. 1995. Heat Source Transfer Functions and Their Application to Low Temperature Radiant Heating Systems, Ph.D. Thesis, University of Illinois, Urbana, IL.

Taylor, R. D., C.O. Pedersen, L.K. Lawrie. 1990. *Simultaneous Simulation of Buildings and Mechanical Systems in Heat Balance Based Energy Analysis Programs*, Proceedings of the 3rd International Conference on System Simulation in Buildings, Liege, Belgium, December 3-5, 1990.

Taylor, R.D., C.O. Pedersen, D.E. Fisher, R. J. Liesen, L.K. Lawrie. 1991. Impact of Simultaneous Simulation of Buildings and Mechanical Systems in Heat Balance Based Energy Analysis Programs on System Response and Control, Conference Proceedings IBPSA Building Simulation '91, Nice, France, August 20-22, 1991.



Surface Heat Balance Manager / Processes
========================================

Conduction Through The Walls
----------------------------

### Conduction Transfer Function Module

The most basic time series solution is the response factor equation which relates the flux at one surface of an element to an infinite series of temperature histories at both sides as shown by Equation :

<div>$${q''_{ko}}(t) = \sum\limits_{j = 0}^\infty  {{X_j}} {T_{o,t - j\delta }} - \sum\limits_{j = 0}^\infty  {{Y_j}} {T_{i,t - j\delta }}$$</div>

where q” is heat flux, T is temperature, i signifies the inside of the building element, o signifies the outside of the building element, t represents the current time step, and X and Y are the response factors.

While in most cases the terms in the series decay fairly rapidly, the infinite number of terms needed for an exact response factor solution makes it less than desirable.  Fortunately, the similarity of higher order terms can be used to replace them with flux history terms.  The new solution contains elements that are called conduction transfer functions (CTFs).  The basic form of a conduction transfer function solution is shown by the following equation:

<div>$${q''_{ki}}(t) =  - {Z_o}{T_{i,t}} - \sum\limits_{j = 1}^{nz} {{Z_j}} {T_{i,t - j\delta }} + {Y_o}{T_{o,t}} + \sum\limits_{j = 1}^{nz} {{Y_j}} {T_{o,t - j\delta }} + \sum\limits_{j = 1}^{nq} {{\Phi_j}{{q''}_{ki,t - j\delta }}} $$</div>

for the inside heat flux, and

<div>$${q''_{ko}}(t) =  - {Y_o}{T_{i,t}} - \sum\limits_{j = 1}^{nz} {{Y_j}} {T_{i,t - j\delta }} + {X_o}{T_{o,t}} + \sum\limits_{j = 1}^{nz} {{X_j}} {T_{o,t - j\delta }} + \sum\limits_{j = 1}^{nq} {{\Phi_j}{{q''}_{ko,t - j\delta }}} $$</div>

for the outside heat flux (q²=q/A)

where:

X*<sub>j</sub>*  = Outside CTF coefficient, j= 0,1,...nz.

Y*<sub>j</sub>* = Cross CTF coefficient, j= 0,1,...nz.

Z*<sub>j</sub>* = Inside CTF coefficient, j= 0,1,...nz.

F*<sub>j</sub>* = Flux CTF coefficient, j = 1,2,...nq.

T*<sub>i</sub>* = Inside face temperature

T*<sub>o</sub>* = Outside face temperature

<span>${q''_{ko}}$</span> = Conduction heat flux on outside face

<span>$q''$</span> = Conduction heat flux on inside face

The subscript following the comma indicates the time period for the quantity in terms of the time step d.  Note that the first terms in the series (those with subscript 0) have been separated from the rest in order to facilitate solving for the current temperature in the solution scheme.  These equations state that the heat flux at either face of the surface of any generic building element is linearly related to the current and some of the previous temperatures at both the interior and exterior surface as well as some of the previous flux values at the interior surface.

The final CTF solution form reveals why it is so elegant and powerful.  With a single, relatively simple, linear equation with constant coefficients, the conduction heat transfer through an element can be calculated.  The coefficients (CTFs) in the equation are constants that only need to be determined once for each construction type.  The only storage of data required are the CTFs themselves and a limited number of temperature and flux terms.  The formulation is valid for any surface type and does not require the calculation or storage of element interior temperatures.

### Calculation of Conduction Transfer Functions

The basic method used in EnergyPlus for CTF calculations is known as the state space method (Ceylan and Myers 1980; Seem 1987; Ouyang and Haghighat 1991).  Another common, older method used Laplace transformations to reach the solution;  the Laplace method was  used in BLAST (Hittle, 1979; Hittle & Bishop, 1983).  The basic state space system is defined by the following linear matrix equations:

<div>$$\frac{{d\left[ {\bf{x}} \right]}}{{dt}} = \left[ {\bf{A}} \right]\left[ {\bf{x}} \right] + \left[ {\bf{B}} \right]\left[ {\bf{u}} \right]$$</div>

<div>$$\left[ {\bf{y}} \right] = \left[ {\bf{C}} \right]\left[ {\bf{x}} \right] + \left[ {\bf{D}} \right]\left[ {\bf{u}} \right]$$</div>

where x is a vector of state variables, u is a vector of inputs, y is the output vector, t is time, and A, B, C, and D are coefficient matrices.  Through the use of matrix algebra, the vector of state variables (x) can be eliminated from the system of equations, and the output vector (y) can be related directly to the input vector (u) and time histories of the input and output vectors.

This formulation can be used to solve the transient heat conduction equation by enforcing a finite difference grid over the various layers in the building element being analyzed.  In this case, the state variables are the nodal temperatures, the environmental temperatures (interior and exterior) are the inputs, and the resulting heat fluxes at both surfaces are the outputs.  Thus, the state space representation with finite difference variables would take the following form:

<div>$$
  \frac{d\left[\begin{array}{c}T_1 \\ \vdots \\ T_n\end{array}\right]}{dt} = \left[\bf{A}\right]\left[\begin{array}{c}T_1 \\ \vdots \\ T_n\end{array}\right]+\left[\bf{B}\right]\left[\begin{array}{c}T_i \\ T_o\end{array}\right]
$$</div>

<div>$$
  \left[\begin{array}{c}{q''}_i \\ {q''}_o\end{array}\right] = \left[\bf{C}\right]\left[\begin{array}{c}T_1 \\ \vdots \\ T_n\end{array}\right]+\left[\bf{D}\right]\left[\begin{array}{c}T_i \\ T_o\end{array}\right]
$$</div>

where T1, T2, ..., Tn-1, Tn are the finite difference nodal temperatures, n is the number of nodes, Ti and To are the interior and exterior environmental temperatures, and q"i and q"o are the heat fluxes (desired output).

Seem (1987) shows that for a simple one layer slab with two interior nodes as in Figure 7 and convection at both sides the resulting finite difference equations are given by:

<div>$$C\frac{{d{T_1}}}{{dt}} = hA\left( {{T_o} - {T_1}} \right) + \frac{{{T_2} - {T_1}}}{R}$$</div>

<div>$$C\frac{{d{T_2}}}{{dt}} = hA\left( {{T_i} - {T_2}} \right) + \frac{{{T_1} - {T_2}}}{R}$$</div>

<div>$$q{``_i} = h\left( {{T_i} - {T_2}} \right)$$</div>

<div>$$q{``_o} = h\left( {{T_1} - {T_o}} \right)$$</div>

where:

<span>$R = \frac{\ell }{{kA}}$</span>,

<span>$C = \frac{{\rho {c_p}\ell A}}{2}$</span>, and

A is the area of the surface exposed to the environmental temperatures.

In matrix format:

<div>$$
  \left[\begin{array}{c}\frac{dT_1}{dt} \\ \frac{dT_2}{dt}\end{array}\right] = 
     \left[\begin{array}{cc}-\frac{1}{RC}-\frac{hA}{C} & \frac{1}{RC} \\ \frac{1}{RC} & -\frac{1}{RC}-\frac{hA}{C}\end{array}\right]\left[\begin{array}{c}T_1 \\ T_2\end{array}\right] + 
     \left[\begin{array}{cc}\frac{hA}{C} & 0 \\ 0 & \frac{hA}{C}\end{array}\right]\left[\begin{array}{c}T_o \\ T_i\end{array}\right]
$$</div>

<div>$$
  \left[\begin{array}{c}{q''}_o \\ {q''}_i\end{array}\right] = 
    \left[\begin{array}{cc}0 & -h \\ h & 0\end{array}\right] \left[\begin{array}{c}T_1 \\ T_2\end{array}\right] +
    \left[\begin{array}{cc}0 & h \\ -h & 0\end{array}\right] \left[\begin{array}{c}T_o \\ T_i\end{array}\right]
$$</div>

![](EngineeringReference/media/image168.svg.png)

Figure 10.  Two Node State Space Example.

The important aspect of the state space technique is that through the use of matrix algebra the state space variables (nodal temperatures) can be eliminated to arrive at a matrix equation that gives the outputs (heat fluxes) as a function of the inputs (environmental temperatures) only.  This eliminates the need to solve for roots in the Laplace domain.  In addition, the resulting matrix form has more physical meaning than complex functions required by the Laplace transform method.

The accuracy of the state space method of calculating CTFs has been addressed in the literature.  Ceylan and Myers (1980) compared the response predicted by the state space method to various other solution techniques including an analytical solution.  Their results showed that for an adequate number of nodes the state space method computed a heat flux at the surface of a simple one layer slab within 1% of the analytical solution.  Ouyang and Haghighat (1991) made a direct comparison between the Laplace and state space methods.  For a wall composed of insulation between two layers of concrete, they found almost no difference in the response factors calculated by each method.

Seem (1987) summarizes the steps required to obtain the CTF coefficients from the A, B, C, and D matrices.  While more time consuming than calculating CTFs using the Laplace Transform method, the matrix algebra (including the calculation of an inverse and exponential matrix for A) is easier to follow than root find algorithms.  Another difference between the Laplace and State Space methods is the number of coefficients required for a solution.  In general, the State Space method requires more coefficients.  In addition, the number of temperature and flux history terms is identical (nz=nq).  Note that as with the Laplace method that the actual number of terms will vary from construction to construction.

Two distinct advantages of the State Space method over the Laplace method that are of interest when applying a CTF solution for conduction through a building element are the ability to obtain CTFs for much shorter time steps and the ability to obtain 2- and 3-D conduction transfer functions.  While not implemented in the Toolkit, both Seem (1987) and Strand (1995) have demonstrated the effectiveness of the State Space method in handling these situations that can have important applications in buildings.

### Conduction Transfer Function (CTF) Calculations in EnergyPlus

Conduction transfer functions are an efficient method to compute surface heat fluxes because they eliminate the need to know temperatures and fluxes within the surface.  However, conduction transfer function series become progressively more unstable as the time step decreases.  This became a problem as investigations into short time step computational methods for the zone/system interactions progressed because, eventually, this instability caused the entire simulation to diverge.  This phenomenon was most apparent for thermally massive constructions with long characteristic times and, correspondingly, requiring a large number of terms in the CTF series. This indicates that the problem is related to round-off and truncation error and is in no way an indictment of the CTF method itself.  Methods that develop CTF series from finite difference approximations to the heat conduction equation (Meyers, 1980; Seem, 1987) were considered to address this problem.  Seem's method did give better accuracy and stability at short time steps than the current BLAST technique but, the method still had difficulty computing stable CTF series for time steps of less than 1/4 hour for the heaviest constructions in the BLAST library.

The zone heat gains consist of specified internal heat gains, air exchange between zones, air exchange with the outside environment, and convective heat transfer from the zone surfaces.  Of these, the surface convection load requires the most complicated calculations because a detailed energy balance is required at the inside and outside surface of each wall, floor, and roof.  In addition, the transient heat conduction in the material between the surfaces must be solved.  This solution gives the inside and outside temperatures and heat fluxes that must be known in order to calculate the convection component to the zone load for each zone surface.  BLAST uses a conduction transfer function CTF method attributed to Hittle (1980) to solve the transient conduction problem for each surface.  The method results in a time series of weighting factors that, when multiplied by previous values of the surface temperatures and fluxes and the current inside and outside surface temperatures, gives the current inside and outside heat flux.  The method is easily applied to multilayered constructions for which analytical solutions are unavailable.  In addition, determining the series of CTF coefficients is a one-time calculation, making the method much faster than finite difference calculations.

A problem with CTF methods is that the series time step is fixed; that is, a CTF series computed for a one hour time step takes information at t-1 hours, t-2 hours, etc. and computes conditions at the current time t.  As time advances the oldest term in the input series is dropped and the data moved back one time step to allow the newest value to be added to the series.  For convenience, the time step used to determine the CTF series should be the same as the time step used to update the zone mean air temperature in the zone energy balance.  But, as the time step used to calculate the CTF series gets shorter, the number of terms in the series grows.  Eventually, with enough terms, the series becomes unstable due to truncation and round-off error.  Heavy constructions, such as slab-on-grade floors (12" heavyweight concrete over 18" dirt), have accuracy and stability problems at time steps as large as 0.5 hours when modeled by Hittle's CTF method.  In an attempt to overcome this problem, Hittle's method was replaced by Seem's method (1987) in IBLAST.  This resulted in some improvement in stability at shorter time steps, but not enough to allow IBLAST to run at a 0.1 hour time step without restricting the types of surfaces that could be used.

Even though CTF methods require that values of the surface temperatures and fluxes be stored for only a few specific times before the current time, the temperature and flux histories are, actually, continuous functions between those discrete points.  However, there is no way to calculate information at these intermediate times once a series has been initialized.  The terms in the temperature and flux histories are out of phase with these points.  However, they can be calculated by shifting the phase of the temperature and flux histories by only a fraction of a time step.  This procedure would allow a CTF series computed for a time step Dt, to be used to compute information at times t+Dt/2, t+Dt/3, t+Dt/4, or any other arbitrary fraction of the time step, so long as the surface temperatures and flux values were still Dt apart.  Several ways of doing this are described below.

The method shown in the Figure 11 maintains two sets of histories out of phase with each other.  The figure shows how this would work for two sets of histories out of phase by one half of a time step.  More sets of temperature and flux histories could be used, allowing the simulation time step to take on values: 1/3, 1/4, 1/5, etc., of the minimum time step allowed for the CTF calculations.  The time step between inputs to the CTF series would be the smallest convenient interval at which the CTF series is stable.  This scenario is illustrated in this figure for two separate sets of temperature and flux histories.  Cycling through each history, in order, allowed calculations of the zone energy balance to be performed with updated surface information at a shorter time step than one CTF history series would otherwise allow.  This method required no interpolation between the series once each set of histories was initialized.  However, if the smallest time step for a stable CTF series was large compared to the zone temperature update time step, significant memory was required to store all the sets of histories.

![](EngineeringReference/media/image169.svg.png)

Figure 11. Multiple, staggered time history scheme

Another method is shown in Figure 12. Sequential interpolation of new histories that uses successive interpolations to determine the next set of temperature and flux histories.  The current history is interpolated directly from the previous history set using the required time phase shift between the two.  This method required permanent storage for only one set of temperature and flux histories at a time, but smoothed out temperature and flux data as more interpolations were performed.  As a result, at concurrent simulation times current values of history terms were different form previous "in phase" history terms.  This was unacceptable from, a physical point of view, because it allowed current information to change data from a previous time.

![](EngineeringReference/media/image170.svg.png)

Figure 12. Sequential interpolation of new histories

A final method, shown in Figure 13. Master history with interpolation, was something of a hybrid of the previous two methods.  One "master" history set was maintained and updated for all time; this solved the problem of current events propagating information backwards in time.  When surface fluxes needed to be calculated at times out of phase with this master history a new, temporary history was interpolated from the master values.  This method proved to be the best of the three options described because it eliminated propagation of information backwards in time and only required concurrent storage of two sets of temperature and flux histories. This method was subsequently incorporated into the IBLAST program in conjunction with Seem's procedure for calculating the coefficients of the CTF series.

![](EngineeringReference/media/image171.svg.png)

Figure 13. Master history with interpolation

### Conduction Transfer Function (CTF) Calculations Special Case: R-Value Only Layers

Most users will elect to enter materials with four parameters that are of interest for calculating conduction transfer functions: thickness, conductivity, density, and specific heat.  For these materials, EnergyPlus will divide each material layer within a construction into between 6 and 18 nodes for the application of the state-space method.  For multi-layered constructions, nodes are also placed at the interface between two layers.  These interface nodes consist of half a node of the first layer and half a node of the second layer.

In some cases, either due to a lack of information or a desire to simplify input, a user may choose to enter a material layer as a “no mass” or “R-Value only” material.  This assumption essentially says that these layers add nothing to the thermal mass of the overall construction and only add to the overall resistance or R-Value of the construction as a whole.  While this is not recommended, it is allowed and in some cases is not a poor assumption for extremely lightweight materials such as some types of insulation.

In the past, when a user enters such a “no mass” material into EnergyPlus, internally the properties of this layer are converted to approximate the properties of air (density, specific heat, and conductivity) with the thickness adjusted to maintain the user’s desired R-Value.  This allowed such layers to be handled internally in the same way as other layers without any additional changes to the code.  This solution was deemed accurate enough as air has very little thermal mass and it made the coding of the state space method simpler.

It is possible to account for layers that have no thermal mass in the state space solution without resorting to the assignment of fictitious material properties.  The EnergyPlus internal equations for assigning values to portions of the A, B, C, and D matrices as shown in the previous subsections have been altered to account for the potential presence of R-Value only (or no mass) layers without resorting to assigning these materials the properties of air.  This is handled by assuming that the “no mass” layer is a single node layer.  As nodes are defined that the interface between material layers, the “no mass” layer is essentially two “half nodes” that are shared with the surrounding layers.  This allows the surrounding material layers to provide thermal capacitance for each of the nodes at the material interfaces.

In EnergyPlus, there are two possible cases for the existence of “no mass” layers: either between two other solid, thermally massive layers (multiple “no mass” layers next to each other are simply combined in this approach) or at the inner or outer most layers of a construction.  There are potential issues with having a resistance-only layer at either the inner or outer most layers of a construction.  A little or no mass layer there could receive intense thermal radiation from internal sources or the sun causing the temperature at the inner or outer surface to achieve very high levels.  This is undesirable from a simulation standpoint as there are limits to temperature levels in EnergyPlus that could be exceeded causing the simulation to terminate and is likely unrealistic from a real-world perspective.  Thus, for such potentially problematic calculational scenarios, EnergyPlus will continue to convert a “no mass” layer at either the inner or outer most layer of a construction into a thermal mass layer using the properties of air as has been done in the past.

The case where a resistance-only layer is defined anywhere except the inner or outer layer of a construction is handled by treating the “no mass” layer as a single node layer.  This will result in a node at each interface as in the standard material layer cases.  When a “no mass” material is present, the R-Value only layer will not add any thermal capacitance to the nodes at the interfaces at either side of the material.  It will simply add resistance between the two nodes.

![](EngineeringReference/media/image172.png)

Figure 14. Illustration of no-mass layer between two mass layers

From the EnergyPlus code, the A matrix (AMat) is assigned with values at the interface using the following equations (taken from the actual code):

````
cap = ( rho(Layer)\*cp(Layer)\*dx(Layer) + rho(Layer+1)\*cp(Layer+1)\*dx(Layer+1) ) \* 0.5D0
AMat(Node,Node-1) = rk(Layer)/dx(Layer)/cap           ! Assign matrix values for the current node
AMat(Node,Node)   = -1.0D0 \* ( rk(Layer)/dx(Layer)+rk(Layer+1)/dx(Layer+1) ) / cap
AMat(Node,Node+1) = rk(Layer+1)/dx(Layer+1)/cap       ! node.
````

Note that these equations do not change.  For “no mass” layers, the density (rho) and the specific heat (cp) variables will be assigned zero values.  In addition, the thickness (dx) will be equated with the user-defined R-Value and conductivity (rk) will be assigned a value of unity.  In addition, the number of nodes for the “no mass” layer will be set to 1.

This handles resistive layers correctly without resorting to assigning the properties of air to the “no mass” layer.  The only potential problem with this is if two resistive layers are placed next to each other.  In that case, the interface between the two resistive layers would have no mass (variable “cap” would equal zero) and a divide by zero would result.  To avoid this, adjacent “no mass” layers are combined internally so that the user does not have to do this and also to avoid any divide by zero errors.

While from a results standpoint, the difference in output between assigning air properties for specific heat, density, etc. and handling the no mass materials explicitly is negligible, handling the no mass layers properly does provide better code efficiency from a calculation speed standpoint.

### References

Ceylan, H. T., and G. E. Myers. 1980. Long-time Solutions to Heat Conduction Transients with Time-Dependent Inputs. ASME Journal of Heat Transfer, Volume 102, No. 1, pp. 115-120.

Hittle, D. C. 1979. Calculating Building Heating and Cooling Loads Using the Frequency Response of Multilayered Slabs, Ph.D. Thesis, University of Illinois, Urbana, IL.

Hittle, D. C., and R. Bishop. 1983. An Improved Root-Finding Procedure for Use in Calculating Transient Heat Flow Through Multilayered Slabs. International Journal of Heat and Mass Transfer, Vol. 26, No. 11, pp. 1685-1693.

Ouyang, K., and F. Haghighat. 1991. A Procedure for Calculating Thermal Response Factors of Multi-layered Walls--State Space Method. Building and Environment, Vol. 26, No. 2, pp. 173-177.

Seem, J. E. 1987. Modeling of Heat Transfer in Buildings, Ph.D. Thesis, University of Wisconsin, Madison, WI.

Strand, R. K. 1995. Heat Source Transfer Functions and Their Application to Low Temperature Radiant Heating Systems, Ph.D. Thesis, University of Illinois, Urbana, IL.

Taylor, R. D., C.O. Pedersen, D.E. Fisher, R. J. Liesen, L.K. Lawrie. 1990. *Simultaneous Simulation of Buildings and Mechanical Systems in Heat Balance Based Energy Analysis Programs*, Proceedings of the 3rd International Conference on System Simulation in Buildings, Liege, Belgium, December 3-5, 1990.

Taylor, R.D., C.O. Pedersen, D.E. Fisher, R. J. Liesen, L.K. Lawrie. 1991. Impact of Simultaneous Simulation of Buildings and Mechanical Systems in Heat Balance Based Energy Analysis Programs on System Response and Control, Conference Proceedings IBPSA Building Simulation '91, Nice, France, August 20-22, 1991.

Conduction Finite Difference Solution Algorithm
-----------------------------------------------

### Basic Finite Difference Solution Approach

EnergyPlus models follow fundamental heat balance principles very closely in almost all aspects of the program. However, the simulation of building surface constructions has relied on a conduction transfer function (CTF) transformation carried over from BLAST. This has all the usual restrictions of a transformation-based solution: constant properties, fixed values of some parameters, and do not produce results for the interior of the surface. As the energy analysis field moves toward simulating more advanced constructions, such as phase change materials (PCM), it becomes necessary to step back from transformations to more fundamental forms. Accordingly, a conduction finite difference (CondFD) solution algorithm has been incorporated into EnergyPlus. This does not replace the CTF solution algorithm, but complements it for cases where the user needs to simulate phase change materials or variable thermal conductivity. It is also possible to use the finite difference algorithm for zone time steps as short as one minute.

EnergyPlus includes two different options for the specific scheme or formulation used for the finite difference model.  The first scheme is referred to as Crank-Nicholson and was the formulation used in EnergyPlus prior to version 7.  As of version 7 a second scheme was added and is referred to as fully implicit.  The selection between the two can be made by the user with the HeatBalanceSettings:ConductionFiniteDifference input object.  Once selected, the same scheme is used throughout the simulation.  Although the two different schemes differ in their fundamental heat transfer equations, they share nearly all the same supporting models for material properties, data storage, solution schemes, and spatial discretization algorithms.

The Crank-Nicholson scheme is semi-implicit and based on an Adams-Moulton solution approach. It is considered second-order in time.  The algorithm uses an implicit finite difference scheme coupled with an enthalpy-temperature function to account for phase change energy accurately. The implicit formulation for an internal node is shown in the equation below.

<div>$$
  C_p \rho \Delta x \frac{T_i^{j+1}-T_i^j}{\Delta t} = 
     \frac{1}{2}\left(k_W\frac{T_{i+1}^{j+1}-T_{i}^{j+1}}{\Delta x} +
                      k_E\frac{T_{i-1}^{j+1}-T_{i}^{j+1}}{\Delta x} + 
                      k_W\frac{T_{i+1}^{j}-T_{i}^{j}}{\Delta x} +
                      k_E\frac{T_{i-1}^{j}-T_{i}^{j}}{\Delta x}\right)
$$</div>

Where:

T <sub>=</sub> node temperature

Subscripts:

i = node being modeled

i+1 = adjacent node to interior of construction

i-1 = adjacent node to exterior of construction

j+1 = new time step

j = previous time step

Dt = calculation time step

Dx = finite difference layer thickness (always less than construction layer thickness)

C<sub>p</sub> = specific heat of material

k<sub>w</sub> = thermal conductivity for interface between i node and i+1 node

k<sub>E</sub> = thermal conductivity for interface between i node and i-1 node

r  = density of material

Then, this equation is accompanied by a second equation that relates enthalpy and temperature.

<div>$${h_i} = HTF\left( {{T_i}} \right)$$</div>

where HTF is an enthalpy-temperature function that uses user input data.

The fully implicit scheme is also based on an Adams-Moulton solution approach. It is considered first order in time.  The model equation for this scheme is show in the following equation.

<div>$${C_p}\rho {\rm{\Delta x}}\frac{{T_i^{j + 1} - T_i^j}}{{{\rm{\Delta }}t}} = \left( {{k_W}\frac{{\left( {T_{i + 1}^{j + 1} - T_i^{j + 1}} \right)}}{{{\rm{\Delta x}}}} + {k_E}\frac{{\left( {T_{i - 1}^{j + 1} - T_i^{j + 1}} \right)}}{{{\rm{\Delta x}}}}} \right)$$</div>

For both schemes, EnergyPlus uses the following four types of nodes, as shown in the figure below (1) interior surface nodes, (2) interior nodes, (3) material interface nodes and (4) external surface nodes. The grid for each material is established by specifying a half node for each edge of a material and equal size nodes for the rest of the material. Equations such as are formed for all nodes in a construction. The formulation of all node types is basically the same.

![Description: C:\Griffith\AnalysisTools\CondFDpaper\Figures\Figures\Figure2.tif](EngineeringReference/media/image176.png)

Figure 15. Node depiction for Conduction Finite Difference Model

In the CondFD model, surface discretization depends on the thermal diffusivity of the material (α) and time step (Δt) selected, as shown in the equation below. The default value of 3 for the space discretization constant, *C*, is basically the inverse of the Fourier Number:

<div>$$
Fo = \frac{\alpha \Delta t}{\Delta x^2}
$$</div>

and is based on the stability requirement for the explicit mode that requires values higher than 2, or a Fourier number lower than 0.5. However, CondFD uses implicit schemes that do not have the same stability requirements as the explicit mode. Thus, the default 3 was originally set rather arbitrary.  As of version 7, the value of this constant can be controlled by the user with the input field called Space Discretization Constant in the HeatBalanceSettings:ConductionFiniteDifference input object.   The discretization method allows CondFD to assign different node spacing or grid size to different material layers in a wall or roof, as building walls and roofs typically consist of several layers of different materials having different thermal properties.

<div>$${\rm{\Delta x}} = \sqrt {{\rm{C\alpha \Delta t}}} $$</div>

The actual integer number of nodes for each layer is then calculated by rounding off the result from dividing the length of the material layer by the result of the equation above. After this, Δx is recalculated by dividing the length of the material by the number of nodes. A full node is equal to two half nodes. Lower values for the Space Discretization Constant yield more nodes, with higher values yield fewer nodes.

Because the solution is implicit, a Gauss-Seidell iteration scheme is used to update to the new node temperatures in the construction and under-relaxation is used for increased stability.  The Gauss-Seidell iteration loop is the inner-most solver and is called for each surface.  It is limited to 30 iterations but will exit early when the sum of all the node temperatures changes between the last call and the current call, normalized by the sum of the temperature values, is below  0.000001C. This convergence criteria is typically met after 3 iterations, except when PCMs are simulated as it takes an average of 2-3 more iterations when PCM are changing phase. If the number if iterations needed to met convergence criteria start to increase, an automatic internal relaxation factor stabilities the solution and in most cases keep the number of iterations less than 10.

EnergyPlus also uses a separate, outer iteration loop across all the different inside surface heat balances so that internal long-wave radiation exchange can be properly solved.  For CTF formulations, this iteration is controlled by a maximum allowable temperature difference of 0.002C for inside face surface temperatures from one iteration to the next (or a limit of 100 iterations). CondFD uses the same default value for allowable temperature difference as CTF. However, this parameter was found to often need to be smaller for stability and so the inside surface heat balance manager uses a separate allowable maximum temperature difference when modeling CondFD.  The user can control the value of the relaxation factor by using the input field called  Inside Face Surface Temperature Convergence Criteria in the HeatBalanceSettings:ConductionFiniteDifference input object. In addition, if the program detects that there is instability by watching for excessive numbers of iterations in this outer loop and may decrease the relaxation factor. Users can also output the number of iterations inside of CondFD loop for each surface and the outer internal heat balance loop for each zone with “CondFD Inner Solver Loop Iterations” and “Heat Balance Inside Surfaces Calculation Iterations” respectively.

<div>$${T_{i,new}} = {T_{i,old}} + \left( {{T_{i,new}} - {T_{i,old}}} \right)*Relax$$</div>

Because of the iteration scheme used for CondFD,  the node enthalpies get updated each iteration, and then they are used to develop a variable Cp if a phase change material is being simulated. This is done by including a third equation for Cp.

<div>$$Cp = \frac{{{h_{i,new}} - {h_{i,old}}}}{{{T_{i,new}} - {T_{i,old}}}}$$</div>

The iteration scheme assures that the correct enthalpy, and therefore the correct Cp is used in each time step, and the enthalpy of the material is accounted for accurately. Of course, if the material is regular, the user input constant Cp is used.

The algorithm also has a provision for including a temperature coefficient to modify the thermal conductivity. The thermal conductivity is obtained from:

<div>$$k = {k_o} + {k_1}\left( {{T_i} - 20} \right)$$</div>

where:

k<sub>o</sub> is the 20°C value of thermal conductivity (normal idf  input)

k<sub>1</sub> is the change in conductivity per degree temperature difference from 20°C

As of Version 7, the CondFD implementation was changed to evaluate the thermal conductivity at the interface between nodes, as shown below. In this case, EnergyPlus uses a linear interpolation between nodal points.

<div>$${C_p}\rho {\rm{\Delta x}}\frac{{T_i^{j + 1} - T_i^j}}{{{\rm{\Delta }}t}} = \frac{1}{2}\left[ {\left( {{k_W}\frac{{\left( {T_{i + 1}^{j + 1} - T_i^{j + 1}} \right)}}{{{\rm{\Delta x}}}} + {k_E}\frac{{\left( {T_{i - 1}^{j + 1} - T_i^{j + 1}} \right)}}{{{\rm{\Delta x}}}}} \right) + \left( {{k_W}\frac{{\left( {T_{i + 1}^j - T_i^j} \right)}}{{{\rm{\Delta x}}}} + {k_E}\frac{{\left( {T_{i - 1}^j - T_i^j} \right)}}{{{\rm{\Delta x}}}}} \right)} \right]$$</div>

Where,

<div>$${k_W} = \frac{{\left( {k_{i + 1}^{j + 1} + k_i^{j + 1}} \right)}}{2}$$</div>

<div>$${{\rm{k}}_{\rm{E}}} = \frac{{\left( {{\rm{k}}_{{\rm{i}} - 1}^{{\rm{j}} + 1} + {\rm{k}}_{\rm{i}}^{{\rm{j}} + 1}} \right)}}{2}$$</div>

These additional property information values are put into the input file as explained in the Input/Output Reference Document, but it consists simply of a value for k1 and set of enthalpy temperature pairs that describe the enthalpy of the phase change material in straight line segments with respect to temperature.

A graph showing the effect of a large PCM on the outside surface of a zone is shown below. The phase change temperature was 30°C, and the flat temperature response during the phase change is obvious. This example was run with a zone time step of one minute to show that such small time steps can be done with the finite difference solution technique. It is more efficient to set the zone time step shorter than those used for the CTF solution algorithm. It should be set to 20 time steps per hour or greater, and can range up to 60. The finite difference algorithm actually works better with shorter zone time steps. The computation time has a minimum at a zone time step around two minutes (30 time steps/hr), and increases for shorter or longer zone time steps.

![Description: Phase Change Graph OutsidePCM](EngineeringReference/media/image185.png)

Figure 16. Effects of Large PCM on Outside Zone Surface

### Finite Difference Node Arrangement in Surfaces

The Conduction Finite Difference algorithm determines the number of nodes in each layer of the surface based on the Fourier stability criteria.  The node thicknesses are normally selected so that the time step is near the explicit solution limit in spite of the fact that the solution is implicit. For very thin, high conductivity layers, a minimum of two nodes is used.  This means two half thickness nodes with the node temperatures representing the inner and outer faces of the layer. All thicker layers also have two half thickness nodes at their inner and outer faces. These nodes produce layer interface temperatures.

The ConductionFiniteDifferenceSimplified capability was removed as of Version 7.2.

### Conduction Finite Difference Variable Thermal Conductivity

The Conduction Finite Difference algorithm has also been given the capability to use an expanded thermal conductivity function. This function, explained in the input/output document, is similar to the temperature enthalpy function. It consists of pairs of temperature and thermal conductivity values that form a linear segmented function. It is established with the MaterialProperty:VariableThermalConductivity object.

### Conduction Finite Difference Source Sink Layers

The Conduction Finite Difference algorithm can also invoke the source/sink layer capability by using the **Construction:InternalSource** object.

### References

Pedersen C.O., Enthalpy Formulation of conduction heat transfer problems involving latent heat, Simulation, Vol 18, No. 2, February 1972

Versteeg, H. and Malalasekra, W. 1996. An introduction to computational fluid dynamic: the finite volume method approach. Prentice Hall.

[Tabares-Velasco, P.C. and Griffith, B. 2012. Diagnostic Test Cases for Verifying Surface Heat Transfer Algorithms and Boundary Conditions in Building Energy Simulation Programs, Journal of Building Performance Simulation, doi:10.1080/19401493.2011.595501](../../../Documents%20and%20Settings/ptabares/My%20Documents/Paulo/CV/Tabares%20Velasco%20CV%20UPDATED2.doc)

Tabares-Velasco, P.C., Christensen, C. and Bianchi, M. 2012. Verification and Validation of EnergyPlus Phase Change Material Model for Opaque Wall Assemblies, Building and Environment 54: 186-196.

Combined Heat and Moisture Transfer (HAMT) Model
------------------------------------------------

### Overview

The combined heat and moisture transfer finite (HAMT) solution algorithm is a completely coupled, one-dimensional, finite element, heat and moisture transfer model simulating the movement and storage of heat and moisture in surfaces simultaneously from and to both the internal and external environments. As well as simulating the effects of moisture buffering, HAMT is also be able to provide temperature and moisture profiles through composite building walls, and help to identify surfaces with high surface humidity.

### HAMT Nomenclature

Dependencies on moisture content are indicated by a superscript <sup>w</sup>, on heat by a superscript <sup>h</sup> and vapor pressure by a superscript <sup>v</sup>.

Table 2. Combined Heat and Moisture Transfer Model Nomenclature

<table class="table table-striped">
<tr>
<th>Symbol</th>
<th>Units</th>
<th>Meaning</th>
</tr>
<tr>
<td>T</td>
<td>°C</td>
<td>Temperature</td>
</tr>
<tr>
<td>RH,φ</td>
<td>%, fraction</td>
<td>Relative humidity</td>
</tr>
<tr>
<td>W</td>
<td>kg/m<sup>3</sup></td>
<td>Moisture Content</td>
</tr>
<tr>
<td><span>${\raise0.7ex\hbox{${\partial H}$} \!\mathord{\left/ {\vphantom {{\partial H} {\partial T}}}\right.}\!\lower0.7ex\hbox{${\partial T}$}}$</span></td>
<td>J/m<sup>3</sup>C</td>
<td>Moisture dependent heat storage capacity</td>
</tr>
<tr>
<td><span>${\raise0.7ex\hbox{${\partial w}$} \!\mathord{\left/ {\vphantom {{\partial w} {\partial \phi }}}\right.}\!\lower0.7ex\hbox{${\partial \phi }$}}$</span></td>
<td>kg/m<sup>3</sup></td>
<td>Moisture dependent moisture storage capacity</td>
</tr>
<tr>
<td><span>${k^w}$</span></td>
<td>W/mC</td>
<td>Moisture dependent thermal conductivity</td>
</tr>
<tr>
<td><span>${h_v}$</span></td>
<td>J/kg</td>
<td>Evaporation enthalpy of water (= 2, 489, 000J/kg)</td>
</tr>
<tr>
<td><span>$\delta $</span></td>
<td>kg/msPa</td>
<td>Vapor diffusion coefficient in air</td>
</tr>
<tr>
<td><span>$\mu $</span></td>
<td>-</td>
<td>Moisture dependent vapor diffusion resistance factor</td>
</tr>
<tr>
<td>P</td>
<td>Pa</td>
<td>Vapor pressure</td>
</tr>
<tr>
<td>p<sub>ambient</sub></td>
<td>Pa</td>
<td>Ambient air pressure</td>
</tr>
<tr>
<td>C</td>
<td>J/kgC</td>
<td>Specific heat capacity of dry material</td>
</tr>
<tr>
<td>c<sup>w</sup></td>
<td>J/KgC</td>
<td>Specific heat capacity of water (=4,180J/kg<sup>o</sup>C@ 20<sup>o</sup>C)</td>
</tr>
<tr>
<td><span>$\rho $</span></td>
<td>kg/m<sup>3</sup></td>
<td>Material Density</td>
</tr>
<tr>
<td><span>${\rho ^w}$</span></td>
<td>kg/m<sup>3</sup></td>
<td>Density of water (= 1000kg/m3)</td>
</tr>
<tr>
<td><span>${D^w}$</span></td>
<td>m<sup>2</sup>/s</td>
<td>Liquid Transport Coefficient</td>
</tr>
<tr>
<td>A</td>
<td>m<sup>2</sup></td>
<td>Contact Surface area</td>
</tr>
<tr>
<td><span>$\Delta {V_i}$</span></td>
<td>m<sup>3</sup></td>
<td>Cell Volume</td>
</tr>
<tr>
<td><span>$t$</span></td>
<td>s</td>
<td>Time</td>
</tr>
<tr>
<td><span>$\Delta \tau $</span></td>
<td>s</td>
<td>Time step between calculations</td>
</tr>
<tr>
<td>x</td>
<td>m</td>
<td>Distance between cell centres</td>
</tr>
<tr>
<td><span>$C_i^h$</span></td>
<td>J/C</td>
<td>Heat Capacitance of cell i</td>
</tr>
<tr>
<td><span>$C_i^w$</span></td>
<td>kg</td>
<td>Moisture Capacitance of cell i</td>
</tr>
<tr>
<td><span>$R_{ij}^h$</span></td>
<td>C/W</td>
<td>Heat Resistance between cells i and j</td>
</tr>
<tr>
<td><span>$R_{ij}^v$</span></td>
<td>sPa/kg</td>
<td>Vapor Resistance between cells i and j</td>
</tr>
<tr>
<td><sup><span>$R_{ij}^w$</span></sup></td>
<td>s/kg</td>
<td>Liquid Moisture Resistance between cells i and j</td>
</tr>
<tr>
<td><sup><span>$q_i^v$</span></sup></td>
<td>W</td>
<td>Heat due to Vaporisation</td>
</tr>
<tr>
<td><sup><span>$q_i^{adds}$</span></sup></td>
<td>W</td>
<td>Heat from additional Sources</td>
</tr>
<tr>
<td>P</td>
<td>m3/m3</td>
<td>Material Porosity</td>
</tr>
<tr>
<td>p(as a superscript)</td>
<td>s</td>
<td>Present Time Step</td>
</tr>
<tr>
<td>i,j</td>
<td>-</td>
<td>Cell indices</td>
</tr>

</table>

### HAMT Model Description

Equations and are derived from heat and moisture balance equations and are taken from [Künzel, H.M. (1995)]. They describe a theoretical model for the transfer of heat and moisture through a material.

<div>$$\frac{{\partial H}}{{\partial T}}\frac{{\partial T}}{{\partial \tau }} = \frac{\partial }{{\partial x}}\left( {{k^w}\frac{{\partial T}}{{\partial x}}} \right) + {h_v}\frac{\partial }{{\partial x}}\left( {\frac{\delta }{\mu }\frac{{\partial T}}{{\partial x}}} \right)$$</div>

The three terms in equation describe the storage, transport and generation of heat respectively.

<div>$$\frac{{\partial w}}{{\partial \phi }}\frac{{\partial \phi }}{{\partial \tau }} = \frac{\partial }{{\partial x}}\left( {{D^w}\frac{{\partial w}}{{\partial \phi }}\frac{{\partial \phi }}{{\partial x}}} \right) + \frac{\partial }{{\partial x}}\left( {\frac{\delta }{\mu }\frac{{\partial T}}{{\partial x}}} \right)$$</div>

The three terms in equation describe the storage of moisture, the transport of liquid moisture and the transport of vapor respectively. The equation to calculate the vapor diffusion coefficient in air (<span>$\delta $</span>) used in the third term of both equations, is also taken from Künzel,

<div>$$\delta  = \frac{{\left( {2 \times {{10}^{ - 7}} \times {{\left( {T + 273.15} \right)}^{0.81}}} \right)}}{{{P_{ambient}}}}$$</div>

The heat storage capacity (<span>$\frac{\partial H}{\partial T}$</span>) depends on the moisture content w of the material by the following equation.

<div>$$\frac{{\partial H}}{{\partial T}} = \left( {c\rho  + {c^w}w} \right)$$</div>

The moisture content of the material w and the vapor diffusion resistance factor μ depend on the relative humidity inside the material. The parameters <span>$\frac{\partial w}{\partial \phi}$</span>, <span>${k^w}$</span> and <span>${D^w}$</span>are also moisture dependent parameters.

The following sections describe how the above equations are used within the HAMT model.

#### Surfaces, Material Layers and Cells

“Surfaces” are made of a number of layers of potentially any combination of materials. Each surface is split into its constituent materials and is then split up further into cells through its depth. HAMT will generate no more than 10 cells per material with widths that are thinner near the boundaries of each material where most changes are expected and detail is needed.

#### Heat Transfer

Equation 1 can be re-written and used to describe the heat storage and transfer through the i<sup>th</sup> cell in a surface.

<div>$$\left( {{c_i}{\rho_i} + {c^w}{w_i}} \right)\Delta {V_i}\frac{{T_i^{p + 1} - T_i^p}}{{\Delta \tau }} = \sum\limits_j {k_{ij}^w{A_{ij}}\frac{{T_j^{p + 1} - T_i^{p + 1}}}{{{x_{ij}}}}}  + \sum\limits_j {{h_v}\frac{{{\delta_{ij}}}}{{{\mu_{ij}}}}{A_{ij}}\frac{{p_j^{p + 1} - p_i^{p + 1}}}{{{x_{ij}}}}} $$</div>

In the one dimensional case there are only two adjacent cells each labelled j. The heat generated due to vaporisation<span>$q_i^v$</span> can be calculated separately.

<div>$$q_i^v = \sum\limits_j {{h_v}\frac{{{\delta_{ij}}}}{{{\mu_{ij}}}}{A_{ij}}\frac{{p_j^{p + 1} - p_i^{p + 1}}}{{{x_{ij}}}}} $$</div>

Rearranging equation and including other sources of heat (<span>$q_i^{adds}$</span>) such as radiation from other surfaces in the calculation gives the temperature in a cell in the next time step as,

<div>$$T_i^{p + 1} = \frac{{\sum\nolimits_j {\frac{{T_j^{p + 1}}}{{R_{ij}^h}}}  + q_i^v + q_i^{adds} + C_i^h\frac{{T_i^p}}{{\Delta \tau }}}}{{\frac{{C_i^h}}{{\Delta \tau }} + \sum\nolimits_j {\frac{1}{{R_{ij}^h}}} }}$$</div>

where<span>$C_i^h = \left( {{c_i}{\rho_i} + {c^w}{w_i}} \right)\Delta {V_i}$</span> is thermal heat capacitance of cell i and <span>$R_{ij}^h = \frac{x_{ij}}{k_{ij}A_{ij}}$</span> is the thermal resistance between cells i and j.

This equation can be solved using the Gauss-Seidel iteration technique. The i<sup>th</sup> cell temperature is calculated whilst the j<sup>th</sup> cell temperatures are kept as up to date as possible. The iteration is stopped when the maximum difference between two consecutive calculations in all cells is less than a threshold of 0.002°C.

#### Moisture Content w

The moisture content (w) of a cell is needed for the calculation of the heat transfer through the cell as it affects the thermal resistance and heat capacitance. The moisture content of cells is calculated from the relative humidity (RH) of the material. The relationship between w and the RH for each material is known as the sorption isotherm and measured data points are entered into EnergyPlus as a series of coordinates. HAMT interpolates between the measurements to obtain the moisture content of a material for any RH value. The sorption isotherm input is via the MaterialProperty:HeatAndMoistureTransfer:SorptionIsotherm object and is described in the Input Output Reference document.

#### Porosity P

The porosity of a material (P) is an input variable and defined as the maximum fraction, by volume, of a material that can be taken up with moisture. It is used to calculate the maximum point on the sorption isotherm curve.  The porosity is entered for each material via the MaterialProperty:HeatAndMoistureTransfer:Settings object, as described in the Input Output Reference document.

#### Moisture Dependant Thermal Conductivity k<sup>w</sup>

The thermal conductivity (k<sup>w</sup>) of the cell is determined by interpolating between data points of thermal conductivity versus the moisture content of the material, entered into EnergyPlus via the MaterialProperty:HeatAndMoistureTransfer:ThermalConductivity object. The moisture content is determined via the sorption isotherm which gives the moisture content as a function of Relative Humidity.

#### Moisture Dependant Moisture Diffusion Coefficient μ

This is used in the third term of equation to describe the heat transfer due to vapor movement. It is determined by interpolating between data points of moisture diffusion coefficient versus the moisture content of the material, entered into EnergyPlus via the MaterialProperty:HeatAndMoistureTransfer:Diffusion object. A simple linear interpolation is used to obtain the conductivity between measured points.

#### Moisture Transfer

Moisture, as well as heat, is transported through materials as either liquid (w) or vapor (p). There are two different potentials that control the movement though the material. Liquid transfer is driven by differences in relative humidity whereas vapor transfer is driven by differences in vapor pressure. Materials also have a capacity to store moisture. Equation can be re-written for a discrete cell in a continuous material.

<div>$$\frac{{dw}}{{d{\phi_i}}}\Delta {V_i}\frac{{\phi_i^{p + 1} - \phi_i^p}}{{\Delta \tau }} = \sum\limits_j {{k_{ij}}{A_{ij}}\frac{{\phi_j^{p + 1} - \phi_i^{p + 1}}}{{{x_{ij}}}}}  + \sum\limits_j {\frac{{{\delta_{ij}}}}{{{\mu_{ij}}}}{A_{ij}}\frac{{p_j^{p + 1} - p_i^{p + 1}}}{{{x_{ij}}}}} $$</div>

Equation can be rearranged to provide the relative humidity of the i<sup>th</sup> cell in the next time step.

<div>$$\phi_i^{p + 1} = \frac{{\sum\nolimits_j {\frac{{\phi_j^{p + 1}}}{{R_{ij}^w}}}  + \sum\nolimits_j {\frac{{p_i^{p + 1}}}{{R_{ij}^v}}}  + C_i^w\frac{{\phi_i^p}}{{\Delta \tau }}}}{{\frac{{C_i^w}}{{\Delta \tau }} + \sum\nolimits_j {\frac{1}{{R_{ij}^w}} + \sum\nolimits_j {\frac{{p_i^{sat}}}{{R_{ij}^v}}} } }}$$</div>

where <span>$C_i^w = \frac{dw}{d\phi_{i}}\Delta {V_i}$</span> is the "Moisture Capacitance" of cell i,

<div>$$R_{ij}^w = \frac{{{x_{ij}}}}{{{A_{ij}}D_{ij}^w\frac{{dw}}{{d\phi }}}}$$</div>

is the moisture resistance between cells i and j and <span>$R_{ij}^v = \frac{\mu_{ij}x_{ij}}{A_{ij}\delta_{ij}}$</span> is the vapor resistance between cells i and j.

Equation can be used together with the heat equation in an alternate step by step fashion to calculate the new temperature and relative humidity profiles for each cell for the next time step.

#### Liquid Transport Coefficient D<sup>w</sup>

The Moisture Dependant Liquid Transport Coefficient is entered as a series of moisture density and liquid transport coefficient data points. There are two different coefficients, one for suction, where the surface is wet due to rain, and one for redistribution where the surface is no longer wet. If the weather file has a rain flag it is used to switch between these two types of coefficient. HAMT-SUCTION and HAMT-REDISTRIBUTION.

#### Moisture Dependent Moisture Capacity <span>$\frac{\partial w}{\partial \phi}$</span>

This is simply the gradient of moisture sorption isotherm at the RH of the material.

#### Convective Heat Transfer

The internal and external heat transfer coefficients are used to calculate the thermal resistance of the boundary layer between the zone air and the surface of the surface. They are either supplied by the user via the advanced surface concepts object “SurfaceProperty:ConvectionCoefficients” or, if these are not provided, dynamic values are calculated.

#### Convective Vapor Transfer

The internal and external vapor transfer coefficients are used to calculate the resistance to vapour transfer of the boundary layer between the zone air and the surface of the surface. They are also either supplied by the user via the advanced surface concept object SurfaceProperties:VaporCoefficients. If these are not provided then dynamic values are calculated based on the convective heat transfer coefficients.

#### Initial Moisture Content

At the start of an EnergyPlus simulation “warm up” days are used to ensure that the temperatures of surfaces come to equilibrium with the environment before the simulation starts proper. Moisture content within some building fabrics can take a very long time to come to equilibrium with its environment and it is therefore necessary to set initial or typical values of moisture content for each material to be used at the start of the simulation. These initial values are entered for each material via the MaterialProperty:HeatAndMoistureTransfer:Settings object as described in the Input Output Reference document.

#### Using the Model

As an illustration of the use of the Heat and Moisture Transfer (HAMT) model, the material properties for a small sample of six generic materials have been provided in the EnergyPlus Reference DataSets (MoistureMaterials.idf). The properties were synthesised from the Annex 24 database [Kumar Kumaran, M. (1996)], supplemented, when required, by data from the database of the WUFI model [WUFI (1999)] and are therefore not related to any unique, measured material. Users should consult material property catalogues and other primary sources when the properties of a specific material are required.

Moisture and heat from the surfaces are used by EnergyPlus to calculate the room air temperature and moisture content. EnergyPlus with HAMT works best with as short a time step as possible. However the optimum time step which gives a good prediction for a short computing time will very much depend on the nature of the weather and type of building. Buildings with frequent and large changes in internal and external temperature will need a small time step, maybe even 60 steps per hour. Slowly evolving temperatures and relative humidity’s will not require such a short time step and 20, or even 6, steps per hour may be sufficient.

### References

Künzel, H.M. (1995) Simultaneous Heat and Moisture Transport in Building Components. One- and two-dimensional calculation using simple parameters. IRB Verlag 1995

Holman, J.P. (2002) Heat Transfer, Ninth Edition. McGraw-Hill

Winterton, R.H.S. (1997) Heat Transfer. (Oxford Chemistry Primers; 50) Oxford University Press

Kumar Kumaran, M. (1996) IEA ANNEX 24, Final Report, Volume 3

WUFI (1999) version 2.2 Simultaneous Heat and Moisture Transport in Building components. Fraunhofer IBP, Holzkirchen, Germany

Effective Moisture Penetration Depth (EMPD) Model
---------------------------------------------------------------------------

### Overview

Moisture has little effect on heating system performance, but a profound effect on the performance of air conditioning systems.  In order to accurately describe building performance during periods when cooling is needed, it is very important to know the moisture conditions of the building.  If one assumes that all building moisture is contained in the room air, then one ignores the fact that the materials that bound the room (e.g. wall surfaces, furnishings, linens, etc.) store and release moisture.  Thus, to assume that the only moisture that effects cooling system performance is contained in the room air is a false, and it can lead to significant error in the prediction of room moisture conditions and cooling system loads.

The EMPD (Effective Moisture Penetration Depth) model is a simplified, lumped approach to simulate surface moisture adsorption and desorption.

### EMPD Model Description

The EMPD concept assumes that a thin layer (δ<sub>M</sub>) close to the wall surface behaves dynamically and exchanges moisture with the air domain when exposed to cyclic air moisture pulses.  For short periods where the cyclic integral of the total moisture adsorption and desorption is near zero (i.e. there is no net moisture storage), the EMPD concept has been shown to be a reasonable approximation of reality (Kerestecioglu et al, 1989).  In other words, the following constraint must be met:

<div>$$\int_{{\tau_1}}^{{\tau_2}} {\frac{{dU}}{{d\tau }}} d\tau  = 0$$</div>

where, τ<sub>2</sub>-τ<sub>1</sub> denotes the finite time interval over which the equation holds.  The EMPD model assumes no spatial distribution of moisture content across the thickness (L) of the solid; rather, a thin layer (δ<sub>M</sub>) of uniform moisture content (U) is assumed to represent the total moisture content of the solid. This may be mathematically stated as:

<div>$$\int_0^L {U(x)dx = U{\delta_M}} $$</div>

For most building materials, the equilibrium moisture sorption isotherm can be defined by the following general equation (Kerestecioglu et al. 1988):

<div>$$U = a{\varphi ^b} + c{\varphi ^d}$$</div>

where

<div>$$\varphi  \approx \frac{{{W^*}}}{{{W_{sat}}^*}}$$</div>

and

<div>$${W_{sat}}^* = \frac{1}{{{R_v}{\rho_a}{T^*}}}\exp \left( {23.7093 - \frac{{4111}}{{{T^*} - 35.45}}} \right)$$</div>

 Given that U=U(W<sup>\*</sup>,T<sup>\*</sup>), the moisture content may be differentiated with respect to time in the following manner:

<div>$$\frac{{du}}{{d\tau }} = \frac{{\partial U}}{{\partial {W^*}}}\frac{{d{W^*}}}{{d\tau }} + \frac{{\partial U}}{{\partial {T^*}}}\frac{{d{T^*}}}{{d\tau }} = {A_T}\frac{{d{W^*}}}{{d\tau }} - {B_\rho }\frac{{d{T^*}}}{{d\tau }}$$</div>

where A<sub>T</sub> and B<sub>ρ</sub> are the isothermal moisture capacity and thermo-gradient coefficient, respectively.  From Eqs. , and , they can be expressed as:

<div>$${A_T} = \frac{{ab{\varphi ^b} + cd{\varphi ^d}}}{{{W^*}}}$$</div>

and

<div>$${B_\rho } =  - \left[ {\frac{1}{{{T^*}}} - \frac{{4111}}{{{{({T^*} - 35.45)}^2}}}} \right]*(ab{\varphi ^b} + cd{\varphi ^d})$$</div>

The lumped mass transfer equation for the i-th solid domain may be written as

<div>$${(A{\rho_b}{\delta_M})_i}\frac{{d{U_i}}}{{d\tau }} = {h_{M,i}}{A_i}({W_r} - {W_i}^*)$$</div>

Using Eqs. , , and , one obtains the final equation needed for closure moisture transfer at internal surface.

<div>$${({A_i}{\rho_b}{\delta_M}{A_T})_i}\frac{{d{W_i}^*}}{{d\tau }} = {h_{M,i}}{A_i}({W_r} - {W_i}^*) + {(A{\rho_b}{\delta_M}{B_\rho })_i}\frac{{d{T_i}^*}}{{d\tau }}$$</div>

The energy equation for the envelope contains the surface temperature and is given by the conduction equation

<div>$$\rho {C_p}\frac{{dT}}{{d\tau }} = \nabla  \cdot (k\nabla T)$$</div>

with the boundary conditions at interior surface

<div>$$ - k\nabla T =  - {q_T}`` + {h_T}({T^*} - {T_r}) + \lambda {h_M}({W^*} - {W_r})$$</div>

A more detailed account of the numerical solution procedure can be found in Kerestecioglu et al. (1988).

### EMPD Value Determination

An effective moisture penetration depth may be determined from either experimental or detailed simulation data by using actual surface areas and moisture vapor diffusivity.  An empirical function derived from the detailed simulation may be used to determine the EMPD value (Kerestecioglu et al, 1989):

<div>$${\delta_M} = 12.567024 - 12.21373*\exp \left( { - 267.0211*{D_v}^{0.7}*{\xi ^{ - 0.7}}} \right)$$</div>

where

<div>$$\xi  = \left| {\frac{{\Delta \varphi }}{{\Delta \tau }}} \right|$$</div>

Figure 17 gives the EMPD values to be used for various vapor diffusivities evaluated at different ambient excitations.

![](EngineeringReference/media/image241.svg.png)

Figure 17. Limit of Effective Penetration Depth Values for Various Vapor Diffusivities at Different Ambient Excitations.

### EMPD Nomenclature

A                = Area [m<sup>2</sup>]

A<sub>T</sub>               = Isothermal moisture capacity [m<sup>3</sup>/kg]

B<sub>ρ</sub>               = Thermo-gradient coefficient [kg/kg-K]

C<sub>p</sub>               = Specific heat [J/kg.K]

h<sub>M</sub>               = Convective mass transfer coeff. [kg/m<sup>2</sup>-s]

h<sub>T</sub>               = Convective heat transfer coeff. [W/m<sup>2</sup>-K]

k                = Thermal conductivity [W/m-K]

L                = Length [m]

q"<sub>T</sub>              = Imposed heat flux [W/m<sup>2</sup>]

R<sub>v</sub>               = Ideal gas constant [461.52 J/kg-K]

T                = Temperature [K]

U                = Moisture content [kg/kg]

W               = Humidity ratio [kg/kg]

#### Greek letters

δ<sub>M</sub>              = Effective penetration depth for moisture equation [m]

λ                = Heat of vaporization [J/kg]

ρ                = Density [kg/m<sup>3</sup>]

τ                 = Time [s]

φ                = Relative humidity [0 to 1]

ξ                 = Ambient moisture excitation rate [1/h]



#### Subscripts and superscripts

a                = Air

b                = Bulk

\*                 = Surface

i                 = i-th surface

### References

Kerestecioglu, A., Swami, M., Dabir, R., Razzaq, N., and Fairey, P., 1988, "Theoretical and Computational Investigation of Algorithms for Simultaneous Heat and Moisture Transport in Buildings," FSEC-CR-191-88, Florida Solar Energy Center, Cape Canaveral, FL.

Kerestecioglu, A., M. Swami and A. Kamel, 1989, "Theoretical and Computational Investigation of Simultaneous Heat and Moisture Transfer in Buildings: Effective Penetration Depth Theory."  ASHRAE Winter Meeting, Atlanta, GA.

Kerestecioglu, A., M. V. Swami, P. Brahma, L. Gu, P. Fairey, and S. Chandra, 1989, “FSEC 1.1 User’s Manual,” Florida Solar Energy Center, Cape Canaveral, FL

Outside Surface Heat Balance
----------------------------

![](EngineeringReference/media/image242.png)

Figure 18. Outside Heat Balance Control Volume Diagram

The heat balance on the outside face is:

<div>$${q''_{\alpha sol}} + {q''_{LWR}} + {q''_{conv}} - {q''_{ko}} = 0$$</div>

where:

<sub><span>${q''_{\alpha sol}}$</span> </sub>= Absorbed direct and diffuse solar (short wavelength) radiation heat flux.

<sub><span>${q''_{LWR}}$</span> </sub>= Net long wavelength (thermal) radiation flux exchange with the air and surroundings.

<sub><span>${q''_{conv}}$</span> </sub>= Convective flux exchange with outside air.

<sub><span>${q''_{ko}}$</span> </sub> = Conduction heat flux (q/A) into the wall.

All terms are positive for net flux to the face except the conduction term, which is traditionally taken to be positive in the direction from outside to inside of the wall.  Simplified procedures generally combine the first three terms by using the concept of a *sol-air temperature*.  Each of these heat balance components is introduced briefly below.

### External Shortwave Radiation

<sub><span>${q''_{\alpha sol}}$</span> </sub> is calculated using procedures presented later in this manual and includes both direct and diffuse incident solar radiation absorbed by the surface face.  This is influenced by location, surface facing angle and tilt, surface face material properties, weather conditions, etc.

### External Longwave Radiation

<span>${q''_{LWR}}$</span> is a standard radiation exchange formulation between the surface, the sky, and the ground.  The radiation heat flux is calculated from the surface absorptivity, surface temperature, sky and ground temperatures, and sky and ground view factors.

The longwave radiation heat exchange between surfaces is dependent on surface temperatures, spatial relationships between surfaces and surroundings, and material properties of the surfaces. The relevant material properties of the surface, emissivity e and absorptivity a, are complex functions of temperature, angle, and wavelength for each participating surface. However, it is generally agreed that reasonable assumptions for building loads calculations are (Chapman 1984; Lienhard 1981):

·        each surface emits or reflects diffusely and is gray and opaque (a = e, t = 0, r = 1- e)

·        each surface is at a uniform temperature

·        energy flux leaving a surface is evenly distributed across the surface,

·        the medium within the enclosure is non-participating.

These assumptions are frequently used in all but the most critical engineering applications.



Table 3. Nomenclature List of Variables.

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
<th>Units</th>
<td>Range</td>
</tr>
<tr>
<td>q&quot;<sub>LWR</sub></td>
<td>Exterior surface longwave radiation flux</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>h<sub>r</sub></td>
<td>Linearized radiative heat transfer  coefficient to air temperature</td>
<td>W/(m<sup>2</sup> K)</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>surf</sub></td>
<td>Surface Outside face temperatures</td>
<td>K</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>air</sub></td>
<td>Outside air temperature</td>
<td>K</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>gnd</sub>
 </td>
<td>Environmental ground surface temperature</td>
<td>K</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>sky</sub></td>
<td>Sky Effective temperature</td>
<td>K</td>
<td>-</td>
</tr>
<tr>
<td>F<sub>gnd</sub></td>
<td>view factor of wall surface to ground surface</td>
<td>-</td>
<td>0~1</td>
</tr>
<tr>
<td>F<sub>sky</sub></td>
<td>View factor of wall surface to sky</td>
<td>-</td>
<td>0~1</td>
</tr>
<tr>
<td>F<sub>air</sub></td>
<td>View factor of wall surface to air</td>
<td>-</td>
<td>0~1</td>
</tr>
<tr>
<td>e</td>
<td>Surface long-wave emissivity</td>
<td>-</td>
<td>0~1</td>
</tr>
<tr>
<td>s</td>
<td>Stefan-Boltzmann constant</td>
<td>W/m<sup>2</sup>-K<sup>4</sup></td>
<td>0.0000000567</td>
</tr>

</table>

Consider an enclosure consisting of building exterior surface, surrounding ground surface, and sky.  Using the assumptions above, we can determine the longwave radiative heat flux at the building exterior surface (Walton 1983; McClellan and Pedersen 1997).  The total longwave radiative heat flux is the sum of components due to radiation exchange with the ground, sky, and air.

<div>$$q_{LWR}^`` = {q''_{gnd}} + {q''_{sky}} + {q''_{air}}$$</div>

Applying the Stefan-Boltzmann Law to each component yields:

<div>$$q_{_{LWR}}^`` = \varepsilon \sigma {F_{gnd}}(T_{gnd}^4 - T_{surf}^4) + \varepsilon \sigma {F_{sky}}(T_{sky}^4 - T_{surf}^4) + \varepsilon \sigma {F_{air}}(T_{air}^4 - T_{surf}^4)$$</div>

where

e=long-wave emittance of the surface

s=Stefan-Boltzmann constant

F<sub>gnd</sub> = view factor of wall surface to ground surface temperature

F<sub>sky</sub> = view factor of wall surface to sky temperature

F<sub>air</sub> =view factor of wall surface to air temperature

T<sub>surf</sub> = outside surface temperature

T<sub>gnd</sub> = ground surface temperature

T<sub>sky</sub> = sky temperature

T<sub>air</sub> = air temperature

Linearized radiative heat transfer coefficients are introduced to render the above equation more compatible with the heat balance formulation,

<div>$$q_{_{LWR}}^`` = {h_{r,gnd}}({T_{gnd}} - {T_{surf}}) + {h_{r,sky}}({T_{sky}} - {T_{surf}}) + {h_{r,air}}({T_{air}} - {T_{surf}})$$</div>

where

<div>$${h_{r,gnd}} = \frac{{\varepsilon \sigma {F_{gnd}}(T_{surf}^4 - T_{gnd}^4)}}{{{T_{surf}} - {T_{gnd}}}}$$</div>

<div>$${h_{r,sky}} = \frac{{\varepsilon \sigma {F_{sky}}(T_{surf}^4 - T_{sky}^4)}}{{{T_{surf}} - {T_{sky}}}}$$</div>

<div>$${h_{r,air}} = \frac{{\varepsilon \sigma {F_{air}}(T_{surf}^4 - T_{air}^4)}}{{{T_{surf}} - {T_{air}}}}$$</div>

The longwave view factors to ground and sky are calculated with the following expressions (Walton 1983):

<div>$${F_{ground}} = 0.5(1 - \cos \phi )$$</div>

<div>$${F_{sky}} = 0.5(1 + \cos \phi )$$</div>

where *f* is the tilt angle of the surface.  The view factor to the sky is further split between sky and air radiation by:

<div>$$\beta  = \sqrt {0.5\left( {1 + \cos \phi } \right)} $$</div>

The ground surface temperature is assumed to be the same as the air temperature.  The final forms of the radiative heat transfer coefficients are shown here.

<div>$${h_{r,gnd}} = \frac{{\varepsilon \sigma {F_{gnd}}(T_{surf}^4 - T_{air}^4)}}{{{T_{surf}} - {T_{air}}}}$$</div>

<div>$${h_{r,sky}} = \frac{{\varepsilon \sigma {F_{sky}}\beta (T_{surf}^4 - T_{sky}^4)}}{{{T_{surf}} - {T_{sky}}}}$$</div>

<div>$${h_{r,air}} = \frac{{\varepsilon \sigma {F_{sky}}\left( {1 - \beta } \right)(T_{surf}^4 - T_{air}^4)}}{{{T_{surf}} - {T_{air}}}}$$</div>

### References

ASHRAE. 1993. 1993 ASHRAE Handbook – Fundamentals. Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

Chapman, A. J. 1984. Heat Transfer, 4<sup>th</sup> Edition, New York: Macmillan Publishing Company.

Lienhard, J. H. 1981. A Heat Transfer Textbook, Englewood Cliffs, N.J.: Prentice-Hall, Inc.

McClellan, T. M., and C. O. Pedersen. 1997. Investigation of Outside Heat Balance Models for Use in a Heat Balance Cooling Load Calculation. ASHRAE Transactions, Vol. 103, Part 2, pp. 469-484.

Walton, G. N. 1983. Thermal Analysis Research Program Reference Manual. NBSSIR 83-2655. National Bureau of Standards.

### Atmospheric Variation

All buildings are located in the troposphere, the lowest layer of the atmosphere.  The troposphere extends from sea level to an altitude of 11 km.  Throughout the troposphere, air temperature decreases almost linearly with altitude at a rate of approximately 1°C per 150 m.  Barometric pressure decreases more slowly.  Wind speed, on the other hand, increases with altitude.

Because the atmosphere changes with altitude (defined as *height above ground* in this case), tall buildings can experience significant differences in local atmospheric properties between the ground floor and the top floor.  Buildings interact with the atmosphere through convective heat transfer between the outdoor air and the exterior surfaces of the building envelope, and through the exchange of air between the outside and inside of the building via infiltration and ventilation.

Impetus for using this modeling is illustrated in the next table.  Using a 70 story (284 meters) building as an example, the atmospheric variables are significant.

Table 4.  Atmospheric Variables at Two Different Altitudes above Ground Level

<table class="table table-striped">
<tr>
<th>Variable</th>
<th>1.5 Meters</th>
<th>284 meters</th>
<th>Absolute Diff</th>
<th>Percent Diff</th>
</tr>
<tr>
<td>Air Temperature</td>
<td>15°C</td>
<td>13.15°C</td>
<td>1.85°C</td>
<td>12.3%</td>
</tr>
<tr>
<td>Barometric Pressure</td>
<td>101,325 Pa</td>
<td>97,960 Pa</td>
<td>3,365 Pa</td>
<td>3.3%</td>
</tr>
<tr>
<td>Wind Speed</td>
<td>2.46 m/s</td>
<td>7.75 m/s</td>
<td>5.29 m/s</td>
<td>215%</td>
</tr>

</table>

Comparing the annual energy usage between 60 discretely modeled floors of a building, it turns out that the effect due to wind speed change is dominant over the first ten floors.  But at floor 25, surprisingly, the effect due to air temperature has caught up and is about equal to the effect of wind speed.  Above floor 25 the effect due to air temperature is now dominant.  Clearly it is desirable to model air temperature variation with altitude for high-rise buildings.

To accommodate atmospheric variation EnergyPlus automatically calculates the local outdoor air temperature and wind speed separately for each zone and surface that is exposed to the outdoor environment.  The zone centroid or surface centroid are used to determine the height above ground.  Only local outdoor air temperature and wind speed are currently calculated because they are important factors for the exterior convection calculation for surfaces (see Exterior Convection below) and can also be factors in the zone infiltration and ventilation calculations.  Variation in barometric pressure, however, is considered when using the Airflow Network objects.

#### Local Outdoor Air Temperature Calculation

Variation in outdoor air temperature is calculated using the U.S. Standard Atmosphere (1976).  According to this model, the relationship between air temperature and altitude in a given layer of the atmosphere is:

<div>$${T_z} = {T_b} + L\left( {{H_z} - {H_b}} \right)$$</div>

where

*T<sub>z</sub>* = air temperature at altitude *z*

*T<sub>b</sub>* = air temperature at the base of the layer, i.e., ground level for the troposphere

*L* = air temperature gradient, equal to –0.0065 K/m in the troposphere

*H<sub>b</sub>* = offset equal to zero for the troposphere

*H<sub>z</sub>* = geopotential altitude.

The variable *H<sub>z</sub>* is defined by:

<div>$${H_z} = \frac{{Ez}}{{\left( {E + z} \right)}}$$</div>

where

*E* = 6,356 km, the radius of the Earth

*z* = altitude.

For the purpose of modeling buildings in the troposphere, altitude *z* refers to the height above ground level, not the height above sea level.  The height above ground is calculated as the height of the centroid, or area-weighted center point, for each zone and surface.

The air temperature at ground level, *T<sub>b</sub>*, is derived from the weather file air temperature by inverting the equation above:

<div>$${T_b} = {T_{z,met}} - L\left( {\frac{{E{z_{met}}}}{{E + {z_{met}}}} - {H_b}} \right)$$</div>

where

*T<sub>z,met</sub>* = weather file air temperature (measured at the meteorological station)

*z<sub>met</sub>* = height above ground of the air temperature sensor at the meteorological station.

The default value for *z<sub>met</sub>* for air temperature measurement is 1.5 m above ground.  This value can be overridden by using the Site:WeatherStation object.

#### Local Wind Speed Calculation

Chapter 16 of the Handbook of Fundamentals (ASHRAE 2005).  The wind speed measured at a meteorological station is extrapolated to other altitudes with the equation:

<div>$${V_z} = {V_{met}}{\left( {\frac{{{\delta_{met}}}}{{{z_{met}}}}} \right)^{{\alpha_{met}}}}{\left( {\frac{z}{\delta }} \right)^\alpha }$$</div>

where

*z* = altitude, height above ground

*V<sub>z</sub>* = wind speed at altitude *z*

*a* = wind speed profile exponent at the site

*d* = wind speed profile boundary layer thickness at the site

*z<sub>met</sub>* = height above ground of the wind speed sensor at the meteorological station

*V<sub>met</sub>* = wind speed measured at the meteorological station

*a<sub>met</sub>* = wind speed profile exponent at the meteorological station

*d<sub>met</sub>* = wind speed profile boundary layer thickness at the meteorological station.

The wind speed profile coefficients *a*, *d*, *a<sub>met</sub>*, and *d<sub>met</sub>*, are variables that depend on the roughness characteristics of the surrounding terrain.  Typical values for *a* and d are shown in the following table:



Table 5. Wind Speed Profile Coefficients (ASHRAE Fundamentals 2005).

<table class="table table-striped">
<tr>
<th>Terrain Description</th>
<th>Exponent,a</th>
<th>Boundary Layer Thickness,d (m)</th>
</tr>
<tr>
<td>Flat, open country</td>
<td>0.14</td>
<td>270</td>
</tr>
<tr>
<td>Rough, wooded country</td>
<td>0.22</td>
<td>370</td>
</tr>
<tr>
<td>Towns and cities</td>
<td>0.33</td>
<td>460</td>
</tr>
<tr>
<td>Ocean</td>
<td>0.10</td>
<td>210</td>
</tr>
<tr>
<td>Urban, industrial, forest</td>
<td>0.22</td>
<td>370</td>
</tr>

</table>



The terrain types above map to the options in the *Terrain* field of the Building object.  The *Terrain* field can be overridden with specific values for *a* and d by using the Site:HeightVariation object.

The default value for *z<sub>met</sub>* for wind speed measurement is 10 m above ground.  The default values for *a<sub>met</sub>* and *d<sub>met</sub>* are 0.14 and 270 m, respectively, because most meteorological stations are located in an open field.  These values can be overridden by using the Site:WeatherStation object.

### Outdoor/Exterior Convection

Heat transfer from surface convection is modeled using the classical formulation:

<div>$${Q_c} = {h_{c,ext}}A\left( {{T_{surf}} - {T_{air}}} \right)$$</div>

where

*Q<sub>c</sub>* = rate of exterior convective heat transfer

*h<sub>c,ext</sub>* = exterior convection coefficient

*A* = surface area

*T<sub>surf</sub>* = surface temperature

*T<sub>air</sub>* = outdoor air temperature

Substantial research has gone into the formulation of models for estimating the exterior convection coefficient. Since the 1930's there have been many different methods published for calculating this coefficient, with much disparity between them (Cole and Sturrock 1977; Yazdanian and Klems 1994).  More recently Palyvos (2008) surveyed correlations cataloging some 91 different correlations into four categories based on functional form of the model equation.  EnergyPlus therefore offers a wide selection of different methods for determining values for *h<sub>c,ext</sub>*. The selection of model equations for *h<sub>c,ext</sub>* can be made at two different levels. The first is the set of options available in the input object SurfaceConvectionAlgorithm:Outside that provides a way of broadly selecting which model equations are applied throughout the model.  The input objects SurfaceProperty:ConvectionCoefficients and SurfaceProperty:ConvectionCoefficients:MultipleSurface also provide ways of selecting which model equations or values are applied for specific surfaces.  These basic options are identified by the key used for input and include:

* SimpleCombined

* TARP

* MoWiTT

* DOE-2

* AdaptiveConvectionAlgorithm

Note that when the outside environment indicates that it is raining, the exterior surfaces (exposed to wind) are assumed to be wet.  The convection coefficient is set to a very high number (1000) and the outside temperature used for the surface will be the wet-bulb temperature.  (If you choose to report this variable, you will see 1000 as its value.)

When the AdaptiveConvectionAlgorithm is used, there is a second, deeper level of control available for selecting among a larger variety of *h<sub>c,ext</sub>* equations and also defining custom equations using curve or table objects.  These options are described in this section.

In addition to the correlation choices described below, it is also possible to override the convection coefficients on the outside of any surface by other means:

* Use the SurfaceProperty:ConvectionCoefficients object in the input file to set the convection coefficient value on either side of any surface.

* Use the SurfaceProperty:OtherSideCoefficients object in the input file to set heat transfer coefficients and temperatures on surfaces.

* Use the EnergyManagementSystem Actuators that are available for overriding h<sub>c</sub> values.

These options can also use schedules to control values over time. Specific details are given in the Input Output Reference document.

#### Simple Combined

The simple algorithm uses surface roughness and local surface windspeed to calculate the exterior heat transfer coefficient (key:SimpleCombined).  The basic equation used is:

<div>$$h = D + E{V_z} + F{V_z}^2$$</div>

where

*h* = heat transfer coefficient

*V<sub>z</sub>* = local wind speed calculated at the height above ground of the surface centroid

D, E, F = material roughness coefficients

The roughness correlation is taken from Figure 1, Page 22.4, ASHRAE Handbook of Fundamentals (ASHRAE 1989).  The roughness coefficients are shown in the following table:

Table 6.  Roughness Coefficients D, E, and F.

<table class="table table-striped">
<tr>
<th>Roughness Index</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>Example Material</th>
</tr>
<tr>
<td>1 (Very Rough)</td>
<td>11.58</td>
<td>5.894</td>
<td>0.0</td>
<td>Stucco</td>
</tr>
<tr>
<td>2 (Rough)</td>
<td>12.49</td>
<td>4.065</td>
<td>0.028</td>
<td>Brick</td>
</tr>
<tr>
<td>3 (Medium Rough)</td>
<td>10.79</td>
<td>4.192</td>
<td>0.0</td>
<td>Concrete</td>
</tr>
<tr>
<td>4 (Medium Smooth)</td>
<td>8.23</td>
<td>4.0</td>
<td>-0.057</td>
<td>Clear pine</td>
</tr>
<tr>
<td>5 (Smooth)</td>
<td>10.22</td>
<td>3.1</td>
<td>0.0</td>
<td>Smooth Plaster</td>
</tr>
<tr>
<td>6 (Very Smooth)</td>
<td>8.23</td>
<td>3.33</td>
<td>-0.036</td>
<td>Glass</td>
</tr>

</table>

Note that the simple correlation yields a combined convection and radiation heat transfer coefficient.  Radiation to sky, ground, and air is included in the exterior convection coefficient for this algorithm.

All other algorithms yield a *convection only* heat transfer coefficient.  Radiation to sky, ground, and air is calculated automatically by the program.

#### TARP ALGORITHM

TARP, or Thermal Analysis Research Program, is an important predecessor of EnergyPlus (Walton 1983).  Walton developed a comprehensive model for exterior convection by blending correlations from ASHRAE and flat plate experiments by Sparrow et. al. In older versions of EnergyPlus, prior to version 6, the “TARP” model was called “Detailed.”  The model was reimplemented in version 6 to use Area and Perimeter values for the group of surfaces that make up a facade or roof, rather than the single surface being modeled.

Table 7. Nomenclature List of Variables.

<table class="table table-striped">
<tr>
<th>Variable</th>
<th>Description</th>
<th>Units</th>
<th>Range</th>
</tr>
<tr>
<td>A</td>
<td>Surface area of the surface</td>
<td>m<sup>2</sup></td>
<td>/= 0</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Surface exterior convective heat transfer coefficient</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>f</sub></td>
<td>Forced convective heat transfer coefficient</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>n</sub></td>
<td>Natural convective heat transfer coefficient</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>P</td>
<td>Perimeter of surface</td>
<td>m</td>
<td>-</td>
</tr>
<tr>
<td>R<sub>f</sub></td>
<td>Surface roughness multiplier</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>air</sub></td>
<td>Local outdoor air temperature calculated at the height above ground of the surface centroid</td>
<td>°C</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>so</sub></td>
<td>Outside surface temperature</td>
<td>°C</td>
<td>-</td>
</tr>
<tr>
<td>DT</td>
<td>Temperature difference between the surface and air,</td>
<td>°C</td>
<td>-</td>
</tr>
<tr>
<td>V<sub>z</sub></td>
<td>Local wind speed calculated at the height above ground of the surface centroid</td>
<td>m/s</td>
<td>-</td>
</tr>
<tr>
<td>W<sub>f</sub></td>
<td>Wind direction modifier</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>f</td>
<td>Angle between the ground outward normal and the surface outward normal</td>
<td>degree</td>
<td>-</td>
</tr>
<tr>
<td>Roughness Index</td>
<td>Surface roughness index (6=very smooth, 5=smooth, 4=medium smooth, 3=medium rough, 2=rough, 1=very rough)</td>
<td>-</td>
<td>1~6</td>
</tr>

</table>



The Detailed, BLAST, and TARP convection models are very similar.  In all three models, convection is split into forced and natural components (Walton 1981).  The total convection coefficient is the sum of these components.

<div>$${h_c} = {h_f} + {h_n}$$</div>

The forced convection component is based on a correlation by Sparrow, Ramsey, and Mass (1979):

<div>$${h_f} = 2.537{W_f}{R_f}{\left( {\frac{{P{V_z}}}{A}} \right)^{1/2}}$$</div>

where

W<sub>f</sub>  =  1.0 for windward surfaces

or

W<sub>f</sub>  = 0.5 for leeward surfaces

Leeward is defined as greater than 100 degrees from normal incidence (Walton 1981).

The surface roughness multiplier Rf is based on the ASHRAE graph of surface conductance (ASHRAE 1981) and may be obtained from the following table:

Table 8.  Surface Roughness Multipliers (Walton 1981).

<table class="table table-striped">
<tr>
<th>Roughness Index</th>
<th>Rf</th>
<th>Example Material</th>
</tr>
<tr>
<td>1 (Very Rough)</td>
<td>2.17</td>
<td>Stucco</td>
</tr>
<tr>
<td>2 (Rough)</td>
<td>1.67</td>
<td>Brick</td>
</tr>
<tr>
<td>3 (Medium Rough)</td>
<td>1.52</td>
<td>Concrete</td>
</tr>
<tr>
<td>4 (Medium Smooth)</td>
<td>1.13</td>
<td>Clear pine</td>
</tr>
<tr>
<td>5 (Smooth)</td>
<td>1.11</td>
<td>Smooth Plaster</td>
</tr>
<tr>
<td>6 (Very Smooth)</td>
<td>1.00</td>
<td>Glass</td>
</tr>

</table>

The natural convection component *h<sub>n</sub>* is calculated in the same way as the interior "Detailed" model.  The detailed natural convection model correlates the convective heat transfer coefficient to the surface orientation and the difference between the surface and zone air temperatures (where DT = Air Temperature - Surface Temperature).  The algorithm is taken directly from Walton (1983).  Walton derived his algorithm from the ASHRAE Handbook (2001), Table 5 on p. 3.12, which gives equations for natural convection heat transfer coefficients in the turbulent range for large, vertical plates and for large, horizontal plates facing upward when heated (or downward when cooled).   A note in the text also gives an approximation for large, horizontal plates facing downward when heated (or upward when cooled) recommending that it should be half of the facing upward value.  Walton adds a curve fit as a function of the cosine of the tilt angle to provide intermediate values between vertical and horizontal.  The curve fit values at the extremes match the ASHRAE values very well.

For no temperature difference OR a vertical surface the following correlation is used:

<div>$$h = 1.31{\left| {\Delta T} \right|^{\frac{1}{3}}}$$</div>

For (DT &lt; 0.0 AND an upward facing surface)  OR  (DT &gt; 0.0 AND an downward facing surface) an enhanced convection correlation is used:

<div>$$h = \frac{{9.482{{\left| {\Delta T} \right|}^{\frac{1}{3}}}}}{{7.283 - \left| {\cos \Sigma } \right|}}$$</div>

where S is the surface tilt angle.

For (DT &gt; 0.0 AND an upward facing surface)  OR  (DT &lt; 0.0 AND an downward facing surface) a reduced convection correlation is used:

<div>$$h = \frac{{1.810{{\left| {\Delta T} \right|}^{\frac{1}{3}}}}}{{1.382 + \left| {\cos \Sigma } \right|}}$$</div>

where S is the surface tilt angle.

#### MoWiTT Algorithm

Table 9.  Nomenclature List of Variables.

<table class="table table-striped">
<tr>
<th>Variable</th>
<th>Description</th>
<th>Units</th>
<th>Range</th>
</tr>
<tr>
<td>A</td>
<td>Constant</td>
<td>W/(m<sup>2</sup>K(m/s)<sup>b</sup></td>
<td>-</td>
</tr>
<tr>
<td>B</td>
<td>Constant</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>C<sub>t</sub></td>
<td>Turbulent natural convection constant</td>
<td>W/(m<sup>2</sup>K<sup>4/3</sup>)</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Surface exterior convective heat transfer coefficient</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>so</sub></td>
<td>Outside surface temperature</td>
<td>°C/K</td>
<td>-</td>
</tr>
<tr>
<td>DT</td>
<td>Temperature difference between the surface and air</td>
<td>°C/K</td>
<td>-</td>
</tr>

</table>



The MoWiTT model is based on measurements taken at the Mobile Window Thermal Test (MoWiTT) facility (Yazdanian and Klems 1994).  The correlation applies to very smooth, vertical surfaces (e.g. window glass) in low-rise buildings and has the form:

<div>$${h_c} = \sqrt {{{\left[ {{C_t}{{\left( {\Delta T} \right)}^{\frac{1}{3}}}} \right]}^2} + {{\left[ {aV_z^b} \right]}^2}} $$</div>

Constants a, b and turbulent natural convection constant C<sub>t</sub> are given in Table 10.  The original MoWiTT model has been modified for use in EnergyPlus so that it is sensitive to the local suface’s wind speed which varies with the height above ground.  The original MoWiTT model was formulated for use with the air velocity at the location of the weather station.  As of Version 7.2, EnergyPlus uses the “a” model coefficients derived by Booten et al. (2012) rather than the original values from Yazdanian and Klems (1994).

NOTE:  The MoWiTT algorithm may not be appropriate for rough surfaces, high-rise surfaces, or surfaces that employ movable insulation.

Table 10. MoWiTT Coefficients (Yazdanian and Klems 1994, Booten et al. 2012)

<table class="table table-striped">
<tr>
<th>Wind Direction</th>
<th>Ct</th>
<th>a</th>
<th>b</th>
</tr>
<tr>
<td>(Units)</td>
<td>W/m<sup>2</sup>K<sup>4/3</sup></td>
<td>W/m<sup>2</sup>K(m/s)<sup>b</sup></td>
<td>-</td>
</tr>
<tr>
<td>Windward</td>
<td>0.84</td>
<td>3.26</td>
<td>0.89</td>
</tr>
<tr>
<td>Leeward</td>
<td>0.84</td>
<td>3.55</td>
<td>0.617</td>
</tr>

</table>



#### DOE-2 Model

Table 11.  Nomenclature List of Variables.

<table class="table table-striped">
<tr>
<th>Variable</th>
<th>Description</th>
<th>Units</th>
<th>Range</th>
</tr>
<tr>
<td>a</td>
<td>Constant</td>
<td>W/(m<sup>2</sup>K(m/s)<sup>b</sup></td>
<td>-</td>
</tr>
<tr>
<td>b</td>
<td>Constant</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Surface exterior convective heat transfer coefficient</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>c,glass</sub></td>
<td>Convective heat transfer coefficient for very smooth surfaces (glass)</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>n</sub></td>
<td>Natural convective heat transfer coefficient</td>
<td>W/(m<sup>2</sup>K)</td>
<td>-</td>
</tr>
<tr>
<td>R<sub>f</sub></td>
<td>Surface roughness multiplier</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>so</sub></td>
<td>Outside surface temperature</td>
<td>°C/K</td>
<td>-</td>
</tr>
<tr>
<td>DT</td>
<td>Temperature difference between the surface and air,</td>
<td>°C/K</td>
<td>-</td>
</tr>
<tr>
<td>f</td>
<td>Angle between the ground outward normal and the surface outward normal</td>
<td>radian</td>
<td>-</td>
</tr>

</table>

##### 

The DOE-2 convection model is a combination of the MoWiTT and BLAST Detailed convection models (LBL 1994). The convection coefficient for very smooth surfaces (e.g. glass) is calculated as:

<div>$${h_{c,glass}} = \sqrt {h_n^2 + {{\left[ {aV_z^b} \right]}^2}} $$</div>

h<sub>n</sub> is calculated using Equation or Equation .  Constants a and b are given in Table 10.

For less smooth surfaces, the convection coefficient is modified according to the equation

<div>$${h_c} = {h_n} + {R_f}({h_{c,glass}} - {h_n})$$</div>

where R<sub>f</sub> is the roughness multiplier given by Table 8.

#### Adaptive Convection Algorithm

This algorithm has a structure that allows for finer control over the models used for particular surfaces.  The algorithm for the outside face was developed for EnergyPlus but it borrows concepts and its name from the research done by Beausoleil-Morrison (2000, 2002) for convection at the inside face (see the description below for interior convection).

The adaptive convection algorithm implemented in EnergyPlus for the outside face is much simpler than that for the inside face. The surface classification system has a total of 4 different categories for surfaces that depend on current wind direction and heat flow directions.  However it is more complex in that the *h<sub>c</sub>* equation is split into two parts and there are separate model equation selections for forced convection, *h<sub>f</sub>*, and natural convection, *h<sub>n</sub>*. The following table summarizes the categories and the default assignments for *h<sub>c</sub>* equations. The individual *h<sub>c</sub>* equations are documented below.

Table 12. Adaptive Convection Algorithm Details

<table class="table table-striped">
<tr>
<th>#</th>
<th>Surface Classifi-cation</th>
<th>Heat Flow Direction</th>
<th>Wind Direct-ion</th>
<th>h<sub>f</sub>  Models</th>
<th>h<sub>n</sub> Models</th>
</tr>
<tr>
<td>1</td>
<td>Roof Stable</td>
<td>Down</td>
<td>Any</td>
<td>TARPWindward MoWiTTWindward DOE2Windward NusseltJurges BlockenWindward EmmelRoof ClearRoof</td>
<td>WaltonStableHorizontalOrTilt AlamdariStableHorizontal</td>
</tr>
<tr>
<td>2</td>
<td>Roof Unstable</td>
<td>Up</td>
<td>Any</td>
<td>TARPWindward MoWiTTWindward DOE2Windward NusseltJurges BlockenWindward EmmelRoof ClearRoof</td>
<td>WaltonUnstableHorizontalOrTilt AlamdariUnstableHorizontal</td>
</tr>
<tr>
<td>3</td>
<td>Vertical Wall Windward</td>
<td>Any</td>
<td>Windward</td>
<td>TARPWindward DOE2Windward MoWiTTWindward NusseltJurges McAdams Mitchell BlockenWindward EmmelVertical</td>
<td>ASHRAEVerticalWall AlamdariHammondVerticalWall FohannoPolidoriVerticalWall ISO15099Windows</td>
</tr>
<tr>
<td>4</td>
<td>Vertical Wall Leeward</td>
<td>Any</td>
<td>Leeward</td>
<td>TARPLeeward MoWiTTLeeward DOE2Leeward EmmelVertical NusseltJurges McAdams Mitchell</td>
<td>ASHRAEVerticalWall AlamdariHammondVerticalWall FohannoPolidoriVerticalWall ISO15099Windows</td>
</tr>

</table>



##### Outside Face Surface Classification

During an initial setup phase, all the heat transfer surfaces in the input file are analyzed in groups to determine appropriate values for geometry scales used in many of the convection correlations.  Eight separate groups are assembled for nominally vertical exterior surfaces for eight bins of azimuth: north, northeast, east, southeast, south, southwest, west, northwest.  Surfaces with the same range of azimuth are grouped together and analyzed for overall geometry parameters.  A ninth group is assembled for nominally horizontal exterior surfaces for a roof bin that is also analyzed for geometry.  These geometry routines find bounds and limits of all the surfaces in the group and then model geometric parameters from these limits.

##### Sparrow Windward

As discussed above for the TARP algorithm, a Sparrow et al. (1979) conducted flat plate measurements and develop the following correlation for finite-size flat plates oriented to windward.

<div>$${h_f} = 2.53{R_f}{\left( {\frac{{P{V_z}}}{A}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 2}}\right.}\!\lower0.7ex\hbox{$2$}}}}$$</div>

##### Sparrow Leeward

Sparrow et al. (1979) conducted flat plate measurements and develop the following correlation for finite-size flat plates oriented to leeward.

<div>$${h_f} = \frac{{2.53}}{2}{R_f}{\left( {\frac{{P{V_z}}}{A}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 2}}\right.}\!\lower0.7ex\hbox{$2$}}}}$$</div>

##### MoWITT Windward

As discussed above, Yazdanian and Klems (1994) used outdoor laboratory measurements to develop the following correlation for smooth surfaces oriented to windward. Booten et al. (2012) developed revised coefficients for use with local surface wind speeds.

<div>$${h_c} = \sqrt {{{\left[ {0.84{{\left| {\Delta T} \right|}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}} \right]}^2} + {{\left[ {2.38{\kern 1pt} {\kern 1pt} V_z^{0.89}} \right]}^2}} $$</div>

This model equation is for the total film coefficient and includes the natural convection portion. Therefore it should not be used in conjunction with a second natural convection model equation.

##### MoWITT Leeward

Yazdanian and Klems (1994) used outdoor laboratory measurements to develop the following correlation for smooth surfaces oriented to leeward. Booten et al. (2012) developed revised coefficients for use with local surface wind speeds.

<div>$${h_c} = \sqrt {{{\left[ {0.84{{\left| {\Delta T} \right|}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}} \right]}^2} + {{\left[ {2.86{\kern 1pt} {\kern 1pt} V_z^{0.617}} \right]}^2}} $$</div>

This model equation is for the total film coefficient and includes the natural convection portion. Therefore it should not be used in conjunction with a second natural convection model equation.

##### Blocken

Blocken et al. (2009) developed a set of correlations for windward facing outdoor surfaces using numerical methods (key: BlockenWindward).

<div>$$
  \begin{array}{lcl}
    h_f = 4.6V^{0.89}_{10m} & : & \theta \leq 11.25 \\
    h_f = 5.0V^{0.80}_{10m} & : & 11.25 < \theta \leq 33.75 \\
    h_f = 4.6V^{0.84}_{10m} & : & 33.75 < \theta \leq 56.25 \\
    h_f = 4.5V^{0.81}_{10m} & : & 56.25 < \theta \leq 100.0
  \end{array}
$$</div>

Where *V<sub>10m</sub>* is the air velocity at the location of the weather station and θ is the angle of incidence between the wind and the surface in degrees.  This model is only applicable to windward surfaces and lacks a natural convection component and therefore cannot be used on its own but only within the adaptive convection algorithm for the outside face.

##### Clear

Clear et al. (2003) developed correlations from measurements for horizontal roofs on two commercial buildings. In EnergyPlus the implementation uses the model for natural convection plus turbulent forced convection (eq. 8A in the reference) and applies it to the center point of each surface section that makes up the roof.

<div>$${h_c} = \eta \frac{k}{{{L_n}}}0.15Ra_{{L_n}}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}} + \frac{k}{x}{R_f}0.0296{\mathop{\rm Re}\nolimits}_x^{{\raise0.7ex\hbox{$4$} \!\mathord{\left/ {\vphantom {4 5}}\right.}\!\lower0.7ex\hbox{$5$}}}{\Pr ^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}$$</div>

Where

* *x* is the distance to the surface centroid from where the wind begins to intersect the roof. In EnergyPlus this is currently simplified to half the square root of the roof surface.

* <span>${L_n} = \frac{{Area}}{{Perimeter}}$</span> of overall roof

* <span>$k$</span> is the thermal conductivity of air

* <span>$\eta  = \frac{ln\left(1+\frac{Gr_{L,x}}{Re_x^2}\right)} {1+ln\left(1+\frac{Gr_{L,x}}{Re_x^2}\right)} is the weighting factor for natural convection (suppressed at high forced convection rates)

* <span>$R{a_{{L_n}}} = G{r_{{L_n}}}\Pr $</span> is the Rayleigh number

* <span>$G{r_{{L_n}}} = \frac{{g{\rho ^2}{L_n}^3\Delta T}}{{{T_f}{\mu ^2}}}$</span>is the Grashof number

* <span>${{\mathop{\rm Re}\nolimits}_x} = \frac{{{V_z}\rho x}}{\mu }$</span>is the Reynolds number at x

* Pr is the Prandtl number

This model only claims to be applicable to horizontal roof surfaces so it may not be applicable to tilted roofs. It combines natural and forced convection and therefore should not be used in conjunction with yet another natural convection model.

##### Emmel

Emmel et al. (2007) developed a set of correlations for outdoor surfaces using numerical methods.  The following equations are for vertical surfaces (key: EmmelVertical):

<div>$$
  \begin{array}{lcl}
    h_f = 5.15V^{0.81}_{10m} & : & \theta \leq 22.5 \\
    h_f = 3.34V^{0.84}_{10m} & : & 22.5 < \theta \leq 67.5 \\
    h_f = 4.78V^{0.71}_{10m} & : & 67.5 < \theta \leq 112.5 \\
    h_f = 4.05V^{0.77}_{10m} & : & 112.5 < \theta \leq 157.5 \\
    h_f = 3.54V^{0.76}_{10m} & : & 157.5 < \theta \leq 180.0
  \end{array}
$$</div>

Where *V<sub>10m</sub>* is the air velocity at the location of the weather station and θ is the angle of incidence between the wind and the surface in degrees.  The following equations are used for horizontal (roof) surfaces (key: EmmelRoof):

<div>$$
  \begin{array}{lcl}
    h_f = 5.11V^{0.78}_{10m} & : & \theta \leq 22.5 \\
    h_f = 4.60V^{0.79}_{10m} & : & 22.5 < \theta \leq 67.5 \\
    h_f = 3.67V^{0.85}_{10m} & : & 67.5 < \theta \leq 90
  \end{array}
$$</div>

Where θ is the angle of incidence between the wind and the longest edge of the roof surface in degrees.

This model is for all wind directions but lacks a natural convection component.  The model was developed for simple, rectangular low-rise buildings.  It is available only within the adaptive convection algorithm for the outside face

##### Nusselt Jurges

Perhaps the oldest equation for wind-driven convection was developed by Nusselt and Jurges (1922).  Palyvos (2008) casts their model in simplified form in SI units as:

<div>$${h_c} = 5.8 + 3.94\;{V_z}$$</div>

Where *V<sub>z</sub>* is the wind velocity in m/s, in EnergyPlus that velocity is adjusted for height above ground using the z axis coordinate of the surface’s centroid and the site wind model.  This model can be applied to all surfaces and the relatively large constant is assumed to represent the natural convection portion of a total convection coefficient.  The model is not sensitive to wind direction nor surface roughness.

##### McAdams

A venerable equation for wind-driven convection was developed by McAdams (1954) which Palyvos (2008) casts in SI units as:

<div>$${h_c} = 5.7 + 3.8\;{V_z}$$</div>

Where *V<sub>z</sub>* is the wind velocity in m/s that has been adjusted for height above ground using the z axis coordinate of the surface’s centroid.  This model can be applied to all surfaces and the relatively large constant is assumed to represent the natural convection portion of a total convection coefficient.  The model is not sensitive to wind direction nor surface roughness.

##### Mitchell

A useful geometric scale based on building volume is used in an equation developed by Mitchell (1976).  The wind-driven convection equation is cast by Palyvos as:

<div>$${h_f} = \frac{{8.6\;V_z^{0.6}}}{{{L^{0.4}}}}$$</div>

Where *V<sub>z</sub>* is the wind velocity in m/s that has been adjusted for height above ground using the z axis coordinate of the surface’s centroid and *L* is the cube root of the building’s total volume. EnergyPlus interprets this as the sum of the volume of all the zones in the input file.

### Exterior/External Conduction

The conduction term, <span>${q''_{ko}}$</span><sub>,</sub> can in theory be calculated using a wide variety of heat conduction formulations. Typically in EnergyPlus, the Conduction Transfer Function (CTF) method is used. The available models are described in this section: Conduction Through The Walls.

### References

ASHRAE. 1981. 1981 ASHRAE Handbook – Fundamentals, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

ASHRAE. 1989. 1989 ASHRAE Handbook – Fundamentals, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

ASHRAE. 1993. 1993 ASHRAE Handbook – Fundamentals, Chapter 3, Heat Transfer, I-P & S-I Editions, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

ASHRAE. 2001. 2001 ASHRAE Handbook – Fundamentals, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

ASHRAE. 2005. 2005 ASHRAE Handbook – Fundamentals, Chapter 16, Air Flow Around Buildings, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

Booten, C., N. Kruis, and C. Christensen. 2012. Identifying and Resolving Issues in EnergyPlus and DOE-2 Window Heat Transfer Calculations. National Renewable Energy Laboratory. NREL/TP-5500-55787. Golden, CO.

Cole, R. J., and N. S. Sturrock. 1977. The Convective Heat Exchange at the External Surface of Buildings. Building and Environment, Vol. 12, p. 207.

Ellis, P.G., and P.A. Torcellini. 2005. "Simulating Tall Buildings Using EnergyPlus", Proceedings of the Ninth International IBPSA Conference, Building Simulation 2005, Montreal, Canada, August 15-18, 2005.

Lawrence Berkeley Laboratory (LBL). 1994. DOE2.1E-053 source code.

Sparrow, E. M., J. W. Ramsey, and E. A. Mass. 1979. Effect of Finite Width on Heat Transfer and Fluid Flow about an Inclined Rectangular Plate. Journal of Heat Transfer, Vol. 101, p. 204.

U.S. Standard Atmosphere. 1976. U.S. Government Printing Office, Washington, D.C.

Walton, G. N. 1981. Passive Solar Extension of the Building Loads Analysis and System Thermodynamics (BLAST) Program, Technical Report, United States Army Construction Engineering Research Laboratory, Champaign, IL.

Walton, G. N. 1983. Thermal Analysis Research Program Reference Manual. NBSSIR 83-2655. National Bureau of Standards.

Yazdanian, M. and J. H. Klems. 1994. Measurement of the Exterior Convective Film Coefficient for Windows in Low-Rise Buildings. ASHRAE Transactions, Vol. 100, Part 1, p. 1087.

Inside Heat Balance
-------------------

The heart of the heat balance method is the internal heat balance involving the inside faces of the zone surfaces.  This heat balance is generally modeled with four coupled heat transfer components: 1) conduction through the building element, 2) convection to the air, 3) short wave radiation absorption and reflectance and 4) longwave radiant interchange.  The incident short wave radiation is from the solar radiation entering the zone through windows and emittance from internal sources such as lights.  The longwave radiation interchange includes the absorption and emittance of low temperature radiation sources, such as all other zone surfaces, equipment, and people.

The heat balance on the inside face can be written as follows:

<div>$${q''_{LWX}} + {q''_{SW}} + {q''_{LWS}} + {q''_{ki}} + {q''_{sol}} + {q''_{conv}} = 0$$</div>

where:

<span>${q''_{LWX}}$</span>= Net longwave radiant exchange flux between zone surfaces.

<span>${q''_{SW}}$</span> = Net short wave radiation flux to surface from lights.

<span>${q''_{LWS}}$</span>= Longwave radiation flux from equipment in zone.

<span>${q''_{ki}}$</span> = Conduction flux through the wall.

<span>${q''_{sol}}$</span> = Transmitted solar radiation flux absorbed at surface.

<span>${q''_{conv}}$</span> = Convective heat flux to zone air.

Each of these heat balance components is introduced briefly below.

![](EngineeringReference/media/image301.png)

Figure 19.  Inside Heat Balance Control Volume Diagram

### Internal Long-Wave Radiation Exchange

#### LW Radiation Exchange Among Zone Surfaces

There are two limiting cases for internal LW radiation exchange that are easily modeled:

nThe zone air is completely transparent to LW radiation.

nThe zone air completely absorbs LW radiation from the surfaces within the zone.

The limiting case of completely absorbing air has been used for load calculations and also in some energy analysis calculations.  This model is attractive because it can be formulated simply using a combined radiation and convection heat transfer coefficient from each surface to the zone air.  However, it oversimplifies the zone surface exchange problem, and as a result, the heat balance formulation in EnergyPlus treats air as completely transparent.  This means that it does not participate in the LW radiation exchange among the surfaces in the zone. The model, which considers room air to be completely transparent, is reasonable physically because of the low water vapor concentrations and the short mean path lengths.  It also permits separating the radiant and convective parts of the heat transfer at the surface, which is an important attribute of the heat balance method.

EnergyPlus uses a grey interchange model for the longwave radiation among zone surfaces.  This model is based on the “ScriptF” concept developed by Hottel (Hottel and Sarofim, Radiative Transfer, Chapter 3, McGraw Hill, 1967).  This procedure relies on a matrix of exchange coefficients between pairs of surfaces that include all exchange paths between the surfaces.  In other words all reflections, absorptions and re-emissions  from other surfaces in the enclosure are included in the exchange coefficient, which is called ScriptF.  The major assumptions are that all surface radiation properties are grey and all radiation is diffuse.  Both assumptions are reasonable for building zone interchange.

 The ScriptF coefficients are developed by starting with the traditional direct radiation view factors.  In the case of building rooms and zones, there are several complicating factors in finding the direct view factors-–the main one being that the location of surfaces such as thermal mass representing furniture and partitions are not known.  The other limitation is that the exact calculation of direct view factors is computationally very intensive even if the positions of all surfaces are known. Accordingly, EnergyPlus uses a procedure to approximate the direct view factors.  The procedure has two steps:

1)   Determine the total area of other surfaces “seen” by a surface.

2)   Approximate the direct view factor from surface 1 to surface 2 as the ratio of the area of surface 2 to the total area “seen” by surface 1.

The determination of the “seen” area has several constraints:

·        No surface sees itself.

·        All surfaces see thermal mass surfaces.

·        No surface facing within 10 degrees of another surface is seen by the other surface.

·        All surfaces see roofs, floors and ceilings (subject to the preceding facing direction constraint).

Because the approximate view factors may not satisfy the basic requirements of reciprocity (two surfaces should exchange equal amounts of heat in each direction), and completeness (every surface should have a direct view factor sum of 1.0), EnergyPlus does a view factor fix operation before they are used in the ScriptF determination.  Normally both of the requirements are satisfied, but in some special situations they are not, and special rules are applied.

·        If a user includes less than four surfaces in a zone, only reciprocity is enforced.

·        If the area of one surface in a zone is greater than the sum of the areas of all other surfaces, reciprocity only is enforced, but sometimes, for very large surfaces, that enforcement becomes impossible, and the view factors are modified so that only the large surface is seen by very small surfaces.

Warning messages are produced for both of these cases, and the results should be examined very carefully to ascertain that they are reasonable.   The suggested action for the second case (the extra-large surface) is to divide the large surface into several smaller surfaces; then the enclosure will be treated as normal.

Once the ScriptF coefficients are determined, the longwave radiant exchange is calculated for each surface using:

<div>$${q_{i,j}} = {A_i}{F_{i,j}}\left( {T_i^4 - T_j^4} \right)$$</div>

where ***F***<sub>i,j</sub> is the ScriptF between surfaces i and j.

#### Thermal Mass and Furniture

Furniture in a zone has the effect of increasing the amount of surface area that can participate in the radiation and convection heat exchanges.  It also adds participating thermal mass to the zone.  These two changes both affect the response to temperature changes in the zone and also affect the heat extraction characteristics.

The proper modeling of furniture is an area that needs further research, but the heat balance formulation allows the effect to be modeled in a realistic manner by including the furniture surface area and thermal mass in the heat exchange process.

#### LW Radiation From Internal Sources

The traditional model for this source is to define a radiative/convective split for the heat introduced into a zone from equipment.  The radiative part is then distributed over the surfaces within the zone in some prescribed manner.  This, of course, is not a completely realistic model, and it departs from the heat balance principles. However, it is virtually impossible to treat this source in any more detail since the alternative would require knowledge of the placement and surface temperatures of all equipment.

### Internal Short-Wave Radiation

#### SW Radiation from Lights

The short wavelength radiation from lights is distributed over the surfaces in the zone in some prescribed manner.

#### Transmitted Solar

Transmitted solar radiation is also distributed over the surfaces in the zone in a prescribed manner.  It would be possible to calculate the actual position of beam solar radiation, but that would involve partial surface irradiation, which is inconsistent with the rest of the zone model that assumes uniform conditions over an entire surface.  The current procedures incorporate a set of prescribed distributions.  Since the heat balance approach can deal with any distribution function, it is possible to change the distribution function if it seems appropriate.

#### Convection to Zone Air

The convection flux is calculated using the heat transfer coefficients as follows:

<span>${q''_{conv}} = {h_c}({T_s} - {T_a})$</span>                                                                                      (89)

The inside convection coefficients (*h<sub>c</sub>*) can be calculated using one of many different models.  Currently the implementation uses coefficients based on correlations for natural, mixed, and forced convection.

### Interior Conduction

This contribution to the inside surface heat balance is the wall conduction term, <span>${q''_{ki}}$</span> shown in Equation (30).  This represents the heat transfer to the inside face of the building element. Again, a CTF formulation is used to determine this heat flux.

### Interior Convection

There are many different modeling options available in EnergyPlus for inside convection coefficients, *h<sub>c</sub>*.  There are four different settings to direct how EnergyPlus managers select *h<sub>c</sub>* models during a simulation.  There are numerous individual model equations for *h<sub>c</sub>* in EnergyPlus to cover different situations that arise from surface orientations, room airflow conditions, and heat flow direction.  Additionally, in many cases multiple researchers have developed competing models for the same situations that differ and there is no way to declare one is better than another.  An overall default for the simulation is selected in the “SurfaceConvectionAlgorithm:Inside” object and can be overridden by selecting a different option in a zone description.  These models are explained in the following sections. In addition to the correlation choices described below, it is also possible to override the convection coefficients on the inside of any surface by using the “SurfaceProperty:ConvectionCoefficients” object in the input file to set the convection coefficient value on the inside of any surface. The values can be specified directly or with schedules. Specific details are given in the Input Output Reference document.

#### Adaptive Convection Algorithm

Beausoleil-Morrison (2000, 2002) developed a methodology for dynamically managing the selection of *h<sub>c</sub>* equations called *adaptive convection algorithm*.  The algorithm is used to select among the available *h<sub>c</sub>* equations for the one that is most appropriate for a given surface at a given time.  As Beausoleil-Morrison notes, the adaptive convection algorithm is intended to be expanded and altered to reflect different classification schemes and/or new *h<sub>c</sub>* equations.  The implementation in EnergyPlus has been modified from the original in the following ways:

* An input mechanism is provided (see the SurfaceConvectionAlgorithm:Inside:AdapativeModelSelections object) so that the user can customize the specific selections of *h<sub>c</sub>* equations that are applied for different flow regimes and surface orientations.  The changes apply in a general way to the entire model (but can be overridden by setting surface properties).

* To avoid requiring additional user input on the position of ZoneHVAC-type equipment within a zone, there is no distinction between zones that have convective zone heater equipment located underneath the windows and those that have convective heaters located away from the windows.  This applies to the air flow regime associated with convective zone heaters.  Using Beausoleil-Morrison’s terminology, regimes B1 and B2 are combined into just one B regime.

* To avoid requiring additional user input on the position of ZoneHVAC-type equipment within a zone, there is no distinction between surfaces that are directly blown on the fan and those that are away from the fan for the air flow regime associated with mechanical circulation from a zone fan (ZoneHVAC type equipment).

* The correlation for horizontal free jet developed by Fisher (1995) is not used.  Ceiling diffuser models are used for all mechanical circulation from central air system.  This decision was made for two reasons: (1) to avoid requiring additional user input on the position of, and momentum generated by, air terminal units, and (2) because Fisher (1995) found that the Coanda effect is so significant that in practice a free horizontal jet is difficult to maintain and mechanical-driven room airflows generally attach to surfaces and tend to match the flow regime of a ceiling diffuser much more often than a free jet.

* EnergyPlus supports arbitrary geometry so surfaces can be tilted with respect to vertical or horizontal.  Beausoleil-Morrison’s adaptive convection algorithm was originally structured to use *h<sub>c</sub>* equations that have no functional dependence on surface tilt angle.  However, tilted surfaces do perform differently than vertical or horizontal surface when buoyancy forces are significant.  Therefore, the EnergyPlus implementation expands the structure of the algorithm to include additional categories for tilted surfaces.  The *h<sub>c</sub>* equations developed by Walton (1983) are selected as the defaults for tilted surfaces because they have a functional dependence on tilt angle.

* Fohanno and Polidari (2006) produced a new *h<sub>c</sub>* equation for vertical walls inside buildings with a simple buoyancy flow regime.  They used a theoretical approach based on integral formalism and uniform heat flux (rather than uniform temperature) that covers both laminar and turbulent flow situations.  In EnergyPlus, this model is selected as the default in place of the model by Alamdari and Hammond (1983) for vertical walls.

* Karadag (2009) produced a new *h<sub>c</sub>* equation for ceiling surfaces that are actively chilled.  He used computation fluid dynamics and various sized rooms and temperature conditions.  In EnergyPlus, this model is selected as the default for surfaces that have active, in-ceiling cooling (in place of the model by Alamdari and Hammond (1983) for unstable ceilings).

* International Standard Organization (ISO) completed Standard 15099-2003 which includes *h<sub>c</sub>* equations for the inside face of windows.  EnergyPlus strives to adhere to formal modeling Standards where possible.  Therefore the implementation includes a larger structure for the adaptive algorithm that includes additional categories for windows in all flow regimes and ISO 15099-2003 models are used as the default for windows in natural convection flow regimes.  The ISO 15099 model applies to various tilt angles.

* Goldstein and Novosalec (2010) produced new *h<sub>c</sub>* equations for forced air situations with ceiling slot diffusers along perimeters with significant glazing fractions.  They used experiments with full-sized test room.  These new equations are selected as the default for windows, ceilings and floors when there is an active central air system.

* Interior mass surfaces are assigned the *h<sub>c</sub>* equation that would apply (stable or unstable) to a horizontal, upward facing surface for each flow regime.

* The algorithm switches between forced, mixed, and natural flow regimes by calculating the Richardson number, Ri = Gr/Re^2, for the zone.  Large values of Ri indicate buoyancy dominates, while small values indicate forced flows dominate. To distinguish between opposing Zone unit type equipment (with fans) are assumed to force air up walls, and central air type equipment (with diffusers) are assumed to force air down walls.

The adaptive convection algorithm implemented in EnergyPlus for the inside face has a total of 45 different categories for surfaces and 29 different options for *h<sub>c</sub>* equation selections.  The following table summarizes the categories and the default assignments for *h<sub>c</sub>* equations.  The individual *h<sub>c</sub>* equations are documented below.

<table class="table table-striped">
  <caption>Table 13. Inside Convection Categories and Assignments</caption>
  <tr>
    <th>#</th>
    <th>Zone Air Flow Regime</th>
    <th>IB-M's #</th>
    <th>Surface orientation and heat flow direction</th>
    <th>Keywords for Applicable Model Equation Sources</th>
  </tr>
  <tr>
    <td>1</td>
    <td rowspan="10">Simple Buoyancy</td>
    <td rowspan="10">A3</td>
    <td rowspan="3">Vertical Walls</td>
    <td>FohannoPolidoriVerticalWall *</td>
  </tr>
  <tr>
    <td></td>
    <td>AlamdariHammondVerticalWall</td>
  </tr>
  <tr>
    <td></td>
    <td>ASHRAEVerticalWall</td>
  </tr>
  <tr>
    <td>2</td>
    <td rowspan="2">Stable Horizontal</td>
    <td>AlamdariHammondStableHorizontal *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonStableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>3</td>
    <td rowspan="2">Unstable Horizontal</td>
    <td>AlamdariHammondUnstableHorizontal *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>4</td>
    <td>Stable Tilted</td>
    <td>WaltonStableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>5</td>
    <td>Unstable Tilted</td>
    <td>WaltonUnstableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>6</td>
    <td>Windows</td>
    <td>ISO15099Windows *</td>
  </tr>
  <tr>
    <td>7</td>
    <td rowspan="17">In-floor Heating or In-ceiling Cooling</td>
    <td rowspan="17">A1</td>
    <td rowspan="4">Vertical Walls</td>
    <td>KhalifaEq3WallAwayFromHeat *</td>
  </tr>
  <tr>
    <td></td>
    <td>FohannoPolidoriVerticalWall</td>
  </tr>
  <tr>
    <td></td>
    <td>AlamdariHammondVerticalWall</td>
  </tr>
  <tr>
    <td></td>
    <td>ASHRAEVerticalWall</td>
  </tr>
  <tr>
    <td>8</td>
    <td rowspan="2">Stable Horizontal</td>
    <td>AlamdariHammondStableHorizontal *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonStableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>9</td>
    <td rowspan="3">Unstable Horizontal</td>
    <td>KhalifaEq4CeilingAwayFromHeat *</td>
  </tr>
  <tr>
    <td></td>
    <td>AlamdariHammondUnstableHorizontal</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>10</td>
    <td rowspan="3">Heated Floor</td>
    <td>AwbiHattonHeatedFloor *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td></td>
    <td>AlamdariHammondUnstableHorizontal</td>
  </tr>
  <tr>
    <td>11</td>
    <td rowspan="2">Chilled Ceiling</td>
    <td>KaradagChilledCeiling *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>12</td>
    <td>Stable Tilted</td>
    <td>WaltonStableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>13</td>
    <td>Unstable Tilted</td>
    <td>WaltonUnstableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>14</td>
    <td>Windows</td>
    <td>ISO15099Windows *</td>
  </tr>
  <tr>
    <td>15</td>
    <td rowspan="12">Wall Panel Heating</td>
    <td rowspan="12">A2</td>
    <td rowspan="3">Vertical Walls (non-heated)</td>
    <td>KhalifaEq6NonHeatedWalls *</td>
  </tr>
  <tr>
    <td></td>
    <td>FohannoPolidoriVerticalWall</td>
  </tr>
  <tr>
    <td></td>
    <td>ASHRAEVerticalWall</td>
  </tr>
  <tr>
    <td>16</td>
    <td>Heated Wall</td>
    <td>AwbiHattonHeatedWall *</td>
  </tr>
  <tr>
    <td>17</td>
    <td rowspan="2">Stable Horizontal</td>
    <td>AlamdariHammondStableHorizontal *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonStableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>18</td>
    <td rowspan="3">Unstable Horizontal</td>
    <td>KhalifaEq7Ceiling *</td>
  </tr>
  <tr>
    <td></td>
    <td>AlamdariHammondUnstableHorizontal</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>19</td>
    <td>Stable Tilted</td>
    <td>WaltonStableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>20</td>
    <td>Unstable Tilted</td>
    <td>WaltonUnstableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>21</td>
    <td>Windows</td>
    <td>ISO15099Windows *</td>
  </tr>
  <tr>
    <td>22</td>
    <td rowspan="14">Convective Zone Heater</td>
    <td rowspan="14">B</td>
    <td rowspan="5">Vertical Walls not near heater</td>
    <td>FohannoPolidoriVerticalWall *</td>
  </tr>
  <tr>
    <td></td>
    <td>KhalifaEq6NonHeatedWalls</td>
  </tr>
  <tr>
    <td></td>
    <td>KhalifaEq3WallAwayFromHeat</td>
  </tr>
  <tr>
    <td></td>
    <td>AlamdariHammondVerticalWall</td>
  </tr>
  <tr>
    <td></td>
    <td>ASHRAEVerticalWall</td>
  </tr>
  <tr>
    <td>23</td>
    <td>Vertical Walls near heater</td>
    <td>KhalifaEq5WallNearHeat *</td>
  </tr>
  <tr>
    <td>24</td>
    <td rowspan="2">Stable Horizontal</td>
    <td>AlamdariHammondStableHorizontal *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonStableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>25</td>
    <td rowspan="3">Unstable Horizontal</td>
    <td>KhalifaEq7Ceiling *</td>
  </tr>
  <tr>
    <td></td>
    <td>KhalifaEq4CeilingAwayFromHeat</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>26</td>
    <td>Stable Tilted</td>
    <td>WaltonStableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>27</td>
    <td>Unstable Tilted</td>
    <td>WaltonUnstableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>28</td>
    <td>Windows</td>
    <td>ISO15099Windows *</td>
  </tr>
  <tr>
    <td>29</td>
    <td rowspan="7">Mechanical Central Air Diffuser</td>
    <td rowspan="7">C</td>
    <td rowspan="2">Walls</td>
    <td>GoldsteinNovoselacCeilingDiffuserWalls *</td>
  </tr>
  <tr>
    <td></td>
    <td>FisherPedersenCeilingDiffuserWalls</td>
  </tr>
  <tr>
    <td>30</td>
    <td>Ceiling</td>
    <td>FisherPedersenCeilingDiffuserCeiling *</td>
  </tr>
  <tr>
    <td>31</td>
    <td rowspan="2">Floor</td>
    <td>GoldsteinNovoselacCeilingDiffuserFloor *</td>
  </tr>
  <tr>
    <td></td>
    <td>FisherPedersenCeilingDiffuserFloor</td>
  </tr>
  <tr>
    <td>32</td>
    <td rowspan="2">Windows</td>
    <td>GoldsteinNovoselacCeilingDiffuserWindow *</td>
  </tr>
  <tr>
    <td></td>
    <td>ISO15099Windows</td>
  </tr>
  <tr>
    <td>33</td>
    <td rowspan="9">Mechanical Zone Fan Circulation</td>
    <td rowspan="9">D</td>
    <td>Walls</td>
    <td>KhalifaEq3WallAwayFromHeat *</td>
  </tr>
  <tr>
    <td>34</td>
    <td rowspan="2">Stable Horizontal</td>
    <td>AlamdariHammondStableHorizontal *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonStableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>35</td>
    <td rowspan="2">Unstable Horizontal</td>
    <td>KhalifaEq4CeilingAwayFromHeat *</td>
  </tr>
  <tr>
    <td></td>
    <td>WaltonUnstableHorizontalOrTilt</td>
  </tr>
  <tr>
    <td>36</td>
    <td>Stable Tilted</td>
    <td>WaltonStableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>37</td>
    <td>Unstable Tilted</td>
    <td>WaltonUnstableHorizontalOrTilt *</td>
  </tr>
  <tr>
    <td>38</td>
    <td rowspan="2">Windows</td>
    <td>GoldsteinNovoselacCeilingDiffuserWindow *</td>
  </tr>
  <tr>
    <td></td>
    <td>ISO15099Windows</td>
  </tr>
  <tr>
    <td>39</td>
    <td rowspan="8">Mixed</td>
    <td rowspan="8">E</td>
    <td>Assisting Flow Walls</td>
    <td>BeausoleilMorrisonMixedAssistedWall *</td>
  </tr>
  <tr>
    <td>40</td>
    <td>Opposing Flow Walls</td>
    <td>BeausoleilMorrisonMixedOpposingWall *</td>
  </tr>
  <tr>
    <td>41</td>
    <td>Stable Floor</td>
    <td>BeausoleilMorrisonMixedStableFloor *</td>
  </tr>
  <tr>
    <td>42</td>
    <td>Unstable Floor</td>
    <td>BeausoleilMorrisonMixedUnstableFloor *</td>
  </tr>
  <tr>
    <td>43</td>
    <td>Stable Ceiling</td>
    <td>BeausoleilMorrisonMixedStableCeiling *</td>
  </tr>
  <tr>
    <td>44</td>
    <td>Unstable Ceiling</td>
    <td>BeausoleilMorrisonMixedUnstableCeiling *</td>
  </tr>
  <tr>
    <td>45</td>
    <td rowspan="2">Windows</td>
    <td>GoldsteinNovoselacCeilingDiffuserWindow *</td>
  </tr>
  <tr>
    <td></td>
    <td>ISO15099Windows</td>
  </tr>
</table>

\*Indicates the default selection for *h<sub>c</sub>* model equation.

#### Inside Face Surface Classification

The adaptive convection algorithm is based on classifying surfaces by flow regime and orientation so that the correct *h<sub>c</sub>* equation can be chosen at a particular point in time during the simulation.  The classification depends on user input with some aspects processed only once at the beginning and others during each timestep.  There are also various parameters or inputs to the *h<sub>c</sub>* equations that need static or dynamic processing.

For each surface, it and the zone it is attached to are processed for the following static characteristics.

* Characteristic height for convection is taken as the zone height.

* Surfaces listed as receiving heat from Zone HVAC equipment with radiative models are considered “near” the heater.

* Zones are examined for low temperature radiant systems.  The surfaces that contain the active elements are examined and the zone characterized to know if it has in-floor heating, in-ceiling cooling, or in-wall heating.

* A hydraulic diameter is calculated for horizontal surfaces for the entire zone.

and calculating various parameters needed by *h<sub>c</sub>* equations.  Selecting flow regime is done in the following manner.  For each surface, we examine the zone on the inside face for the following:

* HVAC system type

* HVAC operating status

* HVAC system ACH

The surfaces are evaluated to determine:

* Surface classification: Floor, wall, roof, window, types

* Tilt angle

* Convective stability (sign of ΔT)

The individual *h<sub>c</sub>* model equations and their respective references are listed in next by the keyword used to identify them.

#### ASHRAE Vertical Wall

Walton adopted the following equation for natural convection from ASHRAE .

<div>$$h = 1.31{\left| {\Delta T} \right|^{\frac{1}{3}}}$$</div>

This is usually bound at a minimum of .1 in EnergyPlus. This is a component of the TARP overall algorithm described below.

#### Walton Unstable Horizontal Or Tilt

Walton (11983) developed the following equation by fitting curves from various sources.

<div>$$h = \frac{{9.482{{\left| {\Delta T} \right|}^{\frac{1}{3}}}}}{{7.283 - \left| {\cos \Sigma } \right|}}$$</div>

Unstable refers to the direction of heat flow and the associated buoyancy relative to the surfaces. Unstable is when the natural tendency is to enhance flow in the sense that rising warmer air, or falling cooler air, is free to move away from the surface. This is usually bound at a minimum of .1 in EnergyPlus. This is a component of the TARP overall algorithm described below.

#### Walton Stable Horizontal Or Tilt

Walton (11983) developed the following equation by fitting curves from various sources.

<div>$$h = \frac{{1.810{{\left| {\Delta T} \right|}^{\frac{1}{3}}}}}{{1.382 + \left| {\cos \Sigma } \right|}}$$</div>

Stable refers to the direction of heat flow and the associated buoyancy relative to the surfaces. Stable is when the natural tendency is to retard flow in the sense that rising warmer air, or falling cooler air, is driven against the surface. This is usually bound at a minimum of .1 in EnergyPlus. This is a component of the TARP overall algorithm described below.

#### Fisher Pedersen Ceiling Diffuser Walls

Fisher and Pedersen 1997) developed the following equation from laboratory chamber measurements.

<div>$$h = 1.208 + 1.012 * AC{H^{0.604}}$$</div>

This is a component of the CeilingDiffuser overall algorithm described below.

#### Fisher Pedersen Ceiling Diffuser Ceiling

Fisher and Pedersen (1997) developed the following equation from laboratory chamber measurements.

<div>$$h = 2.234 + 4.099 * AC{H^{0.503}}$$</div>

This is a component of the CeilingDiffuser overall algorithm described below.

#### Fisher Pedersen Ceiling Diffuser Floor

Fisher and Pedersen 1997) developed the following equation from laboratory chamber measurements.

<div>$$h = 3.873 + 0.082 * AC{H^{0.98}}$$</div>

This is a component of the CeilingDiffuser overall algorithm described below.

#### Alamdari Hammond Stable Horizontal

Alamdari and Hammond (1983) developed the following correlation for horizontal surfaces in stable thermal situation.

<div>$$h = 0.6{\left( {\frac{{\left| {\Delta T} \right|}}{{D_h^2}}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}}}$$</div>

where,

<span>${D_h} = \frac{{4A}}{P}$</span>, hydraulic diameter of horizontal surface, *A* is area (m<sup>2</sup>) and *P* is the perimeter (m) of the entire zone.

#### Alamdari Hammond Unstable Horizontal

Alamdari and Hammond (1983) developed the following correlation for horizontal surfaces in a buoyant thermal situation.

<div>$$h = {\left\{ {{{\left[ {1.4{{\left( {\frac{{\left| {\Delta T} \right|}}{{{D_h}}}} \right)}^{^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}}}} \right]}^6} + {{\left[ {1.63{{\left| {\Delta T} \right|}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}} \right]}^6}} \right\}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 6}}\right.}\!\lower0.7ex\hbox{$6$}}}}$$</div>

#### Alamdari Hammond Vertical Wall

Alamdari and Hammond (1983) developed the following correlation for vertical surfaces.

<div>$$h = {\left\{ {{{\left[ {1.5{{\left( {\frac{{\left| {\Delta T} \right|}}{H}} \right)}^{^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}}}} \right]}^6} + {{\left[ {1.23{{\left| {\Delta T} \right|}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}} \right]}^6}} \right\}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 6}}\right.}\!\lower0.7ex\hbox{$6$}}}}$$</div>

where,

      *H* is the characteristic height for the surface.  In EnergyPlus this is the zone’s ceiling height (which could be larger than the height of an individual surface when wall are subdivided into more than one surface).

#### Khalifa Eq3 Wall Away From Heat

Khalifa (1989) conducted experiments with test chambers and developed correlations for certain types of surfaces.  One of them, identified as “Equation 3” in original reference, is for convectively heated zones and applies to the inside surfaces of walls away from the heat source:

<div>$$h = 2.07{\left| {\Delta T} \right|^{0.23}}$$</div>

#### Khalifa Eq4 Ceiling Away From Heat

Khalifa (1989) conducted experiments with test chambers and developed correlations for certain types of surfaces.  One of them, identified as “Equation 4” in original reference, is for convectively heated zones and applies to the inside surfaces of ceilings away from the heat source:

<div>$$h = 2.72{\left| {\Delta T} \right|^{0.13}}$$</div>

#### Khalifa Eq5 Wall Near Heat

Khalifa (1989) conducted experiments with test chambers and developed correlations for certain types of surfaces.  One of them, identified as “Equation 5” in original reference, is for convectively heated zones and applies to the inside surfaces of walls near the heat source:

<div>$$h = 1.98{\left| {\Delta T} \right|^{0.32}}$$</div>

#### Khalifa Eq6 Non Heated Walls

Khalifa (1989) conducted experiments with test chambers and developed correlations for certain types of surfaces.  One of them, identified as “Equation 6” in original reference, is for heated zones and applies to the inside surfaces of walls that are not heated:

<div>$$h = 2.30{\left| {\Delta T} \right|^{0.24}}$$</div>

#### Khalifa Eq7 Ceiling

Khalifa (1989) conducted experiments with test chambers and developed correlations for certain types of surfaces.  One of them, identified as “Equation 7” in original reference, is for heated zones and applies to the inside surfaces of ceilings:

<div>$$h = 3.10{\left| {\Delta T} \right|^{0.17}}$$</div>

#### Awbi Hatton Heated Floor

Awbi and Hatton (1999) conducted laboratory measurements using environmental chambers and developed the following correlation for floor surfaces that are being actively heated.

<div>$$h = \frac{{2.175{{\left| {\Delta T} \right|}^{0.308}}}}{{D_h^{0.076}}}$$</div>

where,

<span>${D_h} = \frac{{4A}}{P}$</span> , hydraulic diameter of horizontal surface, *A* is area (m<sup>2</sup>) and *P* is the perimeter (m) of the entire zone (all of the adjacent floor surfaces if more than one in the zone).

#### Awbi Hatton Heated Wall

Awbi and Hatton (1999) developed the following correlation for wall surfaces that are being actively heated.

<div>$$h = \frac{{1.823{{\left| {\Delta T} \right|}^{0.293}}}}{{D_h^{0.076}}}$$</div>

where,

<span>${D_h} = \frac{{4A}}{P}$</span> , hydraulic diameter of wall surface, *A* is area (m<sup>2</sup>) and *P* is the perimeter (m) of the entire wall (all of the adjacent wall surfaces if more than one along the wall).

#### Beausoleil Morrison Mixed Assisted Wall

Beausoleil-Morrison (2000) used blending techniques to combine correlations originally developed by Alamdari and Hammond (1983) and Fisher and Pedersen (1997) to create the following correlation is for walls where the flow driving forces from mechanical forces are augmented by the driving forces from buoyancy.

<div>
$$
h = \left( 
\left\{
\left[1.5\left(\frac{\left|\Delta T\right|}{H}\right)^{1/4}\right]^6 +
\left[1.23\left|\Delta T\right|^2\right]^{1/6}
\right\}^{1/2} + 
\left\{
\left[\frac{T_{surf}-T_{SAT}}{\left|\Delta T\right|}\right]
\left[-0.199+0.190\cdot ACH^{0.8}\right]
\right\}^3
\right)^{1/3}
$$
</div>

where,

      *T<sub>SAT</sub>* is the supply air temperature at the diffuser.

Here the reference temperature is the zone air temperature rather than the diffuser supply air temperature.

#### Beausoleil Morrison Mixed Opposing Wall

Beausoleil-Morrison (2000) used blending techniques to combine correlations originally developed by Alamdari and Hammond (1983) and Fisher and Pedersen (1997) to create the following correlation is for walls where the flow driving forces from mechanical forces are opposed by the driving forces from buoyancy.

<div>
$$
h = \max \left\{
\begin{array}{l}
\left(\left\{\left[1.5\left(\frac{\left|\Delta T\right|}{H}\right)^{1/4}\right]^6+\left[1.23\left|\Delta T\right|^2\right]^{1/6}\right\}^{1/2}-\left\{\left[\frac{T_{surf}-T_{SAT}}{\left|\Delta T\right|}\right]\cdot\left[-0.199+0.190\cdot ACH^{0.8}\right]\right\}^3\right)^{1/3} \\
0.8\cdot \left\{\left[1.5\left(\frac{\left|\Delta T\right|}{H}\right)^{1/4}\right]^6+\left[1.23\left|\Delta T\right|^2\right]\right\}^{1/6} \\
0.8\cdot \left\{\left[\frac{T_{surf}-T_{SAT}}{\left|\Delta T\right|}\right]\cdot\left[-0.199+0.190\cdot ACH^{0.8}\right]\right\}
\end{array}
\right.
$$
</div>

#### Beausoleil Morrison Mixed Stable Floor

Beausoleil-Morrison (2000) used blending techniques to combine correlations originally developed by Alamdari and Hammond (1983) and Fisher and Pedersen (1997) to create the following correlation is for floors where the flow driving forces include both mechanical forces and thermally stable buoyancy.

<div>$$h = {\left( {{{\left\{ {0.6 \cdot {{\left( {\frac{{\left| {\Delta T} \right|}}{{{D_H}}}} \right)}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}}}} \right\}}^3} + {{\left\{ {\left[ {\frac{{{T_{surf}} - {T_{SAT}}}}{{\left| {\Delta T} \right|}}} \right]\cdot\left[ {0.159 + 0.116AC{H^{0.8}}} \right]} \right\}}^3}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}$$</div>

#### Beausoleil Morrison Mixed Unstable Floor

Beausoleil-Morrison (2000) used blending techniques to combine correlations originally developed by Alamdari and Hammond (1983) and Fisher and Pedersen (1997) to create the following correlation is for floors where the flow driving forces include both mechanical forces and thermally unstable buoyancy.

<div>$$h = {\left( {{{\left\{ {{{\left[ {1.4{{\left( {\frac{{\left| {\Delta T} \right|}}{{{D_h}}}} \right)}^{^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}}}} \right]}^6} + {{\left[ {1.63{{\left| {\Delta T} \right|}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}} \right]}^6}} \right\}}^{{\raise0.7ex\hbox{$3$} \!\mathord{\left/ {\vphantom {3 6}}\right.}\!\lower0.7ex\hbox{$6$}}}} + {{\left\{ {\left[ {\frac{{{T_{surf}} - {T_{SAT}}}}{{\left| {\Delta T} \right|}}} \right]\cdot\left[ {0.159 + 0.116AC{H^{0.8}}} \right]} \right\}}^3}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}$$</div>

#### Beausoleil Morrison Mixed Stable Ceiling

Beausoleil-Morrison (2000) used blending techniques to combine correlations originally developed by Alamdari and Hammond (1983) and Fisher and Pedersen (1997) to create the following correlation is for ceilings where the flow driving forces include both mechanical forces and thermally Stable buoyancy.

<div>$$h = {\left( {{{\left\{ {0.6 \cdot {{\left( {\frac{{\left| {\Delta T} \right|}}{{{D_H}}}} \right)}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}}}} \right\}}^3} + {{\left\{ {\left[ {\frac{{{T_{surf}} - {T_{SAT}}}}{{\left| {\Delta T} \right|}}} \right]\cdot\left[ { - 0.166 + 0.484AC{H^{0.8}}} \right]} \right\}}^3}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}$$</div>

#### Beausoleil Morrison Mixed Unstable Ceiling

Beausoleil-Morrison (2000) used blending techniques to combine correlations originally developed by Alamdari and Hammond (1983) and Fisher and Pedersen (1997) to create the following correlation is for ceilings where the flow driving forces include both mechanical forces and thermally unstable buoyancy.

<div>
 $$
  h = \left(
   \left(
    \left[
     1.4 \left(
      \frac{
       \left|
        \Delta T
       \right|
      }{
       D_h
      }
     \right)^{1/4}
    \right]^6 +
    \left[
     1.63 \left|\Delta T\right|^{1/3}
    \right]^6
   \right)^{3/6} +
   \left(
    \left[
     \frac{
      T_{surf}-T_{SAT}
     }{
      \left|\Delta T\right|
     }
    \right]
    \cdot
    \left[
     -0.166 + 0.484 \cdot ACH^{0.8}
    \right]
   \right)^3
  \right)^{1/3}
 $$
</div>

#### Fohanno Polidori Vertical Wall

Fohanno and Polidori (2006) developed the following equation for *h<sub>c</sub>* for vertical walls under simple buoyancy flow conditions.

<div>$$h = \left\{ \begin{array}{l}1.332{\left( {\frac{{\left| {\Delta T} \right|}}{H}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}}\quad ,\quad Ra_H^* \le 6.3 \times {10^9}\\1.235{e^{\left( {0.0467H} \right)}}{\left| {\Delta T} \right|^{0.316}}\quad ,\quad Ra_H^* > 6.3 \times {10^9}\end{array} \right.$$</div>

where,

<div>$$Ra_H^* = \frac{{g{\beta_f}{{q''}_c}{H^4}}}{{{k_f}\nu_f^2}}{\Pr_f}$$</div>

#### Karadag Chilled Ceiling

Karadag (2009) used numerical methods to develop the following equation for *h<sub>c</sub>* for chilled-ceiling surfaces.

<div>$$h = 3.1{\left| {\Delta T} \right|^{0.22}}$$</div>

#### ISO 15099 Windows

ISO Standard 15099-2003 includes the equations for *h<sub>c</sub>* for room-side of windows and surfaces with any tilt angle and heat flow direction.  The ISO 15099 correlation is for still room air angle and is determined in terms of the Nusselt number, <span>$Nu$</span>, where

<div>$${h_i} = Nu\left( {\frac{\lambda }{H}} \right)$$</div>

where,

<span>$\lambda $</span> is the thermal conductivity of air, and

<span>$H$</span> is the height of the window.

The Rayleigh number based on height, <span>$R{a_H}$</span>, is calculated using,

<div>$$R{a_H} = \frac{{{\rho ^2}{H^3}g\,{c_p}\left| {{T_{surf,i}} - {T_{air}}} \right|}}{{{T_{m,f}}\mu \lambda }}$$</div>

where,

<span>$\rho $</span> is the density of air

<span>$g$</span> is the acceleration due to gravity,

<span>${c_p}$</span> is the specific heat of air,

<span>$\mu $</span> is the dynamic viscosity of air, and

<span>${T_{m,f}}$</span> is the mean film temperature in Kelvin given by,

<div>$${T_{m,f}} = {T_{air}} + \frac{1}{4}\left( {{T_{surf,i}} - {T_{air}}} \right)$$</div>

There are four cases for the Nusselt correlation that vary by the tilt angle in degrees, <span>$\gamma $</span>, and are based on heating conditions.  For cooling conditions (where <span>${T_{surf,i}} > {T_{air}}$</span>) the tilt angle is complemented so that <span>$\gamma  = 180 - \gamma $</span>

Case A. <span>${0^\circ } \le \gamma  < 15^\circ $</span>

<div>$$Nu = 0.13Ra_H^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}$$</div>

Case B. <span>$15^\circ  \le \gamma  \le 90^\circ $</span>

<div>$$R{a_{cv}} = 2.5 \times {10^5}{\left( {\frac{{{e^{0.72\gamma }}}}{{\sin \lambda }}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}}}$$</div>

<div>$$Nu = 0.56{\left( {R{a_H}\sin \gamma } \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}};\;for\;R{a_H} \le R{a_{CV}}$$</div>

<div>$$Nu = 0.13\left( {Ra_H^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}} - Ra_{CV}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}} \right) + 0.56{\left( {R{a_{CV}}\sin \gamma } \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}};\;R{a_H} > R{a_{CV}}$$</div>

Case C. <span>$90^\circ  < \gamma  \le 179^\circ $</span>

<div>$$Nu = 0.56{\left( {R{a_H}\sin \gamma } \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}};\;{10^5} \le R{a_H}\sin \gamma  < {10^{11}}$$</div>

Case D. <span>$179^\circ  < \gamma  \le 180^\circ $</span>

<div>$$Nu = 0.58Ra_H^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}};\;R{a_H} \le {10^{11}}$$</div>

The material properties are evaluated at the mean film temperature.  Standard EnergyPlus psychrometric functions are used for <span>$\rho $</span> and <span>${c_p}$</span>.  Thermal conductivity is calculated using,

<span>$\lambda  = 2.873 \times {10^{ - 3}} + 7.76 \times {10^{ - 8}}{T_{m,f}}$</span>.

Kinematic viscosity is calculated using,

<span>$\mu  = 3.723 \times {10^{ - 6}} + 4.94 \times {10^{ - 8}}{T_{m,f}}$</span>.

This correlation depends on the surface temperature of the room-side glazing surface and is therefore included inside the window heat balance iteration loop.

#### Goldstein Novoselac Ceiling Diffuser Window

Goldstein and Novoselac (2010) used laboratory chamber measurements to develop convection correlations for perimeter zones with highly glazed spaces served by overhead slot-diffuser-based air systems. The following are for bare windows in such spaces.

For WWR&lt;50% with window in upper part of wall:

<div>$$h = 0.117{\left( {\frac{{\dot V}}{L}} \right)^{0.8}}$$</div>

For WWR&lt;50% with window in lower part of wall

<div>$$h = 0.093{\left( {\frac{{\dot V}}{L}} \right)^{0.8}}$$</div>

For WWR &gt; 50%

<div>$$h = 0.103{\left( {\frac{{\dot V}}{L}} \right)^{0.8}}$$</div>

Where,

 WWR is the window to wall ratio.

 *L* is the length of exterior wall with glazing in the zone.

 <span>$\dot V$</span>is the air system flow rate in m<sup>3</sup>/s.

#### Goldstein Novoselac Ceiling Diffuser Walls

Goldstein and Novoselac (2010) used laboratory chamber measurements to develop convection correlations for perimeter zones with highly glazed spaces served by overhead slot-diffuser-based air systems. The following are for exterior walls in such spaces.

For walls located below a window

<div>$$h = 0.063{\left( {\frac{{\dot V}}{L}} \right)^{0.8}}$$</div>

For walls located above a window

<div>$$h = 0.093{\left( {\frac{{\dot V}}{L}} \right)^{0.8}}$$</div>

#### Goldstein Novoselac Ceiling Diffuser Floor

Goldstein and Novoselac (2010) used laboratory chamber measurements to develop convection correlations for perimeter zones with highly glazed spaces served by overhead slot-diffuser-based air systems. The following is for floors in such spaces.

<div>$$h = 0.048{\left( {\frac{{\dot V}}{L}} \right)^{0.8}}$$</div>

Separate from the above model structure, there are also other comprehensive algorithm structures which are described below.

#### TARP Algorithm

The comprehensive natural convection model, accessed using the keyword “TARP,” correlates the convective heat transfer coefficient to the surface orientation and the difference between the surface and zone air temperatures (where DT = Surface Temperature - Air Temperature).  The algorithm is taken directly from Walton (1983).  Walton derived his algorithm from ASHRAE literature which can now be found for example in the ASHRAE Handbook (HoF 2001), Table 5 on p. 3.12, which gives equations for natural convection heat transfer coefficients in the turbulent range for large, vertical plates and for large, horizontal plates facing upward when heated (or downward when cooled).   A note in the text also gives an approximation for large, horizontal plates facing downward when heated (or upward when cooled) recommending that it should be half of the facing upward value.  Walton adds a curve fit as a function of the cosine of the tilt angle to provide intermediate values between vertical and horizontal.  The curve fit values at the extremes match the ASHRAE values very well.

For no temperature difference OR a vertical surface the following correlation is used:

<span>$h = 1.31{\left| {\Delta T} \right|^{\frac{1}{3}}}$</span>                                                                                             (90)

For (DT &lt; 0.0 AND an upward facing surface)  OR  (DT &gt; 0.0 AND an downward facing surface) an enhanced convection correlation is used:

<span>$h = \frac{{9.482{{\left| {\Delta T} \right|}^{\frac{1}{3}}}}}{{7.283 - \left| {\cos \Sigma } \right|}}$</span>                                                                                     (91)

where S is the surface tilt angle.

For (DT &gt; 0.0 AND an upward facing surface)  OR  (DT &lt; 0.0 AND an downward facing surface) a reduced convection correlation is used:

<span>$h = \frac{{1.810{{\left| {\Delta T} \right|}^{\frac{1}{3}}}}}{{1.382 + \left| {\cos \Sigma } \right|}}$</span>                                                                                     (92)

where S is the surface tilt angle.

#### Simple Natural Convection Algorithm

The simple convection model uses constant coefficients for different heat transfer configurations, using the same criteria as the detailed model to determine reduced and enhanced convection.  The coefficients are also taken directly from Walton (1983).  Walton derived his coefficients from the surface conductances for e=0.90 found in the ASHRAE Handbook (1985) in Table 1 on p. 23.2.  The radiative heat transfer component was estimated at 1.02 \* 0.9 = 0.918 BTU/h-ft2-F and then subtracted off.  Finally the coefficients were converted to SI units to yield the values below.

For a vertical surface:

<div>$${\rm{h  =  3}}{\rm{.076}}$$</div>

For a horizontal surface with reduced convection:

<div>$${\rm{h  =  0}}{\rm{.948}}$$</div>

For a horizontal surface with enhanced  convection:

<div>$${\rm{h  =  4}}{\rm{.040}}$$</div>

For a tilted surface with reduced convection:

<div>$${\rm{h  =  2}}{\rm{.281}}$$</div>

For a tilted surface with enhanced convection:

<div>$${\rm{h  =  3}}{\rm{.870}}$$</div>

#### Ceiling Diffuser Algorithm

The ceiling diffuser algorithm is based on empirical correlations developed by Fisher and Pedersen (1997).  The correlation was reformulated to use the room outlet temperature as the reference temperature.  The correlations are shown below.

For Floors:

<span>$h = 3.873 + 0.082 * AC{H^{0.98}}$</span>                                                                      (93)

The correlation for floors is illustrated in the following figure:

![](EngineeringReference/media/image378.png)

Figure 1017.  Ceiling Diffuser Correlation for Floors

For ceilings:

<span>$h = 2.234 + 4.099 * AC{H^{0.503}}$</span>                                                                     (94)

The correlation for ceilings is illustrated in the following figure:

![](EngineeringReference/media/image380.png)

Figure 1018.  Ceiling Diffuser Correlation for Ceilings

For Walls:

<span>$h = 1.208 + 1.012 * AC{H^{0.604}}$</span>                                                                      (95)

The correlation for walls is illustrated in the following figure:

![](EngineeringReference/media/image382.png)

Figure 1019.  Ceiling Diffuser Correlation for Walls

#### Trombe Wall Algorithm

The Trombe wall algorithm is used to model convection in a "Trombe wall zone", i.e. the air space between the storage wall surface and the exterior glazing.  (See the later sections on Passive and Active Trombe Walls below for more information about Trombe walls.)  The algorithm is identical to the convection model (based on ISO 15099) used in Window5 for convection between glazing layers in multi-pane window systems.  The use of the algorithm for modeling an unvented Trombe wall has been validated against experimental data by Ellis (2003).

This algorithm gives the convection coefficients for air in a narrow vertical cavity that is sealed and not ventilated.  This applies both to the air gap in between panes of a window or to the air gap between the Trombe wall glazing and the inner surface (often a selective surface).  These convection coefficients are really the only difference between a normal zone and a Trombe zone.  The rest of the zone heat balance is the same, e.g., transmitted solar, long-wave radiation between surfaces, etc.

For a vertical cavity, the correlation from ISO 15099 is:

<span>${\rm{NU1 = 0}}{\rm{.0673838 R}}{{\rm{a}}^{{\textstyle{{\rm{1}} \over {\rm{3}}}}}}$</span>                                                        for 5E4 &lt; Ra &lt; 1E6

<span>${\rm{NU1 = 0}}{\rm{.028154 R}}{{\rm{a}}^{{\rm{0}}{\rm{.4134}}}}$</span>                                                     for 1E4 &lt; Ra &lt; 5E4

<span>${\rm{NU1 = 1 + 1}}{\rm{.7596678E - 10 R}}{{\rm{a}}^{{\rm{2}}{\rm{.2984755}}}}$</span>                                           for Ra &lt;= 1E4

<div>$${\rm{NU2}} = 0.242{\left( {{\raise0.7ex\hbox{${{\rm{Ra}}}$} \!\mathord{\left/ {\vphantom {{{\rm{Ra}}} {\rm{A}}}}\right.}\!\lower0.7ex\hbox{${\rm{A}}$}}} \right)^{0.272}}$$</div>

<div>$${\rm{NU = MAX(NU1,NU2)}}$$</div>

where

Nu = Nusselt number

Ra = Rayleigh number

A = aspect ratio of cavity

This is then used in EnergyPlus as follows:

Net convection coefficient from glazing to wall is:

<div>$${h_{net}} = {\rm{k}}\left( {{\raise0.7ex\hbox{${{\rm{NU}}}$} \!\mathord{\left/ {\vphantom {{{\rm{NU}}} {\rm{L}}}}\right.}\!\lower0.7ex\hbox{${\rm{L}}$}}} \right)$$</div>

where

k = conductivity of air

L = air gap thickness

Convection coefficient applied to each wall separately and actually used in the zone heat balance is:

<div>$${h_c} = 2{h_{net}}$$</div>

#### References

Alamdari, F. and G.P. Hammond. 1983. Improved data correlations for buoyancy-driven convection in rooms.  Building Services Engineering Research & Technology. Vol. 4, No. 3.

ASHRAE. 1985. 1985 ASHRAE Handbook – Fundamentals, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

ASHRAE. 2001. 2001 ASHRAE Handbook – Fundamentals, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

Awbi, H.B. and A. Hatton. 1999. Natural convection from heated room surfaces. Energy and Buildings 30 (1999) 233-244.

Beausoleil-Morrison, I. 2000. The adaptive coupling of heat and air flow modeling within dynamic whole-building simulations. PhD. Thesis. University of Strathclyde, Glasgow, UK.

Ellis, Peter G. 2003. Development and Validation of the Unvented Trombe Wall Model in EnergyPlus. Master's Thesis, University of Illinois at Urbana-Champaign.

Fisher, D.E. and C.O. Pedersen. 1997. "Convective Heat Transfer in Building Energy and Thermal Load Calculations", ASHRAE Transactions, Vol. 103, Pt. 2.

Fohanno, S., and G. Polidori. 2006. Modelling of natural convective heat transfer at an internal surface. Energy and Buildings 38 (2006) 548 - 553

Goldstein, K. and A. Novoselac. 2010. Convective Heat Transfer in Rooms With Ceiling Slot Diffusers (RP-1416). *HVAC&R Research Journal* TBD

Karadag, R. 2009. New approach relevant to total heat transfer coefficient including the effect of radiation and convection at the ceiling in a cooled ceiling room. Applied Thermal Engineering 29 (2009) 1561-1565

Khalifa AJN. 1989. Heat transfer processes in buildings. Ph.D. Thesis, University of Wales College of Cardiff, Cardiff, UK.

ISO. 2003. ISO 15099:2003. Thermal performance of windows, doors, and shading devices – Detailed calculations. International Organization for Standardization.

Walton, G. N. 1983. Thermal Analysis Research Program Reference Manual. NBSSIR 83-2655. National Bureau of Standards (now NIST). This is documentation for “TARP.”

Adiabatic Boundary Conditions
-----------------------------

Adiabatic boundary conditions are applied to two surface types in EnergyPlus:

1)   Surfaces with adiabatic outside boundary conditions

2)   Internal Mass objects

For both surface types, EnergyPlus will apply the same boundary conditions to each side of the construction so that there is no temperature difference across the surface. In this case, all heat transfer into the surface is a result of the dynamic response of the construction to varying inside boundary conditions. The surface will store and release heat only at the inside face of the surface (it is assumed that the outside face is not within the zone). If both faces are within the zone, this situation can be modeled either by creating another adiabatic or internal mass surface with the reverse construction, or, for symmetric constructions, simply doubling the area of the surface.

Infrared Radiation Transfer Material
------------------------------------

One of the important technical features of EnergyPlus is that the fundamental zone model includes infrared (IR) radiation exchange among all surfaces within the zone. A zone can consist of a single room or multiple rooms having similar thermal characteristics. The other fundamental characteristic of a zone in EnergyPlus is that the air within the zone is modeled with the assumption that it is well-stirred, so it is characterized by a single uniform air temperature. Normally, this corresponds to the desired physical state of the air within a zone. Practically, this is accomplished with the mixing caused by the air distribution system or even with the addition of ceiling fans. However, there are situations where the well-stirred model condition does not fit the physical conditions within a space (e.g., large atria spaces, displacement ventilation systems, and under floor air distribution systems). In these cases, the air temperature varies spatially within the zone, but the surfaces in the regions that have different air temperatures still exchange IR radiation with the other surfaces in the zone, even those in regions having a different air temperature.

Historically, several approaches have been taken to model such situations. They all involve unrealistically modifying the convective heat transfer characteristics within a single zone to produce reasonable total heat transfer for the zone while maintaining the zone IR radiation in its basic form. The IRT model takes a different, more fundamental approach. The space is divided into subzones, each having the basic well-stirred air model, but surfaces in these subzones are able to exchange IR radiation with other surfaces throughout the original space. Any convective air exchange between subzones is handled using the existing flexible capabilities within EnergyPlus. In other words, the subzones are standard EnergyPlus zones but they have been given the capability of allowing IR radiation to be exchanged with surfaces in adjacent zones.

The IR radiation exchange is accomplished by introducing special IR Transparent (IRT) surfaces to link adjacent zones. These surfaces transmit the IR radiation incident on them to the surfaces in adjacent zone. The special surfaces have no thermal resistance, and they also have zero convective heat transfer coefficients on both sides. Consider a stratified atrium as an example. The atrium would be divided into stacked vertical zones, with each zone having the special IRT surface between it and the next lower zone. All physical surfaces in the two zones exchange radiation with the IRT surface, but it does not impede the transfer of radiation from one zone to the other. On each side it interacts as a black body surface and any radiation incident on it is absorbed. Since it has no other heat transfer mechanisms, it comes to equilibrium with zero net radiation transfer.

Schematic diagrams of the application of the IRT surfaces are shown in Figure 20 and Figure 21. The first figure shows it applied between two stacked zones that could be part of an atrium. All radiation incident on the IRT in the lower and upper zone is completely absorbed by the surface. It is prevented from participating in the zone air heat balance by fixing the heat transfer coefficients on either side at zero.

![IRTFig1](EngineeringReference/media/image390.png)

Figure 20. Schematic View of Stacked Zones

The same arrangement can be used for simulating a underfloor air distribution system (UFAD). The two zones represent the lower occupied (mixed) zone and the upper stratified zone. Since the upper zone is being modeled as a mixed EnergyPlus zone, it is not precisely the stratified zone concept. However, if a user has concern about having the entire upper part of the space at a single average temperature, the space could be modeled with two stacked upper zones. In that case the stratified temperature profile would be established by the relative size of the mixing from the convective plumes. The user would have to supply those estimates from external knowledge of the behavior of UFAD systems and plumes.

![IRTFig2](EngineeringReference/media/image391.png)

Figure 21. Schematic Model of a UFAD Zone

### Radiation Exchange Basics

The behavior of the IRT surface can be analyzed by considering three parallel black plates infinite in extent, as shown in Figure 22. The outside plates are held at two different temperatures, and the intermediate plate assumes an equilibrium temperature when the net heat flux goes to zero. All plates have black body surface characteristics.

![IRTFig3](EngineeringReference/media/image392.png)

Figure 22. Radiation Exchange Model

The radiant exchange between surface 1 and 2 is:

<div>$${q_{1 - 2}} = \sigma A\left( {T_1^4 - T_2^4} \right)$$</div>

The exchange between surfaces 2 and 3 is:

<div>$${q_{2 - 3}} = \sigma A\left( {T_2^4 - T_3^4} \right)$$</div>

Equating heat fluxes and eliminating T<sub>2</sub> gives:

<div>$${q_{1 - 3}} = \frac{\sigma }{2}A\left( {T_1^4 - T_3^4} \right)$$</div>

where:

q is the heat flux in W/m<sup>2</sup>

σ is the Stephan Boltzman constant

A is the plate area in m<sup>2</sup>, and

T is the temperature in K.

Equation shows that the presence of a black body surface between a source and a sink reduces the heat flux by a factor of two. The same result occurs when the IRT surface is between two zones in EnergyPlus. In that case the adjacent zones behave as black body cavities at some equivalent temperature. In order to account for this reduction, the IRT area must be doubled. This can be done without any difficulty in the EnergyPlus radiant exchange routine because the radiation view factors are determined by an approximate procedure that is based on the areas of the surfaces. Thus, doubling the surface area of the IRT surface results in the correct transfer of radiation through the IRT surface. The doubling will occur automatically in the program as described in the Input Output Reference document.

It should be noted that, because of the black body behavior of the IRT surface, any visible or solar short wavelength radiation incident on the surface will be absorbed and included with the long wavelength (IR) exchange with the adjacent zone. No energy will be lost, but zones with IRT surfaces should not be used in any lighting analyses.

### Radiation Transfer Surface Details

#### Specifying an Infrared Transparent (IRT) surface

The Infrared Transparent (IRT) surface is similar to a resistance-only surface. The idd object for this type of surface is shown below. The fields indicate that the surface will actually participate in the transfer of visible and solar radiation by doing a wavelength transformation and making all short wavelength radiation that is incident on the surface into long wavelength radiation and having it participate in the long wavelength radiant exchange. The Material:InfraredTransparent object requires only a name. All other parameters are set internally.

The Infrared Transparent surface should not participate in a convective/conductive exchange between the zones it separates. In order to minimize this effect, the SurfaceProperty:ConvectionCoefficients object must be used. Outside and Inside values for the surface’s convection coefficients should be on the order of .1.  Further examples are given in the Input Output Reference document.

### Behavior Checks

The behavior of multi zones separated with infrared transparent surfaces can be checked with a simple comparison. Begin with a single zone model as shown below. This model has a south-facing window, and four walls exposed to wind and sun, and a roof exposed to wind and sun.

![SingleZoneDrawing](EngineeringReference/media/image396.png)

Figure 23. Single Zone Model

The single zone model will be compared with a stacked three zone model that has zones separated by interzone infrared transparent surfaces. This model is shown below.

![ThreeZone-bldgAreaSE-2](EngineeringReference/media/image397.png)

Figure 24. Stacked Three Zone Model

The two upper zones have south facing windows whose total area is the same as the area of the single window in the single zone model. The top and the sides are again exposed to sun and wind. The separating surfaces are modeled as IRT surfaces. All zones in both models are controlled at the same setpoint temperature using purchased air.

The sensible heating results are shown below. The results show the sum of the sensible cooling load for the three stacked zones and the single zone. It is clear that the IRT surfaces are very effective in transmitting infrared radiation between the zones. Some small differences, such as those shown, will occur because of the conversion from short wavelength solar to infrared through the special IRT dividing surfaces.



![Comparison of single and three stacked zones](EngineeringReference/media/image398.png)

Figure 25. Comparison of Single and Three Stacked Zones

Transparent Insulation Material (TIM)
-------------------------------------

### Introduction

The input object “SurfaceControl:MovableInsulation” allows modeling Transparent Insulation Materials (TIM) that were originally designed for use in solar collector systems, where there was a need to increase the insulation in the solar collector without dramatically reducing solar energy transmittance.  Transparent Insulation provides both these properties, insulation from heat loss and transmittance of solar energy.  The combination of these properties is achieved, because Transparent Insulation is a transmitter of short wave radiation but a barrier to longwave radiation.  Therefore short wave solar radiation passes through the Transparent Insulation and longwave heat radiation is insulated by the transparent insulation. Incident solar energy falling on the transparent insulation is reflected and re-reflected within the material and eventually falls on the absorber.  In addition, transparent insulation materials also have increase thermal resistance due to conduction in comparison to standard glass.

Transparent Insulation is now used in the housing industry as a passive solar feature. It is attached to the walls of houses for insulation and solar energy gains are transmitted to the house during the right ambient conditions. The walls of the house act as a thermal mass, absorbing the sunlight at the surface and converting it into heat which is slowly transmitted to the inside of the house.

### Comparison of Opaque and Transparent Insulation

A qualitative comparison between the performance of Transparent Insulation and opaque insulation is shown diagrammatically in the figure below. The upper half of the figure represents approximate heat transfer through the wall cross-section for both transparent and opaque insulation cases.  The lower half of this figure shows representative temperature variations through the wall cross-sections for different solar conditions.

![](EngineeringReference/media/image399.png)

Figure 26.  Energy Flows of Opaquely and Transparently Insulated Walls (Wood and Jesch 1993).

While both types of insulation reduce energy losses from the building via conduction through the building surfaces, transparent insulation allows solar radiation to penetrate deeper into the surface construction.  This increases the construction internal temperature and can result in heat being conducted into the building under the proper weather conditions.  This can be seen in the lower half of the above figure during a sunny day.  The temperature plot shows a maximum between the transparent insulation and the rest of the surface construction.  As a result, the temperature gradient results in heat transfer from this point into the interior space, causing a heating effect on the zone.  Thus, the advantage of transparent insulation is that, like opaque insulation, it reduces winter heat transfer losses during low or no solar conditions and has the possibility of providing heating during sunny winter days.  It should be noted that this same effect in summer could be detrimental to the cooling loads of a building since the introduction of solar radiation closer to the space will increase the solar heating within the zone.  Most systems counteract this with a shading device or with sophisticated transparent insulation systems.

### Types of Transparent Insulation Materials

Transparent insulation can be classified into four general categories:

Absorber Parallel Covers

Cavity Structures

Absorber Vertical Covers

Quasi-Homogeneous Structures

Cross-sections of each of these types is shown in the figure below.  The arrows in these diagrams indicate solar rays and the path these rays trace as they are transmitted through the transparent insulation layer.  The most advantageous set-up (see absorber-parallel below) would send most of the rays downward towards the interior of the building while minimizing the rays that are reflected back to the exterior environment.

![](EngineeringReference/media/image400.png)

Figure 27.  Geometrical Categories of Classification for Transparent Insulation Material (Wood and Jesch 1993).

### TIM- Basic Mathematical Model

![](EngineeringReference/media/image401.png)

Figure 28.  Cross Section of TIM and wall, showing energy flow

Mathematical model to calculate amount of energy absorbed at the surface of moveable insulation (TIM) and at the Outside surface of the Wall.

<div>$$QSM = {\alpha_{TIM}}\cdot Incident\;Solar$$</div>

The total solar gain on any exterior surface is a combination of the absorption of direct and diffuse solar radiation given by

***<span>$Incident\;Solar = ({I_b}\cdot \cos \theta \cdot \frac{{{S_s}}}{S} + {I_s}\cdot {F_{ss}} + {I_g}\cdot {F_{sg}})$</span>                                      ***

Where,

a<sub>       </sub> = solar absorptance of the surface

<span>$\theta $</span>   = angle of incidence of the sun’s rays

S<sub>       </sub> = area of the surface

S<sub>s     </sub> = sunlit area of the surface

I<sub>b        </sub> = intensity of the beam (direct) radiation

I<sub>s        </sub> = intensity of the sky diffuse radiation

I<sub>g       </sub> = intensity of the beam (direct) radiation

F<sub>ss   </sub> = angle factor between the surface and the sky

F<sub>sg   </sub> = angle factor between the surface and the ground

Now,

<div>$${\alpha_{wall}} + {\rho_{wall}} = 1$$</div>

The model for TIM is simplified in that it assumes that absorption of solar radiation takes place at the inside and outside of the TIM only, not throughout the material.  In addition, the model assumes that the solar radiation absorbed during the first pass through the TIM affects the outside surface of the TIM while the solar radiation reflected at the outer wall surface that gets absorbed during the back reflection will affect the inside TIM surface (which is also the outside surface of the wall).  Thus, the heat absorbed at the outside of the TIM is as shown in Equation .

The heat absorbed at the inside of the TIM/outside of the wall includes two components.  The first component is the amount of solar that is transmitted through the TIM and absorbed at the inside of the wall.  This is characterized by the following equation:

<div>$$First\,pass\,solar\,absorbed\,by\,wall = \left( {{\tau_{TIM}}\cdot Incident\,Solar} \right)\cdot \left( {{\alpha_{wall}}} \right)$$</div>

The amount of solar absorbed by the TIM and aggregated at the inside surface of the TIM (outside wall surface) is:

<div>$$Amount\,of\,back\,reflection\,absorbed\,by\,TIM = \left( {{\tau_{TIM}}\cdot Incident\,Solar} \right)\cdot \left( {1 - {\alpha_{wall}}} \right)\cdot {\alpha_{TIM}}$$</div>

The heat absorbed at the interface between the wall and the TIM includes both of these components.  Thus, QSO is equal to:

<div>$$QSO = \left( {{\tau_{TIM}}\cdot Incident\,Solar} \right)\cdot \left\{ {{\alpha_{wall}} + \left( {1 - {\alpha_{wall}}} \right)\cdot \alpha {}_{TIM}} \right\}$$</div>

Substituting the definition for QSM into this equation and rearranging results in:

<div>$$QSO = \left\{ {\frac{{{\tau_{TIM}}\cdot QSM}}{{{\alpha_{TIM}}}}} \right\}\cdot \left\{ {{\alpha_{wall}} + \left( {1 - {\alpha_{wall}}} \right)\cdot {\alpha_{TIM}}} \right\}$$</div>

<div>$$QSO = \left( {{\tau_{TIM}}\cdot QSM} \right)\cdot \left\{ {\left( {\frac{{{\alpha_{wall}}}}{{{\alpha_{TIM}}}}} \right) + \left( {1 - {\alpha_{wall}}} \right)} \right\}$$</div>

Where,

*QSM*           = Short wave radiant flux absorbed at surface of Movable Insulation

*QSO*           = Short wave radiant flux absorbed at surface of Wall.

a<sub>TIM                        </sub> = Absorptance of TIM

t<sub>TIM                         </sub> = Transmittance of TIM.

a<sub>WALL                     </sub> = Absorptance of Wall.

r <sub>WALL                   </sub> = Reflectance of Wall surface

Following is the FORTRAN Code used in the HeatBalanceSurfaceManager module, to determine the short wave radiation absorbed on outside of movable insulation and the short wave radiation absorbed on outside of opaque surface of the wall.

IF (Surface(SurfNum)%MaterialMovInsulExt.GT.0)                                     &

    CALL EvalOutsideMovableInsulation(SurfNum,HMovInsul,RoughIndexMovInsul,AbsExt)

    IF (HMovInsul &gt; 0) THEN    ! Movable outside insulation in place

      QRadSWOutMvIns(SurfNum) = QRadSWOutAbs(SurfNum)\*AbsExt          &

                       /Material(Construct(ConstrNum)%LayerPoint(1))%AbsorpSolar

!  For Transparent Insulation

      QRadSWOutAbs(SurfNum) = Material(Surface(SurfNum)%MaterialMovInsulExt)%Trans  &

             \*QRadSWOutMvIns(SurfNum)\*                              &

                 (  (Material(Construct(ConstrNum)%LayerPoint(1))%AbsorpSolar/AbsExt)   &

                        +(1-Material(Construct(ConstrNum)%LayerPoint(1))%AbsorpSolar)  )

### Sample Test Run Cases: – Comparison

A series of test cases were run in EnergyPlus to test the TIM model.  The building was a very simple box with walls facing north, south, east, and west, all of which are exterior walls.  Transparent Insulation Material has been applied to the south wall (except as noted in the table below).  The program was run for this fictional 1 zone building located in Chanute AFB IL, for two design days, (21<sup>st</sup> June and 21<sup>st</sup> January).  The main purpose of these runs was to verify that the transparent insulation model was predicting results that were reasonable using a simple test case.  The winter design day was also modified in some runs to have a clearness of 1.0 so that the effect that solar radiation during winter-time conditions could be studied.

The Transparent Insulation material is conceived by applying a SurfaceControl:MoveableInsulation on the exterior.  In the test cases, the TIM had the following thermal properties:

    0.05, ! Thickness {m}

    0.90,  ! Solar transmittance at normal incidence

    0.031,  ! Solar reflectance at normal incidence: front side

    0.031,  ! Solar reflectance at normal incidence: back side

    0.90,  ! Visible transmittance at normal incidence

    0.05,  ! Visible reflectance at normal incidence: front side

    0.05,  ! Visible reflectance at normal incidence: back side

    0.0,   ! IR transmittance at normal incidence

    0.84,  ! IR emissivity: front side

    0.84,  ! IR emissivity: back side

    0.04;   ! Conductivity {W/m-K}

The Wall Construction is defined as an EXTWALL80 composed of 1” Stucco, 4” Common Brick and ¾” Plaster or Gypboard.

The following two tables shows data for two series of runs.  The first “summer table” illustrates the execution of a summer design day.  The second “winter table” shows winter conditions with clearness=0 (the typical default for a winter design day) and clearness=1 (to illustrate solar radiation with other winter conditions).  Test cases included no movable insulation, moveable opaque insulation, and TIM on the exterior (south wall unless otherwise noted).  Savings reported are heating and cooling loads for the design days only.  The results showed that the TIM model was performing reasonably well and was producing results that were within expectations.





Table 14.  TIM with Summer Conditions

<table class="table table-striped">
<tr>
<th> </th>
<th>Conductivity</th>
<th>Thick-ness.</th>
<th>Sensible</th>
<th>Energy Saved</th>
</tr>
<tr>
<td>EXTWALL80 Construction</td>
<td> </td>
<td> </td>
<td>Cooling Energy</td>
<td> </td>
</tr>
<tr>
<td> </td>
<td>[W/m-K]</td>
<td>[m]</td>
<td>[J]</td>
<td>[J]</td>
</tr>
<tr>
<td>Normal case
Without any Insulation</td>
<td>0.000</td>
<td>0.000</td>
<td>3.37E+08</td>
<td>0.00E+00</td>
</tr>
<tr>
<td>With Dense Insulation Present</td>
<td>0.040</td>
<td>0.025</td>
<td>3.17E+08</td>
<td>2.05E+07</td>
</tr>
<tr>
<td>With Dense Insulation Present</td>
<td>0.040</td>
<td>0.050</td>
<td>3.09E+08</td>
<td>2.84E+07</td>
</tr>
<tr>
<td>With Dense Insulation Present</td>
<td>0.040</td>
<td>0.100</td>
<td>3.02E+08</td>
<td>3.53E+07</td>
</tr>
<tr>
<td>With TIM Present</td>
<td>0.040</td>
<td>0.025</td>
<td>4.27E+08</td>
<td>-9.01E+07</td>
</tr>
<tr>
<td>With TIM Present</td>
<td>0.040</td>
<td>0.050</td>
<td>4.63E+08</td>
<td>-1.26E+08</td>
</tr>
<tr>
<td>With TIM Present</td>
<td>0.040</td>
<td>0.100</td>
<td>4.89E+08</td>
<td>-1.52E+08</td>
</tr>
<tr>
<td>With TIM Present -R value =
( 0.05m,0.04W/m-K)</td>
<td>0.035</td>
<td>0.044</td>
<td>4.63E+08</td>
<td>-1.26E+08</td>
</tr>
<tr>
<td>With TIM Present
(EAST WALL)</td>
<td>0.040</td>
<td>0.050</td>
<td>5.49E+08</td>
<td>-2.12E+08</td>
</tr>
<tr>
<td>With TIM Present
(NORTH WALL)</td>
<td>0.040</td>
<td>0.050</td>
<td>3.63E+08</td>
<td>-2.57E+07</td>
</tr>
<tr>
<td>With TIM Present
(WEST WALL)</td>
<td>0.040</td>
<td>0.050</td>
<td>5.64E+08</td>
<td>-2.27E+08</td>
</tr>

</table>



Table 15. TIM with Winter Conditions

<table class="table table-striped">
<tr>
<th> </th>
<th>Conduc-tivity</th>
<th>Thick-ness.</th>
<th>Sensible</th>
<th>Energy Saved</th>
<th>Sensible</th>
<th> Energy Saved</th>
</tr>
<tr>
<td>EXTWALL80 Construction</td>
<td> </td>
<td> </td>
<td>Heating Energy</td>
<td>Winter Clear-ness=0</td>
<td>Heating Energy</td>
<td>Winter Clear-ness=1</td>
</tr>
<tr>
<td> </td>
<td>[W/m-K]</td>
<td>[m]</td>
<td>[J]</td>
<td>[J]</td>
<td>[J]</td>
<td>[J]</td>
</tr>
<tr>
<td>Normal case
Without any Insulation</td>
<td>0.000</td>
<td>0.000</td>
<td>1.47E+09</td>
<td>0.00E+00</td>
<td>1.05E+09</td>
<td>0.00E+00</td>
</tr>
<tr>
<td>With Dense Insulation Present</td>
<td>0.040</td>
<td>0.025</td>
<td>1.30E+09</td>
<td>1.70E+08</td>
<td>9.76E+08</td>
<td>7.40E+07</td>
</tr>
<tr>
<td>With Dense Insulation Present</td>
<td>0.040</td>
<td>0.050</td>
<td>1.26E+09</td>
<td>2.10E+08</td>
<td>9.73E+08</td>
<td>7.70E+07</td>
</tr>
<tr>
<td>With Dense Insulation Present</td>
<td>0.040</td>
<td>0.100</td>
<td>1.22E+09</td>
<td>2.50E+08</td>
<td>9.74E+08</td>
<td>7.60E+07</td>
</tr>
<tr>
<td>With TIM Present</td>
<td>0.040</td>
<td>0.025</td>
<td>1.30E+09</td>
<td>1.70E+08</td>
<td>5.66E+08</td>
<td>4.84E+08</td>
</tr>
<tr>
<td>With TIM Present</td>
<td>0.040</td>
<td>0.050</td>
<td>1.26E+09</td>
<td>2.10E+08</td>
<td>4.41E+08</td>
<td>6.09E+08</td>
</tr>
<tr>
<td>With TIM Present</td>
<td>0.040</td>
<td>0.100</td>
<td>1.22E+09</td>
<td>2.50E+08</td>
<td>3.57E+08</td>
<td>6.93E+08</td>
</tr>
<tr>
<td>With TIM Present -R value =
( 0.05m,0.04W/m-K)</td>
<td>0.035</td>
<td>0.044</td>
<td>1.26E+09</td>
<td>2.10E+08</td>
<td>4.40E+08</td>
<td>6.10E+08</td>
</tr>
<tr>
<td>With TIM Present
(EAST WALL)</td>
<td>0.040</td>
<td>0.050</td>
<td>1.26E+09</td>
<td>2.10E+08</td>
<td>7.36E+08</td>
<td>3.14E+08</td>
</tr>
<tr>
<td>With TIM Present
(NORTH WALL)</td>
<td>0.040</td>
<td>0.050</td>
<td>1.24E+09</td>
<td>2.30E+08</td>
<td>8.31E+08</td>
<td>2.19E+08</td>
</tr>
<tr>
<td>With TIM Present
(WEST WALL)</td>
<td>0.040</td>
<td>0.050</td>
<td>1.24E+09</td>
<td>2.30E+08</td>
<td>7.07E+08</td>
<td>3.43E+08</td>
</tr>

</table>



### References

P.O. Braun, A. Goetzberger, J. Schmid, and W.Stahl. Transparent Insulation of Building Facades- Steps from Research to Commercial applications, Fraunhofer Institute for Solar Energy Systems, Oltmannsstrasse 22, D-7800 Freiburg, Germany.

Thermotropic materials and Systems for Overheating Protection.

Robert Hausner. Arbeitsgemeinschaft Erneuerbare energie, Transparent Insulation- Areas of Application, Society for Renewable Energy.

Werner J.Platzer. Transparent Insulation materials: a review, Fraunhofer Institute for Solar Energy Systems, Oltmannsstr. 5, D-79100 Freiburg, Germany.

Volker Wittwer. The use of Transparent Insulation Materials and Optical Switching Layers in Window Systems, Fraunhofer Institute for Solar Energy Systems, Oltmannsstr. 5, D-79100 Freiburg, Germany.

M. Wood and L.F. Jesch. 1993. Transparent insulation technology: a technical note, Ambient Press Limited.

Façade Modules with back-ventilated Transparent Insulation- Research and Development toward Series Application.

Two 0-Energy Houses,

Advanced Building Technologies – Transparent Insulation Materials ( TIM ).

Transparent Insulation,

G. Verbeeck, H. Hens. Transparent Insulation: an alternative solution for summer discomfort. Die neue Transparenz: Warmedamm-Verbund- system StoTherm Solar.

E.Lindauer, H.Leonhardt. Brauchwasservorerwarmmung mit transparent gedammten Bauteilen ( Hybridsystem ), Fraunhofer- Institut fur Bauphysik.

Surface Heat Balance With Moveable Insulation
---------------------------------------------

### Basic Heat Balance Cases

A heat balance must exist at the outside surface-air interface. The incoming conductive, convective, and radiative fluxes must sum up to zero:

<div>$$Conductive + Convective + Radiative = 0$$</div>

In contrast to the internal surface heat balance that treats all surfaces simultaneously, the external thermal balance for each surface is performed independent of all other surfaces. This implies that there is no direct interaction between the individual surfaces.

TARP includes four possible representations for the basic outside surface heat balance. The first two depend on which of the optimal surface conductance algorithms the user selects. The simple outside surface conductance that includes both the convective and thermal interchange between the surface and the environment in a single coefficient, is represented by the thermal network in Figure 29. Equation can also be expressed as:

<div>$$\left[ {{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {{\rm{Y}}_{\rm{0}}}\cdot {\rm{T}}{{\rm{I}}_t} - {{\rm{X}}_{\rm{0}}}\cdot {\rm{T}}{{\rm{O}}_{\rm{t}}}} \right]{\rm{ + }}\left[ {{\rm{HO}}\cdot \left( {{{\rm{T}}_{\rm{a}}} - {\rm{T}}{{\rm{O}}_t}} \right)} \right]{\rm{  + QSO  =  0}}$$</div>

This can be solved for the outside surface temperature.

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{Y}}_0}\cdot {\rm{T}}{{\rm{I}}_{\rm{t}}}{\rm{ + HO}}\cdot {{\rm{T}}_{\rm{a}}}}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + HO}}}}} \right]{\rm{  }}$$</div>

The detailed outside surface conductance model considers convection and radiant interchange with the sky and with the ground as separate factors. Its use in the outside thermal balance is shown in Figure 30.In this case, equation can be expanded to give

<div>$$\left[ {{\rm{KO}}{{\rm{P}}_{\rm{t}}}{\rm{ + }}{{\rm{Y}}_{\rm{0}}}\cdot {\rm{T}}{{\rm{I}}_{\rm{t}}}{\rm{ - }}{{\rm{X}}_{\rm{0}}}\cdot {\rm{T}}{{\rm{O}}_{\rm{t}}}} \right]{\rm{ + }}\left[ {{\rm{HA}}\cdot \left( {{{\rm{T}}_{\rm{a}}}{\rm{ - T}}{{\rm{O}}_{\rm{t}}}} \right){\rm{ + HS}}\cdot \left( {{{\rm{T}}_{\rm{s}}}{\rm{ - T}}{{\rm{O}}_{\rm{t}}}} \right){\rm{ + HG}}\cdot \left( {{{\rm{T}}_{\rm{g}}}{\rm{ - T}}{{\rm{O}}_{\rm{t}}}} \right)} \right]{\rm{  + QSO  =  0  }}$$</div>

This can be solved for the outside surface temperature:

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{Y}}_0}\cdot {\rm{T}}{{\rm{I}}_{\rm{t}}}{\rm{ + HA}}\cdot {{\rm{T}}_{\rm{a}}}{\rm{ + HS}}\cdot {{\rm{T}}_{\rm{s}}}{\rm{ + HG}}\cdot {{\rm{T}}_{\rm{g}}}}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + HA + HS + HG}}}}} \right]{\rm{  }}$$</div>

The third and fourth representations occur when the outside surface has been covered with movable insulation. The insulation has a conductance of UM. The thermal network in Figure 31 represents this case.The insulation must be mass-less because it is not generally possible to perform a correct thermal balance at the juncture of two surfaces each modeled by CTF.

The equation for the thermal balance between the surface and the insulation is

<div>$$\left[ {{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {{\rm{Y}}_{\rm{0}}}\cdot {\rm{T}}{{\rm{I}}_t} - {{\rm{X}}_{\rm{0}}}\cdot {\rm{T}}{{\rm{O}}_{\rm{t}}} + {\rm{UM}}\cdot \left( {{\rm{TM - T}}{{\rm{O}}_{\rm{t}}}} \right)} \right]{\rm{ + QSO  =  0}}$$</div>

Which can be rewritten to solve for TO :

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{Y}}_0}\cdot {\rm{T}}{{\rm{I}}_{\rm{t}}}{\rm{ + UM}}\cdot {\rm{TM}}}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + UM}}}}} \right]{\rm{  }}$$</div>

Depending on whether or not the detailed or simple algorithm for surface conductance is being used, there are two expressions for TM, the outside temperature of the insulation. For the simple conductance:

<div>$${\rm{TM}} = \left[ {\frac{{{\rm{QSM + UM}}\cdot {\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ + HO}}\cdot {{\rm{T}}_{\rm{a}}}}}{{{\rm{UM + HO}}}}} \right]$$</div>

For the detailed conductance:

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{QSM}} + {\rm{UM}}\cdot {\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ + HA}}\cdot {{\rm{T}}_{\rm{a}}}{\rm{ + HS}}\cdot {{\rm{T}}_{\rm{s}}}{\rm{ + HG}}\cdot {{\rm{T}}_{\rm{g}}}}}{{{\rm{UM + HA + HS + HG}}}}} \right]{\rm{  }}$$</div>

In this case the values of HA, HS and HG must be found by using an estimated value of TM in place of TO.



![](EngineeringReference/media/image420.png)

Figure 29.  Thermal Network for Simple Outside Surface Coefficient

![](EngineeringReference/media/image421.png)

Figure 30.  Thermal Network for Detailed Outside Surface Coefficient

![](EngineeringReference/media/image422.png)

Figure 31.  Thermal Network for Outside Moveable Insulation

### Heat Balance Cases

TO<sub>t</sub> and TI<sub>t  </sub> are related through the Y<sub>0</sub> CTF<sub>. </sub> However TI<sub>t  </sub> is also unknown. While it is possible to combine the outside and the inside surface heat balances to compute TO<sub>t</sub> and TI<sub>t  </sub> simultaneously, TARP uses a simpler procedure where TO<sub>t </sub> is based on a previous value of TI. When Y<sub>0</sub> is small, as occurs in well insulated or very massive surfaces, TI<sub>t  </sub> can be replaced by TI<sub>t\\ -1  </sub> (which is known for the previous hour’s heat balance) without significantly effecting the value of TO<sub>t\\ . </sub> When Y<sub>0</sub> is large, TO and TI can so strongly be coupled that separate outside and inside heat balances do not work because the environment and zone temperatures have negligible influence on the heat balances. The TARP uses the inside surface heat balance to couple TO<sub>t  </sub> with TZ and TR. These two temperatures are less strongly influenced by TO and allow a reasonable heat balance. On the first heat balance iteration, TZ and TR are the values at time t-1. The user may optionally require that TO<sub>t </sub> be recomputed with every iteration of TI<sub>t \\ .</sub>  In this case TZ and TR have values from the previous iteration and a true simultaneous solution is achieved. In most conventional constructions, recomputing TO<sub>t</sub> does not significantly change the computed zone loads and temperatures. The inside surface heat balance is given by

<div>$${\rm{T}}{{\rm{I}}_{\rm{t}}} = \left[ {\frac{{KI{P_t} + QSI + HC\cdot TZ + HR\cdot TR + {Y_0}\cdot TO}}{{{Z_0} + HC + HR}}} \right]$$</div>

The surface heat balances can be combined in eight ways according to conditions for calculations of the outside surface temperature

<div>$${F_1} = \left[ {\frac{{{Y_0}}}{{{Z_0} + HI + HR}}} \right]$$</div>

<div>$${F_2} = \left[ {\frac{{UM}}{{UM + HO}}} \right]$$</div>

<div>$${F_3} = \left[ {\frac{{UM}}{{UM + HA + HS + HG}}} \right]$$</div>

#### Case1: Y<sub>0</sub>  small, simple conductance, no movable insulation:

From Equation

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{Y}}_0}\cdot {\rm{T}}{{\rm{I}}_{{\rm{t - 1}}}}{\rm{ + HO}}\cdot {{\rm{T}}_{\rm{a}}}}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + HO}}}}} \right]{\rm{  }}$$</div>

#### Case2: Y<sub>0</sub> not small, simple conductance, no movable insulation:

From Equations and

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {\rm{HO}}\cdot {{\rm{T}}_{\rm{a}}} + {{\rm{F}}_1}\cdot \left( {{\rm{KI}}{{\rm{P}}_{\rm{t}}}{\rm{ + QSI + HI}}\cdot {\rm{TZ + HR}}\cdot {\rm{TR}}} \right)}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + HO - }}{{\rm{F}}_{\rm{1}}}\cdot {{\rm{Y}}_0}}}} \right]{\rm{  }}$$</div>

#### Case3: Y<sub>0</sub>  small, detailed conductance, no movable insulation:

From Equation

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{Y}}_0}\cdot {\rm{T}}{{\rm{I}}_{{\rm{t - 1}}}}{\rm{ + HA}}\cdot {{\rm{T}}_{\rm{a}}} + {\rm{HS}}\cdot {{\rm{T}}_{\rm{s}}} + {\rm{HG}}\cdot {{\rm{T}}_{\rm{g}}}}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + HA + HS + HG}}}}} \right]{\rm{  }}$$</div>

#### Case4: Y<sub>0</sub> not small, detailed conductance, no movable insulation:

From Equations and

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {\rm{HA}}\cdot {{\rm{T}}_{\rm{a}}} + {\rm{HS}}\cdot {{\rm{T}}_{\rm{s}}} + {\rm{HG}}\cdot {{\rm{T}}_{\rm{g}}} + {{\rm{F}}_{\rm{1}}}\cdot \left( {{\rm{KI}}{{\rm{P}}_{\rm{t}}}{\rm{ + QSI + HI}}\cdot {\rm{TZ + HR}}\cdot {\rm{TR}}} \right)}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + HA + HS + HG - }}{{\rm{F}}_1}\cdot {{\rm{Y}}_0}}}} \right]{\rm{  }}$$</div>

#### Case5: Y<sub>0</sub>  small, simple conductance, with movable insulation:

From Equations and
<span>$
  TO_t = \left[ \frac{ KOP_t + QSO + HA \cdot T_a + HS \cdot T_s + HG \cdot T_g + F_1 \cdot \left( KIP_t QS1 + HI \cdot TZ + HR \cdot TR \right) } { X_0 + HA + HS + HG - F_1 \cdot Y_0 } \right]
$</span>

#### Case6: Y<sub>0</sub> not small, simple conductance, with movable insulation:

From Equations , and

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{F}}_2}\cdot \left( {{\rm{QSM + HO}}\cdot {{\rm{T}}_{\rm{a}}}} \right) + {{\rm{F}}_1}\cdot \left( {{\rm{KI}}{{\rm{P}}_{\rm{t}}}{\rm{ + QSI + HI}}\cdot {\rm{TZ + HR}}\cdot {\rm{TR}}} \right)}}{{{{\rm{X}}_{\rm{0}}} + {\rm{UM - }}{{\rm{F}}_{\rm{2}}}\cdot {\rm{UM - }}{{\rm{F}}_{\rm{1}}}\cdot {{\rm{Y}}_{\rm{0}}}}}} \right]{\rm{  }}$$</div>

#### Case7: Y<sub>0</sub>  small, detailed conductance, with movable insulation:

From Equations and

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{Y}}_0}\cdot {\rm{T}}{{\rm{I}}_{{\rm{t - 1}}}}{\rm{ + }}{{\rm{F}}_{\rm{3}}}\left( {{\rm{QSM + HA}}\cdot {{\rm{T}}_{\rm{a}}}{\rm{ + HS}}\cdot {{\rm{T}}_{\rm{s}}}{\rm{ + HG}}\cdot {{\rm{T}}_{\rm{g}}}} \right)}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + UM - }}{{\rm{F}}_{\rm{3}}}\cdot {\rm{UM}}}}} \right]{\rm{  }}$$</div>

#### Case8: Y<sub>0</sub> not small, detailed conductance, with movable insulation:

From Equations , and

<div>$${\rm{T}}{{\rm{O}}_{\rm{t}}}{\rm{ = }}\left[ {\frac{{{\rm{KO}}{{\rm{P}}_{\rm{t}}} + {\rm{QSO}} + {{\rm{F}}_1}\cdot \left( {{\rm{KI}}{{\rm{P}}_{\rm{t}}}{\rm{ + QSI + HI}}\cdot {\rm{TZ + HR}}\cdot {\rm{TR}}} \right){\rm{ + }}{{\rm{F}}_{\rm{3}}}\left( {{\rm{QSM + HA}}\cdot {{\rm{T}}_{\rm{a}}}{\rm{ + HS}}\cdot {{\rm{T}}_{\rm{s}}}{\rm{ + HG}}\cdot {{\rm{T}}_{\rm{g}}}} \right)}}{{{{\rm{X}}_{\rm{0}}}{\rm{ + UM - }}{{\rm{F}}_{\rm{3}}}\cdot {\rm{UM - }}{{\rm{F}}_{\rm{1}}}\cdot {{\rm{Y}}_{\rm{0}}}}}} \right]{\rm{  }}$$</div>

### Fortran Algorithm Examples

#### Case5: Y<sub>0</sub>  small, simple conductance, with movable insulation:

From Equation

! Outside heat balance case: Movable insulation, slow conduction, simple convection

 F2 = DBLE(HmovInsul) / ( DBLE(HmovInsul) + DBLE(HExtSurf(SurfNum)) )

 TH(SurfNum,1,1) = (-CTFConstOutPart(SurfNum)  &

                    +DBLE(QRadSWOutAbs(SurfNum) )  &

           +Construct(ConstrNum)%CTFCross(0)\*TempSurfIn(SurfNum)  &

           +F2\* ( DBLE(QRadSWOutMvIns(SurfNum))                   &

           + DBLE(HExtSurf(SurfNum))\* DBLE(TempExt) )   )         &

           /( Construct(ConstrNum)%CTFOutside(0) + DBLE(HmovInsul) &

          - F2\* DBLE(HMovInsul))

#### Case6: Y<sub>0</sub> not small, simple conductance, with movable insulation:

From Equation

! Outside heat balance case: Movable insulation, quick conduction, simple convection

F2 = DBLE(HmovInsul) / ( DBLE(HmovInsul) + DBLE(HExtSurf(SurfNum)) )

TH(SurfNum,1,1) = (-CTFConstOutPart(SurfNum)             &

+ DBLE(QRadSWOutAbs(SurfNum))                            &

+F2\*( DBLE(QRadSWOutMvIns(SurfNum))                      &

+DBLE(HExtSurf(SurfNum))\* DBLE(TempExt)  )               &

+F1\*( CTFConstInPart(SurfNum)                            &

+ DBLE(QRadSWInAbs(SurfNum))                             &

+ DBLE(QRadThermInAbs(SurfNum))                          &

+ DBLE(HConvIn(SurfNum))\*MAT(ZoneNum)                    &

+ DBLE(NetLWRadToSurf(SurfNum))  ) )                     &

/( Construct(ConstrNum)%CTFOutside(0) + DBLE(HmovInsul)  &

-F2\* DBLE(HMovInsul )- F1\*Construct(ConstrNum)%CTFCross(0) )

#### Case7: Y<sub>0</sub>  small, detailed conductance, with movable insulation:

From Equation

! Outside heat balance case: Movable insulation, slow conduction, detailed convection

F2 = DBLE(HMovInsul)/ ( DBLE(HMovInsul) + DBLE(HExtSurf(SurfNum)) &

           +DBLE(HSky) + DBLE(HGround) )

TH(SurfNum,1,1) = (-CTFConstOutPart(SurfNum)                      &

+DBLE(QRadSWOutAbs(SurfNum))                                      &

+Construct(ConstrNum)%CTFCross(0)\*TempSurfIn(SurfNum)             &

+F2\*( DBLE(QRadSWOutMvIns(SurfNum))                               &

+DBLE(HExtSurf(SurfNum))\*DBLE(TempExt)                            &

+DBLE(HSky)\*DBLE(SkyTemp)                                         &

+DBLE(HGround)\*DBLE(OutDryBulbTemp) ) )                           &

/( Construct(ConstrNum)%CTFOutside(0)                             &

+DBLE(HMovInsul) - F2\*DBLE(HMovInsul) )

#### Case8: Y<sub>0</sub> not small, detailed conductance, with movable insulation:

From Equation

! Outside heat balance case: Movable insulation, quick conduction, detailed convection

F2 = DBLE(HMovInsul)/ ( DBLE(HMovInsul) + DBLE(HExtSurf(SurfNum)) &

           +DBLE(HSky) + DBLE(HGround) )

TH(SurfNum,1,1) = (-CTFConstOutPart(SurfNum)                      &

+DBLE(QRadSWOutAbs(SurfNum))                                      &

+F1\*( CTFConstInPart(SurfNum)                                     &

+DBLE(QRadSWInAbs(SurfNum))                                       &

+DBLE(QRadThermInAbs(SurfNum))                                    &

+DBLE(HConvIn(SurfNum))\*MAT(ZoneNum)                              &

+DBLE(NetLWRadToSurf(SurfNum)) )                                  &

+F2\*( DBLE(QRadSWOutMvIns(SurfNum))                               &

+DBLE(HExtSurf(SurfNum))\*DBLE(TempExt)                            &

+DBLE(HSky)\*DBLE(SkyTemp)                                         &

+DBLE(HGround)\*DBLE(OutDryBulbTemp) )                             &

/( Construct(ConstrNum)%CTFOutside(0)                             &

+DBLE(HMovInsul) - F2\*DBLE(HMovInsul)                             &

-F1\*Construct(ConstrNum)%CTFCross(0)   )



### Fortran Variable Descriptions

Table 16.  Fortran Variables and Descriptions

<table class="table table-striped">
<tr>
<th>FORTRAN Variable</th>
<th>Description</th>
<th>Tarp Variable</th>
<th>Units</th>
<th>Description</th>
</tr>
<tr>
<td>TH(SurfNum,1,1)</td>
<td>Temperature History(SurfNum,Hist Term,In/Out), where: Hist Term (1 = Current Time, 2-MaxCTFTerms = previous times), In/Out (1 = Outside, 2 = Inside)</td>
<td>TO<sub>t</sub></td>
<td>C</td>
<td>Temperature of outside of surface I at time t</td>
</tr>
<tr>
<td>Construct(ConstrNum)%CTFCross(0)</td>
<td>Cross or Y term of the CTF equation</td>
<td>Y0</td>
<td>W/m<sup>2</sup>K</td>
<td>Cross CTF term</td>
</tr>
<tr>
<td>Construct(ConstrNum)%CTFInside(0)</td>
<td>Inside or Z terms of the CTF equation</td>
<td>Z0</td>
<td>W/m<sup>2</sup>K</td>
<td>Inside CTF term</td>
</tr>
<tr>
<td>Construct(ConstrNum)%CTFOutside(0)</td>
<td>Outside or X terms of the CTF equation</td>
<td>X0</td>
<td>W/m<sup>2</sup>K</td>
<td>Outside CTF term</td>
</tr>
<tr>
<td>CTFConstInPart(SurfNum)</td>
<td>Constant inside portion of the CTF calculation</td>
<td>KIP<sub>t</sub></td>
<td>W/m<sup>2</sup></td>
<td>Portion of inward conductive flux based on previous temperature and flux history terms</td>
</tr>
<tr>
<td>CTFConstOutPart(SurfNum)</td>
<td>Constant Outside portion of the CTF calculation</td>
<td>KOP<sub>t</sub></td>
<td>W/m<sup>2</sup></td>
<td>Portion of outward conductive flux based on previous temperature and flux history terms</td>
</tr>
<tr>
<td>F1, F2, F3</td>
<td>Intermediate calculation variables</td>
<td>F1, F2, F3</td>
<td> </td>
<td>Radiation interchange factor between surfaces</td>
</tr>
<tr>
<td>GroundTemp</td>
<td>Ground surface temperature</td>
<td>T<sub>g</sub></td>
<td>C</td>
<td>Temperature of ground at the surface exposed to the outside environment</td>
</tr>
<tr>
<td>HConvIn(SurfNum)</td>
<td>Inside convection coefficient</td>
<td>HI</td>
<td>W/m<sup>2</sup>K</td>
<td>Inside convection coefficient</td>
</tr>
<tr>
<td>HExtSurf(SurfNum)</td>
<td>Outside Convection Coefficient</td>
<td>HO, HA</td>
<td>W/m<sup>2</sup>K</td>
<td>Overall outside surface conductance</td>
</tr>
<tr>
<td>HGround</td>
<td>Radiant exchange (linearized) coefficient</td>
<td>HG</td>
<td>W/m<sup>2</sup>K</td>
<td>Radiative conductance (outside surface to ground temperature</td>
</tr>
<tr>
<td>HmovInsul</td>
<td>Conductance or &quot;h&quot; value of movable insulation</td>
<td>UM</td>
<td>W/m<sup>2</sup>K</td>
<td>Conductance of Movable insulation</td>
</tr>
<tr>
<td>HSky</td>
<td>Radiant exchange (linearized) coefficient</td>
<td>HS</td>
<td>W/m<sup>2</sup>K</td>
<td>Radiative conductance (outside surface to sky radiant temperature</td>
</tr>
<tr>
<td>MAT(ZoneNum)</td>
<td>Zone temperature</td>
<td>TZ</td>
<td>C</td>
<td>Temperature of zone air</td>
</tr>
<tr>
<td>NetLWRadToSurf(SurfNum)</td>
<td>Net interior longwave radiation to a surface from other surfaces</td>
<td>HR*TR</td>
<td>W/m<sup>2</sup></td>
<td>Net surface to surface radiant exchange</td>
</tr>
<tr>
<td>QRadSWInAbs(SurfNum)</td>
<td>Short-wave radiation absorbed on inside of opaque surface</td>
<td>QSI</td>
<td>W/m<sup>2</sup></td>
<td>Short wave radiant flux absorbed at inside of surface</td>
</tr>
<tr>
<td>QRadSWOutAbs(SurfNum)</td>
<td>Short wave radiation absorbed on outside opaque surface</td>
<td>QSO</td>
<td>W/m<sup>2</sup></td>
<td>Short wave radiant flux absorbed at outside of surface</td>
</tr>
<tr>
<td>QRadSWOutMvIns(SurfNum)</td>
<td>Short wave radiation absorbed on outside of movable insulation</td>
<td>QSM</td>
<td>W/m<sup>2</sup></td>
<td>Short wave radiant flux absorbed at surface of movable insulation</td>
</tr>
<tr>
<td>QRadThermInAbs(SurfNum)</td>
<td>Thermal Radiation absorbed on inside surfaces</td>
<td> </td>
<td>W/m<sup>2</sup></td>
<td>Longwave radiant flux from internal gains</td>
</tr>
<tr>
<td>SkyTemp</td>
<td>Sky temperature</td>
<td>T<sub>s</sub></td>
<td>C</td>
<td>Sky temp</td>
</tr>
<tr>
<td>TempExt</td>
<td>Exterior surface temperature or exterior air temperature</td>
<td>TM, T<sub>a</sub></td>
<td>C</td>
<td>Temperature of external surface of movable insulation or outside ambient air temperature</td>
</tr>
<tr>
<td>TempSurfIn(SurfNum)</td>
<td>Temperature of inside surface for each heat transfer surface</td>
<td>TI<sub>t-1</sub></td>
<td>C</td>
<td>Temperature of inside of surface I at time t-1</td>
</tr>

</table>



### References

Walton, G.N. 1983. “The Thermal Analysis Research Program Reference Manual Program (TARP)”, National Bureau of Standards (now National Institute of Standards and Technology).

Ground Heat Transfer Calculations using C and F Factor Constructions
--------------------------------------------------------------------

Building energy code and standards like ASHRAE 90.1, 90.2 and California Title 24 require the underground wall constructions and slabs-on-grade or underground floors not to exceed certain maximum values of C-factor and F-factor, which do not specify detailed layer-by-layer materials for the constructions. If using the normal approach (layer by layer) of ground constructions with EnergyPlus, users would need to create a pseudo wall or floor construction to match the thermal performance such as thermal mass effect and U-factor, and rely on the EnergyPlus Basement and Slabs tools to generate the monthly ground temperatures.

A simplified approach is introduced to create equivalent constructions and model the ground heat transfer through underground walls and ground floors for the building energy code compliance calculations. The approach is to create constructions based on the user defined C or F factor with two layers: one concrete layer (0.15 m thick) with thermal mass, and one fictitious insulation layer with no thermal mass.

Three objects are used in the C and F factor calculations:

* Construction:CfactorUndergroundWall

* Construction:FfactorGroundFloor

* Site:GroundTemperature:FCfactorMethod

Site:GroundTemperature:FCfactorMethod is used only by the underground walls or slabs-on-grade or underground floors defined with C-factor (Construction:CfactorUndergroundWall) and F-factor (Construction:FfactorGroundFloor) method for code compliance calculations where detailed construction layers are unknown. Only one such ground temperature object can be included. The monthly ground temperatures for this object are close to the monthly outside air temperatures delayed by three months. If user does not input this object in the IDF file, it will be defaulted to the 0.5m set of monthly ground temperatures from the weather file if they are available.

Detailed description of the three objects is in the Input Output Reference document. The following section describes how the equivalent material layers are created based on the C-factor and F-factor.

#### Slab-on-grade and Underground Floors Defined with F-factors

The steady state heat transfer through the floor is calculated as,

Q = Area \* U<sub>eff</sub> \* (T<sub>air,out</sub> – T<sub>air,in</sub>) = (T<sub>air,out</sub> – T<sub>air,in</sub>) \* (P<sub>exp</sub> \* F-factor)

Where,

Q is the steady state heat transfer through the floor in Watt

Area is the area of the floor in m<sup>2</sup>

U<sub>eff</sub> is the effective heat transfer coefficient including the floor construction, the soil, and the thermal resistance of the interior and exterior air films.

T<sub>air,in</sub> is the indoor air temperature in °C

T<sub>air,out</sub> is the outside air temperature in °C

P<sub>exp</sub> is the exposed perimeter of the floor in m

F-Factor is the heat transfer through the floor, induced by a unit temperature difference between the outside and inside air temperature, on the per linear length of the exposed perimeter of the floor. The unit is W/m·K.

Therefore,

U<sub>eff</sub> = (P<sub>exp</sub> \* F-factor) / Area

1 / U<sub>eff</sub> = R<sub>eff</sub> + R<sub>film,in</sub> + R<sub>film,\\ out</sub>

R<sub>eff</sub> = Area / (P<sub>exp</sub> \* F-factor) - R<sub>film,in</sub> - R<sub>film,\\ out</sub>

Where,

R<sub>eff</sub> is the effective thermal resistance in m<sup>2</sup>·K/W, including the soil and the floor construction

R<sub>film,in</sub> and R<sub>film,\\ out</sub> are the air film resistance of the inside and outside surfaces, respectively.

The outside air film resistance R<sub>film,\\ out</sub> = 0.03 m<sup>2</sup>·K/W. The inside air film resistance R<sub>film,in</sub> = 0.125 m<sup>2</sup>·K/W, which is the average of the 0.14 m<sup>2</sup>·K/W for heat flow up and 0.11 m<sup>2</sup>·K/W for heat flow down.

Approximate the thermal mass of the floor construction with a 6-inch (0.15 m) heavy concrete, and use a fictitious insulation layer with no thermal mass to match the thermal resistance of the construction.

We have,

R<sub>fic</sub> = R<sub>eff</sub> – R<sub>con</sub>

Where,

R<sub>fic</sub> is the thermal resistance of the fictitious insulation layer in m<sup>2</sup>·K/W.

R<sub>con</sub> is the thermal resistance of the concrete layer in m<sup>2</sup>·K/W.

Properties of the concrete layer are:

Thickness = 0.15 m

Conductivity = 1.95 W/m·K

Density = 2240 kg/m<sup>3</sup>

Specific heat = 900 J/kg·K

R<sub>con</sub> = 0.15/1.95 = 0.077 m<sup>2</sup>·K/W

Finally,

R<sub>fic</sub> = R<sub>eff</sub> – 0.077

![FCDrawing](EngineeringReference/media/image435.png)

Figure 32. Schematic for Slab on Grade - Two Spaces

For slabs-on-grade as shown in the figure above, the exposed perimeter is (2A + C) for the Dining area, and (2B + C) for the Kitchen area. For underground floors with no exposed perimeter, the R<sub>eff</sub> can be assumed a big value such as 1000 hr·ft<sup>2</sup>·°F/Btu (177 m<sup>2</sup>·K/W).

***Underground Walls Defined with C-Factors***

The steady state heat transfer through the underground wall is calculated as,

Q = Area \* U<sub>eff</sub> \* (T<sub>air,out</sub> – T<sub>air,in</sub>)

1 / U<sub>eff</sub> = R<sub>eff</sub> + R<sub>film,out</sub> + R<sub>film,in</sub>

Where,

Q is the heat transfer through the wall in Watt

Area is the area of the wall in m2

U<sub>eff</sub> is the effective heat transfer coefficient including the floor construction, the soil, and the thermal resistance of the interior and exterior air films.

R<sub>eff</sub> is the effective thermal resistance in m<sup>2</sup>·K/W, including the soil and the wall construction

R<sub>film,in</sub> and R<sub>film,\\ out</sub> are the air film resistance of the inside and outside surfaces, respectively.

C-factor is the time rate of steady-state heat flow through unit area of the construction, induced by a unit temperature difference between the body surfaces. The C-Factor unit is W/m<sup>2</sup>·K. The C-factor does not include soil or air films.

R<sub>eff</sub> = 1/C-factor + R<sub>soil</sub> <sub> </sub>

R<sub>soil</sub> is the effective R-value of the soil. Reference values from Table C6.10.1 of the SI version of the ASHRAE Standard 90.1-2010 are as follows:

Table 17. Effective R-Value of Soil for Below-Grade Walls

![](EngineeringReference/media/image436.png)

A fairly good linear regression (R<sup>2</sup> = 0.9967) for the above data is,

R<sub>soil</sub> = 0.0607 + 0.3479 \* Depth

Approximate the thermal mass of the wall construction with a 6-inch (0.15 m) heavy concrete, and use a fictitious insulation layer with no thermal mass to match the thermal resistance of the construction. Then we have the thermal resistance of the insulation layer,

R<sub>fic</sub> = R<sub>eff</sub> – R<sub>con</sub>

Where,

R<sub>fic</sub> is the thermal resistance of the fictitious insulation layer

R<sub>con</sub> is the thermal resistance of the concrete layer in m<sup>2</sup>·K/W.

Properties of the concrete layer are:

Thickness = 0.15 m

Conductivity = 1.95 W/m·K

Density = 2240 kg/m<sup>3</sup>

Specific heat = 900 J/kg·K

R<sub>con</sub> = 0.15/1.95 = 0.077 m<sup>2</sup>·K/W

Ground Heat Transfer Calculations using Site:GroundDomain:Slab
--------------------------------------------------------------

In order to simulate heat transfer with horizontal building surfaces in contact with the ground, a general finite difference ground model has been implemented. The model simulates heat transfer with the horizontal building surfaces through the ground domain. The domain can simulate heat transfer for slab-in-grade or slab-on-grade scenarios. In all scenarios, the ground domain must interact with the zone through an OthersideConditionsModel as the horizontal surface’s outside boundary condition.

#### Approach

This model is generalized to be able to handle a number of different slab and insulation configurations.  It uses an implicit finite difference formulation to solve for the ground temperatures. As a result the simulation is stable for all timesteps and grid sizes, but an iteration loop must be employed to converge the temperatures in the domain for each domain timestep.

Multiple horizontal surfaces can be coupled to each ground domain object. The model determines which surfaces are coupled to the ground domain and creates a surface of equivalent surface area within the ground domain as a representation of the horizontal surfaces coupled to the ground domain. This surface then interacts with the ground providing updated other side conditions model temperatures to the coupled surfaces for use in their surface heat balance calculations.

#### Boudary Conditions

At the interface surface, the average surface conduction heat flux from all surfaces connected to the ground domain is imposed as a GroundDomain boundary condition at the Surface/GroundDomain interface cells. Far-field temperatures are applied as boundary temperature at the GroundDomain sides and lower surface. The ground temperature profile at the domain sides and lower surface are taken from Kusuda & Achenbach 1965. The correlation requires annual ground surface temperature data.

Ground surface cells are treated as a heat balance, where long and short wave radiation, conduction, and convection are considered. Evapotranspiration is also considered. The evapotranspiration rate is calculated as a moisture loss by using the Allen et al. (2005) model, and translated into a heat loss by multiplication with the density and latent heat of evaporation of water. The evapotranspiration rate is dependent on the type of vegetation at the surface; the user can vary the surface vegetation from anywhere between a concrete surface and a fairly tall grass (about 7”).

Once the ground model has run, the updated cells with zone surface boundary conditions will update the OtherSideConditionsModel temperatures which are the used at the next timestep in the surface heat balance calculations.

#### Simulation Methodology

The ground domain is updated at each zone timestep, or hourly as specified by the user. For situations when the ground domain is updated at each timestep, the domain is simulated by applying the surface heat flux boundary conditions from the previous timestep and calculating a new OthersideConditionsModeltemperature. At this point, the surface heat balance algorithms can then take the new outside surface temperatures to update their surface heat fluxes. For situations when the user has elected to have the domain update on an hourly basis, the surface heat balance for each coupled surface is aggregated and passed to the domain as an average surface heat flux from the previous hour, which will then update the outside surface temperatures for the surface heat balance’s next iteration.

Both in-grade and on-grade scenarios are simulated with the GroundDomain object. The key difference being that for in-grade situations, the slab and horizontal insulation are simulated by the ground domain, whereas for the on-grade situations the slab and horizontal insulation must be included in the floor construction object. All possible insulation/slab configurations are seen in Table 18.

Table 18. Possible insulation/slab configurations for Site:GroundDomain model.

<table class="table table-striped">
<tr>
<th>Situations</th>
<th>Vert. Ins.</th>
<th>Horiz Ins. (Full)</th>
<th>Horiz Ins. (Perim)</th>
</tr>
<tr>
<td rowspan="6">In-Grade</td>
<td>1</td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>2</td>
<td>X</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>3</td>
<td>X</td>
<td></td>
<td>X</td>
</tr>
<tr>
<td>4</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>5</td>
<td></td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>6</td>
<td></td>
<td></td>
<td>X</td>
</tr>
<tr>
<td rowspan="4">On-Grade</td>
<td>7</td>
<td>X</td>
<td></td>
<td></td>
</tr>
<tr>
<td>8*</td>
<td>X</td>
<td>X</td>
<td></td>
</tr>
<tr>
<td>9</td>
<td></td>
<td></td>
<td></td>
</tr>
<tr>
<td>10*</td>
<td></td>
<td>X</td>
<td></td>
</tr>
</table>
\* Horizontal insulation must be included in the floor construction

For the slab-in-grade scenarios, a thin surface layer must be included in the floor construction. This can be a very thin layer of the slab or other floor covering materials above the slab. This provides a zone boundary condition for the GroundDomain while still allowing 3-dimensional heat transfer effects to occur within the slab.

#### References

Kusuda, T. & Achenbach, P. 1965. Earth Temperature and Thermal Diffusivity at Selected Stations in the United States, ASHRAE Transactions 71(1): 61–75.

Allen, R.G., Walter, I.A., Elliott, R.L., Howell, T.A., Itenfisu, D., Jensen, M.E., Snyder, R.L. 2005. The ASCE Standardized Reference Evapotranspiration Equation. Reston, VA: American Society of Civil Engineers.

Ground Heat Transfer Calculations using Site:GroundDomain:Basement
------------------------------------------------------------------

Basement heat transfer calculations are performed by the same model used by Site:GroundDomain:Slab to simulate zone-ground coupled surfaces. To simulate basements, the previous model is extended to situations where surfaces are below ground.

#### Approach

This model is generalized to be able to handle several basement surface and insulation configurations. An implicit finite difference formulation is used to solve for the ground temperatures. As a result the simulation is stable for all timesteps and grid sizes, but an iteration loop must be employed to converge the temperatures in the domain for each domain timestep.

Multiple basement zones can be coupled to each basement domain object. The model determines which floor surfaces are coupled to the basement domain and creates a floor surface of equivalent surface area within the basement domain as a representation of the horizontal surfaces coupled to the domain. The user defined aspect ratio, which is the ratio of basement width to length, along with the total surface area of all surfaces connected to this basement floor will define the size and shape of the basement ground domain.

Vertical basement depth below the ground surface of the domain is user specified. For situations when the ground surface is lower than the first above ground level a separate surface should be employed to bridge the space between the ground domain, and the first above-ground level.

Basement wall and floor surfaces are created normally using the BuildingSurface:Detailed objects, with the outside boundary condition being the OtherSideConditionsModel used for the walls and floor of the basement domain. The interface between the basement walls and floors occurs at the outside surface of the walls and floor. Outside underground insulation is simulated by the ground domain, and therefore should not be included in the basement wall and floor construction objects.

#### Boundary Conditions

At the zone interface surfaces, the average surface conduction heat flux from all surfaces connected to the ground domain is imposed as a boundary condition at the Surface/Domain interface cells. Far-field temperatures are applied as boundary temperature at the domain sides and lower surface. The ground temperature profile at the domain sides and lower surface are taken from Kusuda & Achenbach 1965. The correlation requires annual ground surface temperature data. Ground surface temperature data can be determined by using the CalcSoilSurfTemp preprocessor; or, if the user has average monthly ground surface temperature data available, they can use the Site:GroundTemperature:Shallow object to provide the model monthly ground surface temperatures. From that, the model can then determine the ground temperature model parameters for the Kusuda & Achenbach (1965) ground temperature model.

Ground surface cells are treated as a heat balance, where long and short wave radiation, conduction, and convection are considered. Evapotranspiration is also considered. The evapotranspiration rate is calculated as a moisture loss by using the Allen et al. (2005) model, and translated into a heat loss by multiplication with the density and latent heat of evaporation of water. The evapotranspiration rate is dependent on the type of vegetation at the surface; the user can vary the surface vegetation from anywhere between a concrete surface and a fairly tall grass (about 7”). The model can be sensitive to variations in this parameter, especially in hot dry climates.

Once the basement model has run, the updated cells with zone surface boundary conditions will update the OtherSideConditionsModel temperatures which are then used at the next timestep in the surface heat balance calculations.

#### Simulation Methodology

The ground domain is updated at each zone timestep, or hourly as specified by the user. For situations when the ground domain is updated at each timestep, the domain is simulated by applying the surface heat flux boundary conditions from the previous timestep and calculating a new OthersideConditionsModel temperature. At this point, the surface heat balance algorithms can then take the new outside surface temperatures to update their surface heat fluxes. For situations when the user has elected to have the domain update on an hourly basis, the surface heat flux for each coupled surface is aggregated and passed to the domain as an average surface heat flux from the previous hour, which will then update the outside surface temperatures for the surface heat balance’s next iteration.

The basement floor and walls are simulated by standard surface heat balance models within EnergyPlus (CTF, finite difference). The horizontal and vertical insulation are simulated by the ground domain finite difference solver. This is shown in the [Figure](#BasementGHTFigure1) below where the dotted red line defines the OtherSideConditionsModel interface separating the two solution domains. This methodology applies to the basement floor and walls.

![](EngineeringReference/media/image8000.png)

Figure: Example surface construction. <a name="BasementGHTFigure1"></a>

References

Kusuda, T. & Achenbach, P. 1965. ‘Earth Temperature and Thermal Diffusivity at Selected Stations in the United States’, ASHRAE Transactions 71(1): 61–75.

Allen, R.G., Walter, I.A., Elliott, R.L., Howell, T.A., Itenfisu, D., Jensen, M.E., Snyder, R.L. 2005. The ASCE standardized reference evapotranspiration equation. Reston, VA: American Society of Civil Engineers.
Advanced Surface Concepts
=========================

Exterior Naturally Vented  Cavity
---------------------------------

The input object “SurfaceProperty:ExteriorNaturalVentedCavity” allows modeling a special case for the outside boundary conditions of heat transfer surfaces with a multi-skin exterior that is opaque.  From the thermal envelope’s point of view, the presence of a vented cavity on the outside of the surface modifies the conditions experienced by the underlying heat transfer surfaces.  This exterior cavity acts as a radiation and convection baffle situated between the exterior environment and the outside face of the underlying heat transfer surface.  The actual outer surface is referred to as the “baffle”.  The modeling here assumes that the heat capacity in the outer baffle can be neglected since it is much lower than the underlying mass surface.  This object is used with the BuildingSurface:Detailed object where the heat transfer surfaces are referred to as the underlying surfaces.  The constructions and materials for the heat transfer surfaces should reflect the construction of just the underlying surface.  The SurfaceProperty:ExteriorNaturalVentedCavity object is used to describe the detached layer, or baffle, and the characteristics of the cavity and openings for natural ventilation.  This model uses the SurfaceProperty:OtherSideConditionsModel object to pass boundary conditions to the heat transfer modeling for the underlying surfaces.

### Baffle Heat Balance

The baffle is assumed to be sufficiently thin and high-conductivity so that it can be modeled using a single temperature (for both sides and along its area).  This temperature <span>${T_{s,baff}}$</span>is determined by formulating a heat balance on a control volume that just encapsulates the baffle surface.  The baffle is assumed to completely cover the underlying surface such that it is opaque to shortwave and longwave radiation.  This assumption means that even though the baffle will have some open area for ventilation, no solar energy passes through these openings. The heat balance is diagrammed in the following figure.

![](EngineeringReference/media/image438.png)

Figure 33.  Baffle Surface Heat Balance

The heat balance on the baffle surface’s control volume is:

<div>$${q''_{\alpha sol}} + {q''_{LWR,Env}} + {q''_{conv,Env}} + {q''_{LWR,cav}} + {q''_{conv,cav}} + {q''_{source}} = 0$$</div>

where:

<sub><span>${q''_{\alpha sol}}$</span> </sub>is absorbed direct and diffuse solar (short wavelength) radiation heat flux.

<span>${q''_{LWR,Env}}$</span> is net long wavelength (thermal) radiation flux exchange with the air and surroundings.

<sub><span>${q''_{conv,Env}}$</span> </sub>= surface convection flux exchange with outside air.

<sub><span>${q''_{LWR,cav}}$</span> </sub>is net long wavelength (thermal) radiation flux exchange with the outside face of the underlying surface(s).

<sub><span>${q''_{conv,cav}}$</span> </sub>= surface convection flux exchange with cavity air.

<span>${q''_{source}}$</span> is a source/sink term that accounts for energy exported out of the control volume when the baffle is a hybrid device such as a photovoltaic panel.

All terms are positive for net flux to the baffle.  Each of these heat balance components is introduced briefly below.

#### External SW Radiation

<sub><span>${q''_{\alpha sol}}$</span> </sub> is calculated using procedures presented elsewhere in this manual and includes both direct and diffuse incident solar radiation absorbed by the surface face.  This is influenced by location, surface facing angle and tilt, shading surfaces, surface face material properties, weather conditions, etc.  The baffle blocks all shortwave radiation from reaching the underlying surface.

#### External LW Radiation

<span>${q''_{LWR,Env}}$</span> is a standard radiation exchange formulation between the surface, the sky, the ground, and the atmosphere.  The radiation heat flux is calculated from the surface absorptivity, surface temperature, sky, air, and ground temperatures, and sky and ground view factors.  Radiation is modeled using linearized coefficients.  The baffle blocks all longwave radiation.

#### External Convection

<span>$q''_{conv,env}$</span> is modeled using the classical formulation: <span>$q''_{conv} = h_{co}(T_{air} - T_{o})$</span> where h<sub>co</sub>, is the convection coefficient.  The h<sub>co</sub> is treated in the same way as an outside face with ExteriorEnvironment conditions.  In addition, when it is raining outside, we assume the baffle gets wet and model the enhanced surface heat transfer using a large value for <span>${h_{co}}$</span>.

#### Cavity LW Radiation

<span>${q''_{LWR,cav}}$</span>is a standard radiation exchange formulation between the baffle surface and the underlying heat transfer surface located across the cavity.  Radiation is modeled using linearized coefficients.

#### Cavity Convection

<span>$q''_{conv,cav}$</span> is modeled using the classical formulation: <span>$ q''_{conv} = h_{cp}(T_{air} - T_{o))$</span>  where h<sub>cp</sub>, is the convection coefficient.  The value for h<sub>cp</sub> is obtained from correlations used for window gaps from ISO (2003) standard 15099.

Substituting models into (113) and solving for <span>${T_{s,baff}}$</span> yields the following equation:

<div>$${T_{s,baff}} = \frac{{\left( {{I_s}\alpha  + {h_{co}}{T_{amb}} + {h_{r,atm}}{T_{amb}} + {h_{r,sky}}{T_{sky}} + {h_{r,gnd}}{T_{amb}} + {h_{r,cav}}{T_{so}} + {h_{c,cav}}{T_{a,cav}} + {{q''}_{source}}} \right)}}{{\left( {{h_{co}} + {h_{r,air}} + {h_{r,sky}} + {h_{r,gnd}} + {h_{r,cav}} + {h_{c,cav}}} \right)}}$$</div>

where,

<span>${I_s}$</span> is the incident solar radiation of all types [W/m<sup>2</sup>],

<span>$\alpha $</span> is the solar absorptivity of the baffle [dimensionless],

<span>${h_{r,atm}}$</span>is the linearized radiation coefficient for the surrounding atmosphere [W/m<sup>2</sup>·K],

<span>${T_{amb}}$</span> is the outdoor drybulb from the weather data, also assumed for ground surface [ºC],

<span>${h_{r,sky}}$</span> is the linearized radiation coefficient for the sky [W/m<sup>2</sup>·K],

<span>${T_{sky}}$</span> is the effective sky temperature [ºC],

<span>${h_{r,gnd}}$</span> is the linearized radiation coefficient for the ground [W/m<sup>2</sup>·K],

<span>${h_{r,cav}}$</span> is the linearized radiation coefficient for the underlying surface [W/m<sup>2</sup>·K],

<span>${T_{so}}$</span> is the temperature of the outside face of the underlying heat transfer surface [ºC],

<span>${h_{co}}$</span> is the convection coefficient for the outdoor environment [W/m<sup>2</sup>·K],

<span>${h_{c,cav}}$</span> is the convection coefficient for the surfaces facing the plenum [W/m<sup>2</sup>·K], and

<span>${T_{a,cav}}$</span> is the drybulb temperature for air in the cavity [ºC].

### Cavity Heat Balance

The *cavity* is the volume of air located between the baffle and the underlying heat transfer surface.  The cavity air is modeled as well-mixed.  The uniform temperature of the cavity air, <span>${T_{a,cav}}$</span>, is determined by formulating a heat balance on a control volume of air as diagrammed below.

![](EngineeringReference/media/image469.png)

Figure 34.  Cavity Air Heat Balance



The heat balance on the cavity air control volume is:

<div>$${\dot Q_{vent}} + {\dot Q_{co}} + {\dot Q_{c,baff}} = 0$$</div>

where,

<span>${\dot Q_{vent}}$</span> is the net rate of energy added from natural ventilation – where outdoor ambient air exchanges with the cavity air.

<sub><span>${\dot Q_{co}}$</span> </sub> is the net rate of energy added by surface convection heat transfer with the underlying surface.

<span>${\dot Q_{c,baff}}$</span>is the net rate of energy added by surface convection heat transfer with the collector.

And substituting into yields the following equation:

<div>$${T_{a,cav}} = \frac{{\left( {{h_{c,cav}}A\,{T_{so}} + {{\dot m}_{vent}}{c_p}{T_{amb}} + {h_{c,cav}}A\,{T_{s,baff}}} \right)}}{{\left( {{h_{c,cav}}A + {{\dot m}_{vent}}{c_p} + {h_{c,cav}}A} \right)}}$$</div>

where,

<span>${\dot m_{vent}}$</span> is the air mass flow from natural forces [kg/s]

Modeling natural ventilation air exchanges in a general way is challenging.  Simplistic engineering models are used to model <span>${\dot m_{vent}}$</span> resulting from natural buoyancy and wind forces.  Reasoning that the configuration is similar to single-side natural ventilation, we elect to use correlations for natural ventilation presented as equations (29) and (30) in Chapter 26. of ASHRAE HOF (2001).

<div>$${\dot m_{vent}} = \rho \,{{\rm{\rlap{--} \dot V}}_{{\rm{tot}}}}$$</div>

where,

<span>$\rho $</span> is the density of air [kg/m<sup>3</sup>], and

<span>$\dot{V}_{tot} = \dot{V}_{wind} + \dot{V}_{thermal} $</span> is the total volumetric flow rate of air ventilating in and out of the cavity.

<div>$$\dot{V}_{wind} = C_{v}A_{in}U_{\infty}$$</div>

<div>$$
  \dot{V}_{thermal} = \left\{
    \begin{array}{cl}
      C_{D}A_{in}\sqrt{2g\Delta H_{NPL}\left(T_{a,cav}-T_{amb}\right)/T_{a,cov}} & \; \left(T_{a,cav}>T_{amb}\right) \\
      C_{D}A_{in}\sqrt{2g\Delta H_{NPL}\left(T_{amb}-T_{a,cav}\right)/T_{amb}} & \; \left(T_{a,cav} \lt T_{amb}\,\text{and baffle is vertical}\right) 
    \end{array}
  \right.
$$</div>

<span>${{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}} = {C_D}{A_{in}}\sqrt {2g\Delta {H_{NPL}}\left( {{T_{a,cav}} - {T_{amb}}} \right)/{T_{a,cav}}} $</span>  (if <span>${T_{a,cav}} > {T_{amb}}$</span>)

<span>${{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}} = {C_D}{A_{in}}\sqrt {2g\Delta {H_{NPL}}\left( {{T_{amb}} - {T_{a,cav}}} \right)/{T_{amb}}} $</span>  (if <span>${T_{amb}} > {T_{a,cav}}$</span> and baffle is vertical)

<span>${C_v}$</span> is the effectiveness of the openings that depends on opening geometry and the orientation with respect to the wind.  ASHRAE HoF (2001) indicates values ranging from 0.25 to 0.6.  This value is available for user input.

<span>${C_D}$</span> is the discharge coefficient for the opening and depends on opening geometry.  This value is available for user input.

Mass continuity arguments lead to modeling the area of the openings as one half of the total area of the openings, so we have:

<div>$${A_{in}} = \frac{{A\,}}{2}$$</div>

<span>$g$</span> is the gravitational constant taken as 9.81 [m/s<sup>2</sup>].

<span>$\Delta {H_{NPL}}$</span> is the height from midpoint of lower opening to the Neutral Pressure Level.  This is value is available for user input.

If the cavity is horizontal and <span>${T_{amb}} > {T_{a,cav}}$</span> then <span>${{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}}{\rm{  =  0}}$</span> because this is a stable situation.

### Underlying Heat Transfer Surface

The exterior baffle and cavity are applied to the outside of a heat transfer surface.  This surface is modeled using the usual EnergyPlus methods for handling heat capacity and transients – typically the CTF method.  These native EnergyPlus heat balance routines are used to calculate <span>${T_{so}}$</span>.  The exterior baffle and cavity system is coupled to the underlying surface using the SurfaceProperty:OtherSideConditionsModel mechanism.  The exterior naturally vented cavity model provides values for <span>${h_{r,cav}}$</span>,<span>${T_{s,baff}}$</span>, <span>${h_{c,cav}}$</span>, and <span>${T_{a,cav}}$</span> for use with the heat balance model calculations for the outside face of the underlying surface (described elsewhere in this manual).

### Solar and Shading Calculations

The exterior vented cavity model uses standard EnergyPlus surfaces in order to take advantage of the detailed solar and shading calculations.  Solar radiation incident on the surface includes beam and diffuse radiation, as well as radiation reflected from the ground and adjacent surfaces.  Shading of the collector by other surfaces, such as nearby buildings or trees, is also taken into account.

### Local Wind Speed Calculations

The outdoor wind speed affects terms used in modeling.  The wind speed in the weather file is assumed to be measured at a meteorological station located in an open field at a height of 10 m.  To adjust for different terrain at the building site and differences in the height of building surfaces, the local wind speed is calculated for each surface.

The wind speed is modified from the measured meteorological wind speed by the equation (ASHRAE 2001):

<div>$${U_\infty } = {V_{met}}{\left( {\frac{{{\delta_{met}}}}{{{z_{met}}}}} \right)^{{a_{met}}}}{\left( {\frac{z}{\delta }} \right)^a}$$</div>

where z is the height of the centroid of the system, z<sub>met</sub> is the height of the standard meteorological wind speed measurement, and a and d are terrain-dependent coefficients.  d is the boundary layer thickness for the given terrain type.  The values of a and d are shown in the following tables:

Table 19. Terrain-Dependent Coefficients (ASHRAE 2001).

<table class="table table-striped">
<tr>
<th>Terrain</th>
<th>Description</th>
<th>Exponent, a</th>
<th>Layer Thickness,d (m)</th>
</tr>
<tr>
<td>1</td>
<td>Flat, open country</td>
<td>0.14</td>
<td>270</td>
</tr>
<tr>
<td>2</td>
<td>Rough, wooded country</td>
<td>0.22</td>
<td>370</td>
</tr>
<tr>
<td>3</td>
<td>Towns and cities</td>
<td>0.33</td>
<td>460</td>
</tr>
<tr>
<td>4</td>
<td>Ocean</td>
<td>0.10</td>
<td>210</td>
</tr>
<tr>
<td>5</td>
<td>Urban, industrial, forest</td>
<td>0.22</td>
<td>370</td>
</tr>

</table>

The exterior vented cavity can be defined such that it has multiple underlying heat transfer surfaces.  The centroid heights for each surface are area-weighted to determine the average height for use in the local wind calculation.

### Convection Coefficients

Exterior cavity modeling requires calculating up to three different coefficients for surface convection heat transfer.  These coefficients are defined in the classic way by:

<div>$${h_c} = \frac{{{T_{air}} - {T_{surf}}}}{{{{q''}_{conv}}}}$$</div>

First, <span>${h_{co}}$</span> is the convection coefficient for the baffle surface facing the outdoors.  It is modeled in exactly the same way as elsewhere in EnergyPlus and will depend on the user setting for Outside Convection Algorithm – Outside Surface Heat Balance entry elsewhere in this document.

Second, <span>${h_{c,cav}}$</span> is the convection coefficient for baffle surfaces facing the cavity.  This coefficient is applied to both the baffle and the underlying surface.  The convection coefficient is modeled in the same way used in EnergyPlus to model air gaps in windows.  These correlations vary by Rayleigh number and surface tilt and are based on the work of various research including Hollands et. al., Elsherbiny et. al., Wright, and Arnold.  The formulations are documented in ISO (2003) standard 15099.  The routines were adapted from Subroutine NusseltNumber in WindowManager.f90 (by F. Winkelmann), which itself was derived from Window5 subroutine “nusselt”.

### Radiation Coefficients

Exterior vented cavity modeling requires calculating up to four different linearized coefficients for radiation heat transfer.  Whereas radiation calculations usually use temperature raised to the fourth power, this greatly complicates solving heat balance equations for a single temperature.  Linearized radiation coefficients have the same units and are used in the same manner as surface convection coefficients and introduce very little error for the temperature levels involved.

The radiation coefficient, <span>${h_{r,cav}}$</span>, is used to model thermal radiation between the collector surface and the outside face of the underlying heat transfer surface.  We assume a view factor of unity.  It is calculated using:

<div>$${h_{r,cav}} = {\sigma_{SB}}{e_{baff}}{e_{so}}\frac{{\left( {T_{s,baff}^4 - T_{so}^4} \right)}}{{\left( {{T_{s,baff}} - {T_{so}}} \right)}}$$</div>

where,

all temperatures are converted to Kelvin,

<span>${\sigma_{SB}}$</span> is the Stefan-Boltzmann constant,

<span>${e_{baff}}$</span> is the longwave thermal emittance of the baffle, and

<span>${e_{so}}$</span> is the longwave thermal emittance of the underlying heat transfer surface.

The three other coefficients, <span>${h_{r,atm}}$</span>, <span>${h_{r,sky}}$</span>, and <span>${h_{r,gnd}}$</span> are used elsewhere in EnergyPlus for the outside face surface heat balance and are calculated in the same manner as equation .  [This is accomplished by calling subroutine InitExteriorConvectionCoeffs in the file HeatBalanceConvectionCoeffs.f90. ]

### References

ASHRAE HOF 2001.  2001 ASHRAE Fundamentals Handbook.  American Society of Heating Refrigeration and Air-Conditioning Engineers. Altanta GA.

ISO. 2003. ISO 15099:2003. Thermal performance of windows, doors, and shading devices – Detailed calculations. International Organization for Standardization.

Green Roof Model (EcoRoof)
----------------------------------------------------

### Overview

The input object Material:RoofVegetation provides a model for green roofs (aka ecoroofs or vegetated roofs) that are becoming increasingly common for both new and retrofit buildings. There is widespread recognition and a growing literature of measured data that suggest green roofs can reduce building energy consumption. Currently, however, there are few design tools available to assist developers and architects in assessing the likely magnitude of energy savings associated with various implementation options (e.g., soil type/depth, irrigation options, plant type). As a result there is a significant need for a quantitative and physically-based building energy simulation tool that represents the effects of green roof constructions. Such a tool would facilitate more rapid spread of green roof technologies and make it possible to account for green roof benefits in state energy codes and related energy efficiency standards such as LEED.

In response to the need for green roof design tools a computational model of the heat transfer processes involved on a vegetated roof has been developed. This model accounts for:

* long wave and short wave radiative exchange within the plant canopy,

* plant canopy effects on convective heat transfer,

* evapotranspiration from the soil and plants, and

* heat conduction (and storage) in the soil layer

The ability to track moisture-dependent thermal properties is not implemented yet due to stability issues in the CTF scheme, but is under development for use with the finite difference solution scheme made available in EnergyPlus starting in version 2.

As implemented in EnergyPlus the green roof module allows the user to specify “ecoroof” as the outer layer of a rooftop construction using a “Material:RoofVegetation” object. The user can then specify various aspects of the green roof construction including growing media depth, thermal properties, plant canopy density, plant height, stomatal conductance (ability to transpire moisture), and soil moisture conditions (including irrigation).

The model formulation includes the following:

* simplified moisture balance that allows precipitation, irrigation, and moisture transport between two soil layers (top and root zone).

* soil and plant canopy energy balance based on the Army Corps of Engineers’ FASST vegetation models (Frankenstein and Koenig), drawing heavily from BATS (Dickenson et al.) and SiB (Sellers et al.).

* soil surface (T<sub>g</sub>) and foliage (T<sub>f</sub>) temperature equations are solved simultaneously each time step, inverting the CTF to extract heat flux information for the energy balance calculation.

The detailed energy balance analysis and resulting equations, being rather complicated, are summarized here. The interested reader is referred to the FASST documentation cited herein for the complete development. The end result is a set of two simultaneous equations for temperature—one for the soil surface and the other for the foliage.

### Green Roof Model Description

As with a traditional roof, the energy balance of an green roof is dominated by radiative forcing from the sun. This solar radiation is balanced by sensible (convection) and latent (evaporative) heat flux from soil and plant surfaces combined with conduction of heat into the soil substrate. This energy balance is illustrated in Figure 35. The variables introduced in this figure are defined in the equations that follow.

![Fig1EcoRoof](EngineeringReference/media/image509.png)

Figure 35.  The Energy Balance for a Green Roof.

The energy budget analysis follows the Fast All Season Soil Strength (FASST) model developed by Frankenstein and Koenig for the US Army Corps of Engineers. FASST was developed, in part, to determine the ability of soils to support manned and unmanned vehicles and personnel movement. In order to accomplish this, however, FASST tracks the energy and moisture balance (including ice and snow) within a vegetated soil. It is a one-dimensional model that draws heavily from other plant canopy models including BATS (Dickinson et al.) and SiB (Sellers et al.). We have implemented FASST here with only a few modifications to adapt it for use with a relatively thin soil layer. The sign convention used assumes all heat fluxes are positive when energy is absorbed into the layer.

In the following discussion this energy budget is divided into a budget for the foliage layer (F<sub>f</sub>) and a budget for the ground surface (F<sub>g</sub>­). The various parameterizations for latent and sensible heat flux are described in some detail and then the equation set is reduced to the simultaneous solution of two equations involving the temperatures of the foliage and ground surface.

#### Energy budget in the foliage layer

The foliage energy balance is given by:

<div>$${F_f} = {\sigma_f}\left[ {{I_S}^ \downarrow (1 - {\alpha_f}) + {\varepsilon_f}{I_{ir}}^ \downarrow  - {\varepsilon_f}\sigma {T_f}^4} \right] + \frac{{{\sigma_f}{\varepsilon_g}{\varepsilon_f}\sigma }}{{{\varepsilon_1}}}\left( {{T_g}^4 - {T_f}^4} \right) + {H_f} + {L_f}$$</div>

In addition to convective and sensible heat transfer this equation accounts for both the short and longwave radiation absorbed by the vegetation, including the effects of multiple reflections. The sensible and latent heat flux terms (H<sub>f</sub> and L<sub>f­</sub>) are somewhat complicated and therefore discussed in some detail below.

##### Sensible heat flux in the foliage layer

The sensible heat transfer between the leaf surface and near-canopy air (H<sub>f</sub>) is influenced by the temperature difference between them, wind speed, and Leaf Area Index (LAI). The Leaf Area Index is the dimensionless ratio of the projected leaf area for a unit ground area (Oke). In contrast fractional vegetative cover (s<sub>f</sub>) is the ratio of shaded ground surface to total ground surface area. The sensible heat flux is given by:

<div>$${H_f} = (1.1*LAI{\rho_{af}}{C_{p,a}}{C_f}{W_{af}})*({T_{af}} - {T_f})$$</div>

In this equation the constant 1.1 accounts for heat transfer from the stems, twigs and limbs (Deardorff). The properties of air near the foliage are modeled using the average from the foliage and instrument conditions:

<div>$${\rho_{af}} = 0.5({\rho_a} + {\rho_f})$$</div>

where r<sub>a</sub> is the density of air at the instrument height  and r<sub>f</sub> is the density of air at the leaf temperature. The air temperature within the foliage is estimated by:

<div>$${T_{af}} = (1 - {\sigma_f})({T_a}) + {\sigma_f}\left( {0.3{T_a} + 0.6{T_f} + 0.1{T_g}} \right)$$</div>

*where, T<sub>a</sub>* is the air temperature at the instrument height in Kelvin *T<sub>f</sub>*, is leaf temperature in Kelvin and *T<sub>g</sub>*, is the ground surface temperature in Kelvin. The foliage wind speed is estimated as:

<div>$${W_{af}} = 0.83{\sigma_f}W\sqrt {C_{hn}^f}  + (1 - {\sigma_f})W$$</div>

Here *W* is the larger of 2.0 m/s or the actual wind speed above the canopy (Hughes et al.) and C<sup>f</sup><sub>hn</sub> is the transfer coefficient at near-neutral atmospheric stability conditions:

<div>$$C_{hn}^f = {K_v}^2 \cdot {\left( {\ln \left( {\frac{{{Z_a} - {Z_d}}}{{Z_o^f}}} \right)} \right)^{ - 2}}$$</div>

where *K<sub>v</sub>,* is von Karmen’s constant (0.4), Z<sub>a</sub> is the instrument height, Z<sub>d</sub> is the zero displacement height in meters (height above soil within which the wind speed is effectively zero), and Z<sup>f</sup><sub>o</sub> is the foliage roughness length scale (m). The formulations for zero displacement height, roughness length are based on Balick et al.:

<div>$${Z_d} = 0.701Z_{_f}^{0.979}$$</div>

<div>$${Z_o} = 0.131Z_{_f}^{0.997}$$</div>

Finally, the bulk transfer coefficient as defined by Deardorff is given by:

<div>$${C_f} = 0.01*\left( {1 + \frac{{0.3(m/s)}}{{{W_{af}}(m/s)}}} \right)$$</div>

##### Latent heat flux in the foliage layer

The process of water loss through plant respiration is known as transpiration. It is controlled by the closing and opening of stomata - the intercellular openings between to epidermal (guard) cells (Gates). The resistance to the diffusion of water vapor from these spaces into the atmosphere is called stomatal resistance. It depends on factors such as light intensity, soil moisture content and vapor pressure difference between inside leaf and the outside atmosphere. It is measured in units of s/m and is formulated as:

<div>$${r_s} = \frac{{{r_{s,\min }}}}{{LAI}} \cdot {f_1} \cdot {f_2} \cdot {f_3}$$</div>

Here, r<sub>s,min</sub> is the minimum stomatal resistance. The actual stomatal resistance at any time is proportional to this minimum resistance and inversely proportional to LAI. The stomatal resistance is further modified by fractional multiplying factors that relate to incoming solar radiation and atmospheric moisture. As found in Frankenstein and Koenig the inverses of the multiplying factors f<sub>1</sub>, f<sub>2</sub>, and f<sub>3</sub> are given by:

<div>
 $$
  \begin{array}{l}
   \frac{1}{f_1} = \min \left[ 1,\frac{{0.004*{I_s}^ \downarrow  + 0.005}}{{0.81*(0.004*{I_s}^ \downarrow  + 1)}} \right] \\
   \frac{1}{f_2} = \left\{ 
     \begin{array}{cl}
       0                                                                 & \text{when} \; \theta_r \gt \overline \theta \\
       \frac{ \overline \theta   - \theta_r }{ \theta_{max} - \theta_r } & \text{when} \; \theta_r \le \overline \theta \le \theta_{max}
     \end{array} \right. \\
   \frac{1}{f_3} = \exp \left[ - {g_d}({e_{f,sat}} - {e_a} \right]
  \end{array}
 $$
</div>

Here, Q<sub>r</sub>, is the residual moisture content (defined as the amount of moisture in soil when plants begin to wilt), Q<sub>max</sub> is the maximum moisture content (defined as the maximum amount of moisture a particular type of soil can hold and above which run off occurs), and <span>$\overline \Theta  $</span> is the average soil moisture in the root zone. The residual moisture content is typically around 0.01 m<sup>3</sup>/m<sup>3</sup> (Frankenstein and Koenig). The maximum moisture content depends upon the soil, but generally varies from 0.3 to 0.6 m<sup>3</sup>/m<sup>3</sup> (Guymon et al.). In the expression for f<sub>3</sub>, g<sub>d</sub> is a plant specific characteristic that is only non-zero for trees, e<sub>f,sat</sub> is the saturated vapor pressure at the leaf temperature, and e<sub>a</sub> is the air vapor pressure.

Resistance to moisture exchange offered by the boundary layer formed on the leaf surface is known as aerodynamic resistance. It is measured in units of (s/m) and is influenced by wind speed, surface roughness and stability of the atmosphere (Oke). It is formulated as:

<div>$${r_a} = \frac{1}{{{c_f}{W_{af}}}}$$</div>

The combined effect of aerodynamic and stomatal resistances to vapor diffusion is integrated into a foliage surface wetness factor:

<div>$$r'' = \frac{{{r_a}}}{{{r_a} + {r_s}}}$$</div>

This surface wetness factor is simply a ratio of the aerodynamic resistance to the total resistance. When the aerodynamic resistance is small the wetness factor approaches zero (leaf surfaces remain dry as surface moisture is readily evaporated). As the aerodynamic resistance increases in importance relative to stomatal resistance the wetness factor approaches 1.0 (moisture readily travels to the leaf surfaces, but is not easily evaporated).

The latent heat flux is then given by:

<div>$${L_f} = {l_f} * LAI{\rho_{af}}{C_f}{W_{af}}{r^``}\left( {{q_{af}} - {q_{f,sat}}} \right)$$</div>

Here *l<sub>f</sub>* , is the latent heat of vaporization (J/kg), q<sub>f,sat</sub> is the saturation mixing ratio at the leaf surface temperature, and q<sub>af</sub> is the mixing ratio of the air within the canopy. As developed in Frankenstein and Koenig the mixing ratio within the canopy can be determined from:

<div>$${q_{af}} = \left[ {\frac{{\left( {1 - {\sigma_f}} \right){q_a} + {\sigma_f}\left( {0.3{q_a} + 0.6{q_{f,sat}}{r^``} + 0.1{q_{f,sat}}{M_g}} \right)}}{{1 - {\sigma_f}\left[ {0.6\left( {1 - {r^``}} \right) + 0.1\left( {1 - {M_g}} \right)} \right]}}} \right]$$</div>

where the factor *M<sub>g</sub>*  (ranging from 0 to 1) is the ratio of volumetric moisture content to the porosity of the soil (Koenig). The latent heat of vaporization (*l<sub>f</sub>*) is the amount of energy required to convert a unit mass of water to vapor. It is measured in units of J/kg and is inversely proportional to the temperature. From Henderson-Sellers it is estimated as:

<div>$${l_f} = 1.91846*{10^6}{\left[ {\frac{{{T_f}}}{{{T_f} - 33.91}}} \right]^2}$$</div>

#### Soil Energy budget

The energy budget at the soil surface is mainly influenced by the soil thermal properties, the amount of foliage coverage (s<sub>f</sub>) and the amount of moisture in the soil. If the soil surface is densely covered the diurnal range of surface temperature is small. In the soil energy budget the heat released or gained due to phase changes of soil water, precipitation heat flux and heat flux due to vertical transport of water in the soil are ignored. Future refinements to this model will incorporate these phenomena. The sign convention followed here is the same as above (heat flux into the soil is positive). The overall energy balance at the soil surface (as given in Frankenstein and Koenig) is:

<div>$${F_g} = (1 - {\sigma_f})\left[ {I_s^ \downarrow (1 - {\alpha_g}) + {\varepsilon_g}I_{ir}^ \downarrow  - {\varepsilon_g}T_g^4} \right] - \frac{{{\sigma_f}{\varepsilon_g}{\varepsilon_f}\sigma }}{{{\varepsilon_1}}}\left( {T_g^4 - T_f^4} \right) + {H_g} + {L_g} + K*\frac{{\partial {T_g}}}{{\partial z}}$$</div>

As with the energy equation for the foliage this equation represents sensible heat flux (H<sub>g</sub>), latent heat flux (L<sub>g</sub>) and the multiple reflections associated with long and short wave radiation. The final term on the right side gives the conduction of heat into the soil substrate.

##### Sensible heat flux in the soil layer

Sensible heat flux between the soil surface and air in its vicinity is dependent on the temperature difference between them and the wind speed within the canopy. It is given as

<div>$${H_g} = {\rho_{ag}}{C_{p,a}}C_h^g{W_{af}}({T_{af}} - {T_g})$$</div>

where <span>$C_h^g$</span> is the bulk transfer coefficient and r<sub>ag</sub> is the density of air near the soil surface (kg/m<sup>3</sup>) given by:

<div>$${p_{ag}} = \frac{{{p_a} + {p_g}}}{2}$$</div>

Here r<sub>g</sub> is the density of air at the ground surface temperature

The bulk transfer coefficient is given as the linear combination of bulk transfer coefficient near ground (C<sup>f</sup><sub>hn</sub>) and near foliage-atmosphere interface (C<sup>g</sup><sub>hn</sub>) multiplied by the stability factor (G<sub>h</sub>) and is formulated as:

<div>$$C_h^g = {\Gamma_k}\left[ {\left( {1 - {\sigma_f}} \right)C_{hn}^g + {\sigma_f}C_{hn}^f} \right]$$</div>

The ground and foliage bulk transfer coefficients, in turn, are given by:

<div>$$C_{hn}^g = r_{ch}^{ - 1}{\left[ {\frac{{{K_v}}}{{\ln \left( {{\raise0.7ex\hbox{${{Z_a}}$} \!\mathord{\left/ {\vphantom {{{Z_a}} {Z_o^g}}}\right.}\!\lower0.7ex\hbox{${Z_o^g}$}}} \right)}}} \right]^2}$$</div>

And

<div>$$C_{hn}^f = {\left[ {\frac{{{K_v}}}{{\ln \left( {{\raise0.7ex\hbox{${{Z_a} - {Z_d}}$} \!\mathord{\left/ {\vphantom {{{Z_a} - {Z_d}} {Z_o^f}}}\right.}\!\lower0.7ex\hbox{${Z_o^f}$}}} \right)}}} \right]^2}$$</div>

where<span>$Z_o^g$</span> and <span>$Z_o^f$</span> are the ground and foliage roughness lengths,  r<sub>ch</sub> is turbulent Schmidt number (0.63), and K<sub>v</sub> is the von Karman constant (0.4).

The condition of the atmosphere (G<sub>h</sub>) is determined as stable or unstable based on the sign of the bulk Richardson number:

<div>$${R_{ib}} = \frac{{2g{Z_a}\left( {{T_{af}} - {T_g}} \right)}}{{\left( {{T_{af}} + {T_g}} \right)W_{af}^2}}$$</div>

The atmospheric stability factor is then given by Businger and Lumley and Panofsky as:

<div>$$
  \Gamma_h = \left\{ 
    \begin{array}{cl}
      \frac{1.0}{\left( 1.0 - 16.0 R_{ib} \right)^{0.5}} & \text{for} \; R_{ib} \lt 0 \\
      \frac{1.0}{\left( 1.0 - 5.0  R_{ib} \right)      } & \text{for} \; R_{ib} \gt 0
    \end{array}
  \right.
$$</div>

##### Latent heat flux in the soil layer

Removal of water vapor from the soil surface depends on the difference between the mixing ratio of the soil surface and air and the wind speed within the canopy. The resulting latent heat flux is then given by:

<div>$${L_R} = C_e^g{l_g}{W_{af}}{\rho_{ag}}\left( {{q_{af}} - {q_g}} \right)$$</div>

Here<span>$C_e^g$</span>is the bulk transfer coefficient, l<sub>g</sub> is the latent heat of vaporization at the ground surface temperature, q<sub>af</sub> is the mixing ratio at the foliage-atmosphere interface, and q<sub>f</sub> is the mixing ratio at the ground surface, given by:

<div>$${q_g} = {M_g}{q_{g,sat}} + \left( {1 - {M_g}} \right){q_{af}}$$</div>

The bulk transfer coefficient for latent heat exchange is analogous to that for sensible heat exchange and is given by:

<div>$$C_e^g = {\Gamma_e}\left[ {\left( {1 - {\sigma_f}} \right)C_{en}^g + {\sigma_f}C_{hn}^f} \right]$$</div>

where <span>$C_{en}^g$</span> is the near ground bulk transfer coefficient for Latent heat flux and G<sub>e</sub> is the latent heat exchange stability correction factor (assumed to be the same as G<sub>h</sub>).

### Linearization

In order to solve the foliage and soil heat budget equations, the 4<sup>th</sup> <sup> </sup>order terms T<sub>f</sub><sup>4</sup> and T<sub>g</sub><sup>4</sup>  and mixing ratio terms q<sub>g,sat</sub> and q<sub>f,sat</sub> <sub> </sub>are linearized as given by Deardorff:

<div>$${\left[ {T_f^{\left( {n + 1} \right)}} \right]^4} = {\left[ {T_f^n} \right]^4} + 4{\left[ {T_f^n} \right]^3}\left[ {T_f^{n + 1} - T_f^n} \right]$$</div>

<div>$${\left[ {T_g^{\left( {n + 1} \right)}} \right]^4} = {\left[ {T_g^n} \right]^4} + 4{\left[ {T_g^n} \right]^3}\left[ {T_g^{n + 1} - T_g^n} \right]$$</div>

Here T<sub>f</sub><sup>n+1</sup> and T<sub>g</sub><sup>n+1</sup> are the current time step leaf and ground surface temperatures in Kelvin. T<sub>f</sub><sup>n</sup> and T<sub>g</sub><sup>n</sup> are the corresponding temperatures at the previous time step.

The saturation mixing ratio at the ground and leaf surface temperatures are given as:

<div>$${q_{g,sat}}\left( {T_g^{n + 1}} \right) = {q_{sat}}\left( {T_g^n} \right) + {\left( {\frac{{\partial {q_{sat}}}}{{\partial T}}} \right)_{T_g^n}} * \left( {T_g^{n + 1} - T_g^n} \right)$$</div>

<div>$${q_{f,sat}}\left( {T_f^{n + 1}} \right) = {q_{sat}}\left( {T_f^n} \right) + {\left( {\frac{{\partial {q_{sat}}}}{{\partial T}}} \right)_{T_f^n}} * \left( {T_f^{n + 1} - T_f^n} \right)$$</div>

where q<sub>sat</sub>(T<sub>g</sub><sup>n</sup>) is the saturation mixing ratio at the previous time step and is formulated as given in Garratt:

<div>$${q_{sat}}\left( {T_g^n} \right) = \frac{{0.622{e^ * }\left( {T_g^n} \right)}}{{P - {e^ * }\left( {T_g^n} \right)}}$$</div>

Here the saturation vapor pressure e\* (Pa) is evaluated at the ground temperature from the previous time step (T<sub>g</sub><sup>n</sup>) as:

<div>$${e^*} = 611.2\exp \left[ {17.67\left( {\frac{{T_g^n - 273.15}}{{T_g^n - 29.65}}} \right)} \right]$$</div>

The derivative of saturation mixing ratio at the previous time step is given by:

<div>$$\frac{{d{q^ * }}}{{dT_g^n}} = \left[ {\frac{{0.622 * P}}{{{{\left( {P - 0.378 * {e^ * }} \right)}^2}}}} \right]\left( {\frac{{d{e^ * }}}{{dT_g^n}}} \right)$$</div>

Here, the derivative of the saturation vapor pressure can be calculated from the Clausius-Clapeyron equation:

<div>$$\frac{{d{e^ * }}}{{dT_g^n}} = \frac{{{l_g} * {e^ * }\left( {T_g^n} \right)}}{{\left( {{R_v} * {{\left( {T_g^n} \right)}^2}} \right)}}$$</div>

Where R<sub>v</sub> is the gas constant for water vapor and l<sub>g</sub> is the latent heat of vaporization at the soil surface temperature.

The corresponding saturation mixing ratio relations for the leaf surfaces can be obtained by replacing T<sub>g</sub> with T<sub>f</sub> in the above relations.

### Final Equations

After linearization the final equations are of the form:

<div>$$C_1^f + C_2^f{T_g} + C_3^f{T_f} = 0$$</div>

<div>$$C_1^g + C_2^g{T_g} + C_3^g{T_f} = 0$$</div>

The coefficients in these equations result from the direct combination of the equations from the above development. The interested reader is directed to the papers by Frankenstein and Koenig for the complete and somewhat complicated expressions.

This final set of equations is then solved simultaneously to obtain T*<sub>g</sub>* and T*<sub>f</sub>* . One key difference in our implementation of the FASST algorithm is that the conduction terms in the equations for <span>$C_1^g$</span>and <span>$C_2^g$</span> are solved by inverting the Conduction Transfer Functions (CTF) within the EnergyPlus solution scheme.

### Green Roof Nomenclature

C<sub>1</sub>, C<sub>2</sub>, C<sub>3</sub>    =          coefficients in linearized temperature equations

*C<sub>e</sub><sup>g</sup>              =         * latent heat flux bulk transfer coefficient at ground layer

*C<sub>f</sub>              * =          bulk heat transfer coefficient

C<sub>h</sub><sup>g</sup>              =          sensible heat flux bulk transfer coefficient at ground layer

C<sub>hn</sub><sup>f</sup>             =          near-neutral transfer coefficient at foliage layer

C<sub>hn</sub><sup>g</sup> =          near-neutral transfer coefficient at ground layer

C<sub>p,a</sub>             =          specific heat of air at constant pressure (1005.6 J/kg k)

e<sup>\*</sup>                =          saturation vapor pressure (Pa)

f<sub>1</sub>                =          multiplying factor for radiation effect on stomatal resistance

f<sub>2</sub>                =          multiplying factor for moisture effect on stomatal resistance

f<sub>3</sub>                =          additional multiplying factor for stomatal resistance

F<sub>f</sub>                =          net heat flux to foliage layer (W/m<sup>2</sup>)

F<sub>g</sub>               =          net heat flux to ground surface (W/m<sup>2</sup>)

g<sub>d</sub>               =          plant specific characteristic related to stomatal resistance

H *<sub>f</sub>*               =          foliage sensible heat flux (W/m<sup>2</sup>)

H<sub>g</sub>               =          ground sensible heat flux (W/m<sup>2</sup>)

<span>$I_s^ \downarrow $</span>             =          total incoming short wave radiation (W/m<sup>2</sup>)

<span>$I_{i\gamma }^ \downarrow $</span>             =          total incoming longwave radiation (W/m<sup>2</sup>)

K<sub>v</sub>               =          von Karmen constant (0.4)

l<sub>f</sub>                 =          latent heat of vaporization at foliage temperature (J/kg)

l<sub>g</sub>                =          latent heat of vaporization at ground temperature (J/kg)

L*<sub>f</sub>*                =          foliage latent heat flux (W/m<sup>2</sup>)

L<sub>g</sub>               =          ground latent heat flux (W/m<sup>2</sup>)

*LAI*             =          leaf area index (m<sup>2</sup>/m<sup>2</sup>)

M<sub>g</sub>              =          moisture saturation factor

q<sub>a</sub>               =          mixing ratio for air

q<sub>af</sub>               =          mixing ratio for air within foliage canopy

q<sub>f,sat</sub>             =          saturation mixing ratio at foliage temperature

q<sub>g,sat</sub>            =          saturation mixing ratio at ground temperature

r<sub>a</sub>                =          aerodynamic resistance to transpiration (s/m)

r<sub>s</sub>                =          foliage leaf stomatal resistance (s/m)

r<sub>s,min</sub>            =          minimal leaf stomatal resistance (s/m)

r”                =          surface wetness factor

R<sub>ib</sub>              =          bulk Richardson number

R<sub>v</sub>               =          gas constant for water vapor (461.53 J/kgK)

*T<sub>a     \\                        </sub>* =          the air temperature at the instrument height (Kelvin)

T<sub>af     </sub>             =          air temperature with in the canopy (Kelvin)

T*<sub>f</sub>*               =          leaf temperature (Kelvin)

T<sub>g</sub>                =          ground surface temperature (Kelvin)

W               =          wind speed above canopy (m/s)

W<sub>af</sub>              =          wind speed with in the canopy (m/s)

z                 =          height or depth (m)

Z<sub>a</sub>               =          instrument height (m)

Z<sub>d</sub>               =          displacement height (m)

Z<sub>o</sub><sup>f</sup>               =          foliage roughness length scale (m)

#### Greek letters

a<sub>f</sub>                =          albedo (short wave reflectivity) of the canopy

a<sub>g</sub>               =          albedo (short wave reflectivity) of ground surface

<sub><span>${\varepsilon_1}$</span></sub>              =          <sub><span>${\varepsilon_g} + {\varepsilon_f} - {\varepsilon_f}{\varepsilon_g}$</span></sub>

<sub><span>${\varepsilon_f}$</span>  </sub>             =          emissivity of canopy

<sub><span>${\varepsilon_g}$</span>  </sub>             =          emissivity of the ground surface

G<sub>h</sub>                    =             stability factor

r<sub>a</sub>               =          density of air at instrument height (kg/m<sup>3</sup>)

r<sub>f</sub>                =          density of air at foliage temperature (kg/m<sup>3</sup>)

r<sub>af</sub>               =          density of air at foliage temperature (kg/m<sup>3</sup>)

r<sub>ag</sub>              =          density of air at ground surface temperature (kg/m<sup>3</sup>)

<span>$\sigma $</span>              =          the Stefan-Boltzmann constant (5.699\*10<sup>-8</sup> W/m<sup>2</sup> ºK<sup>4</sup>)

<span>${\sigma_f}$</span>                        =          fractional vegetation coverage

#### Subscripts and superscripts

a                =          air

af               =          air within the foliage layer

e                =          latent heat flux term

f                 =          foliage surface

g                =          ground surface

h                =          sensible heat flux term

n                =          current time step

n+1             =          future time step

ir                =          infrared (or long-wave)

sat              =          saturation value

S                =          short-wave

### References

ASHRAE. 2005. 2005 ASHRAE Handbook – Fundamentals. Chapter 16, Air flow Around Buildings, Atlanta: American Society of Heating Refrigerating and Air-Conditioning Engineers, Inc.

Balick, L. R., R. K. Scoggins, and L. E. Link. 1981. Inclusion of a simple vegetation layer in terrain temperature models for thermal IR signature prediction. IEEE Geoscience and Remote Sensing GE-19(3), pp.143-152.

Businger, J. A. 1966. In ‘Arctic Heat Budget and Atmospheric Circulation’, Symposium Proceedings, pp. 305-332. The Rand Corporation.

Deardorff, J.W. 1978. “Efficient Prediction of ground surface temperature and moisture with inclusion of a layer of vegetation”, Journal Geophysical Research, pp. 1889-1902.

Dickinson, R.E., A. Henderson-Sellers, P.J. Kennedy, and M.F. Wilson. 1986. Biosphere-Atmosphere Transfer Scheme (BATS) for the NCAR community climate model. NCAR Technical Note, TN-275+STR.

ECMWF. 2002. European Centre for Medium-Range Weather Forecasts, Integrated Forecast System. Documentation, CY25R1 (Operational implementation 9 April 2002). .

Frankenstein, S., and G. Koenig. 2004.FASST Vegetation Models. U. S. Army Engineer Research and Development Center, Cold regions Research and Engineering Laboratory, ERDC/CRREL Technical Report TR-04-25.

Frankenstein, S., and G. Koenig. 2004.Fast All-season Soil Strength (FASST). U.S. Army Engineer Research and Development Center, Cold regions Research and Engineering Laboratory, ERDC/CRREL Special Report SR-04-1.

Garratt, J.R. 1992. The Atmospheric Boundary Layer, Cambridge university press.

Gates, D.M. 1980. Biophysical Ecology. New York: Springer-Verlag

Guymon, G.L., R.L. Berg, and T.V. Hromadka. 1993. Mathematical Model of Frost Heave and Thaw Settlement in Pavements. U.S. Army Cold Regions Research and Engineering Laboratory, CRREL Report 93-2.

Henderson-Sellers, B. 1984. “A New Formula for Latent Heat of Vaporization of water as function of temperature”, Quarterly Journal Royal Meteorological Society, 10 pp. 1186-1190.

Hughes, P.A., T.J.L. McComb, A.B. Rimmer, and K.E. Turver. 1993. “A mathematical model for the prediction of temperature of man-made and natural surfaces”, International Journal of Remote Sensing 14 (7), pp. 1383-1412.

Koenig, G.G. 1994. Smart Weapons Operability Enhancement (SWOE) Joint Test and Evaluation (JT and E) Program: Final Report. Dr. James P. Welch, Joint Test Director, SWOE JT and E, SWOE Report 94-10, Annex D.

Lumley, J. L. and Panofsky, H. A. 1964. ‘The structure of Atmospheric Turbulence’. Interscience Monographs and Texts in Physics and Astronomy, Vol. XII. Wiley, New York.

Oke, T.R. 1987. Boundary Layer Climates, University Press, Cambridge

Sellers, P.J., Y. Mintz, Y.C. Sud, and A. Dalcher. 1986. A simple biosphere model (SiB) for use within general circulation models. Journal of Atmospheric Science, 43 (6), pp. 505-532.

Climate, Sky and Solar/Shading Calculations
===========================================

Climate Calculations
--------------------

The location of the facility under analysis is critical for the determination of energy consumption, heating/cooling loads, daylighting potential, and a host of other calculations. In EnergyPlus, both external (i.e, weather files supplied from others) and internal (i.e., solar position, design day temperature/humidity/solar profiles) data is used during simulations.

The “Site:Location” input object includes parameters (Latitude, Longitude, Elevation, Timezone) that allow EnergyPlus to calculate the solar position (using Latitude, Longitude and Timezone) for any day of the year as well as supply the standard barometric pressure (using elevation). Solar position modeling is discussed in more detail in both the Sky Radiance and Shading Calculation sections that directly follow this section.

Weather files have hourly or sub-hourly data for each of the critical elements needed during the calculations (i.e., Dry-Bulb Temperature, Dew-Point Temperature, Relative Humidity, Barometric Pressure, Direct Normal Radiation, Diffuse Horizontal Radiation, Total & Opaque Sky Cover, Wind Direction, Wind Speed) as well as some auxiliary data such as Rain or Snow that assist in certain calculational aspects. Weather file excerpts such as might be used in sizing calculations also have this breadth of data. The input object “SizingPeriod:DesignDay” describes design days (meant to mimic ASHRAE design conditions but in a whole day profile) using certain characteristics for the day and then EnergyPlus supplies the remaining portions to complete outdoor conditions needed for program execution. SizingPeriod:DesignDay are perhaps the best objects for sizing equipment as the ASHRAE specified design conditions can be input AND weather files may or may not have the conditions necessary to size equipment properly.

Two other objects, however, can be used at times: SizingPeriod:WeatherFileDays and SizingPeriod:WeatherFileConditionType.  With the first of these, one specifies a set of weather file days similar to a RunPeriod (but will be used for the Sizing calculations). In the second, the extreme or typical conditions that are calculated for the weather file during processing can be used by name.  Of course, either of these can be used as a measure of usage over small periods.

The ASHRAE Handbook of Fundamentals describes their criteria in creating design condition synopses. “Design data based on dry-bulb temperature represent peak occurrences of the sensible component of ambient outdoor conditions. Design values based on wet-bulb temperature are related to the enthalpy of the outdoor air. Conditions based on dewpoint relate to the peaks of the humidity ratio. The designer, engineer, or other user must decide which set(s) of conditions and probability of occurrence apply to the design situation under consideration.”

### EnergyPlus Design Day Temperature Calculations

In EnergyPlus, the typical design day input includes a “high” and a “low” dry-bulb temperature for the day. As these two temperatures are insufficient to represent a full 24 hour period, the program uses a “range multiplier” profile to represent the full day’s temperatures:

![](EngineeringReference/media/image563.svg.png)

Figure 36. Default Daily Temperature Range Profile

The multipliers are taken from the ASHRAE 2009 HOF, Table # 6, p. 14.11.. More explicitly, EnergyPlus creates an air temperature for each timestep by using the entered maximum dry-bulb temperature in conjunction with the entered daily range and the above multiplier values. The actual equation used is shown below:

<div>$${T_{current}} = {T_{Max}} - {T_{range}}\cdot {T_{Multiplier}}$$</div>

where

T<sub>current</sub>= Air temperature of current Hour of Day

T<sub>Max</sub>= User supplied Max Dry-bulb Temperature

T<sub>range</sub>= User supplied Daily Temperature Range

T<sub>Multiplier</sub>= Range multiplier as shown on the above graph

The range multiplier values represent typical conditions of diurnal temperatures (i.e. the low temperature for the day occurring about 5:00 AM and the maximum temperature for the day occurring about 3:00 PM.  Note that EnergyPlus does not shift the profile based on the time of solar noon as is optionally allowed by ASHRAE procedures.

ASHRAE research indicates that dry-bulb and wet-bulb temperatures typically follow the same profile, so EnergyPlus can use the default daily temperature profile to generate humidity conditions based on maximum and range of wet-bulb temperature.

Since this default temperature profile may not be applicable to all locations, the user can give a different profile as part of the design day definition.

### Sky Radiation Modeling

EnergyPlus calculates the Horizontal Infrared Radiation Intensity in Wh/m<sup>2,</sup> if it is missing on the weather file or for design days, from the Opaque Sky Cover field as shown in the following explanation.

<div>$$Horizontal\_IR = Sk{y_{emissivity}}\cdot Sigma\cdot Temperature_{drybulb}^4$$</div>

where

Horizontal\_IR = horizontal IR intensity {W/m<sup>2</sup>}

Sky<sub>emissivity</sub> = sky emissivity

Sigma = Stefan-Boltzmann constant = 5.6697e-8 {W/m<sup>2</sup>-K<sup>4</sup>}

Temperature<sub>drybulb</sub> = drybulb temperature {K}

The sky emissivity is given by

<div>$$Sk{y_{emissivity}} = \left( {.787 + .764\cdot \ln \left( {\frac{{Temperatur{e_{dewpoint}}}}{{273.}}} \right)} \right)\cdot \left( {1. + .0224N - .0035{N^2} + .00028{N^3}} \right)$$</div>

where

Temperature<sub>dewpoint</sub> = dewpoint temperature {K}

N = opaque sky cover {tenths}

Example: Clear sky (N=0), Temperature<sub>drybulb</sub> = 273+20=293 K, Temperature<sub>dewpoint</sub> = 273+10=283 K:

Sky<sub>emissivity</sub> = 0.787 + 0.764\*0.036 = 0.815

Horizontal\_IR = 0.815\*5.6697e-8\*(293\*\*4) = 340.6 W/m<sup>2</sup>

References for these calculations are contained in the references section at the end of this list of fields. (Walton, 1983) (Clark and Allen, 1978).

### EnergyPlus Sky Temperature Calculation

The default calculation for sky temperature is:

<div>$$Sk{y_{Temperature}} = {\left( {\frac{{Horizontal\_IR}}{{Sigma}}} \right)^{.25}} - Temperatur{e_{Kelvin}}$$</div>

Where

Sky<sub>Temperature</sub> = Sky radiative temperature {C}

Horiizontal\_IR = Horizontal Infrared Radiation Intensity as described in the previous section {Wh/m<sup>2</sup>}

Temperature<sub>Kelvin</sub> = Temperature conversion from Kelvin to C, i.e. 273.15

The Sky Temperature can also be set by the user from several options using the **WeatherProperty:SkyTemperature** object.

### EnergyPlus Design Day Solar Radiation Calculations

Similarly, calculating solar irradiance (solar modeling) is one of the important effects to be accomplished. Several solar models exist with varying complexity.

#### ASHRAE Clear Sky Solar Model

The default model used is the ASHRAE Clear Sky model. The ASHRAE clear sky model described in ASHRAE HOF 2005 Chapter 31 can be used to estimate hourly clear-day solar radiation for any month of the year in U.S. or similar temperate climates in the northern hemisphere. EnergyPlus calculations extend the clear sky application to both northern and southern hemispheres.  Note that the Clear Sky model has been updated in the ASHRAE HOF 2009 (see ASHRAE Revised Clear Sky Model below).

At the earth’s surface on a clear day, direct normal irradiation is represented by

<div>$$Direct\;Normal\;Irradiation = \frac{A}{{exp\left( {{\raise0.7ex\hbox{$B$} \!\mathord{\left/ {\vphantom {B {\sin \beta }}}\right.}\!\lower0.7ex\hbox{${\sin \beta }$}}} \right)}}$$</div>

where

*A* = apparent solar irradiation at air mass m = 0 (Table 20)

B = atmospheric extinction coefficient Table 20)

Values of A and B vary during the year because of seasonal changes in the dust and water vapor content of the atmosphere and because of the changing earth-sun distance. Equation does not give the maximum value of direct normal irradiation that can occur in each month but yields values that are representative of conditions on cloudless days for a relatively dry and clear atmosphere. For very clear atmospheres, direct normal irradiation can be 15% higher than indicated by Equation , using values of A and B in Table 20 below.

Table 20. Extraterrestrial Solar Irradiance and Related Data
 Note: Data are for 21st day of each month during the base year of 1964.

<table class="table table-striped">
<tr>
<th> </th>
<th>I<sub>o</sub> {W/m<sup>2</sup>}</th>
<th>Equation of Time {minutes}</th>
<th>Declination {degrees}</th>
<th>A {W/m<sup>2</sup>}</th>
<th>B {}</th>
<th>C {}</th>
</tr>
<tr>
<td>Jan</td>
<td>1416</td>
<td>-11.2</td>
<td>-20.0</td>
<td>1202</td>
<td>0.141</td>
<td>0.103</td>
</tr>
<tr>
<td>Feb</td>
<td>1401</td>
<td>-13.9</td>
<td>-10.8</td>
<td>1187</td>
<td>0.142</td>
<td>0.104</td>
</tr>
<tr>
<td>Mar</td>
<td>1381</td>
<td>-7.5</td>
<td>0.0</td>
<td>1164</td>
<td>0.149</td>
<td>0.109</td>
</tr>
<tr>
<td>Apr</td>
<td>1356</td>
<td>1.1</td>
<td>11.6</td>
<td>1130</td>
<td>0.164</td>
<td>0.120</td>
</tr>
<tr>
<td>May</td>
<td>1336</td>
<td>3.3</td>
<td>20.0</td>
<td>1106</td>
<td>0.177</td>
<td>0.130</td>
</tr>
<tr>
<td>Jun</td>
<td>1336</td>
<td>-1.4</td>
<td>23.45</td>
<td>1092</td>
<td>0.185</td>
<td>0.137</td>
</tr>
<tr>
<td>Jul</td>
<td>1336</td>
<td>-6.2</td>
<td>20.6</td>
<td>1093</td>
<td>0.186</td>
<td>0.138</td>
</tr>
<tr>
<td>Aug</td>
<td>1338</td>
<td>-2.4</td>
<td>12.3</td>
<td>1107</td>
<td>0.182</td>
<td>0.134</td>
</tr>
<tr>
<td>Sep</td>
<td>1359</td>
<td>7.5</td>
<td>0.0</td>
<td>1136</td>
<td>0.165</td>
<td>0.121</td>
</tr>
<tr>
<td>Oct</td>
<td>1380</td>
<td>15.4</td>
<td>-10.5</td>
<td>1166</td>
<td>0.152</td>
<td>0.111</td>
</tr>
<tr>
<td>Nov</td>
<td>1405</td>
<td>13.8</td>
<td>-19.8</td>
<td>1190</td>
<td>0.144</td>
<td>0.106</td>
</tr>
<tr>
<td>Dec</td>
<td>1417</td>
<td>1.6</td>
<td>-23.45</td>
<td>1204</td>
<td>0.141</td>
<td>0.103</td>
</tr>

</table>

For locations where clear, dry skies predominate (e.g., at high elevations) or, conversely, where hazy and humid conditions are frequent, values found by using Equation and Table 20 should be multiplied by the clearness numbers in Threlkeld and Jordan (1958), reproduced as Figure # 5 in Chapter 33 of the 2007 ASHRAE Handbook—HVAC Applications.

The Clear Sky model usually over estimates the amount of solar radiation available to the building.

#### ASHRAE Revised Clear Sky Model (“Tau Model”)

The ASHRAE 2009 HOF introduced a revised clear sky model based on location-specific optical depths for direct and diffuse radiation.  These values are tabulated by month for all 5564 locations in the ASHRAE design data that accompanies the 2009 HOF.

The model requires air mass, m, calculated as follows --

<div>$$m = {1 \mathord{\left/ {\vphantom {1 {\left[ {\sin \beta  + 0.50572 \cdot {{\left( {6.07995 + \beta } \right)}^{ - 1.6364}}} \right]}}} \right. } {\left[ {\sin \beta  + 0.50572 \cdot {{\left( {6.07995 + \beta } \right)}^{ - 1.6364}}} \right]}}$$</div>

where <span>$\beta $</span> = solar altitude, degrees.

Direct and diffuse irradiance are determined with the following relationships,

<div>$${E_b} = {E_o} \cdot \exp \left[ { - {\tau_b} \cdot {m^{ab}}} \right]$$</div>

<div>$${E_d} = {E_o} \cdot \exp \left[ { - {\tau_d} \cdot {m^{ad}}} \right]$$</div>

where:

<span>${E_b}$</span> = beam normal irradiance, W/m<sup>2</sup>

<span>${E_d}$</span> = diffuse horizontal irradiance,

<span>${E_o}$</span> = extraterrestrial normal irradiance,

*<span>$m$</span>* = air mass

t<sub>b</sub> and t<sub>d</sub> = beam and diffuse optical depths (from ASHRAE climatic design data)

<span>$ab$</span> and <span>$ad$</span> = beam and diffuse air mass exponents (see below)

Values of t<sub>b</sub> and t<sub>d</sub> are location-specific and vary during the year. They embody the dependence of clear sky solar radiation upon local conditions, such as elevation, precipitable water content, and aerosols.

The air mass exponents <span>$ab$</span> and <span>$ad$</span> were correlated to t<sub>b</sub> and t<sub>d</sub> through the following empirical relationships:

<div>$$ab = 1.219 - 0.043 \cdot {\tau_b} - 0.151 \cdot {\tau_d} - 0.204 \cdot {\tau_b} \cdot {\tau_d}$$</div>

<div>$$ad = 0.202 + 0.852 \cdot {\tau_b} - 0.007 \cdot {\tau_d} - 0.357 \cdot {\tau_b} \cdot {\tau_d}$$</div>

Studies done as part of ASHRAE research projects show that the revised tau model produces more physically plausible irradiance values than does the traditional clear sky model.  In particular, diffuse irradiance values are more realistic.

#### Zhang-Huang Solar Model

The Zhang-Huang solar model was developed for initial use in modeling typical meteorological years for China weather sites. This model seems to be good for other locations as well. Using total cloud cover, dry-bulb temperature, relative humidity, and wind speed as the independent variables, the total (global horizontal) solar radiation is estimated by:

<div>$$I = \frac{{\left[ {{I_0}\cdot \sin (h)\cdot \left( {{c_0} + {c_1}\cdot CC + {c_2}\cdot C{C^2} + {c_3}\left( {{T_n} - {T_{n - 3}}} \right) + {c_4}\cdot \varphi  + {c_5}\cdot {V_w}} \right) + d} \right]}}{k}$$</div>

Where

I = estimated hourly solar radiation, W/m<sup>2</sup>

I<sub>0</sub>= global solar constant, 1355 W/m<sup>2</sup>

h=solar altitude angle, i.e, the angle between the horizontal and the line to the sun

CC = cloud cover

<span>$\varphi $</span> = relative humidity, %

<span>${T_n},{T_{n - 3}}$</span> = dry-bulb temperature at hours n (current) and n-3, respectively

<span>${V_w}$</span> = Wind speed, m/s

<span>${c_0},{c_1},{c_2},{c_3},{c_4},{c_5},d,k$</span> = regression coefficients

The constants were determined by analysis from measured data and are as follows:

c<sub>0</sub> = .5598, c<sub>1</sub> = .4982, c<sub>2</sub> = -.6762, c<sub>3</sub> = .02842, c<sub>4</sub> = -.00317, c<sub>5</sub> = .014,
 d = -17.853, k = .843.

This is the same model used to estimate the global solar radiation value (when it is absent from the source data) in the Weather Converter. References given in the reference section (Watanabe, Urano, Hayashi, 1983) (Zhang, Huang, 2002).

### Perez Direct/Diffuse Splitting Model

Splitting from global calculated (EnergyPlus) or entered values (WeatherConverter) into direct normal and diffuse horizontal components are done using the Perez direct/diffuse split. References shown in the reference section (Perez et al, 1992) (Perez et al, 1990)

### Weather File Solar Interpolation

The solar values on the weather file are average values over the hour. For interpolation of hourly weather data (i.e., when the specified timestep is greater than 1), the average value is assumed to be the value at the midpoint of the hour.  The reported values in the output are totals for each reporting period. So, hourly reported values will not match the original values in the weather file, but the total solar for a day should agree. Reference (Ellis, Liesen, Pedersen, 2003)

### References

Walton, G. N. 1983. Thermal Analysis Research Program Reference Manual. NBSSIR 83-2655. National Bureau of Standards, p. 21.

Clark, G. and C. Allen, "The Estimation of Atmospheric Radiation for Clear and Cloudy Skies," Proceedings 2nd National Passive Solar Conference (AS/ISES), 1978, pp. 675-678.

Watanabe, T., Urano, Y., and Hayashi, T. 1983. "Procedures for Separating Direct and Diffuse Insolation on a Horizontal Surface and Prediction of Insolation on Tilted Surfaces" (in Japanese), Transactions, No. 330, Architectural Institute of Japan, Tokyo, Japan.

Zhang, Q.Y. and Huang, Y.J. 2002. Development of typical year weather files for Chinese locations, LBNL-51436, ASHRAE Transactions, Vol. 108, Part 2.

Perez R., Ineichen P., Maxwell E., Seals, R. and Zelenka, A. 1992. Dynamic Global-to-Direct Irradiance Conversion Models. ASHRAE Transactions-Research Series,354-369.

Perez, R., Ineichen, P., Seals, R., Michalsky, J. and Stewart, R. 1990. Modeling daylight availability and irradiance components from direct and global irradiance. Solar Energy 44, 271-289.

Ellis, P.G., Liesen, R.J. and Pedersen, C.O. 2003. “Energyplus Experimental Data Validation Work: Development and Validation of the Unvented Trombe Wall Model and Other Heat Balance Components”, CERL Final Report DACA42-01-D-0004, Task 3.

Design Week Specification
-------------------------

A design week (or longer) may be specified in EnergyPlus by selecting a RunPeriod of one week.  One-week custom weather files may be constructed if extreme design week conditions are desired or one can use the specific dates from the EPW weather files that designate the extreme conditions on the weather file.  The design week simulation requires that the simulation reach a ‘steady-periodic’ state for the one week time period.  This is achieved manually by increasing the ‘number of years of simulation’ until the weekly profile does not change from one year to the next.  The ‘steady-periodic’ output for the last week of the simulation represents the design week simulation results.

Using the SizingPeriod:WeatherFileDays object, one could size equipment from a longer period.

Sky Radiance Model
------------------

In EnergyPlus the calculation of diffuse solar radiation from the sky incident on an exterior surface takes into account the anisotropic radiance distribution of the sky. For this distribution, the diffuse sky irradiance on a surface is given by

<div>$$AnisoSkyMultiplie{r_{surface}}\cdot DiffuseSolarIrradiance$$</div>

Where

Diffuse Solar Irradiance is the diffuse solar irradiance from the sky on the ground.

surface is the surface being analyzed.

AnisoSkyMultiplier is determined by surface orientation and sky radiance distribution, and accounts for the effects of shading of sky diffuse radiation by shadowing surfaces such as overhangs. It does not account for *reflection* of sky diffuse radiation from shadowing surfaces.

The sky radiance distribution is based on an empirical model based on radiance measurements of real skies, as described in Perez et al., 1990. In this model the radiance of the sky is determined by three distributions that are superimposed (see Figure 37)

(1) An isotropic distribution that covers the entire sky dome;

(2) A circumsolar brightening centered at the position of the sun;

(3) A horizon brightening.

![](EngineeringReference/media/image589.png)

Figure 37. Schematic view of sky showing solar radiance distribution as a superposition of three components: dome with isotropic radiance, circumsolar brightening represented as a point source at the sun, and horizon brightening represented as a line source at the horizon.

The proportions of these distributions depend on the sky condition, which is characterized by two quantities, *clearness factor* and *brightness factor*, defined below, which are determined from sun position and solar quantities from the weather file.

The *circumsolar brightening* is assumed to be concentrated at a point source at the center of the sun although this region actually begins at the periphery of the solar disk and falls off in intensity with increasing angular distance from the periphery.

The *horizon brightening* is assumed to be a linear source at the horizon and to be independent of azimuth. In actuality, for clear skies, the horizon brightening is highest at the horizon and decreases in intensity away from the horizon. For overcast skies the horizon brightening has a negative value since for such skies the sky radiance increases rather than decreases away from the horizon.

Table 21.  Variables in Anisotropic Sky Model and Shadowing of Sky Diffuse Radiation

<table class="table table-striped">
 <tr>
  <th>Mathematical variable</th>
  <th>Description</th>
  <th>Units</th>
  <th>FORTRAN variable</th>
 </tr>
 <tr>
  <td>I<sub>sky</sub></td>
  <td>Solar irradiance on surface from sky</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>I<sub>horizon</sub></td>
  <td>Solar irradiance on surface from sky horizon</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>I<sub>dome</sub></td>
  <td>Solar irradiance on surface from sky dome</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>I<sub>circumsolar</sub></td>
  <td>Solar irradiance on surface from circumsolar region</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>I<sub>h</sub></td>
  <td>Horizontal solar irradiance</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>S</td>
  <td>Surface tilt</td>
  <td>radians</td>
  <td>Surface(SurfNum)%Tilt\*DegToRadians</td>
 </tr>
 <tr>
  <td>a, b</td>
  <td>intermediate variables</td>
  <td>-</td>
  <td>-</td>
 </tr>
 <tr>
  <td>F<sub>1</sub>, F<sub>2</sub></td>
  <td>Circumsolar and horizon brightening coefficients</td>
  <td>-</td>
  <td>F1, F2</td>
 </tr>
 <tr>
  <td>α</td>
  <td>Incidence angle of sun on surface</td>
  <td>radians</td>
  <td>IncAng</td>
 </tr>
 <tr>
  <td>Z</td>
  <td>Solar zenith angle</td>
  <td>radians</td>
  <td>ZenithAng</td>
 </tr>
 <tr>
  <td><div>$\Delta$</div></td>
  <td>Sky brightness factor</td>
  <td>-</td>
  <td>Delta</td>
 </tr>
 <tr>
  <td>ε</td>
  <td>Sky clearness factor</td>
  <td>-</td>
  <td>Epsilon</td>
 </tr>
 <tr>
  <td>m</td>
  <td>relative optical air mass</td>
  <td>-</td>
  <td>AirMass</td>
 </tr>
 <tr>
  <td>I<sub>O</sub></td>
  <td>Extraterrestrial solar irradiance</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>I</td>
  <td>Direct normal solar irradiance</td>
  <td>W/m<sup>2</sup></td>
  <td>Material%Thickness</td>
 </tr>
 <tr>
  <td>κ</td>
  <td>constant = 1.041 for Z in radians</td>
  <td>radians<sup>-3</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>F<sub>ij</sub></td>
  <td>Brightening coefficient factors</td>
  <td>-</td>
  <td>F11R, F12R, etc.</td>
 </tr>
 <tr>
  <td>R<sub>circumsolar</sub></td>
  <td>Shadowing factor for circumsolar radiation</td>
  <td>-</td>
  <td>SunLitFrac</td>
 </tr>
 <tr>
  <td>R<sub>dome</sub></td>
  <td>Shadowing factor for sky dome radiation</td>
  <td>-</td>
  <td>DifShdgRatioIsoSky</td>
 </tr>
 <tr>
  <td>R<sub>horizon</sub></td>
  <td>Shadowing factor for horizon radiation</td>
  <td>-</td>
  <td>DifShdgRatioHoriz</td>
 </tr>
 <tr>
  <td>E</td>
  <td>Sky radiance</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>*θ*</td>
  <td>Azimuth angle of point in sky</td>
  <td>radians</td>
  <td>Theta</td>
 </tr>
 <tr>
  <td>φ</td>
  <td>Altitude angle of point in sky</td>
  <td>radians</td>
  <td>Phi</td>
 </tr>
 <tr>
  <td>I<sub>i</sub></td>
  <td>Irradiance on surface from a horizon element</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>I<sub>ij</sub></td>
  <td>Irradiance on surface from a sky dome element</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
 <tr>
  <td>SF</td>
  <td>Sunlit fraction</td>
  <td>-</td>
  <td>FracIlluminated</td>
 </tr>
 <tr>
  <td>I’</td>
  <td>Sky solar irradiance on surface with shadowing</td>
  <td>W/m<sup>2</sup></td>
  <td>-</td>
 </tr>
</table>

### Sky Diffuse Solar Radiation on a Tilted Surface

The following calculations are done in subroutine AnisoSkyViewFactors in the SolarShading module.

In the absence of shadowing, the sky formulation described above gives the following expression for sky diffuse irradiance, *I<sub>sky</sub>*, on a tilted surface:

<div>$${I_{sky}} = {I_{horizon}} + {I_{dome}} + {I_{circumsolar}}$$</div>

where

<div>$$
  \begin{array}{rcl}
    I_{horizon} &= \rm{irradiance on surface from sky horizon} &= I_h F_2\sin S \\
    I_{dome}    &= \rm{irradiance on surface from sky dome}    &= I_h (1 - F_1)(1 + \cos S)/2 \\
    I_{circumsolar} &= \rm{irradiance on surface from circumsolar region} &= I_h F_1 a/b
  \end{array}
$$</div>

AnisoSkyMult is then *I<sub>sky</sub>* /DifSolarRad.

In the above equations:

I<sub>h</sub> = horizontal solar irradiance (W/m<sup>2</sup>)

*S* = surface tilt (radians)

*a* = max(0,cos*α*)

*b* = max(0.087, cos*Z*)

*F<sub>1</sub>* = circumsolar brightening coefficient

*F<sub>2</sub>* = horizon brightening coefficient

where

*α* = incidence angle of sun on the surface (radians)

*Z* = solar zenith angle (radians).

The brightening coefficients are a function of sky conditions; they are given by

<div>$$
  \begin{array}{rl}
    F_1 &= F_{11}(\varepsilon ) + F_{12}(\varepsilon )\Delta  + F_{13}(\varepsilon )Z  \\
    F_2 &= F_{21}(\varepsilon ) + F_{22}(\varepsilon )\Delta  + F_{23}(\varepsilon )Z
  \end{array}
$$</div>

Here the sky brightness factor is

<div>$$\Delta  = {I_h}m/{I_o}$$</div>

where

*m* = relative optical air mass

*I<sub>o</sub>* = extraterrestrial irradiance (taken to have an average annual value of 1353 W/m<sup>2</sup>);

and the sky *clearness factor* is

<div>$$\varepsilon  = \frac{{({I_h} + I)/{I_h} + \kappa {Z^3}}}{{1 + \kappa {Z^3}}}$$</div>

where

I = direct normal solar irradiance

κ = 1.041 for Z in radians

The factors *F<sub>ij</sub>*  are shown in the following table. The F<sub>ij</sub> values in this table were provided by R. Perez, private communication, 5/21/99. These values have higher precision than those listed in Table # 6 of Perez et al., 1990.

Table 22.  F<sub>ij</sub> Factors as a Function of Sky Clearness Range.

<table class="table table-striped">
<tr>
<th>ε  Range</th>
<th>1.000-1.065</th>
<th>1.065-1.230</th>
<th>1.230-1.500</th>
<th>1.500-1.950</th>
<th>1.950-2.800</th>
<th>2.800-4.500</th>
<th>4.500-6.200</th>
<th>&gt; 6.200</th>
</tr>
<tr>
<td>F<sub>11</sub></td>
<td>-0.0083117</td>
<td>0.1299457</td>
<td>0.3296958</td>
<td>0.5682053</td>
<td>0.8730280</td>
<td>1.1326077</td>
<td>1.0601591</td>
<td>0.6777470</td>
</tr>
<tr>
<td>F<sub>12</sub></td>
<td>0.5877285</td>
<td>0.6825954</td>
<td>0.4868735</td>
<td>0.1874525</td>
<td>-0.3920403</td>
<td>-1.2367284</td>
<td>-1.5999137</td>
<td>-0.3272588</td>
</tr>
<tr>
<td>F<sub>13</sub></td>
<td>-0.0620636</td>
<td>-0.1513752</td>
<td>-0.2210958</td>
<td>-0.2951290</td>
<td>-0.3616149</td>
<td>-0.4118494</td>
<td>-0.3589221</td>
<td>-0.2504286</td>
</tr>
<tr>
<td>F<sub>21</sub></td>
<td>-0.0596012</td>
<td>-0.0189325</td>
<td>0.0554140</td>
<td>0.1088631</td>
<td>0.2255647</td>
<td>0.2877813</td>
<td>0.2642124</td>
<td>0.1561313</td>
</tr>
<tr>
<td>F<sub>22</sub></td>
<td>0.0721249</td>
<td>0.0659650</td>
<td>-0.0639588</td>
<td>-0.1519229</td>
<td>-0.4620442</td>
<td>-0.8230357</td>
<td>-1.1272340</td>
<td>-1.3765031</td>
</tr>
<tr>
<td>F<sub>23</sub></td>
<td>-0.0220216</td>
<td>-0.0288748</td>
<td>-0.0260542</td>
<td>-0.0139754</td>
<td>0.0012448</td>
<td>0.0558651</td>
<td>0.1310694</td>
<td>0.2506212</td>
</tr>

</table>

### Shadowing of Sky Diffuse Solar Radiation

Sky diffuse solar shadowing on an exterior surface is calculated as follows in subroutine SkyDifSolarShading in the SolarShading module. The sky is assumed to be a superposition of the three Perez sky comp1onents described above.

For the horizon source the following ratio is calculated by dividing the horizon line into 24 intervals of equal length:

<div>$${R_{horiz}} = \frac{{{\rm{Irradiance from horizon with obstructions}}}}{{{\rm{Irradiance from horizon without obstructions}}}} = \frac{{\sum\limits_{i = 1}^{24} {{I_i}S{F_i}} }}{{\sum\limits_{i = 1}^{24} {{I_i}} }}$$</div>

where* I<sub>i</sub>*is the unobstructed irradiance on the surface from the* i*<sup>th</sup> interval, *SF<sub>i</sub>* is the sunlit fraction from radiation coming from the *i*<sup>th</sup> interval, and the sums are over intervals whose center lies in front of the surface. *SF<sub>i</sub>* is calculated using the beam solar shadowing method as though the sun were located at the *i*<sup>th</sup> horizon point. Here

<div>$${I_i} = E({\theta_i})d\theta \cos {\alpha_i}$$</div>

where

*E* (*θ<sub>i</sub>*) = radiance of horizon band (independent of θ)

*dθ* = 2π/24 = azimuthal extent of horizon interval (radians)

*θ<sub>i</sub>* = 0<sup>O</sup>, 15<sup>O</sup>, … , 345<sup>O</sup>

α<sub>i</sub> = incidence angle on surface of radiation from *θ<sub>i</sub>*

The corresponding ratio for the isotropic sky dome is given by

<div>$${R_{dome}} = \frac{{{\rm{Irradiance from dome with obstructions}}}}{{{\rm{Irradiance from dome without obstructions}}}} = \frac{{\sum\limits_{i = 1}^{24} {\sum\limits_{j = 1}^6 {{I_{ij}}S{F_{ij}}} } }}{{\sum\limits_{i = 1}^{24} {\sum\limits_{j = 1}^6 {{I_{ij}}} } }}$$</div>

where (*i,j*) is a grid of 144 points (6 in altitude by 24 in azimuth) covering the sky dome, *I<sub>ij</sub>* is the unobstructed irradiance on the surface from the sky element at the *ij*<sup>th</sup> point, *SF<sub>ij</sub>* is the sunlit fraction for radiation coming from the *ij*<sup>th</sup> element, and the sum is over points lying in front of the surface. Here

<div>$${I_{ij}} = E({\theta_i},{\phi_j})\cos {\phi_j}d\theta d\phi \cos {\alpha_{ij}}$$</div>

where

*E* (*θ<sub>i</sub>*,*φ<sub>j</sub>*) = sky radiance (independent of θ and φ for isotropic dome)

*dθ* = 2π/24 = azimuthal extent of sky element (radians)

*dφ* = (π/2)/6 = altitude extent of sky element (radians)

*θ<sub>i</sub>* = 0<sup>O</sup>, 15<sup>O</sup>, … , 345<sup>O</sup>

*φ<sub>j</sub>*= 7.5<sup>O</sup>, 22.5<sup>O</sup>, … , 82.5<sup>O</sup>

α<sub>ij</sub> = incidence angle on surface of radiation from (*θ<sub>i</sub>*,*φ<sub>j</sub>*)

Because the circumsolar region is assumed to be concentrated at the solar disk, the circumsolar ratio is

<div>$${R_{circumsolar}} = \frac{{{\rm{Irradiance from circumsolar region with obstructions}}}}{{{\rm{Irradiance from circumsolar without obstructions}}}} = S{F_{sun}}$$</div>

where *SF<sub>sun</sub>* is the beam sunlit fraction. The total sky diffuse irradiance on the surface with shadowing is then

<div>$${I'_{sky}} = {R_{horizon}}{I_{horizon}} + {R_{dome}}{I_{dome}} + {R_{circumsolar}}{I_{circumsolar}}$$</div>

*R<sub>horizon</sub>* and *R<sub>dome</sub>* are calculated once for each surface since they are independent of sun position.

With shadowing we then have:

AnisoSkyMult = *I’<sub>sky</sub>* /DifSolarRad.

### Shadowing of Sky Long-Wave Radiation

EnergyPlus calculates the sky long-wave radiation incident on exterior surfaces assuming that the sky long-wave radiance distribution is isotropic. If obstructions such as overhangs are present the sky long-wave incident on a surface is multiplied by the isotropic shading factor, *R<sub>dome</sub>*, described above. The long-wave radiation from these obstructions is added to the long-wave radiation from the ground; in this calculation both obstructions and ground are assumed to be at the outside air temperature and to have an emissivity of 0.9.

Shading Module
--------------

### Shading and Sunlit Area Calculations

When assessing heat gains in buildings due to solar radiation, it is necessary to know how much of each part of the building is shaded and how much is in direct sunlight. As an example, the figure below shows a flat roofed, L-shaped structure with a window in each of the visible sides. The sun is to the right so that walls 1 and 3 and windows a and c are completely shaded, and wall 4 and window d are completely sunlit. Wall 2 and window b are partially shaded. The sunlit area of each surface changes as the position of the sun changes during the day. The purpose of the EnergyPlus shadow algorithm is to compute these **sunlit areas**.  Predecessors to the EnergyPlus shadowing concepts include the BLAST and TARP shadowing algorithms.

The shadow algorithm is based on coordinate transformation methods similar to Groth and Lokmanhekim and the shadow overlap method of Walton.

Using the **ShadowCalculation** object, you can set how often the shadowing calculations are performed. Having them calculated each day is obviously the most accurate but may also be the most time consuming.  Using a greater length of time (number of days) before calculating again can yield speedier results.  For lengths of time greater than one day, the solar position values (e.g. equation of time, sun position angles) are averaged over that time period for the shadowing calculations.

![](EngineeringReference/media/image601.png)

Figure 38.  Overall Shadowing Scheme Depiction

### Solar Position

Current solar position is described in terms of three direction cosines that are convenient for determining the angle of incidence of the sun’s rays on a building surface.  The following procedure is used to determine the direction cosines.  The values of the solar declination angle, d, and the equation of time, e, are based on *Astronomical Algorithms*, Meeus.  Solar declination is a function of local/site latitude.

The fractional year is calculated, in radians:

<div>$$\gamma  = \frac{{2\pi }}{{366}}(day\_of\_year)$$</div>

From this fractional year, the equation of time and solar declination angle are calculated.  For each time step (time value = fractional hour), the hour angle is calculated from:

<div>$$HourAngle = \left( {15\cdot \left( {12 - \left( {TimeValue + EquationOfTime} \right)} \right) + \left( {TimeZoneMeridian - Longitude} \right)} \right)$$</div>

TimeZoneMeridian is the standard meridian for the location’s time zone {GMT +/-}.

Solar HourAngle (*H*) gives the apparent solar time for the current time period (degrees); HourAngle is positive before noon, negative after noon.  It is common astronomical practice to express the hour angle in hours, minutes and seconds of time rather than in degrees.  You can convert the hour angle displayed from EnergyPlus to time by dividing by 15.  (Note that 1 hour is equivalent to 15 degrees; 360° of the Earth’s rotation takes place every 24 hours.)  The relationship of angles in degrees to time is shown in the following table:

Table 23.  Relationship of Angles (degrees) to Time

<table class="table table-striped">
<tr>
<th>Unit of Angle</th>
<th>Equivalent time</th>
</tr>
<tr>
<td>1 radian</td>
<td>3.819719 hours</td>
</tr>
<tr>
<td>1 degree</td>
<td>4 minutes</td>
</tr>
<tr>
<td>1 arcmin</td>
<td>4 seconds</td>
</tr>
<tr>
<td>1 arcsec</td>
<td>0.066667 seconds</td>
</tr>

</table>

The Solar Altitude Angle (b) is the angle of the sun above the horizontal (degrees).  The Solar Azimuth Angle (f) is measured from the North (clockwise) and is expressed in degrees.  This is shown more clearly in the following figure.

![](EngineeringReference/media/image604.png)

Figure 39.  Solar Position Illustration

### Surface Geometry

Shadow calculations first require that the building surfaces be described geometrically. Surfaces are described by the coordinates of their vertices in a three dimensional Cartesian coordinate system. This Right-hand coordinate system has the X-axis pointing east, the Y-axis pointing north, and the Z-axis pointing up (see figure below). The azimuth angle (y) of a surface is the angle from the north axis to the projection onto the X-Y plane of a normal to the surface (clockwise positive). The surface tilt angle (f) is the angle between the Z-axis and the normal to the surface. The vertices are recorded in counter-clockwise sequence (as the surface is viewed from outside its zone).

During surface entry, surfaces are checked for convex or non-convex shape. If non-convex and inappropriate (used as a receiving surface) then a severe error is produced telling the user that shadowing calculations may be inaccurate.

Similarly collinear points (or as noted below, points within 1 mm distance) are removed unless removing would make an illegal surface (less than 3 points). But degenerate collinear surfaces *should* be removed – they make the shadowing routines do extra work which takes extra time.

Collinear – points that essentially form a “line” rather than a surface shape.

Resolution of 1mm or less – near collinear points.

Note that the resolution on surfaces/shadowing is 1 mm – using resolution beyond that will result in truncation of the shadowing.

![](EngineeringReference/media/image605.png)

Figure 40.  EnergyPlus Coordinate System

The GlobalGeometryRules object specifies to EnergyPlus how the surface vertices will be presented in the input file.  Of pertinent interest here is that the user may specify the vertices in either “relative” or “world” coordinates.  Regardless of input specifications, when vertices are reported, they are reported in world coordinates, starting at the upper-left-corner (4-sided surface) and are listed counter-clockwise.

#### Relative Coordinate Transformation

When vertices are specified in “relative” coordinates, there can be a “building” north axis as well as a “zone” north axis.  The building north axis/coordinate system is a rotation of y<sub>b</sub> degrees from the global/world coordinate system.  The global coordinates of zone origins are related to the building relative coordinates by:

<div>$${X_{zo}} = {X_{br}}\cdot \cos {\psi_b} - {Y_{br}}\cdot \sin {\psi_b}$$</div>

<div>$${Y_{zo}} = {Y_{br}}\cdot \sin {\psi_b} - {Y_{br}}\cdot \cos {\psi_b}$$</div>

<div>$${Z_{zo}} = {Z_{br}}$$</div>

Where

zo – represents Zone Origin

br – represents the Zone Origin as input (relative to building origin)

The zone may also be rotated y<sub>z</sub> degrees relative to the building coordinates. Origins of zone surfaces are then given relative to the zone coordinate system. The global coordinates of the surface origins are calculated by:

<div>$${X_{so}} = {X_{zo}} + {X_{zr}}\cdot \cos {\psi_z} - {Y_{zr}}\cdot \sin {\psi_z}$$</div>

<div>$${Y_{so}} = {Y_{zo}} + {X_{zr}}\cdot \sin {\psi_z} - {Y_{zr}}\cdot \cos {\psi_z}$$</div>

<div>$${X_{so}} = {X_{zo}} + {X_{zr}}\cdot \cos {\psi_z} - {Y_{zr}}\cdot \sin {\psi_z}$$</div>

A surface azimuth angle relative to the zone coordinate system (y<sub>s</sub>) is converted to a global azimuth by:

<div>$$\psi  = {\psi_s} + {\psi_z} + {\psi_b}$$</div>

The surface tilt angle (f) is not changed by these rotations about the Z-axis.

The coordinates of the surface vertices are given in a coordinate system in the plane of the surface relative to the second vertex as shown for surfaces in Figure 40. The X-axis of the surface coordinate system is a horizontal line through the second vertex. The global coordinates of the surface vertices are given by:

<div>$$X = {X_{so}} + {X_{sr}}\cdot \cos \psi  - {Y_{sr}}\cdot \sin \psi \cdot \cos \phi $$</div>

<div>$$Y = {Y_{so}} + {X_{sr}}\cdot \sin \psi  - {Y_{sr}}\cdot \cos \psi \cdot \cos \phi $$</div>

<div>$$Z = {Z_{so}} + {Y_{sr}}\cdot \sin \phi $$</div>

#### World Coordinates è Relative Coordinates

Vertices in the global coordinate system can be transformed to the coordinate system relative to a given surface by

<div>$${X'} = X - {X_{so}}$$</div>

<div>$${Y'} = Y - {Y_{so}}$$</div>

<div>$${Z'} = Z - {Z_{so}}$$</div>

<div>$${X_{sr}} =  - {X'}\cdot \cos \psi  + {Y'}\cdot \sin \psi $$</div>

<div>$${Y_{sr}} =  - {X'}\cdot \sin \psi \cdot \cos \phi  + {Y'}\cdot \cos \psi \cdot \cos \phi  + {Z'}\cdot \sin \phi $$</div>

<div>$${Z_{sr}} =  - {X'}\cdot \sin \psi \cdot \sin \phi  + {Y'}\cdot \cos \psi \cdot \sin \phi  + {Z'}\cdot \cos \phi $$</div>

### Shadow Projection

All architectural forms are represented by plane polygons. This can give good accuracy even for curved surfaces: a sphere can be approximated by the 20 nodes of an icosahedron with only 3 percent error in the shadow area cast by the sphere. Consider how a solid object, which is composed of a set of enclosing plane polygons, casts a shadow. Figure 41 shows a box shaped structure on a horizontal surface. The structure consists of a top (surface 1) and four vertical surfaces (2 and 3 visible to the observer and 4 and 5 not visible). The sun is positioned behind and to the right of the structure and a shadow is cast onto the horizontal surface (the ground).

Surfaces 1, 4, and 5 are in sunlight; 2 and 3 are in shade. It is possible to think of the structure's shadow as the combination of shadows cast by surfaces 1, 2, 3, 4 and 5 or by 1, 4 and 5, or by surfaces 2 and 3.  This last combination of shadow casting surfaces is the simplest. In the EnergyPlus shadow algorithm every surface is considered to be one of the surfaces that enclose a solid, and only those surfaces that are not sunlit at a given hour are considered shadowing surfaces.

![](EngineeringReference/media/image622.png)

Figure 41.  Basic shadowing concept structure

The expressions in equation are the direction cosines of the surface:

<div>$$C{W_1} = \sin \psi \cdot \cos \phi $$</div>

<div>$$C{W_2} = \cos \psi \cdot \sin \phi $$</div>

<div>$$C{W_3} = \cos \phi $$</div>

The cosine of the angle of incidence of the sun's rays on the surface are given by the dot product of surface and sun direction cosines.

<div>$$\cos \theta  = C{S_1}\cdot C{W_1} + C{S_2}\cdot C{W_2} + C{S_3}\cdot C{W_3}$$</div>

If <span>$\cos \theta $</span> is less than zero, the sun is behind the surface.

A shadow is projected from the vertices of the shadowing polygon (SP) along the direction of the sun's rays to the plane of the shadow receiving polygon (RP).  If any vertices of the SP are below the plane of the RP (z &lt; 0), a false shadow is cast as in Figure 42.  The "submerged" portion of the SP must be clipped off before projection.

![](EngineeringReference/media/image628.png)

Figure 42.  Illustration of Shadow Clipping

This is done by finding, through linear interpolation, the points on the perimeter of the SP, which intersect the plane of the RP. These points become new vertices of the SP, which together with the other positive vertices define a clipped SP that casts only a real shadow.

A vertex located at (x, y, z) relative to the RP coordinate system casts a shadow to a point in the plane of the RP given by

<div>$${x'} = x - \frac{{z\cdot a}}{{\cos \theta }}$$</div>

<div>$${y'} = y - \frac{{z\cdot b}}{{\cos \theta }}$$</div>

where

<div>$$a = \sin \psi \cdot C{S_1} - \cos \psi \cdot C{S_2}$$</div>

and

<div>$$b =  - \cos \psi \cdot \cos \phi \cdot C{S_1} - \sin \psi \cdot \cos \phi \cdot C{S_2} + \sin \phi \cdot C{S_3}$$</div>

More explicitly, a casting surface – a shadow casting surface or general casting surface – is one that casts a shadow on other surfaces. A receiving surface – a shadow receiving surface – is one that receives shadows from other surfaces (i.e. casting surfaces). A back surface – an inside surface – is one that may be partially sunlit/receive solar transmission for interior solar distribution.

### Homogeneous Coordinates

Two-dimensional homogeneous coordinate techniques are used to determine the vertices of shadow overlaps. In homogeneous coordinates, points and lines are represented by a single form that allows simple vector operations between those forms [Newman-Sproul].  A point (X, Y) is represented by a three element vector (x, y, w) where x = w\*X, y = w\*Y, and w is any real number except zero. A line is also represented by a three element vector (a, b, c). The directed line (a, b, c) from point (x<sub>1</sub>, y<sub>1</sub>, w<sub>1</sub>) to point (x<sub>2</sub>, y<sub>2</sub>, w<sub>2</sub>) is given by:

<div>$$(a,b,c) = ({x_1},{y_1},{z_1}) \otimes ({x_2},{y_2},{z_2})$$</div>

The sequence in the cross product is a convention to determine sign. The condition that a point (x, y, w) lie on a line (a, b, c) is that

<div>$$(a,b,c) \bullet (x,y,w) = 0$$</div>

The point is normalized by dividing by w. Then if

<div>$$(a,b,c) \bullet (x/w,y/w,1) > 0$$</div>

the point is to the left of the line.  If it is less than zero, the point is to the right of the line. The intercept (x, y, w) of line (a<sub>1</sub>, b<sub>1</sub>, c<sub>1</sub>) and line (a<sub>2</sub>, b<sub>2</sub>, c<sub>2</sub>) is given by:

<div>$$(x,y,w) = ({a_1},{b_1},{c_1}) \otimes ({a_2},{b_2},{c_2})$$</div>

Note that the use of homogeneous coordinates as outlined above provides a consistent method and notation for defining points and lines, for determining intercepts, and for determining whether a point lies to the left, to the right, or on a line.  Normalization provides the means for transforming to and from homogeneous notation and Cartesian coordinates.  Thus, if (X, Y) is a Cartesian coordinate pair, its homogeneous coordinates are (X, Y, 1).  Similarly, the homogeneous coordinates (x, y, w) can be transformed to the Cartesian point with coordinates (x/w, y/w).

### Polygon Clipping Algorithms

Two methods for polygon clipping (treating of overlapping shadows) are currently in use in EnergyPlus.

* Convex Weiler - Atherton

* Sutherland – Hodgman

The original EnergyPlus method for polygon clipping is a special version of the Weiler-Atherton model (Weiler, Atherton, 1977). It was developed to be sufficiently general to clip concave polygons with holes. The implementation in the current version of EnergyPlus, however, does not support concave shadowing surfaces or holes. The relative computational complexity is preserved – the algorithm is carried out in four steps. For example, if A and B are polygons (see Figure 43).

1)   A call to INCLOS determines which vertices of X lie within Y.

2)   A second call determines which vertices of Y lie within X.

3)   If neither polygon is contained completely within the other, INTCPT is called to collect points of intersection between X and Y.

4)   Since the points are usually gathered out of order, they must then be oriented.

The Sutherland-Hodgman algorithm (Sutherland, Hodgman, 1974) is less complex compared to the Weiler-Atherton method and is well-suited to clipping convex polygons. In actuality, only convex shading surfaces are currently supported by EnergyPlus. Let X be a polygon called the “subject polygon” (SP) and Y be a polygon called the “clipping polygon” (CP). The method performs the computation by iterating over the edges of the CP and removing points from the SP that fall in the clipping plane, i.e. points that fall to the left of the edge of the CP. Intersections between the clip edge and the edges of the SP are added appropriately, and points falling outside of the clipping plane, i.e. to the right of the edge of the CP, are added the output polygon as well. This resultant polygon is stored and the process is repeated for the rest of the clip edges in CP. The process is analogous to cutting off pieces of the SP one-by-one with respect to each edge of the CP. The result is ordered and identical to the polygon produced by the Weiler-Atherton method.

### Overlapping Shadows

After transforming the shadows onto the plane of the receiving surface, the basic job of the shadow algorithm is to determine the area of the overlap between the polygons representing the shadows and the polygon representing the receiving surface. Concave surfaces are supported only for exterior wall heat transfer surfaces, when using SutherlandHodgman option. Concave shading devices are not supported by the this option. Neither concave shading devices nor concave exterior wall heat transfer surfaces are supported by the ConvexWeilerAtherton clipping routine.

When only convex shading devices are considered, this provides a great simplification. The overlap between two convex polygons (i.e. projections of shading devices via the direction of the sun) is another convex polygon. Coordinate and projection transformations of a convex polygon produce another convex polygon. Any non-convex polygon can be constructed as the union of convex ones.

For ConvexWeilerAtherton, there is considerable simplification if only convex (no interior angle &gt; 180 ) polygons are considered. The overlap between two convex polygons is another convex polygon. Coordinate and projection transformations of a convex polygon produce another convex polygon. Any non-convex polygon can be constructed as a sum of convex ones.

The vertices that define the overlap between two convex polygons, A and B, consist of:

* the vertices of A enclosed by B

* the vertices of B enclosed by A

* and the intercepts of the sides of A with the sides of B

In Figure 43, point a is the result of rule 1, point c is the result of rule 2, and points b and d result from rule 3. The overlap of A and B is the polygon a-b-c-d. Figure 44 shows an overlap where all of the vertices of B are enclosed by A.  Figure 45 shows an overlap defined only by the intercepts of A and B. Figure 46 shows a more complex overlap.

![](EngineeringReference/media/image637.png)

Figure 43.  Point a – Vertex of A Enclosed by B

Coordinate transformation retains the order of the vertices of a polygon, while a projection reverses the order. The sequence of vertices of the receiving polygons should be reversed so it and all shadow polygons will have the same sequence.

![](EngineeringReference/media/image638.png)

Figure 44.  Surface A Totally Overlaps Surface B.

A point is enclosed by a clockwise, convex polygon if the point lies to the right of all sides (or does not lie to the left of any side) of the polygon.  The intercept of two sides may not lie beyond the ends of either side. These are "line segments" rather than "lines". It is possible to tell if line segments A and B intercept within their end points by noting that the ends of A must lie on both sides of B, and the ends of B must lie on both sides of A. This should be done before the intercept is calculated.

![](EngineeringReference/media/image639.png)

Figure 45.  Figure Formed from Intercept Overlaps Between A and B

Once the vertices are determined, they must be sorted into clockwise order for the area to be computed.  Given a closed, planar polygon of n sequential vertices (x<sub>1</sub>, y<sub>1</sub>), (x<sub>2</sub>, y<sub>2</sub>) …, (x<sub>n</sub>, y<sub>n</sub>), its **area** is given:

<div>$$Area = {\textstyle{1 \over 2}}\sum\limits_{i = 1}^n {({x_i}{y_{i + 1}} - {x_{i + 1}}{y_i})} $$</div>

where (x<sub>n+1</sub>,y<sub>n+1</sub>)= (x<sub>1</sub>, y<sub>1</sub>)

The area is positive if the vertices are counter-clockwise and negative if they are clockwise.

![](EngineeringReference/media/image641.png)

Figure 46.  Complex Overlapping Condition

If two shadows overlap the receiving surface, they may also overlap each other as in Figure 47. The vertices of this overlap can be computed.  The areas of all overlaps can be computed.  The total sunlit area can be expressed as the sum of all polygon areas given a proper sign on each of the areas.



The following convention was adopted:

Table 24.  Surface / Area Characteristic / Convention

<table class="table table-striped">
<tr>
<th>Surface Characteristic</th>
<th>Area Convention</th>
</tr>
<tr>
<td>receiving surface</td>
<td>positive (A)</td>
</tr>
<tr>
<td>overlap between shadow and receiving</td>
<td>negative (B &amp; C)</td>
</tr>
<tr>
<td>overlap between two shadows</td>
<td>positive (D)</td>
</tr>

</table>

and so on through multiple overlaps where the sign of the overlap area is the product of the signs of the overlapping areas.

![](EngineeringReference/media/image642.png)

Figure 47.  Multiple Shadow Overlaps

Partially transparent shadowing surfaces can also be modeled by giving a transparency (t)to every shadowing polygon. Let tof the receiving polygon be one. Then the tof every overlap of polygons i and jis the product of t<sub>i</sub>and t<sub>j</sub>The shaded area is then computed by summing A<sub>i</sub>·(1 - t<sub>i</sub>) for all overlap polygons.

It is easy to determine the sunlit area of a window once all the shadow and overlap vertices on the wall have been computed. Consider wall 2 of Figure 38. First, the wall is considered a simple rectangle and the window on it is ignored. The shadow overlapping is performed and the sunlit portion of the gross wall area is computed. Then the window rectangle is overlapped with the shadow to determine its sunlit area. The sunlit area of the window is subtracted from the gross wall sunlit area to determine the net wall sunlit area. During this calculation it is not necessary to recompute the shadows, because they were precisely determined on the wall.

When the SutherlandHodgman option is selected, the overlap is computed using the Sutherland-Hodgman algorithm for polygon clipping when. Let X be a polygon called the “subject polygon” (SP) and Y be a polygon called the “clipping polygon” (CP). The method performs the computation by iterating over the edges of the CP and removing points from the SP that fall in the clipping plane, i.e. points that fall to the left of the edge of the CP. If it is to the left of any edge, it the point does not overlap with the CP. Intersections between the clip edge and the edges of the SP are added appropriately, and points falling outside of the clipping plane, i.e. to the right of the edge of the CP, are added the output polygon as well. This resultant polygon is stored and the process is repeated for the rest of the clip edges in CP. The process is analogous to cutting off pieces of the SP one-by-one with respect to each edge of the CP. Note that the SP may be concave, but the CP may not. This means that the exterior wall surfaces may be concave, while shading devices may not be concave.

### Solar Gains

The total solar gain on any exterior surface is a combination of the absorption of direct and diffuse solar radiation given by

<div>$${Q_{so}} = \alpha \cdot \left( {{I_b}\cdot \cos \theta \cdot \frac{{{S_s}}}{S} + {I_s}\cdot {F_{ss}} + {I_g}\cdot {F_{sg}}} \right)$$</div>

where

a =solar absorptance of the surface

A =angle of incidence of the sun's rays

S =area of the surface

S<sub>s</sub> = sunlit area

I<sub>b</sub> =intensity of beam (direct) radiation

I<sub>s</sub> =intensity of sky diffuse radiation

I<sub>g</sub> =intensity of ground reflected diffuse radiation

F<sub>ss</sub> = angle factor between the surface and the sky

F<sub>sg</sub> = angle factor between the surface and the ground

For the surface of a building located on a featureless plain

<div>$${F_{ss}} = \frac{{1 + \cos \phi }}{2}$$</div>

and

<div>$${F_{sg}} = \frac{{1 - \cos \phi }}{2}$$</div>

If the surface is shaded the program modifies *F<sub>ss</sub>*by a correction factor that takes into account the radiance distribution of the sky (see “Shadowing of Sky Diffuse Solar Radiation”).

Shading of ground diffuse solar radiation is not calculated by the program. It is up to the user to estimate the effect of this shading and modify the input value of *F<sub>sg</sub>*accordingly.

### Solar Distribution

As discussed in the Input Output Reference (Object: Building), the field Solar Distribution, in the “Building” input object, determines how EnergyPlus will treat beam solar radiation entering a zone through exterior windows.  There are five choices: **MinimalShadowing**, **FullExterior**, **FullInteriorAndExterior, FullExteriorWithReflections**, and **FullInteriorAndExteriorWithReflections**.

#### MinimalShadowing

In this case, there is no exterior shadowing except from window and door reveals. All beam solar radiation entering the zone is assumed to fall on the floor, where it is absorbed according to the floor's solar absorptance. Any reflected by the floor is added to the transmitted diffuse radiation, which is assumed to be uniformly distributed on all interior surfaces. If no floor is present in the zone, the incident beam solar radiation is absorbed on all interior surfaces according to their absorptances. The zone heat balance is then applied at each surface and on the zone's air with the absorbed radiation being treated as a flux on the surface.

#### FullExterior

In this case, shadow patterns on exterior surfaces caused by detached shading, wings, overhangs, and exterior surfaces of all zones are computed. As for MinimalShadowing, shadowing by window and door reveals is also calculated. Beam solar radiation entering the zone is treated as for MinimalShadowing.

#### FullExteriorWithReflections

This case is the same interior distribution as the preceding option but uses exterior reflections as well (see the section Solar Radiation Reflected from Exterior Surfaces for further explanation).

#### FullInteriorAndExterior

This is the same as FullExterior except that instead of assuming all transmitted beam solar falls on the floor the program calculates the amount of beam radiation falling on each surface in the zone, including floor, walls and windows, by projecting the sun's rays through the exterior windows, taking into account the effect of exterior shadowing surfaces and window shading devices.

If this option is used, you should be sure that the surfaces of the zone totally enclose a space. This can be determined by viewing the **eplusout.dxf** file with a program like AutoDesk’s Volo View Express. You should also be sure that the zone is **convex**. Examples of convex and non-convex zones are shown in Figure 48. The most common non-convex zone is an L-shaped zone. (A formal definition of convex is that any straight line passing through the zone intercepts at most two surfaces.)  If the zone’s surfaces do not enclose a space or if the zone is not convex you should use Solar Distribution = **FullExterior** instead of **FullInteriorAndExterior**.

If you use **FullInteriorAndExterior** the program will calculate how much beam radiation falling on an interior window is absorbed by the window, how much is reflected back into the zone, and how much is transmitted into the adjacent zone. (Interior windows are assumed to have no shading device).

If you use **FullInteriorAndExterior** the program will also calculate how much beam radiation falling on the inside of an exterior window (from other windows in the zone) is absorbed by the window, how much is reflected back into the zone, and how much is transmitted to the outside. In this calculation the effect of an interior or exterior shading device, if present, is accounted for.

#### FulInteriorAndlExteriorWithReflections

This case is the same interior distribution as the preceding option but uses exterior reflections as well (see Solar Radiation Reflected from Exterior Surfaces for further explanation).



![](EngineeringReference/media/image646.png)

Figure 48. Illustration of Convex and Non-convex Zones

### Details of the Interior Solar Distribution Calculation

EnergyPlus calculates the distribution of short-wave radiation in the interior of each thermal zone. This radiation consists of beam solar radiation, diffuse solar radiation, and short-wave radiation from electric lights. The program determines the amount of this radiation that is (1) absorbed on the inside face of opaque surfaces, (2) absorbed in the glass and shading device layers of the zone’s exterior and interior windows, (3) transmitted through the zone’s interior windows to adjacent zones, and (4) transmitted back out of the exterior windows. The effects of movable shading devices on the exterior windows are taken into account; *the program does not allow shading devices on interior windows*. Most of this calculation is done in subroutine CalcInteriorSolarDistribution in the SolarShading module.

#### Initial Distribution of Diffuse Solar Transmitted through Exterior and Interior Windows

Diffuse solar (from sky and ground sources) transmitted through exterior windows is first distributed to the interior heat transfer surfaces in the zone containing the exterior windows. This initial distribution apportions the transmitted diffuse solar to interior surfaces using the approximate view factors described above in “LW Radiation Exchange Among Zone Surfaces.” The amount of this initially distributed diffuse solar absorbed by each interior surface, and each window material layer, is calculated and later added to the “short-wave radiation absorbed” values described below. The amount of this initially distributed diffuse solar that is reflected is accumulated for each zone and redistributed uniformly as part of the QD calculation described below. The amount of this initially distributed diffuse solar that is transmitted by interior windows to adjacent zones is initially distributed to the interior heat transfer surfaces in the adjacent zone in the same manner as just described.

This new treatment of diffuse solar is intended to more accurately account for the initial absorption, transmittance, and reflection of short-wave radiation prior to the uniform distribution described below.

#### Interior Solar Radiation Absorbed by Opaque Surfaces

The short-wave radiation absorbed on the inside face of an opaque surface (floor, wall or ceiling) is given by

<div>$$
  QRadSWInAbs(SurfNum) = QS(ZoneNum)*AbsIntSurf(SurfNum) + AISurf(SurfNum)*BeamSolarRad [W/m2]
$$</div>

where

*SurfNum*= surface number

*ZoneNum =*number of zone that surface belongs to

*QS(ZoneNum)*= short-wave diffuse irradiance in the zone [W/m<sup>2</sup>]

*AbsIntSurf(SurfNum)*= inside solar absorptance of the surface

*AISurf(SurfNum)* = inside beam solar irradiance factor for the surface [-]

*BeamSolarRad* = outside beam normal solar irradiance [W/m<sup>2</sup>]

##### Interior Diffuse Radiation

*QS* is assumed to be uniformly distributed throughout the zone. It is calculated as follows. Let *Q<sub>sw</sub>* be the total diffuse short-wave radiation entering the zone or originating in the zone. Since *Q<sub>sw</sub>* is ultimately absorbed or transmitted by zone heat transfer surfaces, summing over these surfaces gives the following energy balance equation:

<div>$$\sum\limits_{i = 1}^{{N_{surf}}} {QS(ZoneNum)*{\alpha_i}{A_i} = {Q_{SW}}(ZoneNum)} $$</div>

where

*i* = zone surface number counter

*N<sub>surf</sub>*= number of heat transfer surfaces in zone

*A<sub>i</sub>* = surface area [m<sup>2</sup>]

<span>${\alpha_i}$</span>= inside solar absorptance for an opaque surface, or, for a window, = back diffuse transmittance plus back diffuse system absorptance of glass layers and shading device layers (if present)

Solving this equation for *QS* gives:

<div>$$QS(ZoneNum) = \frac{{{Q_{SW}}(ZoneNum)}}{{\sum\limits_{i = 1}^{{N_{surf}}} {AbsInsSur{f_i}{A_i}} }} = {Q_{SW}}(ZoneNum)*VMULT(ZoneNum)$$</div>

where

<div>$$VMULT(ZoneNum) = \frac{1}{{\sum\limits_{i = 1}^{{N_{surf}}} {AbsIntSur{f_i}*{A_i}} }}{\rm{    [}}{{\rm{m}}^{{\rm{ - 2}}}}]$$</div>

*Q<sub>sw</sub>* is given by

<div>$$
  Q{S_{SW}} = QD(ZoneNum) + ZoneIntGain(ZoneNum)\% QLTSW + ZoneIntGain(ZoneNum)\% T\_QLTSW [W]
$$</div>

where

*ZoneIntGain(ZoneNum)%QLTSW* = short-wave radiation into zone from general (overhead) electric lighting [W]

*ZoneIntGain(*ZoneNum*)%T\_QLTSW* = short-wave radiation into zone from task electric lighting [W]

*QD(ZoneNum)* = diffuse solar radiation entering or originating in zone [W]

*QD(ZoneNum)* is given by:

<div>$$QD(ZoneNum) = DBZone(ZoneNum)*BeamSolarRad + InitialDifSolDistReflectedW(ZoneNum)$$</div>

where

*BeamSolarRad* is the outside beam normal solar irradiance [W/m<sup>2</sup>]

*DBZone(ZoneNum)* is the diffuse solar radiation originating from beam solar that passes through the exterior windows in the zone and reflects diffusely from inside zone surfaces plus beam solar entering the zone as diffuse radiation from windows with shading devices or diffusing glass (all divided by BeamSolarRad)   [m<sup>2</sup>]

*InitialDifSolDistReflectedW(ZoneNum)* is the diffuse solar radiation originating from sky and sun related diffuse solar transmitted through the zone’s exterior or interior windows into the zone, and reflected diffusely from inside zone surfaces.

*DBZone(ZoneNum)* is calculated as:

<div>$$DBZone(ZoneNum) = BTOTZone - BABSZone{\rm{    [}}{{\rm{m}}^{\rm{2}}}]$$</div>

where

*BTOTZone* = total beam solar incident on the zone’s exterior windows that is transmitted as beam or diffuse.[[1]](#_ftn1)

*BABSZone=* total beam solar absorbed inside the zone.

*BTOTZone* is given by:

<div>$$BTOTZone = \sum\limits_{i = 1}^{{N_{extwin}}} {TBmAl{l_i}*SunlitFrac{t_i}*CosIn{c_i}*Are{a_i}*InOutprojSLFracMul{t_i}} $$</div>

*+ Diffuse entering zone from beam reflected by window inside reveal surfaces[**[2]**](#_ftn2)*

*+ Diffuse transmitted by windows from beam reflected by outside reveal surfaces*

*–  Beam absorbed by window inside reveal surfaces*

Here,

*TBmAll* = beam-to-beam plus beam-to-diffuse transmittance of window

*SunlitFract* = fraction of window irradiated by sun

*CosInc* = cosine of solar incidence angle on window

*Area* = glazed area of window [m<sup>2</sup>]

*InOutProjSLFracMult* = shadowing factor due to inside and outside projections of window frame and/or divider (= 1.0 if there is no frame or divider).

*BABSZone* is given by the following sum (see Figure 49):

*BABSZone* =  *Beam absorbed by opaque inside surfaces[**[3]**](#_ftn3)*

*                        + Beam transmitted through the zone’s interior windows +*

*                        + Beam transmitted back out of the zone’s exterior windows +*

*                        + Beam absorbed by the zone’s exterior and interior windows +*

*                        + Beam absorbed by inside daylighting shelves*

![](EngineeringReference/media/image656.png)

Figure 49. Vertical section through a two-zone building showing where transmitted beam solar falls. Some of the beam solar from exterior window EW is absorbed by the floor, D, interior wall, B, and interior window, IW. Some is transmitted by IW to the adjacent zone, Z2. Aoverlap is the irradiated area of a surface projected back onto the plane of EW. Beam reflected by D, B and IW contributes to the interior short-wave radiation flux in Z1.

If zone *ZoneNum* shares interior windows with other zones, *QS(ZoneNum)* is modified to take into account short-wave radiation received from the other zones through these windows:

<div>$$
  \begin{array}{rl}
   QS(ZoneNum) &= QS(ZoneNum) \\
               &+ \sum_{otherZones}\text{FractDifShortZtoZ(OtherZoneNum,ZoneNum)} \\
               &* [QD(OtherZoneNum) + ZoneIntGain(OtherZoneNum)\% QLTSW + ZoneIntGain(OtherZoneNum)\% T\_QLTSW]
  \end{array}
$$</div>

where

*FractDifShortZtoZ(OtherZoneNum,ZoneNum)* = “diffuse solar exchange factor” = fraction of short-wave radiation in *OtherZoneNum* that is transmitted to *ZoneNum*. This factor is calculated in subroutine ComputeDifSolExcZonesWIZWindows taking into account multiple reflection between zones. For example, for two zones means that some of the radiation transmitted from Zone1 to Zone2 is reflected back to Zone1, and some of this is in turn reflected back to Zone2, etc.

##### Interior Beam Radiation

The inside beam solar irradiance factor[[4]](#_ftn4) in is given by:



<span>$AISurf(SurfNum) = \frac{{AbsIntSurf(SurfNum)}}{{A(SurfNum)}}\sum\limits_{i = 1}^{{N_{extwin}}} {TB{m_i}*Aoverla{p_i}(SurfNum)*CosIn{c_i}} $</span>where

*i* = exterior window number

*N<sub>extwin</sub>=* number of exterior windows in zone

*CosInc<sub>i</sub>* = cosine of angle of incidence of beam on exterior window *i*

*TBm<sub>i</sub>* = beam-to-beam transmittance of exterior window* i*at *CosInc<sub>i</sub>* [[5]](#_ftn5)

*Aoverlap<sub>i</sub>(SurfNum)* = beam solar irradiated area of surface *SurfNum* projected back onto the plane of exterior window* i* (the *Aoverlap*’s for an exterior window sum up to the glazed area of the window). These overlap areas (Figure 49) are determined with the EnergyPlus shadowing routines by considering a zone’s exterior window as a “sending” surface and the inside faces of the zone’s other surfaces as “receiving” surfaces (see “Shading Module”). The overlap areas for a particular exterior window depend on the sun position, the geometry of the window, the geometry of the interior surfaces, and the location of the window with respect to the interior surfaces.

*AbsIntSurf(SurfNum)*= inside face solar absorptance of surface *SurfNum*

*A(SurfNum)* = area of surface *SurfNum* [m<sup>2</sup>]

#### Interior Solar Radiation Absorbed by Windows

The interior short-wave radiation absorbed by layer *l* (glass, shade or blind) of a window is equal to:



<span>$\begin{array}{l}QS(ZoneNum)*\alpha_{l,back}^{dif}(SurfNum) + \\BeamSolarRad*\frac{{\alpha_{l,back}^{beam}(SurfNum)}}{{A(SurfNum)}}\sum\limits_{i = 1}^{{N_{extwin}}} {TB{m_i}*Aoverla{p_i}(SurfNum)} *CosIn{c_i}{\rm{  [W/}}{{\rm{m}}^{\rm{2}}}]\end{array}$</span>where

<span>$\alpha_{l,back}^{dif}$</span>= the system diffuse solar absorptance of layer* l* for irradiance from the back side

<span>$\alpha_{l,back}^{beam}$</span>= the system beam solar absorptance of layer* l* for irradiance from the back side

*A(SurfNum)*= glazing area [m<sup>2</sup>]

Note that as of Version 2.1, the initially distributed diffuse solar absorbed by each surface (as described above under “Initial Distribution of Diffuse Solar Transmitted through Exterior and Interior Windows”) is added to this uniformly distributed short-wave radiation.

#### Interior Solar Radiation Transmitted by Interior Windows

##### Interior Diffuse Radiation Transmitted by Interior Windows

The interior diffuse short-wave radiation transmitted by an interior window to the adjacent zone is given by

<div>$$QS(ZoneNum)*{\tau ^{dif}}(SurfNum)*A(SurfNum){\rm{    [W]}}$$</div>

where

<span>${\tau ^{dif}}(SurfNum)$</span>= diffuse transmittance of the interior window

##### Interior Beam Radiation Transmitted by Interior Windows

The interior beam solar radiation transmitted by an interior window to the adjacent zone is

<div>$$BeamSolarRad*{\tau ^{beam}}(SurfNum)\sum\limits_{i = 1}^{{N_{extwin}}} {TB{m_i}*Aoverla{p_i}(SurfNum)*CosIn{c_i}{\rm{    [W}}]} $$</div>

where <span>${\tau ^{beam}}(SurfNum)$</span>is the beam-to-beam transmittance of the interior window at the angle of incidence of beam solar from the exterior window on the interior window. The program does not track where this radiation falls in the adjacent zone: it is counted as diffuse radiation in that zone. Therefore,

<div>$$QS(ZoneNum) \to QS(ZoneNum) + [{\rm{beam solar from adjacent zones]}}*VMULT(ZoneNum)$$</div>

### Ground Reflectances

Ground reflectance values (Ref Object: Site:GroundReflectance) are used to calculate the ground reflected solar amount.  This fractional amount (entered monthly) is used in the following equation:

<div>$${\rm{GroundReflectedSolar = (BeamSolar}} \bullet {\rm{COS(SunZenithAngle) + DiffuseSolar)}} \bullet {\rm{GroundReflectance}}$$</div>

Of course, the Ground Reflected Solar is never allowed to be negative.  The Snow Ground Reflectance Modifier can further modify the ground reflectance when snow is on the ground.  If the user enters 0.0 for each month, no ground reflected solar is used.

### Ground Reflectances (Snow)

When snow is on the ground, ground reflectances may change.  (Ref Object: Site:GroundReflectance:SnowModifier).  This object allows the user to specify two values, Ground Reflected Solar Modifier and Daylighting Ground Reflected Solar Modifier.

Ground Reflected Solar Modifier is used to modified the basic monthly ground reflectance when snow is on the ground (from design day input or weather data values). Values can range from 0.0 to 1.0.

<div>$${\rm{GroundReflectanc}}{{\rm{e}}_{{\rm{used}}}} = {\rm{GroundReflectance}} \bullet SolarModifie{r_{Snow}}$$</div>

Daylighting Ground Reflected Solar Modifier is used to modified the basic monthly ground reflectance when snow is on the ground (from design day input or weather data values). Values can range from 0.0 to 1.0.

<div>$${\rm{DaylightingGroundReflectanc}}{{\rm{e}}_{{\rm{used}}}} = {\rm{GroundReflectance}} \bullet DaylightingModifie{r_{Snow}}$$</div>

### References

ASHRAE. 2005. Handbook of Fundamentals, Chapter 31, Atlanta: ASHRAE.

ASHRAE. 2007. HVAC Applications, Chapter 33, Atlanta, ASHRAE.

Zhang, Qingyuan, Joe Huang, and Siwei Lang. 2002. "Development of Typical Year Weather Data for Chinese Locations", American Society of Heating Refrigeration and Air-Conditioning Engineers, ASHRAE Transactions, Vol 108, Part 2.

Threlkeld, J.L. and R.C. Jordan. 1958. Direct solar radiation available on clear days. ASHRAE Transactions 64:45.

Groth, C. C., and Lokmanhekim, M. 1969. "Shadow ‑ A New Technique for the Calculation of Shadow Shapes and Areas by Digital Computer," Second Hawaii International Conference on System Sciences, Honolulu, HI, January 22‑24, 1969.

Walton, G.N. 1983. “The Thermal Analysis Research Program Reference Manual Program (TARP)”, National Bureau of Standards (now National Institute of Standards and Technology).

Walton, G. N. 1978. "The Application of Homogeneous Coordinates to Shadowing Calculations", American Society of Heating Refrigeration and Air-Conditioning Engineers, ASHRAE Transactions, Vol 84, Part I.

Meeus, Jean. 2000. Astronomical Algorithms, Willmann-Bell.

Newman, M. W., and Sproul, R. F. 1973. Principles of Interactive Computer Graphics, McGraw‑Hill.

Polygon area derived from Green’s Theorem.  Graphic Gems repository.

Weiler, Kevin, Atherton, Peter. “Hidden Surface Removal Using Polygon Area Sorting.” Program of Computer Graphics, Cornell University. Ithaca, NY: 1977.

Sutherland, I.E., and Hodgman, G.W. 1974. “Reentrant Polygon Clipping”, Communication of Association for Computing Machinery (CACM), vol. 17, pp. 32-42.

Maillot,Patrick-Gilles.** “**A New, Fast Method For 2D Polygon Clipping: Analysis and Software Implementation.” Sun Microsystems, inc. Mountain View, CA: 1992.

Wisstein, Eric W. “Convex Polygon” From Mathworld- A Wolfram Web Resource.

Solar Radiation Reflected from Exterior Surfaces
================================================

EnergyPlus has an option to calculate beam and sky solar radiation that is reflected from exterior surfaces and then strikes the building. This calculation occurs if “withReflections” is used on the SolarDistribution option in the Building object. For zones with detailed daylighting, these reflections are also considered in the daylight illuminance calculations.[[6]](#_ftn6)

The reflecting surfaces fall into three categories:

* **Shadowing surfaces**. These are surfaces like overhangs or neighboring buildings entered with objects Shading:Site:Detailed, Shading:Building:Detailed, or Shading:Zone:Detailed Examples are shown in Figure 50.

These surfaces can have diffuse and/or specular (beam-to-beam)  reflectance values that are specified with the ShadingProperty:Reflectance object.

* **Exterior building surfaces**. In this case one section of the building reflects solar radiation onto another section (and vice-versa). See Figure 51.

Opaque building surfaces (walls, for example) are assumed to be diffusely reflecting. Windows and glass doors are assumed to be specularly reflecting. The reflectance values for opaque surfaces are calculated by the program from the Solar Absorptance and Visible Absorptance values of the outer material layer of the surface’s construction. The reflectance values for windows and glass doors are calculated by the program from the reflectance properties of the individual glass layers that make up surface’s construction assuming no shading device is present and taking into account inter-reflections among the layers.

* **The ground surface**. Beam solar and sky solar reflection from the ground is calculated even if “withReflections” is not used (the default). But in this case the ground plane is considered unobstructed, i.e., the shadowing of the ground by the building itself or by obstructions such as neighboring buildings is ignored. This shadowing is taken into account only if “WithReflections” is used in the Solar Distribution field (in “Building” input object) (Figure 52). In this case the user-input value of ground view factor is not used.

![](EngineeringReference/media/image670.png)

Figure 50.   Examples of solar reflection from shadowing surfaces in the Shading series of input objects. Solid arrows are beam solar radiation; dashed arrows are diffuse solar radiation. (a) Diffuse reflection of beam solar radiation from the top of an overhang. (b) Diffuse reflection of sky solar radiation from the top of an overhang. (c) Beam-to-beam (specular) reflection from the façade of an adjacent highly-glazed building represented by a vertical shadowing surface.

![](EngineeringReference/media/image671.png)

Figure 51.   Solar reflection from building surfaces onto other building surfaces. In this example beam solar reflects from a vertical section of the building onto a roof section. The reflection from the window is specular. The reflection from the wall is diffuse.

![](EngineeringReference/media/image672.png)

Figure 52. Shadowing by the building itself affects beam solar reflection from the ground.  Beam-to-diffuse reflection from the ground onto the building occurs only for sunlit areas, A and C, not for shaded area, B. Shadowing by the building also affects sky solar reflection from ground (not shown).

Diffuse Reflection of Beam Solar and Sky Solar Radiation
--------------------------------------------------------

A ray-tracing method is used to calculate beam solar and sky solar radiation that is diffusely reflected onto each of a building’s exterior surfaces (walls, roofs, windows and doors), called here “receiving surfaces.” The calculation begins by generating a set of rays proceeding into the outward hemisphere at each receiving point on a receiving surface. Then it determinines whether each ray hits the sky, ground or an obstruction. The radiance at the hit point from reflection of incident beam or sky solar is determined and the contribution of this radiance to the receiving surface is calculated, added to the contribution from other hit points, and averaged over the receiving points. Separate calculations are done for beam-to-diffuse and sky solar reflection from all obstructions and beam-to-diffuse and sky solar reflection from the ground. (For beam-to-beam reflection see “Beam Solar Radiation Specularly Reflected from Obstructions,” below.)

### *Receiving points*

An *N*-sided surface is assigned *N* receiving points with the following coordinates, expressed in terms of the surface vertex coordinates:

<div>$${P_{ij}} = \sum\limits_{k = 1}^N {{a_{ki}}{v_{kj}},{\rm{  }}i = 1,3;{\rm{  }}j = 1,3} $$</div>

where

*P<sub>ij</sub> = j<sup>th</sup>* coordinate of the* i<sup>th</sup>* receiving point

*v<sub>kj</sub>* =* j<sup>th</sup>* coordinate of the *k<sup>th</sup>* surface vertex

If *N* = 3:  *a<sub>kj</sub>* = 3/5 if *k*= *i*;  = 1/5 otherwise

If *N* &gt; 3:  *a<sub>kj</sub>* = <span>$\frac{{N + 1}}{{2N}}$</span> if *k*= *i*;  = <span>$\frac{1}{{2N}}$</span> otherwise

For example, for a vertical 3m by 5m rectangle with vertices (0,0,3), (0,0,0), (5,0,0) and (5,0,3), this expression gives receiving points at (1.25,0,2.25), (1.25,0,0.75), (3.75,0,0.75) and (3.75,0,2.25), as shown in Figure 53.



![](EngineeringReference/media/image676.png)

Figure 53. Vertical rectangular exterior heat transfer surface showing location of receiving points for calculating incident solar radiation reflected from obstructions.

### *Rays*

A total of 90 rays are sent out into the exterior hemisphere surrounding each receiving point. An upgoing ray may hit an obstruction or the sky. A downgoing ray may hit an obstruction or the ground. See Figure 54.

In subroutine InitSolReflRecSurf, the following is determined for each ray, *i,*:

1.    Unit vector in direction of ray

2.    Cosine of angle between ray and plane of receiving surface (<span>$\cos {\alpha_i}$</span>)

3.    Element of solid angle associated with ray (<span>$d{\Omega_i}$</span>)

4.    If the ray hits one or more obstructions, the coordinates of the hit point on the obstruction nearest the receiving point

5.    For the surface containing the hit point: the surface number, the solar reflectance (<span>${\rho_{obs,i}}$</span>if an obstruction), and the surface unit vector at the hit point pointing into the hemisphere containing the receiving point

6.    If the ray is downgoing and hits the ground, the coordinates of the ground hit point

7.    Distance from receiving point to hit point



![](EngineeringReference/media/image680.png)

Figure 54.  Two-dimensional schematic showing rays going outward from a point on a receiving surface. Rays 1-6 hit the ground, rays 7-11 hit an obstruction, and rays 12-15 hit the sky.

### Sky Solar Radiation Diffusely Reflected from Obstructions

The factor for reflection of sky radiation from obstructions onto a receiving surface is calculated in subroutine CalcSkySolDiffuseReflFactors. It is given by:

<div>$$\begin{array}{l}{\rm{ReflFacSkySolObs(RecSurfNum)}} = \\\frac{1}{{{N_{rec}}}}\sum\limits_1^{{N_{rec}}} {\sum\limits_{i = 1}^{{N_{ray}}} {Hi{t_{obs,i}}ViewFacSk{y_{obs,i}}DifShdgRatioIsoSk{y_{obs,i}}{\rho_{obs,i}}\cos {\alpha_i}/\pi } } \end{array}$$</div>

where

RecSurfNum is the receiving surface number,

<span>${N_{rec}}$</span>is the number of receiving points,

<span>${N_{ray}}$</span>is the number of rays,

“*obs,i*” denotes the obstruction hit by ray *i*,

*Hit<sub>obs,i</sub>* = 1 if ray* i* hits an obstruction, = 0 otherwise,

*ViewFacSky<sub>obs,i</sub>*= unobstructed sky view factor of the obstruction = <span>$(1 + \cos til{t_{obs}})/2$</span>,

*DifShdgRatioIsoSky<sub>obs,i</sub>*= (obstructed sky irradiance on obstruction)/(unobstructed sky irradiance on obstruction)

In this equation the product*ViewFacSky\*DifShdgRatioIsoSky*is the sky irradiance at the hit point divided by the horizontal sky irradiance taking into account shadowing of sky diffuse radiation on the obstruction by other obstructions, and assuming that the radiance of the sky is uniform. Note that we ignore secondary reflections here and in the following sections. In the present case this means that the irradiance at the hit point due to reflection of sky radiation from the ground or from other obstructions is not considered.

The above reflection factor is used in the timestep calculation to find the irradiance on a receiving surface due to sky radiation reflected from obstructions:

QRadSWOutIncSkyDiffReflObs(RecSurfNum) =
 DifSolarRad \* ReflFacSkySolObs(RecSurfNum)  (W/m<sup>2</sup>)

where*DifSolarRad* is the horizontal sky irradiance on an unobstructed horizontal plane (W/m<sup>2</sup>).

### Sky Solar Radiation Diffusely Reflected from the Ground

If a downgoing ray from a receiving point hits the ground (for example, rays 1-6 in Figure 54), the program calculates the radiance at the ground hit point due to sky diffuse solar reaching that point. To do this, rays are sent upward from the ground hit point and it is determined which of these rays are unobstructed and so go to the sky (for example, rays 6-10 in Figure 55). For this calculation it is assumed that the radiance of the sky is uniform.



![](EngineeringReference/media/image685.png)

Figure 55.  Two-dimensional schematic showing rays going upward from a ground hit point.

The factor for reflection of sky radiation from the ground onto a receiving surface is calculated in subroutine CalcSkySolDiffuseReflFactors. It is given by:

<div>$$\begin{array}{l}{\rm{ReflFacSkySolGnd(RecSurfNum)}} = \\\frac{1}{{{N_{rec}}}}\sum\limits_1^{{N_{rec}}} {\sum\limits_{i = 1}^{{N_{ray}}} {\left[ {(Hi{t_{gnd,i}}d{\Omega_i}\cos {\alpha_i}/\pi )\sum\limits_{j(i)}^{{N_{ray}}} {Hi{t_{sky,j(i)}}\cos {\alpha_{j(i)}}d{\Omega_{j(i)}}/\pi } } \right]} } \end{array}$$</div>



where

*<span>$j(i)$</span> * denotes an upgoing ray from the ground point hit by ray *i*from the receiving point,

*Hit<sub>sky,j(i)</sub>* = 1 if ray* j(i*) hits the sky, = 0 otherwise,

<span>${\alpha_{j(i)}}$</span>is the angle of incidence of ray <span>$j(i)$</span>with respect to the ground plane,

<span>$d{\Omega_{j(i)}}$</span>is the solid angle element associated with ray <span>$j(i)$</span>.

This factor is used in the timestep calculation to find the irradiance on a receiving surface due to sky radiation reflected from the ground:

QRadSWOutIncSkyDiffReflGnd(RecSurfNum) =
 DifSolarRad \* <span>${\rho_{gnd}}$</span>\* ReflFacSkySolGnd(RecSurfNum)  (W/m<sup>2</sup>)

where <span>${\rho_{gnd}}$</span>is the solar reflectance of the ground, which is assumed to be uniform over the ground plane but may vary monthly (because of snow cover, for example).

### Beam Solar Radiation Diffusely Reflected from Obstructions

This calculation is similar to that for sky solar reflected from obstructions. However, to find the radiance at a hit point on an obstruction a line is drawn from the hit point to center of the sun. From this line it is determined (1) if there is an obstruction between the hit point and the sun, in which case it is assumed that no beam solar reaches the hit point; and (2) if beam solar does reach the hit point, what the the solar angle of incidence at that point is.

The calculation is done for the hourly sun positions on each of the design days. It is also done for hourly sun positions on selected days during the weather file run period (the same days for which the shadowing calculations are done).

The factor for diffuse reflection of beam solar radiation from obstructions onto a receiving surface is calculated in subroutine CalcBeamSolDiffuseReflFactors. It is given by:

<div>$${\rm{ReflFacBmToDiffSolObs(RecSurfNum,IHr)}} = \frac{1}{{{N_{rec}}}}\sum\limits_1^{{N_{rec}}} {\sum\limits_{i = 1}^{{N_{ray}}} {Hi{t_{obs,i}}Hi{t_{obs,i,sun}}d{\Omega_i}\cos {\alpha_i}{\rho_{obs,i}}\cos {\alpha_{sun,obs,i}}} } $$</div>

where

* IHr* = hour number

<span>$Hi{t_{obs,i}}$</span>= 1 if ray *i* from the receiving point hits an obstruction, = 0 otherwise,

<span>$Hi{t_{obs,i,sun}}$</span>= 1 if the line from ray *i*’s hit point to the sun is unobstructed, = 0 otherwise,

<span>${\alpha_{sun,obs,i}}$</span> is the angle of incidence of the sun on the obstruction.

This factor is used in the timestep calculation to find the diffuse irradiance on a receiving surface due to beam solar diffusely reflected from obstructions:

QRadSWOutIncBmToDiffReflObs(RecSurfNum) = BeamSolarRad \*
 (WeightNow \* ReflFacBmToDiffSolObs(RecSurfNum,HourOfDay) +
 WeightPreviousHour \* ReflFacBmToDiffSolObs(RecSurfNum,PreviousHour))


where *BeamSolarRad* is the timestep value of beam normal solar intensity (W/m2), and *WeightNow* and *WeightPreviousHour* are time-averaging factors.

### Beam Solar Radiation Diffusely Reflected from the Ground

This calculation is the same as that for beam solar diffusely reflected from obstructions except that only rays from a receiving point that hit the ground are considered. The factor for diffuse reflection of beam solar from the ground onto a receiving surface is calculated in subroutine CalcBeamSolDiffuseReflFactors. It is given by:

<div>$${\rm{ReflFacBmToDiffSolGnd(RecSurfNum,IHr)}} = \frac{1}{{{N_{rec}}}}\sum\limits_1^{{N_{rec}}} {\sum\limits_{i = 1}^{{N_{ray}}} {Hi{t_{gnd,i}}Hi{t_{gnd,i,sun}}d{\Omega_i}\cos {\alpha_{gnd,i}}\cos {\alpha_{sun,gnd}}} } $$</div>

where

<span>$Hi{t_{gnd,i}}$</span>= 1 if ray *i* hits the ground, = 0 otherwise,

<span>$Hi{t_{gnd,i,sun}}$</span>= 1 if the line from ray *i*’s hit point ot the sun is unobstructed, = 0 otherwise,

<span>${\alpha_{sun,gnd}}$</span>= angle of incidence of sun on ground (= solar zenith angle).

This factor is used in the timestep calculation to find the diffuse irradiance on a receiving surface due to beam solar diffusely reflected from the ground:

QRadSWOutIncBmToDiffReflGnd(RecSurfNum) = BeamSolarRad \* <span>${\rho_{gnd}}$</span>\*
 (WeightNow \* ReflFacBmToDiffSolGnd(RecSurfNum,HourOfDay) +
 WeightPreviousHour \* ReflFacBmToDiffSolGnd(RecSurfNum,PreviousHour))



### Beam Solar Radiation Specularly Reflected from Obstructions

Figure 56 shows schematically how specular (beam-to-beam) reflection from an obstruction is calculated. [[7]](#_ftn7)

![](EngineeringReference/media/image703.png)

Figure 56.  Two-dimensional schematic showing specular reflection from an obstruction such as the glazed façade of a neighboring building. The receiving point receives specularly reflected beam solar radiation if (1) DB passes through specularly reflecting surface EF, (2) CD does not hit any obstructions (such as RS), and (3) AC does not hit any obstructions (such as PQ).

The calculation procedure is as follows:

1.    Select receiving point D on receiving surface JK.

2.    Select specularly reflecting surface EF.

3.    Find the mirror image, B, of the sun with respect to the plane of EF and construct ray DB.

4.    Check if DB passes through EF; if yes, find intersection point C and construct ray CD.

5.    Check if CD is obstructed.

6.    If no, construct ray AC and check if it is obstructed.

7.    If no, find reflected beam irradiance (W/m<sup>2</sup>) at D:

<div>$$I_{D,refl}^{bm} = BeamSolarRad*{\rho_{spec}}({\alpha_C})\cos {\alpha_D}$$</div>

where

<span>${\alpha_C}$</span>= angle of incidence of beam solar at point C of the obstruction,

<span>${\rho_{spec}}({\alpha_C})$</span>= reflectance of obstruction as a function of the angle of incidence,

<span>${\alpha_D}$</span>= angle of incidence of ray CD on JK.

The factor for specular reflection of beam solar from obstruction onto a receiving surface is calculated in subroutine CalcBeamSolSpecularReflFactors. It is given by:

<div>$${\rm{ReflFacBmToBmSolObs(RecSurfNum,IHr) }} = \sum\limits_{\scriptstyle specularly\atop{\scriptstyle reflecting\atop\scriptstyle surfaces}} {} \left[ {\frac{1}{{{N_{rec}}}}\sum\limits_1^{{N_{rec}}} {{f_{C,glazed}}{\rho_{spec}}({\alpha_C})\cos {\alpha_D}} } \right]$$</div>

The program assumes that specular reflection from a surface is due to glazing. If the reflecting surface is a window belonging to the building itself (as in Figure 51), then <span>${f_{C,glazed}}$</span>is the fraction of the window that is glazed (which is 1.0 unless the window has dividers).

If the surface is a shading surface (that represents, for example, the glazed façade of a neigboring building) the surface reflection information is entered with the Shading Surface Reflectance object. This object contains values for:

1.    Diffuse solar reflectance of the unglazed part of the shading surface

2.    Diffuse visible reflectance of the unglazed part of the shading surface

3.    Fraction of shading surface that is glazed

4.    Name of glazing construction

In this case <span>${f_{C,glazed}}$</span> is “Fraction of shading surface that is glazed” and <span>${\rho_{spec}}({\alpha_C})$</span>is the front reflectance of the indicated glazing construction as a function of beam solar incidence angle.

The above specular reflection factor is used in the timestep calculation to find the beam irradiance on a receiving surface due to beam-beam reflection from obstructions:

QRadSWOutIncBmToBmReflObsRecSurfNum) = BeamSolarRad \*
 (WeightNow \* ReflFacBmToBmSolObs(RecSurfNum,HourOfDay) +
 WeightPreviousHour \* ReflFacBmToBmSolObs(RecSurfNum,PreviousHour))



Daylighting and Window Calculations
===================================

Daylighting Calculations
------------------------

The EnergyPlus daylighting model, in conjunction with the thermal analysis, determines the energy impact of daylighting strategies based on analysis of daylight availability, site conditions, window management in response to solar gain and glare, and various lighting control strategies.

The daylighting calculation has three main steps:

1.    *Daylight factors*, which are ratios of interior illuminance or luminance to exterior horizontal illuminance, are calculated and stored. The user specifies the coordinates of one or two reference points in each daylit zone. EnergyPlus then integrates over the area of each exterior window in the zone to obtain the contribution of direct light from the window to the illuminance at the reference points, and the contribution of light that reflects from the walls, floor and ceiling before reaching the reference points. Window luminance and window background luminance, which are used to determine glare, are also calculated. Taken into account are such factors as sky luminance distribution, window size and orientation, glazing transmittance, inside surface reflectances, sun control devices such as movable window shades, and external obstructions. Dividing daylight illuminance or luminance by exterior illuminance yields daylight factors. These factors are calculated for the hourly sun positions on sun-paths for representative days of the run period. To avoid the spikes of daylight and glare factors calculated during some sunrise and/or sunset hours when exterior horizontal illuminance is very low, the daylight and glare factors for those hours are reset to 0.

2.    A daylighting calculation is performed each heat-balance time step when the sun is up. In this calculation the illuminance at the reference points in each zone is found by interpolating the stored daylight factors using the current time step’s sun position and sky condition, then multiplying by the exterior horizontal illuminance. If glare control has been specified, the program will automatically deploy window shading, if available, to decrease glare below a specified comfort level. A similar option uses window shades to automatically control solar gain.

3.    The electric lighting control system is simulated to determine the lighting energy needed to make up the difference between the daylighting illuminance level and the design illuminance. Finally, the zone lighting electric reduction factor is passed to the thermal calculation, which uses this factor to reduce the heat gain from lights.

The EnergyPlus daylighting calculation is derived from the daylighting calculation in DOE-2.1E, which is described in [Winkelmann, 1983] and [Winkelmann and Selkowitz, 1985]. There are two major differences between the two implementations: (1) In EnergyPlus daylight factors are calculated for four different sky types—clear, clear turbid, intermediate, and overcast; in DOE-2 only two sky types are used—clear and overcast. (2) In EnergyPlus the clear-sky daylight factors are calculated for hourly sun-path sun positions several times a year whereas in DOE-2 these daylight factors are calculated for a set of 20 sun positions that span the annual range of sun positions for a given geographical location.

Daylight Factor Calculation
---------------------------

Table 25.  Variables in Daylighting Calculations

<table class="table table-striped">
  <tr>
    <th>Mathematical Variable</th>
    <th>Description</th>
    <th>Units</th>
    <th>Internal Variable</th>
  </tr>
  <tr>
    <td>E<sub>h,sky</sub></td>
    <td>Exterior horizontal illuminance due to light from the sky</td>
    <td>lux</td>
    <td>GILSK</td>
  </tr>
  <tr>
    <td>E<sub>h,sun</sub></td>
    <td>Exterior horizontal illuminance due to light from the sun</td>
    <td>lux</td>
    <td>GILSU</td>
  </tr>
  <tr>
    <td>d<sub>sky</sub>,d<sub>sun</sub></td>
    <td>Interior illuminance factor due</td>
    <td>-</td>
    <td>DFACSK,DFACSU</td>
  </tr>
  <tr>
    <td>w<sub>sky</sub>,w<sub>sun</sub></td>
    <td>Window luminance factor due to sky, sun related light</td>
    <td>cd/lm</td>
    <td>SFACSK, SFACSU</td>
  </tr>
  <tr>
    <td>b<sub>sky</sub>,b<sub>sun</sub></td>
    <td>Window background luminance factor due to sky, sun related light</td>
    <td>cd/lm</td>
    <td>BFACSK, BFACSU</td>
  </tr>
  <tr>
    <td>N Number of exterior windows</td>
    <td>Number of exterior windows in a zone</td>
    <td>-</td>
    <td>NWD</td>
  </tr>
  <tr>
    <td>θ<sub>sky</sub>,φ<sub>sky</sub></td>
    <td>Azimuth and altitude angles of a point in the sky</td>
    <td>radians</td>
    <td>THSKY, PHSKY</td>
  </tr>
  <tr>
    <td>ψ<sub>cs</sub></td>
    <td>Clear sky luminance distribution</td>
    <td>cd/m2</td>
    <td>-</td>
  </tr>
  <tr>
    <td>ψ<sub>ts</sub></td>
    <td>Clear turbid sky luminance distribution</td>
    <td>cd/m2</td>
    <td>-</td>
  </tr>
  <tr>
    <td>ψ<sub>os</sub></td>
    <td>Intermediate sky luminance distribution</td>
    <td>cd/m2</td>
    <td>-</td>
  </tr>
  <tr>
    <td>ψ<sub>os</sub></td>
    <td>Overcast sky luminance distribution</td>
    <td>cd/m2</td>
    <td>-</td>
  </tr>
  <tr>
    <td>φ<sub>sun</sub></td>
    <td>Altitude angle of the sun</td>
    <td>radians or degrees</td>
    <td>PHSUN</td>
  </tr>
  <tr>
    <td>γ</td>
    <td>Angle between point in the sky and the sun; or angle between vertical and ray from reference point to window element</td>
    <td>radians</td>
    <td>G</td>
  </tr>
  <tr>
    <td>L<sub>z</sub></td>
    <td>Sky zenith luminance</td>
    <td>cd/m2</td>
    <td>ZENL</td>
  </tr>
  <tr>
    <td>Mathematical Variable</td>
    <td>Optical air mass of the atmosphere</td>
    <td>m</td>
    <td>AM</td>
  </tr>
  <tr>
    <td>h</td>
    <td>Building altitude</td>
    <td>m</td>
    <td>ELEVATION</td>
  </tr>
  <tr>
    <td>E<sub>h,k</sub></td>
    <td>Exterior horizontal illuminance for sky type k</td>
    <td>lux</td>
    <td>-</td>
  </tr>
  <tr>
    <td>N<sub>θ</sub>,N<sub>φ</sub></td>
    <td>Number of azimuth, altitude steps for sky integration</td>
    <td></td>
    <td>NTH, NPH</td>
  </tr>
  <tr>
    <td><span>$\vec{R}_{ref}$</span></td>
    <td>Vector from zone origin to reference point</td>
    <td>m</td>
    <td>RREF</td>
  </tr>
  <tr>
    <td><span>$\vec{R}_{win}$</span></td>
    <td>Vector from zone origin to window element</td>
    <td>m</td>
    <td>RWIN</td>
  </tr>
  <tr>
    <td>dΩ</td>
    <td>Solid angle subtended by window element</td>
    <td>steradians</td>
    <td>DOMEGA</td>
  </tr>
  <tr>
    <td>L<sub>w</sub></td>
    <td>Luminance of a window element as seen from reference point</td>
    <td>cd/m2</td>
    <td>WLUMSK, WLUMSU</td>
  </tr>
  <tr>
    <td>L<sub>w,shade</sub></td>
    <td>Luminance of window element with shade in place</td>
    <td>cd/m2</td>
    <td>WLUMSK, WLUMSU</td>
  </tr>
  <tr>
    <td>dE<sub>h</sub></td>
    <td>Horizontal illuminance at reference point from window element</td>
    <td>lux</td>
    <td>-</td>
  </tr>
  <tr>
    <td>dx, dy</td>
    <td>Size of window element</td>
    <td>m</td>
    <td>DWX, DWY</td>
  </tr>
  <tr>
    <td>D</td>
    <td>Distance from reference point to window element</td>
    <td>m</td>
    <td>DIS</td>
  </tr>
  <tr>
    <td>B</td>
    <td>Angle between window element's outward normal and rat from reference point to window element</td>
    <td>radians</td>
    <td>-</td>
  </tr>
  <tr>
    <td><span>$\hat{R}_{ref}$</span></td>
    <td>Unit vector from reference point to window element</td>
    <td>-</td>
    <td>RAY</td>
  </tr>
  <tr>
    <td><span>$\hat{W}_{n}$</span></td>
    <td>Unit vector normal to window element, pointing away from zone</td>
    <td>-</td>
    <td>WNORM</td>
  </tr>
  <tr>
    <td><span>$\hat{W}_{21}$</span></td>
    <td>Unit vector along window y-axis</td>
    <td>-</td>
    <td>W21</td>
  </tr>
  <tr>
    <td><span>$\hat{W}_{23}$</span></td>
    <td>Unit vector along window x-axis</td>
    <td>-</td>
    <td>W23</td>
  </tr>
  <tr>
    <td>τ<sub>vis</sub></td>
    <td>Glass visible transmittance</td>
    <td>-</td>
    <td>TVISB</td>
  </tr>
  <tr>
    <td>L</td>
    <td>Luminance of sky or obstruction</td>
    <td>cd/m2</td>
    <td>ELUM, -</td>
  </tr>
  <tr>
    <td>Φ<sub>FW</sub></td>
    <td>Downgoing luminous flux from a window</td>
    <td>lm</td>
    <td>FLFW –</td>
  </tr>
  <tr>
    <td>Φ<sub>CW</sub></td>
    <td>Upgoing luminous flux from a window</td>
    <td>lm</td>
    <td>FLCW –</td>
  </tr>
  <tr>
    <td>F<sub>1</sub></td>
    <td>First-reflected flux</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>ρ<sub>FW</sub></td>
    <td>Area-weighted reflectance of floor and upper part of walls</td>
    <td>-</td>
    <td>SurfaceWindow%RhoFloorWall</td>
  </tr>
  <tr>
    <td>ρ<sub>CW</sub></td>
    <td>Area-weighted reflectance of ceiling and upper part of walls</td>
    <td>-</td>
    <td>SurfaceWindow%RhoCeilingWall</td>
  </tr>
  <tr>
    <td>E<sub>r</sub></td>
    <td>Average internally-reflected illuminance</td>
    <td>lux</td>
    <td>EINTSK, EINTSU</td>
  </tr>
  <tr>
    <td>A</td>
    <td>Total inside surface area of a zone</td>
    <td>m2</td>
    <td>ATOT</td>
  </tr>
  <tr>
    <td>ρ</td>
    <td>Area-weighted average reflectance of zone interior surfaces</td>
    <td>-</td>
    <td>ZoneDaylight%AveVisDiffREflect</td>
  </tr>
  <tr>
    <td>θ, φ</td>
    <td>Azimuth and altitude angle of a sky or ground element</td>
    <td>radians</td>
    <td>TH, PH</td>
  </tr>
  <tr>
    <td>L(θ, φ)</td>
    <td>Luminance of sky or ground element at (θ, φ)</td>
    <td>cd/m2</td>
    <td>HitPointLum--</td>
  </tr>
  <tr>
    <td>A<sub>w</sub></td>
    <td>Area of glazed part of window</td>
    <td>m2</td>
    <td>Surface%Area</td>
  </tr>
  <tr>
    <td>β</td>
    <td>Angle of incidence, at center of window, of light from a sky or ground element</td>
    <td>radians</td>
    <td>-</td>
  </tr>
  <tr>
    <td>T(β)</td>
    <td>Glazing visible transmittance at incidence angle β</td>
    <td></td>
    <td>TVISBR</td>
  </tr>
  <tr>
    <td>dΦ<sub>inc</sub></td>
    <td>Luminous flux incident on window from sky or ground element</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>dΦ</td>
    <td>Luminous flux from sky or ground element transmitted through window</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>dΦ<sub>FW|, dΦ<sub>CW</sub></td>
    <td>Luminous flux from sky or ground element transmitted through window and going downward, upward</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>{min</sub>, θ{max</sub></td>
    <td>Azimuth angle integration limits</td>
    <td>radians</td>
    <td>THMIN, THMAX</td>
  </tr>
  <tr>
    <td>φ<sub>w</sub></td>
    <td>Window normal altitude angle</td>
    <td>radians</td>
    <td>-</td>
  </tr>
  <tr>
    <td>Φ<sub>sh</sub>,Φ<sub>unsh</sub></td>
    <td>Transmitted flux through window and shade, without shade</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>Φ<sub>CW,sh</sub>,Φ<sub>FW,sh</sub></td>
    <td>Upgoing and downgoing portions of transmitted flux through window with shade</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>Φ<sub>CW,unsh</sub>,Φ<sub>FW,unsh</sub></td>
    <td>Upgoing and downgoing portions of transmitted flux through window without shade</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>f</td>
    <td>Fraction of hemisphere seen by the inside of window that lies above the window midplane</td>
    <td>-</td>
    <td>SurfaceWindow%Fraction UpGoing</td>
  </tr>
  <tr>
    <td>Φ<sub>inc</sub></td>
    <td>Flux incident on glazing from direct sun</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>f<sub>sunlit</sub></td>
    <td>Fraction of glazing that is sunlit</td>
    <td>-</td>
    <td>SunLitFrac</td>
  </tr>
  <tr>
    <td>Φ</td>
    <td>Transmitted flux from direct sun</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>L<sub>sh</sub></td>
    <td>Luminance of window with shade</td>
    <td>cd/m2</td>
    <td>-</td>
  </tr>
  <tr>
    <td>L<sub>b</sub></td>
    <td>Window background luminance</td>
    <td>cd/m2</td>
    <td>BLUM</td>
  </tr>
  <tr>
    <td>G</td>
    <td>Discomfort glare constant</td>
    <td>-</td>
    <td>GTOT</td>
  </tr>
  <tr>
    <td>G<sub>i</sub></td>
    <td>Discomfort glare constant from window I</td>
    <td>-</td>
    <td>-</td>
  </tr>
  <tr>
    <td>ω</td>
    <td>Solid angle subtended by window with respect to reference point</td>
    <td>steradians</td>
    <td>SolidAngAtRefPt</td>
  </tr>
  <tr>
    <td>Ω</td>
    <td>Solid angle subtended by window with respect to reference point, modified to take direction of occupant view into account</td>
    <td>steradians</td>
    <td>SolidAngAtRefPtWtd</td>
  </tr>
  <tr>
    <td>N<sub>x</sub>,N<sub>y</sub></td>
    <td>Number of elements in x and y direction that window is divided into for glare calculation</td>
    <td>-</td>
    <td>NWX, NWY</td>
  </tr>
  <tr>
    <td>p(x<sub>R</sub>,y<sub>R</sub>)</td>
    <td>Position factor for horizontal and vertical displacement ratios x_{R} and y_{R}</td>
    <td>-</td>
    <td>DayltgGlarePositionFactor</td>
  </tr>
  <tr>
    <td>p<sub>H</sub></td>
    <td>Hopkinson position factor</td>
    <td>-</td>
    <td>DayltgGlarePositionFactor</td>
  </tr>
  <tr>
    <td>L<sub>b</sub></td>
    <td>Window background luminance</td>
    <td>cd/m2</td>
    <td>BLUM</td>
  </tr>
  <tr>
    <td>E<sub>b</sub></td>
    <td>Illuminance on window background</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>E<sub>r</sub></td>
    <td>Total internally-reflected component of daylight illuminance</td>
    <td>lm</td>
    <td>-</td>
  </tr>
  <tr>
    <td>E<sub>s</sub></td>
    <td>Illuminance setpoint</td>
    <td>lm</td>
    <td>IllumSetPoint</td>
  </tr>
  <tr>
    <td>G<sub>i</sub></td>
    <td>Glare Index</td>
    <td>-</td>
    <td>GLINDX</td>
  </tr>
</table>

### Overview

There are three types of daylight factors: interior illuminance factors, window luminance factors, and window background luminance factors. To calculate these factors the following steps are carried out for each hourly sun position on the sun paths for the design days and for representative days[[8]](#_ftn8) during the simulation run period:

1.    Calculate exterior horizontal daylight illuminance from sky and sun for standard (CIE) clear and overcast skies.

2.    Calculate interior illuminance, window luminance and window background luminance for each window/reference-point combination, for bare and for shaded window conditions (if a shading device has been specified), for overcast sky and for standard clear sky.

3.    Divide by exterior horizontal illuminance to obtain daylight factors.

### Interior Illuminance Components

To calculate daylight factors, daylight incident on a window is separated into two components: (1) light that originates from the *sky* and reaches the window directly or by reflection from exterior surfaces; and (2) light that originates from the *sun* and reaches the window directly or by reflection from exterior surfaces. Light from the window reaches the workplane directly or via reflection from the interior surfaces of the room.

For fixed sun position, sky condition (clear or overcast) and room geometry, the sky-related interior daylight will be proportional to the exterior horizontal illuminance, *E<sub>h,sky</sub>*, due to light from the sky. Similarly, the sun-related interior daylight will be proportional to the exterior horizontal solar illuminance, *E<sub>h,sun</sub>*.

### Daylight Factors

The following daylight factors are calculated:

<div>$${d_{sky}} = \frac{{{\rm{Illuminance at reference point due to sky - related light}}}}{{{E_{h,sky}}}}$$</div>

<div>$${d_{sun}} = \frac{{{\rm{Illuminance at reference point due to sun - related light}}}}{{{E_{h,sun}}}}$$</div>

<div>$${w_{sky}} = \frac{{{\rm{Average window luminance due to sky - related light}}}}{{{E_{h,sky}}}}$$</div>

<div>$${w_{sun}} = \frac{{{\rm{Average window luminance due to sun - related light}}}}{{{E_{h,sun}}}}$$</div>

<div>$${b_{sky}} = \frac{{{\rm{Window background luminance due to sky - related light}}}}{{{E_{h,sky}}}}$$</div>

<div>$${b_{sun}} = \frac{{{\rm{Window background luminance due to sun - related light}}}}{{{E_{h,sun}}}}$$</div>

For a daylit zone with *N* windows these six daylight factors are calculated for each of the following combinations of reference point, window, sky-condition/sun-position and shading device:

<div>$$
  \left[
    \begin{array}{c}
      Ref pt 1 \\
      Ref pt 2
    \end{array}
  \right]
  \left[
    \begin{array}{c}
      Window 1 \\
      Window 2 \\
      ... \\
      Window N
    \end{array}
  \right]
  \left[
    \begin{array}{c}
      Clear sky, first sun-up hour \\
      Clear/turbid sky, first sun-up hour \\
      Intermediate sky, first sun-up hour \\
      Overcast sky, first sun-up hour \\
      ...
      Clear sky, last sun-up hour \\
      Clear/turbid sky, last sun-up hour \\
      Intermediate sky, last sun-up hour \\
      Overcase sky, last sun-up hour
    \end{array}
   \right]
   \left[
     \begin{array}{c}
       Unshaded window \\
       Shaded window \\
       (if shade assigned)
     \end{array}
   \right]
$$</div>

### Sky Luminance Distributions

The luminance distribution of the sky is represented as a superposition of four standard CIE skies using the approach described in (Perez et al. 1990). The standard skies are as follows.

#### Clear Sky

The clear sky luminance distribution has the form (Kittler, 1965; CIE, 1973)

<div>$${\psi_{cs}}({\theta_{sky}},{\phi_{sky}}) = {L_z}\frac{{(0.91 + 10{e^{ - 3\gamma }} + 0.45{{\cos }^2}\gamma )(1 - {e^{ - 0.32{\rm{cosec}}{\phi_{sky}}}})}}{{0.27385(0.91 + 10{e^{ - 3(\frac{\pi }{2} - {\phi_{sun}})}} + 0.45{{\sin }^2}{\phi_{sun}})}}$$</div>

Here, *L<sub>z</sub>* is the zenith luminance (i.e., the luminance of the sky at a point directly overhead). In the calculation of daylight factors, which are ratios of interior and exterior illumination quantities that are both proportional to *L<sub>z</sub>*, the zenith luminance cancels out. For this reason we will use *L<sub>z</sub>* = 1.0 for all sky luminance distributions.

The various angles, which are defined in the building coordinate system, are shown in Figure 48. The angle,* γ*, between sun and sky element is given by

<div>$$\gamma  = {\cos ^{ - 1}}\left[ {\sin {\phi_{sky}}\sin {\phi_{sun}} + \cos {\phi_{sky}}\cos {\phi_{sun}}\cos ({\theta_{sky}} - {\theta_{sun}})} \right]$$</div>

The general characteristics of the clear-sky luminance distribution are a large peak near the sun; a minimum at a point on the other side of  the zenith from the sun, in the vertical plane containing the sun; and an increase in luminance as the horizon is approached.

#### Clear Turbid Sky

The clear turbid sky luminance distribution has the form [Matsuura, 1987]

<div>$${\psi_{ts}}({\theta_{sky}},{\phi_{sky}}) = {L_z}\frac{{(0.856 + 16{e^{ - 3\gamma }} + 0.3{{\cos }^2}\gamma )(1 - {e^{ - 0.32{\rm{cosec}}{\phi_{sky}}}})}}{{0.27385(0.856 + 10{e^{ - 3(\frac{\pi }{2} - {\phi_{sun}})}} + 0.3{{\sin }^2}{\phi_{sun}})}}$$</div>

#### Intermediate Sky

The intermediate sky luminance distribution has the form [Matsuura, 1987]

<div>$${\psi_{is}}\left( {{\theta_{sky}},{\phi_{sky}}} \right) = {L_z}{Z_1}{Z_2}/({Z_3}{Z_4})$$</div>

where

<span>${Z_1} = \left[ {1.35(\sin (3.59{\phi_{sky}} - 0.009) + 2.31)\sin (2.6{\phi_{sun}} + 0.316) + {\phi_{sky}} + 4.799} \right]/2.326$</span><span>${Z_2} = \exp \left[ { - 0.563\gamma \{ ({\phi_{sun}} - 0.008)({\phi_{sky}} + 1.059) + 0.812\} } \right]$</span>

<div>$${Z_3} = 0.99224\sin (2.6{\phi_{sun}} + 0.316) + 2.73852$$</div>

<div>$${Z_4} = \exp \left[ { - 0.563({\textstyle{\pi  \over 2}} - {\phi_{sun}})\{ 2.6298({\phi_{sun}} - 0.008) + 0.812\} } \right]$$</div>



![ClearSkyAngles](EngineeringReference/media/image733.png)

Figure 57.  Angles appearing in the expression for the clear-sky luminance distribution.

#### Overcast Sky

The overcast sky luminance distribution has the form [Moon & Spencer, 1942]

<div>$${\psi_{os}}({\phi_{sky}}) = {L_z}\frac{{1 + 2\sin {\phi_{sky}}}}{3}$$</div>

Unlike the clear sky case, the overcast sky distribution does not depend on the solar azimuth or the sky azimuth. Note that at fixed solar altitude the zenith (<span>${\phi_{sky}} = \pi /2$</span>) is three times brighter than the horizon (<span>${\phi_{sky}} = 0$</span>).

### Direct Normal Solar Illuminance

For purposes of calculating daylight factors associated with beam solar illuminance, the direct normal solar illuminance is taken to be 1.0 W/m<sup>2</sup>. The actual direct normal solar illuminance, determined from direct normal solar irradiance from the weather file and empirically-determined luminious efficacy, is used in the time-step calculation.

### Exterior Horizontal Illuminance

The illuminance on an unobstructed horizontal plane due to diffuse radiation from the sky is calculated for each of the four sky types by integrating over the appropriate sky luminance distribution:

<div>$${E_{h,k}} = \int\limits_0^{2\pi } {\int\limits_0^{\pi /2} {{\psi_k}({\theta_{sky}},{\phi_{sky}})\sin {\phi_{sky}}\cos {\phi_{sky}}d{\theta_{sky}}} } d{\phi_{sky}}$$</div>

where* k* = *cs*, *ts*, *is* or *os*. The integral is evaluated as a double summation:

<div>$${E_{h,k}} = \sum\limits_{i = 1}^{{N_\theta }} {\sum\limits_{j = 1}^{{N_\phi }} {{\psi_k}\left( {{\theta_{sky}}(i),{\phi_{sky}}(j)} \right)} } \sin {\phi_{sky}}(j)\cos {\phi_{sky}}(j)\Delta {\theta_{sky}}\Delta {\phi_{sky}}$$</div>

where

<div>$$
  \begin{array}{l}
    \theta_{sky}(i) = (i - 1/2) \Delta \theta_{sky} \\
    \phi_{sky}(j) = (j - 1/2) \Delta \phi_{sky} \\
    \Delta \theta_{sky} = 2 \pi / N_{\theta} \\
    \Delta \phi_{sky} = \pi / 2N_{\phi} 
  \end{array}
$$</div>

<span>${N_\theta } = 18$</span> and <span>${N_\phi } = 8$</span> were found to give a <span>$ \pm 1\% $</span>accuracy in the calculation of <span>${E_h}_{,k}$</span>.

### Direct Component of Interior Daylight Illuminance

The direct daylight illuminance at a reference point from a particular window is determined by dividing the window into an x-y grid and finding the flux reaching the reference point from each grid element. The geometry involved is shown in Figure 58. The horizontal illuminance at the reference point, <span>${\vec R_{ref}}$</span>, due to a window element is

<div>$$d{E_h} = {L_w}d\Omega \cos \gamma $$</div>

where *L<sub>w</sub>* is the luminance of the window element as seen from the reference point.

The subtended solid angle is approximated by

<div>$$d\Omega  = \frac{{dxdy}}{{{D^2}}}\cos B$$</div>

where

<div>$$D = \left| {{{\bar R}_{win}} - {{\bar R}_{ref}}} \right|$$</div>

*CosB* is found from

<div>$$\cos B = {\hat R_{ray}} \cdot {\hat W_n}$$</div>

where

<div>$${\vec R_{ray}} = ({\vec R_{win}} - {\vec R_{ref}})/D$$</div>

<div>$${\hat W_n} = {\rm{ window outward normal }} = {\hat W_{21}} \times {\hat W_{23}} = \frac{{{{\vec W}_1} - {{\vec W}_2}}}{{\left| {{{\vec W}_1} - {{\vec W}_2}} \right|}} \times \frac{{{{\vec W}_3} - {{\vec W}_2}}}{{\left| {{{\vec W}_3} - {{\vec W}_2}} \right|}}$$</div>

Equation becomes exact as <span>$dx/D{\rm{ and }}dy/D \to 0$</span>and is accurate to better than about 1% for <span>$dx \le D/4{\rm{ and }}dy \le D/4$</span>.

The net illuminance from the window is obtained by summing the contributions from all the window elements:

<div>$${E_h} = \sum\limits_{\scriptstyle window\atop\scriptstyle elements} {{L_w}d\Omega \cos \gamma } $$</div>

In performing the summation, window elements that lie below the workplane (<span>$\cos \gamma  < 0$</span>) are omitted since light from these elements cannot reach the workplane directly.

![GeomDirComp](EngineeringReference/media/image755.png)

Figure 58.  Geometry for calculation of direct component of daylight illuminance at a reference point. Vectors R<sub>ref</sub>, W<sub>1</sub>, W<sub>2</sub>, W<sub>3</sub> and R<sub>win</sub> are in the building coordinate system.

#### Unshaded Window

For the unshaded window case, the luminance of the window element is found by projecting the ray from reference point to window element and determining whether it intersects the sky or an exterior obstruction such as an overhang. If *L* is the corresponding luminance of the sky or obstruction, the window luminance is

<div>$${L_w} = L{\tau_{vis}}(\cos B)$$</div>

where <span>${\tau_{vis}}$</span>is the visible transmittance of the glass for incidence angle *B*.

Exterior obstructions are generally opaque (like fins, overhangs, neighboring buildings, and the building’s own wall and roof surfaces) but can be transmitting (like a tree or translucent awning). Exterior obstructions are assumed to be non-reflecting. If *L<sub>sky</sub>* is the sky luminance and *t<sub>obs</sub>* is the transmittance of the obstruction (assumed independent of incidence angle), then *L* =* L<sub>sky</sub>t<sub>obs</sub>*. Interior obstructions are assumed to be opaque (*t<sub>obs</sub>* = 0).

#### Shaded Window

For the window-plus-shade case the shade is assumed to be a perfect diffuser, i.e., the luminance of the shade is independent of angle of emission of light, position on shade, and angle of incidence of solar radiation falling on the shade. Closely-woven drapery fabric and translucent roller shades are closer to being perfect diffusers than Venetian blinds or other slatted devices, which usually have non-uniform luminance characteristics.

The calculation of the window luminance with the shade in place, *L<sub>w,sh</sub>*, is described in [Winkelmann, 1983]. The illuminance contribution at the reference point from a shaded window element is then given by Eq. (152) with <span>${L_w} = {L_{w,sh}}$</span>.

### Internally-Reflected Component of Interior Daylight Illuminance

Daylight reaching a reference point after reflection from interior surfaces is calculated using the *split-flux* method [Hopkinson et al., 1954], [Lynes, 1968]. In this method the daylight transmitted by the window is split into two parts—a downward-going flux, <span>${\Phi_{FW}}$</span>(lumens), which falls on the floor and portions of the walls below the imaginary horizontal plane passing through the center of the window (*window midplane*), and an upward-going flux, <span>${\Phi_{CW}}$</span>, that strikes the ceiling and portions of the walls above the window midplane. A fraction of these fluxes is absorbed by the room surfaces. The remainder, the first-reflected flux, *F<sub>1</sub>*, is approximated by

<div>$${F_1} = {\Phi_{FW}}{\rho_{FW}} + {\Phi_{CW}}{\rho_{CW}}$$</div>

where *ρ<sub>FW</sub>* is the area-weighted average reflectance of the floor and those parts of the walls below the window midplane, and *ρ<sub>CW</sub>* is the area-weighted average reflectance of the ceiling and those parts of the walls above the window midplane.

To find the final average internally-reflected illuminance, *E<sub>r</sub>*, on the room surfaces (which in this method is uniform throughout the room) a flux balance is used. The total reflected flux absorbed by the room surfaces (or lost through the windows) is *AE<sub>r</sub>(1-ρ)*, where *A* is the total inside surface area of the floor, walls, ceiling and windows in the room, and *ρ* is the area-weighted average reflectance of the room surfaces, including windows. From conservation of energy

<div>$$A{E_r}(1 - \rho ) = {F_1}$$</div>

or

<div>$${E_r} = \frac{{{\Phi_{FW}}{\rho_{FW}} + {\Phi_{CW}}{\rho_{CW}}}}{{A(1 - \rho )}}$$</div>

This procedure assumes that the room behaves like an integrating sphere with perfectly diffusing interior surfaces and with no internal obstructions. It therefore works best for rooms that are close to cubical in shape, have matte surfaces (which is usually the case), and have no internal partitions. Deviations from these conditions, such as would be the case for rooms whose depth measured from the window-wall is more than three times greater than ceiling height, can lead to substantial inaccuracies in the split-flux calculation.

### Transmitted Flux from Sky and Ground

The luminous flux incident on the center of the window from a luminous element of sky or ground at angular position <span>$(\theta ,\phi )$</span>, of luminance <span>$L(\theta ,\phi )$</span>, and subtending a solid angle <span>$\cos \phi d\theta d\phi $</span> is

<div>$$d{\Phi_{inc}} = {A_w}L(\theta ,\phi )\cos \beta \cos \phi d\theta d\phi $$</div>

The transmitted flux is

<div>$$d\Phi  = d{\Phi_{inc}}T(\beta )$$</div>

where *T(β)* is the window transmittance for light at incidence angle *β*. This transmittance depends on whether or not the window has a shade.

For an unshaded window the total downgoing transmitted flux is obtained by integrating over the part of the exterior hemisphere seen by the window that lies above the window midplane. This gives

<div>$${\Phi_{FW,unshaded}} = {A_w}\int\limits_{{\theta_{\min }}}^{{\theta_{\max }}} {\int\limits_0^{\pi /2} {L(\theta ,\phi )T(\beta )\cos \beta \cos \phi d\theta d\phi } } $$</div>

The upgoing flux is obtained similarly by integrating over the part of the exterior hemisphere that lies below the window midplane:

<div>$${\Phi_{CW,unshaded}} = {A_w}\int\limits_{{\theta_{\min }}}^{{\theta_{\max }}} {\int\limits_{\pi /2 - {\phi_w}}^0 {L(\theta ,\phi )T(\beta )\cos \beta \cos \phi d\theta d\phi } } $$</div>

where <span>${\phi_w}$</span>is the angle the window outward normal makes with the horizontal plane.

For a window with a diffusing shade the total transmitted flux is

<div>$${\Phi_{sh}} = {A_w}\int\limits_{{\theta_{\min }}}^{{\theta_{\max }}} {\int\limits_{\pi /2 - {\phi_w}}^{\pi /2} {L(\theta ,\phi )T(\beta )\cos \beta \cos \phi d\theta d\phi } } $$</div>

The downgoing and upgoing portions of this flux are

<div>$$
  \begin{array}{l}
    \Phi_{FW,sh} = \Phi (1 - f) \\
    \Phi_{CW,sh} = \Phi f
  \end{array}
$$</div>

where *f*, the fraction of the hemisphere seen by the inside of the window that lies above the window midplane, is given by

<div>$$f = 0.5 - {\phi_w}/\pi $$</div>

For a vertical window (<span>${\phi_w} = 0$</span>) the up- and down-going transmitted fluxes are equal:

<span>${\Phi_{FW,sh}} = {\Phi_{CW,sh}} = \Phi /2$</span>.

For a horizontal skylight (<span>${\phi_w} = \pi /2$</span>):

<div>$${\Phi_{FW,sh}} = \Phi ,{\Phi_{CW,sh}} = 0$$</div>

The limits of integration of *θ* in Equations (153), (154) and (155) depend on <span>$\phi $</span>. From [Figure # 12 - Winkelmann, 1983] we have

<div>$$\sin \alpha  = \sin (A - \pi /2) = \frac{{\sin \phi \tan {\phi_w}}}{{\cos \phi }}$$</div>

which gives

<div>$$A = {\cos ^{ - 1}}(\tan \phi \tan {\phi_w})$$</div>

Thus

<div>$$
  \begin{array}{l}
    \theta_{min} &=  - \left| \cos^{-1}(-\tan\phi\tan\phi_w) \right| \\
    \theta_{max} &= \left| \cos^{-1}(-\tan\phi\tan\phi_w) \right| 
  \end{array}
$$</div>

### Transmitted Flux from Direct Sun

The flux incident on the window from direct sun is

<div>$${\Phi_{inc}} = {A_w}{E_{DN}}\cos \beta {f_{sunlit}}$$</div>

The transmitted flux is

<div>$$\Phi  = T(\beta ){\Phi_{inc}}$$</div>

where T is the net transmittance of the window glazing (plus shade, if present).

For an unshaded window all of the transmitted flux is downward since the sun always lies above the window midplane. Therefore

<div>$$
  \begin{array}{l}
    \Phi_{FW,unsh} = \Phi \\
    \Phi_{CW,unsh} = 0
  \end{array}
$$</div>

For a window with a diffusing shade

<div>$$
  \begin{array}{l}
    \Phi_{FW,sh} = \Phi (1 - f) \\
    \Phi_{CW,sh} = \Phi f
  \end{array}
$$</div>

### Luminance of Shaded Window

The luminance of a shaded window is determined at the same time that the transmitted flux is calculated. It is given by

<div>$${L_{sh}} = \frac{1}{\pi }\int\limits_{{\theta_{\min }}}^{{\theta_{\max }}} {\int\limits_{\pi /2 - {\phi_w}}^{\pi /2} {L(\theta ,\phi )T(\beta )\cos \beta \cos \phi d\theta d\phi } } $$</div>

### Daylight Discomfort Glare

The discomfort glare at a reference point due to luminance contrast between a window and the interior surfaces surrounding the window is given by [Hopkinson, 1970] and [Hopkinson, 1972]:

<div>$$G = \frac{{L_w^{1.6}{\Omega ^{0.8}}}}{{{L_b} + 0.07{\omega ^{0.5}}{L_w}}}$$</div>

where

*G* = discomfort glare constant

*L<sub>w</sub>* = average luminance of the window as seen from the reference point

*Ω* = solid angle subtended by window, modified to take direction of occupant view into account

*L<sub>b</sub>* = luminance of the background area surrounding the window

By dividing the window into *N<sub>x</sub>* by *N<sub>y</sub>* rectangular elements, as is done for calculating the direct component of interior illuminance, we have

<div>$${L_w} = \frac{{\sum\limits_{j = 1}^{{N_y}} {\sum\limits_{i = 1}^{{N_x}} {{L_w}(i,j)} } }}{{{N_x}{N_y}}}$$</div>

where *L<sub>w</sub>(i,j)* is the luminance of element* (i,j)* as seen from the reference point.

Similarly,

<div>$$\omega  = \sum\limits_{j = 1}^{{N_y}} {\sum\limits_{i = 1}^{{N_x}} {d\omega (i,j)} } $$</div>

where *dω(i,j)* is the solid angle subtended by element* (i,j)*with respect to the reference point.

The modified solid angle is

 <span>$\Omega  = \sum\limits_{j = 1}^{{N_y}} {\sum\limits_{i = 1}^{{N_x}} {d\omega (i,j)} } p({x_R},{y_R})$</span>

where p is a “position factor” [Petherbridge & Longmore, 1954] that accounts for the decrease in visual excitation as the luminous element moves away from the line of sight. This factor depends on the horizontal and vertical displacement ratios, *x<sub>R</sub>* and *y<sub>R</sub>* (Figure 59),  given by

<div>$$
  \begin{array}{rl}
    x_R(i,j) &= \frac{\sqrt{A^2-(YD)^2}}{RR} \\
    y_R(i,j) &= \left|YD/RR\right|
  \end{array}
$$</div>

where

<div>$$
  \begin{array}{rl}
    RR &= D (\hat{R}_{ray}\cdot\hat{v}_{view}) \\
    A^2 &= D^2 - (RR)^2 \\
    YD = R_{win}(3) - R_{ref}(3)
  \end{array}
$$</div>

![GeomGlare](EngineeringReference/media/image794.png)

Figure 59.  Geometry for calculation of displacement ratios used in the glare formula.

The factor *p* can be obtained from graphs given in [Petherbridge & Longmore, 1954] or it can be calculated from tabulated values of *p<sub>H</sub>*, the Hopkinson position factor [Hopkinson, 1966], since <span>$p = p_H^{1.25}$</span>. The values resulting from the latter approach are given in Table 26. Interpolation of this table is used in EnergyPlus to evaluate *p* at intermediate values of *x<sub>R</sub>* and *y<sub>R</sub>*.

Table 26.  Position factor for glare calculation

<table class="table table-striped">
 <tr>
  <th colspan="2" rowspan="2"></th>
  <th colspan="8">X<sub>R</sub>: Horizontal Displacement Factor</th>
 </tr>
 <tr>
  <th>0.0</th>
  <th>0.5</th>
  <th>1.0</th>
  <th>1.5</th>
  <th>2.0</th>
  <th>2.5</th>
  <th>3.0</th>
  <th>&gt;3.0</th>
 </tr>
 <tr>
  <th rowspan="6">y<sub>R</sub>: Vertical Displacement Factor</th>
  <th>0</th>
  <td>1.00</td>
  <td>0.492</td>
  <td>0.226</td>
  <td>0.128</td>
  <td>0.081</td>
  <td>0.061</td>
  <td>0.057</td>
  <td>0</td>
 </tr>
 <tr>
  <th>0.5</th>
  <td>0.123</td>
  <td>0.119</td>
  <td>0.065</td>
  <td>0.043</td>
  <td>0.029</td>
  <td>0.026</td>
  <td>0.023</td>
  <td>0</td>
 </tr>
 <tr>
  <th>1.0</th>
  <td>0.019</td>
  <td>0.026</td>
  <td>0.019</td>
  <td>0.016</td>
  <td>0.014</td>
  <td>0.011</td>
  <td>0.011</td>
  <td>0</td>
 </tr>
 <tr>
  <th>1.5</th>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.006</td>
  <td>0.006</td>
  <td>0</td>
 </tr>
 <tr>
  <th>2.0</th>
  <td>0</td>
  <td>0</td>
  <td>0.003</td>
  <td>0.003</td>
  <td>0.003</td>
  <td>0.003</td>
  <td>0.003</td>
  <td>0</td>
 </tr>
 <tr>
  <th>&gt;2.0</th>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
  <td>0</td>
 </tr>
 <tr>
  <th>1.5</th>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.008</td>
  <td>0.006</td>
  <td>0.006</td>
  <td>0</td>
 </tr>
</table>

The background luminance is

<div>$${L_b} = {E_b}{\rho_b}$$</div>

where *ρ<sub>b</sub>* is approximated by the average interior surface reflectance of the entire room and

<div>$${E_b} = \max ({E_r},{E_s})$$</div>

where *E<sub>r</sub>*is the total internally-reflected component of daylight illuminance produced by all the windows in the room and *E<sub>s</sub>* is the illuminance setpoint at the reference point at which glare is being calculated. A precise calculation of *E<sub>b</sub>* is not required since the glare index (see next section) is logarithmic. A factor of two variation in *E<sub>b</sub>* generally produces a change of only 0.5 to 1.0 in the glare index.

#### Glare Index

The net daylight glare at a reference point due to all of the windows in a room is expressed in terms of a *glare index* given by

<div>$${G_I} = 10{\log_{10}}\sum\limits_{i = 1}^{\scriptstyle{\rm{number of}}\atop\scriptstyle{\rm{windows}}} {{{\rm{G}}_{\rm{i}}}} $$</div>

where *G<sub>i</sub>* is the glare constant at the reference point due to the *i<sup>th</sup>* window

Time-Step Daylighting Calculation
---------------------------------

### Overview

A daylighting calculation is performed each time step that the sun is up for each zone that has one or two daylighting reference points specified. The exterior horizontal illuminance from the sun and sky is determined from solar irradiance data from the weather file. The interior illuminance at each reference point is found for each window by interpolating the daylight illuminance factors for the current sun position, then, for sky-related interior illuminance, multiplying by the exterior horizontal illuminance from the appropriate sky types that time step, and, for sun-related interior illuminance, multiplying by the exterior horizontal solar illuminance that time step. By summation, the net illuminance and glare due to all of the windows in a zone are found. If glare control has been specified window shading (by movable shading devices or switchable glazing) is deployed to reduce glare. Finally the illuminance at each reference point for the final window and shade configuration is used by the lighting control system simulation to determine the electric lighting power required to meet the illuminance setpoint at each reference point.

Table 27.  Variables in Time-Step Calculations

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
<th>Units</th>
<th>FORTRAN variable</th>
</tr>
<tr>
<td>S<sub>norm,dir</sub></td>
<td>Direct normal solar irradiance</td>
<td>W/m<sup>2</sup></td>
<td>BeamSolarRad</td>
</tr>
<tr>
<td>S<sub>h,dif</sub></td>
<td>Exterior diffuse horizontal solar irradiance</td>
<td>W/m<sup>2</sup></td>
<td>SDIFH, DifSolarRad</td>
</tr>
<tr>
<td>S<sub>h,dir</sub></td>
<td>Exterior direct horizontal solar irradiance</td>
<td>W/m<sup>2</sup></td>
<td>SDIRH</td>
</tr>
<tr>
<td>Z</td>
<td>Solar zenith angle</td>
<td>radians</td>
<td>Zeta</td>
</tr>
<tr>
<td>m</td>
<td>Relative optical air mass</td>
<td>-</td>
<td>AirMass</td>
</tr>
<tr>
<td>Δ</td>
<td>Sky brightness</td>
<td>-</td>
<td>SkyBrightness</td>
</tr>
<tr>
<td>ε</td>
<td>Sky clearness</td>
<td>-</td>
<td>SkyClearness</td>
</tr>
<tr>
<td>k, k’</td>
<td>Sky type index</td>
<td>-</td>
<td>ISky</td>
</tr>
<tr>
<td>s<sub>k,k’</sub></td>
<td>Interpolation factor for skies k and k’</td>
<td>-</td>
<td>SkyWeight</td>
</tr>
<tr>
<td>ψ<sub>k,k’</sub></td>
<td>Sky luminance distribution formed from linear interpolation of skies k and k’</td>
<td>cd/m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>f<sub>k</sub></td>
<td>Fraction of sky that is type k</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>E<sub>h,k</sub></td>
<td>Horizontal illuminance from sky type k</td>
<td>cd/m<sup>2</sup></td>
<td>HorIllSky</td>
</tr>
<tr>
<td>E<sub>h,sky</sub></td>
<td>Exterior horizontal illuminance from sky</td>
<td>lux</td>
<td>HISKF</td>
</tr>
<tr>
<td>E<sub>h,sun</sub></td>
<td>Exterior horizontal illuminance from sun</td>
<td>lux</td>
<td>HISUNF</td>
</tr>
<tr>
<td>η<sub>dif</sub>, η<sub>dir</sub></td>
<td>Luminous efficacy of diffuse and direct solar radiation</td>
<td>lm/W</td>
<td>DiffLumEff, DirLumEff</td>
</tr>
<tr>
<td>I<sub>win</sub></td>
<td>Interior illuminance from a window</td>
<td>lux</td>
<td>DaylIllum</td>
</tr>
<tr>
<td>S<sub>win</sub></td>
<td>Window luminance</td>
<td>cd/m<sup>2</sup></td>
<td>SourceLumFromWinAtRefPt</td>
</tr>
<tr>
<td>B<sub>win</sub></td>
<td>Window background luminance</td>
<td>cd/m<sup>2</sup></td>
<td>BACLUM</td>
</tr>
<tr>
<td>d<sub>sun</sub>, d<sub>sky,k</sub></td>
<td>Interior illuminance factor for sun, for sky of type k</td>
<td>-</td>
<td>DaylIllFacSun, DFSUHR, DaylIllFacSky, DFSUHR</td>
</tr>
<tr>
<td>w<sub>sun</sub>, w<sub>sky,k</sub></td>
<td>Window luminance factor for sun, for sky of type k</td>
<td>-</td>
<td>DaylSourceFacSun, SFSUHR, DaylSourceFacSky, SFSKHR</td>
</tr>
<tr>
<td>b<sub>sun</sub>, b<sub>sky,k</sub></td>
<td>Window background luminance factor for sun, for sky of type k</td>
<td>-</td>
<td>DaylBackFacSun, BFSUHR, DaylBackFacSky, BFSKHR</td>
</tr>
<tr>
<td>w<sub>j</sub></td>
<td>Weighting factor for time step interpolation</td>
<td>-</td>
<td>WeightNow</td>
</tr>
<tr>
<td>i<sub>L</sub></td>
<td>Reference point index</td>
<td>-</td>
<td>IL</td>
</tr>
<tr>
<td>i<sub>S</sub></td>
<td>Window shade index</td>
<td>-</td>
<td>IS</td>
</tr>
<tr>
<td>I<sub>tot</sub></td>
<td>Total daylight illuminance at reference point</td>
<td>lux</td>
<td>DaylIllum</td>
</tr>
<tr>
<td>B<sub>tot</sub>, B</td>
<td>Total window background luminance</td>
<td>cd/m<sup>2</sup></td>
<td>BLUM</td>
</tr>
<tr>
<td>I<sub>set</sub></td>
<td>Illuminance setpoint</td>
<td>lux</td>
<td>ZoneDaylight%IllumSetPoint</td>
</tr>
<tr>
<td>f<sub>L</sub></td>
<td>Fractional electric lighting output</td>
<td>-</td>
<td>FL</td>
</tr>
<tr>
<td>f<sub>P</sub></td>
<td>Fractional electric lighting input power</td>
<td>-</td>
<td>FP</td>
</tr>
<tr>
<td>N<sub>L</sub></td>
<td>Number of steps in a stepped control system</td>
<td>-</td>
<td>LightControlSteps</td>
</tr>
<tr>
<td>M<sub>P</sub></td>
<td>Lighting power multiplier</td>
<td>-</td>
<td>ZonePowerReductionFactor</td>
</tr>

</table>



### Time-Step Sky Luminance

The sky luminance distribution, *ψ*, for a particular time step is expressed as a linear interpolation of two of the four standard skies — *ψ<sub>cs</sub>*, *ψ<sub>ts</sub>* , *ψ<sub>is</sub>* and *ψ<sub>os</sub>* — described above under “Sky Luminance Distributions.” The two sky types that are interpolated depend on the value of the sky clearness. The interpolation factors are a function of sky clearness and sky brightness (Perez et al., 1990). Sky clearness is given by

<div>$$\varepsilon  = \frac{{\frac{{{S_{h,dif}} + {S_{norm,dir}}}}{{{S_{h,dif}}}} + \kappa {Z^3}}}{{1 + \kappa {Z^3}}}$$</div>

where *S<sub>h,dif</sub>* is the diffuse horizontal solar irradiance, *S<sub>norm,dir</sub>*is the direct normal solar irradiance, *Z* is the solar zenith angle and *κ* is a constant equal to 1.041 for *Z* in radians.

Sky brightness is given by

<div>$$\Delta  = {S_{h,dif}}m/S_{norm,dir}^{ext}$$</div>

where *m* is the relative optical air mass and <span>$S_{norm,dir}^{ext}$</span>is the extraterrestrial direct normal solar irradiance.

If *ε* ≤ 1.2

<div>$${\psi_{is,os}} = {s_{is,os}}{\psi_{is}} + (1 - {s_{is,os}}){\psi_{os}}$$</div>

where *ψ<sub>is</sub>* is the intermediate sky luminance distribution, *ψ<sub>os</sub>* is the overcast sky luminance distribution, and

<div>$${s_{is,os}} = \min \{ 1,\max [0,(\varepsilon  - 1)/0.2,(\Delta  - 0.05)/0.4]\} $$</div>

If 1.2&lt;*ε* ≤ 3

<div>$${\psi_{ts,is}} = {s_{ts,is}}{\psi_{ts}} + (1 - {s_{ts,is}}){\psi_{is}}$$</div>

where *ψ<sub>ts</sub>* is the clear turbid sky luminance distribution and

<div>$${s_{ts,is}} = (\varepsilon  - 1.2)/1.8$$</div>

If *ε* &gt; 3

<div>$${\psi_{cs,ts}} = {s_{cs,ts}}{\psi_{cs}} + (1 - {s_{cs,ts}}){\psi_{ts}}$$</div>

where *ψ<sub>cs</sub>* is the clear sky luminance distribution and

<div>$${s_{cs,ts}} = \min [1,(\varepsilon  - 3)/3]$$</div>

### Interior Illuminance

For each time step the interior illuminance, *I<sub>win</sub>*, from a window is calculated as follows by multiplying daylight factors and exterior illuminance.

First, the sun- and sky-related daylight illuminance factors for the time step are determined by interpolation of the hourly factors:

<div>$${\bar d_{sun}}({i_L},{i_S}) = {w_j}{d_{sun}}({i_L},{i_S},{i_h}) + (1 - {w_j}){d_{sun}}({i_L},{i_S},{i_h} + 1)$$</div>

<div>$${\bar d_{sky,k}}({i_L},{i_S}) = {w_j}{d_{sky,k}}({i_L},{i_S},{i_h}) + (1 - {w_j}){d_{sky,k}}({i_L},{i_S},{i_h} + 1)$$</div>

where *i<sub>L</sub>* is the reference point index (1 or 2), *i<sub>S</sub>* is the window shade index (1 for unshaded window, 2 for shaded window),* i<sub>h</sub>* is the hour number, and *k* is the sky type index. For the* j*th time step in an hour, the time-step interpolation weight is given by

<div>$${w_j} = 1 - \min [1,j/{N_t}]$$</div>

where *N<sub>t</sub>* is the number of  time steps per hour.

The interior illuminance from a window is calculated as

<div>$${I_{win}}({i_L},{i_S}) = {\bar d_{sun}}{E_{h,sun}} + [{\bar d_{sky,k}}({i_L},{i_S}){f_k} + {\bar d_{sky,k'}}({i_L},{i_S}){f_{k'}}]{E_{h,sky}}$$</div>

where *E<sub>h,sun</sub>* and *E<sub>h,sky</sub>* are the exterior horizontal illuminance from the sun and sky, respectively, and *f<sub>k</sub>* and *f<sub>k’</sub>* are the fraction of the exterior horizontal illuminance from the sky that is due to sky type *k* and *k’*, respectively.

The horizontal illuminance from sun and sky are given by

<div>$$
  \begin{array}{rl}
    E_{h,sun} &= \eta_{dir} S_{norm,dir} \cos Z \\
    E_{h,sky} &= \eta_{dif} S_{h,dif}
  \end{array}
$$</div>

where *Z* is the solar zenith angle,  *η<sub>dif</sub>* is the luminous efficacy (in lumens/Watt) of diffuse solar radiation from the sky and *η<sub>dir</sub>* is the luminous efficacy of direct radiation from the sun. The efficacies are calculated from direct and global solar irradiance using a method described in (Perez et al, 1990).

The fractions *f<sub>k</sub>* and *f<sub>k’</sub>* are given by

<div>$$
  \begin{array}{rl}
    f_k    &= \frac{ s_{k,k'} E_{h,k} } { s_{k,k'} E_{h,k} + (1 - s_{k,k'})E_{h,k'}} \\
    f_{k'} &= \frac{ (1 - s_{k,k'} ) E_{h,k'} } { s_{k,k'} E_{h,k} + (1 - s_{k,k'} ) E_{h,k'}}
  \end{array}
$$</div>

where *E<sub>h,k</sub>* and *E<sub>h,k’</sub>* are the horizontal illuminances from skies *k* and *k’*, respectively (see “Exterior Horizontal Luminance,” above), and *s<sub>k,k’</sub>* is the interpolation factor for skies *k*and *k’*(see “Time-Step Sky Luminance,” above).  For example, if  *ε* &gt; 3, *k*= *cs* (clear sky), *k’* = *ts* (clear turbid sky) and

 <span>$s_{k,k'} = s_{cs,ts} = \min [1,(\varepsilon  - 3)/3]$</span>

Similarly, the window source luminance, *S<sub>win</sub>*, and window background luminance, *B<sub>win</sub>*, for a window are calculated from

<div>$${S_{win}}({i_L},{i_S}) = {\bar w_{sun}}{E_{h,sun}} + [{\bar w_{sky,k}}({i_L},{i_S}){f_k} + {\bar w_{sky,k'}}({i_L},{i_S}){f_{k'}}]{E_{h,sky}}$$</div>

<div>$${B_{win}}({i_L},{i_S}) = {\bar b_{sun}}{E_{h,sun}} + [{\bar b_{sky,k}}({i_L},{i_S}){f_k} + {\bar b_{sky,k'}}({i_L},{i_S}){f_{k'}}]{E_{h,sky}}$$</div>

The total illuminance at a reference point from all of the exterior windows in a zone is

<div>$${I_{tot}}({i_L}) = \sum\limits_{\scriptstyle{\rm{windows}}\atop\scriptstyle{\rm{in zone}}} {{I_{win}}({i_s},{i_L})} $$</div>

where* i<sub>S</sub>* = 1 if the window is unshaded and *i<sub>S</sub>* = 2 if the window is shaded that time step. (Before the illuminance calculation is done the window shading control will have been simulated to determine whether or not the window is shaded.)

Similarly, the total background luminance is calculated:

<div>$${B_{tot}}({i_L}) = \sum\limits_{\scriptstyle{\rm{windows}}\atop\scriptstyle{\rm{in zone}}} {{B_{win}}({i_s},{i_L})} $$</div>

### Glare Index

The net glare index at each reference point is calculated as

<div>$${G_I}({i_L}) = 10{\log_{10}}\sum\limits_{\scriptstyle{\rm{windows}}\atop\scriptstyle{\rm{in zone}}} {\frac{{{S_{win}}{{({i_L},{i_S})}^{1.6}}\Omega {{({i_L})}^{0.8}}}}{{B({i_L}) + 0.07\omega {{({i_L})}^{0.5}}{S_{win}}({i_L},{i_S})}}} $$</div>

where

<div>$$B\left( {{i_L}} \right) = max\left( {{B_{win}}\left( {{i_L}} \right),{\rho_b}{I_{set}}\left( {{i_L}} \right)} \right)$$</div>

In the last relationship, the background luminance is approximated as the larger of the background luminance from daylight and the average background luminance that would be produced by the electric lighting at full power if the illuminance on the room surfaces were equal to the setpoint illuminance. In a more detailed calculation, where the luminance of each room surface is separately determined, *B(i<sub>L</sub>)* would be better approximated as an area-weighted luminance of the surfaces surrounding a window, taking into account the luminance contribution from the electric lights.

#### Glare Control Logic

If glare control has been specified and the glare index at either reference point exceeds a user-specified maximum value, *G<sub>I,max</sub>*, then the windows in the zone are shaded one by one in attempt to bring the glare at both points below *G<sub>I,max</sub>*. (Each time a window is shaded the glare and illuminance at each reference point is recalculated.) The following logic is used:

5)   If there is only one reference point, shade a window if it is unshaded and shading it decreases the glare, even if it does not decrease the glare below *G<sub>I,max</sub>*. Note that if a window  has already been shaded, say to control solar gain, it will be left in the shaded state.

6)   If there are two reference points, then:

  * If glare is too high at both points, shade the window if it decreases glare at both points.

  * If glare is too high only at the first point, shade the window if the glare at the first point decreases, and the glare at the second point stays below *G<sub>I,max</sub>*.

  * If glare is too high only at the second point, shade the window if the glare at the second point decreases, and the glare at the first point stays below *G<sub>I,max</sub>*.

7)   Shades are closed in the order of window input until glare at both points is below *G<sub>I,max</sub>*, or until there are no more windows left to shade.

### Lighting Control System Simulation

Once the final daylight illuminance value at each reference point has been determined, the electric lighting control is simulated. The fractional electric lighting output, *f<sub>L</sub>*, required to meet the setpoint at reference point *i<sub>L</sub>* is given by

<div>$${f_L}({i_L}) = {\rm{max}}\left[ {0,\frac{{{I_{set}}({i_L}) - {I_{tot}}({i_L})}}{{{I_{set}}({i_L})}}} \right]$$</div>

Here, *I<sub>set</sub>* is the illuminance setpoint and *I<sub>tot</sub>* is the daylight illuminance at the reference point. This relationship assumes that the electric lights at full power produce an illuminance equal to *I<sub>set</sub>* at the reference point.

The fractional electric lighting input power, *f<sub>P</sub>*, corresponding to *f<sub>L</sub>* is then calculated. The relationship between *f<sub>P</sub>* and *f<sub>L</sub>* depends on the lighting control type.

#### Continuous Dimming Control

For a continuously-dimmable control system, it is assumed that *f<sub>P</sub>* is constant and equal to *f<sub>P,min</sub>*for *f<sub>L</sub>&lt;f<sub>L,min</sub>* and that f<sub>P</sub> increases linearly from *f<sub>P,min</sub>* to 1.0 as *f<sub>L</sub>* increases from *f<sub>L,min</sub>* to 1.0 (Figure 60). This gives

<div>$${f_P} = \left\{ \begin{array}{l}{f_{P,\min }} & {\rm{for }}{f_L} < {f_{L,\min }}\\\frac{{{f_L} + (1 - {f_L}){f_{P,\min }} - {f_{L,\min }}}}{{1 - {f_{L,\min }}}}\end{array} \right.{\rm{   for }}{f_{L,\min }} \le {f_L} \le 1$$</div>

![](EngineeringReference/media/image823.png)

Figure 60.  Control action for a continuous dimming system.

#### Continuous/Off Dimming Control

A “continuous/off” dimming system has the same behavior as a continuous dimming system except that the lights switch off for *f<sub>L</sub> &lt; f<sub>L,min</sub>* rather than staying at *f<sub>P,min</sub>*.

#### Stepped Control

For a stepped control system, *f<sub>P</sub>* takes on discrete values depending on the range of *f<sub>L</sub>*and the number of steps, *N<sub>L</sub>*<sub> </sub> (Figure 61). This gives

<div>$${f_P} = \left\{ \begin{array}{l}0, & {\rm{if }}{f_L} = 0\\\frac{{{\mathop{\rm int}} ({N_L}{f_L}) + 1}}{{{N_L}}}, & {\rm{for }}0 < {f_L} < 1\\1, & {\rm{if }}{f_L} = 1\end{array} \right.$$</div>

If a lighting control probability,* p<sub>L</sub>*, is specified,* f<sub>P</sub>* is set one level higher a fraction of the time equal to *1-p<sub>L</sub>*. Specifically, if* f<sub>P</sub>* &lt;1,* f<sub>P</sub>*à* f<sub>P</sub>*+ 1/*N<sub>L</sub>* if a random number between 0 and 1 exceeds *p<sub>L</sub>*. This can be used to simulate the uncertainty associated with manual switching of lights.

![](EngineeringReference/media/image825.png)

Figure 61.  Stepped lighting control with three steps.

#### Lighting Power Reduction

Using the value of *f<sub>P</sub>*at each reference point and the fraction *f<sub>Z</sub>* of the zone controlled by the reference point, the net lighting power multiplier, *M<sub>P</sub>*, for the entire zone is calculated; this value multiplies the lighting power output without daylighting.

<div>$${M_P} = \sum\limits_{{i_L} = 1}^2 {{f_P}({i_L})} {f_Z}({i_L}) + \left( {1 - \sum\limits_{{i_L} = 1}^2 {} {f_Z}({i_L})} \right)$$</div>

In this expression, the term to the right in the parentheses corresponds to the fraction of the zone not controlled by either reference point. For this fraction the electric lighting is unaffected and the power multiplier is 1.0.

### References

CIE Technical Committee 4.2. 1973. Standardization of the Luminance Distribution on Clear Skies. CIE Pub. No. 22, Commission Internationale d’Eclairage, Paris.

Hopkinson, R.G., J. Longmore and P. Petherbridge. 1954. An Empirical Formula for the Computation of the Indirect Component of Daylight Factors. Trans. Illum. Eng. Soc. (London) 19, 201.

Hopkinson, R.G., P. Petherbridge and J. Longmore. 1966. Daylighting. Heinnemann, London, p. 322.

Hopkinson, R.G. 1970. Glare from Windows. Construction Research and Development Journal 2, 98.

Hopkinson, R.G. 1972. Glare from Daylighting in Buildings. Applied Ergonomics 3, 206.

Kittler, R. 1965. Standardization of Outdoor Conditions for the Calculation of the Daylight Factor with Clear Skies. Proc. CIE Inter-Session Meeting on Sunlight, Newcastle-Upon-Tyne.

Lynes, J.A. 1968. Principles of Natural Lighting. Applied Science Publishers, Ltd., London, p. 129.

Matsuura, K. 1987. Luminance Distributions of Various Reference Skies. CIE Technical Report of TC 3-09.

Moon, P. and D. Spencer. 1942. Illumination from a Nonuniform Sky. Illuminating Engineering 37, 707-726.



------------------------------------------------------------------------

[[1]](#_ftnref1) For beam incident on an exterior window we have the following: For transparent glass with no shade or blind there is only beam-to-beam transmission. For diffusing glass, or if a window shade is in place, there is only beam-to-diffuse transmission. If a window blind is in place there is beam-to-diffuse transmission, and, depending on slat angle, solar profile angle, etc., there can also be beam-to-beam transmission.

[[2]](#_ftnref2) See “Beam Solar Reflection from Window Reveal Surfaces.”

[[3]](#_ftnref3) If Solar Distribution = FullInteriorAndExterior in the Building object, the program calculates where beam solar from exterior windows falls inside the zone. Otherwise, all beam solar is assumed to fall on the floor.

[[4]](#_ftnref4) For the purposes of the surface heat balance calculation, any beam solar radiation absorbed by a surface is assumed to be uniformly distributed over the surface even though in reality it is likely to be concentrated in one or more discrete patches on the surface.

[[5]](#_ftnref5) *TBm<sub>i</sub>*<sub></sub>is zero if the window has diffusing glass or a shade. *TBm<sub>i</sub>* can be &gt; 0 if a blind is present and the slat angle, solar profile angle, etc., are such that some beam passes between the slats.

[[6]](#_ftnref6) A different method from that described here is used for calculating reflections from daylighting shelves (see “Daylighting Shelves”).

[[7]](#_ftnref7) The ground surface is assumed to be diffusely reflecting so there is no specular reflection from the ground. The program could be improved by adding a ground surface specular component, which could be important for snow-cover conditions.

[[8]](#_ftnref8) The sun positions for which the daylight factors are calculated are the same as those for which the solar shadowing calculations are done.



Perez, R., P. Ineichen, R. Seals, J. Michalsky and R. Stewart. 1990. Modeling Daylight Availability and Irradiance Components from Direct and Global Irradiance. Solar Energy 44, 271-289.

Petherbridge, P. and J. Longmore. 1954. Solid Angles Applied to Visual Comfort Problems. Light and Lighting 47,173.

Winkelmann, F.C.  1983. Daylighting Calculation in DOE-2*.* Lawrence Berkeley Laboratory report no. LBL-11353, January 1983.

Winkelmann, F.C. and S. Selkowitz. 1985. Daylighting Simulation in the DOE-2 Building Energy Analysis Program*.* Energy and Buildings 8, 271-286.

DElight Daylighting Calculations
--------------------------------

The Daylighting:DELight series of input objects provide an alternative daylighting model.  The DElight method of analyzing daylighting applies to both simple apertures (i.e., windows and skylights) and complex fenestration systems that include geometrically complicated shading (e.g., roof monitors) and/or optically complicated glazings (e.g., prismatic or holographic glass).  The DElight daylighting calculation methods are derived from the daylighting calculations in DOE-2.1E (as are the models accessed with Daylighting:Controls input object), and Superlite, with several key modifications.  The engineering documentation included here focuses on the details of these differences from methods documented elsewhere.  For the details of the heritage calculations, refer to the section in this documentation entitled “Daylighting Calculations” and to [Winkelmann, 1983], [Winkelmann and Selkowitz, 1985], and  [Modest, 1982].

For each point in time, DElight calculates the interior daylighting illuminance at user specified reference points and then determines how much the electric lighting can be reduced while still achieving a combined daylighting and electric lighting illuminance target.  The daylight illuminance level in a zone depends on many factors, including exterior light sources; location, size, and visible light transmittance of simple and complex fenestration systems; reflectance of interior surfaces; and location of reference points. The subsequent reduction of electric lighting depends on daylight illuminance level, design illuminance setpoint, fraction of zone controlled by reference point, and type of lighting control.

The DElight daylighting calculation has three main steps:

1.    *Daylight Factor Calculation:*  Daylight factors, which are ratios of interior illuminance to exterior horizontal illuminance, are pre-calculated and stored for later use. The user spcifies the coordinates of one or more reference points in each daylit zone. DElight first calculates the contribution of light transmitted through all simple and complex fenestration systems in the zone to the illuminance at each reference point, and to the luminance at subdivided nodal patches of interior surfaces, for a given exterior luminous environment (including sky, sun, and exterior reflecting surfaces).  The effect of inter-reflection of this initial light between interior reflecting surfaces is then calculated, resulting in a final total illuminance at each reference point.  This total illuminace is then divided by the exterior horizontal illuminance for the given exterior environment to give a daylight factor.  Daylight factors are calculated for each reference point, for a set of sun positions and sky conditions that are representative of the building location.

2.    *Time-Step Interior Daylighting Calculation*:  A daylighting calculation is performed for each heat-balance time step when the sun is up. In this calculation the illuminance at the reference points in each zone is found by interpolating the stored daylight factors using the current time step sun position and sky condition, then multiplying by the exterior horizontal illuminance.

3.    *Electric Lighting Control Calculation*:  The electric lighting control system is simulated to determine the proportion of lighting energy needed to make up the difference between the daylighting illuminance level at the given time step, and the design illuminance level. Finally, the zone lighting electric reduction factor is passed to the thermal calculation, which uses this factor to reduce the heat gain from lights.

### DElight Daylight Factor Calculation Differences from EnergyPlus Detailed Methods

* *Initial Interior Illuminance/Luminance Calculation:*  DElight calculates the total initial contribution of light transmitted through all simple fenestration systems (i.e., windows and skylights) in the zone to the illuminance at each reference point, and to the luminance at each gridded nodal patch of interior surfaces.  This differs from the models behind the “Daylighting:Controls” object (henceforth referred to as “EnergyPlus Detailed”) in two ways. The first is that EnergyPlus Detailed calculates initial illuminace values at reference points for each pair of reference point and aperture (window/skylight) in the zone, whereas DElight calculates the total contribution from all apertures to each reference point.  The second difference from EnergyPlus Detailed is that the initial luminance of interior surface nodal patches is calculated to support the inter-reflection calculation described below.  This calculation uses the same formula as EnergyPlus Detailed modified for arbitrarily oriented surfaces (i.e., non-horizontal), and to calculate luminance rather than illuminance.  Note however, DElight does not account for interior surface obstructions (e.g., partitions) in this initial interior illuminance/luminance distribution.  The EnergyPlus Detailed method does account for interior surface obstruction of initial illuminance distribution on reference points.

* *Reference Points:*  DElight allows up to 100 reference points to be arbitrarily positioned with a daylighting zone.  At this time all reference points are assumed to be oriented on a horizontal virtual surface “facing” toward the zenith and “seeing” the hemisphere above the horizontal plane.

* *Complex Fenestration System Calculation:*  DElight calculates the contribution to the initial interior illuminance at each reference point, and to the luminance at each gridded nodal patch of interior surfaces, of the light transmitted by complex fenestration systems (CFS).  The analysis of a CFS within DElight is based on the characterization of the system using bi-directional transmittance distribution functions (BTDF), which must be either pre-calculated (e.g., using ray-tracing techniques) or pre-measured, prior to analysis by DElight.  A BTDF is a set of data for a given CFS, which gives the ratios of incident to transmitted light for a range of incoming and outgoing directions.  As illustrated in Figure 62, a BTDF can be thought of as collapsing a CFS to a “black box” that is represented geometrically as a flat two-dimensional light-transmitting surface that will be treated as an aperture surface in the daylit zone description. For each incoming direction across the exterior hemisphere of the CFS, varying portions of that light are transmitted at multiple outgoing directions across the interior hemisphere of the CFS.  The two-dimensional CFS “surface” and directional hemispheres are “abstract” in that they may not literally correspond to actual CFS component geometric details.

![](EngineeringReference/media/image827.png)

Figure 62.  Bi-Directional Transmittance Data.

The pre-calculated or pre-measured BTDF for a CFS is independent of its final position and orientation within a building.  Once a specific instance of a CFS aperture has been positioned within a building, the incident light from all exterior sources across the CFS exterior hemisphere can be integrated over all incident directions for each relevant transmitted direction to determine the light transmitted by the CFS surface in that direction. The light transmitted by the CFS aperture is then distributed to surfaces in the zone according to its non-uniform directionality.  The algorithms for this BTDF treatment of CFS in DElight are still under development, and are subject to change in the future.

* *Inter-reflected Interior Illuminance/Luminance Calculation:*  The effect of inter-reflection of the initial interior illuminance/luminance between interior reflecting surfaces is calculated using a radiosity method derived from Superlite [Modest, 1982].  This method subdivides each reflecting surface in the zone into nodal patches and uses view factors between all nodal patch pairs in an iterative calculation of the total contribution of reflected light within the zone.  This method replaces the split-flux method used in EnergyPlus Detailed, resulting in a more accurate calculation of the varied distribution of inter-reflected light throughout the zone.  The ability to input up to 100 reference points supports a more complete assessment of this distribution.  Also, the radiosity method explicitly accounts for interior obstructions between pairs of nodal patches.  The split-flux method used in the EnergyPlus Detailed approach only implicitly accounts for interior surfaces by including their reflectance and surface area in the zone average surface reflectance calculations.

### DElight Time-Step Interior Daylighting Calculation Differences from EnergyPlus Detailed Methods

* *Interior Illuminance Calculation:*  As discussed above, DElight only calculates daylight factors for the total contribution from all windows/skylights and CFS to each defined reference point.  Thus DElight does not support dynamic control of fenestration shading during the subsequent time-step calculations, as does EnergyPlus Detailed.

* *Visual Quality:*  DElight does not currently calculate a measure of visual quality such as glare due to daylighting.  DElight does calculate luminance on nodal patches of all interior, reflecting surfaces.  A variety of visual quality metrics could be calculated from these data in future implementations.

* *Electric Lighting Control Calculation:*  Up to 100 reference points can be defined within a DElight daylighting zone.  One or more of these reference points must be included in the control of the electric lighting system in the zone.  Each reference point input includes the fraction of the zone controlled by that point.  Values of 0.0 are valid, which allows the definition of reference points for which interior illuminance levels are calculated, but which do not control the electric lighting.  Any non-zero fraction is thus the equivalent of a relative weighting given to that reference point’s influence on the overall electric lighting control.  The sum of all fractions for defined reference points must less than or equal to 1.0 for this relative weighting to make physical sense.  If the sum is less than 1.0, the remaining fraction is assumed to have no lighting control.

### References

Modest, M. 1982. A General Model for the Calculation of Daylighting in Interior Spaces, Energy and Buildings 5, 66-79, and Lawrence Berkeley Laboratory report no. LBL-12599A.

Winkelmann, F.C. 1983. Daylighting Calculation in DOE-2*.* Lawrence Berkeley Laboratory report no. LBL-11353, January 1983.

Winkelmann, F.C. and S. Selkowitz. 1985. Daylighting Simulation in the DOE-2 Building Energy Analysis Program*.* Energy and Buildings 8, 271-286.



Complex Fenestration Daylighting Calculations
---------------------------------------------

The complex fenestration systems (CFS) daylighting calculation method results in the same Daylighting Factor style output as the it is described in Daylighting Calculations chapter.

Transmitted solar radiation reaches the daylighting sensor in two different ways. The first is an indirect path when solar radiation is reflected from surfaces and uniformly distributed into the space. The second is a direct path when the sensor is directly illuminated by the fenestration system.

For the indirect path, the method performs a one-bounce calculation to determine the diffuse illumination for the zone. For a certain sky condition, including the sun position, the method will calculate which surfaces are illuminated from each of the BSDF directions, taking into account the reflectance of the surfaces. This indirect illumination is calculated from both direct sunlight hitting a window with or without a shading device and diffuse illumination calculated from diffuse light coming into the zone from the sky or the ground. This transmitted light strikes the zone interior surfaces and creates a diffuse component. The CFS daylighting method determines the contribution of each sky patch to the illumination of the zone surfaces based on the BSDF transmittances and then luminance is calculated based on the surface reflection.

For the direct path, the window is subdivided using existing subdivision procedures. From the center of each subdivided element, the angle is calculated to the reference point. The illuminance is calculated based on the BSDF data for the outgoing direction that corresponds to that angle and the incident illumination from sky, ground and sun.

### Internal Average Reflected Illuminance From Window

To calculate internal average reflected illumiance from the window it is necessary to calculate transmitted flux at the window.  Observing an infinitesimal window element, illuminance can originate from the sky or sun, and in both cases the ray can reach the window directly or after reflecting from the ground.  Based on this, the calculation of luminance at the window is divided into three parts:

* Sky-related illuminance and luminous flux

* Sun-related illuminance and luminous flux, excluding entering beam

* Sun-related illuminance and luminous flux, due to entering beam

where total illuminance will be calculated as a superposition of these three parts.

For any case, illuminace at a window element can be calculated by using the following general approach:

<div>$$dE{W_{at\_window}} = Lu{m_{el}}({\theta_{el}},{\phi_{el}}) \cdot cos({\beta_{el}}) \cdot \cos ({\phi_{el}}) \cdot d{\theta_{el}} \cdot d{\phi_{el}}$$</div>

where <span>$dE{W_{at\_window}}$</span> is the illuminance at a window element, <span>$Lu{m_{el}}({\theta_{el}},{\phi_{el}})$</span> represents the function of horizontal luminance from the exterior element in the direction <span>$({\theta_{el}},{\phi_{el}})$</span>, <span>${\beta_{el}}$</span> represents the angle at which the ray hits the surface of the window and <span>$({\theta_{el}},{\phi_{el}})$</span> represents the exterior element azimuth and altitude relative to the window (see Figure 63).

![](EngineeringReference/media/image834.png)

Figure 63: Exterior Luminance Element

This will produce luminous flux at the interior side of the window:

<div>$$d\phi {W_{inside}} = dE{W_{at\_window}} \cdot \tau ({\beta_{el}}) \cdot dA$$</div>

where <span>$dE{W_{at\_window}}$</span> is given by equation , <span>$\tau ({\beta_{el}})$</span> is the window transmittance at the incoming angle <span>${\beta_{el}}$</span> and <span>$dA$</span> is infinitesimal window element surface area.

Integrating luminous flux given by equation over entire window area will give luminous flux on the interior side of the window.

To calculate the interan average reflected illumiance from the window, a simillar approch will be used as described in the chapter “Internally-Reflected Component of Interior Daylight Illuminance”, which gives the flux balance equation:

<div>$$A \cdot {E_r} \cdot (1 - \rho ) = {F_1}$$</div>

where <span>${F_1}$</span>represents first reflected flux which in the case of non-CFS is calculated by using the split-flux method.  In the case of CFS, first the reflected flux can be calculated more precisely by using light patches area.  Since each CFS is described by a BSDF, it is possible to calculate the light patches for each outgoing direction (see Figure 64).

![](EngineeringReference/media/image842.png)

Figure 64: Complex Fenestration System Light Patches

Considering the total flux passing through the window at the outgoing direction “k”, the first reflect flux (<span>${F_{1,k}}$</span>) can be calculated as:

<div>$${F_{1,k}} = {\phi_k} \cdot \frac{{\sum\limits_{a = 1}^N {({A_{overlap,k,a}} \cdot {\rho_{vis,k,a}})} }}{{\sum\limits_{a = 1}^N {{A_{overlap,k,a}}} }}$$</div>

where <span>${\phi_k}$</span> is the total flux entering the zone at the BSDF outgoing direction “k” and is calculated by integrating equation over the entire window area for a given outgoing direction “k”, N is the number of interior surfaces hit by the BSDF outgoing direction “k” (see Figure 64), <span>${A_{overlap,k,a}}$</span> is the surface (patch) area which the window from the BSDF outgoing direction “k” makes at surface “a” and <span>${\rho_{vis,k,a}}$</span> is the visible reflectance from surface “a”.

Summing all the outgoing directions will result in total first reflected flux:

<div>$${F_1} = \sum\limits_{k = 1}^{{N_{out}}} {{F_{1,k}}} $$</div>

### Luminance from Exterior Elements

The case of CFS luminance from exterior elements can be calculated by using BSDF incoming directions defined for a given CFS.  Applying equation for a certain incoming BSDF direction will give:

<div>$$\Delta E{W_{el,i}} = Lum({\theta_i},{\psi_i}) \cdot \cos ({\beta_i}) \cdot \cos ({\phi_i}) \cdot \Delta {\theta_i} \cdot \Delta {\psi_i}$$</div>

This equation can be translated in the BSDF coordinate system where instead of standard azimuth and altitude angles, the equation will be transformed into the BSDF coordinate system.  In that case, equation becomes:

<div>$$\Delta E{W_{el,i}} = Lum({\theta_i},{\psi_i}) \cdot {\Lambda_i}$$</div>

where <span>${\Lambda_i}$</span>represents the lambda value for the incoming direction “i”.

### Luminous Flux and Direct Illuminance at Interior Side of the Window

In the case of CFS it is of interest to calculate fluxes for each outgoing BSDF direction.  For a given amount of illuminance at an incoming direction “i”, flux into direction “o” will be calculated as:

<div>$$\Delta \phi {W_{i,o}} = \Delta E{W_{el}} \cdot {T_{dir - dir,i,o}}$$</div>

where <span>${T_{dir - dir,i,o}}$</span> is the direct-direct transmittance for given incoming and outgoing directions (“i” and “o”).

![](EngineeringReference/media/image854.png)

Figure 65: Complex Fenestration System Flux Transition - Single Incoming Direction to Single Outgoing Direction

Total flux from the window at the outgoing direction “o” can be calculated by summing over all the incoming directions:

<div>$$\Delta \phi {W_o} = \sum\limits_{i = 1}^{{N_{inc}}} {(\Delta E{W_{el,i}} \cdot {T_{dir - dir,i,o}})} $$</div>

where <span>${N_{inc}}$</span> is the number of BSDF incident directions.

Flux transmitted in the outgoing direction “o”, calculated by equation , can be used for any given distribution of an exterior luminous element.  Knowing the intensity of the luminous flux, the direct illuminance at a certain point is calculated as:

<div>$$E{D_o} = \Delta {\Omega_{el}} \cdot \sin ({\phi_{el}}) \cdot \Delta \phi {W_o}$$</div>

where <span>$E{D_o}$</span> is the direct illuminance at the BSDF outgoing direction “o”, <span>$\Delta {\Omega_{el}}$</span> is the spatial angle of the element viewed from a certain reference point and <span>${\phi_{el}}$</span> is the altitude of the window element viewed from the reference point.

### Handling Exterior Obstructions

Exterior obstructions are handled for two different cases.  The first case is to handle obstructions between the luminous element (sky/ground/sun) and the CFS window element. In that case, the direct illuminance at the window element is modified for the product of all the obstruction transmittances between the luminous and window elements, and equation is modified as:

<div>$$\Delta E{W_{el,i}} = Lum({\theta_i},{\psi_i}) \cdot {\Lambda_i} \cdot \prod\limits_{p = 1}^{{N_o}} {{\tau_{obs,p}}} $$</div>

where <span>${N_o}$</span>  is the number of exterior obstructions and <span>${\tau_{obs,p}}$</span> is the visible transmittance of obstruction “p”.

The second case is to handle all obstructions between the luminous elements and the ground element.  The luminance from the ground element is calculated as:

<div>$$Lu{m_{gnd}} = \frac{{{E_h}}}{\pi } \cdot {\rho_{gnd}}$$</div>

where <span>${E_h}$</span> is the horizontal illuminance and <span>${\rho_{gnd}}$</span> is the ground reflectance.  Horizontal illuminance is obtained by the integration over sky/sun elements and it is of interest to examine if all elements are visible from a certain ground point.  The integration examines if the ray between the sky and the ground element is hitting an obstruction.  It does not take into account whether or not the obstruction is transparent, it simply counts the number of hits.  The sky obstruction multiplier is calculated as:

<div>$$SOM = \frac{{NumberOfUnobstructedRays}}{{NumberOfRays}}$$</div>

and in case the incoming element is from the ground, the illuminance at the window element (equation ) will be additionally modified from the sky obstruction multiplier:

<div>$$\Delta E{W_{el,i}} = Lum({\theta_i},{\psi_i}) \cdot {\Lambda_i} \cdot SOM \cdot \prod\limits_{p = 1}^{{N_o}} {{\tau_{obs,p}}} $$</div>

Daylighting Devices
-------------------

Daylighting devices are used to improve daylighting in a zone.  Besides their contribution to illuminance, daylighting devices also have a thermal impact on the zone heat balance.  As a result the simulation of daylighting devices is tightly integrated into both the daylighting model and the zone heat balance.

There are two types of daylighting device in EnergyPlus:  tubular daylighting devices and daylighting shelves.

### Tubular Daylighting Devices

The input object DaylightingDevice:Tubular provides a special model for fenestration components known as Tubular Daylighting Devices (TDDs), also known as tubular skylights or light pipes.  TDDs are constructed of three components: a dome, a pipe, and a diffuser.

![TubeDevices](EngineeringReference/media/image869.png)

Figure 66.  Tubular Daylighting Devices

The dome is typically a hemisphere made of clear plastic.  It allows daylight into the pipe while keeping exterior weather out.  The pipe is assumed to be a smooth cylinder with a highly reflective inside surface.  The surface is usually either bare polished metal or a special reflective sheet adhered to the inside.  The pipe channels the daylight from the dome to the diffuser via multiple internal reflections.  The diffuser is typically a flat frosted plastic cover.  The diffuser evenly distributes the daylight to the zone.  The dome/diffuser area and pipe area must be approximately equal (within 2%) for running the simulation successfully.

In EnergyPlus the TDD model includes three different, but related, phenomena:

* Daylighting

* Solar gains

* Conductive/convective gains

Solar gains and conductive/convective gains are simulated by the zone heat balance.  Daylighting is simulated independently.

For both daylighting and heat balance simulations, the dome and diffuser are treated as special window surfaces to take advantage of many of the standard daylighting and heat transfer routines.  Together the dome and diffuser become "receiver" and "transmitter", i.e. radiation entering the dome ends up exiting the diffuser.

![](EngineeringReference/media/image870.png)

Figure 67.  Dome and Diffuser Surfaces

The pipe is simulated by a separate code module.  While several different measures for characterizing TDD performance are in use (Zhang 2002; Harrison 1998), the total transmittance of the TDD is most compatible with the EnergyPlus daylighting and heat balance code.  Calculation of the transmittance of the pipe and the TDD for different types of radiation is fundamental to all phenomena covered by the model.

#### Pipe Beam Transmittance

The transmittance of beam radiation is derived from the integration of the transmittance of many discrete rays.  The transmittance of a discrete ray through a pipe is dependent on the reflectivity of the inside pipe surface, the aspect ratio of the pipe, the incident angle of the ray, and the point of entry into the pipe.

![](EngineeringReference/media/image871.png)

Figure 68.  Discrete Ray in a Pipe

For an opaque surface, the reflectivity is:

<div>$$\rho  = 1 - \alpha $$</div>

where a = surface absorptivity.  Visible (i.e. daylighting) and solar absorptivities give visible and solar reflectivities, respectively.  Measured reflectivities for commercial TDDs range from 0.90 to 0.99.  Although the actual surface reflectivity is slightly dependent on the incident angle, the model assumes a constant reflectivity for all angles.

The full analytical expression for the transmittance of a beam of light in a highly reflective pipe has been developed by Swift and Smith and verified by experiment (1994).  By integrating over all rays incident on the pipe entrance, they find the transmittance of a beam of collimated radiation to be:

<div>$$\tau  = \frac{4}{\pi }\int_{s = 0}^1 {\frac{{{s^2}}}{{\sqrt {1 - {s^2}} }}} {\rho ^{INT\left[ {a\tan \theta /s} \right]}}\left( {1 - \left( {1 - \rho } \right)\left( {a\tan \theta /s - INT\left[ {a\tan \theta /s} \right]} \right)} \right)ds$$</div>

where

a = L/D, the aspect ratio of the TDD

r = surface reflectivity

q = incident angle

s = entry point

This integral does not have an analytical solution and must be calculated numerically.  It was found that a large number of points (100,000) were necessary to achieve an acceptable accuracy.  Since the integration is time consuming and the transmittance of the pipe must be utilized many times at every time step, values are calculated over a range of incident angles and stored in a table.  The tabulated values are interpolated to rapidly give the transmittance at any incident angle.  A polynomial fit was also considered but it was found that interpolation gave superior results.

In the graph below, interpolated values from EnergyPlus are compared to the results of ray tracing simulations performed at the Florida Solar Energy Center for an incident angle of 30 degrees (McCluney 2003).



![](EngineeringReference/media/image874.png)

Figure 69.  Pipe Transmittance Comparison.

During initialization of each unique TDD, the program integrates and tabulates values for the visible and solar transmittance of the pipe.  The results are subsequently used in the daylighting simulation and heat balance simulation respectively.

The effect of bends in the pipe on beam transmittance is not included in this model.  Recent research (Zhang 2002) has suggested that a 30 degree bend has a 20% loss in transmitted light.  If the effect of bends must be simulated, it can be approximated by the user by appropriately decreasing the transmittance of the diffuser material.



#### TDD Beam Transmittance

The beam transmittance of the TDD takes into account the dome and diffuser transmittances in addition to the pipe transmittance.

<div>$${\tau_{TDD}}(\theta ) = {\tau_{dome}}(\theta ){\tau_{pipe}}(\theta ){\tau_{diffuser}}$$</div>

where

t<sub>dome</sub>(q) = beam transmittance of the dome glazing at the incident angle

t<sub>pipe</sub>(q) = beam transmittance of the pipe at the incident angle, as described above

t<sub>diffuser</sub> = diffuse transmittance of the diffuser glazing

The dome transmittance is calculated for a flat window.  The model does not take into account refraction due to the curvature of the dome surface.

Diffuse transmittance is always assumed for the diffuser because multiple internal reflections in the pipe scatter the beam with a diffusing effect.  Although the light exiting the pipe is not isotropic, it can be approximated as diffuse.  The use of a frosted diffuser on the TDD, however, ensures that the light delivered to the zone is very close to isotropic diffuse.

The calculation of TDD diffuse transmittance is considerably more complex and is handled differently in the daylighting simulation and the heat balance simulation.  The details are discussed in the following sections.

#### Daylighting

The daylighting simulation of the TDD treats the diffuser surface as a regular window illuminated from the outside by sun, sky, and ground.  However, the TDD model replaces the window glazing transmittance with the appropriate TDD transmittance and converts all transmitted light to diffuse.

The illuminance due to the direct beam of the sun is found using the TDD beam transmittance t<sub>TDD</sub>(q) as described above.  The incident angle q is relative to the dome surface.

The illuminance due to sky radiation and ground reflected radiation is calculated with the normal daylighting model integration over the sky and ground within the viewable hemisphere of the dome.  The transmittance of each sky or ground  element is also found using the TDD beam transmittance at the incident angle of the sky or ground element relative to the dome.

Light from the diffuser is converted to diffuse inside the zone in the same way as an interior shade.

#### Solar Gains

Solar radiation incident on a window is calculated separately as sun, sky, and ground radiation.  A different transmittance must be applied for each type of radiation.

For beam radiation the TDD beam transmittance t<sub>TDD</sub>(q) for the solar spectrum is used as described above.  For sky and ground radiation a diffuse transmittance for the TDD must be developed.

The transmittance of diffuse radiation can be defined as the total transmitted flux divided by the total incident flux.

<div>$${\tau_{diff}} = \frac{{\sum {{I_{trans}}} }}{{\sum {{I_{inc}}} }}$$</div>

Swift and Smith (1994) suggest a weighted integral of the beam transmittance over the hemisphere for an arbitrary angular distribution:

<div>$${\tau_{diff}} = \frac{{\int_{\theta  = 0}^{\pi /2} {\tau (\theta )P(\theta )} \sin \theta d\theta }}{{\int_{\theta  = 0}^{\pi /2} {P(\theta )} \sin \theta d\theta }}$$</div>

where

P(q) = angular distribution function

For isotropic diffuse radiation P(q) is the cosine of the incident angle q.

<div>$${\tau_{diff,iso}} = \frac{{\int_{\theta  = 0}^{\pi /2} {\tau (\theta )\cos \theta } \sin \theta d\theta }}{{\int_{\theta  = 0}^{\pi /2} {\cos \theta } \sin \theta d\theta }}$$</div>

For a given pipe or TDD, t<sub>diff,iso</sub> is a constant.  The program calculates t<sub>diff,iso</sub> once during initialization using a numerical integration.

The diffuse isotropic transmittance is useful, but not sufficient, for determining the transmittance of sky radiation.  As described in the *Sky Radiance Model* section, sky radiation has an anisotropic distribution modeled as the superposition of three simple distributions: a diffuse isotropic background, a circumsolar brightening near the sun, and a horizon brightening.  While the daylighting model is capable of calculating the luminance of any position in the sky, the solar code only calculates the ultimate irradiance on a surface.  For this reason it is not possible to integrate over an angular distribution function for sky radiance.  Instead the three sky distributions must be handled piecewise.

<div>$${\tau_{diff,aniso}} = \frac{{\sum {{I_{trans,aniso}}} }}{{\sum {{I_{inc,aniso}}} }} = \frac{{{I_{trans,iso}} + {I_{trans,circumsolar}} + {I_{trans,horiz}}}}{{{I_{inc,iso}} + {I_{inc,circumsolar}} + {I_{inc,horiz}}}}$$</div>

Substituting in the appropriate transmittances:

<div>$${\tau_{diff,aniso}} = \frac{{{\tau_{diff,iso}}{I_{inc,iso}} + \tau (\theta ){I_{inc,circumsolar}} + {\tau_{diff,horiz}}{I_{inc,horiz}}}}{{{I_{inc,iso}} + {I_{inc,circumsolar}} + {I_{inc,horiz}}}}$$</div>

where

t<sub>diff,iso</sub> = diffuse isotropic transmittance

t(q) = beam transmittance at incident angle q of sun

t<sub>diff,horiz</sub> = diffuse transmittance of the horizon, derived below

It is important to note that transmittances above are for the total TDD.  The transmittance of the dome and diffuser must be included to account for their angular dependences as well.

The beam transmittance is used as an approximation for all circumsolar radiation.

The diffuse horizon transmittance is found by integrating the beam transmittance over the arc of the horizon.

<div>$${\tau_{diff,horiz}} = \frac{{\sum {{I_{trans,horiz}}} }}{{\sum {{I_{inc,horiz}}} }} = \frac{{\int_{\theta  =  - \pi /2}^{\pi /2} {\tau (\theta )\cos \theta d\theta } }}{{\int_{\theta  =  - \pi /2}^{\pi /2} {\cos \theta d\theta } }}$$</div>

Since the radiance of the horizon is isotropic, and therefore constant across the entire horizon, the actual value of the radiance cancels out.  The result is a constant that is calculated once during initialization.

Ground radiation is assumed to be isotropic diffuse.  The transmittance of ground radiation is the diffuse isotropic transmittance.

<div>$${\tau_{diff,gnd}} = {\tau_{diff,iso}}$$</div>

The solar flux transmitted by a TDD due to beam, sky, and ground radiation is calculated as normal for a window but uses the respective transmittances for the TDD.

<div>$${q''_{TDD - trans,beam}} = \left( {{I_{sun}}\cos \theta } \right){f_{sunlit}}{\tau_{TDD}}(\theta )$$</div>

<div>$${q''_{TDD - trans,sky}} = {I_{h,sky}}{f_{skymult}}{\tau_{TDD,diff,aniso}}$$</div>

<div>$${q''_{TDD - trans,gnd}} = \left( {{I_{sun}}\cos \theta  + {I_{h,sky}}} \right){F_{sg}}{\tau_{TDD,diff,iso}}$$</div>

where

I<sub>sun</sub> = solar beam intensity of the sun

I<sub>h,sky</sub> = total horizontal diffuse solar radiation due to the sky

q = incident angle of the beam on the dome

f<sub>sunlit</sub> = sunlit beam fraction of the dome area

f<sub>skymult</sub> = anisotropic sky view multiplier (see AnisoSkyMult)

F<sub>sg</sub> = view from ground to dome

t<sub>TDD</sub>(q) = TDD beam transmittance

t<sub>TDD,diff,aniso</sub> = TDD anisotropic sky transmittance

t<sub>TDD,diff,iso</sub> = TDD isotropic diffuse transmittance

#### Daylighting vs. Solar

The beam transmittance of a TDD is calculated in the same way for both daylighting and solar gains.  If the visible and solar properties (i.e. absorptances in the input file) are the same, the reported TDD beam transmittances are equal.

However, because the daylighting and solar models treat diffuse radiation differently, the TDD diffuse transmittances reported for visible and solar radiation will not necessarily be equal, even though the properties may be the same.

Since the daylighting model calculates the diffuse illuminance using a sky and ground integration of many discrete elements, a visible diffuse transmittance is not required for the TDD daylighting simulation.  For reporting purposes only, the visible diffuse transmittance is estimated concurrent with the sky and ground integration using:

<div>$${\tau_{diff}} = \frac{{\int {{\tau_{TDD}}(\theta )d{\Phi_{inc}}} }}{{\int {d{\Phi_{inc}}} }}$$</div>

#### Conductive/Convective Gains

For conductive and convective heat gain, TDDs are treated as one entity with an effective thermal resistance (i.e. R-value) between the outside and inside surfaces.  The outside face temperature of the dome and the inside face temperature of the diffuser are calculated as usual by the outside and inside heat balances respectively.  The temperatures are then copied to the inside face of the dome and the outside face of the diffuser.  Normal exterior and interior convection and IR radiation exchange occurs for both surfaces.

Although little research has been done on the thermal characteristics of TDDs, one experiment (Harrison 1998) reports an average effective thermal resistance of 0.279 m<sup>2</sup> K/W for a commercial TDD measuring 0.33 m in diameter by 1.83 m in length.  This value, however, reflects a measurement from outdoor air temperature to indoor air temperature.  The model assumes an effective thermal resistance from outside surface temperature to inside surface temperature.

Solar radiation is inevitably absorbed by the TDD before it reaches the zone.  Every reflection in the pipe leaves behind some solar radiation according to the surface absorptance.  Rays incident at a greater angle make more reflections and leave behind more absorbed solar in the pipe wall.

The total absorbed solar radiation in the TDD is the sum of the following gains:

* Inward bound solar absorbed by multiple pipe reflections

* Outward bound solar absorbed by multiple pipe reflections due to:

* Reflection off of diffuser surface (inside of TDD)

* Zone diffuse interior shortwave incident on the diffuser from lights, etc.

* Inward flowing absorbed solar in dome and diffuser glazing

<div>$${Q_{abs,pipe}} = {Q_{abs,in}} + {Q_{abs,out}} + {Q_{abs,glazing}}$$</div>

The inward bound solar absorbed by the pipe is the difference between the solar transmitted by the dome and the solar incident on the diffuser.

<div>$${Q_{abs,in}} = {q''_{trans,dome}}{A_{dome}} - {q''_{inc,diffuser}}{A_{diffuser}}$$</div>

The solar transmitted by the dome q"<sub>trans,dome</sub> is calculated as usual for a window.  The solar incident on the diffuser q"<sub>inc,diffuser</sub> is more complicated because each component must be treated separately.

<div>$${q''_{inc,diffuser}} = {q''_{beam}}\frac{{{\tau_{TDD,beam}}(\theta )}}{{{\tau_{diffuser}}}} + {q''_{sky}}\frac{{{\tau_{TDD,aniso}}(Hour)}}{{{\tau_{diffuser}}}} + {q''_{gnd}}\frac{{{\tau_{TDD,iso}}}}{{{\tau_{diffuser}}}}$$</div>

The outward bound solar absorbed by the pipe is given by:

<div>$${Q_{abs,out}} = \left( {{{q''}_{refl,diffuser}}\frac{{\left( {1 - {\tau_{TDD}}} \right)}}{{{\tau_{diffuser}}}} + {{q''}_{zoneSW}}\left( {1 - {\tau_{TDD}}} \right)} \right){A_{diffuser}}$$</div>

where q"<sub>zoneSW</sub> is the zone interior diffuse shortwave flux from window, lights, and ambient surface reflections, and

<div>$${q''_{refl,diffuser}} = {q''_{inc,diffuser}} - {q''_{abs,diffuser}} - {q''_{trans,diffuser}}$$</div>

The inward flowing portion of solar absorbed in the dome and diffuser glazing is:

<div>$${Q_{abs,glazing}} = \frac{{{{q''}_{abs,dome}}{A_{dome}}}}{2} + \frac{{{{q''}_{abs,diffuser}}{A_{diffuser}}}}{2}$$</div>

All absorbed solar radiation in the TDD is distributed among the transition zones that the pipe passes through between dome and diffuser.  The transition zone heat gain is proportional to the length of the zone.  Any exterior length of pipe also receives a proportional amount of heat, but this is lost to the outside. 

#### References

Harrison, S. J., McCurdy, G. G., Cooke, R. 1998.  "Preliminary Evaluation of the Daylighting and Thermal Performance of Cylindrical Skylights", Proceedings of International Daylight Conference, Ottawa, Canada, pp. 205-212.

McCluney, R. 2003. "Rating of Tubular Daylighting Devices for Visible Transmittance and Solar Heat Gain -- Final Report", FSEC-CR-1385-03, January 15, 2003, Florida Solar Energy Center, 1679 Clearlake Rd., Cocoa, FL 32922.

Swift, P. D., and Smith, G. B. 1995. "Cylindrical Mirror Light Pipes", Solar Energy Materials and Solar Cells 36, pp. 159-168.

Zhang, X., Muneer, T., and Kubie, J. 2002.  "A Design Guide For Performance Assessment of Solar Light-Pipes", Lighting Research & Technology 34, 2, pp. 149-169.

### Daylighting Shelves

The input object DaylightingDevice:Shelf provides a special model for light shelves used to augment daylighting.  Light shelves are constructed from up to three components: a window, an inside shelf, and an outside shelf.  The inside shelf acts to reflect all transmitted light from the upper window onto the ceiling of the zone as diffuse light.  The outside shelf changes the amount of light incident on the window.  All light reflected from the outside shelf also goes onto the zone ceiling.  The inside shelf and outside shelf are both optional.  However, if neither shelf is specifed, the daylighting shelf object has no effect on the simulation.

The window is divided into two window surfaces: an upper window and a lower window.  The upper window interacts with the daylighting shelf but the lower window does not, except to receive shading from the outside shelf.

![](EngineeringReference/media/image893.png)

Figure 70.  Daylighting Shelf Diagram

Daylighting shelves are simulated separately for daylighting and the zone heat balance.  The general model is similar in both cases, but the details vary.

#### Inside Shelf Daylighting

The inside shelf is modeled in the daylighting simulation by converting all light transmitted by the upper window into diffuse upgoing flux.  It is assumed that no beam or downgoing flux can pass the end of the shelf regardless of the shelf's position or orientation.

In the daylighting simulation this is accomplished by forcing all the transmitted flux to be upgoing:

<div>$${\Phi_{CW}} = \Phi $$</div>

<div>$${\Phi_{FW}} = 0$$</div>

where

F<sub>CW</sub> = upgoing flux

F<sub>FW</sub> = downgoing flux

F = total flux

Since it is assumed that all light falls on the inside shelf, it is implied that the upper window  cannot contribute any direct illuminance (i.e. the upper window cannot be seen from anywhere in the zone).  The remaining light is entirely interreflected sky-related and interreflected sun-related upgoing flux.

#### Inside Shelf Heat Balance

In the heat balance simulation the inside shelf is defined as an interzone heat transfer surface, e.g. partition.  Since the inside shelf external boundary condition is required to refer to itself, the shelf is essentially equivalent to internal mass.  Because the shelf surface has two sides that participate in the zone heat balance, the surface area is doubled by the program during initialization.  Like internal mass, the shelf surface is allowed to interact convectively and radiatively with the zone air and other zone surfaces.

The zone interior solar distribution is modified by the inside shelf.  Regardless of the solar distribution selected in the input file, all beam solar radiation transmitted by the upper window is incident on one side (half the doubled surface area) of the shelf surface.  The beam radiation not absorbed is reflected throughout the zone as diffuse shortwave radiation.  The treatment of sky and ground radiation is unchanged; both are added directly to the zone diffuse shortwave.

The total beam, sky, and ground radiation transmitted by the upper window does not change.

#### Outside Shelf Daylighting

In the daylighting model the luminous flux transmitted by the upper window is determined by integrating over the sky and ground and summing the luminance contribution of each sky or ground element.  The luminance of any intervening exterior or interior surfaces is assumed to be zero.  As a shading surface, the effect of the outside shelf during the integration is to block part of the view of the ground, thereby reducing the window transmitted flux due to diffuse ground luminance.  After the integration is complete, the program calculates the amount of diffuse light that is reflected through the window from the outside shelf and adds it as a lump sum to the upgoing flux transmitted by the window.

The additional shelf upgoing flux is the sum of sun-related and sky-related flux:

<div>$${\Phi_{shelf,CW}} = {\Phi_{shelf,sun}} + {\Phi_{shelf,sky}}$$</div>

where

<div>$${\Phi_{shelf,sun}} = \left( {{E_{sun}}\cos \theta } \right){f_{sunlit}}{\rho_{vis}}{F_{ws}}{\tau_{diff,vis}}$$</div>

<div>$${\Phi_{shelf,sky}} = {E_{h,sky}}{f_{skymult}}{\rho_{vis}}{F_{ws}}{\tau_{diff,vis}}$$</div>

and

E<sub>sun</sub> = exterior illuminance due to light from the sun

E<sub>h,\\ sky</sub> = exterior horizontal illuminance due to light from the sky

q = incident angle of the beam on the shelf

f<sub>sunlit</sub> = sunlit beam fraction of the shelf surface area

f<sub>skymult</sub> = anisotropic sky view multiplier (see AnisoSkyMult)

r<sub>vis</sub> = shelf surface reflectivity in the visible spectrum

F<sub>ws</sub> = view factor from window to shelf

t<sub>diff,\\ vis</sub> = diffuse window transmittance in the visible spectrum

The sunlit beam fraction f<sub>sunlit</sub> and the anisotropic sky view multiplier f<sub>skymult</sub> are borrowed from the heat balance solar calculations.

The sunlit beam fraction f<sub>sunlit</sub> takes into account the effect of shading due to other surfaces.  Although shadows on the shelf surface change the luminance distribution of the shelf, there is no angular dependence because diffuse properties are assumed.  Therefore, the flux is simply proportional to the sunlit fraction.

The anisotropic sky view multiplier f<sub>skymult</sub> takes into account the anisotropic distribution of sky radiation, the shelf view factor to the sky, and shading.  This value is utilized in the heat balance simulation for solar calculations but is not currently available in the daylighting simulation.  A value of 1.0 is assumed until a better model is developed.  For this reason the sky-related flux may be over-predicted for some building and shelf geometries.  However, for clear sky conditions the sun-related flux is dominant and the resulting error is small.

The view factor to the outside shelf, F<sub>ws</sub>, if not specified by the user in the input object, is an exact view factor calculated for adjacent perpendicular rectangles.



![](EngineeringReference/media/image899.png)

Figure 71.  Window and Outside Shelf as Adjacent Perpendicular Rectangles.

For this geometry the view factor is given by (Mills 1995):

<div>$${F_{ws}} = \frac{1}{{\pi M}}\left\{ \begin{array}{l}M{\tan ^{ - 1}}\left( {\frac{1}{M}} \right) + N{\tan ^{ - 1}}\left( {\frac{1}{N}} \right) - {\left( {{M^2} + {N^2}} \right)^{1/2}}{\tan ^{ - 1}}\left( {{{\left( {{M^2} + {N^2}} \right)}^{ - 1/2}}} \right)\\ + \frac{1}{4}\ln \left[ {\left( {\frac{{\left( {1 + {M^2}} \right)\left( {1 + {N^2}} \right)}}{{1 + {M^2} + {N^2}}}} \right){{\left( {\frac{{{M^2}\left( {1 + {M^2} + {N^2}} \right)}}{{\left( {1 + {M^2}} \right)\left( {{M^2} + {N^2}} \right)}}} \right)}^{{M^2}}}{{\left( {\frac{{{N^2}\left( {1 + {M^2} + {N^2}} \right)}}{{\left( {1 + {N^2}} \right)\left( {{M^2} + {N^2}} \right)}}} \right)}^{{N^2}}}} \right]\end{array} \right\}$$</div>

where

<div>$$M = H/W$$</div>

<div>$$N = L/W$$</div>

#### Outside Shelf Heat Balance

The heat balance simulation does not do a sky and ground integration.  View factors to sky and ground are used instead.  Consequently, the heat balance calculation for the outside shelf is very similar to the daylighting calculation.  The main difference is that the incident flux on the upper window is calculated first and reported.  The transmitted and absorbed fractions are subsequently determined.

The solar flux incident on the upper window due to the shelf is given by:

<div>$${q''_{shelf - inc}} = {q''_{shelf - inc,sun}} + {q''_{shelf - inc,sky}}$$</div>

where

<div>$${q''_{shelf - inc,sun}} = \left( {{I_{sun}}\cos \theta } \right){f_{sunlit}}{\rho_{sol}}{F_{ws}}$$</div>

<div>$${q''_{shelf - inc,sky}} = {I_{h,sky}}{f_{skymult}}{\rho_{sol}}{F_{ws}}$$</div>

and

I<sub>sun</sub> = solar beam intensity of the sun

I<sub>h,\\ sky</sub> = total horizontal diffuse solar radiation due to the sky

q = incident angle of the beam on the shelf

f<sub>sunlit</sub> = sunlit beam fraction of the surface area

f<sub>skymult</sub> = anisotropic sky view multiplier (see AnisoSkyMult)

r<sub>sol</sub> = shelf surface reflectivity in the solar spectrum

F<sub>ws</sub> = view factor from window to shelf

The view factor F<sub>ws</sub> is the same as described above for daylighting.

The total diffuse incident radiation due to the shelf is internally added to the ground diffuse incident radiation on the window.  For reporting purposes the shelf radiation is included in the *Surface Outside Face Incident Ground Diffuse Solar Radiation Rate per Area* output variable.

With the incident radiation determined, the remaining window heat balance is calculated normally.  The resulting transmitted diffuse radiation from the sky, ground, and shelf is:

<div>$${q''_{trans}} = \left( {{{q''}_{sky - inc}} + {{q''}_{gnd - inc}} + {{q''}_{shelf - inc}}} \right){\tau_{diff,sol}}$$</div>

where

t<sub>diff,\\ sol</sub> = diffuse window transmittance in the solar spectrum

#### References

Mills, A. F. 1995. Heat and Mass Transfer, p. 499.

### Window Light Well

The input object DaylightingDevice:LightWell provides a model for attenuation of light transmitted by windows and skylights that can result from surrounding interior finish surfaces that form a “light well.”  The light well model simply attenuates the light transmitted by the exterior window.  The model does not redirect light distributions or alter the relative mixture of diffuse and beam transmitted by the window.

The attenuation is characterized by the **well efficiency**, which is the ratio of the amount of light leaving the well to the amount of light entering the well. The well efficiency varies from close to 1.0  to close to zero if there is high attenuation. The well efficiency is used only in the EnergyPlus detailed daylighting calculation, where it multiplies the beam and diffuse light transmitted by the skylight. (The well efficiency is not used in calculating the solar gain through the skylight.)

![](EngineeringReference/media/image907.png)

Figure 72. Skylight with light well: (a) perspective view, (b) vertical section.
 If the bottom of the light well is a rectangle of side lengths c and d, as shown in (a), then the perimeter of the bottom of the well = 2(c+d) and the area = cd (see description of field names for the Light Well object).

The well efficiency depends on the visible reflectance of well’s side walls and on the well cavity ratio, ***WCR***, which is given by:

<div>$$WCR = \frac{{{\rm{2}}{\rm{.5 x Well Height x Well Perimeter}}}}{{{\rm{Well Area}}}}$$</div>

Well Height, Well Perimeter and Well Area are inputs to the model and are discussed in the figure caption above.

The model in EnergyPlus was implemented by fitting a curve to the data presented as Figure 8-21, “Efficiency factors for various depths of light wells based on well-interreflectance values,” found in the Lighting Handbook (IES 1993).  The figure below reproduces that reference data and shows well efficiency vs. WCR for different side wall reflectances. For use in the EnergyPlus calculation, a fit has been made to this graph that gives the following mathematical expression, where “Reflectance” is the user input value of the well-wall reflectance expressed as a fraction:

<div>$${\rm{Well efficiency}} = {e^{ - WCR*(0.16368 - 0.144678*{\rm{Reflectance}})}}$$</div>

![](EngineeringReference/media/image910.png)

Figure 73. Graph showing light well efficiency vs. well cavity ratio (WCR) for well-wall visible reflectances of 80% (upper curve), 60% (middle curve) and 40% (lower curve). Based on Fig. 8-21 of the Lighting Handbook: Reference and Application, 8<sup>th</sup> Edition, 1993, Illuminating Engineering Society of North America.

The well efficiency calculated using this curve fit and user inputs is then applied to daylight transmission rates to attenuate daylight as a result of the presence of the light well,

#### References

Lighting Handbook: Reference & Application, 8th Edition, Illuminating Engineering Society of North America, 1993.

Window Calculation Module
-------------------------

This section describes two potential modeling approaches for Windows.  The first (layer by layer) is implemented.  The second, simple approach, reuses the layer-by-layer approach but converts an arbitrary window performance into an equivalent single layer.

The primary Window calculation is a layer-by-layer approach where windows are considered to be composed of the following components, only the first of which, glazing, is required to be present:

* ***Glazing***, which consists of one or more plane/parallel glass layers. If there are two or more glass layers, the layers are separated by gaps filled with air or another gas. The glazing optical and thermal calculations are based on algorithms from the WINDOW 4 and WINDOW 5 programs [Arasteh et al., 1989], [Finlayson et al., 1993].  Glazing layers are described using te input object WindowMaterial:Glazing.

* ***Gap***, layers filled with air or another gas that separate glazing layers.  Gaps are described using the input object WindowMaterial:Gas.

* ***Frame***, which surrounds the glazing on four sides.  Frames are described using the input object WindowProperty:FrameAndDivider.

* ***Divider***, which consists of horizontal and/or vertical elements that divide the glazing into individual lites.

* ***Shading device***, which is a separate layer, such as drapery, roller shade or blind, on the inside or outside of the glazing, whose purpose is to reduce solar gain, reduce heat loss (movable insulation) or control daylight glare.  Shading layers are described using “WindowProperty:ShadingControl” input objects.

In the following, the description of the layer-by-layer glazing algorithms is based on material from Finlayson et al., 1993. The frame and divider thermal model, and the shading device optical and thermal models, are new to EnergyPlus.

A second approch has been developed where windows are modeled in a simplified approach that requires minimal user input that is processed to develop and equivalent layer that then reuses much of the layer-by-model.  This “Simple Window Construction: model is described below.

### Optical Properties of Glazing

The solar radiation transmitted by a system of glass layers and the solar radiation absorbed in each layer depends on the solar transmittance, reflectance and absorptance properties of the individual layers. The absorbed solar radiation enters the glazing heat balance calculation that determines the inside surface temperature and, therefore, the heat gain to the zone from the glazing (see “Window Heat Balance Calculation”). The transmitted solar radiation is absorbed by interior zone surfaces and, therefore, contributes to the zone heat balance. In addition, the visible transmittance of the glazing is an important factor in the calculation of interior daylight illuminance from the glazing.

Table 28.  Variables in Window Calculations

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
<th>Units</th>
<th>FORTRAN variable</th>
</tr>
<tr>
<td>T</td>
<td>Transmittance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R</td>
<td>Reflectance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R<sup>f</sup>, R<sup>b</sup></td>
<td>Front reflectance, back reflectance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>i,j</sub></td>
<td>Transmittance through glass layers i to j</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>T<sup>dir</sup><sub>gl</sub></td>
<td>Direct transmittance of glazing</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R<sup>f</sup><sub>i,j</sub>, R<sup>b</sup><sub>i,j</sub></td>
<td>Front reflectance, back reflectance from glass layers i to j</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R<sup>dir</sup><sub>gl,f</sub>, R<sup>dir</sup><sub>gl,b</sub></td>
<td>Direct front and back reflectance of glazing</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>A<sup>f</sup><sub>i</sub>, A<sup>b</sup><sub>i</sub></td>
<td>Front  absorptance, back absorptance of layer i</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>N</td>
<td>Number of glass layers</td>
<td>-</td>
<td>Nlayer</td>
</tr>
<tr>
<td>λ</td>
<td>Wavelength</td>
<td>microns</td>
<td>Wle</td>
</tr>
<tr>
<td>E<sub>s</sub>(λ)</td>
<td>Solar spectral irradiance function</td>
<td>W/m<sup>2</sup>-micron</td>
<td>E</td>
</tr>
<tr>
<td>V(λ)</td>
<td>Photopic response function of the eye</td>
<td>-</td>
<td>y30</td>
</tr>
<tr>
<td>φ</td>
<td>Angle of incidence (angle between surface normal and direction of incident beam radiation)</td>
<td>Rad</td>
<td>Phi</td>
</tr>
<tr>
<td>τ</td>
<td>Transmittivity or transmittance</td>
<td>-</td>
<td>tf0</td>
</tr>
<tr>
<td>ρ</td>
<td>Reflectivity or reflectance</td>
<td>-</td>
<td>rf0, rb0</td>
</tr>
<tr>
<td>α</td>
<td>Spectral absorption coefficient</td>
<td>m<sup>-1</sup></td>
<td>-</td>
</tr>
<tr>
<td>d</td>
<td>Glass thickness</td>
<td>M</td>
<td>Material%Thickness</td>
</tr>
<tr>
<td>n</td>
<td>Index of refraction</td>
<td>-</td>
<td>ngf, ngb</td>
</tr>
<tr>
<td>κ</td>
<td>Extinction coefficient</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>β</td>
<td>Intermediate variable</td>
<td>-</td>
<td>betaf, betab</td>
</tr>
<tr>
<td>P, p</td>
<td>A general property, such as transmittance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>τ<sub>sh</sub></td>
<td>Shade transmittance</td>
<td>-</td>
<td>Material%Trans</td>
</tr>
<tr>
<td>ρ<sub>sh</sub></td>
<td>Shade reflectance</td>
<td>-</td>
<td>Material%ReflectShade</td>
</tr>
<tr>
<td>α<sub>sh</sub></td>
<td>Shade absorptance</td>
<td>-</td>
<td>Material%AbsorpSolar</td>
</tr>
<tr>
<td>τ<sub>bl,</sub>ρ<sub>bl,</sub>α<sub>bl</sub></td>
<td>Blind transmittance, reflectance, absorptance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Q, G, J</td>
<td>Source, irradiance and radiosity for blind optical properties calculation</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>F<sub>ij</sub></td>
<td>View factor between segments i and j</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>f<sub>switch</sub></td>
<td>Switching factor</td>
<td>-</td>
<td>SwitchFac</td>
</tr>
<tr>
<td>T</td>
<td>Transmittance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R</td>
<td>Reflectance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R<sup>f</sup>, R<sup>b</sup></td>
<td>Front reflectance, back reflectance</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>T<sub>i,j</sub></td>
<td>Transmittance through glass layers i to j</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>R<sup>f</sup><sub>i,j</sub>, R<sup>b</sup><sub>i,j</sub></td>
<td>Front reflectance, back reflectance from glass layers i to j</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>A<sup>f</sup><sub>i</sub>, A<sup>b</sup><sub>i</sub></td>
<td>Front  absorptance, back absorptance of layer i</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>N</td>
<td>Number of glass layers</td>
<td>-</td>
<td>Nlayer</td>
</tr>
<tr>
<td>λ</td>
<td>Wavelength</td>
<td>microns</td>
<td>Wle</td>
</tr>
<tr>
<td>E<sub>s</sub>(λ)</td>
<td>Solar spectral irradiance function</td>
<td>W/m<sup>2</sup>-micron</td>
<td>E</td>
</tr>
<tr>
<td>R(λ)</td>
<td>Photopic response function of the eye</td>
<td>-</td>
<td>y30</td>
</tr>
<tr>
<td>φ'</td>
<td>Relative azimuth angle (angle between screen surface normal and vertical plane through sun, Ref. Figure 87)</td>
<td>Rad</td>
<td>SunAzimuthToScreenNormal</td>
</tr>
<tr>
<td>α'</td>
<td>Relative altitude angle (angle between screen surface horizontal normal plane and direction of incident beam radiation, Ref. Figure 87)</td>
<td>Rad</td>
<td>SunAltitudeToScreenNormal</td>
</tr>
<tr>
<td>ρ<sub>sc</sub></td>
<td>Beam-to-diffuse solar reflectance of screen material</td>
<td>-</td>
<td>Screens%ReflectCylinder</td>
</tr>
<tr>
<td>γ</td>
<td>Screen material aspect ratio</td>
<td>-</td>
<td>Screens%ScreenDiameterTo
SpacingRatio</td>
</tr>
<tr>
<td>Α</td>
<td>Spectral absorption coefficient</td>
<td>m<sup>-1</sup></td>
<td>-</td>
</tr>
<tr>
<td>D</td>
<td>Glass thickness</td>
<td>M</td>
<td>Material%Thickness</td>
</tr>
<tr>
<td>N</td>
<td>Index of refraction</td>
<td>-</td>
<td>ngf, ngb</td>
</tr>
<tr>
<td>Κ</td>
<td>Extinction coefficient</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Β</td>
<td>Intermediate variable</td>
<td>-</td>
<td>betaf, betab</td>
</tr>
<tr>
<td>P, p</td>
<td>A general property, such as transmittance</td>
<td>-</td>
<td>-</td>
</tr>

</table>

### Glass Layer Properties

In EnergyPlus, the optical properties of individual glass layers are given by the following quantities at normal incidence as a function of wavelength:

Transmittance, *T*

Front reflectance, *R<sup>f</sup>*

Back reflectance, *R<sup>b</sup>*

Here “front” refers to radiation incident on the side of the glass closest to the outside environment, and “back” refers to radiant incident on the side of the glass closest to the inside environment. For glazing in exterior walls, “front” is therefore the side closest to the outside air and “back” is the side closest to the zone air. For glazing in interior (i.e., interzone) walls, “back” is the side closest to the zone in which the wall is defined in and “front” is the side closest to the adjacent zone.

### Glass Optical Properties Conversion

#### Conversion from Glass Optical Properties Specified as Index of Refraction and Transmittance at Normal Incidence

The optical properties of uncoated glass are sometimes specified by index of refraction, *n*,*
* and transmittance at normal incidence, *T*.

The following equations show how to convert from this set of values to the transmittance and reflectance values required by Material:WindowGlass. These equations apply only to uncoated glass, and can be used to convert either spectral-average solar properties or spectral-average visible properties (in general, *n* and *T* are different for the solar and visible). Note that since the glass is uncoated, the front and back reflectances are the same and equal to the *R* that is solved for in the following equations.

Given *n* and *T*, find *R*:

<div>$$\begin{array}{l}r = {\left( {\frac{{n - 1}}{{n + 1}}} \right)^2}\\\tau  = \frac{{{{\left[ {{{(1 - r)}^4} + 4{r^2}{T^2}} \right]}^{1/2}} - {{(1 - r)}^2}}}{{2{r^2}T}}\\R = r + \frac{{{{(1 - r)}^2}r{\tau ^2}}}{{1 - {r^2}{\tau ^2}}}\end{array}$$</div>

**Example:**

*T* = 0.86156

*n* = 1.526

<div>$$\begin{array}{l}r = {\left( {\frac{{1.526 - 1}}{{1.526 + 1}}} \right)^2}\\\tau  = 0.93974\\R = 0.07846\end{array}$$</div>

### Simple Window Model

EnergyPlus includes an alternate model that allows users to enter in simplified window performance indices.  This model is accessed through the WindowMaterial:SimpleGlazingSystem input object and converts the simple indices into an equivalent single layer window.  (In addition a special model is used to determine the angular properties of the system – described below).  Once the model generates the properties for the layer, the program reuses the bulk of the layer-by-layer model for subsequent calculations.  The properties of the equivalent layer are determined using the step by step method outlined by Arasteh, Kohler, and Griffith (2009).  The core equations are documented here.  The reference contains additional information.

The simplified window model accepts U and SHGC indices and is useful for several reasons:

1)   Sometimes, the only thing that is known about the window are its U and SHGC;

2)   Codes, standards, and voluntary programs are developed in these terms;

3)   A single-layer calculation is faster than multi-layer calculations.

Note: This use of U and SHGC to describe the thermal properties of windows is only appropriate for specular glazings.

While it is important to include the ability to model windows with only U-value and SHGC, we note that any method to use U and SHGC alone in building simulation software will inherently be approximate.  This is due primarily to the following factors:

* SHGC combines directly transmitted solar radiation and radiation absorbed by the glass which flows inward.  These have different implications for space heating/cooling.  Different windows with the same SHGC often have different ratios of transmitted to absorbed solar radiation.

* SHGC is determined at normal incidence; angular properties of glazings vary with number of layers, tints, coatings.  So products which have the same SHGC, can have different angular properties.

* Window U-factors vary with temperatures.

Thus, for modeling specific windows, we recommend using more detailed data than just the U and SHGC, if at all possible.

The simplified window model determines the properties of an equivalent layer in the following steps.

#### Step 1.  Determine glass-to-glass Resistance.

Window U-values include interior and exterior surface heat transfer coefficients.  The resistance of the bare window product, or glass-to-glass resistance is augmented by these film coefficients so that,

<div>$$\frac{1}{U} = {R_{i,w}} + {R_{o,w}} + {R_{l,w}}$$</div>

Where,

<span>${R_{i,w}}$</span> is the resistance of the interior film coefficient under standard winter conditions in units of m<sup>2</sup>·K/W,

<span>${R_{o,w}}$</span> is the resistance of the exterior film coefficient under standard winter conditions in units of m<sup>2</sup>·K/W, and

<span>${R_{l,w}}$</span> is the resisance of the bare window under winter conditions (without the film coefficients) in units of m<sup>2</sup>·K/W.

The values for <span>${R_{i,w}}$</span> and <span>${R_{o,w}}$</span> depend on U and are calculated using the following correlations.

<div>$${R_{i,w}} = \frac{1}{{(0.359073\;Ln(U) + 6.949915)}};\quad for\quad U < 5.85$$</div>

<div>$${R_{i,w}} = \frac{1}{{(1.788041\;U - 2.886625)}};\quad for\quad U \ge 5.85$$</div>

<div>$${R_{o,w}} = \frac{1}{{(0.025342\;U + 29.163853)}}$$</div>

So that the glass-to-glass resistance is calculated using,

<span>${R_{l,w}} = \frac{1}{U} - {R_{i,w}} - {R_{o,w}}$</span>.

Because the window model in EnergyPlus is for flat geometries, the models are not necessarily applicable to low-performance projecting products, such as skylights with unisulated curbs.  The model cannot support glazing systems with a U higher than 7.0 because the thermal resistance of the film coefficients alone can provide this level of performance and none of the various resistances can be negative.

#### Step 2.  Determine Layer Thickness.

The thickness of the equivalent layer in units of meters is calculated using,

<div>$$Thickness = 0.002\;;\quad for\;{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 {{R_{l,w}}}}}\right.}\!\lower0.7ex\hbox{${{R_{l,w}}}$}} > 7.0$$</div>

<div>$$Thickness = 0.05914 - \left( {\frac{{0.00714}}{{{R_{l,w}}}}} \right);\;{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 {{R_{l,w}}}}}\right.}\!\lower0.7ex\hbox{${{R_{l,w}}}$}} \le 7.0$$</div>

#### Step 3.  Determine Layer Thermal Conductivity

The effective thermal conductivity, <span>${\lambda_{eff}}$</span>, of the equivalent layer is calculated using,

<div>$${\lambda_{eff}} = \frac{{Thickness}}{{{R_{l,w}}}}$$</div>

#### Step 4.  Determine Layer Solar Transmittance

The layer’s solar transmittance at normal incidence, <span>${T_{sol}}$</span>, is calculated using correlations that are a function of SHGC and U-Factor.

<div>$${T_{sol}} = 0.939998\;SHG{C^2} + 0.20332\;SHGC;\quad U > 4.5;\;SHGC < 0.7206$$</div>

<div>$${T_{sol}} = 1.30415SHGC - 0.30515\;;\quad U > 4.5;\;SHGC \ge 0.7206$$</div>

<div>$${T_{sol}} = 0.41040\;SHGC;\quad U < 3.4;\;SHGC \le 0.15$$</div>

<div>$${T_{sol}} = 0.085775\;SHG{C^2} + 0.963954\;SHGC - 0.084958\;;\;\;U < 3.4;\;SHGC > 0.15$$</div>

And for U-values between 3.4 and 4.5, the value for <span>${T_{sol}}$</span> is interpolated using results of the equations for both ranges.

#### Step 5.  Determine Layer Solar Reflectance

The layer’s solar reflectance is calculated by first determining the inward flowing fraction which requires values for the resistance of the inside and outside film coefficients under summer conditions, <span>${R_{i,s}}$</span> and <span>${R_{o,s}}$</span>respectively.  The correlations are

<span>${R_{i,s}} = \frac{1}{{\left( {29.436546\;{{\left( {SHGC - {T_{Sol}}} \right)}^3} - 21.943415{{\left( {SHGC - {T_{Sol}}} \right)}^2} + 9.945872\left( {SHGC - {T_{Sol}}} \right) + 7.426151} \right)}};\,U > 4.5$</span><span>${R_{i,s}} = \frac{1}{{\left( {199.8208128\;{{\left( {SHGC - {T_{Sol}}} \right)}^3} - 90.639733{{\left( {SHGC - {T_{Sol}}} \right)}^2} + 19.737055\left( {SHGC - {T_{Sol}}} \right) + 6.766575} \right)}};\,U < 3.4$</span><span>${R_{o,s}} = \frac{1}{{\left( {2.225824(SHGC - {T_{Sol}}) + 20.57708} \right)}};\;U > 4.5$</span>

<div>$${R_{o,s}} = \frac{1}{{\left( {5.763355(SHGC - {T_{Sol}}) + 20.541528} \right)}};\;U < 3.4$$</div>

And for U-values between 3.4 and 4.5, the values are interpolated using results from both sets of equations.

The inward flowing fraction, <span>$Fra{c_{inward}}$</span>, is then calculated using

<div>$$Fra{c_{inward}} = \frac{{\left( {{R_{o,s}} + 0.5\,{R_{l,w}}} \right)}}{{\left( {{R_{o,s}} + {R_{l,w}} + {R_{i,s}}} \right)}}$$</div>

The the solar reflectances of the front face, <span>${R_{s,f}}$</span>, and back face, <span>${R_{s,b}}$</span>, are calculated using,

<span>${R_{s,f}} = {R_{s,b}} = 1 - {T_{Sol}} - \frac{{\left( {SHGC - {T_{Sol}}} \right)}}{{Fra{c_{inward}}}}$</span>.

The thermal absorptance, or emittance, is take as 0.84 for both the front and back and the longwave transmittance is 0.0.

#### Step 6.  Determine Layer Visible Properties

The user has the option of entering a value for visible transmittance as one of the simple performance indices.  If the user does not enter a value, then the visible properties are the same as the solar properties.  If the user does enter a value then layer’s visible transmittance at normal incidence, <span>${T_{Vis}}$</span>,is set to that value.  The visible light reflectance for the back surface is calculated using,

<div>$${R_{Vis,b}} =  - 0.7409\,T_{Vis}^3 + 1.6531\,T_{Vis}^2 - 1.2299\,{T_{Vis}} + 0.4547$$</div>

The visible light reflectance for the front surface is calculated using,

<div>$${R_{Vis,f}} =  - 0.0622\,T_{Vis}^3 + 0.4277\,T_{Vis}^2 - 0.4169\,{T_{Vis}} + 0.2399$$</div>

#### Step 7. Determine Angular Performance

The angular properties of windows are important because during energy modeling, the solar incidence angles are usually fairly high.  Angles of incidence are defined as angles from the normal direction extending out from the window.  The simple glazing system model includes a range of correlations that are selected based on the values for U and SHGC.  These were chosen to match the types of windows likely to have such performance levels.  The matrix of possible combinations of U and SHGC values have been mapped to set of 28 bins shown in the following figure.



 ![AngularCorrelationMAP](EngineeringReference/media/image947.png)

Figure 74. Diagram of Transmittance and Reflectance Correlations Used based on U and SHGC.

There are ten different correlations, A thru J, for both transmission and reflectance.  The correlations are used in various weighting and interpolation schemes according the figure above.  The correlations are normalized against the performance at normal incidence.  EnergyPlus uses these correlations to store the glazing system’s angular performance at 10 degree increments and interpolates between them during simulations.  The model equations use the cosine of the incidence angle, <span>$\cos (\varphi )$</span>, as the independent variable.  The correlations have the form:

<div>$$T\;or\;R = a\cos {(\varphi )^4} + b\cos {(\varphi )^3} + c\cos {(\varphi )^2} + d\cos (\varphi ) + e$$</div>

The coefficient values for a, b, c, d, and e are listed in the following tables for each of the curves.



![Figure72](EngineeringReference/media/image950.png)

Figure 75. Normalized Transmittance Correlations for Angular Performance



![Fiure73](EngineeringReference/media/image951.png)

Figure 76. Normalized Reflectanct Correlations for Angular Performance

#### Application Issues

EnergyPlus’s normal process of running the detailed layer-by-layer model, with the equivalent layer produced by this model, creates reports (sent to the EIO file) of the overall performance indices and the properties of the equivalent layer. Both of these raise issues that may be confusing.

The simplified window model does not reuse all aspects of the detailed layer-by-layer model, in that the angular solar transmission properties use a different model when the simple window model is in effect. If the user takes the material properties of an equivalent glazing layer from the simple window model and then re-enters them into just the detailed model, then the performance will not be the same because of the angular transmission model will have changed. It is not proper use of the model to re-enter the equivalent layer’s properties and expect the exact level of performance.

There may not be exact agreement between the performance indices echoed out and those input in the model. This is expected with the model and the result of a number of factors. For example, although input is allowed to go up to U-7 W/m<sup>2</sup>∙K, the actual outcome is limited to no higher than about 5.8W/m<sup>2</sup>∙K. This is because the thermal resistance to heat transfer at the surfaces is already enough resistance to provide an upper limit to the conductance of a planar surface. Sometimes there is conflict between the SHGC and the U that are not physical and compromises need to be made. In general, the simple window model is intended to generate a physically-reasonable glazing that approximates the input entered as well as possible. But the model is not always be able to do exactly what is specified when the specifications are not physical.

#### References

Arasteh, D., J.C. Kohler, B. Griffith, Modeling Windows in EnergyPlus with Simple Performance Indices. Lawrence Berkeley National Laboratory. In Draft. Available at

### Glazing System Properties

The optical properties of a glazing system consisting of *N* glass layers separated by nonabsorbing gas layers (Figure 77.  Schematic of transmission, reflection and absorption of solar radiation within a multi-layer glazing system.) are determined by solving the following recursion relations for *T<sub>i,j</sub>*, the transmittance through layers* i* to* j*; *R<sup>f</sup><sub>i,j</sub>* and *R<sup>b</sup><sub>i,j</sub>*, the front and back reflectance, respectively, from layers* i* to* j*; and *A<sub>j</sub>*, the absorption in layer* j*. Here layer 1 is the outermost layer and layer *N* is the innermost layer. These relations account for multiple internal reflections within the glazing system. Each of the variables is a function of wavelength.

<div>$${T_{i,j}} = \frac{{{T_{i,j - 1}}{T_{j,j}}}}{{1 - R_{j,j}^fR_{j - 1,i}^b}}$$</div>

<div>$$R_{i,j}^f = R_{i,j - 1}^f + \frac{{T_{i,j - 1}^2R_{j,j}^f}}{{1 - R_{j,j}^fR_{j - 1,i}^b}}$$</div>

<div>$$R_{j,i}^b = R_{j,j}^b + \frac{{T_{j,j}^2R_{j - 1,i}^b}}{{1 - R_{j - 1,i}^bR_{j,j}^f}}$$</div>

<div>$$A_j^f = \frac{{{T_{1,j - 1}}(1 - {T_{j,j}} - R_{j,j}^f)}}{{1 - R_{j,N}^fR_{j - 1,1}^b}} + \frac{{{T_{1,j}}R_{j + 1,N}^f(1 - {T_{j,j}} - R_{j,j}^b)}}{{1 - R_{j,N}^fR_{j - 1,1}^b}}$$</div>

In Eq. *T<sub>i,j</sub>* = 1 and *R<sub>i,j</sub>* = 0 if* i*&lt;0 or* j*&gt;*N*.

![](EngineeringReference/media/image956.png)

Figure 77.  Schematic of transmission, reflection and absorption of solar radiation within a multi-layer glazing system.

As an example, for double glazing (*N*=2) these equations reduce to

<div>$${T_{1,2}} = \frac{{{T_{1,1}}{T_{2,2}}}}{{1 - R_{2,2}^fR_{1,1}^b}}$$</div>

<div>$$R_{1,2}^f = R_{1,1}^f + \frac{{T_{1,1}^2R_{2,2}^f}}{{1 - R_{2,2}^fR_{1,1}^b}}$$</div>

<div>$$R_{2,1}^b = R_{2,2}^b + \frac{{T_{2,2}^2R_{1,1}^b}}{{1 - R_{1,1}^bR_{2,2}^f}}$$</div>

<div>$$A_1^f = (1 - {T_{1,1}} - R_{1,1}^f) + \frac{{{T_{1,1}}R_{2,2}^f(1 - {T_{1,1}} - R_{1,1}^b)}}{{1 - R_{2,2}^fR_{1,1}^b}}$$</div>

<div>$$A_2^f = \frac{{{T_{1,1}}(1 - {T_{2,2}} - R_{2,2}^f)}}{{1 - R_{2,2}^fR_{1,1}^b}}$$</div>

If the above transmittance and reflectance properties are input as a function of wavelength, EnergyPlus calculates “spectral average” values of the above glazing system properties by integrating over wavelength:

The spectral-average solar property is

<div>$${P_s} = \frac{{\int {P(\lambda ){E_s}(\lambda )d\lambda } }}{{\int {{E_s}(\lambda )d\lambda } }}$$</div>

The spectral-average visible property is

<div>$${P_v} = \frac{{\int {P(\lambda ){E_s}(\lambda )V(\lambda )d\lambda } }}{{\int {{E_s}(\lambda )V(\lambda )d\lambda } }}$$</div>

where <span>${E_s}(\lambda )$</span>is the solar spectral irradiance function and <span>$V(\lambda )$</span>is the photopic response function of the eye. The default functions are shown in Table 29 and Table 30. They can be overwritten by user defined solar and/or visible spectrum using the objects Site:SolarAndVisibleSpectrum and Site:SpectrumData. They are expressed as a set of values followed by the corresponding wavelengths for values.

If a glazing layer has optical properties that are roughly constant with wavelength, the wavelength-dependent values of *T<sub>i,i</sub>* , *R<sup>f</sup><sub>i,i</sub>* and *R<sup>b</sup><sub>i,i</sub>* in Eqs. to can be replaced with constant values for that layer.

Table 29. Solar spectral irradiance function.

<table class="table table-striped">
<tr>
<td>Air mass 1.5 terrestrial solar global spectral irradiance values (W/m<sup>2</sup>-micron) on a 37<sup>o</sup> tilted surface. Corresponds to wavelengths in following data block. Based on ISO 9845-1 and ASTM E 892; derived from Optics5 data file ISO-9845GlobalNorm.std, 10-14-99.</td>
</tr>
<tr>
<td>                  0.0,   9.5,  42.3, 107.8, 181.0, 246.0, 395.3, 390.1, 435.3, 438.9,
       483.7, 520.3, 666.2, 712.5, 720.7,1013.1,1158.2,1184.0,1071.9,1302.0,
      1526.0,1599.6,1581.0,1628.3,1539.2,1548.7,1586.5,1484.9,1572.4,1550.7,
      1561.5,1501.5,1395.5,1485.3,1434.1,1419.9,1392.3,1130.0,1316.7,1010.3,
      1043.2,1211.2,1193.9,1175.5, 643.1,1030.7,1131.1,1081.6, 849.2, 785.0,
       916.4, 959.9, 978.9, 933.2, 748.5, 667.5, 690.3, 403.6, 258.3, 313.6,
       526.8, 646.4, 746.8, 690.5, 637.5, 412.6, 108.9, 189.1, 132.2, 339.0,
       460.0, 423.6, 480.5, 413.1, 250.2,  32.5,   1.6,  55.7, 105.1, 105.5,
       182.1, 262.2, 274.2, 275.0, 244.6, 247.4, 228.7, 244.5, 234.8, 220.5,
       171.5,  30.7,   2.0,   1.2,  21.2,  91.1,  26.8,  99.5,  60.4,  89.1,
        82.2,  71.5,  70.2,  62.0,  21.2,  18.5,   3.2</td>
</tr>
<tr>
<td>Wavelengths (microns) corresponding to above data block</td>
</tr>
<tr>
<td>           0.3000,0.3050,0.3100,0.3150,0.3200,0.3250,0.3300,0.3350,0.3400,0.3450,
      0.3500,0.3600,0.3700,0.3800,0.3900,0.4000,0.4100,0.4200,0.4300,0.4400,
      0.4500,0.4600,0.4700,0.4800,0.4900,0.5000,0.5100,0.5200,0.5300,0.5400,
      0.5500,0.5700,0.5900,0.6100,0.6300,0.6500,0.6700,0.6900,0.7100,0.7180,
      0.7244,0.7400,0.7525,0.7575,0.7625,0.7675,0.7800,0.8000,0.8160,0.8237,
      0.8315,0.8400,0.8600,0.8800,0.9050,0.9150,0.9250,0.9300,0.9370,0.9480,
      0.9650,0.9800,0.9935,1.0400,1.0700,1.1000,1.1200,1.1300,1.1370,1.1610,
      1.1800,1.2000,1.2350,1.2900,1.3200,1.3500,1.3950,1.4425,1.4625,1.4770,
      1.4970,1.5200,1.5390,1.5580,1.5780,1.5920,1.6100,1.6300,1.6460,1.6780,
      1.7400,1.8000,1.8600,1.9200,1.9600,1.9850,2.0050,2.0350,2.0650,2.1000,
      2.1480,2.1980,2.2700,2.3600,2.4500,2.4940,2.5370</td>
</tr>

</table>

Table 30. Photopic response function.

<table class="table table-striped">




<tr>
<td>Photopic response function values corresponding to wavelengths in following data block. Based on CIE 1931 observer; ISO/CIE 10527, CIE Standard Calorimetric Observers; derived from Optics5 data file &quot;CIE 1931 Color Match from E308.txt&quot;, which is the same as WINDOW4 file Cie31t.dat.</td>
</tr>
<tr>
<td>      0.0000,0.0001,0.0001,0.0002,0.0004,0.0006,0.0012,0.0022,0.0040,0.0073,
      0.0116,0.0168,0.0230,0.0298,0.0380,0.0480,0.0600,0.0739,0.0910,0.1126,
      0.1390,0.1693,0.2080,0.2586,0.3230,0.4073,0.5030,0.6082,0.7100,0.7932,
      0.8620,0.9149,0.9540,0.9803,0.9950,1.0000,0.9950,0.9786,0.9520,0.9154,
      0.8700,0.8163,0.7570,0.6949,0.6310,0.5668,0.5030,0.4412,0.3810,0.3210,
      0.2650,0.2170,0.1750,0.1382,0.1070,0.0816,0.0610,0.0446,0.0320,0.0232,
      0.0170,0.0119,0.0082,0.0158,0.0041,0.0029,0.0021,0.0015,0.0010,0.0007,
      0.0005,0.0004,0.0002,0.0002,0.0001,0.0001,0.0001,0.0000,0.0000,0.0000,
      0.0000 /</td>
</tr>
<tr>
<td>Wavelengths (microns) corresponding to above data block</td>
</tr>
<tr>
<td>      .380,.385,.390,.395,.400,.405,.410,.415,.420,.425,
      .430,.435,.440,.445,.450,.455,.460,.465,.470,.475,
      .480,.485,.490,.495,.500,.505,.510,.515,.520,.525,
      .530,.535,.540,.545,.550,.555,.560,.565,.570,.575,
      .580,.585,.590,.595,.600,.605,.610,.615,.620,.625,
      .630,.635,.640,.645,.650,.655,.660,.665,.670,.675,
      .680,.685,.690,.695,.700,.705,.710,.715,.720,.725,
      .730,.735,.740,.745,.750,.755,.760,.765,.770,.775,
      .780</td>
</tr>

</table>

### Calculation of Angular Properties

Calculation of optical properties is divided into two categories: uncoated glass and coated glass.

#### Angular Properties for Uncoated Glass

The following discussion assumes that optical quantities such as transmissivity, reflectvity, absorptivity, and index of refraction are a function of wavelength, λ. If there are no spectral data the angular dependence is calculated based on the single values for transmittance and reflectance in the visible and solar range. In the visible range an average wavelength of 0.575 microns is used in the calculations. In the solar range an average wavelength of 0.898 microns is used.

The spectral data include the transmittance, *T*, and the reflectance, *R*. For uncoated glass the reflectance is the same for the front and back surfaces. For angle of incidence, <span>$\phi $</span>, the transmittance and reflectance are related to the transmissivity, τ,and reflectivity, ρ, by the following relationships:

<div>$$T(\phi ) = \frac{{\tau {{(\phi )}^2}{e^{ - \alpha d/\cos \phi '}}}}{{1 - \rho {{(\phi )}^2}{e^{ - 2\alpha d/\cos \phi '}}}}$$</div>

<div>$$R(\phi ) = \rho (\phi )\left( {1 + T(\phi ){e^{ - \alpha d/\cos \phi '}}} \right)$$</div>

The spectral reflectivity is calculated from Fresnel’s equation assuming unpolarized incident radiation:

<div>$$\rho (\phi ) = \frac{1}{2}\left( {{{\left( {\frac{{n\cos \phi  - \cos \phi '}}{{n\cos \phi  + \cos \phi '}}} \right)}^2} + {{\left( {\frac{{n\cos \phi ' - \cos \phi }}{{n\cos \phi ' + \cos \phi }}} \right)}^2}} \right)$$</div>

The spectral transmittivity is given by

<div>$$\tau (\phi ) = 1 - \rho (\phi )$$</div>

The spectral absorption coefficient is defined as

<div>$$\alpha  = 4\pi \kappa /\lambda $$</div>

where κ is the dimensionless spectrally-dependent extinction coefficient and λ is the wavelength expressed in the same units as the sample thickness.

Solving Eq. at normal incidence gives

<div>$$n = \frac{{1 + \sqrt {\rho (0)} }}{{1 - \sqrt {\rho (0)} }}$$</div>

Evaluating Eq. at normal incidence gives the following expression for *κ*

<div>$$\kappa  =  - \frac{\lambda }{{4\pi d}}\ln \frac{{R(0) - \rho (0)}}{{\rho (0)T(0)}}$$</div>

Eliminating the exponential in Eqs. and  gives the reflectivity at normal incidence:

<div>$$\rho (0) = \frac{{\beta  - \sqrt {{\beta ^2} - 4(2 - R(0))R(0)} }}{{2(2 - R(0))}}$$</div>

where

<div>$$\beta  = T{(0)^2} - R{(0)^2} + 2R(0) + 1$$</div>

The value for the reflectivity, *ρ*(0),from Eq. is substituted into Eqs. and . The result from Eq. is used to calculate the absorption coefficient in Eq. . The index of refraction is used to calculate the reflectivity in Eq. which is then used to calculate the transmittivity in Eq. . The reflectivity, transmissivity and absorption coefficient are then substituted into Eqs. and to obtain the angular values of the reflectance and transmittance.

#### Angular Properties for Coated Glass

A regression fit is used to calculate the angular properties of coated glass from properties at normal incidence. If the transmittance of the coated glass is &gt; 0.645, the angular dependence of uncoated clear glass is used. If the transmittance of the coated glass is ≤ 0.645, the angular dependence of uncoated bronze glass is used. The values for the angular functions for the transmittance and reflectance of both clear glass <span>$({\bar \tau_{clr}},{\bar \rho_{clr}})$</span> and bronze glass <span>$({\bar \tau_{bnz}},{\bar \rho_{bnz}})$</span>are determined from a fourth-order polynomial regression:

<div>$$\bar \tau (\phi ) = {\bar \tau_0} + {\bar \tau_1}\cos (\phi ) + {\bar \tau_2}{\cos ^2}(\phi ) + {\bar \tau_3}{\cos ^3}(\phi ) + {\bar \tau_4}{\cos ^4}(\phi )$$</div>

and

<div>$$\bar \rho (\phi ) = {\bar \rho_0} + {\bar \rho_1}\cos (\phi ) + {\bar \rho_2}{\cos ^2}(\phi ) + {\bar \rho_3}{\cos ^3}(\phi ) + {\bar \rho_4}{\cos ^4}(\phi ) - \bar \tau (\phi )$$</div>

The polynomial coefficients are given in Table 31.

Table 31. Polynomial coefficients used to determine angular properties of coated glass.

<table class="table table-striped">
<tr>
<th> </th>
<th>0</th>
<th>1</th>
<th>2</th>
<th>3</th>
<th>4</th>
</tr>
<tr>
<td><span>${\bar \tau_{clr}}$</span></td>
<td>-0.0015</td>
<td>3.355</td>
<td>-3.840</td>
<td>1.460</td>
<td>0.0288</td>
</tr>
<tr>
<td><span>${\bar \rho_{clr}}$</span></td>
<td>0.999</td>
<td>-0.563</td>
<td>2.043</td>
<td>-2.532</td>
<td>1.054</td>
</tr>
<tr>
<td><span>${\bar \tau_{bnz}}$</span></td>
<td>-0.002</td>
<td>2.813</td>
<td>-2.341</td>
<td>-0.05725</td>
<td>0.599</td>
</tr>
<tr>
<td><span>${\bar \rho_{bnz}}$</span></td>
<td>0.997</td>
<td>-1.868</td>
<td>6.513</td>
<td>-7.862</td>
<td>3.225</td>
</tr>

</table>

These factors are used as follows to calculate the angular transmittance and reflectance:

For *T*(0) &gt; 0.645:

<div>$$T(\phi ) = T(0){\bar \tau_{clr}}(\phi )$$</div>

<div>$$R(\phi ) = R(0)(1 - {\bar \rho_{clr}}(\phi )) + {\bar \rho_{clr}}(\phi )$$</div>

For *T*(0) ≤ 0.645:

<div>$$T(\phi ) = T(0){\bar \tau_{bnz}}(\phi )$$</div>

<div>$$R(\phi ) = R(0)(1 - {\bar \rho_{bnz}}(\phi )) + {\bar \rho_{bnz}}(\phi )$$</div>

#### Angular Properties for Simple Glazing Systems

When the glazing system is modeled using the simplified method, an alternate method is used to determine the angular properties.  The equation for solar transmittance as a function of incidence angle, <span>$T\left( \phi  \right)$</span>, is,

<div>$$T\left( \phi  \right) = T\left( {\phi  = 0} \right)\,\cos \left( \phi  \right)\,\,\left( {1 + (0.768 + 0.817\,SHG{C^4})\;{{\sin }^3}\left( \phi  \right)} \right)$$</div>

where,

<span>$T\left( {\phi  = 0} \right)$</span> is the normal incidence solar transmittance, <span>${T_{Sol}}$</span>.

The equation for solar reflectance as a function of incidence angle,  <span>$R\left( \phi  \right)$</span>, is,

<div>$$R\left( \phi  \right) = \frac{{R\left( {\phi  = 0} \right)\left( {{f_1}\left( \phi  \right) + {f_2}\left( \phi  \right)\sqrt {SHGC} } \right)}}{{{R_{fit,o}}}}$$</div>

where,

<div>$${f_1}\left( \phi  \right) = \left( {\left( {\left( {2.403\cos \left( \phi  \right) - 6.192} \right)\cos \left( \phi  \right) + 5.625} \right)\cos \left( \phi  \right) - 2.095} \right)\cos \left( \phi  \right) + 1$$</div>

<div>$${f_2}\left( \phi  \right) = \left( {\left( {\left( { - 1.188\cos \left( \phi  \right) + 2.022} \right)\cos \left( \phi  \right) + 0.137} \right)\cos \left( \phi  \right) - 1.720} \right)\cos \left( \phi  \right)$$</div>

<div>$${R_{fit,o}} = 0.7413 - \left( {0.7396\;\sqrt {SHGC} } \right)$$</div>

### Calculation of Hemispherical Values

The hemispherical value of a property is determined from the following integral:

<div>$${P_{hemispherical}} = 2\int_0^{\frac{\pi }{2}} {P(\phi )\cos (\phi )\sin (\phi )d\phi } $$</div>

The integral is evaluated by Simpson’s rule for property values at angles of incidence from 0 to 90 degrees in 10-degree increments.

### Optical Properties of Window Shading Devices

Shading devices affect the system transmittance and glass layer absorptance for short-wave radiation and for long-wave (thermal) radiation. The effect depends on the shade position (interior, exterior or between-glass), its transmittance, and the amount of inter-reflection between the shading device and the glazing. Also of interest is the amount of radiation absorbed by the shading device.

In EnergyPlus, shading devices are divided into four categories, “shades,” ”blinds,” “screens,” and “switchable glazing.” “Shades” are assumed to be perfect diffusers. This means that direct radiation incident on the shade is reflected and transmitted as hemispherically uniform diffuse radiation: there is no direct component of transmitted radiation. It is also assumed that the transmittance, *τ<sub>sh</sub>*, reflectance, *ρ<sub>sh</sub>*, and absorptance, *α<sub>sh</sub>*, are the same for the front and back of the shade and are independent of angle of incidence. Many types of drapery and pull-down roller devices are close to being perfect diffusers and can be categorized as “shades.”

“Blinds” in EnergyPlus are slat-type devices such as venetian blinds. Unlike shades, the optical properties of blinds are strongly dependent on angle of incidence. Also, depending on slat angle and the profile angle of incident direct radiation, some of the direct radiation may pass between the slats, giving a direct component of transmitted radiation.

“Screens” are debris or insect protection devices made up of metallic or non-metallic materials. Screens may also be used as shading devices for large glazing areas where excessive solar gain is an issue. The EnergyPlus window screen model assumes the screen is composed of intersecting orthogonally-crossed cylinders, with the surface of the cylinders assumed to be diffusely reflecting. Screens may only be used on the exterior surface of a window construction. As with blinds, the optical properties affecting the direct component of transmitted radiation are dependent on the angle of incident direct radiation.

With “Switchable glazing,” shading is achieved making the glazing more absorbing or more reflecting, usually by an electrical or chemical mechanism. An example is electrochromic glazing where the application of an electrical voltage or current causes the glazing to switch from light to dark.

Shades and blinds can be either fixed or moveable. If moveable, they can be deployed according to a schedule or according to a trigger variable, such as solar radiation incident on the window. Screens can be either fixed or moveable according to a schedule.

#### Shades

#### Shade/Glazing System Properties for Short-Wave Radiation

Short-wave radiation includes

1)   Beam solar radiation from the sun and diffuse solar radiation from the sky and ground incident on the outside of the window,

2)   Beam and/or diffuse radiation reflected from exterior obstructions or the building itself,

3)   Solar radiation reflected from the inside zone surfaces and incident as diffuse radiation on the inside of the window,

4)   Beam solar radiation from one exterior window incident on the inside of another window in the same zone, and

5)   Short-wave radiation from electric lights incident as diffuse radiation on the inside of the window.

**Exterior Shade**

For an exterior shade we have the following expressions for the system transmittance, the effective system glass layer absorptance, and the system shade absorptance, taking inter-reflection between shade and glazing into account. Here, “system” refers to the combination of glazing and shade. The system properties are given in terms of the isolated shade properties (i.e., shade properties in the absence of the glazing) and the isolated glazing properties (i.e., glazing properties in the absence of the shade).

<div>$${T_{sys}}(\phi ) = T_{1,N}^{dif}\frac{{{\tau_{sh}}}}{{1 - R_f^{dif}{\rho_{sh}}}}$$</div>

<div>$$T_{sys}^{dif} = T_{1,N}^{dif}\frac{{{\tau_{sh}}}}{{1 - R_f^{dif}{\rho_{sh}}}}$$</div>

<div>$$A_{j,f}^{sys}(\phi ) = A_{j,f}^{dif}\frac{{{\tau_{sh}}}}{{1 - {R_f}{\rho_{sh}}}},\quad j = 1{\rm{to}}N$$</div>

<div>$$A_{j,f}^{dif,sys} = A_{j,f}^{dif}\frac{{{\tau_{sh}}}}{{1 - {R_f}{\rho_{sh}}}},\quad j = 1{\rm{ to }}N$$</div>

<div>$$A_{j,b}^{dif,sys} = A_{j,b}^{dif}\frac{{T_{1,N}^{dif}{\rho_{sh}}}}{{1 - {R_f}{\rho_{sh}}}},\quad j = 1{\rm{ to }}N$$</div>

<div>$$\alpha_{sh}^{sys} = {\alpha_{sh}}\left( {1 + \frac{{{\tau_{sh}}{R_f}}}{{1 - {R_f}{\rho_{sh}}}}} \right)$$</div>

**Interior Shade**

The system properties when an interior shade is in place are the following.

<div>$${T_{sys}}(\phi ) = T_{1,N}^{}(\phi )\frac{{{\tau_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}$$</div>

<div>$$T_{sys}^{dif} = T_{1,N}^{dif}\frac{{{\tau_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}$$</div>

<div>$$A_{j,f}^{sys}(\phi ) = {A_{j,f}}(\phi ) + {T_{1,N}}(\phi )\frac{{{\rho_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}A_{j,b}^{dif},\quad j = 1{\rm{ to }}N$$</div>

<div>$$A_{j,f}^{dif,sys} = A_{j,f}^{dif} + T_{1,N}^{dif}\frac{{{\rho_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}A_{j,b}^{dif},\quad j = 1{\rm{ to }}N$$</div>

<div>$$A_{j,b}^{dif,sys} = \frac{{{\tau_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}A_{j,b}^{dif},{\rm{    }}j = 1{\rm{ to }}N$$</div>

<div>$$\alpha_{sh}^{sys}(\phi ) = T_{1,N}^{}(\phi )\frac{{{\alpha_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}$$</div>

<div>$$\alpha_{sh}^{dif,sys} = T_{1,N}^{dif}\frac{{{\alpha_{sh}}}}{{1 - R_b^{dif}{\rho_{sh}}}}$$</div>

#### Long-Wave Radiation Properties of Window Shades

Long-wave radiation includes

       Thermal radiation from the sky, ground and exterior obstructions incident on the outside of the window,

       Thermal radiation from other room surfaces incident on the inside of the window, and

       Thermal radiation from internal sources, such as equipment and electric lights, incident on the inside of the window.

The program calculates how much long-wave radiation is absorbed by the shade and by the adjacent glass surface. The system emissivity (thermal absorptance) for an interior or exterior shade, taking into account reflection of long-wave radiation between the glass and shade, is given by

<div>$$\varepsilon_{sh}^{lw,sys} = \varepsilon_{sh}^{lw}\left( {1 + \frac{{\tau_{sh}^{lw}\rho_{gl}^{lw}}}{{1 - \rho_{sh}^{lw}\rho_{gl}^{lw}}}} \right)$$</div>

where <span>$\rho_{gl}^{lw}$</span>is the long-wave reflectance of the outermost glass surface for an exterior shade or the innermost glass surface for an interior shade, and it is assumed that the long-wave transmittance of the glass is zero.

The innermost (for interior shade) or outermost (for exterior shade) glass surface emissivity when the shade is present is

<div>$$\varepsilon_{gl}^{lw,sys} = \varepsilon_{gl}^{lw}\frac{{\tau_{sh}^{lw}}}{{1 - \rho_{sh}^{lw}\rho_{gl}^{lw}}}$$</div>

#### Switchable Glazing

For switchable glazing, such as electrochromics, the solar and visible optical properties of the glazing can switch from a light state to a dark state. The switching factor, *f<sub>switch</sub>*, determines what state the glazing is in. An optical property, *p*, such as transmittance or glass layer absorptance, for this state is given by

<div>$$p = (1 - {f_{switch}}){p_{light}} + {f_{switch}}{p_{dark}}$$</div>

where

*p<sub>light</sub>*is the property value for the unswitched, or light state, and *p<sub>dark</sub>* is the property value for the fully switched, or dark state.

The value of the switching factor in a particular time step depends on what type of switching control has been specified: “schedule,” “trigger,” or “daylighting.” If “schedule,” *f<sub>switch</sub>* = schedule value, which can be 0 or 1.

### Thermochromic Windows

Thermochromic (TC) materials have active, reversible optical properties that vary with temperature. Thermochromic windows are adaptive window systems for incorporation into building envelopes. Thermochromic windows respond by absorbing sunlight and turning the sunlight energy into heat. As the thermochromic film warms it changes its light transmission level from less absorbing to more absorbing. The more sunlight it absorbs the lower the light level going through it. Figure 78 shows the variations of window properties with the temperature of the thermochromic glazing layer. By using the suns own energy the window adapts based solely on the directness and amount of sunlight. Thermochromic materials will normally reduce optical transparency by absorption and/or reflection, and are specular (maintaining vision).

![](EngineeringReference/media/image1015.svg.png)

Figure 78. Variations of Window Properties with the Temperature of the Thermochromic Glazing Layer

On cloudy days the window is at full transmission and letting in diffuse daylighting. On sunny days the window maximizes diffuse daylighting and tints based on the angle of the sun relative to the window. For a south facing window (northern hemisphere) the daylight early and late in the day is maximized and the direct sun at mid day is minimized.

The active thermochromic material can be embodied within a laminate layer or a surface film. The overall optical state of the window at a given time is a function primarily of

* thermochromic material properties

* solar energy incident on the window

* construction of the window system that incorporates the thermochromic layer

* environmental conditions (interior, exterior, air temperature, wind, etc).

The tinted film, in combination with a heat reflecting, low-e layer allows the window to reject most of the absorbed radiation thus reducing undesirable heat load in a building. In the absence of direct sunlight the window cools and clears and again allows lower intensity diffuse radiation into a building. TC windows can be designed in several ways (Figure 79), with the most common being a triple pane windows with the TC glass layer in the middle a double pane windows with the TC layer on the inner surface of the outer pane or for sloped glazing a double pane with the laminate layer on the inner pane with a low-e layer toward the interior. The TC glass layer has variable optical properties depending on its temperature, with a lower temperature at which the optical change is initiated, and an upper temperature at which a minimum transmittance is reached. TC windows act as passive solar shading devices without the need for sensors, controls and power supplies but their optical performance is dependent on varying solar and other environmental conditions at the location of the window.

![](EngineeringReference/media/image1016.png) ![](EngineeringReference/media/image1017.png)

Figure 79. Configurations of Thermochromic Windows

EnergyPlus describes a thermochromic window with a Construction object which references a special layer defined with a WindowMaterial:GlazingGroup:Thermochromic object. The WindowMaterial:GlazingGroup:Thermochromic object further references a series of WindowMaterial:Glazing objects corresponding to each specification temperature of the TC layer. During EnergyPlus run time, a series of TC windows corresponding to each specification temperature is created once. At the beginning of a particular time step calculations, the temperature of the TC glass layer from the previous time step is used to look up the most closed specification temperature whose corresponding TC window construction will be used for the current time step calculations. The current time step calculated temperature of the TC glass layer can be different from the previous time step, but no iterations are done in the current time step for the new TC glass layer temperature. This is an approximation that considers the reaction time of the TC glass layer can be close to EnergyPlus simulation time step say 10 to 15 minutes.

#### Blinds

Window blinds in EnergyPlus are defined as a series of equidistant slats that are oriented horizontally or vertically. All of the slats are assumed to have the same optical properties. The overall optical properties of the blind are determined by the slat geometry (width, separation and angle) and the slat optical properties (front-side and back-side transmittance and reflectance). Blind properties for direct radiation are also sensitive to the “profile angle,” which is the angle of incidence in a plane that is perpendicular to the window plane and to the direction of the slats. The blind optical model in EnergyPlus is based on Simmler, Fischer and Winkelmann, 1996; however, that document has numerous typographical errors and should be used with caution.

The following assumptions are made in calculating the blind optical properties:

* The slats are flat.

* The spectral dependence of inter-reflections between slats and glazing is ignored; spectral-average slat optical properties are used.

* The slats are perfect diffusers. They have a perfectly matte finish so that reflection from a slat is isotropic (hemispherically uniform) and independent of angle of incidence, i.e., the reflection has no specular component. This also means that absorption by the slats is hemispherically uniform with no incidence angle dependence. If the transmittance of a slat is non-zero, the transmitted radiation is isotropic and the transmittance is independent of angle of incidence.

* Inter-reflection between the blind and wall elements near the periphery of the blind is ignored.

* If the slats have holes through which support strings pass, the holes and strings are ignored. Any other structures that support or move the slats are ignored.

#### Slat Optical Properties

The slat optical properties used by EnergyPlus are shown in the following table.

Table 32.  Slat Optical Properties

<table class="table table-striped">
<tr>
<td><span>${\tau_{dir,dif}}$</span>
 </td>
<td>Direct-to-diffuse transmittance (same for front and back of slat)</td>
</tr>
<tr>
<td><span>${\tau_{dif,dif}}$</span>
 </td>
<td>Diffuse-to-diffuse transmittance (same for front and back of slat)</td>
</tr>
<tr>
<td><span>$\rho_{dir,dif}^f{\rm{ , }}\rho_{dir,dif}^b$</span>
 </td>
<td>Front and back direct-to-diffuse reflectance</td>
</tr>
<tr>
<td><span>$\rho_{dif,dif}^f{\rm{ , }}\rho_{dif,dif}^b$</span></td>
<td>Front and back diffuse-to-diffuse reflectance</td>
</tr>

</table>

It is assumed that there is no direct-to-direct transmission or reflection, so that <span>${\tau_{dir,dir}} = 0$</span>, <span>$\rho_{dir,dir}^f = 0$</span>, and <span>$\rho_{dir,dir}^b = 0$</span>. It is further assumed that the slats are perfect diffusers, so that <span>${\tau_{dir,dif}}$</span>, <span>$\rho_{dir,dif}^f$</span>and <span>$\rho_{dir,dif}^b$</span>are independent of angle of incidence. Until the EnergyPlus model is improved to take into account the angle-of-incidence dependence of slat transmission and reflection, it is assumed that <span>${\tau_{dir,dif}}$</span>= <span>${\tau_{dif,dif}}$</span>, <span>$\rho_{dir,dif}^f$</span>=<span>$\rho_{dif,dif}^f$</span>, and <span>$\rho_{dir,dif}^b$</span>=<span>$\rho_{dif,dif}^b$</span>.

#### Direct Transmittance of Blind

The direct-to-direct and direct-to-diffuse transmittance of a blind is calculated using the slat geometry shown in Figure 80 (a), which shows the side view of one of the cells of the blind. For the case shown, each slat is divided into two segments, so that the cell is bounded by a total of six segments, denoted by *s<sub>1</sub>* through *s<sub>6</sub>* (note in the following that *s<sub>i</sub>* refers to both segment *i* and the length of segment *i)*.The lengths of *s<sub>1</sub>* and *s<sub>2</sub>* are equal to the slat separation, *h*, which is the distance between adjacent slat faces. *s<sub>3</sub>* and *s<sub>4</sub>* are the segments illuminated by direct radiation. In the case shown in Figure 80 (a) the cell receives radiation by reflection of the direct radiation incident on *s<sub>4</sub>* and, if the slats have non-zero transmittance, by transmission through *s<sub>3</sub>*, which is illuminated from above.

The goal of the blind direct transmission calculation is to determine the direct and diffuse radiation leaving the cell through *s<sub>2</sub>* for unit direct radiation entering the cell through *s<sub>1</sub>*.

![](EngineeringReference/media/image1034.png)

Figure 80. (a) Side view of a cell formed by adjacent slats showing how the cell is divided into segments, *s<sub>i</sub>*,  for the calculation of direct solar transmittance; (b) side view of a cell showing case where some of the direct solar passes between adjacent slats without touching either of them. In this figure φ<sub>s</sub> is the profile angle and φ<sub>b</sub> is the slat angle.

#### Direct-to-Direct Blind Transmittance

Figure 80 (b) shows the case where some of the direct radiation passes through the cell without hitting the slats. From the geometry in this figure we see that

<div>$$\tau_{bl,f}^{dir,dir} = 1 - \frac{{|w|}}{h},{\rm{       }}|w|{\rm{ }} \le {\rm{ }}h$$</div>

where

<div>$$w = s\frac{{\cos ({\varphi_b} - {\varphi_s})}}{{\cos {\varphi_s}}}$$</div>

Note that we are assuming that the slat thickness is zero. A correction for non-zero slat thickness is described later.

#### Direct-to-Diffuse Blind Transmittance, Reflectance and Absorptance

The direct-to-diffuse and transmittance and reflectance of the blind are calculated using a radiosity method that involves the following three vector quantities:

*J<sub>i</sub>* = the radiosity of segment *s<sub>i</sub>*, i.e., the total radiant flux into the cell from  *s<sub>i</sub>*

*G<sub>i</sub>*= the irradiance on the cell side of *s<sub>i</sub>*

*Q<sub>i</sub>*= the source flux from the cell side of s*<sub>i</sub>*

Based on these definitions we have the following equations that relate *J*, *G* and *Q* for the different segments:

<div>$$
  \begin{array}{rl}
   J_1 &= Q_1 \\
   J_2 &= Q_2 \\
   J_3 &= Q_3 + \rho_{dif,dif}^b G_3 + \tau_{dif,dif} G_4 \\
   J_4 &= Q_4 + \tau_{dif,dif} G_3 + \rho_{dif,dif}^f G_4 \\
   J_5 &= Q_5 + \rho_{dif,dif}^b G_5 + \tau_{dif,dif} G_6 \\
   J_6 &= Q_6 + \tau_{dif,dif} G_5 + \rho_{dif,dif}^f G_6
  \end{array}
$$</div>

In addition we have the following equation relating *G* and* J*:

<div>$${G_i} = \sum\limits_{j = 1}^6 {{J_j}{F_{ji}}{\rm{ ,    }}i = 1,6} $$</div>

where <span>${F_{ji}}$</span>is the view factor between <span>${s_j}$</span>and <span>${s_i}$</span>, i.e., <span>${F_{ji}}$</span>is the fraction of radiation leaving <span>${s_j}$</span>that is intercepted by <span>${s_i}$</span>.

Using <span>${J_1} = {Q_1} = 0$</span>and <span>${J_2} = {Q_2} = 0$</span> and combining the above equations gives the following equation set relating* J* and* Q*:

<div>$${J_3} - \rho_{dif,dif}^b\sum\limits_{j = 3}^6 {{J_j}{F_{j3}} - {\tau_{dif,dif}}\sum\limits_{j = 3}^6 {{J_j}{F_{j4}} = {Q_3}} } $$</div>

<div>$${J_4} - \tau_{dif,dif}^{}\sum\limits_{j = 3}^6 {{J_j}{F_{j3}} - \rho_{dif,dif}^f\sum\limits_{j = 3}^6 {{J_j}{F_{j4}} = {Q_4}} } $$</div>

<div>$${J_5} - \rho_{dif,dif}^b\sum\limits_{j = 3}^6 {{J_j}{F_{j5}} - {\tau_{dif,dif}}\sum\limits_{j = 3}^6 {{J_j}{F_{j6}} = {Q_5}} } $$</div>

<div>$${J_6} - \tau_{dif,dif}^{}\sum\limits_{j = 3}^6 {{J_j}{F_{j3}} - \rho_{dif,dif}^f\sum\limits_{j = 3}^6 {{J_j}{F_{j6}} = {Q_6}} } $$</div>

This can be written in the form

<div>$$Q' = XJ'$$</div>

where *X* is a 4x4 matrix and

<div>$$
  J' = \left[ \begin{array}
   J_3 \\
   J_4 \\
   J_5 \\
   J_6 \end{array} \right]
$$</div>  
  
<div>$$
  Q' = \left[ \begin{array}
    Q_3 \\
    Q_4 \\
    Q_5 \\
    Q_6 \end{array} \right]
$$</div>

We then obtain <span>$J'$</span> from

<div>$$J' = {X^{ - 1}}Q'$$</div>

The view factors, <span>${F_{ij}}$</span>, are obtained as follows. The cell we are dealing with is a convex polygon with *n* sides. In such a polygon the view factors must satisfy the following constraints:

<div>$$\sum\limits_{j = 1}^n {{F_{ij}} = 1{\rm{,  }}i = 1,n} $$</div>

<div>$${s_i}{F_{ij}} = {s_j}{F_{ji}}{\rm{,  }}i = 1,n{\rm{;  }}j = 1,n$$</div>

<div>$${F_{ii}} = 0{\rm{,  }}i = 1,n$$</div>

These constraints lead to simple equations for the view factors for* n* = 3 and 4. For *n* = 3, we have the following geometry and view factor expression:

![WindowHB\_1](EngineeringReference/media/image1059.png)

For  *n* = 4  we have:

![WindowHB\_2](EngineeringReference/media/image1060.png)

Applying these to the slat cell shown in Figure 81 we have the following:

<div>$${F_{12}} = \frac{{{d_1} + {d_2} - 2s}}{{2h}}$$</div>

<div>$${F_{13}} = \frac{{h + {s_3} - {d_3}}}{{2h}}{\rm{ ,  etc}}{\rm{.}}$$</div>

![](EngineeringReference/media/image1063.png)

Figure 81. Slat cell showing geometry for calculation of view factors between the segments of the cell.

The sources for the direct-to-diffuse transmittance calculation are:

<div>$${Q_1} = {Q_2} = {Q_5} = {Q_6} = 0 \;  (and therefore) {J_1} = {J_2} = 0$$</div>

<div>$$
  \left. 
    \begin{array}{l}
      Q_3 = \tau_{dir,dif} \\
      Q_4 = \rho_{dir,dif}^f 
    \end{array} 
  \right\} 
  \;
  \varphi_b \le \varphi_s + \frac{\pi }{2} 
  \;
  \rm{ (beam hits front of slats)}
$$</div>

<div>$$
  \left.
    \begin{array}{l}
      Q_3 = \rho_{dir,dif}^b \\
      Q_4 = \tau_{dir,dif}
    \end{array}
  \right\}
  \;
  \varphi_b \gt \varphi_s + \frac{\pi }{2}
  \;
  \rm{ (beam hits back of slats)}
$$</div>

For unit incident direct flux, the front direct-to-diffuse transmittance and reflectance of the blind are:

<div>$$\begin{array}{l}\tau_{bl,f}^{dir,dif} = {G_2}\\\rho_{bl,f}^{dir,dif} = {G_1}\end{array}$$</div>

where

<div>$$
  \begin{array}{l}
    G_2 = \sum_{j=3}^6 J_j F_{j2} \\
    G_1 = \sum_{j=3}^6 J_j F_{j1} 
  \end{array}
$$</div>

and <span>${J_3}$</span>to <span>${J_6}$</span>are given by Eq. .  

The front direct absorptance of the blind is then

<div>$$\alpha_{bl,f}^{dir} = 1 - \tau_{bl,f}^{dir,dif} - \tau_{bl,f}^{dir,dir} - \rho_{bl,f}^{dir,dif}$$</div>

The direct-to-diffuse calculations are performed separately for solar and visible slat properties to get the corresponding solar and visible blind properties.

#### Dependence on Profile Angle

The direct-to-direct and direct-to-diffuse blind properties are calculated for direct radiation profile angles (see Figure 80) ranging from –90<sup>O</sup> to +90<sup>O</sup> in 5<sup>O</sup> increments. (The “profile angle” is the angle of incidence in a plane that is perpendicular to the window *and* perpendicular to the slat direction.) In the time step loop the blind properties for a particular profile angle are obtained by interpolation.

#### Dependence on Slat Angle

All blind properties are calculated for slat angles ranging from –90<sup>O</sup> to +90<sup>O</sup> in 10<sup>O</sup> increments. In the time-step loop the slat angle is determined by the slat-angle control mechanism and then the blind properties at that slat angle are determined by interpolation. Three slat-angle controls are available: (1) slat angle is adjusted to just block beam solar incident on the window; (2) slat angle is determined by a schedule; and (3) slat angle is fixed.

#### Diffuse-to-Diffuse Transmittance and Reflectance of Blind

To calculate the diffuse-to-diffuse properties, assuming uniformly distributed incident diffuse radiation, each slat bounding the cell is divided into two segments of equal length (Figure 82), i.e., <span>${s_3} = {s_4}$</span>and <span>${s_5} = {s_6}$</span>.  For front-side properties we have a unit source, <span>${Q_1} = 1$</span>.  All the other <span>${Q_i}$</span>are zero. Using this source value, we apply the methodology described above to obtain *G<sub>2</sub>*and *G<sub>1</sub>*. We then have

<div>$$\begin{array}{l}\tau_{bl,f}^{dif,dif} = {G_2}\\\rho_{bl,f}^{dif,dif} = {G_1}\\\alpha_{bl,f}^{dif} = 1 - \tau_{bl,f}^{dif,dif} - \rho_{bl,f}^{dif,dif}\end{array}$$</div>

The back-side properties are calculated in a similar way by setting *Q<sub>2</sub>* = 1 with the other <span>${Q_i}$</span>equal to zero.

The diffuse-to-diffuse calculations are performed separately for solar, visible and IR slat properties to get the corresponding solar, visible and IR blind properties.

![](EngineeringReference/media/image1078.png)

Figure 82. Slat cell showing arrangement of segments and location of source for calculation of diffuse-to-diffuse optical properties.

#### Blind properties for sky and ground diffuse radiation

For horizontal slats on a vertical window (the most common configuration) the blind diffuse-to-diffuse properties will be sensitve to whether the radiation is incident upward from the ground or downward from the sky (Figure 83). For this reason we also calculate the following solar properties for a blind consisting of horizontal slats in a vertical plane:

<span>$\tau_{bl,f}^{gnd - dif,dif} = {\rm{ }}$</span>front transmittance for ground diffuse solar

<span>$\tau_{bl,f}^{sky - dif,dif} = {\rm{ }}$</span>front transmittance for sky diffuse solar

<span>${\rm{ }}\rho_{bl,f}^{gnd - dif,dif} = $</span>front reflectance for ground diffuse solar

<span>$\rho_{bl,f}^{sky - dif,dif} = {\rm{ }}$</span>front reflectance for sky diffuse solar

<span>$\alpha_{bl,f}^{gnd - dif,dif} = {\rm{ }}$</span>front absorptance for ground diffuse solar

<span>$\alpha_{bl,f}^{sky - dif,dif} = {\rm{ }}$</span>front absorptance for sky diffuse solar

These are obtained by integrating over sky and ground elements, as shown in Figure 83, treating each element as a source of direct radiation of irradiance <span>$I({\phi_s})$</span> incident on the blind at profile angle <span>${\phi_s}$</span>. This gives:

<div>$$\tau_{bl,f}^{sky - dif,dif} = \frac{{\int\limits_0^{\pi /2} {\left[ {\tau_{bl,f}^{dir,dir}({\phi_s}) + \tau_{bl,f}^{dir,dif}({\phi_s})} \right]{I_{sky}}({\phi_s})\cos {\phi_s}d{\phi_s}} }}{{\int\limits_0^{\pi /2} {{I_{sky}}({\phi_s})\cos {\phi_s}d{\phi_s}} }}$$</div>

<div>$$\rho_{bl,f}^{sky - dif,dif} = \frac{{\int\limits_0^{\pi /2} {\rho_{bl,f}^{dir,dif}{I_{sky}}({\phi_s})\cos {\phi_s}d{\phi_s}} }}{{\int\limits_0^{\pi /2} {{I_{sky}}({\phi_s})\cos {\phi_s}d{\phi_s}} }}$$</div>

<div>$$\alpha_{bl,f}^{sky - dif} = \frac{{\int\limits_0^{\pi /2} {\alpha_{bl,f}^{dir}{I_{sky}}({\phi_s})\cos {\phi_s}d{\phi_s}} }}{{\int\limits_0^{\pi /2} {{I_{sky}}({\phi_s})\cos {\phi_s}d{\phi_s}} }}$$</div>

![](EngineeringReference/media/image1090.png)

Figure 83.  Side view of horizontal slats in a vertical blind showing geometry for calculating blind transmission, reflection and absorption properties for sky and ground diffuse radiation.

We assume that the sky radiance is uniform. This means that <span>${I_{sky}}$</span>is independent of <span>${\phi_s}$</span>, giving:

<div>$$\tau_{bl,f}^{sky - dif,dif} = \int\limits_0^{\pi /2} {\left[ {\tau_{bl,f}^{dir,dir} + \tau_{bl,f}^{dir,dif}} \right]\cos {\phi_s}d{\phi_s}} $$</div>

<div>$$\rho_{bl,f}^{sky - dif,dif} = \int\limits_0^{\pi /2} {\rho_{bl,f}^{dir,dif}\cos {\phi_s}d{\phi_s}} $$</div>

<div>$$\alpha_{bl,f}^{sky - dif} = \int\limits_0^{\pi /2} {\alpha_{bl,f}^{dir}\cos {\phi_s}d{\phi_s}} $$</div>

The corresponding ground diffuse quantities are obtained by integrating <span>${\phi_s}$</span> from <span>$ - \pi /2$</span> to 0.

An improvement to this calculation would be to allow the sky radiance distribution to be non-uniform, i.e.,  to depend on sun position and sky conditions, as is done in the detailed daylighting calculation (see “Sky Luminance Distributions” under “Daylight Factor Calculation”).

#### Correction Factor for Slat Thickness

A correction has to be made to the blind transmittance, reflectance and absorptance properties to account for the amount of radiation incident on a blind that is reflected and absorbed by the slat edges (the slats are assumed to be opaque to radiation striking the slat edges). This is illustrated in Figure 84 for the case of direct radiation incident on the blind. The slat cross-section is assumed to be rectangular. The quantity of interest is the fraction, *f<sub>edge</sub>*, of direct radiation incident on the blind that strikes the slat edges. Based on the geometry shown in Figure 84 we see that

<div>$${f_{edge}} = \frac{{t\cos \gamma }}{{\left( {h + \frac{t}{{\cos \xi }}} \right)\cos {\varphi_s}}} = \frac{{t\cos ({\varphi_s} - \xi )}}{{\left( {h + \frac{t}{{\cos \xi }}} \right)\cos {\varphi_s}}} = \frac{{t\sin ({\varphi_b} - {\varphi_s})}}{{\left( {h + \frac{t}{{\sin {\varphi_b}}}} \right)\cos {\varphi_s}}}$$</div>

The edge correction factor for diffuse incident radiation is calculated by averaging this value of *f<sub>edge</sub>* over profile angles, *φ<sub>s</sub>*, from –90<sup>O</sup> to +90<sup>O</sup>.

As an example of how the edge correction factor is applied, the following two equations show how blind front diffuse transmittance and reflectance calculated assuming zero slat thickness are modified by the edge correction factor. It is assumed that the edge transmittance is zero and that the edge reflectance is the same as the slat front reflectance, *ρ<sub>f</sub>*.

<div>$$\begin{array}{l}\tau_{bl,f}^{dif,dif} \to \tau_{bl,f}^{dif,dif}\left( {1 - {f_{edge}}} \right)\\\rho_{bl,f}^{dif} \to \rho_{bl,f}^{dif}\left( {1 - {f_{edge}}} \right) + {f_{edge}}{\rho_f}\end{array}$$</div>

![](EngineeringReference/media/image1100.png)

Figure 84. Side view of slats showing geometry for calculation of slat edge correction factor for incident direct radiation.

#### Comparison with ISO 15099 Calculation of Blind Optical Properties

Table 33 compares EnergyPlus and ISO 15099 [2001] calculations of blind optical properties for a variety of profile angles, slat angles and slat optical properties. The ISO 15099 calculation method is similar to that used in EnergyPlus, except that the slats are divided into five equal segments. The ISO 15099 and EnergyPlus results agree to within 12%, except for the solar transmittances for the 10-degree slat angle case. Here the transmittances are small (from 1% to about 5%) but differ by about a factor of up to two between ISO 15099 and EnergyPlus. This indicates that the slats should be divided into more than two segments at small slat angles.



Table 33. Comparison of blind optical properties calculated with the EnergyPlus and ISO 15099 methods. EnergyPlus values that differ by more than 12% from ISO 15099 values are shown in bold italics.

<table class="table table-striped">
  <tr>
    <th colspan="11">Slat Properties</th>
  </tr>
  <tr>
    <td>Separation (m)</td>
    <td colspan="2">0.012</td>
    <td colspan="2">0.012</td>
    <td colspan="2">0.012</td>
    <td colspan="2">0.012</td>
    <td colspan="2">0.012</td>
  </tr>
  <tr>
    <td>Width (m)</td>
    <td colspan="2">0.016</td>
    <td colspan="2">0.016</td>
    <td colspan="2">0.016</td>
    <td colspan="2">0.016</td>
    <td colspan="2">0.016</td>
  </tr>
  <tr>
    <td>Angle (deg)</td>
    <td colspan="2">45</td>
    <td colspan="2">45</td>
    <td colspan="2">45</td>
    <td colspan="2">10</td>
    <td colspan="2">45</td>
  </tr>
  <tr>
    <td>IR transmittance</td>
    <td colspan="2">0</td>
    <td colspan="2">0</td>
    <td colspan="2">0</td>
    <td colspan="2">0</td>
    <td colspan="2">0.4</td>
  </tr>
  <tr>
    <td>IR emissivity, front side</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.55</td>
  </tr>
  <tr>
    <td>IR emissivity, back side</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.9</td>
    <td colspan="2">0.55</td>
  </tr>
  <tr>
    <td>Solar transmittance</td>
    <td colspan="2">0</td>
    <td colspan="2">0</td>
    <td colspan="2">0</td>
    <td colspan="2">0</td>
    <td colspan="2">0.4</td>
  </tr>
  <tr>
    <td>Solar reflectance, front side</td>
    <td colspan="2">0.7</td>
    <td colspan="2">0.55</td>
    <td colspan="2">0.7</td>
    <td colspan="2">0.7</td>
    <td colspan="2">0.5</td>
  </tr>
  <tr>
    <td>Solar reflectance, back side</td>
    <td colspan="2">0.7</td>
    <td colspan="2">0.55</td>
    <td colspan="2">0.4</td>
    <td colspan="2">0.4</td>
    <td colspan="2">0.5</td>
  </tr>
  <tr>
    <td colspan="11"></td>
  </tr>
  <tr>
    <td>Solar Profile angle (deg)</td>
    <td>0</td>
    <td>60</td>
    <td>0</td>
    <td>60</td>
    <td>0</td>
    <td>60</td>
    <td>0</td>
    <td>60</td>
    <td>0</td>
    <td>60</td>
  </tr>
  <tr>
    <td colspan="11"></td>
  </tr>
  <tr>
    <td colspan="11">Calculated blind properties (first row = ISO 15099 calculation, second row (in italics) = EnergyPlus calculation)</td>
  </tr>
  <tr>
    <td rowspan="2">Front solar transmittance, direct to Direct</td>
    <td>0.057</td>
    <td>0</td>
    <td>0.057</td>
    <td>0</td>
    <td>0.057</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>0.057</td>
    <td>0</td>
  </tr>
  <tr>
    <td>0.057</td>
    <td>0</td>
    <td>0.057</td>
    <td>0</td>
    <td>0.057</td>
    <td>0</td>
    <td>0</td>
    <td>0</td>
    <td>0.057</td>
    <td>0</td>
  </tr>
  <tr>
    <td rowspan="2">Back solar transmittance, direct to direct</td>
    <td>0.057</td>
    <td>0.31</td>
    <td>0.057</td>
    <td>0.31</td>
    <td>0.057</td>
    <td>0.31</td>
    <td>0</td>
    <td>0.088</td>
    <td>0.057</td>
    <td>0.31</td>
  </tr>
  <tr>
    <td>0.057</td>
    <td>0.309</td>
    <td>0.057</td>
    <td>0.309</td>
    <td>0.057</td>
    <td>0.309</td>
    <td>0</td>
    <td>0.087</td>
    <td>0.057</td>
    <td>0.309</td>
  </tr>
  <tr>
    <td rowspan="2">Front solar transmittance, direct to diffuse</td>
    <td>0.141</td>
    <td>0.073</td>
    <td>0.09</td>
    <td>0.047</td>
    <td>0.096</td>
    <td>0.051</td>
    <td>0.012</td>
    <td>0.005</td>
    <td>0.373</td>
    <td>0.277</td>
  </tr>
  <tr>
    <td>0.155</td>
    <td>0.074</td>
    <td>0.1</td>
    <td>0.048</td>
    <td>0.104</td>
    <td>0.051</td>
    <td>0.019</td>
    <td>0.006</td>
    <td>0.375</td>
    <td>0.275</td>
  </tr>
  <tr>
    <td rowspan="2">Back solar transmittance, direct to diffuse</td>
    <td>0.141</td>
    <td>0.288</td>
    <td>0.09</td>
    <td>0.216</td>
    <td>0.076</td>
    <td>0.271</td>
    <td>0.011</td>
    <td>0.027</td>
    <td>0.373</td>
    <td>0.306</td>
  </tr>
  <tr>
    <td>0.155</td>
    <td>0.284</td>
    <td>0.1</td>
    <td>0.214</td>
    <td>0.085</td>
    <td>0.269</td>
    <td>0.019</td>
    <td>0.052</td>
    <td>0.375</td>
    <td>0.304</td>
  </tr>
  <tr>
    <td rowspan="2">Front solar reflectance, direct to diffuse</td>
    <td>0.394</td>
    <td>0.558</td>
    <td>0.295</td>
    <td>0.43</td>
    <td>0.371</td>
    <td>0.544</td>
    <td>0.622</td>
    <td>0.678</td>
    <td>0.418</td>
    <td>0.567</td>
  </tr>
  <tr>
    <td>0.389</td>
    <td>0.558</td>
    <td>0.293</td>
    <td>0.431</td>
    <td>0.368</td>
    <td>0.546</td>
    <td>0.636</td>
    <td>0.679</td>
    <td>0.416</td>
    <td>0.568</td>
  </tr>
  <tr>
    <td rowspan="2">Back solar reflectance, direct to diffuse</td>
    <td>0.394</td>
    <td>0.103</td>
    <td>0.295</td>
    <td>0.066</td>
    <td>0.216</td>
    <td>0.07</td>
    <td>0.356</td>
    <td>0.273</td>
    <td>0.418</td>
    <td>0.273</td>
  </tr>
  <tr>
    <td>0.389</td>
    <td>0.115</td>
    <td>0.293</td>
    <td>0.074</td>
    <td>0.214</td>
    <td>0.077</td>
    <td>0.363</td>
    <td>0.272</td>
    <td>0.416</td>
    <td>0.275</td>
  </tr>
  <tr>
    <td rowspan="2">Front solar transmittance, hemispherical diffuse to diffuse</td>
    <td>0.332</td>
    <td></td>
    <td>0.294</td>
    <td></td>
    <td>0.291</td>
    <td></td>
    <td>0.038</td>
    <td></td>
    <td>0.495</td>
    <td></td>
  </tr>
  <tr>
    <td>0.338</td>
    <td></td>
    <td>0.298</td>
    <td></td>
    <td>0.295</td>
    <td></td>
    <td>0.053</td>
    <td></td>
    <td>0.502</td>
    <td></td>
  </tr>
  <tr>
    <td rowspan="2">Back solar transmittance, hemispherical diffuse to diffuse</td>
    <td>0.332</td>
    <td></td>
    <td>0.294</td>
    <td></td>
    <td>0.291</td>
    <td></td>
    <td>0.038</td>
    <td></td>
    <td>0.495</td>
    <td></td>
  </tr>
  <tr>
    <td>0.338</td>
    <td></td>
    <td>0.298</td>
    <td></td>
    <td>0.295</td>
    <td></td>
    <td>0.053</td>
    <td></td>
    <td>0.502</td>
    <td></td>
  </tr>
  <tr>
    <td rowspan="2">Front hemispherical IR transmittance</td>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.0245</td>
    <td></td>
    <td>0.385</td>
    <td></td>
  </tr>
  <tr>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.025</td>
    <td></td>
    <td>0.387</td>
    <td></td>
  </tr>
  <tr>
    <td rowspan="2">Back hemispherical IR transmittance</td>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.0245</td>
    <td></td>
    <td>0.385</td>
    <td></td>
  </tr>
  <tr>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.227</td>
    <td></td>
    <td>0.025</td>
    <td></td>
    <td>0.387</td>
    <td></td>
  </tr>
  <tr>
    <td rowspan="2">Front hemispherical IR emissivity</td>
    <td>0.729</td>
    <td></td>
    <td>0.729</td>
    <td></td>
    <td>0.729</td>
    <td></td>
    <td>0.89</td>
    <td></td>
    <td>0.536</td>
    <td></td>
  </tr>
  <tr>
    <td>0.73</td>
    <td></td>
    <td>0.73</td>
    <td></td>
    <td>0.73</td>
    <td></td>
    <td>0.895</td>
    <td></td>
    <td>0.534</td>
    <td></td>
  </tr>
  <tr>
    <td rowspan="2">Back hemispherical IR emissivity</td>
    <td>0.729</td>
    <td></td>
    <td>0.729</td>
    <td></td>
    <td>0.729</td>
    <td></td>
    <td>0.89</td>
    <td></td>
    <td>0.536</td>
    <td></td>
  </tr>
  <tr>
    <td>0.73</td>
    <td></td>
    <td>0.73</td>
    <td></td>
    <td>0.73</td>
    <td></td>
    <td>0.895</td>
    <td></td>
    <td>0.534</td>
    <td></td>
  </tr>
</table>

#### Blind/Glazing System Properties for Short-Wave Radiation

When a blind is in place we have the following expressions for the system transmittance, the system glass layer absorptance, and the system blind absorptance, taking inter-reflection between blind and glazing into account. The system properties, indicated by “sys,” are given in terms of the isolated blind properties (i.e., blind properties in the absence of the glazing)—indicated by “bl” —and the isolated glazing properties (i.e., glazing properties in the absence of the blind)—indicated by “gl.”

#### Interior Blind

The system properties when an interior blind is in place are the following:

<div>$$T_{f,sys}^{dir,all}(\phi ,{\phi_s}) = T_{gl}^{dir}(\phi )\left( {\tau_{bl,f}^{dir,dir}({\phi_s}) + \tau_{bl,f}^{dir,dif}({\phi_s}) + \frac{{\tau_{bl,f}^{dif}\rho_{bl,f}^{dir,dif}({\phi_s})R_{gl,b}^{dif}}}{{1 - \rho_{bl,f}^{dif}R_{gl,b}^{dif}}}} \right)$$</div>

<div>$$A_{gl,j,f}^{dir,sys}(\phi ,{\phi_s}) = A_{gl,j,f}^{dir}(\phi ) + \frac{{T_{gl}^{dir}(\phi )\alpha_{gl,j,b}^{dif}\rho_{bl,f}^{dir}({\phi_s})}}{{1 - \rho_{bl,f}^{dir}({\phi_s})R_{gl,b}^{dif}}}{\rm{,    }}j = 1,N$$</div>

<div>$$\alpha_{bl,f}^{dir,sys}(\phi ,{\phi_s}) = T_{gl}^{dir}(\phi )\left( {\alpha_{bl,f}^{dir}({\phi_s}) + \frac{{\rho_{bl,f}^{dir}({\phi_s})R_{gl,b}^{dif}\alpha_{bl,f}^{dif}}}{{1 - \rho_{bl,f}^{dif}R_{gl,b}^{dif}}}} \right)$$</div>

<div>$$T_{f,sys}^{dif,dif} = \frac{{T_{gl}^{dif}\tau_{bl,f}^{dif,dif}}}{{1 - \rho_{bl,f}^{dif}R_{gl,b}^{dif}}}$$</div>



<div>$$T_{f,sys}^{sky - dif,dif} = \frac{{T_{gl}^{dif}\tau_{bl,f}^{sky - dif,dif}}}{{1 - \rho_{bl,f}^{sky - dif}R_{gl,b}^{dif}}}$$</div>

<div>$$T_{f,sys}^{gnd - dif,dif} = \frac{{T_{gl}^{dif}\tau_{bl,f}^{gnd - dif,dif}}}{{1 - \rho_{bl,f}^{gnd - dif}R_{gl,b}^{dif}}}$$</div>

<div>$$A_{gl,j,f}^{dif,sys} = A_{gl,j,f}^{dif} + \frac{{T_{gl}^{dif}\rho_{bl,f}^{dif}A_{gl,j,b}^{dif}}}{{1 - \rho_{bl,f}^{dif}R_{gl,b}^{dif}}}{\rm{,    }}j = 1,N$$</div>

<div>$$A_{gl,j,f}^{sky - dif,sys} = A_{gl,j,f}^{dif} + \frac{{T_{gl}^{dif}\rho_{bl,f}^{sky - dif}A_{gl,j,b}^{dif}}}{{1 - \rho_{bl,f}^{sky - dif}R_{gl,b}^{dif}}}{\rm{,    }}j = 1,N$$</div>

<div>$$A_{gl,j,f}^{gnd - dif,sys} = A_{gl,j,f}^{dif} + \frac{{T_{gl}^{dif}\rho_{bl,f}^{gnd - dif}A_{gl,j,b}^{dif}}}{{1 - \rho_{bl,f}^{gnd - dif}R_{gl,b}^{dif}}}{\rm{,    }}j = 1,N$$</div>

<div>$$\alpha_{bl,f}^{dif,sys} = \frac{{T_{gl}^{dif}\alpha_{bl,f}^{dif}}}{{1 - \rho_{bl,f}^{dif}R_{gl,b}^{dif}}}$$</div>

<div>$$\alpha_{bl,f}^{sky - dif,sys} = \frac{{T_{gl}^{dif}\alpha_{bl,f}^{sky - dif}}}{{1 - \rho_{bl,f}^{sky - dif}R_{gl,b}^{dif}}}$$</div>

<div>$$\alpha_{bl,f}^{gnd - dif,sys} = \frac{{T_{gl}^{dif}\alpha_{bl,f}^{gnd - dif}}}{{1 - \rho_{bl,f}^{gnd - dif}R_{gl,b}^{dif}}}$$</div>

#### Exterior Blind

The system properties when an exterior blind is in place are the following:

<div>$$T_{f,sys}^{dir,all}(\phi ,{\phi_s}) = \tau_{bl,f}^{dir,dir}({\phi_s})\left( {T_{gl}^{dir}(\phi ) + \frac{{T_{gl}^{dif}R_{gl,f}^{dir}\rho_{bl,b}^{dir,dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}} \right) + \frac{{\tau_{bl}^{dir,dif}({\phi_s})T_{gl}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}$$</div>

<div>$$
  A_{gl,j,f}^{dir,sys}(\phi ,\phi_s) = 
     \tau_{bl,f}^{dir,dir}(\phi_s) A_{gl,j,f}^{dir}(\phi ) + 
     \frac{
       \left(
         \tau_{bl,f}^{dir,dir}(\phi_s) R_{gl}^{dir}(\phi) \rho_{bl,b}^{dir}(\phi_s)+ \tau_{bl,f}^{dir,dif}(\phi_s)
       \right) A_{gl,j,f}^{dif}
     } {
       1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}
     },\;j = 1,N
$$</div>

<div>$$
  \alpha_{bl,f}^{dir,sys}(\phi ,\phi_s) = 
     \alpha_{bl,f}^{dir}(\phi_s) + 
     \alpha_{bl,b}^{dir}(\phi_s) R_{gl,f}^{dir}(\phi) \tau_{bl,f}^{dir,dir}(\phi_s) + 
     \frac{
       \alpha_{bl,b}^{dif}R_{gl,f}^{dif}
     }{
       1 - \rho_{bl,b}^{dif} R_{gl,f}^{dif}
     }
     \left(
       R_{gl,f}^{dir}(\phi) \tau_{bl,f}^{dir,dir}(\phi_s) \rho_{bl,b}^{dir}(\phi_s) + \tau_{bl,f}^{dir,dif}(\phi_s) 
     \right)
$$</div>

<div>$$T_{f,sys}^{dif,dif} = \frac{{\tau_{bl,f}^{dif,dif}T_{gl}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}$$</div>

<div>$$T_{f,sys}^{sky - dif,dif} = \frac{{\tau_{bl,f}^{sky - dif,dif}T_{gl}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}$$</div>

<div>$$T_{f,sys}^{gnd - dif,dif} = \frac{{\tau_{bl,f}^{gnd - dif,dif}T_{gl}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}$$</div>

<div>$$A_{gl,j,f}^{dif,sys} = \frac{{\tau_{bl,f}^{dif,dif}A_{gl,j,f}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}},{\rm{    }}j = 1,N$$</div>

<div>$$A_{gl,j,f}^{sky - dif,sys} = \frac{{\tau_{bl,f}^{sky - dif,dif}A_{gl,j,f}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}},{\rm{    }}j = 1,N$$</div>

<div>$$A_{gl,j,f}^{gnd - dif,sys} = \frac{{\tau_{bl,f}^{gnd - dif,dif}A_{gl,j,f}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}},{\rm{    }}j = 1,N$$</div>

<div>$$\alpha_{bl,f}^{dif,sys} = \alpha_{bl,f}^{dif} + \frac{{\tau_{bl,f}^{dif,dif}R_{gl,f}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}\alpha_{bl,b}^{dif}$$</div>

<div>$$\alpha_{bl,f}^{sky - dif,sys} = \alpha_{bl,f}^{sky - dif} + \frac{{\tau_{bl,f}^{sky - dif,dif}R_{gl,f}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}\alpha_{bl,b}^{dif}$$</div>

<div>$$\alpha_{bl,f}^{gnd - dif,sys} = \alpha_{bl,f}^{gnd - dif} + \frac{{\tau_{bl,f}^{gnd - dif,dif}R_{gl,f}^{dif}}}{{1 - R_{gl,f}^{dif}\rho_{bl,b}^{dif}}}\alpha_{bl,b}^{dif}$$</div>

#### Blind/Glazing System Properties for Long-Wave Radiation

The program calculates how much long-wave radiation is absorbed by the blind and by the adjacent glass surface. The effective emissivity (long-wave absorptance) of an interior or exterior blind, taking into account reflection of long-wave radiation between the glass and blind, is given by

<div>$$\varepsilon_{bl}^{lw,eff} = \varepsilon_{bl}^{lw}\left( {1 + \frac{{\tau_{bl}^{lw}\rho_{gl}^{lw}}}{{1 - \rho_{bl}^{lw}\rho_{gl}^{lw}}}} \right)$$</div>

where <span>$\rho_{gl}^{lw}$</span>is the long-wave reflectance of the outermost glass surface for an exterior blind or the innermost glass surface for an interior blind, and it is assumed that the long-wave transmittance of the glass is zero.

The effective innermost (for interior blind) or outermost (for exterior blind) glass surface emissivity when the blind is present is

<div>$$\varepsilon_{gl}^{lw,eff} = \varepsilon_{gl}^{lw}\frac{{\tau_{bl}^{lw}}}{{1 - \rho_{bl}^{lw}\rho_{gl}^{lw}}}$$</div>

The effective inside surface emissivity is the sum of the effective blind and effective glass emissivities:

<div>$$\varepsilon_{ins}^{lw,eff} = \varepsilon_{bl}^{lw,eff} + \varepsilon_{gl}^{lw,eff}$$</div>

The effective temperature of the blind/glazing combination that is used to calculate the window’s contribution to the zone’s mean radiant temperature (MRT) is given by

<div>$$T_{}^{eff} = \frac{{\varepsilon_{bl}^{lw,eff}{T_{bl}} + \varepsilon_{gl}^{lw,eff}{T_{gl}}}}{{\varepsilon_{bl}^{lw,eff} + \varepsilon_{gl}^{lw,eff}}}$$</div>



#### Solar Radiation Transmitted and Absorbed by a Window/Blind System

Let the direct solar incident on the window be

<div>$${I_{dir,inc}} = {f_{sunlit}}{I_{dir,norm}}\cos \phi {\rm{    }}(W/{m^2})$$</div>

where <span>${f_{sunlit}}$</span>is the fraction of the window that is sunlit (determined by the shadowing calculations), <span>${I_{dir,norm}}$</span>is the direct normal solar irradiance, and <span>$\phi $</span> is the angle of incidence.

Let <span>${I_{sky,inc}}$</span>be the irradiance on the window due to diffuse solar radiation from the sky (W/m<sup>2</sup>) and let <span>${I_{gnd,inc}}$</span>be the irradiance on the window due to diffuse solar radiation from the ground (W/m<sup>2</sup>).

Then we have the following expressions for different classes of transmitted and absorbed solar radiation for the window/blind system (where <span>${\phi_s}$</span>is the direct solar profile angle), all in W/m<sup>2</sup>:

*Direct solar entering zone from incident direct solar:*

<div>$${I_{dir,inc}}T_{f,sys}^{dir,dir}(\phi ,{\phi_s})$$</div>

*Diffuse solar entering zone from incident direct solar:*

<div>$${I_{dir,inc}}T_{f,sys}^{dir,dif}(\phi ,{\phi_s})$$</div>

*Direct solar absorbed by blind:*

<div>$${I_{dir,inc}}\alpha_{bl,f}^{dir,sys}(\phi ,{\phi_s})$$</div>

*Direct solar absorbed by glass layers:*

<div>$${I_{dir,inc}}A_{gl,j,f}^{dir,sys}(\phi ,{\phi_s}),{\rm{    }}j = 1,N$$</div>

#### For windows whose blinds have vertical slats:

*Diffuse solar entering zone from incident diffuse solar:*

<div>$$({I_{sky,inc}} + {I_{gnd,inc}})T_{f,sys}^{dif,dif}$$</div>

*Diffuse solar absorbed by blind:*

<div>$$({I_{sky,inc}} + {I_{gnd,inc}})\alpha_{bl,f}^{dif,sys}$$</div>

*Diffuse solar absorbed by glass layers:*

<div>$$({I_{sky,inc}} + {I_{gnd,inc}})A_{gl,j,f}^{dif,sys},{\rm{   }}j = 1,N{\rm{ }}$$</div>

#### For windows of tilt angle <span>$\gamma $</span> whose blinds have horizontal slats:

(vertical windows have tilt = 90<sup>O</sup>, horizontal windows have tilt = 0<sup>O</sup>)

*Diffuse solar entering zone from incident diffuse solar:*

**<span>$T_{f,sys}^{sky - dif,dif}\left[ {\left( {1 - \frac{{|\cos \gamma |}}{2}} \right){I_{sky,inc}} + \frac{{|\cos \gamma |}}{2}{I_{gnd,inc}}} \right] + T_{f,sys}^{gnd - dif,dif}\left[ {\frac{{|\cos \gamma |}}{2}{I_{sky,inc}} + \left( {1 - \frac{{|\cos \gamma |}}{2}} \right){I_{gnd,inc}}} \right]$</span>**

*Diffuse solar absorbed by blind:*

<div>$$\alpha_{bl,f}^{sky - dif,sys}\left[ {\left( {1 - \frac{{|\cos \gamma |}}{2}} \right){I_{sky,inc}} + \frac{{|\cos \gamma |}}{2}{I_{gnd,inc}}} \right] + \alpha_{bl,f}^{gnd - dif,sys}\left[ {\frac{{|\cos \gamma |}}{2}{I_{sky,inc}} + \left( {1 - \frac{{|\cos \gamma |}}{2}} \right){I_{gnd,inc}}} \right]$$</div>

*Diffuse solar absorbed by glass layers:*

<div>$$\begin{array}{l}A_{gl,j,f}^{sky - dif,sys}\left[ {\left( {1 - \frac{{|\cos \gamma |}}{2}} \right){I_{sky,inc}} + \frac{{|\cos \gamma |}}{2}{I_{gnd,inc}}} \right] + \\A_{gl,j,f}^{gnd - dif,sys}\left[ {\frac{{|\cos \gamma |}}{2}{I_{sky,inc}} + \left( {1 - \frac{{|\cos \gamma |}}{2}} \right){I_{gnd,inc}}} \right],{\rm{    }}j = 1,N\end{array}$$</div>

#### Screens

The model for window screens currently allows placement on the exterior surface of a window system (i.e., between glass and interior window screens can not be modeled). The exterior screen is modeled as a planar semi-transparent sheet having specular transmittance that is dependent on the angle of incidence of beam solar radiation. The screen transmittance algorithm includes two components. The first one, *T<sub>beam</sub>* (α’, φ'), accounts for the blockage of the sun’s rays by the screen material. This component accounts for the beam solar radiation passing through the screen openings without hitting the screen material. The second part, *T<sub>scatt</sub>*  (α’, φ'), accounts for the additional flux of transmitted beam solar radiation by diffuse reflectance (scattering) from the screen material. Since the reflected component is small compared with the incident beam and the direction of scattering is highly dependent on incident angle, the component of transmitted beam radiation due to screen material reflectance can be treated in one of three ways based on a user input to the model.

The user may elect not to model the inward reflected beam transmittance due to the uncertainty of the direction of scattering or its low magnitude for low-reflecting screen materials. The user may alternately choose to model the inwardly-reflected transmitted beam as an additive component to the direct beam transmittance in the same solid angle and direction. Finally, the additional flux due to the inward reflection of direct beam radiation may be modeled as hemispherically-diffuse transmittance.

This reflected beam transmittance component depends upon the diffuse (i.e., beam-to-diffuse) reflectance of the screen material, so this reflectance (ρ<sub>sc</sub>) is a required input to the model. Guidance input values for this diffuse reflectance are provided, to account for screens that are dark, medium, or light colored in appearance, in the likely case that more accurate values for the material reflectance are difficult or time-consuming to obtain. If the diffuse reflectance of the screen material is known, use this value in place of the guidance provided.

The model is based on an orthogonal crossed cylinder geometry in which the screen material’s cylindrical diameter and spacing are known. The model assumes that the screen material diameter and spacing are the same in both directions. Figure 85 shows a rendering of intersecting orthogonal crossed cylinders used as the basis for the EnergyPlus screen model.

![ScreenDiameter\_Spacing](EngineeringReference/media/image1148.png)

Figure 85. Screen model rendering of intersecting orthogonal crossed cylinders

If the required screen material dimensions are not available from the manufacturer, they may be determined using the following procedure:

* Lay the screen next to a finely-divided scale or ruler. A magnifying glass may be helpful in determining the screen material dimensions. Alternately, a photograph can be taken and the image enlarged.

* Determine the diameter *D* of an individual screen material “cylinder”. Average the diameter values if different in opposing directions.

* Determine the average center-to-center spacing *S* of the screen material or measure from one side of a “cylinder” to the same side of the next ”cylinder” and record the spacing *S*. Average the spacing values if different in opposing directions.

* Enter these values as inputs to the exterior window screen model.

The screen material diameter and spacing are then used to determine the screen material aspect ratio for use in the screen model.

<div>$$\gamma  = {D \mathord{\left/ {\vphantom {D S}} \right. } S}$$</div>

where

<span>$\gamma $</span>   = Screen material aspect ratio, dimensionless

<span>$D$</span>  = Screen material diameter, m

<span>$S$</span>  = Screen material spacing, m



Figure 86 below shows the input requirements for material diameter and spacing and the associated calculation for openness factor, the equivalent to *T<sub>beam</sub>* at direct normal incidence.

![AspectRatio](EngineeringReference/media/image1153.png)

Figure 86. Physical screen material properties

### Screen Properties and Calculations

#### Screen Beam Transmittance

The first component of the window screen transmittance model is a geometric representation of the open area of the screen material and is dependent on the angle of incident beam radiation. Figure 87 shows a schematic of a South-facing vertical window screen and the solar angles used in EnergyPlus. The window screen model is based on the relative angles of incidence of the sun’s rays with respect the the window screen outward normal. In the figure, the relative solar azimuth and relative solar altitude are represented as φ’ and α’, respectively.

![WindowScreenSchematic](EngineeringReference/media/image1154.png)

Figure 87. Schematic of a vertical window screen facing due South

Given the diffuse reflectance ρ<sub>sc</sub> and the screen aspect ratio γ, the model takes the direction of solar incidence, the relative solar altitude angle α’ and the relative solar azimuth angle φ', illustrated in Figure 87, and calculates the direct beam transmittance *T<sub>beam</sub>* (α’, φ') as follows. Since the direct beam transmittance is only a function of the incident angle and the screen material aspect ratio, the following applies to both solar and visible radiation.

<div>$$\alpha '' = {\rm{arctan}}\left( {\tan \alpha '\sec \varphi '} \right)$$</div>

<div>$$\beta  = \frac{\pi }{2} - \varphi '$$</div>

<div>$${T_y} = 1 - \gamma \left[ {\cos \alpha '' + \sin \alpha ''\tan \alpha '{{\left( {1 + {{\cot }^2}\beta } \right)}^{\frac{1}{2}}}} \right]$$</div>

<div>$$\mu  = \arccos \left( {{{\left[ {{{\cos }^2}\alpha '{{\cos }^2}\varphi ' + {{\sin }^2}\alpha '} \right]}^{\frac{1}{2}}}} \right)$$</div>

<div>$$\varepsilon  = \arccos \left( {{\raise0.7ex\hbox{${\left[ {\cos \alpha '\cos \varphi '} \right]}$} \!\mathord{\left/ {\vphantom {{\left[ {\cos \alpha '\cos \varphi '} \right]} {\cos \mu }}}\right.}\!\lower0.7ex\hbox{${\cos \mu }$}}} \right)$$</div>

<div>$$\eta  = \frac{\pi }{2} - \varepsilon $$</div>

<div>$$\mu ' = \arctan \left( {\tan \mu \sec \varepsilon } \right)$$</div>

<div>$${T_x} = 1 - \gamma \left[ {\cos \mu ' + \sin \mu '\tan \mu {{\left( {1 + {{\cot }^2}\eta } \right)}^{\frac{1}{2}}}} \right]$$</div>

<div>$${T_{beam}}\left( {\alpha ',\varphi '} \right) = T_{beam}^{vis}\left( {\alpha ',\varphi '} \right) = {T_x}{T_y}$$</div>

where

<span>${T_y}$</span> = vertical component of direct beam transmittance

<span>${T_x}$</span> = horizontal component of direct beam transmittance

<span>${T_{beam}}$</span> = direct screen transmittance that accounts for beam solar radiation passing through the screen openings without hitting the screen material

<span>$T_{beam}^{vis}$</span> = direct visible screen transmittance that accounts for beam solar radiation passing through the screen openings without hitting the screen material

α’   = relative solar altitude angle [radians]

φ'   = relative solar azimuth angle [radians]

<span>$\gamma $</span>   = Screen material aspect ratio, dimensionless

<span>$\alpha '',\beta ,\mu ,\varepsilon ,\eta ,\mu '$</span> = intermediate variables

This first component of screen direct beam transmittance was developed using geometric principals and was verified using an optical ray tracing software program.

The second component of the window screen transmittance model is an empirical algorithm that accounts for the inward reflection of incident beam radiation off the screen material surface. The calculation procedure for the screen’s transmittance via beam reflection, *T<sub>scatt</sub>* (α’, φ') is as follows:

<div>$$\begin{array}{l}{T_{scattmax}} = 0.0229\,\gamma  + 0.2971\,{\rho_{sc}} - 0.03624\,{\gamma ^2}\, + \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,0.04763\,{\rho_{sc}}^2 - 0.44416\,\gamma \,{\rho_{sc}}\end{array}$$</div>

<div>$$\begin{array}{l}T_{scattmax}^{vis} = 0.0229\,\gamma  + 0.2971\,\rho_{sc}^{vis} - 0.03624\,{\gamma ^2}\, + \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,0.04763{\left( {\rho_{sc}^{vis}} \right)^2} - 0.44416\,\gamma \,\rho_{sc}^{vis}\end{array}$$</div>

<div>$${\delta_{max}} = 89.7 - {{10\gamma } \mathord{\left/ {\vphantom {{10\gamma } {0.16}}} \right. } {0.16}}$$</div>

<div>$$\delta  = {\left( {\alpha_d^{'2} + \varphi_d^{'2}} \right)^{\frac{1}{2}}}$$</div>

<div>$$Pea{k_{ratio}} = {\raise0.7ex\hbox{${1.0}$} \!\mathord{\left/ {\vphantom {{1.0} {\left( {0.2{\rho_{sc}}\left( {1 - \gamma } \right)} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {0.2{\rho_{sc}}\left( {1 - \gamma } \right)} \right)}$}}$$</div>

<div>$$Peak_{ratio}^{vis} = {\raise0.7ex\hbox{${1.0}$} \!\mathord{\left/ {\vphantom {{1.0} {\left( {0.2\rho_{sc}^{vis}\left( {1 - \gamma } \right)} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {0.2\rho_{sc}^{vis}\left( {1 - \gamma } \right)} \right)}$}}$$</div>

<div>$${T_{scatt}}\left( {\alpha ',\varphi '} \right) = 0.2{\rho_{sc}}{T_{scattmax}}\left( {1 - \gamma } \right)\left( {1 + \left( {Pea{k_{ratio}} - 1} \right){e^{\frac{{ - {{\left| {\delta  - {\delta_{max}}} \right|}^{2.0}}}}{{600}}}}} \right)$$</div>

<div>$$T_{scatt}^{vis}\left( {\alpha ',\varphi '} \right) = 0.2\rho_{sc}^{vis}T_{scattmax}^{vis}\left( {1 - \gamma } \right)\left( {1 + \left( {Peak_{ratio}^{vis} - 1} \right){e^{\frac{{ - {{\left| {\delta  - {\delta_{max}}} \right|}^{2.0}}}}{{600}}}}} \right)$$</div>

<div>$$
  \begin{array}{rl}
    IF \left( \delta \gt \delta_{max} \right) \; T_{scatt} \left( \alpha ',\varphi ' \right) &= 
      0.2 \rho_{sc} T_{scattmax} \left( 1 - \gamma \right) \left( 1 + \left( Peak_{ratio} - 1 \right) e^{\frac{- \left| \delta - \delta_{max} \right|^{2.5}}{600}} \right) - 0.2 \rho_{sc} T_{scattmax} \left( 1 - \gamma \right) \left( \max \left( 0.0, \frac{\delta  - \delta_{max}}{90. - {delta_{max}}} \right) \right) \\
    IF \left( \delta \gt \delta_{max} \right) \; T_{scatt}^{vis} \left( \alpha ',\varphi ' \right) &= 
      0.2 \rho_{sc}^{vis} T_{scattmax}^{vis} \left( 1 - \gamma \right) \left( 1 + \left( Peak_{ratio}^{vis} - 1 \right) e^{\frac{- \left| \delta - \delta_{max} \right|^{2.5}}{600}} \right) - 0.2 \rho_{sc}^{vis} T_{scattmax}^{vis} \left( 1 - \gamma \right) \left( \max \left( 0.0, \frac{\delta  - \delta_{max}}{90. - {delta_{max}}} \right) \right) \\
  \end{array}
$$</div>

where

<span>${T_{scattmax}}$</span> = maximum reflected (scattered) beam transmittance

<span>$T_{scattmax}^{vis}$</span> = maximum visible reflected (scattered) beam transmittance

<span>${\delta_{max}},\delta $</span> = intermediate variables [degrees]

<span>$\alpha_d'$</span> = relative solar altitude [degrees]

<span>$\varphi_d'$</span> = relative solar azimuth [degrees]

<span>$Pea{k_{ratio}}$</span>= Ratio of peak scattered beam transmittance to scattered beam transmittance at direct normal incidence.

<span>$Peak_{ratio}^{vis}$</span>= Ratio of peak scattered visible transmittance to scattered visible transmittance at direct normal incidence.

<span>${\rho_{sc}}$</span>= diffuse solar reflectance of the screen material

<span>$\rho_{sc}^{vis}$</span>= diffuse visible reflectance of the screen material

<span>${T_{scatt}}$</span> = beam solar transmittance due to reflectance (scattering)

<span>$T_{scatt}^{vis}$</span> = beam visible transmittance due to reflectance (scattering)

The reflected (scattered) transmittance of incident beam radiation is an empirical model derived by curvefitting results from optical ray trace modeling. Ray traces were performed for a range of screen aspect ratios, diffuse screen reflectances, and relative solar azimuth and altitude angles. The surface of the screen cylinders was assumed to be diffusely reflecting, having the optical properties of a Lambertian surface. The transmitted flux due to reflection was determined by a hemispherical detector on the transmitted side of the screen.

These two components of beam solar transmittance are then used to specify the properties for beam-to-beam and beam-to-diffuse transmittance for the screen based on the user selection for Reflected Beam Transmittance Accounting Method in the WindowMaterial:Screen object. The calculations below apply to both the solar and visible beam solar transmittance.

If the user selects DoNotModel, the direct beam transmittance is set to *T<sub>beam</sub>* and the reflected (scattered) portion of the beam solar transmittance is ignored:

<div>$$T_{sc}^{dir,dir} = {T_{beam}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc}^{dir,dif} = 0.0$$</div>

<div>$$T_{sc,\,vis}^{dir,dir} = {T_{beam}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc,\,vis}^{dir,dif} = 0.0$$</div>

where

<span>$T_{sc}^{dir,dir}$</span> = direct-to-direct beam transmittance of the screen (output report variable Surface Window Screen Beam to Beam Solar Transmittance)

<span>$T_{sc}^{dir,dif}$</span>= direct-to-diffuse beam transmittance of the screen (output report variable Surface Window Screen Beam to Diffuse Solar Transmittance)

<span>$T_{sc,\,vis}^{dir,dir}$</span> = direct-to-direct visible transmittance of the screen

<span>$T_{sc,\,vis}^{dir,dif}$</span>= direct-to-diffuse visible transmittance of the screen

If the user selects Model as Direct Beam, the reflected (scattered) portion of the beam solar transmittance is added to the direct beam transmittance *T<sub>beam</sub>* in the same solid angle and direction of the unattenuated solar beam:

<div>$$T_{sc}^{dir,dir} = {T_{beam}}\left( {\alpha ',\varphi '} \right) + {T_{scatt}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc}^{dir,dif} = 0.0$$</div>

<div>$$T_{sc,\,vis}^{dir,dir} = {T_{beam}}\left( {\alpha ',\varphi '} \right) + T_{scatt}^{vis}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc,\,vis}^{dir,dif} = 0.0$$</div>

If the user selects Model as Diffuse Beam, the direct beam transmittance is set to *T<sub>beam</sub>* and the reflected (scattered) portion of the beam solar transmittance is modeled as diffuse hemispherical radiation:

<div>$$T_{sc}^{dir,dir} = {T_{beam}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc}^{dir,dif} = {T_{scatt}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc,\,vis}^{dir,dir} = {T_{beam}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc,\,vis}^{dir,dif} = T_{scatt}^{vis}\left( {\alpha ',\varphi '} \right)$$</div>

#### Screen Beam Reflectance

The screen reflectance (overall value for the screen assembly, accounting for the screen material itself and the open spaces between the screen material) is calculated by first subtracting the direct-to-direct screen transmittance from the unit incident beam. This approximates the fraction of incident beam solar radiation striking the screen that is not inwardly transmitted. The result is then multiplied by the screen material diffuse reflectance ρ<sub>sc</sub>. The inwardly scattered transmittance is then subtracted from this quantity to obtain an approximate value for the screen’s reflectance R<sub>sc</sub> to beam radiation incident as a function of the relative angles of incident radiation. This equation is used for both beam and visible reflectance:

<div>$$R_{SC}^{dir,dif}\left( {\alpha ',\varphi '} \right) = {\rho_{SC}}\left( {1 - T_{SC}^{dir,dir}} \right) - T_{SC}^{dir,dif}$$</div>

<div>$$R_{SC,vis}^{dir,dif}\left( {\alpha ',\varphi '} \right) = \rho_{SC}^{vis}\left( {1 - T_{SC,vis}^{dir,dir}} \right) - T_{SC,vis}^{dir,dif}$$</div>

#### Screen Beam Absorptance

The screen absorptance(overall value for the screen assembly, accounting for the screen material itself and the open spaces between the screen material) is calculated as the quantity of the unit incident flux (1) less the directly-transmitted component *T<sub>dir,dir</sub>* multiplied by the quantity 1 minus the screen material diffuse reflectance.

<div>$$A_{SC}^{dir}\left( {\alpha ',\varphi '} \right) = \left( {1 - T_{SC}^{dir,dir}} \right)\left( {1 - {\rho_{SC}}} \right)$$</div>

#### Screen Diffuse Properties

The transmittance of the screen to half-hemispherical diffuse (sky) radiation is calculated by performing a finite-element-summation, approximately equivalent to an integration over the solid angle of the beam transmittance, assuming uniform radiance. This single-number screen diffuse transmittance is then multiplied by the irradiance incident on the screen from a uniform half-hemisphere of sky- or ground-reflected radiation to determine the level of additional flux transmitted by the screen to the window from the diffuse sky or ground. The sun angles shown in the figure below represent the solar altitude angle (θ) and solar azimuth angle (Ф) in polar coordinates. These angles are used to calculate the average diffuse-to-diffuse properties for screens in the following derivations.

![PolarCoordinates](EngineeringReference/media/image1210.png)

Figure 88. Sun Angles in Screen Calculations.

The screen transmittance to diffuse radiation *T<sub>dif,dif</sub>* (γ, ρ<sub>sc</sub>)  is computed as the integrated average of the combined beam transmittance *T<sub>tot</sub>* (γ, ρ, θ, Ф) over the directions of incidence using spherical coordinates (θ, Ф) in which the z-axis is perpendicular to the plane of the screen. Using a finite element computation, this is:

<div>$${T_{tot}}(\gamma ,{\rho_{sc}},{\theta_j},{\phi_i}) = {T_{beam}}\left( {\alpha ',\varphi '} \right) + {T_{scatt}}\left( {\alpha ',\varphi '} \right)$$</div>

<div>$$T_{sc}^{dif,dif}(\gamma ,{\rho_{sc}}) = \frac{{\sum\limits_{j = 1}^N {\sum\limits_{i = 1}^M {{T_{tot}}(\gamma ,{\rho_{sc}},{\theta_j},{\phi_i})\sin ({\theta_j})\cos ({\theta_j})} } }}{{\sum\limits_{j = 1}^N {\sum\limits_{i = 1}^M {\sin ({\theta_j})\cos ({\theta_j})} } }}$$</div>

where

<span>$\theta $</span> = solar altitude angle in polar coordinates [radians]

<span>$\phi $</span> = solar azimuth angle in polar coordinates [radians]

<span>$T_{sc}^{dif,dif}(\gamma ,{\rho_{sc}})$</span>= diffuse-diffuse transmittance (output report variable Surface Window Screen Diffuse to Diffuse Solar Transmittance)

Similarly, the reflectance of the screen to diffuse radiation is given by

<div>$$R_{sc}^{dif,dif}(\gamma ,{\rho_{sc}}) = \frac{{\sum\limits_{j = 1}^N {\sum\limits_{i = 1}^M {R_{sc}^{dir,dif}(\gamma ,{\rho_{sc}},{\theta_j},{\phi_i})\sin ({\theta_j})\cos ({\theta_j})} } }}{{\sum\limits_{j = 1}^N {\sum\limits_{i = 1}^M {\sin ({\theta_j})\cos ({\theta_j})} } }}$$</div>

There is an assumption in both of these formulas that the brightness of the sky (or ground) diffuse radiation is the same for all directions. For this reason, the solar azimuth angle Ф and solar altitude angle θ have a range of 0 to <span>${\pi  \mathord{\left/ {\vphantom {\pi  2}} \right. } 2}$</span> (instead of <span>${{ - \pi } \mathord{\left/ {\vphantom {{ - \pi } 2}} \right. } 2}$</span> to <span>${{ + \pi } \mathord{\left/ {\vphantom {{ + \pi } 2}} \right. } 2}$</span>) because the screen is assumed to have identical optical properties for radiation incident at the same angles on either side of a vertical or horizontal plane perpendicular to the screen.

Since the screen direct transmittance model is derived with respect to a different coordinate axis labeling, a coordinate transform is needed in order to calculate the diffuse optical properties. In these calculations, for each spherical solar coordinates (θ, Ф) we need the corresponding screen relative solar coordinates (α’, φ') to evaluate the screen transmittance model for that direction.

For each θ and Ф in the summation, the corresponding values for the relative solar altitude α’ and relative solar azimuth φ’ needed to calculate screen transmittance are determined with the following coordinate transform equations:

<div>$$\sin \alpha ' = \sin \theta \cos \phi $$</div>

<div>$$\tan \varphi ' = \tan \theta \sin \phi $$</div>

The absorptance of the screen to diffuse incident radiation is calculated by subtracting the diffuse transmittance and diffuse reflectance from unity as follows:

<div>$$A_{sc}^{dif}(\gamma ,{\rho_{sc}}) = 1 - T_{sc}^{dif,dif}(\gamma ,{\rho_{sc}}) - R_{sc}^{dif,dif}(\gamma ,{\rho_{sc}})$$</div>

#### Screen/Glass System Properties for Short-Wave Radiation

The combined system properties of the screen/glass combination are calculated using the properties of the screen in combination with the bare glass material properties. Interreflections of radiation between the screen and glass surfaces are included. The following infinite series serves as an example for calculating the combined screen/glass system properties. The terms of the series are built up as illustrated in the following figure. The terms shown at the right of the figure represent each term in the infinite series for the combined screen/glass property (beam transmittance in this example).

For the example of beam transmittance, the incident solar beam strikes the screen at the incident angle associated with the current relative azimuth and altitude angle. The incident beam splits into reflected and transmitted components at the screen. The transmitted component is attenuated as it passes through the screen material by the screen’s beam transmittance (<span>$T_{sc}^{dir,dir}$</span>, shown as<span>$T_{sc}^{dir}$</span> in the figure and equations below) at this incident angle. The reflected (scattered) transmittance of incident solar beam is also shown at this point and will be discussed later in this section. As the attenuated solar beam continues on towards the front glass surface, a portion of the screen-transmitted beam splits at the window surface into transmitted and reflected components. The reflected component reflects off the front surface of the glass material (<span>$T_{sc}^{dir,dir}R_{gl,f}^{dir}$</span>) and the transmitted component continues to travel through the glass material and is further attenuated by the glass beam transmittance. Thus the first term of the combined screen/glass solar beam transmittance is shown as <span>$T_{sc}^{dir,dir}T_{gl}^{dir}$</span>. Interreflections are accounted for by following the beam as it continues to reflect off the front surface of the glass material and the back surface of the screen material. Continuing on with the glass-reflected beam (<span>$T_{sc}^{dir,dir}R_{gl,f}^{dir}$</span>) described above, this beam strikes the back surface of the screen material at the same incident angle as the incident solar beam. This reflected beam is also assumed to be a collimated beam (solid lines) which strikes the back surface of the screen material and reflects as hemispherically-diffuse radiation (dotted lines). The reflective property of the screen material used here is the beam reflectance calculated at the incident solar angle (<span>$R_{sc}^{dir,dif}$</span>). A single ray of this diffuse light will be followed through the remaining steps and represents the energy associated with **all** diffuse rays interreflecting between the screen and glass layers. To determine the second term of the combined screen/glass beam transmittance, the diffusely-reflected ray (<span>$T_{sc}^{dir,dir}R_{gl,f}^{dir}R_{sc}^{dir,dif}$</span>) passes through and is attenuated by the glass layer. Since this ray originates from diffuse reflection, the attenuation of this ray is accounted for using the diffuse transmittance property of the glass. Thus, the second term is shown as <span>$T_{sc}^{dir,dir}R_{gl,f}^{dir}R_{sc}^{dir,dif}T_{gl}^{dif}$</span>. Defining the remaining terms continues in a similar fashion using diffuse properties of both the screen and glass material. Notice that the 3<sup>rd</sup> and 4<sup>th</sup> terms shown below are similar to the 2<sup>nd</sup> term, but additional terms are raised to increasing powers.

![TransmittanceEquation](EngineeringReference/media/image1231.png)

Figure 89. Screen/Glass System Transmittance Equation Schematic.

The screen/glass system transmittance equation shown in the figure above is repeated here in an alternate format to emphasize the recurring nature of the infinite series. This equation represents the final solar beam transmittance equation for the screen/glass combination. The recurring terms are shown as a summation of a quantity raised to the n power, with n ranging from 0 to infinity. Since the quantity <span>$R_{gl}^{dif}R_{sc}^{dif,dif}$</span> is less than 1, the summation <span>$\sum\limits_{n = 0}^\infty  {{{(R_{gl,f}^{dif}R_{sc}^{dif,dif})}^n}} $</span>converges and can be expressed as <span>${\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 {\left( {1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}} \right)}$}}$</span>. Since the reflected (scattered) transmittance of incident solar beam (<span>$T_{sc}^{dir,dif}$</span>) and the diffusely reflecting beam <span>$T_{sc}^{dir,dir}R_{gl,f}^{dir}R_{sc}^{dir,dif}$</span> are both assumed to be hemispherically diffuse radiation, the reflected (scattered) transmittance of incident solar beam is added to the infinite series as shown below.

<div>$$\begin{array}{l}T_{sys}^{dir,all}(\alpha ',\varphi ',\phi ) = T_{sc}^{dir,dir}(\alpha ',\varphi ')T_{gl}^{dir}\left( \phi  \right) + (T_{sc}^{dir,dir}(\alpha ',\varphi ')R_{gl,f}^{dir}R_{sc}^{dir,dif}(\alpha ',\varphi ') + T_{sc}^{dir,dif}(\alpha ',\varphi '))T_{gl}^{dif}\sum\limits_{n = 0}^\infty  {{{(R_{gl,f}^{dif}R_{sc}^{dif,dif})}^n}} \\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\; - or - \end{array}$$</div>

<div>$$T_{sys}^{dir,all}(\alpha ',\varphi ',\phi ) = T_{sc}^{dir,dir}(\alpha ',\varphi ')T_{gl}^{dir}\left( \phi  \right) + \frac{{(T_{sc}^{dir,dir}(\alpha ',\varphi ')R_{gl,f}^{dir}R_{sc}^{dir,dif}(\alpha ',\varphi ') + T_{sc}^{dir,dif}(\alpha ',\varphi '))T_{gl}^{dif}}}{{1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}}}$$</div>

where

<span>$T_{sys}^{dir,all}(\alpha ',\varphi ',\phi )$</span> = screen/glass system beam transmittance (output report variable Surface Window Screen and Glazing System Beam Solar Transmittance)

Properties for beam absorptance of the individual glass layers and screen/glass combination are derived in a similar fashion to the transmittance calculation described above. Diffuse transmittance and absorptance of individual glass layers and the screen/glass combination are also shown here.

<span>$\begin{array}{l}A_{gl,j,f}^{dir,sys}\left( {\alpha ',\varphi ',\phi } \right) = T_{sc}^{dir,dir}\left( {\alpha ',\varphi '} \right)A_{gl,j,f}^{dir}\left( \phi  \right) + \\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\;\;\;\;\;\;\frac{{\left( {T_{sc}^{dir,dir}\left( {\alpha ',\varphi '} \right)R_{gl}^{dir}\left( \phi  \right)R_{sc}^{dir,dif}\left( {\alpha ',\varphi '} \right) + T_{sc}^{dir,dif}\left( {\alpha ',\varphi '} \right)} \right)A_{gl,j,f}^{dif}}}{{1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}}},\;j = 1,N\end{array}$</span><span>$\begin{array}{l}\alpha_{sc}^{dir,sys}\left( {\alpha ',\varphi ',\phi } \right) = A_{sc}^{dir}\left( {\alpha ',\varphi '} \right)\left( {1 + R_{gl,f}^{dir}\left( \phi  \right)T_{sc}^{dir,dir}\left( {\alpha ',\varphi '} \right)} \right) + \\\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\;\frac{{A_{sc}^{dif}R_{gl,f}^{dif}}}{{1 - R_{sc}^{dif,dif}R_{gl,f}^{dif}}}\left( {R_{gl,f}^{dir}\left( \phi  \right)T_{sc}^{dir,dir}\left( {\alpha ',\varphi '} \right)R_{sc}^{dir,dif}\left( {\alpha ',\varphi '} \right)} \right)\end{array}$</span>

<div>$$T_{sys}^{dif,dif} = \frac{{T_{sc}^{dif,dif}T_{gl}^{dif}}}{{1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}}}$$</div>

<div>$$A_{gl,j,f}^{dif,sys} = \frac{{T_{sc}^{dif,dif}A_{gl,j,f}^{dif}}}{{1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}}},\;j = 1,N$$</div>

<div>$$\alpha_{sc}^{dif,\,sys} = A_{sc}^{dif}\left( {1 + \frac{{T_{sc}^{dif,dif}R_{gl,f}^{dif}}}{{1 - R_{gl,f}^{dif}R_{sc}^{dif,dif}}}} \right)$$</div>



where

<span>$A_{gl,j,f}^{dir,sys}\left( {\alpha ',\varphi ',\phi } \right)$</span> = glass layer beam absorptance including interreflections with screen material

<span>$\alpha_{sc}^{dir,sys}\left( {\alpha ',\varphi ',\phi } \right)$</span> = beam absorptance of screen material including interreflections with glass

<span>$T_{sys}^{dif,dif}$</span> = screen/glass system diffuse transmittance (output report variable Surface Window Screen and Glazing System Diffuse Solar Transmittance)

<span>$A_{gl,j,f}^{dif,sys}$</span> = glass layer diffuse absorptance including interreflections with screen material

<span>$\alpha_{sc}^{dif,sys}$</span> = diffuse absorptance of screen material including interreflections with glass

#### Screen/Glazing System Properties for Long-Wave Radiation

The program calculates how much long-wave radiation is absorbed by the screen and by the adjacent glass surface. The effective long-wave emissivity (equal to the long-wave absorptance on a wavelength-by-wavelength basis or over the same spectral range) of an exterior screen, taking into account reflection of long-wave radiation between the glass and screen, is given by

<div>$$\varepsilon_{sc}^{lw,eff} = \varepsilon_{sc}^{lw}\left( {1 + \frac{{T_{sc}^{dif,dif}\rho_{gl}^{lw}}}{{1 - R_{sc}^{dif,dif}\rho_{gl}^{lw}}}} \right)$$</div>

where <span>$\rho_{gl}^{lw}$</span>is the long-wave reflectance of the outermost glass surface facing an exterior screen, and it is assumed that the long-wave transmittance of the glass is zero.

The effective outermost (for exterior screen) glass surface emissivity when the screen is present is

<div>$$\varepsilon_{gl}^{lw,eff} = \varepsilon_{gl}^{lw}\frac{{T_{sc}^{dif,dif}}}{{1 - R_{sc}^{dif,dif}\rho_{gl}^{lw}}}$$</div>

The effective inside surface emissivity is the sum of the effective screen and effective glass emissivities:

<div>$$\varepsilon_{ins}^{lw,eff} = \varepsilon_{sc}^{lw,eff} + \varepsilon_{gl}^{lw,eff}$$</div>

The effective temperature of the screen/glazing combination that is used to calculate the window’s contribution to the zone’s mean radiant temperature (MRT) is given by

<div>$${T^{eff}} = \frac{{\varepsilon_{sc}^{lw,eff}{T_{sc}} + \varepsilon_{gl}^{lw,eff}{T_{gl}}}}{{\varepsilon_{sc}^{lw,eff} + \varepsilon_{gl}^{lw,eff}}}$$</div>

#### Solar Radiation Transmitted and Absorbed by a Window/Screen System

Let the direct solar incident on the window be

<div>$${I_{dir,inc}} = {f_{sunlit}}{I_{dir,norm}}\cos \phi {\rm{    }}(W/{m^2})$$</div>

where <span>${f_{sunlit}}$</span>is the fraction of the window that is sunlit (determined by the shadowing calculations), <span>${I_{dir,norm}}$</span>is the direct normal solar irradiance, and <span>$\phi $</span> is the angle of incidence.

Let <span>${I_{sky,inc}}$</span>be the irradiance on the window due to diffuse solar radiation from the sky (W/m<sup>2</sup>) and let <span>${I_{gnd,inc}}$</span>be the irradiance on the window due to diffuse solar radiation from the ground (W/m<sup>2</sup>).

Then we have the following expressions for different classes of transmitted and absorbed solar radiation for the window/screen system, all in W/m<sup>2</sup>:

*Direct and diffuse solar entering zone from incident direct solar:*

<div>$${I_{dir,inc}}T_{sys}^{dir,all}\left( {\alpha ',\varphi '} \right)$$</div>

*Direct solar absorbed by screen:*

<div>$${I_{dir,inc}}\alpha_{sc}^{dir,sys}\left( {\alpha ',\varphi '} \right)$$</div>

*Direct solar absorbed by glass layers:*

<div>$${I_{dir,inc}}A_{gl,j,f}^{dir,sys}(\phi ,{\phi_s}),{\rm{    }}j = 1,N$$</div>

*Diffuse solar entering zone from incident diffuse solar:*

<div>$$\left( {{I_{sky,inc}} + {I_{gnd,inc}}} \right)T_{sys}^{dif,dif}$$</div>

*Diffuse solar absorbed by screen:*

<div>$$\left( {Isky,inc + Ignd,inc} \right)\alpha_{sc}^{dif,sys}$$</div>

*Diffuse solar absorbed by glass layers:*

<div>$$({I_{sky,inc}} + {I_{gnd,inc}})A_{gl,j,f}^{dif,sys},{\rm{   }}j = 1,N{\rm{ }}$$</div>

### Complex Fenestration Calculation Module

This section describes detailed method for modeling complex fenestration systems, including shading devices and general fenestration attachments. This detailed method primarily refers to the optical side of modeling complex fenestration systems. Thermal modeling is done according to ISO 15099 standard, which is described in the Window Heat Balance Calculation section with the addition of deflection and vacuum glazing systems modeling and some modifications to shading layer algorithms, which is described in Shading Device Thermal Model section. Optical caclulations in this method are done using Bidirectional Scattering Distribution Function (BSDF) approach.  The concept behind BSDF is based on the definition of descrete set of incident and outgoing angles, which fully describes optical performance of any system, simple or complex, limited only by the resolution of angular discretization.  In this method each layer, as well as the whole system is described by a matrix of incident and outgoing angles.

#### Complex Fenestration Solar-Optical Calculations

##### **Solar radiation calculation outline**

For solar radiation calculations, each of the layers as well as entire glazing system can be represented with the set of Bi-directional Scattering Distribution Functions or BSDF, consisting of Bi-directional Reflectance Distribution Function or BRDF and Bi-directional Transmittance Distribution Function or BTDF.  Each function is a matrix 145 x 145 that describes reflectance or transmittance distribution in the outgoing hemisphere for each incident angle in the incidence hemisphere.  For each function there is forward and back matrix, for a total of 4 145 x 145 matrices.  Depending on the purpose of calculations, description of entire glazing system is divided into solar and visible spectrum, which means that there can be 8 matrices describing visible and complete solar spectrums.  Reflectance and transmittance being non-dimnsional ratios of reflected or transmitted energy over incident energy, in order to get total reflected and transmitted energy it is necessary to supply vector of incident solar energy, which usually consists of direct and diffuse radition.Specifics of calculations of direct and diffuse solar radiationis be described in some detail in oncoming chapters.

###### **Scattering (Non-Specular) Glazing and Shading Devices**

A general scattering fenestration system is characterized by BTDFs and BRDFs, which were described above.  Given an incident direction ***p***<sup>(I)</sup>, and an incident irradiance *E*( ***p***<sup>(I)</sup>), the transmitted radiance in the outgoing direction ***p***<sup>(T)</sup> is

<div>$$S({{\bf{p}}^{{\rm{(T)}}}}) = {\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}})dE({{\bf{p}}^{{\rm{(I)}}}})$$</div>

where the function T is the BTDF.  In the absence of a source of effectively plane-parallel incident radiation (such as direct sunlight) d*E(**p***<sup>(I)</sup>*)* is an infinitesimal quantity, and the right side of the equation must be summed over the irradiance from all incident directions to produce the outgoing radiance:

<div>$$S({{\bf{p}}^{{\rm{(T)}}}}) = \int {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}})\frac{{dE({{\bf{p}}^{{\rm{(I)}}}})}}{{d\Omega }}d\Omega } $$</div>

A similar equation gives the reflected radiance in the direction ***p***<sup>(R)</sup>:

<div>$$S({{\bf{p}}^{{\rm{(R)}}}}) = \int {{\mathop{\rm R}\nolimits} ({{\bf{p}}^{{\rm{(R)}}}},{{\bf{p}}^{{\rm{(I)}}}})\frac{{dE({{\bf{p}}^{{\rm{(I)}}}})}}{{d\Omega }}d\Omega } $$</div>

We can express the irradiance in terms of the exterior luminance, S, in that direction,

<div>$$dE({{\bf{p}}^{{\rm{(I)}}}})dA = {S^{{\rm{(I)}}}}({{\bf{p}}^{{\rm{(I)}}}})\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}dA$$</div>

![Calc Outl Fig 1](EngineeringReference/media/image1271.png)

Figure 90. Irradiance geometry

which allows one to express the transmittance of exterior radiation to produce the total outgoing radiance from the fenestration into the room in a particular direction:

<div>$$S({{\bf{p}}^{{\rm{(T)}}}}) = \int\limits_{{\Omega ^{{\rm{(I)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}}){S^{{\rm{(I)}}}}({{\bf{p}}^{{\rm{(I)}}}})\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} $$</div>

The negative sign is added to account for the fact that ***p***<sup>(I)</sup> and ***n*** have opposite sign for incoming radiation.

The radiance in equation is emitted from the back side of the element of area shown in Figure 90.  Considering a second surface, viewing the back side of the fenestration system, we can use equation to calculate the irradiance on surface 2,

<div>$${E^{{\rm{(2)}}}}({{\bf{p}}^{{\rm{(T)}}}})d{A^{{\rm{(2)}}}} = {S^{{\rm{(T)}}}}({{\bf{p}}^{{\rm{(T)}}}})\left( { - {{\bf{p}}^{{\rm{(T)}}}}\cdot {{\bf{n}}^{{\rm{(2)}}}}} \right)d{\Omega ^{{\rm{(I,2)}}}}d{A^{{\rm{(2)}}}}$$</div>

This expression, however, contains a number of new quantities, such as <span>$d{\Omega ^{{\rm{(I,2)}}}}$</span>, the element of solid angle for incoming radiation as seen from surface 2.  We can sort this out by referring to Figure 91 and making some changes and clarifications in notation.

![](EngineeringReference/media/image1275.png)

Figure 91. Radiation exchange between two surface elements

In this figure we consider that surface 1 is the back side of the fenestration system, and surface 2 is some other surface in the room that receives the transmitted solar radiation through the fenestration system.  We consider infinitesimal elements *dA*<sup>(1)</sup> and *dA*<sup>(2)</sup> of the two surfaces, and define vector surface elements by *d**A*****<sup>(</sup>**<sup>1)</sup>=*dA*<sup>(1)</sup>***n***<sup>(1)</sup> and *d**A*****<sup>(</sup>**<sup>1)</sup>=*dA*<sup>(1)</sup>***n***<sup>(1)</sup>.  The quantity ***r*** in the figure denotes a vector pointing from surface 1 to surface 2, the magnitude of which is the distance *r* between the two surface elements.  This is used to define two unit vectors: <span>${{\bf{\hat r}}^{{\rm{(1)}}}} = {{\bf{r}} \mathord{\left/ {\vphantom {{\bf{r}} r}} \right. } r}$</span> is a unit vector pointing from surface element 1 to surface element 2, and <span>${{\bf{\hat r}}^{{\rm{(2)}}}} =  - {{\bf{r}} \mathord{\left/ {\vphantom {{\bf{r}} r}} \right. } r}$</span> is a unit vector pointing from surface element 2 back to surface element 1.  The unit vector ***p***<sup>(T)</sup> in equation is in fact <span>${{\bf{\hat r}}^{{\rm{(1)}}}}$</span>.  The shaded quadrilaterals in the figure are the projected area elements normal to ***r***.  Since the areas are infinitesimal, all the radiation leaving one surface element and arriving at the other will be in the direction ***r***, so that all radiation will be contained within the parallelepiped defined by the dashed lines (parallel to ***r***) joining the corners of the two surface elements.  It follows that the area *dA*<sup>(2)</sup>  is not independent of *dA*<sup>(1)</sup>.  The figure also shows the solid angle that has been denoted *d*W<sup>(I,2)</sup> above, which is the solid angle subtended by *dA*<sup>(1)</sup> as seen from *dA*<sup>(2)</sup> and is given by

<div>$$d{\Omega ^{{\rm{(I,2)}}}} = \frac{{d{{\bf{A}}^{{\rm{(1)}}}} \cdot {{\bf{r}}^{{\rm{(1)}}}}}}{{{r^2}}}$$</div>

The net power from surface element 1 to surface element 2 is

<div>$${W^{(1 \to 2)}} = \left( {{S^{{\rm{(1)}}}}({{{\bf{\hat r}}}^{{\rm{(1)}}}}) - {S^{{\rm{(2)}}}}({{{\bf{\hat r}}}^{{\rm{(2)}}}})} \right)\frac{{\left( {d{{\bf{A}}^{{\rm{(1)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(1)}}}}} \right)\left( {d{{\bf{A}}^{{\rm{(2)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(2)}}}}} \right)}}{{{r^2}}}$$</div>

where <span>${S^{{\rm{(1)}}}}({{\bf{\hat r}}^{{\rm{(1)}}}})$</span> is the radiance leaving surface element 1 in the direction of surface element 2, and vice-versa for <span>${S^{{\rm{(2)}}}}({{\bf{\hat r}}^{{\rm{(2)}}}})$</span>.  In this case, the latter is zero and the former is the quantity called *S*<sup>(T)</sup>(***p***<sup>(T)</sup>) above.  Given equation , we can recognize the quantity multiplying the radiance as the solid angle *d*W<sup>(I,2)</sup> times the projected area of surface element 2 perpendicular to ***r***.  But the expression is symmetrical in the two surface elements, so we could also express it as

<div>$${W^{(1 \to 2)}} = {S^{{\rm{(T)}}}}({{\bf{p}}^{{\rm{(T)}}}})\left( {d{{\bf{A}}^{{\rm{(1)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(1)}}}}} \right)d{\Omega ^{{\rm{(T)}}}}$$</div>

where

<div>$$d{\Omega ^{{\rm{(T)}}}} = \frac{{\left( {d{{\bf{A}}^{{\rm{(2)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(2)}}}}} \right)}}{{{r^2}}}$$</div>

The superscript (T) is used here because the solid angle element pertains to the direction ***p***<sup>(T)</sup>.  In the particular case under discussion that restricts attention to those directions for which the outgoing radiation strikes surface element 2.  We can now rewrite equation as

<div>$${E^{{\rm{(2)}}}}({{\bf{p}}^{{\rm{(T)}}}})d{A^{{\rm{(2)}}}} = {S^{{\rm{(T)}}}}({{\bf{p}}^{{\rm{(T)}}}})\left( {{{\bf{n}}^{{\rm{(1)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(1)}}}}} \right)d{\Omega ^{{\rm{(T)}}}}d{A^{{\rm{(1)}}}}$$</div>

and since, as can readily be seen from Figure 91, <span>$\left( {d{{\bf{A}}^{{\rm{(1)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(1)}}}}} \right) = \left( {d{{\bf{A}}^{{\rm{(2)}}}} \cdot {{{\bf{\hat r}}}^{{\rm{(2)}}}}} \right)$</span>, this becomes

<div>$${E^{{\rm{(2)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = {S^{{\rm{(T)}}}}({{\bf{p}}^{{\rm{(T)}}}})\left( { - {{\bf{p}}^{{\rm{(T)}}}} \cdot {{\bf{n}}^{{\rm{(2)}}}}} \right)d{\Omega ^{{\rm{(T)}}}}$$</div>

Substituting equation for *S*<sup>(T)</sup>(***p***<sup>(T)</sup>, we obtain a propagation equation for outside radiation passing through the window and arriving at surface element 2:

<div>$$
    E^{(2)}(\bf{p}^{(T)}) = \int_{\Omega^{(I)}} 
      \rm T (\bf{p}^{(T)},\bf{p}^{(I)}) 
      S^{(I)}(\bf{p}^{(I)})(-\bf{p}^{(I)}\cdot\bf{n}^{(I)})
      d\Omega^{(I)}(-\bf{p}^{(T)}\cdot\bf{n}^{(2)})d\Omega^{(T)}
$$</div>

or, in terms involving only irradiance,

<div>$${E^{{\rm{(2)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = \int\limits_{{\Omega ^{{\rm{(I)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}})E({{\bf{p}}^{{\rm{(I)}}}})d{\Omega ^{{\rm{(I)}}}}} \left( { - {{\bf{p}}^{{\rm{(T)}}}} \cdot {{\bf{n}}^{{\rm{(2)}}}}} \right)d{\Omega ^{{\rm{(T)}}}}$$</div>

Comparing these two equations with equations and , we can see that physically they represent the processes of (a) propagation of radiation outgoing at one surface (initially, the sky “surface”), where it is characterized by radiance, to incidence on a second surface, characterized by irradiance, followed (b) transmittance, which converts incoming radiation traveling in a given direction to outgoing radiation in a different set of directions, characterized again by radiance.  We can make the former of these processes explicit by defining a propagation function.  Considering the first surface element to be located at a position specified by the vector ***x***<sup>(1)</sup> and the second at ***x***<sup>(2)</sup>, then radiation leaving surface 1 in a direction ***p***<sup>(1)</sup> and arriving at surface 2 in a direction ***p***<sup>(2)</sup> produces an irradiance given by

<div>$${E^{(2)}}({{\bf{p}}^{{\rm{(2)}}}}) = \int {L({{\bf{x}}^{{\rm{(2)}}}},{{\bf{p}}^{{\rm{(2)}}}};{{\bf{x}}^{{\rm{(1)}}}},{{\bf{p}}^{{\rm{(1)}}}}){S^{{\rm{(1)}}}}({{\bf{p}}^{{\rm{(1)}}}})} d{\Omega ^{{\rm{(1)}}}}$$</div>

where the propagation function L is defined by

<div>$$L({{\bf{x}}^{{\rm{(2)}}}},{{\bf{p}}^{{\rm{(2)}}}};{{\bf{x}}^{{\rm{(1)}}}},{{\bf{p}}^{{\rm{(1)}}}}) = \left( { - {{\bf{p}}^{{\rm{(2)}}}}\cdot {{\bf{n}}^{{\rm{(2)}}}}} \right)d{\Omega ^{{\rm{(2)}}}}\delta ({{\bf{p}}^{{\rm{(2)}}}},{{\bf{p}}^{{\rm{(1)}}}})\delta ({{\bf{x}}^{{\rm{(2)}}}},{{\bf{x}}^{{\rm{(1)}}}} + {\bf{r}})$$</div>

The spatial dependence is inserted to guarantee that the geometrical relations in Figure 91 are preserved.  The delta functions in direction and spatial vectors are the mathematically standard d-distributions defined so that

<div>$$\int {\delta ({{\bf{p}}^{{\rm{(2)}}}},{{\bf{p}}^{{\rm{(1)}}}})} f({{\bf{p}}^{{\rm{(1)}}}})d{\Omega ^{{\rm{(1)}}}} = f({{\bf{p}}^{{\rm{(2)}}}})$$</div>

<div>$$\int\limits_\Omega  {\delta ({{\bf{p}}^{{\rm{(2)}}}},{{\bf{p}}^{{\rm{(1)}}}})d{\Omega ^{{\rm{(1)}}}}}  = \left\{ {\begin{array}{*{20}{c}}1&{{{\bf{p}}^{{\rm{(2)}}}} \in \Omega }\\0&{{{\bf{p}}^{{\rm{(2)}}}} \notin \Omega }\end{array}} \right.$$</div>

<div>$$\int {\delta ({{\bf{x}}^{{\rm{(2)}}}},{{\bf{x}}^{{\rm{(1)}}}})} f({{\bf{x}}^{{\rm{(1)}}}})d{A^{{\rm{(1)}}}} = f({{\bf{x}}^{{\rm{(2)}}}})$$</div>

<div>$$\int\limits_A {\delta ({{\bf{x}}^{{\rm{(2)}}}},{{\bf{x}}^{{\rm{(1)}}}})d{A^{{\rm{(1)}}}}}  = \left\{ {\begin{array}{*{20}{c}}1&{{{\bf{x}}^{{\rm{(2)}}}} \in A}\\0&{{{\bf{x}}^{{\rm{(2)}}}} \notin A}\end{array}} \right.$$</div>

for an arbitrary function *f*.  [In equations and the integration is assumed to be over all possible values of either direction or position, so that the vectors ***p***<sup>(2)</sup> and ***x***<sup>(2)</sup> are necessarily within the domain of integration.]

###### Physical Caveats

In equations and the functions T and R pertain to the overall glazing system, and are assumed to be averaged over both wavelength and polarization with appropriate weightings.  [EnergyPlus considers wavelength only in that it distinguishes between radiation in the longwave thermal IR region and in the shortwave solar/visible region.  (In considering daylighting, there is a further limitation to the visible region.)  In this discussion we are concerned solely with the shortwave solar/visible region.]  While fenestration properties may depend on both wavelength and polarization, for externally incident radiation this dependence is taken into account in the calculation and averaging of T and R.  However, both the wavelength distribution (within the solar region) and the polarization state of the outgoing radiation will generally be different from that of the incident radiation.  This is not a feature peculiar to non-specular fenestration systems; it is also true of specular ones, and may in fact be more important there.  For most interior surfaces, where the radiation is either absorbed or diffusely reflected (and where both processes are assumed wavelength and polarization independent), this is of no importance, but in the case of either interior windows or the back-reflectance from exterior windows, it could in principle cause errors, unless proper account is taken in specifying T and R for these cases.

###### Discretization: The LBNL Method

A series of 6 papers (Papamichael, Klems et al. 1988; Klems 1994A; Klems 1994B; Klems and Warner 1995; Klems and Kelley 1996; Klems, Warner et al. 1996) formulated the LBNL method of characterizing scattering fenestration systems.  The relevant aspects of that method will be summarized here.  This method has been incorporated into the WINDOW (from LBNL 2012) computer program.

The method begins by approximating the integrals in equations and by finite sums.  It does this by defining a set of finite solid angle elements {<span>$ \Delta {\Omega_i} $</span>} that covers the relevant solid angle hemisphere (whether incident, transmitted or reflected directions).  Each solid angle element is characterized by a direction ***p****<sub>i</sub>*, and it is assumed that this may be substituted for any direction within the solid angle element.  This set of solid angle elements and corresponding directions is termed a basis.  Note that, since ***p****<sub>i</sub>* is a two-dimensional vector, enumerating the solid angle elements with a single index *i* implicitly includes specifying an ordering of the direction vectors.  Equation then becomes

<div>$$S({{\bf{p}}_j}^{{\rm{(T)}}}) = \sum\limits_i {{\mathop{\rm T}\nolimits} ({{\bf{p}}_j}^{{\rm{(T)}}},{{\bf{p}}_i}^{{\rm{(I)}}}){S^{{\rm{(I)}}}}({{\bf{p}}_i}^{{\rm{(I)}}})\left( { - {{\bf{p}}_i}^{{\rm{(I)}}}\cdot {\bf{n}}} \right)\Delta {\Omega_i}^{{\rm{(I)}}}} $$</div>

and equation becomes

<div>$${E^{(2)}}({{\bf{p}}_j}^{{\rm{(2)}}}) = \sum\limits_i {\int\limits_{\Delta {\Omega_i}} {L({{\bf{x}}^{{\rm{(2)}}}},{{\bf{p}}_j}^{{\rm{(2)}}};{{\bf{x}}^{{\rm{(1)}}}},{{\bf{p}}_i}^{{\rm{(1)}}}){S^{{\rm{(1)}}}}({{\bf{p}}_i}^{{\rm{(1)}}})d{\Omega ^{{\rm{(1)}}}}} } $$</div>

Referring to the definition of the propagation function in equation and properties of the d-distribution in equation , we see that the integrals in the summation will all be zero, except when ***p****<sub>j</sub>*<sup>(2)</sup> is contained in the solid angle element DW*<sub>i</sub>*.  In that case the integration produces ***p****<sub>i</sub>*<sup>(1)</sup>= ***p****<sub>j</sub>*<sup>(2)</sup>.  We can retain the formal summation by utilizing the finite-dimensional form of the d-distribution, known as the Kronicker delta, d*<sub>ij</sub>*:

<div>$${\delta_{ij}} = \left\{ {\begin{array}{*{20}{c}}1&{i = j}\\0&{i \ne j}\end{array}} \right.$$</div>

Then the integral becomes

<div>$$\int\limits_{\Delta {\Omega_i}} {L({{\bf{x}}^{{\rm{(2)}}}},{{\bf{p}}_j}^{{\rm{(2)}}};{{\bf{x}}^{{\rm{(1)}}}},{{\bf{p}}_i}^{{\rm{(1)}}}){S^{{\rm{(1)}}}}({{\bf{p}}_i}^{{\rm{(1)}}})d{\Omega ^{{\rm{(1)}}}}}  = \lambda ( - {{\bf{p}}_j}^{{\rm{(2)}}}){\delta_{ij}} \cdot \delta ({{\bf{x}}^{{\rm{(2)}}}},{{\bf{x}}^{{\rm{(1)}}}} + {\bf{r}})$$</div>

where the function *l* is defined as

<div>$${\lambda ^{{\rm{(s)}}}}({{\bf{p}}_j}) = \left( {{{\bf{p}}_j}\cdot {{\bf{n}}^{{\rm{(s)}}}}} \right)\Delta {\Omega_j}$$</div>

and the superscript (s) refers to the surface.

The LBNL method, which focuses on glazing systems consisting of plane-parallel layers, makes particular assumptions that allow one to ignore the spatial dependence of L.  Since the only effect of the function <span>$\delta ({{\bf{x}}^{{\rm{(2)}}}},{{\bf{x}}^{{\rm{(1)}}}} + {\bf{r}})$</span> in equation is to require that if the expression is formally integrated over two separate surface areas, only the parts of the integration that satisfy the geometric constraints will contribute (in effect, the integration is over only one of the surfaces), we will drop the spatial dependence in the present discussion and replace it later when we consider the total energy transfer between different surfaces.

Equations (without the delta distribution in ***x***) and are then considered to define the components of a diagonal matrix,

<div>$$\begin{array}{*{20}{c}}{{\bf{\Lambda }^{{\rm{(s)}}}} = \left( {{\Lambda ^{{\rm{(s)}}}}_{ij}} \right)}&{{\rm{where}}}&{\Lambda_{ij}^{{\rm{(s)}}} = \left( {{{\bf{p}}_j}\cdot {{\bf{n}}^{{\rm{(s)}}}}} \right)\Delta {\Omega_j}{\delta_{ij}}}\end{array}$$</div>

Considering the radiance in the various basis directions to be the components of a vector,

<div>$$
  \bf{S} = \left( 
    \begin{array}
      S_1 \\ ... \\ S_j \\ ...
    \end{array}
  \right)
  \text{where}
  S_j = S(\bf{p}_j)
$$</div>
  
equation becomes

<div>$$\begin{array}{*{20}{c}}{{S^{{\rm{(T)}}}}_j = \sum\limits_i {{T_{ji}}} \sum\limits_k {{\Lambda_{ik}}} {S_k}}&{{\rm{where}}}&{{T_{ji}} = {\mathop{\rm T}\nolimits} ({{\bf{p}}_j}^{{\rm{(T)}}},{{\bf{p}}_i}^{{\rm{(I)}}})}\end{array}$$</div>

which has the obvious character of a series of matrix multiplications.  (Note that the superscript (T) here means transmitted, not the matrix operation transpose.)  Similarly, the reflectance matrix elements are

<div>$${R_{ij}} = {\mathop{\rm R}\nolimits} ({{\bf{p}}^{{\rm{(R)}}}},{{\bf{p}}^{{\rm{(I)}}}})$$</div>

The method then identifies the infinitesimal directional irradiances in equation with the components of an irradiance vector,

<div>$$
  E = \left( 
    \begin{array}
      E_1 \\ ... \\ E_i \\ ...
    \end{array}
  \right)
  \text{where}
  E_i = \frac{dE(\bf{p}_j)}{d\Omega}
$$</div>

and equations - can be rewritten as matrix equations,

<div>$${{\bf{S}}^{{\rm{(T)}}}} = {\bf{T}} \cdot {{\bf{E}}^{{\rm{(I)}}}}$$</div>

<div>$${{\bf{S}}^{{\rm{(R)}}}} = {\bf{R}} \cdot {{\bf{E}}^{{\rm{(I)}}}}$$</div>

<div>$${{\bf{E}}^{{\rm{(I)}}}}{\bf{ = }}{\bf{\Lambda }^{{\rm{(I)}}}} \cdot {{\bf{S}}^{{\rm{(I)}}}}$$</div>

<div>$${{\bf{S}}^{{\rm{(T)}}}}{\bf{ = T}} \cdot {\bf{\Lambda }^{{\rm{(I)}}}} \cdot {{\bf{S}}^{{\rm{(I)}}}}$$</div>

(These are for radiation incident on the front surface of the fenestration; there is a similar set of equations for radiation incident on the back surface and propagating in an opposite sense to that in the above equations.)

In the LBNL method, these equations are used extensively to calculate the overall properties of a fenestration system from those of its component layers.  Here we will assume that the components of the system property matrices are given at input.  These may be from a calculation by WINDOW or determined by some other method.  The quantities needed for each fenestration are:

Table 34: Fenestration properties needed for the calculation











Exterior Window

<div>$$T_{ij}^F$$</div>

Front Transmittance  matrix elements

<div>$$R_{ij}^F$$</div>

Back Reflectance matrix elements

<div>$${\mathop{\rm A}\nolimits}_i^{F,n}$$</div>

In-situ absorptance of n<sup>th</sup> layer for front incidence

<div>$${\mathop{\rm A}\nolimits}_i^{B,n}$$</div>

In-situ absorptance of n<sup>th</sup> layer for back incidence











Interior Window

<div>$$T_{ij}^F$$</div>

Front Transmittance matrix elements

<div>$$T_{ij}^B$$</div>

Back Transmittance matrx elements

<div>$$R_{ij}^F$$</div>

Front Reflectance matrix elements

<div>$$R_{ij}^B$$</div>

Back Reflectance matrix elements

<div>$${\mathop{\rm A}\nolimits}_i^{F,n}$$</div>

In-situ absorptance of n<sup>th</sup> layer for front incidence

<div>$${\mathop{\rm A}\nolimits}_i^{B,n}$$</div>

In-situ absorptance of n<sup>th</sup> layer for back incidence



The transmittance and reflectance are overall system properties.  (For daylighting calculations, one also needs the transmittance and reflectance averaged over the visible spectrum only; the quantities indicated in the table pertain to the entire solar spectrum.)  For the optical calculations we do not need to know anything about the individual layers making up the fenestration.  However, the thermal calculation of heat flow through the fenestration requires knowledge of the amount of radiation absorbed in each of the fenestration layers.  As indicated in the table, we therefore need the in-situ layer absorptance for each layer, referenced to the incident surface.  This is denoted <span>${\mathop{\rm A}\nolimits}_i^{F,n}$</span> for the fraction of the *i<sup>th</sup>* component of the irradiance incident on the front surface of the fenestration that is absorbed in layer *n*, with a similar quantity, <span>${\mathop{\rm A}\nolimits}_i^{B,n}$</span>, for irradiance incident on the back surface.  The term “in-situ layer absorptance” is used because these are not simply the absorptance of the layer, but include the transmittance and interreflection by other layers of the system prior to the absorptance in layer *n*.  The absorptance is a row vector, having possibly a different value for each direction of the incident irradiance, so that for an irradiance *E<sub>i</sub><sup>F</sup>* on the front surface of a fenestration and *E<sub>i</sub><sup>B</sup>* on the back surface, the power *Q<sup>n</sup>* absorbed per unit area in layer *n* would be

<div>$${Q^n} = \sum\limits_i {{\mathop{\rm A}\nolimits}_i^{F,n}E_i^F}  + \sum\limits_j {{\mathop{\rm A}\nolimits}_j^{B,n}E_j^B} $$</div>

(In the vector/matrix language, <span>${Q^n} = {\bf{A}^{F,n}} \cdot {{\bf{E}}^F} + {\bf{A}^{B,n}} \cdot {{\bf{E}}^B}$</span>)

###### Bases and Coordinate Systems

The introduction of a basis or multiple bases is a bit more complicated than indicated in the text preceding equation .  There for transmission we need coordinates describing incoming radiation on one surface of the physical layer and outgoing radiation at the second (opposite) surface, while reflection adds the need for coordinates describing outgoing radiation at the first surface.  Back transmittance and reflectance add the requirement for coordinates describing incoming radiation at the second surface.  The usual way of assigning coordinates to radiation involves specifying its line of propagation relative to the local surface normal. This means that there are separate coordinate systems for the first and second surfaces, and that, moreover, the description is different for incoming and outgoing radiation: for incoming radiation one is specifying a unit vector pointing toward the source of the radiation (*i*.*e*., antiparallel to the direction of propagation), while for outgoing radiation one is specifying a unit vector in the direction of propagation of the radiation.  In principle, then, one needs four coordinate systems or bases (for each physical layer), and the process of transmission or reflection involves a discontinuous transition between an input basis and an output basis.

The LBNL method used by WINDOW uses a particular choice of coordinate systems in which incoming radiation at the first surface and outgoing radiation at the second are described by one coordinate system, while the same coordinate system reflected through the layer is used to describe incoming radiation at the second surface and outgoing radiation at the first.  The reason for this choice is that it greatly simplifies the matrix representations: specular transmittance or reflectance is always represented by a diagonal matrix, one can mix matrices representing forward or backward incidence processes, and all of the coordinate systems have propagation matrices with the same representation, so in effect there is one *L* matrix rather than four.

The point of this discussion is that the components of the transmittance and reflectance matrices, and the layer absorptance vectors, depend on the definition of these four bases.  If they were generated by WINDOW, then they assume the particular coordinate system described above.  (If they were produced by some other means, they may be specified in yet some other coordinate system.)  While the LBNL coordinate system gives an intuitive description of outgoing radiation, as a description of incoming radiation it is very unintuitive.  And in any case, the coordinate system is different from that of EnergyPlus.  It will be necessary to translate the matrices and vectors into the correct EnergyPlus coordinate system.

###### Matching the WINDOW6 Calculation to EnergyPlus

It is useful to have some sense of how well the basis normally used in WINDOW calculations matches the requirements of EnergyPlus.  In using a BSDF window, a user would presumably be interested in the directionality of the transmitted radiation; if the size of the solid angle bins in the basis is large compared to the solid angle subtended by the typical surface in a zone, then that directional information will be lost.  On the other hand, if the bins are very small compared to this solid angle, then (since EnergyPlus does not consider the spatial variations within a surface) the directions are being oversampled.  Since the calculation time will be proportional to the number of matrix elements, which is the square of the number of basis directions, oversampling is to be avoided.

Because of the great variety of buildings that may be modeled with EnergyPlus, and because the user has control over the basis for the BSDF properties, it is not possible to answer this question in a definitive way.  Here we consider the effect of the normal WINDOW basis in a typical perimeter office space, 10 ft wide, 15 ft deep and 11 ft high.  It is assumed to have a window 9 ft wide by 6 ft high, with the sill height 3 ft.  The window is placed to have a 4 in inner reveal.

The normal WINDOW “full” basis has 145 output directions.  Figure 92 shows how the window and the solid angle bin project onto the inner surfaces for three of those directions.  In each case the solid angle bin is projected from the window center, and the window edges are projected along the central ray.

In general, the basis appears to be reasonably matched to the calculation, with neither a loss of angular detail nor great oversampling.

![](EngineeringReference/media/image1326.png)

Figure 92. Transmitted Radiation in Three Directions for a Perimeter Office.  (a) q=0º; (b) q=40º, f=15º; (c) q=70º, f=67.5º.  q and f are the normal spherical angle coordinates in a right-handed coordinate system where y points up and z is normal to the window p

###### Complex Fenestrations in EnergyPlus

Exterior

EnergyPlus models the exterior radiance in two parts, a moving sun radiance <span>${S^{{\rm{(Sun)}}}}(t)\Delta {\Omega ^{{\rm{(Sun)}}}}$</span> and a constant-shape direction-dependent sky radiance <span>${S^{{\rm{(Sky)}}}}({\bf{p}},t)$</span>.  The intensities of these vary with time.  For the solar radiation there is a single sky radiance model.  For daylight calculations the treatment is similar for exterior luminance, except that there are a number of user-selectable sky luminance models.  Here we will discuss radiance; the treatment of luminance is analogous.

The direct normal solar intensity (at a given time) is

<div>$${I^{{\rm{(D)}}}}(t) = {S^{{\rm{(Sun)}}}}(t)\Delta {\Omega ^{{\rm{(Sun)}}}}$$</div>

and if we let

<div>$${S^{{\rm{(Sky)}}}}({\bf{p}},t) = {I^{{\rm{(Sky)}}}}(t)s({\bf{p}})$$</div>

where the shape function for the sky radiance model, *s*, is defined so that

<div>$$\int\limits_{2\pi } {s({\bf{p}})d\Omega }  = 1$$</div>

then the global solar irradiance on a horizontal surface at a given time is

<div>$${I^{{\rm{(G)}}}}(t) = {I^{{\rm{(Sky)}}}}(t)\left( {1 - \int\limits_{\Delta {\Omega ^{{\rm{(Sun)}}}}} {s({\bf{p}})d\Omega } } \right) + {I^{{\rm{(D)}}}}(t)\cos {\theta ^{{\rm{(Sun)}}}}(t)$$</div>

It must be understood that in equation the integration region 2p means integration over the sky hemisphere, and that *s(**p**)* is zero for upward-going directions.

With the sky radiance shape *s(**p**)* specified in the EnergyPlus code, the angular size of the sun <span>$\Delta {\Omega ^{{\rm{(Sun)}}}}$</span> known, and the solar zenith angle <span>${\theta ^{{\rm{(Sun)}}}}(t)$</span> calculated in the code, the two hourly input quantities *I*<sup>(D*)*</sup>*(t)* and *I*<sup>(G)</sup>*(t)* determine the exterior radiance for any given hour.

In this context, the transmitted radiance for a complex fenestration system given in equation becomes

<div>$$\begin{array}{c}S({{\bf{p}}^{{\rm{(T)}}}}) = {I^{({\bf{Sky}})}}(t)\int\limits_{{\Omega ^{{\rm{(Sky)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}})s({{\bf{p}}^{{\rm{(I)}}}})\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} \\ + \int\limits_{{\Omega ^{{\rm{(Gnd)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}}){S^{{\rm{(Gnd)}}}}({{\bf{p}}^{{\rm{(I)}}}},t)\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} \\ + H\left( {\Delta {\Omega ^{{\rm{(Sun)}}}}(t) \not\subset {\Omega ^{{\rm{(Sf)}}}}} \right)\int\limits_{\Delta {\Omega ^{{\rm{(Sun)}}}}(t)} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}}){S^{{\rm{(Sun)}}}}({{\bf{p}}^{{\rm{(I)}}}},t)\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} \\ + \int\limits_{{\Omega ^{{\rm{(Sf)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}}){S^{{\rm{(Refl)}}}}({{\bf{p}}^{{\rm{(I)}}}},t)\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} \end{array}$$</div>

where the incoming hemisphere viewed by the fenestration has been broken up into four parts.  The viewed sky (excluding the part containing the sun) is <span>${\Omega ^{{\rm{(Sky)}}}}$</span>, the viewed ground is <span>${\Omega ^{{\rm{(Gnd)}}}}$</span>, the part subtended by the sun is DW<sup>(Sun)</sup>, and the part subtended by one or more exterior surfaces (shading or reflecting objects) is W<sup>(Sf)</sup>.  These solid angles must exclude the exterior surfaces.  The symbol *H* represents a Helmholtz function: Its value is one if its logical argument is true, zero otherwise.  It has been inserted into the equation to account for those times when the sun is behind an exterior object.  Where there are multiple exterior shading or reflecting objects, W<sup>(Sf)</sup> may consist of several regions that may be disjoint or connected, depending on the exterior geometry.  As indicated in the equation, DW<sup>(Sun)</sup> is time-dependent, to account for the sun’s movement; W<sup>(Gnd)</sup> and W<sup>(Sf)</sup>  are fixed, but as written <span>${\Omega ^{{\rm{(Sky)}}}}$</span> has a time dependence induced by the exclusion of the solid angle subtended by the sun.  So that we can discuss the parts separately, we break the outgoing radiance down by source:

<div>$$S({{\bf{p}}^{{\rm{(T)}}}}) = {S^{{\rm{(Sky)}}}}({{\bf{p}}^{{\rm{(T)}}}}) + {S^{{\rm{(Gnd)}}}}({{\bf{p}}^{{\rm{(T)}}}}) + {S^{{\rm{(Sun)}}}}({{\bf{p}}^{{\rm{(T)}}}}) + {S^{{\rm{(Sf)}}}}({{\bf{p}}^{{\rm{(T)}}}})$$</div>

By subtracting the radiation from the part of the sky hidden by the sun from <span>${S^{{\rm{(Sun)}}}}$</span> and adding it back into *S*<sup>(Sky)</sup> we can remove the time dependence of W<sup>(Sky)</sup>:

<div>$$\begin{array}{c}{S^{{\rm{(Sun)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = H\left( {\Delta {\Omega ^{{\rm{(Sun)}}}}(t) \not\subset {\Omega ^{{\rm{(Sf)}}}}} \right)\\ \times \int\limits_{\Delta {\Omega ^{{\rm{(Sun)}}}}(t)} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}})\left[ {{S^{{\rm{(Sun)}}}}({{\bf{p}}^{{\rm{(I)}}}},t) - {I^{({\bf{Sky}})}}(t)s({{\bf{p}}^{{\rm{(I)}}}})} \right]\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} \end{array}$$</div>

<div>$${S^{{\rm{(Sky)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = {I^{({\bf{Sky}})}}(t)\int\limits_{{\Omega ^{{\rm{(Sky)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}})s({{\bf{p}}^{{\rm{(I)}}}})\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} $$</div>

Now in equation the integral is to be evaluated without regard to the sun position, and therefore <span>${\Omega ^{{\rm{(Sky)}}}}$</span> is time-independent.

We can further simplify equation by noting that the angular size of the sun is small, and both *s*(***p***<sup>(I)</sup>) and T(***p***<sup>(T)</sup>, ***p***<sup>(I)</sup>) can be considered as constant over the range of directions in DW<sup>(Sun)</sup>.  We can therefore evaluate them at the direction ***p***<sup>(Sun)</sup>(t) of the center of the sun and move them out of the integration, resulting in

<div>$${S^{{\rm{(Sun)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = {\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(Sun)}}}})\left[ {{I^{{\rm{(D)}}}} - {I^{{\rm{(Sky)}}}}s({{\bf{p}}^{{\rm{(Sun)}}}})\Delta {\Omega ^{{\rm{(Sun)}}}}} \right]\cos {\theta ^{{\rm{(Sun)}}}}H\left( {{{\bf{p}}^{{\rm{(Sun)}}}} \not\subset {\Omega ^{{\rm{(Sf)}}}}} \right)$$</div>

In this equation we have dropped the explicit time dependence, but ***p***<sup>(Sun)</sup>, *q*<sup>(Sun)</sup>, *I*<sup>(D)</sup>, and *I*<sup>(Sky)</sup> are time-varying, while DW<sup>(Sun)</sup> is simply the constant angular size of the sun.

We separate the reflected radiance *S*<sup>(Sf)</sup> into separate components for each surface,

<div>$${S^{{\rm{(Sf)}}}} = \sum\limits_n {{S^{{\rm{(Sf, n)}}}}} $$</div>

The individual shading surface reflected radiances are then

<div>$${S^{{\rm{(Sf, n)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = \int\limits_{{\Omega ^{{\rm{(Sf, n)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}}){S^{{\rm{(Refl, n)}}}}({{\bf{p}}^{{\rm{(I)}}}},t)\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} $$</div>

The solid angle of integration in this expression is subtended by the portion of the exterior reflecting surface *n* viewed by the fenestration; if one surface lies behind another, the hidden part of its surface is removed from the solid angle it subtends.  This is summarized by the requirement

<div>$$\begin{array}{l}{\Omega ^{{\rm{(Sf)}}}} = \bigcup\limits_n {{\Omega ^{{\rm{(Sf, n)}}}}} \\\bigcap\limits_n {{\Omega ^{{\rm{(Sf, n)}}}}}  = 0\end{array}$$</div>

(This requirement will need to be modified to handle the case of transmitting exterior surfaces.)

*S*<sup>(Refl,n)</sup> is time dependent because the incident radiation on the surface depends on the sun position. * *Equation must be evaluated after the exterior surface shading or reflectance calculations, in order to enforce the requirement that

<div>$${\Omega ^{{\rm{(Sky)}}}} \cap {\Omega ^{{\rm{(Sf)}}}} = 0$$</div>

Finally, the transmitted radiance from the ground-reflected exterior radiation is

<div>$${S^{{\rm{(Gnd)}}}}({{\bf{p}}^{{\rm{(T)}}}}) = \int\limits_{{\Omega ^{{\rm{(Gnd)}}}}} {{\mathop{\rm T}\nolimits} ({{\bf{p}}^{{\rm{(T)}}}},{{\bf{p}}^{{\rm{(I)}}}}){S^{{\rm{(Gnd)}}}}({{\bf{p}}^{{\rm{(I)}}}},t)\left( { - {{\bf{p}}^{{\rm{(I)}}}}\cdot {\bf{n}}} \right)d{\Omega ^{{\rm{(I)}}}}} $$</div>

Here, not only is there the requirement that

<div>$${\Omega ^{{\rm{(Gnd)}}}} \cap {\Omega ^{{\rm{(Sf)}}}} = 0$$</div>

but also the incident radiation on the ground may be affected by shading or reflection from exterior surfaces.  Since this is dependent on the sun position, *S*<sup>(Gnd)</sup> is time dependent, as indicated in equation .

Applying the discretization of the previous section and the definitions in equations -, we can rewrite equation as

<div>$${S_j}^{{\rm{(T,Sky)}}} = {I^{({\bf{Sky}})}}(t)\sum\limits_{i \in {\Omega ^{{\rm{(Sky)}}}}} {{T_{ji}}{\Lambda_{ii}}{s_i}} $$</div>

where

<div>$${s_i} = s({{\bf{p}}_i}^{{\rm{(I)}}})$$</div>

is the sky radiance shape factor evaluated at the central direction of the i<sup>th</sup> solid angle bin.  A “T” superscript has been added on the left-hand side of the equation to denote that *S* is the transmitted outgoing radiance (due to incident sky radiation for the fenestration under discussion).  The stipulation <span>$i \in {\Omega ^{{\rm{(Sky)}}}}$</span> on the summation means that the sum is to include only those solid angle elements for which the sky is viewed by the fenestration.  This is essentially a shading calculation, in addition to a restriction to downward-going incident directions.  We anticipate the result of this calculation by defining a sky geometric factor:

<div>$$
  V_i^{(Sky)} = \left\{
    \begin{array}
      1                      & \text{all of } \Delta\Omega_i \text{ views sky for all of fenestration} \\
      \text{viewed fraction} & \text{some of } \Delta\Omega_i \text{, fenestration views sky} \\
      0                      & \text{none of } \Delta\Omega_i \text{ views sky for any part of fenestration
$$</div>

Then we can carry out the summation over all downward directions and write

<div>$${S_j}^{{\rm{(T,Sky)}}} = {I^{({\bf{Sky}})}}(t)\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sky)}}}{s_i}} $$</div>

Similarly, equation becomes

<div>$${S_j}^{{\rm{(T, Sf, n)}}} = \sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}{S^{{\rm{(Refl, n)}}}}({{\bf{p}}_i}^{{\rm{(I)}}},t)} $$</div>

where *V<sub>i</sub>*<sup>(Sf,\\ n)</sup> is another geometric view factor, defined analogously to equation , giving the fraction of the solid angle <span>$\Delta {\Omega_i}$</span> that views the exterior surface *n*.  Note that

<div>$$V_i^{{\rm{(Sky)}}} + \sum\limits_{\rm{n}} {V_i^{{\rm{(Sf, n)}}}}  = 1$$</div>

The quantity <span>$S^{(Refl,n)} (\bf{p}_i^{(I)},t)$</span> is in fact the reflected radiance at a particular location on the n<sup>th</sup> exterior surface—the location where the direction ***p****<sub>i</sub>*<sup>(I)</sup> intersects the surface.  (This statement will become more precise when the spatial dependence dropped from equation is re-inserted.)  This surface is assumed to have either a diffuse reflectance *r*<sup>(n)</sup> or a specular reflectance *r*<sup>(sp,\\ n)</sup>.  (Both properties are possible simultaneously, but EnergyPlus assumes that an exterior surface is either diffusing or specular, but not both.)  The reflectance is assumed uniform over the surface, but the particular location (effectively, the image of the fenestration projected onto surface n) may or may not view the sky, or, at a particular time, the sun.  We denote the incident irradiance of the surface n by <span>$E_i^n$</span>.  This irradiance pertains only to the surface n (in the present EnergyPlus calculation) and is independent of the fenestration or its basis.  We attach the subscript i simply as a reminder that (2) the irradiance pertains to the portion of the surface that is viewed by the solid angle element <span>$\Delta {\Omega_i}$</span> of the fenestration f (which would become important if the EnergyPlus shading calculations were modified to relax the assumption of uniform incident irradiance on exterior surfaces) and that the irradiance pertains only to those surfaces n that are viewed by the solid angle element i.  For specularly reflecting surfaces, we make the following definitions: First, within the set of basis solid angles <span>$\Delta {\Omega_i}$</span>, let s(*t*) identify the one containing the sun direction at time *t*, and let r(*t*) identify the one containing the specular reflection direction of the sun at time *t*.  We then define a contingent direct beam irradiance, which we denote by <span>$E_{i{\rm{ }}r(t)}^{(D,n)}$</span>. This irradiance is non-zero only if <span>$i = r(t)$</span>this direction is such that i is the specularly reflected direction for the surface n.  If this is the case, then <span>$E_{i=r(t)}^{(D,n)}$</span> is the incident direct beam irradiance.  With this definition,

<div>$${S^{{\rm{(Refl, n)}}}}({{\bf{p}}_i}^{{\rm{(I)}}},t) = {\rho ^{{\rm{(sp, n)}}}}E_{i{\rm{ }}r(t)}^{(D,n)} + {\rho ^{{\rm{(n)}}}}E_i^n$$</div>

If we then define normalized irradiance factors *U* by <span>$E_i^n = U_i^{(Sky,n)}{I^{(Sky)}}(t) + U_{i{\rm{ }}Sun(tsh)}^{(D,n)}{I^{(D)}}(t)$</span> and <span>$E_{i{\rm{ }}r(t)}^{(D,n)} = U_{i{\rm{ }}r(t)}^{(D,n)}{I^{(D)}}(t)$</span>, where <span>$U_{i{\rm{ }}Sun(tsh)}^{(D,n)}$</span> denotes the fraction of the beam solar that irradiates the surface for a given sun direction.  It is evaluated during the shading calculation, as indicated by the notation *Sun(tsh)*.  With these definitions we can rewrite the equation as

<div>$$
  S^{(Refl,n)}(\bf{p}_i^{(I)},t) = 
  I^{(D)}(t) U_{i r(t)}^{(D,n)} \rho^{(sp,n)} +
  I^{(D)}(t) U_{i Sun(tsh)}^{(D,n)} \rho^{(n)} +
  I^{(sky)}(t) U_i^{(Sky,n)} \rho^{(n)}
$$</div>

and equation becomes, in terms of the incident irradiances,

<div>$${S_j}^{{\rm{(T, Sf, n)}}} = \sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}\left( {{\rho ^{{\rm{(sp, n)}}}}E_{i{\rm{ }}r(t)}^{(D,n)} + {\rho ^{{\rm{(n)}}}}E_i^n} \right)} $$</div>

and in terms of the normalized irradiance factors,

<div>$$\begin{array}{c}{S_j}^{{\rm{(T, Sf, n)}}} = \sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}{I^{{\rm{(D)}}}}(t)U_{i{\rm{ r(}}t{\rm{)}}}^{{\rm{(D,n)}}}{\rho ^{{\rm{(sp, n)}}}}} \\ + \sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}\left[ {{I^{{\rm{(D)}}}}(t)U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D,n)}}}{\rho ^{{\rm{(n)}}}} + {I^{(Sky)}}(t)U_i^{{\rm{(Sky,n)}}}{\rho ^{{\rm{(n)}}}}} \right]} \end{array}$$</div>

The specularly reflected term can be removed from the sum, since only one value of i can contribute:

<div>$${S_j}^{{\rm{(T, Sf, n)}}} = {T_{j{\rm{ r(}}t{\rm{)}}}}{\Lambda_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}}V_{{\rm{ r(}}t{\rm{)}}}^{{\rm{(Sf, n)}}}E_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}^{{\rm{(D,n)}}}{\rho ^{{\rm{(sp, n)}}}} + {\rho ^{{\rm{(n)}}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}E_i^n} $$</div>

and

<div>$$\begin{array}{c}{S_j}^{{\rm{(T, Sf, n)}}} = {T_{j{\rm{ r(}}t{\rm{)}}}}{\Lambda_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}}V_{{\rm{ r(}}t{\rm{)}}}^{{\rm{(Sf, n)}}}U_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}^{{\rm{(D,n)}}}{I^{(D)}}(t){\rho ^{{\rm{(sp, n)}}}}\\ + {\rho ^{{\rm{(n)}}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}\left( {{I^{{\rm{(D)}}}}(t)U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D,n)}}} + U_i^{(Sky,n)}{I^{(Sky)}}(t)} \right)} \end{array}$$</div>

which separates specular and diffuse reflectance from the exterior surfaces.

With respect to shading and reflection of exterior radiation into the fenestration, the exterior reveal surfaces can be treated as additional diffusely reflecting exterior surfaces.

Ground radiation is treated in the same way as radiation reflected from interior surfaces, except that one sums only over upward-going incident directions, and the ground is assumed to be diffusely reflecting.  The transmitted radiance from ground reflectance is

<div>$${S_j}^{{\rm{(T, Gnd)}}} = {\rho ^{{\rm{(Gnd)}}}}\sum\limits_{i{\rm{ }}up} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}E_i^{(Gnd)}} $$</div>

In this equation, the symbol <span>$E_i^{(Gnd)}$</span> is shorthand for a spatial calculation.  The solid angle region <span>$\Delta {\Omega_i}$</span> views (from various points over the fenestration area) some spatial region of the ground.  The symbol <span>$E_i^{(Gnd)}$</span> denotes the incident irradiance on the ground over this spatial region.  In the absence of shading, this would be simply <span>${I^{(G)}} = {I^{(Sky)}} + {I^{(D)}}\cos {\theta_{Sun}}$</span>; shading requires a more complex calculation.  Currently the EnergyPlus code does a Monte-Carlo calculation: rays are randomly generated from the window, when they strike the ground a calculation is made to determine whether that point receives direct solar radiation and what portion of the sky it views (reflected radiation from surfaces is neglected).  Here we would perform that calculation for each region of the ground i viewed by a basis solid angle element, instead of generating random rays from the window.  We denote the results of that calculation by <span>$E_i^{(Gnd)} = U_{i{\rm{ }}Sun(tsh)}^{(D,Gnd)}{I^{(D)}}(t) + U_i^{(Sky,Gnd)}{I^{(Sky)}}(t)$</span>, where the *U*’s are average viewing factors for the sun and sky, calculated as part of the shading calculation (which is indicated by the subscript *tsh*: *Sun(tsh)* is the sun direction as specified by the shading calculation.  This then gives

<div>$${S_j}^{{\rm{(T, Gnd)}}} = {\rho ^{{\rm{(Gnd)}}}}\sum\limits_{i{\rm{ }}up} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}\left( {U_{i{\rm{ }}Sun(tsh)}^{(D,Gnd)}{I^{(D)}}(t) + U_i^{(Sky,Gnd)}{I^{(Sky)}}(t)} \right)} $$</div>

The transmitted radiance from direct beam radiation is

<div>$${S_j}^{{\rm{(T, Sun)}}} = {T_{j{\rm{ s}}(t)}}\cos {\theta ^{{\rm{(Sun)}}}}{I^{{\rm{(D)}}}}(t)V_{i{\rm{ s(}}t{\rm{)}}}^{{\rm{(D)}}}$$</div>

This introduces yet one more geometric view factor: 

<div>$$
  V_{i s(t)}^(D)}
$$</div> 

is zero if the sun direction s*(t)* is not *i*; if *i*=s(*t*) it is the fraction of the fenestration area irradiated by the direct sun.  Equation uses the fact that the angular size of the sun is smaller than any basis solid angle element, and that EnergyPlus treats the sun and circumsolar region as a point source [hence the absence of the sky correction in equation ].

At this point we have developed separate expressions for a fenestration’s  transmitted radiance in a particular direction depending on the exterior source of the radiation.  These expressions utilize the discretized BTDF of the fenestration in the form of transmittance matrix elements over an angular basis.  The exterior geometry is re-expressed in the form of geometric view factors in this basis.  In the process, the explicit time dependence of the exterior radiation has been reduced to the time-varying direct and diffuse solar intensities and the solar position.  The time dependence of the solar position, however, consists merely in specifying, for a particular time, which of the basis solid angle elements contains the solar direction.  The entire exterior geometry necessary for the fenestration transmittance calculation can therefore be pre-calculated.

Interior

We begin with the discretized form of equation , in which we also modify the surface notation.  In that equation, the surfaces involved are termed (1) and (2), where radiation is outgoing from surface 1 and incoming to surface 2.  Here radiation is outgoing from the inner surface of the fenestration, so we label that surface (f).  The receiving surface is one of the surfaces of the zone in which the fenestration is located.  We number those surfaces with the index *k*, so the receiving surface is labeled (*k*).  Equation then becomes

<div>$$dW_j^{{\rm{(f}} \to k{\rm{)}}} = {E^{{\rm{(}}k{\rm{)}}}}({{\bf{p}}_j}^{{\rm{(T)}}})d{A^{{\rm{(}}k{\rm{)}}}} = {S_j}^{{\rm{(T)}}} \cdot \left( {{{\bf{n}}^{{\rm{(f)}}}} \cdot {{\bf{p}}_j}^{{\rm{(T)}}}} \right)\Delta {\Omega_j}^{{\rm{(T)}}}d{A^{{\rm{(f)}}}}$$</div>

or, noting that <span>$  \left(\bf{n}^{(f)}\cdot\bf{p}_j^{(T)}\right) \Delta\Omega^{(T)} = \Lambda_{jj}^{(T)} $</span> (where the superscript T is retained in case the incoming and outgoing bases are defined differently),

<div>$$dW_j^{{\rm{(f}} \to k{\rm{)}}} = {E^{{\rm{(}}k{\rm{)}}}}({{\bf{p}}_j}^{{\rm{(T)}}})d{A^{{\rm{(}}k{\rm{)}}}} = {S_j}^{{\rm{(T)}}}\Lambda_{jj}^{{\rm{(T)}}}d{A^{{\rm{(f)}}}}$$</div>

If we integrate this expression over the fenestration area *A*<sup>(f)</sup> we obtain the total power leaving the fenestration surface in direction *j*; however, all of that power may not reach surface *k*: some may strike the inner window reveal or a different zone surface.  If we define a spatial projection operator by

<div>$${{\bf{x}}^{{\rm{(}}k{\rm{)}}}} = {{\mathop{\rm P}\nolimits} ^{{\rm{(}}k{\rm{)}}}}({\bf{p}}_j^{{\rm{(T)}}},{{\bf{x}}^{{\rm{(f)}}}}) \equiv {{\mathop{\rm P}\nolimits}_j}^{{\rm{(}}k{\rm{)}}}({{\bf{x}}^{{\rm{(f)}}}})$$</div>

where ***x***<sup>(*k*)</sup> is in the plane of surface *k*, and a geometric form factor by

<div>$$F_j^{{\rm{(}}k{\rm{)}}} = \frac{1}{{{A^{{\rm{(f)}}}}}}\int\limits_{{{\mathop{\rm P}\nolimits}_j}^{{\rm{(}}k{\rm{)}}}({{\bf{x}}^{{\rm{(f)}}}}) \in {A^{{\rm{(}}k{\rm{)}}}}} {d{A^{{\rm{(f)}}}}} $$</div>

then

<div>$$dW_j^{{\rm{(f}} \to k{\rm{)}}} = {S_j}^{{\rm{(T)}}}\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}{A^{{\rm{(f)}}}}$$</div>

The total power leaving the fenestration (in any direction) and arriving at surface *k* is then

<div>$$W_j^{{\rm{(f}} \to k{\rm{)}}} = \sum\limits_j {{S_j}^{{\rm{(T)}}}\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}{A^{{\rm{(f)}}}}} $$</div>

Substituting equations , , , , into equation yields a series of expressions for the total power arriving at surface *k* (by transmission through fenestration f) from each of the sources of exterior radiation.  However, the equations for transmitted radiation describe an infinitesimal region, which means that the radiation in a given direction will always come from one source.  When one integrates the transmitted power over the fenestration surface, one encounters the problem that for this direction different parts of the fenestration area may receive radiation from different sources.  Also, for a given outgoing direction, the projection of a receiving surface back onto the fenestration may produce an image that covers only part of the fenestration area, and this image may not be identical with the part of the area that receives incident radiation from a particular source.  The most important origin of this problem is the existence of inner and outer window reveals, as illustrated in Figure 93.

![](EngineeringReference/media/image1392.png)

Figure 93. Mismatch of irradiated and viewed fenestration areas for different incident and outgoing directions

In this figure, the portion of the fenestration area not viewed by the plane of surface *k* is instead viewed by one or more of the inner window reveals.  Similarly, the portion of the fenestration not irradiated in the figure is in fact irradiated by diffusely reflected radiation from the outer window reveals.  We can account for this by replacing the area *A*<sup>(f)</sup> in equation with the overlap area <span>$A_{ji}^{{\rm{(f, Src), }}k}$</span>* *(dark shaded in the figure), where “Src” stands for the source of the incident radiation.  This area is defined by

<div>$$A_{ji}^{\left( {f,Src} \right),k} = \left. {A_i^{\left( {f,Src} \right)}} \right|A_j^{\left( f \right),k}$$</div>

The total power at the interior surface *k* for each source of radiation then becomes

<div>$${W^{{\rm{(Sky), }}k}} = {I^{({\bf{Sky}})}}(t)\sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sky)}}}A_{ji}^{{\rm{(f, Sky), }}k}{s_i}} } $$</div>

<div>$$\begin{array}{c}{W^{{\rm{(Sf,n)}},k}} = {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(sp, n)}}}}\sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}{T_{j{\rm{ r(}}t{\rm{)}}}}{\Lambda_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}}V_{{\rm{ r(}}t{\rm{)}}}^{{\rm{(Sf, n)}}}A_{j{\rm{ r(}}t{\rm{)}}}^{{\rm{(f, Sf, n), }}k}U_{{\rm{ r(}}t{\rm{) s(}}t{\rm{)}}}^{{\rm{(D,n)}}}} \\ + {I^{(D)}}(t){\rho ^{{\rm{(n)}}}}\sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}A_{ji}^{{\rm{(f, Sf, n), }}k}U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D,n)}}}} } \\ + {I^{(Sky)}}(t){\rho ^{{\rm{(n)}}}}\sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}A_{ji}^{{\rm{(f, Sf, n), }}k}U_i^{{\rm{(Sky,n)}}}} } \end{array}$$</div>

<div>$$\begin{array}{c}{W^{{\rm{(Gnd)}},k}} = {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(Gnd)}}}}\sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}up} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}A_{ji}^{{\rm{(f, Gnd), }}k}U_{i{\rm{ }}Sky(tch)}^{{\rm{(D, Gnd)}}}} } \\ + {I^{({\bf{Sky}})}}(t){\rho ^{{\rm{(Gnd)}}}}\sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}up} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}A_{ji}^{{\rm{(f, Gnd), }}k}U_i^{{\rm{( Sky,Gnd)}}}} } \end{array}$$</div>

<div>$${W^{{\rm{(Sun)}},k}} = {I^{{\rm{(D)}}}}(t)\sum\limits_j {F_j^{{\rm{(}}k{\rm{)}}}\Lambda_{jj}^{{\rm{(T)}}}{T_{j{\rm{ s}}(t)}}\cos {\theta_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}}}V_{i{\rm{ s(}}t{\rm{)}}}^{{\rm{(D)}}}A_{j{\rm{ s(}}t{\rm{)}}}^{{\rm{(f, Sun), }}k}} $$</div>

If we define a series of solar irradiation factors, Z, that describe the fraction of the radiation incident on the fenestration due to a given exterior radiation source that is ultimately incident on the interior surface *k*,

<div>$${Z^{{\rm{(Sky), }}k}} = \sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sky)}}}A_{ji}^{{\rm{(f, Sky), }}k}{s_i}} } $$</div>

<div>$${Z_{{\rm{r(}}t{\rm{)}}}}^{{\rm{(sp, Sf, n)}},k} = \sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}{T_{j{\rm{ r(}}t{\rm{)}}}}{\Lambda_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}}V_{{\rm{ r(}}t{\rm{)}}}^{{\rm{(Sf, n)}}}A_{j{\rm{ r(}}t{\rm{)}}}^{{\rm{(f, Sf, n), }}k}U_{{\rm{ r(}}t{\rm{) s(}}t{\rm{)}}}^{{\rm{(D,n)}}}} $$</div>

<div>$${Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun, Sf, n)}},k} = \sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}A_{ji}^{{\rm{(f, Sf, n), }}k}U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D,n)}}}} } $$</div>

<div>$${Z^{{\rm{(Sky, Sf, n)}},k}} = \sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}down} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}A_{ji}^{{\rm{(f, Sf, n), }}k}U_i^{{\rm{(Sky, n)}}}} } $$</div>

<div>$${Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(D, Gnd)}},k} = \sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}up} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}A_{ji}^{{\rm{(f, Gnd), }}k}U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D, Gnd)}}}} } $$</div>

<div>$${Z^{{\rm{(Sky, Gnd)}},k}} = \sum\limits_j {\Lambda_{jj}^{{\rm{(T)}}}F_j^{{\rm{(}}k{\rm{)}}}\sum\limits_{i{\rm{ }}up} {{T_{ji}}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}A_{ji}^{{\rm{(f, Gnd), }}k}U_i^{{\rm{(Sky, Gnd)}}}} } $$</div>

<div>$${Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}},k} = \sum\limits_j {F_j^{{\rm{(}}k{\rm{)}}}\Lambda_{jj}^{{\rm{(T)}}}{T_{j{\rm{ s}}(t)}}\cos {\theta_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}}}V_{i{\rm{ s(}}t{\rm{)}}}^{{\rm{(D)}}}A_{j{\rm{ s(}}t{\rm{)}}}^{{\rm{(f, Sun), }}k}} $$</div>

then equations through become

<div>$${W^{{\rm{(Sky), }}k}} = {I^{({\bf{Sky}})}}(t){Z^{{\rm{(Sky), }}k}}$$</div>

<div>$$\begin{array}{c}{W^{{\rm{(Sf,n)}},k}} = {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(sp, n)}}}}{Z_{{\rm{r(}}t{\rm{)}}}}^{{\rm{(sp, Sf, n)}},k} + {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(n)}}}}{Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun, Sf, n)}},k}\\ + {I^{({\bf{Sky}})}}(t){\rho ^{{\rm{(n)}}}}{Z^{{\rm{(Sky, Sf, n)}},k}}\end{array}$$</div>

<div>$${W^{{\rm{(Gnd)}},k}} = {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(Gnd)}}}}{Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(D, Gnd)}},k} + {I^{({\bf{Sky}})}}(t){\rho ^{{\rm{(Gnd)}}}}{Z^{{\rm{(Sky, Gnd)}},k}}$$</div>

<div>$${W^{{\rm{(Sun)}},k}} = {I^{{\rm{(D)}}}}(t){Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}},k}$$</div>

The notation s(*t*) appearing in a subscript in several of the above equations refers to the basis direction for which the sun direction is contained in the basis solid angle element.  This is of course time dependent.  What is meant here is that at any given time the particular basis element containing the sun is to be picked out.  (If no basis element for the fenestration contains the sun at a given time, then the corresponding view factor—and therefore irradiance or absorption factor—is zero.)  It is therefore necessary to tabulate those quantities with an s(*t*) subscript for all basis directions *s* that could possibly contain the sun direction (and for *r(t)*, all basis directions that could possibly contain the reflected sun angle for the surface n).  This is a set considerably smaller than that of all incoming basis directions.  Figure 94 illustrates this point for direct irradiation of fenestrations in three different orientations in a building at a particular latitude, using the W6 full basis, which has 145 incoming directions.  In the worst case (west-facing) one only needs to consider around 50 of these, with much fewer needed in other orientations.  The specific numbers for a given fenestration will depend on the choice of basis, orientation and latitude.  The basis direction values can of course be interpolated where greater directional resolution is warranted.  In equation the specular direction r(*t*) is uniquely determined by the sun direction s(*t*), so the Z factor does not need an additional index for *s*.

![](EngineeringReference/media/image1410.png)

Figure 94. Sun Paths and Incident Basis for Three Window Orientations, 38º N. Latitude.  The nodal positions (blue dots) for a W6 full basis are compared with the summer solstice (red curve) and winter solstice (green curve) solar paths.  Solar paths for other days of the year will lie between these two extremes.  (Note: the basis points are to be interpreted as the direction of a vector pointing from the fenestration to the sun.)  (a) South facing.  (b) West facing.  (c) North facing (the winter path is off the figure (i.e., the window is shaded); allowed paths will be outside the red path.

The reason for the definition of the Z factors is that to a great extent they can be precalculated, so that within the hourly calculation only equations - need to be used.  In addition, there are fewer Z factors to be stored than transmittance matrix elements.  The storage determinants for the foregoing calculations are summarized in the following table.

Table 35: Determination of array sizes

<table class="table table-striped">
  <tr>
    <th colspan="2">Parameters</th>
  </tr>
  <tr>
    <td>*N<sub>Basis</sub>*</td>
    <td>Number of elements in the (incoming or outgoing) basis</td>
  </tr>
  <tr>
    <td>*N<sub>Sun</sub>*</td>
    <td>Number of basis directions that may be sun directions (depends on fenestration orientation</td>
  </tr>
  <tr>
    <td>*<span>$N_{Sun}^{(Gnd)}$</span>*</td>
    <td>Number of sun directions that give significantly different ground irradiation conditions, as seen by fenestration</td>
  </tr>
  <tr>
    <td>*N<sub>Sf</sub>*</td>
    <td>Number of reflecting surfaces viewable by fenestration (depends on fenestration orientation)</td>
  </tr>
  <tr>
    <td><sup><span>$N_{Sun}^{{\rm{(Sf, n)}}}$</span></sup></td>
    <td>Number of time steps for which surface *n* is sunlit (depends on orientation of surface *n*; determined during shading calculation)</td>
  </tr>
  <tr>
    <td><sup><span>$N_{Refl}^{{\rm{(Sf, n)}}}$</span></sup></td>
    <td>Number of basis directions that may be reflected sun directions from surface *n* (depends on orientation of fenestration and surface *n*).</td>
  </tr>
  <tr>
    <td>*N<sub>IntSurf</sub>*</td>
    <td>Number of interior surfaces in the zone containing the fenestration</td>
  </tr>
  <tr>
    <td>*N<sub>Layers</sub>*</td>
    <td>Number of thermal layers in the fenestration system</td>
  </tr>
  <tr>
    <td colspan="2">Arrays</td>
  </tr>
  <tr>
    <td><div>$$\begin{array}{*{20}{c}}{{\mathop{\rm A}\nolimits}_i^{F,l},}&amp;{{\mathop{\rm A}\nolimits}_i^{B,l}}\end{array}$$</div></td>
    <td>Absorptance vector element; *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td>*T<sub>ij</sub>*</td>
    <td>Transmittance matrix element; *N<sub>Basis </sub>* X *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td><div>$$V_i^{{\rm{(Sky)}}}$$</div></td>
    <td>Sky viewed fraction; one-dimensional, *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td><div>$$V_i^{{\rm{(Sf, n)}}}$$</div></td>
    <td>Fraction of surface *n* viewed; *N<sub>Basis</sub>* X *N<sub>Sf</sub>*</td>
  </tr>
  <tr>
    <td>*r*<sup>(n)</sup>,*r*<sup>(sp,\\ n)</sup></td>
    <td>Surface *n* diffuse, specular reflectance; *N<sub>Sf</sub>*  (already stored by E+)</td>
  </tr>
  <tr>
    <td><div>$$U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D,n)}}}$$</div></td>
    <td>Fraction of the image of <span>$\Delta {\Omega_i}$</span> on surface *n* that views the sun when it is in direction Sun(tsh); *N<sub>Basis</sub>* X *N<sub>Sf</sub>* X <span>$N_{Sun}^{{\rm{(Sf, n)}}}$</span></td>
  </tr>
  <tr>
    <td><div>$$V_i^{{\rm{(Gnd)}}}$$</div></td>
    <td>Fraction of <span>$\Delta {\Omega_i}$</span> that views ground; *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td><div>$$U_i^{{\rm{(Sky, Gnd)}}}$$</div></td>
    <td>Fraction of sky radiation received by the image of <span>$\Delta {\Omega_i}$</span> on the ground; *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td><div>$$U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D, Gnd)}}}$$</div></td>
    <td>Fraction of direct solar radiation for sun direction Sun(tsh) received by image of <span>$\Delta {\Omega_i}$</span> on ground; <span>$N_{Sim}^{Gnd}$</span>*<sub> </sub>*X *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td><div>$$V_{i{\rm{ s(}}t{\rm{)}}}^{{\rm{(D)}}}$$</div></td>
    <td>Fraction of fenestration area irradiated by direct solar radiation for direction *i*, given that sun angle is s(*t*); N*<sub>Sun</sub>* X *N<sub>Basis</sub>*</td>
  </tr>
  <tr>
    <td><div>$$F_j^{{\rm{(}}k{\rm{)}}}$$</div></td>
    <td>Fraction of radiation in direction *j* leaving fenestration interior that arrives at surface *k*; *N<sub>Basis</sub>* X *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z^{{\rm{(Sky), }}k}}$$</div></td>
    <td>Sky irradiation factor; *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z_{{\rm{r(}}t{\rm{)}}}}^{{\rm{(sp, Sf, n)}},k}$$</div></td>
    <td>Exterior surface specular irradiation factor; <span>$N_{Sun}^{{\rm{(Sf, n)}}}$</span>X *N<sub>Sf</sub>* X *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun, Sf, n)}},k}$$</div></td>
    <td>Exterior surface direct-diffuse irradiation factor; <span>$N_{Sun}^{{\rm{(Sf, n)}}}$</span> X *N<sub>Sf</sub>* X *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z^{{\rm{(Sky, Sf, n)}},k}}$$</div></td>
    <td>Exterior surface sky irradiation factor; *N<sub>Sf</sub>* X *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(D, Gnd)}},k}$$</div></td>
    <td>Ground-reflected direct solar irradiaton factor (given sun direction s(*t*)); <span>$N_{Sun}^{Gnd}$</span> X *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z^{{\rm{(Sky, Gnd)}},k}}$$</div></td>
    <td>Ground-reflected diffuse solar irradiation factor; *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${Z_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}},k}$$</div></td>
    <td>Direct solar irradiation factor; *N<sub>Sun</sub>* X *N<sub>IntSurf</sub>*</td>
  </tr>
  <tr>
    <td><div>$${K^{{\rm{(Sky), }}l}}$$</div></td>
    <td>Sky absorption factor; *N<sub>Layers</sub>*</td>
  </tr>
  <tr>
    <td><div>$${K_{{\rm{r(}}t{\rm{)}}}}^{{\rm{(sp, Sf, n)}},l}$$</div></td>
    <td>Exterior surface specular absorption factor; *N<sub>Sf</sub>* X <span>$N_{Refl}^{{\rm{(Sf, n)}}}$</span> X *N<sub>Layers</sub>*</td>
  </tr>
  <tr>
    <td><div>$${K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun, Sf, n)}},l}$$</div></td>
    <td>Exterior surface diffusely reflected direct sun absorption factor; *N<sub>Sf</sub>* X <span>$N_{Sun}^{{\rm{(Sf, n)}}}$</span> X *N<sub>Layers</sub>*</td>
  </tr>
  <tr>
    <td><div>$${K^{{\rm{(Sky, Sf, n)}},l}}$$</div></td>
    <td>Exterior surface reflected sky radiation absorption factor;</td>
  </tr>
  <tr>
    <td><div>$${K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(D, Gnd)}},l}$$</div></td>
    <td>Ground-reflected direct solar absorption factor; <span>$N_{Sun}^{(Gnd)}$</span>X *N<sub>Layers</sub>*</td>
  </tr>
  <tr>
    <td><div>$${K^{{\rm{(Sky, Gnd)}},l}}$$</div></td>
    <td>Ground-reflected sky radiation absorption factor; *N<sub>Layers</sub>*</td>
  </tr>
  <tr>
    <td><div>$${K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}},l}$$</div></td>
    <td>Direct sunlight absorption factor; *N<sub>Sun</sub>* X *N<sub>Layers</sub>*</td>
  </tr>
</table>

###### Absorption

For thermal calculations it is necessary to know the energy absorbed in each layer of the fenestration.  This depends only on the incident geometry, but otherwise is calculated in the same manner as the solar flux incident on interior surfaces.  For a given layer l of a fenestration f, we define a source-referenced absorption factor, K(source),l.  This is the amount of energy absorbed in layer l divided by the relevant solar intensity (which might be beam, diffuse, or reflected beam or diffuse, depending on the source of the radiation).  These absorption factors and the resultant source-specific absorbed solar powers are calculated by the analogs [see equation of equations through :

<div>$${K^{{\rm{(Sky), }}l}} = {A^{{\rm{(f)}}}}\sum\limits_{i{\rm{ }}down} {{\mathop{\rm A}\nolimits}_i^{F,l}{\Lambda_{ii}}V_i^{{\rm{(Sky)}}}{s_i}} $$</div>

<div>$${Q^{{\rm{(Sky), }}l}} = {I^{({\bf{Sky}})}}(t){K^{{\rm{(Sky), }}l}}$$</div>

<div>$${K_{{\rm{r(}}t{\rm{)}}}}^{{\rm{(sp, Sf, n)}},l} = {A^{{\rm{(f)}}}}{\mathop{\rm A}\nolimits}_{r(t)}^{F,l}{\Lambda_{{\rm{ r(}}t{\rm{) r(}}t{\rm{)}}}}V_{{\rm{ r(}}t{\rm{)}}}^{{\rm{(Sf, n)}}}U_{{\rm{ r(}}t{\rm{) s(}}t{\rm{)}}}^{{\rm{(D,n)}}}$$</div>

<div>$${K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun, Sf, n)}},l} = {A^{{\rm{(f)}}}}\sum\limits_{i{\rm{ }}down} {{\mathop{\rm A}\nolimits}_i^{F,l}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D,n)}}}} $$</div>

<div>$${K^{{\rm{(Sky, Sf, n)}},l}} = {A^{{\rm{(f)}}}}\sum\limits_{i{\rm{ }}down} {{\mathop{\rm A}\nolimits}_i^{F,l}{\Lambda_{ii}}V_i^{{\rm{(Sf, n)}}}U_i^{{\rm{(Sky, n)}}}} $$</div>

<div>$$\begin{array}{c}{Q^{{\rm{(Sf,n)}},l}} = {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(sp, n)}}}}{K_{{\rm{r(}}t{\rm{)}}}}^{{\rm{(sp, Sf, n)}},l} + {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(n)}}}}{K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun, Sf, n)}},l}\\ + {I^{({\bf{Sky}})}}(t){\rho ^{{\rm{(n)}}}}{K^{{\rm{(Sky, Sf, n)}},l}}\end{array}$$</div>

<div>$${K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(D, Gnd)}},l} = {A^{{\rm{(f)}}}}\sum\limits_{i{\rm{ }}up} {{\mathop{\rm A}\nolimits}_i^{F,l}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}U_{i{\rm{ }}Sun(tsh)}^{{\rm{(D, Gnd)}}}} $$</div>

<div>$${K^{{\rm{(Sky, Gnd)}},l}} = {A^{{\rm{(f)}}}}\sum\limits_{i{\rm{ }}up} {{\mathop{\rm A}\nolimits}_i^{F,l}{\Lambda_{ii}}V_i^{{\rm{(Gnd)}}}U_i^{{\rm{(Sky, Gnd)}}}} $$</div>

<div>$${Q^{{\rm{(Gnd)}},l}} = {I^{{\rm{(D)}}}}(t){\rho ^{{\rm{(Gnd)}}}}{K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(D, Gnd)}},l} + {I^{({\bf{Sky}})}}(t){\rho ^{{\rm{(Gnd)}}}}{K^{{\rm{(Sky, Gnd)}},l}}$$</div>

<div>$${K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}},l} = {A^{{\rm{(f)}}}}{\mathop{\rm A}\nolimits}_{{\rm{s}}(t)}^{F,l}\cos {\theta_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}}}V_{i{\rm{ s(}}t{\rm{)}}}^{{\rm{(D)}}}$$</div>

<div>$${Q^{{\rm{(Sun)}},l}} = {I^{{\rm{(D)}}}}(t){K_{{\rm{s(}}t{\rm{)}}}}^{{\rm{(Sun)}},l}$$</div>

###### Comment on Bases

Use of the basis in the above discussion has been mostly implicit, but it should nevertheless be clear that the essential feature of the basis is that it is a two-element list (i.e., a 2 X N array): it associates with an incident (i) or outgoing (j) direction index a vector pi (or pj ) that is a unit vector giving the direction of the radiation, the specification of which is two angles in some coordinate system.  The incident and outgoing bases of course must match the matrix elements of the fenestration properties.  These bases will (certainly in the case of WINDOW program; probably in the case of other input sources) have a structure: ordering of the elements, etc.  However, after the initialization of the hourly loop calculation, this structure will be irrelevant:  EnergyPlus will retain only those incoming and outgoing directions that are essential to the calculation with (one would hope, most of) the others combined into irradiation factors.  At this point, the basis will truly be an arbitrary list.  It follows that the specification of the basis in the EnergyPlus input should be determined by (1) the source of fenestration property data, and (2) user convenience.

A related point concerns the specification of a basis for specular glazings, i.e., multiple layers of glass.  These fenestrations are both specular (input direction=output direction) and axially symmetric.  These properties have different effects on the calculation.

The specular property means that one should not be using equation at all to describe the transmittance.  Instead, one should use the equation

<div>$$S({{\bf{p}}^{{\rm{(T)}}}}) = \tau ({{\bf{p}}^{{\rm{(T)}}}}) \cdot E({{\bf{p}}^{{\rm{(T)}}}})$$</div>

This equation is shoehorned into the integral calculation  of  equation through the use of a delta function in the incident direction vector, resulting (after the discretization) in a diagonal matrix for the transmittance (or reflectance).  The outgoing radiance element on the diagonal would be calculated as *T<sub>ii</sub>*L*<sub>ii</sub>*, where multiplication by L*<sub>ii</sub>* substitutes for integration over the basis solid angle element.  For a specular glazing, <span>$T_{ii} = \tau(\bf{p}_i^{(T)})/\Lambda_{ii} $</span>, so one recovers the correct transmittance when one does the multiplication.  However, there is still a problem in principle:  For a specular fenestration, the angular spread of the outgoing radiation will be that of the source, which for direct sunlight is very small; the calculation, however, assumes the angular spread of the basis element.  This problem disappears in the geometric approximation to be used in EnergyPlus: by considering only the central direction of each basis element, the outgoing radiation in that direction is essentially assumed to be specular, so the blurring in the discretization is undone.

The axial symmetry of conventional glazings means that the transmittance (or reflectance) depends on only the incident angle, not the azimuthal angle about the normal to the fenestration plane.  So if one specifies the diagonal elements of the matrix, all of the terms with the same incident angles but different azimuthal angles will be the same.  One could alternatively specify only the specular transmittance at each of the incident angle values, provided one also indicated that it was for an axially symmetric fenestration.  Since expanding this set of values to the equivalent diagonal elements is a trivial calculation, how one specifies a specular glazing is completely a question of user convenience.  For example, if one were dealing with the WINDOW full basis, would it be more user-friendly to specify

(1) <span>$T_{ii} = \tau(\bf{p}_i^{(T)})/\Lambda_{ii}$</span>, for 145 values, 135 of which are repeats of the previous value

(2) <span>$\tau ({\theta_i})$</span> for 9 values of incident angle, *q<sub>i</sub>* ?

###### Interior Solar Radiation Transmitted by Complex Fenestration

Diffuse Solar Radiation Transmitted by Complex Fenestration

Distribution of solar radiation transmitted through exterior window is divided on diffuse and direct part.

Diffuse solar transmitted through exterior complex fenestration and absorbed in interor walls is calculated and treated in same way as described in the section on Initial Distribution of Diffuse Solar Transmitted through Exterior and Interior Windows. Even though that BSDF is given for various directions, for purpose of diffuse solar radiation, transmittance and reflectances of fenestration system is integrated over incoming and outgoing hemisphere.  Because incoming diffuse solar radiation is divided on ground and sky parts, integration of incoming hemisphere is also perfomed over ground and sky part (see equation .

Direct Solar Radiation Transmitted by Complex Fenestration

Direct solar (beam) transmitted through exterior window is using same overlap calculations (see Figure 49) for each outgoing basis direction.  For certain sun position, algorithm calculatates equivalent incoming beam number.  The inside beam solar irradiance is calculated in similar manner as described in the section titled Interior Beam Radiation.

<div>$$
  AISurf\left(SurfNum\right) = 
    \frac{AbsIntSurf\left(SurfNum\right)}
         {A\left(SurfNum\right)} \cdot
    \sum_{i=1}^{N_{extwin}} \left( 
       \sum_{j=1}^{N_{out}} 
          TB{m_{k,j}} \cdot \Lambda_{k,j} \cdot \text{Aoverlap}_{k,j} \left( SurfNum \right)
       \right) \cdot \text{CosInc}_i
$$</div>

*i* = exterior window number

*N<sub>extwin</sub>=* number of exterior windows in zone

*N<sub>out</sub>=* Beam number of exterior windows in zone

*CosInc<sub>i</sub>* = cosine of angle of incidence of beam on exterior window *i*

*TBm<sub>k,j</sub>* = beam-to-beam transmittance of exterior window* i*at incidence direction k outgoing direction j

*Λ<sub>k,j</sub>* = lambda value of exterior window* i*at incidence direction k for outgoing direction j

*Aoverlap<sub>k,j</sub>(SurfNum)* = beam solar irradiated area of surface *SurfNum* projected back onto the plane of exterior window* i* for incoming direction k and outgoing direction j (the *Aoverlap*’s for an exterior window sum up to the glazed area of the window)

*AbsIntSurf(SurfNum)*= inside face solar absorptance of surface *SurfNum*

*A(SurfNum)* = area of surface *SurfNum* [m<sup>2</sup>]

Equation is valid as long as surface which is hit by transmitted solar radiation is not another complex fenestration.  In that case, for beam which is transmitted from other exterior window and reaches back surface of this window, angle of incidence needs to be taken into account.

###### Interior Solar Absorbed by Complex Fenestration

Solar radiation absorbed in window layers is coming from three sources: Diffuse radiation from sky and ground, direct radiation from the sun and beam radiation coming from the sun and it is transmitted through other exterior windows.

Diffuse Radiation from Sky and Ground

Energy absorbed in the layers and which originates from diffuse radiation from sky and ground is represented by following equation:

<div>$$
  \text{QRadSWwinAbs}(Surf, Lay) = 
  \sum_{i=1}^{N_{layers}} \left(
    \text{WinSkyFtAbs}(Surf, Lay) \cdot \text{SkySolarInc} + \text{WinSkyGndAbs}(Surf, Lay) \cdot \text{GndSolarInc}
  \right)
$$</div>
  
where,

*WinSkyFtAbs(Lay)* = front absorptance averaged over sky for layer (Lay) and window belonging to Surf

*WinSkyGndAbs(Lay)* = front absorptance averaged over ground for layer (Lay) and window belonging to Surf

*SkySolarInc =* incident diffuse solar from the sky

*GndSolarInc* = incident diffuse solar from the ground

Direct Radiation from the Sun

Energy absorbed in the layers and which originates from direct solar radiation is given by following equation:

<div>$$
  \text{QRadSWwinAbs}(SurfNum, Lay) = \text{AWinSurf}(SurfNum, Lay) \cdot \text{BeamSolar}
$$</div>

where,

*AWinSurf(SurfNum,Lay)* – is time step value of factor for beam absorbed in fenestration glass layers

*BeamSolar* – Current beam normal solar irradiance

Factor for time step value is given by equation:

<div>$$
  \text{AWinSurf}(SurfNum,Lay) = \text{WinBmFtAbs}(Lay,HourOfDay,TimeStep) \cdot \text{CosInc} \cdot \text{SunLitFract} \cdot \text{OutProjSLFracMult}(HourOfDay)
$$</div>

where,

*WinBmFtAbs(Lay,HourOfDay,TimeStep)* – is front directional absorptance for given layer and time

*CosInc* – cosine of beam solar incident angle

*SunLitFract* – sunlit fraction without shadowing effects of frame and divider

*OutProjSLFracMult(HourOfDay)* - Multiplier on sunlit fraction due to shadowing of glass by frame and divider outside projections.

Direct Solar Radiation Coming from Sun and it is Transmitted Through Other Windows

Direct solar radiation transmitted through other windows is using solar overlap calculations described in the section on Overlapping Shadows. Overlapping is used to determine amount of energy transferred through the window is hitting certain surface.  That is used to calculate energy absorbed in walls and same approach will be used to calculate energy absorbed in window layers (equation ).  In case when receiving surface is complex fenestration, it is not enought just to apply equation because factor AbsIntSurf is now depending of incoming angle which is defined through front and back directional absorptance matrices.  It would mean that for each outgoing directions of transmitting complex fenestration, algorithm would need to determine what is best matching basis direction of receiving surface.  Best receiving direction is used to determine absorptance factors which will be used in equation .  It is important to understand that for basis definition, each unit vector defining one beam is going towards surface, which would mean that best matching directions from surface to surface will actually have minimal dot product.

<div>$$Bes{t_{in}} = {\rm{min}}\left( {dot\left( {ou{t_p},i{n_1}} \right),dot\left( {ou{t_p},i{n_2}} \right), \ldots ,dot\left( {ou{t_p},i{n_N}} \right)} \right)$$</div>

where,

Best<sub>in</sub> – is best matching receiving direction basis dot product (in<sub>k</sub>)

out<sub>p</sub> – current transmitting complex fenestration direction

in<sub>1</sub>, ..., in<sub>N</sub> – set of receiving complex fenestration basis directions

Result of equation is minimal dot product, which corresponds to best matching direction of receiving surface.  If we mark that direction with index k, then equation becomes:

<div>$$
  \begin{array}{l}
    AWinSurf(SurfNum,Lay) = \\
      \frac{1}{A(SurfNum)} \cdot \\
      \sum_{i = 1}^{N_{extwin}} (\sum\limits_{j = 1}^{N_{out}} AbsIntSur{f_k}(SurfNum) \cdot TB{m_{k,j}} \cdot \\
      A_{k,j} \cdot \text{Aoverlap}_{k,j}(SurfNum)) \cdot \text{CosInc}_i
  \end{array}
$$</div>



where,

*AbsIntSurf<sub>k</sub>(SurfNum)* – directional absorptance for the receiving surface for the best matching direction

Everything else is same as described in equation .

#### References

Klems, J. H. 1994A. "A New Method for Predicting the Solar Heat Gain of Complex Fenestration Systems: I. Overview and Derivation of the Matrix Layer Calculation.". ASHRAE Transactions. 100(pt.1): 1073-1086.

Klems, J. H. 1994B. "A New Method for Predicting the Solar Heat Gain of Complex Fenestration Systems: II. Detailed Description of the Matrix Layer Calculation.". ASHRAE Transactions. 100(pt.1): 1073-1086.

Klems, J. H. 1995. "Measurements of Bidirectional Optical Properties of Complex Shading Devices.". ASHRAE Transactions. 101(pt 1; Symposium Paper CH-95-8-1(RP-548)): 791-801.

Klems, J. H. 1996. "A Comparison between Calculated and Measured SHGC for Complex Glazing Systems.". ASHRAE Transactions. 102(Pt. 1; Symposium Paper AT-96-16-1): 931-939.

Klems, J. H. 1996. "Calorimetric Measurements of Inward-Flowing Fraction for Complex Glazing and Shading Systems.". ASHRAE Transactions. 102(Pt. 1; Symposium Paper AT-96-16-3): 947-954.

Papamichael, K. J. 1998. "Determination and Application of Bidirectional Solar-Optical Properties of Fenestration Systems.". Cambridge, MA: 13th National Passive Solar Conference.

Window Heat Balance Calculation
-------------------------------

Table 36.  Fortran Variables used in Window Heat Balance Calculations

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
<th>Units</th>
<th>FORTRAN variable</th>
</tr>
<tr>
<td>N</td>
<td>Number of glass layers</td>
<td>-</td>
<td>nlayer</td>
</tr>
<tr>
<td>σ</td>
<td>Stefan-Boltzmann constant</td>
<td> </td>
<td>sigma</td>
</tr>
<tr>
<td>ε<sub>i</sub></td>
<td>Emissivity of face i</td>
<td>-</td>
<td>emis</td>
</tr>
<tr>
<td>k<sub>i</sub></td>
<td>Conductance of glass layer i</td>
<td>W/m<sup>2</sup>-K</td>
<td>scon</td>
</tr>
<tr>
<td>h<sub>o</sub>, h<sub>i</sub></td>
<td>Outside, inside air film convective conductance</td>
<td>W/m<sup>2</sup>-K</td>
<td>hcout, hcout</td>
</tr>
<tr>
<td>h<sub>j</sub></td>
<td>Conductance of gap j</td>
<td>W/m<sup>2</sup>-K</td>
<td>hgap</td>
</tr>
<tr>
<td>T<sub>o</sub>, T<sub>i</sub></td>
<td>Outdoor and indoor air temperatures</td>
<td>K</td>
<td>tout, tin</td>
</tr>
<tr>
<td>E<sub>o</sub>, E<sub>i</sub></td>
<td>Exterior, interior long-wave radiation incident on window</td>
<td>W/m<sup>2</sup></td>
<td>outir, rmir</td>
</tr>
<tr>
<td>θ<sub>i</sub></td>
<td>Temperature of face i</td>
<td>K</td>
<td>thetas</td>
</tr>
<tr>
<td>S<sub>i</sub></td>
<td>Radiation (short-wave, and long-wave from zone internal sources) absorbed by face i</td>
<td>W/m<sup>2</sup></td>
<td>AbsRadGlassFace</td>
</tr>
<tr>
<td>I<sup>ext</sup><sub>bm</sub></td>
<td>Exterior beam normal solar irradiance</td>
<td>W/m<sup>2</sup></td>
<td>BeamSolarRad</td>
</tr>
<tr>
<td>I<sup>ext</sup><sub>dif</sub></td>
<td>Exterior diffuse solar irradiance on glazing</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>I<sup>int</sup><sub>sw</sub></td>
<td>Interior short-wave radiation (from lights and from reflected diffuse solar) incident on glazing from inside</td>
<td>W/m<sup>2</sup></td>
<td>QS</td>
</tr>
<tr>
<td>I<sup>int</sup><sub>lw</sub></td>
<td>Long-wave radiation from lights and equipment incident on glazing from inside</td>
<td>W/m<sup>2</sup></td>
<td>QL</td>
</tr>
<tr>
<td>φ</td>
<td>Angle of incidence</td>
<td>radians</td>
<td>-</td>
</tr>
<tr>
<td>A<sup>f</sup><sub>j</sub></td>
<td>Front beam solar absorptance of glass layer j</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>A<sub>j</sub><sup>f,dif</sup>, A<sub>j</sub><sup>b,dif</sup></td>
<td>Front and back diffuse solar absorptance of glass layer j</td>
<td>-</td>
<td>AbsDiff, AbsDiffBack</td>
</tr>
<tr>
<td>A, B</td>
<td>Matrices used to solve glazing heat balance equations</td>
<td>W/m<sup>2</sup>, W/m<sup>2</sup>-K</td>
<td>Aface, Bface</td>
</tr>
<tr>
<td>h<sub>r,i</sub></td>
<td>Radiative conductance for face i</td>
<td>W/m<sup>2</sup>-K</td>
<td>hr(i)</td>
</tr>
<tr>
<td>Δθ<sub>i</sub></td>
<td>Difference in temperature of face i between successive iterations</td>
<td>K</td>
<td>-</td>
</tr>

</table>



### The Glazing Heat Balance Equations

The window glass face temperatures are determined by solving the heat balance equations on each face every time step. For a window with *N* glass layers there are 2*N* faces and therefore 2*N* equations to solve. Figure 95 shows the variables used for double glazing (*N*=2).

![](EngineeringReference/media/image1470.png)

Figure 95.  Glazing system with two glass layers showing variables used in heat balance equations.

The following assumptions are made in deriving the heat balance equations:

1)    The glass layers are thin enough (a few millimeters) that heat storage in the glass can be neglected; therefore, there are no heat capacity terms in the equations.

2)    The heat flow is perpendicular to the glass faces and is one dimensional. See “Edge of Glass Corrections,” below, for adjustments to the gap conduction in multi-pane glazing to account for 2-D conduction effects across the pane separators at the boundaries of the glazing.

3)    The glass layers are opaque to IR. This is true for most glass products. For thin plastic suspended films this is not a good assumption, so the heat balance equations would have to be modified to handle this case.

4)    The glass faces are isothermal. This is generally a good assumption since glass conductivity is very high.

5)    The short wave radiation absorbed in a glass layer can be apportioned equally to the two faces of the layer.

The four equations for double-glazing are as follows. The equations for single glazing (*N*=1) and for *N*=3 and *N*=4 are analogous and are not shown.

<div>$${E_o}{\varepsilon_1} - {\varepsilon_1}\sigma \theta_1^4 + {k_1}\left( {{\theta_2} - {\theta_1}} \right) + {h_o}\left( {{T_o} - {\theta_1}} \right) + {S_1} = 0$$</div>

<div>$${k_1}\left( {{\theta_1} - {\theta_2}} \right) + {h_1}\left( {{\theta_3} - {\theta_2}} \right) + \sigma \frac{{{\varepsilon_2}{\varepsilon_3}}}{{1 - \left( {1 - {\varepsilon_2}} \right)\left( {1 - {\varepsilon_3}} \right)}}\left( {\theta_3^4 - \theta_2^4} \right) + {S_2} = 0$$</div>

<div>$${h_1}({\theta_2} - {\theta_3}) + {k_2}({\theta_4} - {\theta_3}) + \sigma \frac{{{\varepsilon_2}{\varepsilon_3}}}{{1 - \left( {1 - {\varepsilon_2}} \right)\left( {1 - {\varepsilon_3}} \right)}}\left( {\theta_2^4 - \theta_3^4} \right) + {S_3} = 0$$</div>

<div>$${E_i}{\varepsilon_4} - {\varepsilon_4}\sigma \theta_4^4 + {k_2}\left( {{\theta_3} - {\theta_4}} \right) + {h_i}\left( {{T_i} - {\theta_4}} \right) + {S_4} = 0$$</div>

#### Absorbed Radiation

*S<sub>i</sub>* in Equations to is the radiation (short-wave and long-wave from zone lights and equipment) absorbed on the *i*<sup>th</sup> face. Short-wave radiation (solar and short-wave from lights) is assumed to be absorbed uniformly along a glass layer, so for the purposes of the heat balance calculation it is split equally between the two faces of a layer. Glass layers are assumed to be opaque to IR so that the thermal radiation from lights and equipment is assigned only to the inside (room-side) face of the inside glass layer. For *N* glass layers *S<sub>i</sub>* is given by

<div>$${S_{2j - 1}} = {S_{2j}} = \frac{1}{2}\left( {I_{bm}^{ext}\cos \phi A_j^f(\phi ) + I_{dif}^{ext}A_j^{f,dif} + I_{sw}^{{\mathop{\rm int}} }A_j^{b,dif}} \right),{\rm{     }}j = 1{\rm{ to }}N$$</div>

<div>$${S_{2N}} = {S_{2N}} + {\varepsilon_{2N}}I_{lw}^{{\mathop{\rm int}} }$$</div>

Here

<span>$I_{bm}^{ext}$</span>= exterior beam normal solar irradiance

<span>$I_{dif}^{ext}$</span>= exterior diffuse solar incident on glazing from outside

<span>$I_{sw}^{{\mathop{\rm int}} }$</span>= interior short-wave radiation (from lights and from reflected diffuse solar) incident on glazing from inside

<span>$I_{lw}^{{\mathop{\rm int}} }$</span>= long-wave radiation from lights and equipment incident on glazing from inside

<span>${\varepsilon_{2N}}$</span>= emissivity (thermal absorptance) of the room-side face of the inside glass layer

### Room-Side Convection

The correlation for room-side convection coefficient, <span>${h_i}$</span>, is from ISO 15099 section 8.3.2.2.  (Prior to EnergyPlus version 3.1, the value for <span>${h_i}$</span> was modeled using the “Detailed” algorithm for opaque surface heat transfer, e.g. for a vertical surface <span>${h_i} = 1.31{\left| {\Delta T} \right|^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}}$</span>; see section Detailed Natural Convection Algorithm).  The ISO 15099 correlation is for still room air and is determined in terms of the Nusselt number, <span>$Nu$</span>, where

<div>$${h_i} = Nu\left( {\frac{\lambda }{H}} \right)$$</div>

where,

<span>$\lambda $</span> is the thermal conductivity of air, and

<span>$H$</span> is the height of the window.

The Rayleigh number based on height, <span>$R{a_H}$</span>, is calculated using,

<div>$$R{a_H} = \frac{{{\rho ^2}{H^3}g\,{c_p}\left| {{T_{surf,i}} - {T_{air}}} \right|}}{{{T_{m,f}}\mu \lambda }}$$</div>

where,

<span>$\rho $</span> is the density of air

<span>$g$</span> is the acceleration due to gravity,

<span>${c_p}$</span> is the specific heat of air,

<span>$\mu $</span> is the dynamic viscosity of air, and

<span>${T_{m,f}}$</span> is the mean film temperature in Kelvin given by,

<div>$${T_{m,f}} = {T_{air}} + \frac{1}{4}\left( {{T_{surf,i}} - {T_{air}}} \right)$$</div>

There are four cases for the Nusselt correlation that vary by the tilt angle in degrees, <span>$\gamma $</span>, and are based on heating conditions.  For cooling conditions (where <span>${T_{surf,i}} > {T_{air}}$</span>) the tilt angle is complemented so that <span>$\gamma  = 180 - \gamma $</span>

Case A. <span>${0^\circ } \le \gamma  < 15^\circ $</span>

<div>$$Nu = 0.13Ra_H^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}$$</div>

Case B. <span>$15^\circ  \le \gamma  \le 90^\circ $</span>

<div>$$R{a_{cv}} = 2.5 \times {10^5}{\left( {\frac{{{e^{0.72\gamma }}}}{{\sin \lambda }}} \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}}}$$</div>

<div>$$Nu = 0.56{\left( {R{a_H}\sin \gamma } \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}};\;for\;R{a_H} \le R{a_{CV}}$$</div>

<div>$$Nu = 0.13\left( {Ra_H^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}} - Ra_{CV}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}} \right) + 0.56{\left( {R{a_{CV}}\sin \gamma } \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}};\;R{a_H} > R{a_{CV}}$$</div>

Case C. <span>$90^\circ  < \gamma  \le 179^\circ $</span>

<div>$$Nu = 0.56{\left( {R{a_H}\sin \gamma } \right)^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 4}}\right.}\!\lower0.7ex\hbox{$4$}}}};\;{10^5} \le R{a_H}\sin \gamma  < {10^{11}}$$</div>

Case D. <span>$179^\circ  < \gamma  \le 180^\circ $</span>

<div>$$Nu = 0.58Ra_H^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 5}}\right.}\!\lower0.7ex\hbox{$5$}}};\;R{a_H} \le {10^{11}}$$</div>

The material properties are evaluated at the mean film temperature.  Standard EnergyPlus pyschrometric functions are used for <span>$\rho $</span> and <span>${c_p}$</span>.  Thermal conductivity is calculated using,

<span>$\lambda  = 2.873 \times {10^{ - 3}} + 7.76 \times {10^{ - 5}}{T_{m,f}}$</span>.

Kinematic viscosity is calculated using,

<span>$\mu  = 3.723 \times {10^{ - 6}} + 4.94 \times {10^{ - 8}}{T_{m,f}}$</span>.

This correlation depends on the surface temperature of the room-side glazing surface and is therefore included inside the window heat balance interation loop.



### Solving the Glazing Heat Balance Equations

The equations are solved as follows:

1)    Linearize the equations by defining <span>${h_{r,i}} = {\varepsilon_i}\sigma \theta_i^3$</span>.  For example, Equation becomes

<div>$${E_o}{\varepsilon_1} - {h_{r,1}}{\theta_1} + {k_1}\left( {{\theta_2} - {\theta_1}} \right) + {h_o}\left( {{T_o} - {\theta_1}} \right) + {S_1} = 0$$</div>

2)    Write the equations in the matrix form <span>$A\theta  = B$</span>

3)    Use previous time step’s values of <span>${\theta_i}$</span>as initial values for the current time step. For the first time step of a design day or run period the initial values are estimated by treating the layers as a simple RC network.

4)    Save the <span>${\theta_i}$</span> for use in the next iteration: <span>${\theta_{prev,i}} = {\theta_i}$</span>

5)    Using <span>${\theta_{2N}}$</span>, reevaluate the room-side face surface convection coefficient <span>${h_i}$</span>

6)    Using the <span>${\theta_i}$</span> to evaluate the radiative conductances <span>${h_{r,i}}$</span>

7)    Find the solution <span>$\theta  = {A^{ - 1}}B$</span>by LU decomposition

8)    Perform relaxation on the the new <span>${\theta_i}$</span>**:** <span>${\theta_i} \to \left( {{\theta_i} + {\theta_{prev,i}}} \right)/2$</span>

9)    Go to step 4

Repeat steps 4 to 9 until the difference, <span>$\Delta {\theta_i}$</span>, between values of the <span>${\theta_i}$</span> in successive iterations is less than some tolerance value. Currently, the test is

<div>$$\frac{1}{{2N}}\sum\limits_{i = 1}^{2N} {|\Delta {\theta_i}|{\rm{ }} < 0.02K} $$</div>

If this test does not pass after 100 iterations, the tolerance is increased to 0.2K. If the test still fails the program stops and an error message is issued.

The value of the inside face temperature, <span>${\theta_{2N}}$</span>, determined in this way participates in the zone heat balance solution (see Outdoor/Exterior Convection) and thermal comfort calculation (see Occupant Thermal Comfort).

### Edge-Of-Glass Effects

Table 37.  Fortran Variables used in Edge of Glass calculations

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
<th>Units</th>
<th>FORTRAN variable</th>
</tr>
<tr>
<td><span>$\bar h$</span></td>
<td>Area-weighted net conductance of glazing including edge-of-glass effects</td>
<td>W/m<sup>2</sup>-K</td>
<td>-</td>
</tr>
<tr>
<td>A<sub>cg</sub></td>
<td>Area of center-of-glass region</td>
<td>m<sup>2</sup></td>
<td>CenterGlArea</td>
</tr>
<tr>
<td>A<sub>fe</sub></td>
<td>Area of frame edge region</td>
<td>m<sup>2</sup></td>
<td>FrameEdgeArea</td>
</tr>
<tr>
<td>A<sub>de</sub></td>
<td>Area of divider edge region</td>
<td>m<sup>2</sup></td>
<td>DividerEdgeArea</td>
</tr>
<tr>
<td>A<sub>tot</sub></td>
<td>Total glazing area</td>
<td>m<sup>2</sup></td>
<td>Surface%Area</td>
</tr>
<tr>
<td>h<sub>cg</sub></td>
<td>Conductance of center-of-glass region (without air films)</td>
<td>W/m<sup>2</sup>-K</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>fe</sub></td>
<td>Conductance of frame edge region (without air films)</td>
<td>W/m<sup>2</sup>-K</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>de</sub></td>
<td>Conductance of divider edge region (without air films)</td>
<td>W/m<sup>2</sup>-K</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>ck</sub></td>
<td>Convective conductance of gap k</td>
<td>W/m<sup>2</sup>-K</td>
<td>-</td>
</tr>
<tr>
<td>h<sub>rk</sub></td>
<td>Radiative conductance of gap k</td>
<td>W/m<sup>2</sup>-K</td>
<td>-</td>
</tr>
<tr>
<td>η</td>
<td>Area ratio</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>α</td>
<td>Conductance ratio</td>
<td>-</td>
<td>FrEdgeToCenterGlCondRatio, DivEdgeToCenterGlCondRatio</td>
</tr>

</table>

Because of thermal bridging across the spacer separating the glass layers in multi-pane glazing, the conductance of the glazing near the frame and divider, where the spacers are located, is higher than it is in the center of the glass. The area-weighted net conductance (without inside and outside air films) of the glazing in this case can be written

<div>$$\overline h  = \left( {{A_{cg}}{h_{cg}} + {A_{fe}}{h_{fe}} + {A_{de}}{h_{de}}} \right)/{A_{tot}}$$</div>

where

*h<sub>cg</sub>* = conductance of center-of-glass region (without air films)

*h<sub>fe</sub>* = conductance of frame edge region (without air films)

*h<sub>de</sub>* = conductance of divider edge region (without air films)

*A<sub>cg</sub>*= area of center-of-glass region

*A<sub>fe</sub>*= area of frame edge region

*A<sub>de</sub>*= area of divider edge region

*A<sub>tot</sub>*= total glazing area = <span>${A_{cg}} + {A_{fe}} + {A_{de}}$</span>

The different regions are shown in Figure 96:

![](EngineeringReference/media/image1534.png)

Figure 96:  Different types of glass regions.

Equation can be rewritten as

<div>$$\overline h  = {h_{cg}}\left( {{\eta_{cg}} + {\alpha_{fe}}{\eta_{fe}} + {\alpha_{de}}{\eta_{de}}} \right)$$</div>

where

<div>$${\eta_{cg}} = {A_{cg}}/{A_{tot}}$$</div>

<div>$${\eta_{fe}} = {A_{fe}}/{A_{tot}}$$</div>

<div>$${\eta_{de}} = {A_{de}}/{A_{tot}}$$</div>

<div>$${\alpha_{fe}} = {h_{fe}}/{h_{cg}}$$</div>

<div>$${\alpha_{de}} = {h_{de}}/{h_{cg}}$$</div>

The conductance ratios <span>${\alpha_{fe}}$</span> and <span>${\alpha_{de}}$</span>are user inputs obtained from Window 5. They depend on the glazing construction as well as the spacer type, gap width, and frame and divider type.

In the EnergyPlus glazing heat balance calculation effective gap convective conductances are used to account for the edge-of-glass effects. These effective conductances are determined as follows for the case with two gaps (triple glazing). The approach for other numbers of gaps is analogous.

Neglecting the very small resistance of the glass layers, the center-of-glass conductance (without inside and outside air films) can be written as

<div>$${h_{cg}} = {\left( {{{\left( {{h_{r,1}} + {h_{c,1}}} \right)}^{ - 1}} + {{\left( {{h_{r,2}} + {h_{c,2}}} \right)}^{ - 1}}} \right)^{ - 1}}$$</div>

where

<span>${h_{c,k}} = $</span>convective conductance of the *k<sup>th</sup>* gap

<span>${h_{r,k}} = $</span>radiative conductance of the *k<sup>th</sup>* gap

<div>$$ = \frac{1}{2}\sigma \frac{{{\varepsilon_i}{\varepsilon_j}}}{{1 - \left( {1 - {\varepsilon_i}} \right)\left( {1 - {\varepsilon_j}} \right)}}{\left( {{\theta_i} + {\theta_j}} \right)^3}$$</div>

<span>${\varepsilon_i},{\varepsilon_j} = $</span>emissivity of the faces bounding the gap

<span>${\theta_i},{\theta_j} = $</span>temperature of faces bounding the gap (K)

Equation then becomes

<div>$$\overline h  = \left( {{\eta_{cg}} + {\alpha_{fe}}{\eta_{fe}} + {\alpha_{de}}{\eta_{de}}} \right){\left( {{{\left( {{h_{r,1}} + {h_{c,1}}} \right)}^{ - 1}} + {{\left( {{h_{r,2}} + {h_{c,2}}} \right)}^{ - 1}}} \right)^{ - 1}}$$</div>

We can also write <span>$\overline h $</span>in terms of effective convective conductances of the gaps as

<div>$$\overline h  = {\left( {{{\left( {{h_{r,1}} + {{\overline h }_{c,1}}} \right)}^{ - 1}} + {{\left( {{h_{r,2}} + {{\overline h }_{c,2}}} \right)}^{ - 1}}} \right)^{ - 1}}$$</div>

Comparing Eqs. and we obtain

<div>$${h_{r,k}} + {\overline h_{c,k}} = \left( {{\eta_{cg}} + {\alpha_{fe}}{\eta_{fe}} + {\alpha_{de}}{\eta_{de}}} \right)\left( {{h_{r,k}} + {h_{c,k}}} \right)$$</div>

Using <span>${\eta_{cg}} = 1 - {\eta_{fe}} - {\eta_{de}}$</span> gives

<div>$${\overline h_{c,k}} = {h_{r,k}}\left( {{\eta_{fe}}\left( {{\alpha_{fe}} - 1} \right) + {\eta_{de}}\left( {{\alpha_{de}} - 1} \right)} \right) + {h_{c,k}}\left( {1 + {\eta_{fe}}\left( {{\alpha_{fe}} - 1} \right) + {\eta_{de}}\left( {{\alpha_{de}} - 1} \right)} \right)$$</div>

This is the expression used by EnergyPlus for the gap convective conductance when a frame or divider is present.

### Apportioning of Absorbed Short-Wave Radiation in Shading Device Layers

If a shading device has a non-zero short-wave transmittance then absorption takes place throughout the shading device layer. The following algorithm is used to apportion the absorbed short-wave radiation to the two faces of the layer. Here *f<sub>1</sub>* is the fraction assigned to the face closest to the incident radiation and *f<sub>2</sub>* is the fraction assigned to the face furthest from the incident radiation.

 <span>${f_1} = 1,{\rm{ }}{f_2} = 0{\rm{   if }}{\tau_{sh}} = 0$</span>

Otherwise

<div>$$
  \begin{array}{cl}
    f_1 = 0,\;f_2 = 0 &\text{if} \alpha_{sh} \le 0.01 \\
    f_1 = 1,\;f_2 = 0 &\text{if} \alpha_{sh} \gt 0.999 \\
    \left.
      \begin{array}{l}
        f_1 = \frac{1 - e^{0.5 \ln (1 - \alpha_{sh}}} {\alpha_{sh}} \\
        f_2 = 1 - {f_1}
      \end{array}
    \right\} &\text{if} 0.01 lt \alpha_{sh} \le 0.999
  \end{array}
$$</div>

### Window  Frame and Divider Calculation

For the zone heat balance calculation the inside surface temperature of the frame and that of the divider are needed. These temperatures are determined by solving the heat balance equations on the inside and outside surfaces of the frame and divider.

Table 38.  Fortran Variables used in Window/Frame and Divider calculations

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
<th>Units</th>
<th>FORTRAN variable</th>
</tr>
<tr>
<td>Q<sub>ExtIR,abs</sub></td>
<td>IR from the exterior surround absorbed by outside frame surfaces</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>Q<sub>IR,emitted</sub></td>
<td>IR emitted by outside frame surfaces</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>Q<sub>conv</sub></td>
<td>Convection from outside air to outside frame surfaces</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>Q<sub>cond</sub></td>
<td>Conduction through frame from inside frame surfaces to outside frame surfaces</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>Q<sub>abs</sub></td>
<td>Solar radiation plus outside glass IR absorbed by outside of frame</td>
<td>W</td>
<td>-</td>
</tr>
<tr>
<td>Q<sup>dif</sup><sub>abs,sol</sub></td>
<td>Diffuse solar absorbed by outside frame surfaces, per unit frame face area</td>
<td>W/ m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>Q<sup>bm</sup><sub>abs,sol</sub></td>
<td>Beam solar absorbed by outside frame surfaces, per unit frame face area</td>
<td>W/ m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>I<sup>dif</sup><sub>ext</sub></td>
<td>Diffuse solar incident on window</td>
<td>W/ m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>I<sup>bm</sup><sub>ext</sub></td>
<td>Direct normal solar irradiance</td>
<td>W/ m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>α<sup>fr</sup><sub>sol</sub></td>
<td>Solar absorptance of frame</td>
<td>-</td>
<td>FrameSolAbsorp</td>
</tr>
<tr>
<td>R<sub>gl</sub><sup>f,dif</sup></td>
<td>Front diffuse solar reflectance of glazing</td>
<td>-</td>
<td> </td>
</tr>
<tr>
<td>R<sub>gl</sub><sup>f,bm</sup></td>
<td>Front beam solar reflectance of glazing</td>
<td>-</td>
<td> </td>
</tr>
<tr>
<td>cos(β<sub>face</sub>)</td>
<td>Cosine of angle of incidence of beam solar on frame outside face</td>
<td> </td>
<td>CosIncAng</td>
</tr>
<tr>
<td>Cos(β<sub>h</sub>)</td>
<td>Cosine of angle of incidence of beam solar on frame projection parallel to window x-axis</td>
<td>-</td>
<td>CosIncAngHorProj</td>
</tr>
<tr>
<td>Cos(β<sub>v</sub>)</td>
<td>Cosine of angle of incidence of beam solar on frame projection parallel to window y-axis</td>
<td>-</td>
<td>CosIncAngVertProj</td>
</tr>
<tr>
<td>f<sub>sunlit</sub></td>
<td>Fraction of window that is sunlit</td>
<td>-</td>
<td>SunlitFrac</td>
</tr>
<tr>
<td>A<sub>f</sub></td>
<td>Area of frame’s outside face (same as area of frame’s inside face)</td>
<td>m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>A<sub>p1</sub>, A<sub>p2</sub></td>
<td>Area of frame’s outside and inside projection faces</td>
<td>m<sup>2</sup></td>
<td>-</td>
</tr>
<tr>
<td>F<sub>f</sub></td>
<td>Form factor of frame’s outside or inside face for IR</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>F<sub>p1</sub>, F<sub>p2</sub></td>
<td>Form factor of frame outside projection for exterior IR; form factor of frame inside projection for interior IR</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>E<sub>o</sub></td>
<td>Exterior IR incident on window plane</td>
<td>W/m<sup>2</sup></td>
<td>outir</td>
</tr>
<tr>
<td>E<sub>i</sub></td>
<td>Interior IR incident on window plane</td>
<td>W/m<sup>2</sup></td>
<td>SurroundIRfromParentZone</td>
</tr>
<tr>
<td>ε<sub>1</sub>, ε<sub>2</sub></td>
<td>Outside, inside frame surface emissivity</td>
<td>-</td>
<td>FrameEmis</td>
</tr>
<tr>
<td>θ<sub>1</sub>, θ<sub>2</sub></td>
<td>Frame outside, inside surface temperature</td>
<td>K</td>
<td>FrameTempSurfOut, FrameTempSurfIn</td>
</tr>
<tr>
<td>T<sub>o</sub>, T<sub>i</sub></td>
<td>Outdoor and indoor air temperatures</td>
<td>K</td>
<td>tout, tin</td>
</tr>
<tr>
<td>h<sub>o,c</sub>, h<sub>i,c</sub></td>
<td>Frame outside and inside air film convective conductance</td>
<td>W/m2-K</td>
<td>HOutConv, HInConv</td>
</tr>
<tr>
<td>k</td>
<td>Effective inside-surface to outside-surface conductance of frame per unit area of frame projected onto window plane</td>
<td>W/m<sup>2</sup>-K</td>
<td>FrameConductance, FrameCon</td>
</tr>
<tr>
<td>S<sub>1</sub></td>
<td>Q<sub>abs</sub>/A<sub>f</sub></td>
<td>W/m<sup>2</sup>-K</td>
<td>FrameQRadOutAbs</td>
</tr>
<tr>
<td>S<sub>2</sub></td>
<td>Interior short-wave radiation plus interior IR from internal sources absorbed by inside of frame divided by A<sub>f</sub></td>
<td>W/m<sup>2</sup>-K</td>
<td>FrameQRadInAbs</td>
</tr>
<tr>
<td>η<sub>1</sub>, η<sub>2</sub></td>
<td>A<sub>p1</sub>/A<sub>f</sub>, A<sub>p2</sub>/A<sub>f</sub></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>H</td>
<td>Height of glazed portion of window</td>
<td>m</td>
<td>Surface%Height</td>
</tr>
<tr>
<td>W</td>
<td>Width of glazed portion of window</td>
<td>m</td>
<td>Surface%Width</td>
</tr>
<tr>
<td>w<sub>f</sub>, w<sub>d</sub></td>
<td>Frame width, divider width</td>
<td>m</td>
<td>FrameWidth, DividerWidth</td>
</tr>
<tr>
<td>p<sub>f1</sub>, p<sub>f2</sub></td>
<td>Frame outside, inside projection</td>
<td>m</td>
<td>FrameProjectionOut, FrameProjectionIn</td>
</tr>
<tr>
<td>N<sub>h</sub>, N<sub>v</sub></td>
<td>Number of horizontal, vertical dividers</td>
<td>-</td>
<td>HorDividers, VertDividers</td>
</tr>
<tr>
<td>T<sub>o,r</sub>, T<sub>i,r</sub></td>
<td>Frame outside, inside radiative temperature</td>
<td>K</td>
<td>TOutRadFr, TInRadFr</td>
</tr>
<tr>
<td>h<sub>o,r</sub>, h<sub>i,r</sub></td>
<td>Frame outside, inside surface radiative conductance</td>
<td>W/m<sup>2</sup>-K</td>
<td>HOutRad, HInRad</td>
</tr>
<tr>
<td>A</td>
<td>Intermediate variable in frame heat balance solution</td>
<td>K</td>
<td>Afac</td>
</tr>
<tr>
<td>C</td>
<td>Intermediate variable in frame heat balance solution</td>
<td>-</td>
<td>Efac</td>
</tr>
<tr>
<td>B, D</td>
<td>Intermediate variables in frame heat balance solution</td>
<td>-</td>
<td>Bfac, Dfac</td>
</tr>

</table>



#### Frame Temperature Calculation

Figure 97 shows a cross section through a window showing frame and divider. The outside and inside frame and divider surfaces are assumed to be isothermal. The frame and divider profiles are approximated as rectangular since this simplifies calculating heat gains and losses (see “Error Due to Assuming a Rectangular Profile,” below).



![](EngineeringReference/media/image1557.png)

Figure 97.  Cross section through a window showing frame and divider (exaggerated horizontally).

** **

#### Frame Outside Surface Heat Balance

The outside surface heat balance equation is

<div>$${Q_{ExtIR,abs}} - {Q_{IR,emitted}} + {Q_{conv}} + {Q_{cond}} + {Q_{abs}} = 0$$</div>

where

<span>${Q_{ExtIR,abs}}$</span> = IR from the exterior surround (sky and ground) absorbed by outside frame surfaces

<span>${Q_{IR,emitted}}$</span>= IR emitted by outside frame surfaces

<span>${Q_{conv}}$</span>= convection from outside air to outside frame surfaces

<span>${Q_{cond}}$</span>= conduction through frame from inside frame surfaces to outside frame surfaces

<span>${Q_{abs}}$</span>= solar radiation (from sun, sky and ground) plus IR from outside window surface absorbed by outside frame surfaces (see “Calculation of Absorbed Solar Radiation,” below).

The first term can be written as the sum of the exterior IR absorbed by the outside face of the frame and the exterior IR absorbed by the frame’s outside projection surfaces.

<div>$${Q_{ExtIR,abs}} = {\varepsilon_1}{E_o}{A_f}{F_f} + {\varepsilon_1}{E_o}{A_{p1}}{F_{p1}}$$</div>

where *ε<sub>1</sub>* is the outside surface emissivity.

The exterior IR incident on the plane of the window, *E<sub>o</sub>*, is the sum of the IR from the sky, ground and obstructions. For the purposes of the frame heat balance calculation it is assumed to be isotropic. For isotropic incident IR, *F<sub>f</sub>*= 1.0 and *F<sub>p1</sub>* = 0.5, which gives

<div>$${Q_{ExtIR,abs}} = {\varepsilon_1}{E_o}({A_f} + \frac{1}{2}{A_{p1}})$$</div>

The IR emitted by the outside frame surfaces is

<div>$${Q_{ExtIR,emitted}} = {\varepsilon_1}\sigma ({A_f} + {A_{p1}})\theta_1^4$$</div>

The convective heat flow from the outside air to the outside frame surfaces is

<div>$${Q_{conv}} = {h_{o,c}}({A_f} + {A_{p1}})({T_o} - {\theta_1})$$</div>

The conduction through the frame from inside to outside is

<div>$${Q_{cond}} = k{A_f}({\theta_2} - {\theta_1})$$</div>

Note that *A<sub>f</sub>  *is used here since the conductance, *k*, is, by definition, per unit area of frame projected onto the plane of the window.

Adding these expressions for the *Q* terms and dividing by* A<sub>f</sub>* gives

<div>$${E_0}{\varepsilon_1}\left( {1 + \frac{1}{2}{\eta_1}} \right) - {\varepsilon_1}\left( {1 + {\eta_1}} \right)\theta_1^4 + {h_{o,c}}\left( {1 + {\eta_1}} \right)\left( {{T_0} - {\theta_1}} \right) + k\left( {{\theta_2} - {\theta_1}} \right) + {S_1} = 0$$</div>

where *S<sub>1</sub>* = *Q<sub>abs</sub>/A<sub>f</sub>* and

<div>$${\eta_1} = \frac{{{A_{p1}}}}{{{A_f}}} = \left( {\frac{{{p_{f,1}}}}{{{w_f}}}} \right)\frac{{H + W - ({N_h} + {N_v}){w_d}}}{{H + W + 2{w_f}}}$$</div>

We linearize Eq. as follows.

Write the first two terms as

<div>$${\varepsilon_1}(1 + {\eta_1})[{E_o}(1 + \frac{1}{2}{\eta_1})/(1 + {\eta_1}) - \theta_1^4]$$</div>

and define a radiative temperature

<div>$${T_{o,r}} = {[{E_o}(1 + \frac{1}{2}{\eta_1})/(1 + {\eta_1})]^{1/4}}$$</div>

This gives

<div>$${\varepsilon_1}(1 + {\eta_1})[T_{o,r}^4 - \theta_1^4]$$</div>

which, within a few percent, equals

<div>$${\varepsilon_1}(1 + {\eta_1})\frac{{{{({T_{o,r}} + {\theta_1})}^3}}}{2}({T_{o,r}} - {\theta_1})$$</div>

Defining an outside surface radiative conductance as follows

<div>$${h_{o,r}} = {\varepsilon_1}(1 + {\eta_1})\frac{{{{({T_{o,r}} + {\theta_1})}^3}}}{2}$$</div>

then gives

<div>$${h_{o,r}}({T_{o,r}} - {\theta_1})$$</div>

The final outside surface heat balance equation in linearized form is then

<div>$${h_{o,r}}({T_{o,r}} - {\theta_1}) + {h_{o,c}}(1 + {\eta_1})({T_o} - {\theta_1}) + k({\theta_2} - {\theta_1}) + {S_1} = 0$$</div>

#### Frame Inside Surface Heat Balance

A similar approach can be used to obtain the following linearized *inside* surface heat balance equation:

<div>$${h_{i,r}}({T_{i,r}} - {\theta_2}) + {h_{i,c}}(1 + {\eta_2})({T_i} - {\theta_2}) + k({\theta_1} - {\theta_2}) + {S_2} = 0$$</div>

where

<div>$${T_{i,r}} = {[{E_i}(1 + \frac{1}{2}{\eta_2})/(1 + {\eta_2})]^{1/4}}$$</div>

<div>$${\eta_2} = \frac{{{A_{p2}}}}{{{A_f}}} = \left( {\frac{{{p_{f,2}}}}{{{w_f}}}} \right)\frac{{H + W - ({N_h} + {N_v}){w_d}}}{{H + W + 2{w_f}}}$$</div>

and *E<sub>i</sub>* is the interior IR irradiance incident on the plane of the window.

Solving Eqs. and simultaneously gives

<div>$${\theta_2} = \frac{{D + CA}}{{1 - CB}}$$</div>

with

<div>$$A = \frac{{{h_{o,r}}{T_{o,r}} + {h_{o,c}}{T_o} + {S_1}}}{{{h_{o,r}} + k + {h_{o,c}}}}$$</div>

<div>$$B = \frac{k}{{{h_{o,r}} + k + {h_{o,c}}}}$$</div>

<div>$$C = \frac{k}{{{h_{i,r}} + k + {h_{i,c}}}}$$</div>

<div>$$D = \frac{{{h_{i,r}}{T_{i,r}} + {h_{i,c}}{T_i} + {S_2}}}{{{h_{i,r}} + k + {h_{i,c}}}}$$</div>

#### Calculation of Solar Radiation Absorbed by Frame

The frame outside face and outside projections and inside projections absorb beam solar radiation (if sunlight is striking the window) and diffuse solar radiation from the sky and ground. For the outside surfaces of the frame, the absorbed diffuse solar per unit frame face area is

<div>$$Q_{abs,sol}^{dif} = I_{ext}^{dif}{\alpha_{fr,sol}}\left( {{A_f} + {F_{p1}}{A_{p1}}} \right)/{A_f} = I_{ext}^{dif}{\alpha_{fr,sol}}\left( {1 + 0.5\frac{{{A_{p1}}}}{{{A_f}}}} \right)$$</div>

If there is no exterior window shade, * I<sup>dif</sup><sub>ext</sub>* includes the effect of diffuse solar reflecting off of the glazing onto the outside frame projection, i.e.,

<div>$$I_{ext}^{dif} \to I_{ext}^{dif}\left( {1 + R_{gl}^{f,dif}} \right)$$</div>

The beam solar absorbed by the outside face of the frame, per unit frame face area is

<div>$$Q_{abs,sol}^{bm,face} = I_{ext}^{bm}{\alpha_{fr,sol}}\cos {\beta_{face}}{f_{sunlit}}$$</div>

The beam solar absorbed by the frame outside projection parallel to the window x-axis is

<div>$$Q_{abs,sol}^{bm,h} = I_{ext}^{bm}{\alpha_{fr,sol}}\cos {\beta_h}{p_{f1}}\left( {W - {N_v}{w_d}} \right){f_{sunlit}}/{A_f}$$</div>

Here it is assumed that the sunlit fraction, *f<sub>sunlit</sub>*, for the window can be applied to the window frame. Note that at any given time beam solar can strike only one of the two projection surfaces that are parallel to the window x-axis. If there is no exterior window shade, *I<sup>bm</sup><sub>ext</sub>* includes the effect of beam solar reflecting off of the glazing onto the outside frame projection, i.e.,

<div>$$I_{ext}^{bm} \to I_{ext}^{bm}\left( {1 + R_{gl}^{f,bm}} \right)$$</div>

The beam solar absorbed by the frame outside projection parallel to the window y-axis is

<div>$$Q_{abs,sol}^{bm,v} = I_{ext}^{bm}{\alpha_{fr,sol}}\cos {\beta_v}{p_{f1}}\left( {H - {N_h}{w_d}} \right){f_{sunlit}}/{A_f}$$</div>

Using a similar approach, the beam and diffuse solar absorbed by the *inside* frame projections is calculated, taking the transmittance of the glazing into account.

#### Error Due to Assuming a Rectangular Profile

Assuming that the inside and outside frame profile is rectangular introduces an error in the surface heat transfer calculation if the profile is non-rectangular. The percent error in the calculation of convection and emitted IR is approximately 100<span>$\left| {{L_{profile,rect}} - {L_{profile,actual}}} \right|/{L_{profile,rect}}$</span>, where *L<sub>profile,rect</sub>* is the profile length for a rectangular profile (*w<sub>f</sub>* +* p<sub>f1</sub>* for outside of frame or *w<sub>f</sub>* + *p<sub>f2</sub>*for inside of frame) and *L<sub>profile,actual</sub>* is the actual profile length. For example, for a circular profile *vs* a square profile the error is about 22%. The error in the calculation of absorbed beam radiation is close to zero since the beam radiation intercepted by the profile is insensitive to the shape of the profile. The error in the absorbed diffuse radiation and absorbed IR depends on details of the shape of the profile. For example, for a circular profile vs. a square profile the error is about 15%.

#### Divider Temperature Calculation

The divider inside and outside surface temperatures are determined by a heat balance calculation that is analogous to the frame heat balance calculation described above.

### Beam Solar Reflection from Window Reveal Surfaces

This section describes how beam solar radiation that is reflected from window reveal surfaces is calculated. Reflection from outside reveal surfaces—which are associated with the setback of the glazing from the outside surface of the window’s parent wall—increases the solar gain through the glazing. Reflection from inside reveal surfaces—which are associated with the setback of the glazing from the inside surface of the window’s parent wall—decreases the solar gain to the zone because some of this radiation is reflected back out of the window.

The amount of beam solar reflected from reveal surfaces depends, among other things, on the extent to which reveal surfaces are shadowed by other reveal surfaces. An example of this shadowing is shown in Figure 98. In this case the sun is positioned such that the top reveal surfaces shadow the left and bottom reveal surfaces. And the right reveal surfaces shadow the bottom reveal surfaces. The result is that the left/outside, bottom/outside, left/inside and bottom/inside reveal surfaces each have sunlit areas. Note that the top and right reveal surfaces are facing away from the sun in this example so their sunlit areas are zero.

![](EngineeringReference/media/image1593.png)

Figure 98.  Example of shadowing of reveal surfaces by other reveal surfaces.

The size of the shadowed areas, and the size of the corresponding illuminated areas, depends on the following factors:

* The sun position relative to the window

* The height and width of the window

* The depth of the outside and inside reveal surfaces

We will assume that the reveal surfaces are perpendicular to the window plane and that the window is rectangular. Then the above factors determine a unique shadow pattern. From the geometry of the pattern the shadowed areas and corresponding illuminated areas can be determined. This calculation is done in subroutine CalcBeamSolarReflectedFromWinRevealSurface in the SolarShading module. The window reveal input data is specified in the WindowProperty:FrameAndDivider object expect for the depth of the outside reveal, which is determined from the vertex locations of the window and its parent wall.

If an exterior shading device (shade, screen or blind) is in place it is assumed that it blocks beam solar before it reaches outside or inside reveal surfaces. Correspondingly, it is assumed that an interior or between-glass shading device blocks beam solar before it reaches inside reveal surfaces.

Representative shadow patterns are shown in Figure 99 for a window with no shading device, and without and with a frame. The case with a frame has to be considered separately because the frame can cast an additional shadow on the inside reveal surfaces.

The patterns shown apply to both vertical and horizontal reveal surfaces. It is important to keep in mind that, for a window of arbitrary tilt, if the left reveal surfaces are illuminated the right surfaces will not be, and vice versa. And if the bottom reveal surfaces are illuminated the top surfaces will not be, and vice versa. (Of course, for a vertical window, the top reveal surfaces will never be illuminated by beam solar if the reveal surfaces are perpendicular to the glazing, as is being assumed.

For each shadow pattern in Figure 99, equations are given for the shadowed areas <span>${A_{1,sh}}$</span> and *<span>${A_{2,sh}}$</span>* of the outside and inside reveal surfaces, respectively. The variables in these equations are the following (see also Figure 100):

<span>${d_1}$</span>        = depth of outside reveal, measured from the outside plane of the glazing to the edge of the reveal, plus one half of the glazing thickness.

<span>${d_2}$</span>        = depth of inside reveal (or, for illumination on bottom reveal surfaces,  inside sill depth), measured from the inside plane of the glazing to the edge of the reveal or the sill, plus one half of the glazing thickness.

<span>$L$</span>        = window height for vertical reveal surfaces or window width for horizontal reveal surfaces

<span>$\alpha $</span>          = vertical solar profile angle for shadowing on vertical reveal surfaces or horizontal solar profile angle for shadowing on horizontal reveal surfaces.

<span>${p_1}({p_2})$</span> = distance from outside (inside) surface of frame to glazing midplane.

<span>${d_2}^\prime $</span>      = depth of shadow cast by top reveal on bottom reveal, or by left reveal on right reveal, or by right reveal on left reveal.

<span>${d_2}^{\prime \prime }$</span>     = depth of shadow cast by frame.



For simplicity it is assumed that, for the case without a frame, the shadowed and illuminated areas extend into the glazing region. For this reason, <span>${d_1}$</span>and <span>${d_2}$</span>are measured from the midplane of the glazing. For the case with a frame, the beam solar absorbed by the surfaces formed by the frame outside and inside projections perpendicular to the glazing is calculated as described in “Window Frame and Divider Calculation: Calculation of Solar Radiation Absorbed by Frame.”



Figure 99.  Expression for area of shaded regions for different shadow patterns: (a) window without frame, (b) window with frame

![](EngineeringReference/media/image1605.png)

![](EngineeringReference/media/image1606.png)

![](EngineeringReference/media/image1607.png)

Figure 100.  Vertical section through a vertical window with outside and inside reveal showing calculation of the shadows cast by the top reveal onto the inside sill and by the frame onto the inside sill.

The following logic gives expressions for the shadowed areas for all possible shadow patterns. Here:

d1 = <span>${d_1}$</span>

d2= <span>${d_2}$</span>

P1 = <span>${p_1}$</span>

P2= <span>${p_2}$</span>

f1= <span>${d_1} - {p_1}$</span>

f2= <span>${d_2} - {p_2}$</span>

d2prime = <span>${d_2}^\prime $</span>

d2prime2= <span>${d_2}^{\prime \prime }$</span>

d12 = <span>${d_1} + {d_2} - {d_2}^\prime $</span>

TanAlpha = <span>$\tan \alpha $</span>

A1sh= <span>${A_{1,sh}}$</span>

A2sh= <span>${A_{2,sh}}$</span>

L = <span>$L$</span>

L1 = average distance to frame of illuminated area of outside reveal (used to calculate view factor to frame).

L2 = average distance to frame of illuminated area of inside reveal (used to calculate view factor to frame).


```
 IF(window does not have a frame) THEN
      IF(d2prime <= d2) THEN
     IF(d12*TanAlpha <= L) THEN
       A1sh = 0.5*TanAlpha*d1**2
       A2sh = d2prime*L + 0.5*TanAlpha*d12**2 - A1sh
     ELSE  ! d12*TanAlpha > L
       IF(d1*TanAlpha <= L) THEN
         A1sh = 0.5*TanAlpha*d1**2
         A2sh = d2*L - 0.5*TanAlpha*(L/TanAlpha - d1)**2
       ELSE  ! d1*TanAlpha > L
         A1sh = d1*L - (0.5/TanAlpha)*L**2
         A2sh = d2*L
       END IF
     END IF
   ELSE  ! d2prime > d2
     A2sh = d2*L
     IF(d2prime < d1+d2) THEN
       IF(d12*TanAlpha <= L) THEN
         A1sh = L*(d2prime-d2) + 0.5*TanAlpha*d12**2
       ELSE  ! d12*TanAlpha > L
         A1sh = d1*L - 0.5*L**2/TanAlpha
       END IF
     ELSE  ! d2prime >= d1+d2
       A1sh = d1*L
     END IF
   END IF
 ELSE  ! Window has a frame
  f1 = d1-P1
  f2 = d2-P2
  d2prime2 = FrameWidth/TanGamma
  IF(vertical reveal) THEN  ! Vertical reveal
    IF(InsReveal+0.5*GlazingThickness <= P2) d2 = P2 + 0.001
  ELSE                      ! Horizontal
    IF(bottom reveal surfaces may be illuminated) THEN
      ! Bottom reveal surfaces may be illuminated
      IF(InsSillDepth+0.5*GlazingThickness<=P2) d2= P2 + 0.001
    ELSE
      ! Top reveal surfaces may be illuminated
      IF(InsReveal+0.5*GlazingThickness <= P2) d2 = P2 + 0.001
    END IF
  END IF
  IF(d2prime <= f2) THEN
    ! Shadow from opposing reveal does not go beyond inside
     !  surface of frame
    IF(d12*TanAlpha <= L) THEN
      A1sh = 0.5*TanAlpha*f1**2
      L1   = f1*(f1*TanAlpha/(6*L)+0.5)
      IF(d2-(d2prime+d2prime2+P2) >= 0.) THEN
        A2sh = (d2prime+d2prime2)*L + &
          0.5*TanAlpha*((d1+d2-d2prime)**2-d1+p2+d2prime2)**2)
        L2   = d2prime2 + 0.5*(d2-(d2prime+d2prime2+P2))
      ELSE  ! d2-(d2prime+d2prime2+P2) < 0.
        ! Inside reveal is fully shadowed by frame and/or
         !opposing reveal
        A2sh = f2*L
        L2   = f2
      END IF
    ELSE  ! d12*TanAlpha >= L
      IF((d1+P2)*TanAlpha <= L) THEN
        A1sh = 0.5*TanAlpha*f1**2
        L1 = f1*((f1*TanAlpha)/(6*L) + 0.5)
        IF((d1+P2+d2prime2)*TanAlpha >= L) THEN
          A2sh = f2*L
          L2   = f2
        ELSE  ! (d1+P2+d2prime2)*TanAlpha < L
          A2sh = f2*L - 0.5*(L-(d1+P2)*TanAlpha)**2/TanAlpha &
             + d2prime2*(L-(d1+P2+d2prime2/2)*TanAlpha)
          L2 = d2prime2 + (L/TanAlpha - (d1+P2+d2prime2))/3
        END IF
      ELSE  ! (d1+P2)*TanAlpha > L
        L2 = f2
        A2sh = f2*L
        IF(f1*TanAlpha <= L) THEN
          A1sh = 0.5*TanAlpha*f1**2
          L1 = f1*((f1*TanAlpha)/(6*L) + 0.5)
        ELSE  ! f1*TanAlpha > L
          A1sh = f1*L - 0.5*L**2/TanAlpha
          L1 = f1-(L/TanAlpha)/3
        END IF
      END IF
    END IF
  ELSE
     ! d2prime > f2 -- Shadow from opposing reveal goes beyond
     ! inside of frame
    A2sh = f2*L
    L2 = f2
    IF(d2prime >= d1+d2) THEN
      A1sh = 0.0
      L1   = f1
    ELSE  ! d2prime < d1+d2
      IF(d2prime <= d2+P1) THEN
        IF(f1*TanAlpha <= L) THEN
          A1sh = 0.5*TanAlpha*f1**2
          L1 = f1*((f1*TanAlpha)/(6*L) + 0.5)
        ELSE  ! f1*TanAlpha > L
          A1sh = f1*L - 0.5*L**2/TanAlpha
              L1   = f1 - (L/TanAlpha)/3
            END IF
          ELSE  ! d2prime > d2+P1
            IF(d12*TanAlpha <= L) THEN
              A1sh = L*(d2prime-(d2+P1)) + 0.5*TanAlpha*d12**2
              L1   = (L*(f1-d12/2)-d12*TanAlpha* &
                 (f1/2-d12/3))/(L-d12*TanAlpha/2)
            ELSE  ! d12*TanAlpha > L
              A1sh = f1*L - 0.5*L**2/TanAlpha
              L1   = f1 - (L/TanAlpha)/3
            END IF
          END IF
        END IF
      END IF
      FracToGlassOuts = 0.5*(1.0 - ATAN(FrameWidth/L1)/PiOvr2)
      FracToGlassIns  = 0.5*(1.0 - ATAN(FrameWidth/L2)/PiOvr2)
    END IF  ! End of check if window has frame
```


The beam solar reflected from a sunlit region of area <span>$A$</span>is given by

<div>$$R = {I_B}A\cos \beta (1 - a){\rm{ }}$$</div>

where

<span>$R$</span>= reflected solar radiation [W]

<span>${I_B}$</span>= beam normal irradiance [W/m<sup>2</sup>]

<span>$A$</span>= sunlit area [m<sup>2</sup>]

<span>$\beta $</span>= beam solar angle of incidence on reveal surface

<span>$a$</span>= solar absorptance of reveal surface

All reflected radiation is assumed to be isotropic diffuse. For outside reveal surfaces it is assumed that <span>$R/2$</span> goes toward the window and <span>$R/2$</span> goes to the exterior environment. Of the portion that goes toward the window a fraction <span>${F_1}$</span> goes toward the frame, if present, and <span>$1 - {F_1}$</span> goes toward the glazing.

The view factor <span>${F_1}$</span> to the frame calculated by assuming that the illuminated area can be considered to be a line source. Then the area-weighted average distance, <span>${L_1}$</span>, of the source to the frame is calculated from the shape of the illuminated area (see above psuedo-code). Then <span>${F_1}$</span> is related as follows to the average angle subtended by the frame of width <span>${w_f}$</span>:

<div>$${F_1} = \frac{{{{\tan }^{ - 1}}({w_f}/{L_1})}}{{\pi /2}}$$</div>

For the portion going towards the frame, <span>$(R/2){F_1}{a_f}$</span>is absorbed by the frame (where <span>${a_f}$</span>is the solar absorptance of the frame) and contributes to the frame heat conduction calculation. The rest, <span>$(R/2){F_1}(1 - {a_f})$</span>, is assumed to be reflected to the exterior environment.

If the glazing has diffuse transmittance <span>${\tau_{diff}}$</span>, diffuse front reflectance <span>$\rho_{diff}^f$</span>, and layer front absorptance <span>$\alpha_{l,diff}^f$</span>, then, of the portion, <span>$(R/2)(1 - {F_1})$</span>, that goes toward the glazing, <span>$(R/2)(1 - {F_1}){\tau_{diff}}$</span>is transmitted to the zone, <span>$(R/2)(1 - {F_1})\alpha_{l,diff}^f$</span>is absorbed in glass layer <span>$l$</span>and contributes to the glazing heat balance calculation, and <span>$(R/2)(1 - {F_1})\rho_{dif{f_{}}}^f$</span>is reflected to the exterior environment.

The beam solar absorbed by an outside reveal surface is added to the other solar radiation absorbed by the outside of the window’s parent wall.

For inside reveal surfaces it is assumed that <span>$R/2$</span> goes towards the window and <span>$R/2$</span> goes into the zone. Of the portion that goes toward the window a fraction <span>$(R/2){F_2}$</span> goes toward the frame, if present, and <span>$(R/2)(1 - {F_2})$</span>goes toward the glazing (<span>${F_2}$</span> is calculated using a method analogous to that used for <span>${F_1}$</span>). For the portion going towards the frame, <span>$(R/2){F_2}{a_f}$</span>is absorbed by the frame and contributes to the frame heat conduction calculation. The rest, <span>$(R/2){F_2}(1 - {a_f})$</span>, is assumed to be reflected back into the zone.

If the glazing has diffuse back reflectance <span>$\rho_{diff}^b$</span>, and layer back absorptance <span>$\alpha_{l,diff}^b$</span>, then, of the portion <span>$(R/2)(1 - {F_2})$</span> that goes toward the glazing, <span>$(R/2)(1 - {F_2}){\tau_{diff}}$</span>is transmitted back out the glazing, <span>$(R/2)(1 - {F_2})\alpha_{l,diff}^b$</span>is absorbed in glass layer <span>$l$</span>and contributes to the glazing heat balance calculation, and <span>$(R/2)(1 - {F_2})\rho_{dif{f_{}}}^b$</span>is reflected into the zone.

The beam solar absorbed by an inside reveal surface is added to the other solar radiation absorbed by the inside of the window’s parent wall.

### Shading Device Thermal Model

Shading devices in EnergyPlus can be on the exterior or interior sides of the window or between glass layers. The window shading device thermal model accounts for the thermal interactions between the shading layer (shade, screen or blind) and the adjacent glass, and between the shading layer and the room (for interior shading) or the shading layer and the outside surround (for exterior shading).

An important feature of the shading device thermal model is calculating the natural convection airflow between the shading device and glass. This flow affects the temperature of the shading device and glazing and, for interior shading, is a determinant of the convective heat gain from the shading layer and glazing to the zone air. The airflow model is based on one described in the ISO Standard 15099, “Thermal Performance of Windows, Doors and Shading Devices—Detailed Calculations” [ISO15099, 2001]. (Between-glass forced airflow is also modeled; see “Airflow Windows.”)

The following effects are considered by the shading device thermal model:

* For interior and exterior shading device: Long-wave radiation (IR) from the surround absorbed by shading device, or transmitted by the shading device and absorbed by the adjacent glass. For interior shading the surround consists of the other zone surfaces. For exterior shading the surround is the sky and ground plus exterior shadowing surfaces and exterior building surfaces “seen” by the window.

* Inter-reflection of IR between the shading device and adjacent glass.

* Direct and diffuse solar radiation absorbed by the shading device.

* Inter-reflection of solar radiation between shading layer and glass layers.

* Convection from shading layer and glass to the air in the gap (or, for between-glass shading, gaps) between the shading layer and adjacent glass, and convection from interior shading layer to zone air or from exterior shading layer to outside air.

* Natural convection airflow in the gap (or, for between-glass shading, gaps) between shading layer and adjacent glass induced by buoyancy effects, and the effect of this flow on the shading-to-gap and glass-to-gap convection coefficients.

* For interior shading, convective gain (or loss) to zone air from gap airflow.

In the following it is assumed that the shading device, when in place, covers the glazed part of the window (and dividers, if present) and is parallel to the glazing. For interior and exterior shading devices it is assumed that the shading layer is separated from the glazing by an air gap. A between-glass shading layer is assumed to be centered between two glass layers and separated from the adjacent glass layers by gaps that is filled with the same gas. If the window has a frame, it is assumed that the shading device does *not* cover the frame.

### Heat Balance Equations for Shading Device and Adjacent Glass

If a window shading device is deployed the heat balance equations for the glass surfaces facing the shading layer are modified, and two new equations, one for each face of the shading layer, are added. Figure 101 illustrates the case of double glazing with an interior shading device.



![](EngineeringReference/media/image1663.png)

Figure 101. Glazing system with two glass layers and an interior shading layer showing variables used in heat balance equations.



The heat balance equation for the glass surface facing the gap between glass and shading layer (called in the following, “gap”) is

<div>$$\frac{{{E_i}{\varepsilon_4}{\tau_{sh}}}}{{1 - {\rho_4}{\rho_{sh}}}} + \frac{{\sigma {\varepsilon_4}}}{{1 - {\rho_4}{\rho_{sh}}}}\left[ {\theta_5^4{\varepsilon_{sh}} - \theta_4^4(1 - {\rho_{sh}})} \right] + {k_2}\left( {{\theta_3} - {\theta_4}} \right) + {h_{cv}}\left( {{T_{gap}} - {\theta_4}} \right) + {S_4} = 0$$</div>

where

*τ<sub>sh</sub>* = IR diffuse transmittance of shading device

*ε<sub>sh</sub>* = diffuse emissivity of shading device

*ρ<sub>sh</sub>* = IR diffuse reflectance of shading device ( = 1 - ( *τ<sub>sh</sub>* + *ε<sub>sh</sub>*))

*θ<sub>5</sub>* = temperature of the surface of the shading layer that faces the gap (K).

The term 1 – *ρ<sub>4</sub> ρ<sub>sh</sub>* accounts for the inter-reflection of IR radiation between glass and shading layer.

The convective heat transfer from glass layer \#2 to the air in the gap is

<div>$${q_{c,gl}} = {h_{cv}}({\theta_4} - {T_{gap}})$$</div>

where

*T<sub>gap</sub>* = effective mean temperature of the gap air (K).

*h<sub>cv</sub>*= convective heat transfer coefficient from glass or shading layer to gap air (W/m<sup>2</sup>K).

The corresponding heat transfer from shading layer to gap air is

<div>$${q_{c,sh}} = {h_{cv}}({\theta_5} - {T_{gap}})$$</div>

The convective heat transfer coefficient is given by

<div>$${h_{cv}} = 2{h_c} + 4v$$</div>

where

*h<sub>c</sub>*= surface-to-surface heat transfer coefficient for non-vented (closed) cavities (W/m<sup>2</sup>K)

*v* = mean air velocity in the gap (m/s).

The quantities *h<sub>cv</sub>* and *T<sub>gap</sub>* depend on the airflow velocity in the gap, which in turn depends on several factors, including height of shading layer, glass/shading layer separation (gap depth), zone air temperature for interior shading or outside air temperature for exterior shading, and shading layer and glass face temperatures. The calculation of *h<sub>cv</sub>* and *T<sub>gap</sub>* is described in the following sections.

The heat balance equation for the shading layer surface facing the gap is

<div>$$
  \frac{E_i \tau_{sh} \rho_4 \varepsilon_{sh}} {1 - \rho_4 \rho_{sh}} + 
  \frac{\sigma \varepsilon_{sh}} {1 - \rho_4 \rho_{sh}} \left[
    \varepsilon_4 \theta_4^4 - \theta_5^4 (
      1 - \rho_4( 
        \varepsilon_{sh} + \rho_{sh}
      )
    )
  \right] + 
  k_{sh} \left(
    \theta_6 - \theta_5
  \right) + 
  h_{cv} \left(
    T_{gap} - \theta_5
  \right) + 
  S_{sh,1} = 0
$$</div>

where

*k<sub>sh</sub>* = shading layer conductance (W/m<sup>2</sup>K).

*θ<sub>6</sub>* = temperature of shading layer surface facing the zone air (K).

*S<sub>sh,1</sub>* = solar radiation plus short-wave radiation from lights plus IR radiation from lights and zone equipment absorbed by the gap-side face of the shading layer (W/m<sup>2</sup>K).

The heat balance equation for the shading layer surface facing the zone air is

<div>$${E_i}{\varepsilon_{sh}} - {\varepsilon_{sh}}\sigma \theta_6^4 + {k_{sh}}\left( {{\theta_5} - {\theta_6}} \right) + {h_i}\left( {{T_i} - {\theta_6}} \right) + {S_{sh,2}} = 0$$</div>

where

*S<sub>sh,2</sub>* = solar radiation plus short-wave radiation from lights plus IR radiation from lights and zone equipment absorbed by the zone-side face of the shading layer (W/m<sup>2</sup>K).

### Solving for Gap Airflow and Temperature

For interior and exterior shading devices a pressure-balance equation is used to determine gap air velocity, gap air mean equivalent temperature and gap outlet air temperature given values of zone air temperature (or outside temperature for exterior shading), shading layer face temperatures and gap geometry. The pressure balance equates the buoyancy pressure acting on the gap air to the pressure losses associated with gap airflow between gap inlet and outlet [ISO15099, 2001]. The variables used in the following analysis of the interior shading case are shown in Figure 102.

![](EngineeringReference/media/image1670.png)

Figure 102.  Vertical section (a) and perspective view (b) of glass layer and interior shading layer showing variables used in the gap airflow analysis. The opening areas *A<sub>bot</sub>*, *A<sub>top</sub>*, *A<sub>l</sub>*, *A<sub>r</sub>* and *A<sub>h</sub>* are shown schematically.

#### Pressure Balance Equation

The pressure balance equation for airflow through the gap is

<div>$$\Delta {p_T} = \Delta {p_B} + \Delta {p_{HP}} + \Delta {p_Z}$$</div>

Here, *Δp<sub>T</sub>*is the driving pressure difference between room air and gap air. It is given by

<div>$$\Delta {p_T} = {\rho_0}{T_0}gH\sin \phi \frac{{\left| {{T_{gap}} - {T_{gap,in}}} \right|}}{{{T_{gap}}{T_{gap,in}}}}$$</div>

where

*ρ<sub>0</sub>* = density of air at temperature *T<sub>0</sub>* (kg/m<sup>3</sup>)

*T<sub>0</sub>* = reference temperature (283K)

*g* = acceleration due to gravity (m/s<sup>2</sup>)

*H* = height of shading layer (m)

*φ* = tilt angle of window (vertical = 90<sup>o</sup>)

*T<sub>gap</sub>* = effective mean temperature of the gap air (K)

*T<sub>gap,in</sub>* = gap inlet temperature ( = zone air temperature for interior shading) (K)

The *Δp<sub>B</sub>* term is due to the acceleration of air to velocity *v* (Bernoulli’s law). It is given by

<div>$$\Delta {p_B} = \frac{\rho }{2}{v^2}{\rm{    (Pa)}}$$</div>

where  *ρ*is the gap air density evaluated at *T<sub>gap</sub>* (kg/m<sup>3</sup>).

The *Δp<sub>HP</sub>* term represents the pressure drop due to friction with the shading layer and glass surfaces as the air moves through the gap. Assuming steady laminar flow, it is given by the Hagen-Poiseuille law for flow between parallel plates [Munson et al. 1998]:

<div>$$\Delta {p_{HP}} = 12\mu \frac{H}{{{s^2}}}{v^{}}{\rm{    (Pa)}}$$</div>

where * μ*  is the viscosity of air at temperature *T<sub>gap</sub>* (Pa-s).

The  *Δp<sub>Z</sub>* term is the sum of the pressure drops at the inlet and outlet openings:

<div>$$\Delta {p_Z} = \frac{{\rho {v^2}}}{2}\left( {{Z_{in}} + {Z_{out}}} \right){\rm{    (Pa)}}$$</div>

Here, the inlet pressure drop factor,* Z<sub>in</sub>*, and the outlet pressure drop factor, *Z<sub>out</sub>*, are given by

<div>$$
  \begin{array}{rl}
    Z_{in}  &= \left( \frac{A_{gap}}{0.66A_{eq,in}}  - 1 \right)^2 \\
    Z_{out} &= \left( \frac{A_{gap}}{0.60A_{eq,out}} - 1 \right)^2
  \end{array}
$$</div>

<div>$$\begin{array}{l}{Z_{in}} = {\left( {\frac{{{A_{gap}}}}{{0.66{A_{eq,in}}}} - 1} \right)^2}\\\{Z_{out}} = {\left( {\frac{{{A_{gap}}}}{{0.60{A_{eq,out}}}} - 1} \right)^2}\end{array}$$</div>

where

*A<sub>eq,in</sub>* = equivalent inlet opening area (m<sup>2</sup>)

*A<sub>eq,out</sub>* = equivalent outlet opening area (m<sup>2</sup>)

*A<sub>gap</sub>* = cross-sectional area of the gap = *sW*(m<sup>2</sup>)

If  T<sub>gap</sub> &gt; T<sub>gap,in</sub>

<div>$$
  \begin{array}{rl}
    A_{eq,in}  &= A_{bot} + \frac{A_{top}}{2(A_{bot}+A_{top}} \left( A_l + A_r + A_h \right) \\
    A_{eq,out} &= A_{top} + \frac{A_{bot}}{2(A_{bot}+A_{top}} \left( A_l + A_r + A_h \right) 
  \end{array}
$$</div>

If  T<sub>gap</sub> ≤ T<sub>gap,in</sub>

<div>$$
  \begin{array}{rl}
    A_{eq,in}  &= A_{top} + \frac{A_{bot}}{2(A_{bot}+A_{top}} \left( A_l + A_r + A_h \right) 
    A_{eq,out} &= A_{bot} + \frac{A_{top}}{2(A_{bot}+A_{top}} \left( A_l + A_r + A_h \right) \\
  \end{array}
$$</div>

Here, the area of the openings through which airflow occurs (see Figure 102 and Figure 103) are defined as follows:

A<sub>bot</sub> = area of the bottom opening (m<sup>2</sup>)

A<sub>top</sub> = area of the top opening (m<sup>2</sup>)

A<sub>l</sub> = area of the left-side opening (m<sup>2</sup>)

A<sub>r</sub> = area of the right-side opening (m<sup>2</sup>)

A<sub>h</sub> = air permeability of the shading device expressed as the total area of openings (“holes”) in the shade surface (these openings are assumed to be uniformly distributed over the shade) (m<sup>2</sup>)

Figure 103 shows examples of A<sub>bot</sub>, A<sub>top</sub>, A<sub>l</sub> and A<sub>r</sub> for different shading device configurations.  These areas range from zero to a maximum value equal to the associated shade/screen/blind-to-glass cross-sectional area; i.e., A<sub>bot</sub> and A<sub>top</sub> ≤ sW,  A<sub>l</sub> and A<sub>r</sub> ≤ sH.

![](EngineeringReference/media/image1679.png)

Figure 103.  Examples of openings for an interior shading layer covering glass of height H and width W. Not to scale. (a) Horizontal section through shading layer with openings on the left and right sides (top view). (b) Vertical section through shading layer with openings at the top and bottom (side view).

Expression for the Gap Air Velocity

 Expressing Equation in terms of  v  yields the following quadratic equation:

<div>$$\frac{{\rho {v^2}}}{2}\left( {1 + {Z_{in}} + {Z_{out}}} \right) + \frac{{12\mu H}}{{{s^2}}}v - {\rho_0}{T_0}gH\sin \phi \frac{{\left| {{T_{gap,in}} - {T_{gap}}} \right|}}{{{T_{gap,in}}{T_{gap}}}} = 0$$</div>

Solving this gives

<div>$$v = \frac{{{{\left[ {{{\left( {\frac{{12\mu H}}{{{s^2}}}} \right)}^2} + \frac{{2{\rho ^2}(1 + {Z_{in}} + {Z_{out}}){\rho_0}{T_0}gH\sin \phi \left| {{T_{gap,in}} - {T_{gap}}} \right|}}{{{T_{gap,in}}{T_{gap}}}}} \right]}^{1/2}} - \frac{{12\mu H}}{{{s^2}}}}}{{\rho (1 + {Z_{in}} + {Z_{out}})}}$$</div>

The choice of the root of the quadratic equation is dictated by the requirement that *v* = 0 if *T<sub>gap,in</sub>* = *T<sub>gap</sub>*.

Gap Outlet Temperature and Equivalent Mean Air Temperature

The temperature of air in the gap as a function of distance, *h*, from the gap inlet (Figure 104) is

<div>$${T_{gap}}(h) = {T_{ave}} - ({T_{ave}} - {T_{gap,in}}){e^{ - h/{H_0}}}$$</div>

where

<div>$${T_{ave}} = \frac{{{T_{gl}} + {T_{sh}}}}{2}$$</div>

is the average temperature of the glass and shading layer surfaces facing the gap (K).

*H<sub>0</sub>*= characteristic height (m), given by

<div>$${H_0} = \frac{{\rho {C_p}s}}{{2{h_{cv}}}}v$$</div>

where *C<sub>p</sub>* is the heat capacity of air.

The gap outlet temperature is given by

<div>$${T_{gap,out}} = {T_{ave}} - ({T_{ave}} - {T_{gap,in}}){e^{ - H/{H_0}}}$$</div>

The thermal equivalent mean temperature of the gap air is

<div>$${T_{gap}} = \frac{1}{H}\int\limits_0^H {{T_{gap}}(h)dh = {T_{ave}} - \frac{{{H_0}}}{H}} \left( {{T_{gap,out}} - {T_{gap,in}}} \right)$$</div>

![](EngineeringReference/media/image1687.png)

Figure 104.  Variation of gap air temperature with distance from the inlet for upward flow.

Solution Sequence for Gap Air Velocity and Outlet Temperature

The routine WinShadeGapFlow is called within the glazing heat balance iterative loop in SolveForWindowTemperatures to determine *v* and *T<sub>gap,out</sub>*. The solution sequence in WinShadeGapFlow is as follows:

At start of iteration, guess *T<sub>gap</sub>* as ((*T<sub>gl</sub>* + *T<sub>sh</sub>*)/2 + *T<sub>gap,in</sub>*)/2. Thereafter use value from previous iteration.

Get still-air conductance, *h<sub>c</sub>*, by calling WindowGasConductance and NusseltNumber.

Get *v* from Equation

Get *h<sub>cv</sub>* from Equation

Get *T<sub>ave</sub>*from Equation

Get *T<sub>gap,out</sub>* from Equation

Get new value of *T<sub>gap</sub>*from Equation

The values of *h<sub>cv</sub>* and *T<sub>gap</sub>* so determined are then used in the window heat balance equations to find new values of the face temperatures of the glass and shading layers. These temperatures are used in turn to get new values of *h<sub>cv</sub>* and *T<sub>gap</sub>* until the whole iterative process converges.

Convective Heat Gain to Zone from Gap Airflow

The heat added (or removed) from the air as it passes through the gap produces a convective gain (or loss) to the zone air given by

<div>$${q_v} = LW\left[ {{h_{cv}}\left( {{T_{gl}} - {T_{gap}}} \right) + {h_{cv}}\left( {{T_{sh}} - {T_{gap}}} \right)} \right] = 2{h_{cv}}LW\left( {{T_{ave}} - {T_{gap}}} \right){\rm{    (W)}}$$</div>

This can also be expressed as

<div>$${q_v} = \dot m{C_p}\left( {{T_{gap,out}} - {T_{gap,in}}} \right){\rm{    (W)}}$$</div>

where the air mass flow rate in the gap is given by

<div>$$\dot m = \rho {A_{gap}}v{\rm{    (kg/s)}}$$</div>

### Heat Balance Equations for Between-Glass Shading Device

In EnergyPlus shading devices are allowed between the two glass panes of double glazing and between the two inner glass panes of triple glazing. Figure 105 shows the case of a between-glass shading device in double glazing.



![](EngineeringReference/media/image1691.png)

Figure 105. Glazing system with two glass layers and a between-glass shading device showing variables used in the heat balance equations.



The heat balance equations for the two glass surfaces facing the shading device are the following.

For face \#2:

<div>$$
  h_{cv,1} (T_{gap,1}-\theta_2) + k_1 (\theta_1-\theta_2) +
    \frac{\sigma \epsilon_2}{1-\rho_2 R_1} \left[
      \frac{\tau_{sh}}{1-\rho_6\rho_3} (
        \epsilon_3 \theta_3^4 + \epsilon_6\theta_6^4\rho_3
      )
      + \epsilon_5\theta_5^4 + \epsilon_2\theta_2^4R_1
    \right]
$$</div>

where

<div>$${R_1} = {\rho_5} + \frac{{\tau_{sh}^2{\rho_3}}}{{1 - {\rho_6}{\rho_3}}}$$</div>

<span>${T_{gap,1}} = $</span> effective mean air temperature in gap 1 (K)

<span>${h_{cv,1}} = $</span> convective heat transfer coefficient from glass or shading layer to gas in gap 1 (W/m<sup>2</sup>K)

For face \#3:

<div>$$
  h_{cv,2} (T_{gap,2}-\theta_3) + k_2 (\theta_4-\theta_3) +
    \frac{\sigma \epsilon_3}{1-\rho_3 R_2} \left[
      \frac{\tau_{sh}}{1-\rho_5\rho_2} (
        \epsilon_3 \theta_2^4 + \epsilon_5\theta_5^4\rho_2
      )
      + \epsilon_6\theta_6^4 + \epsilon_7\theta_3^4R_2
    \right]
$$</div>

where

<div>$${R_2} = {\rho_6} + \frac{{\tau_{sh}^2{\rho_2}}}{{1 - {\rho_5}{\rho_2}}}$$</div>

<span>${T_{gap,2}} = $</span> effective mean air temperature in gap 2 (K)

<span>${h_{cv,2}} = $</span> convective heat transfer coefficient from glass or shading layer to gas in gap 2 (W/m<sup>2</sup>K)

The heat balance equations for the shading layer faces are:

For face \#5:

<div>$$
  h_{cv,1} (T_{gap,1}-\theta_5) + k_sh (\theta_6-\theta_5) +
    \frac{\sigma \epsilon_5}{1-\rho_2 R_1} \left[
      \frac{\tau_{sh}\rho_2}{1-\rho_5\rho_3} (
        \epsilon_3 \theta_3^4 + \epsilon_6\theta_6^4\rho_3
      )
      + \epsilon_2\theta_2^4 + \epsilon_5\theta_5^4\rho_2
    \right]
$$</div>

For face \#6:

<div>$$
  h_{cv,2} (T_{gap,2}-\theta_3) + k_2 (\theta_4-\theta_3) +
    \frac{\sigma \epsilon_3}{1-\rho_3 R_2} \left[
      \frac{\tau_{sh}}{1-\rho_5\rho_2} (
        \epsilon_2 \theta_2^4 + \epsilon_5\theta_5^4\rho_2
      )
      + \epsilon_2\theta_2^4 + \epsilon_7\theta_3^4R_2
    \right]
$$</div>

The convective heat transfer coefficients are given by

<div>$$\begin{array}{l}{h_{cv,1}} = 2{h_{c,1}} + 4v\\\{h_{cv,2}} = 2{h_{c,2}} + 4v\end{array}$$</div>

where

<span>${h_{c,1}},{h_{c,2}} = $</span>     surface-to-surface heat transfer coefficients for gap \#1 and \#2,  respectively,  when these gaps are non-vented (closed).

<span>$v = $</span>               air velocity in the gaps (m/s). It is assumed that the gap widths are equal, so that the velocity of flow in the gaps is equal and opposite, i.e., when the airflow is upward in gap \#1 it is downward in gap \#2 and vice-versa.

In analogy to the interior or exterior shading device case, the air velocity is determined by solving the following pressure balance equation:



<div>$$\Delta {p_{T,1,2}} = \Delta {p_{B,1}} + \Delta {p_{HP,1}} + \Delta {p_{Z,1}} + \Delta {p_{B,2}} + \Delta {p_{HP,2}} + \Delta {p_{Z,2}}$$</div>

where the driving pressure difference between gap \#1 and \#2 is

<div>$$\Delta {p_{T,1,2}} = {\rho_0}{T_0}gH\sin \phi \frac{{\left| {{T_{gap,1}} - {T_{gap,2}}} \right|}}{{{T_{gap,1}}{T_{gap,2}}}}{\rm{      (Pa)}}$$</div>

The pressure drops on the right-hand side of this equation are:

<div>$$\begin{array}{l}\Delta {p_{B,i}} = \frac{{{\rho_{gap,}}_i}}{2}{v^2}\\\Delta {p_{HP,i}} = 12{\mu_{gap,}}_i\frac{H}{{{s^2}}}\\\Delta {p_{Z,i}} = \frac{{{\rho_{gap,}}_i{v^2}}}{2}({Z_{in,i}} + {Z_{out,i}})\end{array}$$</div>

where *i* = gap number (1 or 2).

It can be shown that <span>${Z_{in,1}} + {Z_{out,1}} = {Z_{in,2}} + {Z_{out,2}}$</span>. Then, inserting these pressure drop expressions into , we obtain the following expression for the airflow velocity:

<div>$$v = \frac{{{{\left[ {{{\left( {\frac{{12({\mu_{gap,}}_1 + {\mu_{gap,}}_2)H}}{{{s^2}}}} \right)}^2} + 2\Delta {p_{T,1,2}}({\rho_{gap,1}} + {\rho_{gap,2}})(1 + {Z_{in}} + {Z_{out}})} \right]}^{1/2}} - \frac{{12({\mu_{gap,}}_1 + {\mu_{gap,}}_2)H}}{{{s^2}}}}}{{({\rho_{gap,}}_1 + {\rho_{gap,}}_2)(1 + {Z_{in}} + {Z_{out}})}}$$</div>

The choice of the sign of the square root term is dictated by the requirement that <span>$v = 0$</span> if <span>$\Delta {p_{T,1,2}} = 0$</span>, i.e., <span>${T_{gap,1}} = {T_{gap,2}}$</span>.

Given <span>$v$</span> we can now calculate <span>${T_{gap,1}}$</span>and <span>${T_{gap,2}}$</span>, which gives <span>$\Delta {p_{T,1,2}}$</span>. The procedure is as follows. We have

<div>$${T_{gap,1,out}} = {T_{ave,1}} - ({T_{ave,1}} - {T_{gap,1,in}}){\xi_1}$$</div>

where <span>${T_{ave,1}} = ({\theta_2} + {\theta_5})/2$</span> and <span>${\xi_1} = {e^{ - \frac{H}{{{H_{0,1}}}}}}$</span> with <span>${H_{0,1}} = {\rho_{gap,1}}{C_p}sv/(2{h_{cv,1}})$</span>. Since <span>${T_{gap,1,in}} = {T_{gap,2,out}}$</span> this gives:

  <span>${T_{gap,1,out}} = {T_{ave,1}} - ({T_{ave,1}} - {T_{gap,2,out}}){\xi_1}$</span>

Similarly,

<div>$${T_{gap,2,out}} = {T_{ave,2}} - ({T_{ave,2}} - {T_{gap,1,out}}){\xi_2}$$</div>

Solving these simultaneous equations gives:

 <span>$\begin{array}{l}{T_{gap,1,out}} = \frac{{{T_{ave,1}}(1 - {\xi_1}) + {\xi_1}{T_{ave,2}}(1 - {\xi_2})}}{{1 - {\xi_1}{\xi_2}}}\\\\\{T_{gap,2,out}} = \frac{{{T_{ave,2}}(1 - {\xi_2}) + {\xi_2}{T_{ave,1}}(1 - {\xi_1})}}{{1 - {\xi_1}{\xi_2}}}\end{array}$</span>

Using these in

<div>$${T_{gap,1}} = {T_{ave,1}} - \frac{{{H_{0,1}}}}{H}\left( {{T_{gap,1,out}} - {T_{gap,2,out}}} \right)$$</div>

gives

 <span>${T_{gap,1}} = {T_{ave,1}} - \frac{{{H_{0,1}}}}{H}\xi \left( {{T_{ave,1}} - {T_{ave,2}}} \right)$</span>

with

<div>$$\xi  = \frac{{(1 - {\xi_1})(1 - {\xi_2})}}{{1 - {\xi_1}{\xi_2}}}$$</div>

Similarly, from

<div>$${T_{gap,2}} = {T_{ave,2}} - \frac{{{H_{0,2}}}}{H}\left( {{T_{gap,2,out}} - {T_{gap,1,out}}} \right)$$</div>

we get

<div>$${T_{gap,2}} = {T_{ave,2}} - \frac{{{H_{0,2}}}}{H}\xi \left( {{T_{ave,2}} - {T_{ave,1}}} \right)$$</div>

The overall solution sequence is as follows.

At start of iteration guess <span>${T_{gap,1}} = {T_{ave,1}}$</span> and <span>${T_{gap,2}} = {T_{ave,2}}$</span>. Then

1)    Get <span>${\rho_{gap,1}},{\rho_{gap,2}},{\mu_{gap,1}},{\mu_{gap,2}}$</span>using <span>${T_{gap,1}},{T_{gap,2}}$</span>.

2)    Get still-air conductances <span>${h_{c,1}},{h_{c,2}}$</span>by calling WindowGasConductance and NusseltNumber.

3)    Get <span>$v$</span> from Equation

4)    Get <span>${h_{cv,1}},{h_{cv,2}}$</span>from Equation

5)    Get <span>${T_{ave,1}},{T_{ave,2}}$</span>

6)    Get *H<sub>o,1</sub>*, *H<sub>o,2</sub>*, <span>${\xi_1}$</span>and <span>${\xi_2}$</span>.

7)    Get <span>${T_{gap,1}}$</span>,<span>${T_{gap,2}}$</span>from Equations and

The values <span>${h_{cv,1}}{\rm{, }}{h_{cv,2}}{\rm{, }}{T_{gap,1}}$</span> and <span>${T_{gap,2}}$</span>are then used in the face heat balance equations to find new values of the face temperatures <span>${\theta_2}{\rm{, }}{\theta_3},{\rm{ }}{\theta_5}$</span>and <span>${\theta_6}$</span>. These are used in turn to get new values of <span>${h_{cv,1}}{\rm{, }}{h_{cv,2}}{\rm{, }}{T_{gap,1}}$</span> and <span>${T_{gap,2}}$</span>until the whole iterative process converges.

### Airflow Windows

In airflow windows forced air flows in the gap between adjacent layers of glass. Such windows are also known as “heat-extract windows” and “climate windows.”

Five configurations of airflow windows are modeled (Figure 106) that depend on the source and destination of forced air. The allowed combinations of Airflow Source and Airflow Destination are:

InsideAir à OutsideAir

InsideAir à InsideAir

InsideAir à ReturnAir

OutsideAir à InsideAir

OutsideAir à OutsideAir

![](EngineeringReference/media/image1748.png)

Figure 106. Gap airflow configurations for airflow windows. From “Active facades,” Version no. 1, Belgian Building Research Institute, June 2002.

A common application of airflow windows is to reduce the zone cooling load by exhausting indoor air through the window, thereby picking up and rejecting heat from the glazing (Figure 106).

Figure 107 shows the variables used in the heat balance equations for forced airflow in a double-glazed window.

![](EngineeringReference/media/image1749.png)

Figure 107. Glazing system with forced airflow between two glass layers showing variables used in the heat balance equations.

The heat balance equation for the left-hand glass surface facing the gap in Figure 107 is:

<div>$${k_1}({\theta_1} - {\theta_2}) + {h_{cv}}({T_{gap}} - {\theta_2}) + \sigma \frac{{{\varepsilon_2}{\varepsilon_3}}}{{1 - (1 - {\varepsilon_2})(1 - {\varepsilon_3})}}\left( {\theta_3^4 - \theta_2^4} \right) + {S_2} = 0$$</div>

The corresponding equation for the right-hand glass surface facing the gap is:

<div>$${k_2}({\theta_4} - {\theta_3}) + {h_{cv}}({T_{gap}} - {\theta_3}) + \sigma \frac{{{\varepsilon_2}{\varepsilon_3}}}{{1 - (1 - {\varepsilon_2})(1 - {\varepsilon_3})}}\left( {\theta_2^4 - \theta_3^4} \right) + {S_3} = 0$$</div>

Here,

*T<sub>gap</sub>* = effective mean temperature of the gap air (K)

*h<sub>cv</sub>*= convective heat transfer coefficient from glass to gap air (W/m2K).

The convective heat transfer coefficient is given by

<div>$${h_{cv}} = 2{h_c} + 4v$$</div>

where

*h<sub>c</sub>*= glass-to-glass heat transfer coefficient for non-vented (closed) cavity (W/m<sup>2</sup>K)

*v* = mean air velocity in the gap (m/s).

The air velocity is determined by the gap cross-sectional area in the flow direction and the air flow rate, which is an input value that is constant or can vary according to a user-specified schedule:

<div>$$v = \frac{F}{{{A_{gap}}}}{\rm{      (m/s)}}$$</div>

where

*F* = airflow rate (m<sup>3</sup>/s)

*A<sub>gap</sub>* = gap cross-sectional area in direction of flow (m2)

It is assumed that the airflow is uniform across the width of the window.

The mean temperature of the gap air is given by the following expression, whose derivation follows that for for the case of an interior shading device:

<div>$${T_{gap}} = {T_{ave}} - \frac{H}{{{H_0}}}({T_{gap,out}} - {T_{gap,in}})$$</div>

where



<div>$${T_{ave}} = \frac{{{\theta_2} + {\theta_3}}}{2}$$</div>

*H*   = glazing height (m)

<div>$${H_0} = \frac{{\rho {C_p}s}}{{2{h_{cv}}}}v$$</div>

*T<sub>gap,in</sub>*<sub> </sub>=  gap air inlet temperature (*T<sub>i</sub>* if the airflow source is indoor air, *T<sub>o</sub>* if the airflow source is outside air) (K)

The outlet air temperature is given by

<div>$${T_{gap,out}} = {T_{ave}} - ({T_{ave}} - {T_{gap,in}}){e^{ - H/{H_0}}}$$</div>

The equations for glass face \#1 and \#4 are the same as those for no airflow in the gap (Equations and ).

The convective heat gain to the zone air due to the gap airflow when the airflow destination is indoor air is

<div>$${q_v} = \dot m({C_{p,out}}{T_{gap,out}} - {C_{p,i}}{T_i}){\rm{      (W)}}$$</div>

where

*C<sub>p,i</sub>*<sub>   </sub> = heat capacity of the indoor air (J/kg-K)

*C<sub>p,out</sub>*= heat capacity of the gap outlet air (J/kg-K)

and where the air mass flow rate in the gap is

<div>$$\dot m = \rho F{\rm{      (kg/s)}}$$</div>

#### Fan Energy

The fan energy used to move air through the gap is very small and is ignored.

#### Airflow Window with Between-Glass Shading Device

Figure 108 shows the case of a double-glazed airflow window with a between glass shading device. The heat balance equations in this case are the same as those for the between-glass shading device with natural convection (Figure 105 and following equations) except that now

<div>$$v = \frac{{F/2}}{{{A_{gap}}}}{\rm{      (m/s)}}$$</div>

where *A<sub>gap</sub>* = *sW* is the cross-sectional area of the gap on either side of the shading device. It is assumed that the shading device is centered between the two panes of glass so that the airflow, *F*, is divided equally between the two gaps.

The convective heat gain to the zone air due to the airflow through the two gaps when the airflow destination is indoor air is

<div>$${q_v} = \dot m({C_{p,ave,out}}{T_{gap,ave,out}} - {C_{p,i}}{T_i}{\rm{)      (W)}}$$</div>

where the average temperature of the two outlet air streams is

<div>$${T_{gap,ave,out}}{\rm{ =  }}({T_{gap,1,out}} + {T_{gap,2,out}})/2$$</div>

and

*C<sub>p,ave,out</sub>*<sub>  </sub> = heat capacity of the outlet air evaluated at *T<sub>gap,ave,out</sub>* (J/kg-K)



![](EngineeringReference/media/image1763.png)

Figure 108. Airflow window with between-glass shading device showing variables used in the heat balance equations.

### Evacuated Glazing Unit (EGU)

Evacuated glazing Units (EGU) are an emerging technology, developed as a concept some 20-30 years ago, but only now approaching wide-spread commercialization and adoption.

#### Evacuated glazing unit (EGU): cavity thermal conductance

Thermal Conductance of the space in an evacuated glazing unit (EGU) is the sum of the conductance of the low pressure gas (air) and radiation conductance.

<div>$${C_{gas}} = {C_{COND}} + {C_{RAD}}$$</div>

**Conductance of the low-pressure gas**

Conductance of low pressure gasses is calculated using formula by Corrucini (Corruccini, R. (1959)).

<div>$${C_{COND}} = \alpha  \cdot \left[ {\frac{{\gamma  + 1}}{{\gamma  - 1}}} \right] \cdot {\left[ {\frac{R}{{8 \cdot \pi  \cdot M \cdot T}}} \right]^{\frac{1}{2}}} \cdot P$$</div>

<div>$$B = \alpha  \cdot \left[ {\frac{{\gamma  + 1}}{{\gamma  - 1}}} \right] \cdot {\left[ {\frac{R}{{8 \cdot \pi  \cdot M \cdot T}}} \right]^{\frac{1}{2}}}$$</div>

<div>$${C_{COND}} = B \cdot P$$</div>

Where:

<div>$$\alpha  = \frac{{{\alpha_1}{\alpha_2}}}{{{\alpha_2} + {\alpha_1}\left( {1 - {\alpha_2}} \right)}}$$</div>

a<sub>1</sub>, a<sub>2</sub> = Accommodation coefficients of the gas molecules with the two surfaces.  These values depend on the temperature, surface conditions, etc.  For the present configuration and conditions, it is expected that *a* is approximately 0.5.  If conservative value is needed than value of 1.0 could be used.  With a<sub>1</sub>, a<sub>2</sub> = 0.5, a = 0.333

g     = Specific heat ratio, g<sub>air</sub> = 1.40.

*R*    = Universal gas constant, *R* = 8,314.462175 J/mol·K

*M*   = Molecular Weight, *M*<sub>air</sub> = 28.97 [mol/g]

*T*    = (*T*<sub>1</sub> + *T*<sub>2</sub>)/2 [K]

*P*    = Pressure of the gas [N/m<sup>2</sup>]

From the paper Collins and Robinson (Collins, R., & Robinson, S. (1991)), B is set at approximately 50 for Air, if pressure is given in torr.  Therefore according to Collins and Robinson, for air and approximate conditions of EGU:

*C*<sub>COND</sub> ≈ 50·P

Where P is in torr (i.e., mm Hg).

*Note: Conversion from Pa to torr is accomplished by multiplying value in torr by 133.28.*

Using formula 2 and assuming *T*<sub>1</sub> to be 20 ºC and *T*<sub>2</sub> to be -18 ºC (expected temperatures of glass surfaces in EGU, if one glass surface is low-e and unit is exposed to NFRC standard environmental conditions), and using SI system of units, the B is calculated as 54.4, which is very close to the value of 50, proposed by Collins and Robinson

*C*<sub>COND</sub> ≈ 54.4·P

We will use exact value, calculated by the formula, so values of will be input into the calculations, which enables more flexible model that can account for special treatment of glass surfaces.

#### Radiation conductance

Radiation conductance for the two parallel plates is given by:

<div>$${C_{RAD}} = \frac{1}{{{\varepsilon_1}^{ - 1} + {\varepsilon_2}^{ - 1} - 1}}\sigma \frac{{\left( {{T_1}^4 - {T_2}^4} \right)}}{{{T_1} - {T_2}}}$$</div>

Where:

e<sub>1</sub>    = emissivity of the first facing glass surface, [ - ]

e<sub>2</sub>    = emissivity of the second facing glass surface, [ - ]

s    = Stefan-Boltzmann Constant, 5.67 x 10<sup>-8</sup>, [W/(m<sup>2</sup>·K<sup>4</sup>)]

T<sub>1</sub>   = Temperature of the first facing glass surface, [K]

T<sub>2</sub>   = Temperature of the second facing glass surface. [K]

Assuming glass surface temperatures of 20 ºC and -18 ºC, respectively, the following radiation conductances are obtained for the three different glass emissivities:

Clear Glass (e<sub>1</sub> = e<sub>2</sub> = 0.84): C<sub>RAD</sub> = 3.4 W/m<sup>2</sup>K

Hard Coat Low-e (e<sub>1</sub> or e<sub>2</sub> = 0.15): C<sub>RAD</sub> = 0.68 W/m<sup>2</sup>K

Soft Coat Low-e (e<sub>1</sub> or e<sub>2</sub> = 0.04): C<sub>RAD</sub> = 0.19 W/m<sup>2</sup>K

***Note:*** *C<sub>RAD</sub> of 0.09 is theoretically possible using best low-e technology today (i.e.,* *e<sub>1</sub> or* *e<sub>2</sub> = 0.02).*

***Note:*** *Low-e values above are typical values, which will vary by manufacturer.  Some more recent hard coat low-e values are at or below 0.1.*

It should also be noted that values above are based on the fix set of temperatures, while in reality temperatures will depend on the environmental conditions and surface emissivities (e.g., it cannot be expected that clear glass will have same *T<sub>1</sub>* and *T<sub>2</sub>* as low-e glass).

Equation is precise formulation for two parallel plates at the constant temperature.  Simplified equation under these conditions is given in the form of:

<div>$${C_{RAD}} = 4\sigma \frac{1}{{{\varepsilon_1}^{ - 1} + {\varepsilon_2}^{ - 1} - 1}}{T_m}^3$$</div>

Where:

*T<sub>m</sub>* =           mean temperature, [K]

<div>$${T_m} = \frac{{\left( {{T_1} + {T_2}} \right)}}{2}$$</div>

Calculation of the U-factor

<div>$$U = \frac{1}{{{R_{tot}}}} = \frac{1}{{{R_o} + 2 \cdot {R_{glass}} + {R_{gap}} + {R_i}}}$$</div>

<div>$${R_{gap}} = \frac{1}{{{C_{gap}}}} = \frac{1}{{{C_{COND}} + {C_{RAD}}}}$$</div>

<div>$${R_{glass}} = \frac{{{t_{glass}}}}{{{k_{glass}}}}$$</div>

Where:

*t*<sub>glass</sub> = glass thickness; [m]

*k*<sub>glass</sub> = glass conductivity; *k*<sub>glass</sub> = 1 W/(m·K)

*R*<sub>glass</sub> = 0.003 m<sup>2</sup>K/W (for 3 mm glass pane)

*R*<sub>o</sub> ≈ 0.033 m<sup>2</sup>K/W

*R*<sub>i</sub> ≈ 0.14 m<sup>2</sup>K/W

U-factor of EGU without any pillars (pretending that this is possible) would be calculated using *C*<sub>RAD</sub> only.  From above radiation conductance calculations:

*Clear Glass:            U = 2.64 W/(m<sup>2</sup>·K) [0.464 Btu/(hr·ft<sup>2</sup>·ºF)]*

*Hard Coat Low-e:     U = 0.62 W/(m<sup>2</sup>·K) [0.109 Btu/(hr·ft<sup>2</sup>·ºF)]*

*Soft Coat Low-e:      U = 0.19 W/(m<sup>2</sup>·K) [0.034 Btu/(hr·ft<sup>2</sup>·ºF)]*

Adding conductance of the air at 0.001 torr (*C*<sub>COND</sub> = 0.08 W/(m<sup>2</sup>·K), these values become:

*Clear Glass:            U = 2.66 W/(m<sup>2</sup>·K) [0.468 Btu/(hr·ft<sup>2</sup>·ºF)]*

*Hard Coat Low-e:     U = 0.68 W/(m<sup>2</sup>·K) [0.120 Btu/(hr·ft<sup>2</sup>·ºF)]*

*Soft Coat Low-e:      U = 0.27 W/(m<sup>2</sup>·K) [0.048 Btu/(hr·ft<sup>2</sup>·ºF)]*

In contrast, the U-factor of the same configuration with the air at atmospheric pressure will be (For the space width of 50 mm, C<sub>COND</sub> ≈ 450 W/m<sup>2</sup>K):

*Clear Glass:            U = 5.52 W/(m<sup>2</sup>·K) [0.468 Btu/(hr·ft<sup>2</sup>·ºF)]*

*Hard Coat Low-e:     U = 5.52 W/(m<sup>2</sup>·K) [0.120 Btu/(hr·ft<sup>2</sup>·ºF)]*

*Soft Coat Low-e:      U = 5.52 W/(m<sup>2</sup>·K) [0.048 Btu/(hr·ft<sup>2</sup>·ºF)]*

It is clear that emissivity of the glass surface makes no difference, because of the dominant conductance of the air space.  Also, it is worth noting that the U-factor of such configuration is very close to the U-factor of single glazing.

#### Evacuated glazing unit (EGU): Glass support element thermal conductance

Glass panes in the EGU are separated by an array of small support elements.  Typically, these support elements have a cylindrical shape and are often referred to as “pillars.”  Typical geometry of the pillar is 0.5-1.0 mm diameter and 0.05 mm (50 mm) height.  They are typically spaced 1-2 in. apart in a form of square or staggered matrix.

#### Calculation of the U-factor

The conductance of these elements can be measured or numerically modeled to determine accurate thermal performance.  Approximate method also exists and is based on the combination of modeling and analytical work for the conduction through small cylinders in contact with infinite parallel plates with thickness much larger than cylinder height.

The following formula can be used to determine conductance of the single pillar, *C*<sub>p</sub> (Collins and Fisher-Cripps 1991):

<div>$${C_p} = \frac{{2ka}}{{1 + \frac{{2h}}{{\pi a}}}}$$</div>

Where:

*k*    = conductivity of glass, W/(m·K)

*a*    = radius of the pillar (m)

*h*    = pillar height, m

For the square array of support pillars (Collins and Fischer-Cripps 1991) proposes the following formula for their conductance, *C*<sub>pa</sub>:

<div>$${C_{pa}} = \frac{{2ka}}{{{\lambda ^2}\left( {1 + \frac{{2h}}{{\pi a}}} \right)}}$$</div>

Where:

l    = pillar spacing, m

This formula is approximate and does not include effect of the conductivity of the pillar, but it gives good approximation for common materials used in this technology, since conductivity of the pillar does not play substantial role for non-insulating pillars (where “non-insulating” would mean that conductivity of the pillar is equal or higher than the conductivity of the glass pane.

The U-factor of the EGU with support pillars is then:

<div>$$U = \frac{1}{{{R_{tot}}}} = \frac{1}{{{R_o} + 2 \cdot {R_{glass}} + {R_{gap}} + {R_i}}}$$</div>

Where:

<div>$${R_{gap}} = \frac{1}{{{C_{gap}}}} = \frac{1}{{{C_{COND}} + {C_{RAD}} + {C_{pa}}}}$$</div>

#### References

Collins, R., & Fischer-Cripps, A. 1991. "Design of Support Pillar Arrays in Flat Evacuated Windows.". Aust. J. Phys.

Collins, R., & Robinson, S. 1991. *"Evacuated Glazing".* Solar Energy. Vol. 47, No. 1, pp. 27-38.

Corruccini, R. 1959. "Gaseous Heat Conduction at Low Pressures and Temperatures". Vacuum. Vol. 7-8, pp.19-29.

### Thermal Performance of Deflected Insulated Glazing Unit (IGU)

#### Introduction

Deflection of insulated glazing unit (IGU) can result in thermal performance degradation or improvement due to the reduction or increase of gap space width. Convection of the gas fill is affected by changed gap space and due to modified convection pattern and shorter or longer thermal path at the center of the glazing unit can result in increased or decreased thermal performance. For the most part, U-factor is mostly affected as a direct result of changed thermal performance; however note that solar heat gain through the window (SHGC) can also be affected because of the effect of inward flowing fraction of absorbed solar radiation, which is affected by thermal performance of the IGU.

Deflection in sealed IGU is caused by the difference in gas pressure in IGU gap vs. outdoor/indoor pressure. Indoor and outdoor pressure can be considered equal, since indoor building environment is in pretty good contact with outdoor environment. We will call this pressure an atmospheric pressure, *P<sub>a</sub>*. The differences in pressure between atmospheric and gap pressure is due to several factors, listed here:

1)   Difference in atmospheric pressure between IGU fabrication location and end use location

2)   Difference in temperature during fabrication and actual operating conditions for the glazing. It should be noted that initial temperature can be higher than ambient temperature during fabrication process, due to elevated sealant temperatures, which can raise local temperatures within the IGU.

3)   Unbalanced gas fill leakage through the sealants, resulting in lower gap pressure and inward deflection.

4)   Wind or static load pressure

Effects 1 and 2 will be modeled using equations presented below, while effect 3 does not have credible mathematical model. However, cumulative deflection, resulting from all three effects can be measured in the field and its effect on thermal performance can be modeled by specifying center glazing deflection.

Wind or static load pressure effects on deflection is not included in this model at this time, but will be considered for future versions.

Recognizing that indoor and outdoor air pressure could be different, such as in hot box test environment, future plans for the extension of the model will include option to specify different values for indoor and outdoor pressure. Another future improvement to the model will also include linking certain air gaps with indoor or outdoor environment, meaning that respective pressures in linked spaces will be set to equal.

#### Mathematical Model

Mathematical model described in detail here is based on the research work by Bernier and Bourret (1997) and Timoshenko and Woinowsky-Krieger (1959). Bernier and Bourret (1997) of the Ecole Polytechnique Montréal adopted Timoshenko and Woinowsky-Krieger (1959) model for calculating flat plate deflection subjected to the differential pressure field (static), while their original contribution was to develop correlations for changes in thermal performance, based on IGU deflection at the center of glazing location. In addition to adopting Bernier and Bourret (1997) model here, we have also developed model for calculating change in thermal performance of deflected units when this deflection is measured in the field. Therefore, the mathematical formulation, presented here is divided into two sections; 1) calculation of the deflection and resulting thermal performance caused by pressure and temperature effects and 2) calculation of the thermal performance of the IGU when the deflection is measured.

#### Calculation of the deflection and thermal performance caused by pressure and temperature effects

If coordinate system is set as shown in Figure 109 and Figure 110, it is possible to calculate deflection distribution at each point of pane by using following equation:

![](EngineeringReference/media/image1779.png)

Figure 109. Deflection Coordinate System - 2D

<div>$${L_{D\left( i \right)}}\left( {x,y} \right) = \frac{{16\cdot \Delta {P_{\left( i \right)}}}}{{{\pi ^6}\cdot {D_{\left( i \right)}}}}\mathop \sum \limits_{m = 1,3,5 \ldots }^\infty  \mathop \sum \limits_{n = 1,3,5 \ldots }^\infty  \frac{{\sin \frac{{m\pi x}}{W}\sin \frac{{n\pi y}}{H}}}{{mn{{\left( {{{\left( {\frac{m}{W}} \right)}^2} + {{\left( {\frac{n}{H}} \right)}^2}} \right)}^2}}}$$</div>

Where,

<div>$${D_{\left( i \right)}} = \frac{{E\cdot t_{\left( i \right)}^3}}{{12\cdot \left( {1 - {\nu ^2}} \right)}}$$</div>

Where,

*E* = Young’s modulus (7.2 x 10<sup>10</sup>) [Force per unit Area; SI: Pa, IP: psi]

*t* = thickness of glazing pane [Length; SI: m, IP: in.]

n = poison’s ratio (0.22 for glass) [Non-Dimensional]



![](EngineeringReference/media/image1782.png)

Figure 110. Deflection Coordinate System - 3D

Δ*P<sub>i</sub>* = *P<sub>gap(i)</sub>* - *P<sub>gap(i-1)</sub>* (for i-th pane) [Force per unit Area; SI: Pa, IP: psi]

Δ*P<sub>i</sub>* = *P<sub>gap(1)</sub>* - *P<sub>a</sub>* (first pane) [Force per unit Area; SI: Pa, IP: psi]*                  *

Δ*P<sub>i</sub>* = *P<sub>a</sub> - P<sub>gap(n-1)</sub>* (last pane) [Force per unit Area; SI: Pa, IP: psi]

Where,

*P<sub>a</sub> =* atmospheric pressure. [Force per unit Area; SI: Pa, IP: psi]

<div>$${P_{gap\left( i \right)}} = \frac{{{P_{ini}}{V_{ini\left( i \right)}}{T_{gap\left( i \right)}}}}{{{T_{ini}}{V_{gap\left( i \right)}}}}$$</div>

Where,

*P<sub>ini</sub>* = Initial pressure. Applies to all gaps as a single value (input data - measured or otherwise) [Force per unit Area; SI: Pa, IP: psi]

*T<sub>ini</sub>* = Initial temperature. Applies to all gaps as a single value (input data - measured or otherwise) [Degree Temperature; SI: K, IP: R]

*V<sub>ini(i)</sub>* = Initial volume for i-th gap. [Length\*Length\*Length; SI: m<sup>3</sup>, IP: in<sup>3</sup>]

<div>$${V_{ini\left( i \right)}} = {L_i}\cdot W\cdot H$$</div>

Where,

*L<sub>i</sub>* = non-deflected glazing gap width (for i-th gap) [Length; SI: m, IP: in.]

*W* = IGU width [Length; SI: m, IP: in.]

*H* = IGU height [Length; SI: m, IP: in.]

*T<sub>gap(i)</sub>* = temperature of the gap between two glass panes (calculated using center of glazing thermal calculation algorithm, as described in ISO 15099 (ISO 2003). This value is first calculated using non-deflected state and is recalculated after the resulting deflection is calculated. This process is repeated until temperature at next iteration does not differ by more than 0.1 ºC

*V<sub>gap(i)</sub>* = volume of the IGU gap in deflected state [Lentgh\*Length\*Length; SI: m<sup>3</sup>, IP: in<sup>3</sup>]

<div>$${V_{gap\left( i \right)}} = {V_{ini\left( i \right)}} + W\cdot H\cdot \left( {\overline {{L_{D,i}}}  - \overline {{L_{D,i + 1}}} } \right)$$</div>

Where,

<span>$\overline {{L_{D,i}}} $</span> is mean deflection value for i-th pane. [Length; SI: m, IP: in.]

Deflection of each pane can be positive or negative and is done solely to establish reference. Current frame of reference is that positive deflection means that pane is deflecting towards left side, while negative deflection means that pane is deflecting towards right side . Whether the deflection is in the direction of reducing the gap width or increasing it, it will be the result of pressure difference, as described in . When pressure in the glazing unit is higher than surrounding environmental pressure, the deflection will be towards increasing gap width (i.e., ballooning), while the opposite situation will result in decreasing gap width (i.e., vacuuming)

![](EngineeringReference/media/image1787.png)

Figure 111. Deflection Direction Convention

The important part of calculating deflection of the IGU is to determine mean deflection value for each glazing pane. Mean deflection value is used to calculate gap volume in deflected state . Mean deflection of glazing pane can be calculated by integrating :

<div>$$\overline {{L_{D\left( i \right)}}}  = \mathop \smallint \limits_{x = 0}^W \mathop \smallint \limits_{y = 0}^H \frac{{16\cdot \Delta {P_{\left( i \right)}}}}{{{\pi ^6}\cdot {D_{\left( i \right)}}}}\mathop \sum \limits_{m = 1,3,5 \ldots }^\infty  \mathop \sum \limits_{n = 1,3,5 \ldots }^\infty  \frac{{\sin \frac{{m\pi x}}{W}\sin \frac{{n\pi y}}{H}}}{{mn{{\left( {{{\left( {\frac{m}{W}} \right)}^2} + {{\left( {\frac{n}{H}} \right)}^2}} \right)}^2}}}$$</div>

Which is identical with the following expression:

<div>$$\overline {{L_{D\left( i \right)}}}  = \frac{{16\cdot \Delta {P_{\left( i \right)}}}}{{{\pi ^6}\cdot {D_{\left( i \right)}}}}\mathop \sum \limits_{m = 1,3,5 \ldots }^\infty  \mathop \sum \limits_{n = 1,3,5 \ldots }^\infty  \frac{{\mathop \smallint \nolimits_{x = 0}^W \mathop \smallint \nolimits_{y = 0}^H \sin \frac{{m\pi x}}{W}\sin \frac{{n\pi y}}{H}}}{{mn{{\left( {{{\left( {\frac{m}{W}} \right)}^2} + {{\left( {\frac{n}{H}} \right)}^2}} \right)}^2}}}$$</div>

and because integral of sin(x) is equal with –cos(x), above equation will become:

<div>$$\overline {{L_{D\left( i \right)}}}  = \frac{{16\cdot \Delta {P_{\left( i \right)}}}}{{{\pi ^6}\cdot {D_{\left( i \right)}}}}\mathop \sum \limits_{m = 1,3,5 \ldots }^\infty  \mathop \sum \limits_{n = 1,3,5 \ldots }^\infty  \frac{{\left( {1 - cos\left( {m\pi } \right)} \right)\left( {1 - cos\left( {n\pi } \right)} \right)}}{{mn{{\left( {{{\left( {\frac{m}{W}} \right)}^2} + {{\left( {\frac{n}{H}} \right)}^2}} \right)}^2}}}$$</div>

Finally, because <span>$cos\left( {m\pi } \right)$</span> and <span>$cos\left( {n\pi } \right)$</span> values are always equal to -1 for the given range of m and n, above equation will became:

<div>$$\overline {{L_{D\left( i \right)}}}  = \frac{{16\cdot \Delta {P_{\left( i \right)}}}}{{{\pi ^6}\cdot {D_{\left( i \right)}}}}\mathop \sum \limits_{m = 1,3,5 \ldots }^\infty  \mathop \sum \limits_{n = 1,3,5 \ldots }^\infty  \frac{4}{{{m^2}{n^2}{\pi ^2}{{\left( {{{\left( {\frac{m}{W}} \right)}^2} + {{\left( {\frac{n}{H}} \right)}^2}} \right)}^2}}}$$</div>

After calculating mean pane deflection the following equation is used to calculate mean gap width:

<div>$${L_{r\left( i \right)}} = L + \left( {\overline {{L_{D,\left( i \right)}}}  - \overline {{L_{D,\left( {i + 1} \right)}}} } \right)$$</div>

*Where,*

*L<sub>r(i)</sub> = Mean gap “i” width after incorporating glazing deflection. This mean gap width is used to recalculate thermal performance of deflected IGU.*

<span>$\overline {{L_{D,i}}} $</span>*** ****= mean glazing deflection for each pane “i”.*

Calculation of the deflection at the center of glazing and mean glazing deflection for each pane is an iterative process, where the initial temperature distribution is calculated for non-deflected state, then deflection is calculated based on this temperature distribution, new temperature distribution is calculated for this deflected state, then temperatures from previous iteration are compared to the current iteration and the process is repeated until the difference is no larger than 0.1 ºC.

At the end of calculations, program will calculate and return maximum deflection value for each pane (i.e., center of glazing deflection). If we label maximum deflection of each pane as *L<sub>D(i),max</sub>*, we can calculate this value by substituting *x*=*W*/2 and *y*=*H*/2 in equation to determine deflection at the center point. Therefore,

<div>$${L_{D\left( i \right),max}} = \frac{{16\cdot \Delta {P_{\left( i \right)}}}}{{{\pi ^6}\cdot {D_{\left( i \right)}}}}\mathop \sum \limits_{m = 1,3,5 \ldots }^\infty  \mathop \sum \limits_{n = 1,3,5 \ldots }^\infty  \frac{{\sin \frac{{m\pi }}{2}\sin \frac{{n\pi }}{2}}}{{mn{{\left( {{{\left( {\frac{m}{2}} \right)}^2} + {{\left( {\frac{n}{2}} \right)}^2}} \right)}^2}}}$$</div>

For glazing systems with more than two glazing layers, meaning multiple gas filled gaps, the deflection will be calculated for each glazing pane assuming that the pressure in a gap is independent from each other and calculated separately, unless spaces are “linked” together (e.g., stretched film middle glazing that has hole for equalizing pressure).

#### Non-Linked Gaps in 3 or more glazing layer system:

The procedure shown above generally applies to the 3 or more layer glazing system, with the exception that neighboring pressures are no longer *P<sub>a</sub>*, but rather could be *P<sub>a</sub>* on one side and *P<sub>gap</sub>* on the other, or have *P<sub>gap</sub>* on both sides, as shown in Figure 111 for gap “*i*”. Center of glazing thermal calculation will determine new temperature distribution, after deflection is calculated for each glazing and will be used to determine new *P<sub>gap</sub>*, as per the procedure above.

#### Linked Gaps in 3 or more glazing layer system:

When one or more gaps are linked together, their pressure is assumed to be identical (e.g., in triple glazing IGU *P<sub>gap,1</sub>* = *P<sub>gap,2</sub>*.)  This pressure is calculated from temperatures of bounding glazing for linked gaps (e.g., for triple glazing IGU, glazing 1 and 3) and using neighboring pressures outside of those bounding glazing (e.g., for triple glazed IGU, *P<sub>a</sub>* on both sides).

*Note: This feature is not implemented in WINDOW 7.1. It is considered for future enhancements to the program.*

#### Gap(s) Linked to Indoor or Outdoor Environment:

If one or more glazing gaps are linked to either indoor or outdoor environment its pressure is fixed to *P<sub>a</sub>*. In combination situations, such as two or more gaps linked together with one of them being linked to indoor or outdoor environment, they will all have fixed pressure of *P<sub>a</sub>*.

#### Calculation of the thermal performance caused by measured deflection

When deflection is measured, it is normally measured at the point of maximum deflection. Maximum deflection occurs at center of the IGU (at *W*/2 and *H*/2).

Measured value is typically gap width at the point of maximum deflection, which we can label *L<sub>G(i)</sub>*. For i-th measured gap the width is equal to:

<div>$${L_{G\left( i \right)}} = {L_{\left( i \right)}} + \left( {{L_{D\left( i \right),max}} - {L_{D\left( {i + 1} \right),max}}} \right)$$</div>

![](EngineeringReference/media/image1798.png)

Figure 112. Sketch of the non-symetrically Deflected Glazing Panes

If we label ratio of mean deflection and maximum deflection as R<sub>(i)</sub>, then:

<div>$${R_{(i)}} = \frac{{\overline {{L_{D(i)}}} }}{{{L_{D(i)}}_{,\max }}} = \sum\limits_{m = 1,3,5,...}^\infty  {\sum\limits_{n = 1,3,5,...}^\infty  {\frac{4}{{{m^2}{n^2}{\pi ^2}{{\left( {{{(\frac{m}{W})}^2} + {{(\frac{n}{H})}^2}} \right)}^2}}}} } $$</div>

<span>$$</span>Important thing to note is that ratios (<span>${R_{\left( i \right)}}$</span>) for all gaps in glazing system are equal.

<div>$${R_{\left( 1 \right)}} = {R_{\left( 2 \right)}} =  \ldots  = {R_{\left( i \right)}} =  \ldots  = {R_{\left( {n - 1} \right)}} = R$$</div>

Replacing and into the following equation is obtained:

<div>$${L_{r\left( i \right)}} = {L_{\left( i \right)}} + R\left( {{L_{D\left( i \right),max}} - {L_{D\left( {i + 1} \right),max}}} \right)$$</div>

Combining with we get the following expression for the mean gap width:

<div>$${L_{r\left( i \right)}} = {L_{\left( i \right)}} + R\left( {{L_{G\left( i \right)}} - {L_{\left( i \right)}}} \right)$$</div>

Number of equations given in expression is equal to n-1, where n is number of panes. Therefore, we need one more equation to complete the system of equations that would allow us to solve for all independent variables. To get the last equation we can rewrite in slightly different manner:

<div>$${L_{D\left( i \right),max}} = \frac{{\Delta {P_{\left( i \right)}}}}{{{D_{\left( i \right)}}}}\cdot K$$</div>

Where coefficient K combines all constant terms, while <span>${D_{\left( i \right)}}$</span> is given by and <span>$\Delta {P_{\left( i \right)}}$</span> is calculated by, and . Summing over all deflections, <span>${L_{D\left( i \right),max}}$</span> the following equation is obtained:

<div>$$\mathop \sum \limits_{i = 1}^n \frac{{{D_{\left( i \right)}}}}{K}\cdot {L_{D\left( i \right),max}} = \mathop \sum \limits_{i = 1}^n \Delta {P_{\left( i \right)}} = 0$$</div>

Note that sum of all <span>$\Delta {P_{\left( i \right)}}$</span> is equal to zero since outside pressure is equal to inside. Therefore, the remaining equation that completes the set of equations is:

<div>$$\mathop \sum \limits_{i = 1}^n {D_{\left( i \right)}}\cdot {L_{D\left( i \right),max}} = 0$$</div>

#### Solving system of equations

In order to solve system of equations we will present in slightly different manner:

<div>$$0 = {L_{\left( i \right)}} - {L_{G\left( i \right)}} + {L_{D\left( i \right),max}} - {L_{D\left( {i + 1} \right),max}}$$</div>

Which in developed form will look like this:

<div>$$0 = {L_{\left( 1 \right)}} - {L_{G\left( 1 \right)}} + {L_{D\left( 1 \right),max}} - {L_{D\left( 2 \right),max}}$$</div>

<div>$$0 = {L_{\left( 2 \right)}} - {L_{G\left( 2 \right)}} + {L_{D\left( 2 \right),max}} - {L_{D\left( 3 \right),max}}$$</div>

<div>$$0 = {L_{\left( i \right)}} - {L_{G\left( i \right)}} + {L_{D\left( i \right),max}} - {L_{D\left( {i + 1} \right),max}}$$</div>

<div>$$0 = {L_{\left( {n - 1} \right)}} - {L_{G\left( {n - 1} \right)}} + {L_{D\left( {n - 1} \right),max}} - {L_{D\left( n \right),max}}$$</div>

In order to express each <span>${L_{D\left( i \right),max}}$</span> as dependence from <span>${L_{D\left( n \right),max}}$</span> (deflection of inside/last pane) we will need to make sum from first to last, then from second to last, third to last and so on. This procedure will create following set of equations:

<div>$${L_{D\left( 1 \right),max}} = \mathop \sum \limits_{k = 1}^{k = n - 1} \left( {{L_{G\left( k \right)}} - {L_{\left( k \right)}}} \right) + {L_{D\left( n \right),max}}$$</div>

<div>$${L_{D\left( 2 \right),max}} = \mathop \sum \limits_{k = 2}^{k = n - 1} \left( {{L_{G\left( k \right)}} - {L_{\left( k \right)}}} \right) + {L_{D\left( n \right),max}}$$</div>

<div>$${L_{D\left( i \right),max}} = \mathop \sum \limits_{k = i}^{k = n - 1} \left( {{L_{G\left( k \right)}} - {L_{\left( k \right)}}} \right) + {L_{D\left( n \right),max}}$$</div>

<div>$${L_{D\left( {n - 1} \right),max}} = \mathop \sum \limits_{k = n - 1}^{k = n - 1} \left( {{L_{G\left( k \right)}} - {L_{\left( k \right)}}} \right) + {L_{D\left( n \right),max}}$$</div>

Now replacing this set of equations back to :

<div>$$\mathop \sum \limits_{i = 1}^{n - 1} {D_{\left( i \right)}}\cdot \left( {\mathop \sum \limits_{k = i}^{k = n - 1} \left( {{L_{G\left( k \right)}} - {L_{\left( k \right)}}} \right) + {L_{D\left( n \right),max}}} \right) + {D_{\left( n \right)}}\cdot {L_{D\left( n \right),max}} = 0$$</div>

Which solving by <span>${L_{D\left( n \right),max}}$</span> leads to the following equation:

<div>$${L_{D\left( n \right),max}} = \frac{{\mathop \sum \nolimits_{i = 1}^{n - 1} ({D_{\left( i \right)}}\cdot \mathop \sum \nolimits_{k = i}^{k = n - 1} \left( {{L_{\left( k \right)}} - {L_{G\left( k \right)}}} \right))}}{{\mathop \sum \nolimits_{i = 1}^n {D_{\left( i \right)}}}}$$</div>

Calculating <span>${L_{D\left( n \right),max}}$</span> value from this equation and substituting it in will enable calculation of the deflection of remaining panes.

#### References

Arasteh, D.K., J.C. Kohler and B.T. Griffith. Draft 2009. Modeling Windows in EnergyPlus with only U, SHGC, and optionally VT. LBNL report.  Full reference to be determined.

Arasteh, D. J. 2009. Modeling Windows in EnergyPlus with only U, SHGC, and optionally VT. Lawrence Berkeley National Laboratory.

Arasteh, D.K., M.S. Reilly and M.D. Rubin. 1989. A versatile procedure for calculating heat transfer through windows. American Society of Heating, Refrigeration and Air-Conditioning Engineers, ASHRAE Transactions, Vol. 95, Pt. 2.

Bernier, M., & Bourret, B. January 1997. "Effects of Glass Plate Curvature on the U-Factor of Sealed Insulated Glazing Units". Atlanta, GA: ASHRAE Transactions. Vol. 103, Pt. 1. American Society for Heating, Refrigerating and Air-Conditioning Engineers.

Collins, R., & Fischer-Cripps, A. 1991. "Design of Support Pillar Arrays in Flat Evacuated Windows.". Aust. J. Phys.

Collins, R., & Robinson, S. 1991. "Evacuated Glazing". Solar Energy. Vol. 47, No. 1, pp. 27-38.

Corruccini, R. (1959). "Gaseous Heat Conduction at Low Pressures and Temperatures". Vacuum. Vol. 7-8, pp.19-29.

Finlayson, E.U., D.K. Arasteh, C. Huizenga, M.D. Rubin and M.S. Reilly. 1993. WINDOW 4.0: documentation of calculation procedures. Lawrence Berkeley National Laboratory report no. LBL-33943.

ISO. 2003. ISO 15099:2003. Thermal performance of windows, doors, and shading devices – Detailed calculations. International Organization for Standardization.

Klems, J. H. 1994A. "A New Method for Predicting the Solar Heat Gain of Complex Fenestration Systems: I. Overview and Derivation of the Matrix Layer Calculation.". ASHRAE Transactions. 100 (pt.1): 1073-1086.

Klems, J. H. 1994B. "A New Method for Predicting the Solar Heat Gain of Complex Fenestration Systems: II. Detailed Description of the Matrix Layer Calculation.". ASHRAE Transactions. 100 (pt.1): 1073-1086.

Klems, J. H. 1995. "Measurements of Bidirectional Optical Properties of Complex Shading Devices.". ASHRAE Transactions. 101 (pt 1; Symposium Paper CH-95-8-1 (RP-548)): 791-801.

Klems, J. H. 1996. "A Comparison between Calculated and Measured SHGC for Complex Glazing Systems.". ASHRAE Transactions. 102 (Pt. 1; Symposium Paper AT-96-16-1): 931-939.

Klems, J. H. 1996. "Calorimetric Measurements of Inward-Flowing Fraction for Complex Glazing and Shading Systems.". ASHRAE Trans. 102(Pt. 1; Symposium Paper AT-96-16-3): 947-954.

Munson, B.R, D.F. Young and T.H. Okiishi. 1998. “Fundamentals of Fluid Mechanics,” Third Edition Update, John Wiley & Sons, Inc.

Papamichael, K. J. 1998. "Determination and Application of Bidirectional Solar-Optical Properties of Fenestration Systems.". Cambridge, MA: 13th National Passive Solar Conference.

Simmler, H., U. Fischer and F. Winkelmann. 1996. Solar-Thermal Window Blind Model for DOE-2. Lawrence Berkeley National Laboratory, Simulation Research Group internal report, (unpublished).

Timoshenko, S., & Kreiger-Woinowsky, S. 1959. "Theory of Plates and Shells" 2nd Edition. McGraw-Hill Company.

### Equivalent Layer Fenestration Model

The section describes the equivalent layer fenestration optical and thermal model. The Equivalent Layer fenestration model can have four types of attachments: drapes, venetian blinds, roller blinds and insect screens. In this model shading layers are assumed to be uniform and can be represented by an equivalent homogenous layer that has spatially-averaged "effective" optical and thermal properties (ASHRAE 1311-RP). Likewise, venetian blinds can be characterized using effective optical and thermal properties. When solar radiation strikes a window surface some fraction of the incident solar radiation passes unobstructed through openings in a shading layer and the remaining fraction is intercepted by the structure of the layer. The intercepted radiation is partly absorbed, partly reflected and partly transmitted. These reflected and transmitted components of the scattered solar radiation are assumed to be uniformly diffuse. Shading layers, because of their openness, generally transmit longwave radiation, and the effective infrared properties of shades account for that. Using effective optical properties and a beam/diffuse split of solar radiation at each layer, the equivalent layer approach can represent multi-layer systems. This representation provides virtually unlimited flexibility to combine different types of shading layers in a fenestration. The equivalent layer window model requires a few set of optical data to characterize a particular layer and this set of data is used to calculate effective layer properties. For instance, the effective solar optical properties of a venetian blind can be calculated as a function of slats optical properties and geometry. Also, it is possible to adjust slat angle at each time step in response to the changing angular position of the sun. Moreover, the model provides control strategies as a function of slat angle that can be changed at each time step as needed. Likewise, effective properties of a pleated drape are calculated as a function of fabric properties and a specified value of fullness. The only input data needed to fully characterize drapery fabrics, roller blinds and insect screens are material openness as area fraction, and the transmittance and reflectance at normal incidence. Shade openness area fraction is the same as the beam-beam transmittance at normal incidence. In multilayer fenestration, each layer is separated by a gap. A gap in equivalent layer model is defined by specifying the fill gas and the gap spacing. Currently five gas types are allowed: Air, Argon, Xenon, Krypton and Custom. The convective heat transfer coefficient in a gap is calculated depending on the spacing, the temperatures of the layers and the fill gas properties. Equivalent-layer concept – offers wide range of multiple glazing and shading layers combination and can simulate multi-layer complex fenestration systems. The effective layer properties of venetian blinds, pleated drapes, roller blinds, and insect screens are calculated from geometric layer models and material properties. A set of empirical correlations for estimating off-normal material properties were developed under ASHRAE research project (ASHRAE 1311-RP).

#### The Equivalent Layer Analysis

The equivalent layer windows system is treated as a series of parallel layers separated by gaps as shown in Figure 113. This multi-layer structure has been used in several computer programs and the underlying theory has been documented (ASHRAE 1311-RP).

![](EngineeringReference/media/image1827.svg.png)

Figure 113. Multi-layer fenestration analysis structure (ASHRAE 1311-RP)

Equivalent layer fenestration model uses two-step analysis. First, the flux of absorbed solar radiation at each layer, S<sub>i</sub>, caused by the incident radiation flux, I<sub>sol</sub>, is determined using net radiation analysis. Second, an energy balance is applied at each layer, accounting for heat transfer and the known set of absorbed solar radiations S<sub>i</sub> values, in order to solve for the set of layer temperatures, T<sub>i</sub>, and the corresponding heat fluxes. The fenestration model also accounts for the diathermanous shade layers in the longwave radiant exchange. The latter can be significant for shading layers. Glass is considered opaque with respect to longwave radiation.

#### Equivalent Layer Optical Model

The multilayer optical model is based on an algorithm originally developed by Edwards (1977) and extended by Wright and Kotey (2006). The algorithm models the interaction of incident solar radiation with a glazing system composed of any number of parallel, planar, specular glazing layers. The shading layers scatter portion of the incident solar radiation diffusely, and the model tracks the beam and diffuse components of solar radiation as they interact with a multi-layer system of glazing and shading layers. The conceptual arrangement for tracking beam and diffuse solar flux components is illustrated in Figure 114.

![](EngineeringReference/media/image1828.svg.png)

Analysis yields beam-beam, beam-diffuse and diffuse-diffuse fluxes, providing full detail concerning the quantities of reflected, transmitted and absorbed radiation.

![](EngineeringReference/media/image1829.svg.png)

Figure 114. Solar analysis of the multi-layer glazing/shading system showing beam and diffuse fluxes (ASHRAE 1311-RP)

The beam and diffuse characterization of solar radiation demands an expanded set of solar optical properties (Wright and Kotey 2006). The quantities of interest for single layer are shown inFigure 115.

Where,

*t*     =          transmittance of a glazing or a shading layer, (-)

*r*    =          reflectance of a glazing or a shading layer, (-)

*e*     =          thermal emissivity of a glazing or a shading layer, (-)

*q*    =          incident angle, (degree)

*f*    =          slat angle, (degree)

*W*    =          profile angle, (degree)

*J*    =          radiosity of a layer surface, (W/m2)

*T*    =          temperature of a layer, (C)

Subscripts

*f*     =          front side of a layer

*b*    =          back side of a layer

*bb*   =          beam-beam optical property. Represents a fraction of the beam radiation incident at a given layer and leaves the layer without being scattered.

*bd*   =          beam-diffuse optical property. Represents a fraction of the beam radiation incident at a given layer and leaves the layer diffusely

*dd*   =          diffuse-diffuse optical property. Represents a diffuse radiation incident at a given layer and leaves the layer as diffuse

*i     =         * layer index, (-)

Superscripts

*m*   =          represents material property (e.g., fabric material)

*str*  =          represents an apparent material structure property of roller blinds

*w*    =          represents an apparent wire property

![](EngineeringReference/media/image1830.svg.png)

Figure 115. Twelve solar properties assigned at each layer (ASHRAE 1311-RP)

Each glazing or shading layer, in general, require eleven set of solar properties (Wright and Kotey 2006). Only beam-beam properties are needed for common glazing layers. Each shading layer is represented by a few set of component properties and geometries that are converted to the full set of layer optical and thermal properties by equivalent layer models (ASHRAE 1311-RP). The models also make account for off-normal incidence of solar radiation and can calculate the diffuse component from normal incidence values using numerical integration.

#### Equivalent Layer Thermal Model

A surface energy balance is applied at each layer and the resulting set of equation is solved for layer temperatures and heat transfer fluxes. A schematic drawing of the multi-layer illustration and variables designation is shown in Figure 116. The net radiation formulation based on the radiosities, Jf,i and Jb,i the radiant flux leaving the front and back surfaces of the i<sup>th</sup> layer, respectively, is the used as a solution technique. The net radiant heat flux across a gap can be expressed as the difference between the radiosities of the bounding surfaces. The net radiation model analysis yields the layer temperatures and corresponding heat transfer coefficients that are used to determine U-factor and SHGC. The thermal analysis is done in “ASHWAT\_Thermal” routine.

![](EngineeringReference/media/image1831.svg.png)

Figure 116. Radiosity model used in thermal analysis of the multi-layer glazing/shading system (ASHRAE 1311-RP)

#### Glazing Layer Analysis

The Equivalent-Layer window model allows a wide range of options regarding the selection of glazing layers and gaps combinations. It also allows mixing glazing and shading layers in any sequence. For instance, it allows placing a venetian blind or a roller blind in between glazing layers. Only beam-beam solar properties at normal incidence, infrared transmittance and infrared emissivity are required for common glazing types. Off-normal solar properties at a given sun position are estimated by adjusting the normal incidence values in “ASHWAT\_OffNormalProperties” routine. The model assumes that the ratio between normal and off-normal transmittance is the same for the glazing layer in question and a reference piece of uncoated 6 mm glass with a moderate tint (ASHRAE 1311-RP). A similar procedure is used to convert solar reflectance from normal to off-normal.

#### Gap Layer Analysis

Gaps can be specified as sealed, vented indoors or vented outdoors. The sealed gap is considered as enclosed cavity. Vented gaps is specified for inner and outer most gaps only and when the gas type is AIR. The vented gap model assumes that air flow at the perimeter of the window is not restricted. Any fill gas can be specified by molecular mass and thermo-physical properties of viscosity, specific heat and thermal conductivity. This is done by providing "a", “b” and "c" coefficients of the quadratic equation of the form, p = a + bT + cT<sup>2</sup>, where the T (K) is temperature and p is the property being evaluated. EnergyPlus has builtin-data available for common fill gas components including Air, Argon, Krypton and Xenon. Users specify CUSTOM gas by defining the coefficients as an input.

#### Shade Layer Analysis

Equivalent layer fenestration model has a complete set of solar and longwave models for the four shading layer types: drapes, venetian blinds, roller blinds and insect screens developed under ASHRAE 1311-RP. And semi-empirical models are used to evaluate the off-normal properties of drape, roller blind and insect screen materials. The effective layer properties of venetian blinds and the effect of pleating in drapes are determined using a more fundamental net radiation scheme. The openness fraction, A<sub>o</sub> and beam-beam solar transmittance at normal incidence, *t*<sub>bb</sub> (q=0) really represent a geometric quantity and it has been confirmed that they can be used interchangeably (ASHRAE 1311-RP). Openness is simply the fraction of a material, by area, that is open. In equivalent layer fenestration model, beam-beam transmittance at normal incidence (i.e., openness fraction), beam-diffuse transmittance and reflectance at normal incidence are required to characterize drapery fabric, roller blind and insect screen material. A conventional venetian blind in equivalent layer model can be characterized by specifying the geometry, solar reflectance and transmittance, and emissivity of the slats. The off-normal solar properties of drape, roller blind and insect screen materials were formulated based on measurements (ASHRAE 1311-RP). The longwave properties of the of the drape fabrics, roller blinds and insect screens can be calculated from the material emissivity and openness of the fabric (ASHRE 1311-RP). The optical model development for venetian blinds is presented by Yahoda and Wright (2004 and 2005), and Kotey et al. (2008).

#### Drapes and Curtains

The off-normal optical properties of drapery fabric is determined from user specified optical properties at normal incidence (q=0) using empirical correlations (Kotey et al., 2009a). The input data required to characterize drapery fabric are the beam-beam transmittance of the material at normal incidence *t*<sub>bb</sub> (q=0) = Ao, the beam-diffuse transmittance of the material at normal incidence*t*<sub>bd</sub> (q=0), and the beam-diffuse (total) reflectance of the materialr<sub>bt</sub> (q=0). The off-normal properties are calculated as follows.

Off-normal Transmittance:

<div>$${\rm{\tau }}_{{\rm{bb}}}^{\rm{m}}\left( {\rm{\theta }} \right) = {\rm{\tau }}_{{\rm{bb}}}^{\rm{m}}{\rm{(\theta }} = {\rm{0)}} \cdot {\rm{co}}{{\rm{s}}^{\rm{b}}}\left( {\rm{\theta }} \right)$$</div>

<div>$${\rm{\tau }}_{{\rm{bt}}}^{\rm{m}}\left( {\rm{\theta }} \right) = {\rm{\tau }}_{{\rm{bt}}}^{\rm{m}}{\rm{(\theta }} = {\rm{0)}} \cdot {\rm{co}}{{\rm{s}}^{\rm{b}}}\left( {\rm{\theta }} \right)$$</div>

<div>$${\rm{b}} = {\left[ {\; - 0.5 \cdot \ln \;\left( {\;{{\left[ {{\rm{\tau }}_{{\rm{bb}}}^{\rm{m}}{\rm{(\theta }} = {\rm{0)}}\;{\rm{,}}\;\;{\rm{0}}{\rm{.01}}} \right]}^{\;\max }}\;} \right)\;\;,\;\;0.35\;} \right]^{\;\max }}$$</div>

<div>$${\rm{b}} = {\left[ {\; - 0.5 \cdot \ln \;\left( {\;{{\left[ {{\rm{\tau }}_{{\rm{bt}}}^{\rm{m}}{\rm{(\theta }} = {\rm{0)}}\;{\rm{,}}\;\;{\rm{0}}{\rm{.01}}} \right]}^{\;\max }}\;} \right)\;\;,\;\;0.35\;} \right]^{\;\max }}$$</div>

<div>$${\rm{\tau }}_{{\rm{bt}}}^{\rm{m}}\left( {\rm{\theta }} \right) = {\rm{\tau }}_{{\rm{bd}}}^{\rm{m}}\left( {\rm{\theta }} \right) + {\rm{\tau }}_{{\rm{bb}}}^{\rm{m}}\left( {\rm{\theta }} \right)$$</div>

The off-normal reflectance:

<div>$${\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {\rm{\theta }} \right) = {\rm{\rho }}_{{\rm{bd}}}^{\rm{m}}\left( {\rm{\theta }} \right) = {\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right) + \left( {{\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = 9{\rm{0}}^\circ } \right) - {\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right)} \right) \cdot \left( {1 - {\rm{co}}{{\rm{s}}^{{\rm{0}}{\rm{.6}}}}\left( {\rm{\theta }} \right)} \right)$$</div>

<div>$${\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{90}}^\circ } \right) = {\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right) + \left( {{\rm{1}} - {\rm{\rho }}_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right)} \right)\;\left( {\,0.7{{\left( {\;{\rm{\rho }}_{}^{\rm{y}}} \right)}^{\;0.7}}} \right)$$</div>

The apparent yarn reflectance is given by:

<div>$${\rho ^y} = \frac{{\rho_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right)}}{{{\rm{1}} - \tau_{{\rm{bb}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right)}} = \frac{{\rho_{{\rm{bt}}}^{\rm{m}}\left( {{\rm{\theta }} = {\rm{0}}} \right)}}{{{\rm{1}} - {{\rm{A}}_{\rm{o}}}}}$$</div>

The above set of equations for drapery fabrics are used subject to the condition that the solar absorptance of the fabric, at normal incidence, is not less than 1% (ASHRE 1311-RP). The diffuse-diffuse material properties, for Equivalent layer window model, are determined using Rhomberg integration with 32 panels covering the range from q=0 to q=90° (ASHRAE 1311-RP). The subscript “X” stands for either front or back side of the layer.

<div>$$\tau_{{\rm{x,dd}}}^{\rm{m}} = \;\;{\rm{2}}\;\int\limits_{{\rm{\theta }} = {\rm{0}}}^{{\raise0.5ex\hbox{$\scriptstyle {\rm{\pi }}$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle {\rm{2}}$}}} {\tau_{{\rm{x,bt}}}^{\rm{m}}\left( {\rm{\theta }} \right) \cdot {\rm{cos}}\left( {\rm{\theta }} \right) \cdot {\rm{sin}}\left( {\rm{\theta }} \right)} \;{\rm{d\theta }}$$</div>

<div>$$\rho_{{\rm{x,dd}}}^{\rm{m}} = \;\;{\rm{2}}\;\int\limits_{{\rm{\theta }} = {\rm{0}}}^{{\raise0.5ex\hbox{$\scriptstyle {\rm{\pi }}$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle {\rm{2}}$}}} {\rho_{{\rm{x,bt}}}^{\rm{m}}\left( {\rm{\theta }} \right) \cdot {\rm{cos}}\left( {\rm{\theta }} \right) \cdot {\rm{sin}}\left( {\rm{\theta }} \right)} \;{\rm{d\theta }}$$</div>

The above set of equations for drapery fabrics apply to the full range of A<sub>o</sub>, fabric transmittance and fabric reflectance including that falls within the bounds of Keyes' (1967) fabric chart plus sheer fabrics (ASHRAE 1311-RP). The longwave thermal emissivity and thermal transmittances of drapery fabric are calculated using the following correlations and fabric openness fraction (Kotey et al. 2008).

<div>$${\varepsilon ^{\rm{m}}} = {\rm{0}}{\rm{.87}} \cdot \left( {{\rm{1 - }}{{\rm{A}}_{\rm{o}}}} \right)$$</div>

<div>$${\tau ^{\rm{m}}} = {\rm{1}} - {\rm{0}}{\rm{.95}} \cdot \left( {{\rm{1}} - {{\rm{A}}_{\rm{o}}}} \right)$$</div>

The optical and thermal properties determined using the above same sets of equations are equally valid for pleated drape shades (Kotey, et. al., 2009a). For pleated drape, the effective beam-beam and beam-diffuse solar properties are determined by tracking both radiation components, for a given incident angle, and interaction with a fabric pleated rectangular geometry shown in Figure 117. The solar optical properties of the two different pleat planes are evaluated on the basis of the local solar incidence angle. Therefore, the effective layer properties are influenced not just by horizontal solar profile angle, W<sub>H</sub>, but also by incidence angle (ASHRAE 1311-RP).

![](EngineeringReference/media/image1844.svg.png)

Figure 117. Geometry used for Pleated Drape Analysis

The solar diffuse-diffuse and long-wave effective properties of the pleated drape are evaluated using a much simpler net-radiation analysis using conventional shape factors (Kotey, et. al., 2009a). Users can chose and apply the pleated drape model to any fabric and any degree of fullness (ASHRAE 1311-RP).

#### Venetian Blinds

The effective shortwave optical and longwave optical properties of venetian blind layer is estimated using analytical models (Yahoda and Wright 2004, 2005; Kotey et al. 2008). The model requires properties of venetian blind slats and geometry of the slats shown in Figure 1118.

![](EngineeringReference/media/image1845.svg.png)

Figure 1118. Likewise, the effective longwave properties are obtained for the layer knowing longwave properties of the slats.

![](EngineeringReference/media/image1846.svg.png)

Figure 118. Geometry and properties used for venetian blind analysis

The model assumes that venetian blind slats reflect and transmit solar radiation diffusely (ASHRAE 1311-RP). The same assumption is made regarding thermal radiation. The input data required to characterize a venetian blind are: front and back side reflectance and transmittance of the slat, geometry and infrared emissivity and transmittance of the slate. The effective optical properties of the venetian blind are determined by tracking beam and diffuse solar radiation through various interactions with slats positioned at a given slat angle. The model uses simple four-surface model if the slats are fully sunlit and a six-surface model if the slats are partially sunlit (ASHRAE 1311-RP). Slats are assumed to be thin and flat but a correction is applied to account for slat curvature effect (Kotey et al. 2008).

#### Roller Blinds

The off-normal properties of roller-blind are determined from solar properties of roller blind fabric measured at normal incidence (q=0) using correlations (Kotey, et. al., 2009b). The off-normal properties for roller blind shades are calculated using the set equations given below:

<div>$${{\rm{\tau }}_{bb}}\left( {\rm{\theta }} \right) = \left\{ \begin{array}{l}{{\rm{\tau }}_{bb}}{\rm{(\theta }} = {\rm{0)}} \cdot {\rm{co}}{{\rm{s}}^{\rm{b}}}{\kern 1pt} \left( {\frac{{\rm{\theta }}}{{{{\rm{\theta }}_{{\rm{cutoff}}}}}} \cdot \frac{\pi }{2}} \right)\quad \theta  < {\theta_{CutOff}}\\0\quad \quad \quad \theta  \ge {\theta_{CutOff}}\end{array} \right.$$</div>

<div>$${\rm{b}} = {\rm{0}}{\rm{.6}} \cdot {\rm{co}}{{\rm{s}}^{{\rm{0}}{\rm{.3}}}}\left( {{{\rm{A}}_{\rm{o}}} \cdot \frac{{\rm{\pi }}}{{\rm{2}}}} \right)$$</div>

<div>$${{\rm{\theta }}_{{\rm{cutoff}}}} = {\rm{65}}^\circ  + \;\left( {{\rm{90}}^\circ  - {\rm{65}}^\circ } \right) \cdot \left( {{\rm{1}} - {\rm{cos}}\left( {{{\rm{A}}_{\rm{o}}} \cdot \frac{{\rm{\pi }}}{{\rm{2}}}} \right)} \right)$$</div>

<div>$${\rm{\tau }}_{{\rm{bt}}}^{}\left( {\rm{\theta }} \right) = {\rm{\tau }}_{{\rm{bt}}}^{}{\rm{(\theta }} = {\rm{0)}} \cdot {\rm{co}}{{\rm{s}}^{\rm{b}}}{\kern 1pt} \left( {\rm{\theta }} \right)$$</div>

<div>$$
  b = \left\{ 
    \begin{array}{lc}
      0.133 \cdot \left( \rm{\tau}^{str} + 0.003 \right)^{-0.467} &\text{if} \left( 0 \le \rm{\tau}^{str} \le 0.33 \right) \\
      0.33 \cdot \left( 1 - \rm{\tau}^{str} \right)               &\text{if} \left( 0.33 < \rm{\tau}^{str} \le 1 \right)
    \end{array}
  \right.
$$</div>

<div>$${\rm{\tau }}_{}^{{\rm{str}}} = \frac{{{\rm{\tau }}_{{\rm{bt}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right) - {{\rm{\tau }}_{{\rm{bb}}}}\left( {{\rm{\theta }} = {\rm{0}}} \right)}}{{{\rm{1}} - {{\rm{\tau }}_{{\rm{bb}}}}\left( {{\rm{\theta }} = {\rm{0}}} \right)}}$$</div>

<div>$${\rm{\tau bt}}\left( {\rm{\theta }} \right) = {\rm{\tau bd}}\left( {\rm{\theta }} \right) + {\rm{\tau bb}}\left( {\rm{\theta }} \right)$$</div>

The off-normal solar property calculation of roller blind is based on a set of correlations developed from measurement data using samples of commonly used commercially produced roller blind material openness range of 0.0 – 0.14. Thus, these correlations are not applicable for shades with materials openness fraction exceeding 0.20. The mean solar reflectance of a roller blind material was found to be purely diffuse and unaffected by incidence angle and is given by:

<div>$${\rm{\rho }}_{{\rm{bt}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right) = {\rm{\rho }}_{{\rm{bd}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right) = {\rm{\rho }}_{{\rm{bt}}}^{}\left( {\rm{\theta }} \right) = {\rm{\rho }}_{{\rm{bd}}}^{}\left( {\rm{\theta }} \right)$$</div>

The diffuse-diffuse transmittance and reflectance are obtained by Rhomberg numerical integration. The longwave properties of roller blind material determined using the material property and the openness fraction (Kotey et al. 2008) as shown below:

<div>$${\varepsilon ^{{\rm{rb}}}} = {\rm{0}}{\rm{.91}} \cdot \left( {{\rm{1 - }}{{\rm{A}}_{\rm{o}}}} \right)$$</div>

<div>$${\tau ^{{\rm{rb}}}} = {\rm{1}} - {\rm{0}}{\rm{.95}} \cdot \left( {{\rm{1}} - {{\rm{A}}_{\rm{o}}}} \right)$$</div>

#### Insect Screens

The empirical correlations formulated to obtain the effective off-normal solar and longwave properties of insect screens were based on measurements (Kotey et al. (2009a). Insect screen geometry is shown in Figure 119. The calculation of effective solar properties requires a set of properties measured at normal incidence: *t*<sub>bb</sub> (q=0), *t*<sub>bd</sub> (q=0) and *r*<sub>bt</sub> (q=0).

![](EngineeringReference/media/image1857.svg.png)

Figure 119. Geometry used for insect screen analysis

Openness can be determined by optical measurement at normal incidence, A<sub>o</sub>=*t*<sub>bb</sub> (q=0), but in the case of insect screens A<sub>o</sub> can reliably be calculated knowing wire diameter (*d*), and wire spacing (*s*) as follows:

<div>$${A_o} = {\left( {1 - {d \mathord{\left/ {\vphantom {d s}} \right. } s}} \right)^2}$$</div>

The incidence angle beyond which direct beam transmission is cut off, *q*<sub>CutOff</sub>, can also be estimated purely from geometry and is given by:

<div>$${\theta_{CutOff}} = co{s^{ - 1}}\left( {{d \mathord{\left/ {\vphantom {d S}} \right. } S}} \right)$$</div>

The off-normal properties are calculated as follows.

<div>$${\tau_{bb}}\left( {\rm{\theta }} \right) = \left\{ \begin{array}{l}{\tau_{bb}}{\rm{(\theta }} = {\rm{0)}} \cdot {\rm{co}}{{\rm{s}}^{\rm{b}}}\left( {\frac{{\rm{\theta }}}{{{{\rm{\theta }}_{{\rm{cutoff}}}}}} \cdot \frac{\pi }{{\rm{2}}}} \right)\quad {\rm{\theta }} < {{\rm{\theta }}_{{\rm{cutoff}}}}\\0\quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \quad \;\,{\rm{\theta }} \ge {{\rm{\theta }}_{{\rm{cutoff}}}}\end{array} \right.$$</div>

<div>$${\rm{b}} =  - {\rm{0}}{\rm{.45}}\;{\rm{ln}}\;\left( {{\rm{MAX}}\left( {{{\rm{\tau }}_{{\rm{bb}}}}\left( {{\rm{\theta }} = {\rm{0}}} \right){\rm{,}}\;{\rm{0}}{\rm{.01}}} \right)} \right)\; + \;{\rm{0}}{\rm{.1}}$$</div>

<div>$${\rm{\tau }}_{{\rm{bt}}}^{}\left( {\rm{\theta }} \right) = {\rm{\tau }}_{{\rm{bt}}}^{}{\rm{(\theta }} = {\rm{0)}} \cdot {\rm{co}}{{\rm{s}}^{\rm{b}}}\left( {\rm{\theta }} \right)$$</div>

<div>$${\rm{b}} =  - {\rm{0}}{\rm{.65}}\;{\rm{ln}}\;\left( {{\rm{MAX}}\left( {{{\rm{\tau }}_{{\rm{bt}}}}\left( {{\rm{\theta }} = {\rm{0}}} \right){\rm{,}}\;{\rm{0}}{\rm{.01}}} \right)} \right)\; + \;{\rm{0}}{\rm{.1}}$$</div>

<div>$${\rm{\tau }}_{{\rm{bd}}}^{}\left( {\rm{\theta }} \right) = {\rm{\tau }}_{{\rm{bt}}}^{}\left( {\rm{\theta }} \right) - {\rm{\tau }}_{{\rm{bb}}}^{}\left( {\rm{\theta }} \right)$$</div>

<div>$${\rm{\rho }}_{{\rm{bt}}}^{}\left( {\rm{\theta }} \right) = {\rm{\rho }}_{{\rm{bt}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right) + \left( {{\rm{\rho }}_{{\rm{bt}}}^{}\left( {{\rm{\theta }} = 9{\rm{0}}^\circ } \right) - {\rm{\rho }}_{{\rm{bt}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right)} \right) \cdot \left( {1 - {\rm{co}}{{\rm{s}}^{\rm{b}}}\left( {\rm{\theta }} \right)} \right)$$</div>

<div>$${\rm{b}} =  - {\rm{0}}{\rm{.45}}\;{\rm{ln}}\;{\left( {{{\rm{\rho }}^{\rm{w}}}} \right)^{}}$$</div>

<div>$${\rm{\rho }}_{}^{\rm{w}} = \frac{{{\rm{\rho }}_{{\rm{bt}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right)}}{{{\rm{1}} - {\rm{\tau }}_{{\rm{bb}}}^{}\left( {{\rm{\theta }} = {\rm{0}}} \right)}}$$</div>

<div>$${\rho_{{\rm{bt}}}}\left( {{\rm{\theta }} = {\rm{90}}^\circ } \right) = {\rho_{{\rm{bt}}}}\left( {{\rm{\theta }} = {\rm{0}}} \right) + \left( {1 - {\rho_{{\rm{bt}}}}\left( {{\rm{\theta }} = {\rm{0}}} \right)} \right)\;\left( {{\rm{0}}{\rm{.35}}{\rho ^{\rm{w}}}} \right)$$</div>

The diffuse-diffuse material properties are obtained by Rhomberg numerical integration. The longwave properties of insect screen are given by expressions similar those formulated for drapery fabrics, and roller blinds (Kotey et al. 2008) is given by:

<div>$${\varepsilon ^{screen}} = {\varepsilon ^{\rm{w}}} \cdot \left( {{\rm{1  -  }}{{\rm{A}}_{\rm{o}}}} \right)$$</div>

<div>$${\tau ^{{\rm{screen}}}} = {\rm{1 - }}{\tau ^{\rm{w}}} \cdot \left( {{\rm{1  -  }}{{\rm{A}}_{\rm{o}}}} \right)$$</div>

The apparent wire material emissivity can be taken as *e*<sup>w</sup>=0.93 for common insect screens - screens with dark, rough, non-metallic wire surfaces. The corresponding infrared wire material transmittance is *t*<sup>w</sup>=0.98. A lower infrared emissivity can be used for screens constructed with shiny metallic wire. For example, to model stainless-steel wire mesh use *e*<sup>w</sup>=0.32 and *t*<sup>w</sup>=0.81.

#### Integration with Heat Balance Method

The solar model calculations are performed surface by surface following the existing structure of EnergyPlus’s heat balance algorithm. The optical and thermal calculations are performed for each surface at each time step. The thermal model needs to be updated at each time step during the surface heat balance iteration. Thus, window thermal model is invoked during the surface heat balance but only once. This is consistent with the current EnergyPlus’s window model inside surface heat balance iteration scheme. The equivalent layer window thermal model also has internal iteration scheme. The thermal model routine also requires the solar and shortwave radiation flux absorbed by each layer of a fenestration at each time step. The calculation of the absorbed radiation flux is performed using the existing scheme except that the optical properties are calculated by the equivalent layer optical model. The equivalent layer thermal model returns the temperatures and the fluxes at each layer.

#### Equivalent Layer Window Solar Model

The equivalent layer window solar model calculates the transmittance of the window and absorptance of each layer. Separate optical properties calculations are performed for exterior beam and diffuse radiations, and interior diffuse radiation (e.g., lighting and inter-reflected solar gain). The fractions for beam radiations depend on solar incident angle and hence updated for each time step. Diffuse radiation fractions are the same for all time steps unless the shade characteristics are altered; for instance, when the venetian blind slat angle is controlled. Otherwise, the diffuse fractions are constant for a given configuration and time step. The hub of the optical properties calculation routine for Equivalent Layer window model is the routine “ASHWAT\_Solar”. For beam radiation, at each time step, first the normal incidence optical properties are modified for current incident angle. Using the off-normal properties, then the ASHWAT\_Solar routine sets up the coefficient matrix based on the net radiation concept to determine the effective absorptance of each layer and the window transmittance. The total intensity of shortwave radiation absorbed at each layer is determined by multiplying the incident solar radiation, reflected internal solar radiations, and internal shortwave source components by the appropriate absorbed fractions and summing them.

#### Equivalent Layer Window Thermal Model

The equivalent layer thermal model is calculated only once for each time step. But the thermal model has internal iterative solutions scheme. During each time step, the procedure initially assumes that room air and means radiant temperatures are known. The surface heat balance loops through all zone surfaces while invoking the Equivalent Layer thermal model only once for each window surface at the first iteration. The window surfaces temperatures from the first iteration are used to complete the heat balances for the indoor (and implicitly the outdoor) face of each surface iteratively. Once indoor surface temperatures are calculated using the surface heat balance, the zone air temperature can be updated and the loads are predicted. Shaded fenestration in general do not have single inside temperature by virture their long-wave radiation transmittance. The equivalent layer window model accounts for this using effective emissivity of the composite layers derived for each fenestration (ASHRAE 1311-RP) as shown below:

<div>$${\varepsilon ^{eff}} = \sum\limits_{j = 0}^{nl} {\left[ {{\varepsilon_j} \cdot \prod\limits_{k = j{ + 1}}^{nl + {1}} {{\tau_k}} } \right]} $$</div>

where

*e<sup>eff</sup>*   =          composite indoor (room-side) longwave emissivity, (-)

*e<sub>j</sub>    =         * effective emissivity of layer j, (-)

*t<sub>k</sub>    =         * effective infrared transmittance of layer k (*t<sub>nl+1</sub>* = 1)

*nl    =         * number of layers in fenestration system (glazing and shade). Layers are numbered outside to inside (layer 1 is outermost, layer *nl* is innermost).

Each equivalent layer window surafce yields net longwave radiant flux exchanged with the zone surfaces. Net longwave radiation exchange from the window to the zone is recast for a composite surface temperature calculation as follows:

<div>$${T^{eff}} = \sqrt[4]{{\frac{{{Q_{lw}}}}{{\sigma {\varepsilon ^{eff}}}}}} + {T_0}$$</div>

where

*T<sup>eff</sup>*  =          inside surface temperature of the composite layer, °C (°F)

*Q<sub>lw</sub>*  =          infrared radiant gain from zone, W/m2 (Btu/h-ft2)

*s*    =          Stefan-Boltzmann constant, W/m2-K4 (Btu/h-ft2-R4)

*T<sub>0</sub>*   =          Temperature of absolute zero, -273.15 °C (-459.67 °F)

Recalculating effective inside face window temperature may result in extra convection flux. The  “extra” (Other) convective flux is computed; this is the gain in excess of that resulting from the standard surface heat balance model. The net other convection term *QX* calculated below is added to the zone air heat balance (ASHRAE 1311-RP).

<div>$$QX = {Q_{conv}} - hc \cdot ({T^{eff}} - {T_a})$$</div>

Where,

*h<sub>c</sub>   =         * inside convective coefficient of the fenestration, W/m<sup>2</sup>-K (Btu/h-ft<sup>2</sup>-F)

*Q<sub>conv</sub>            =         * total convective heat flux to zone from equivalent layer window thermal model, W/m<sup>2</sup> (Btu/h-ft<sup>2</sup>); includes open-channel gains and impact of inside surface convective coefficient

*T<sub>a</sub>   =         * zone air temperature, °C (°F)

#### References:

Edwards, D.K. 1977. Solar absorption by each element in an absorber-coverglass array, Technical Note, Solar Energy, Vol. 19, pp. 401-402.

Parmelee, G. V., and W. W. Aubele. 1952. The shading of sunlit glass: an analysis of the effect of uniformly spaced flat opaque slats, ASHVE Transactions, Vol. 58, pp. 377-398.

Farber, Erich A.; William A. Smith, C.W. Pennington, John C. Reed. 1963. Theoretical analysis of solar heat gain through insulating glass with inside shading. ASHRAE Transactions, Vol. 69, pp.393-405.

Rheault, S., and E. Bilgen. 1989. Heat transfer analysis in an automated venetian blind system, Journal of Solar Energy, Vol. 111 (Feb.), pp. 89-95.

Pfrommer, P., K. J. Lomas, and C. Kupke. 1996. "Solar Radiation Transport through Slat-Type Blinds: a New Model and its Application for Thermal Simulation of Buildings," Solar Energy, Vol. 57, No. 2, pp. 77-91.

Rosenfeld, J.L.J., W. J. Platzer, H. Van Dijk, and A. Maccari. 2000. "Modelling the Optical and Thermal Properties of Complex Glazing: Overview of Recent Developments", Solar Energy, Vol. 69 Supplement, No. 1-6, pp.1-13.

Yahoda, D. S. and J. L. Wright. 2004. "Methods for Calculating the Effective Longwave Radiative Properties of a Venetian Blind Layer," ASHRAE Transactions, Vol. 110, Pt. 1., pp. 463-473.

Yahoda, D. S. and J. L. Wright. 2005. "Methods for Calculating the Effective Solar-Optical Properties of a Venetian Blind Layer," ASHRAE Transactions, Vol. 111, Pt. 1, pp. 572-586.

Yahoda, D. S. and J. L. Wright. 2004. "Heat Transfer Analysis of a Between-Panes Venetian Blind Using Effective Longwave Radiative Properties," ASHRAE Transactions, Vol. 110, Pt. 1., pp. 455-462.

Huang, N.Y.T., J. L. Wright, M. R. Collins. 2006. "Thermal Resistance of a Window with an Enclosed Venetian Blind: Guarded Heater Plate Measurements," ASHRAE Transactions, Vol. 112, Pt. 2. pp. 13-21.

Wright, J. L. 2008. "Calculating Centre-Glass Performance Indices of Glazing Systems with Shading Devices," ASHRAE Transactions, Vol. 114, Pt. 2.

Wright, J. L., N. Y. T. Huang, and M. R. Collins. 2008. "Thermal Resistance of a Window with an Enclosed Venetian Blind: A Simplified Model," ASHRAE Transactions, Vol. 114, Pt. 1.

Kotey, N. A., J. L. Wright, and M. R. Collins. 2008. “Determining Longwave Radiative Properties of Flat Shading Materials,” 33rd Annual SESCI / 3rd CSBC Conference Proceedings, Fredericton, NB.

Kotey, N.A., Wright, J.L., M. R. Collins. 2009a. "Determination of Angle-Dependent Solar Optical Properties of Roller Blind Materials," drafted for submission to ASHRAE Transactions, Vol. 115, Pt. 1.

Kotey, N.A., Wright, J.L., M. R. Collins. 2009b. "Determination of Angle-Dependent Solar Optical Properties of Drapery Fabrics," in review, ASHRAE Transactions, Vol. 115, Pt. 2.

Wright, John L., Charles S. Barnaby, Michael R. Collins, and Nathan A. Kotey. Improving Cooling Load Calculations for Fenestration with Shading Devices . ASHRAE 1311-RP, Final Report, February 11, 2009.

Air Heat Balance Manager / Processes
====================================

Convection from Surfaces
------------------------

This contribution is expressed using the convective heat transfer coefficient as follows:

<div>$${q_{conv}} = \sum\limits_{i = 1}^{nsurfaces} {{h_{c,i}}{A_i}\left( {{T_a} - {T_{s,i}}} \right)} $$</div>

The inside heat transfer coefficient is modeled from a choice of correlations.

Convection from Internal Sources
--------------------------------

This component is the companion part of the radiant contribution from internal gains described previously.  It is added directly into the air heat balance. Such a treatment also violates the tenets of the heat balance since the surface temperature of the surfaces producing the internal loads exchange heat with the zone air through normal convective processes.   However, once again, the details required to include this component in the heat balance are generally not available, and its direct inclusion into the air heat balance is a reasonable approach..

Infiltration/Ventilation
------------------------

### Infiltration

Any outdoor air that enters by way of infiltration is assumed to be immediately mixed with the zone air. The determination of the amount of infiltration air is quite complicated and subject to significant uncertainty. In the most common procedure, the infiltration quantity is converted from a number of air changes per hour (ACH) and included in the zone air heat balance using the outside temperature at the current simulation time step.

EnergyPlus contains three models for infiltration. The first is the “Design Flow Rate” model that was inherited from EnergyPlus’ predecessor programs. It is accessed through the ZoneInfiltration:DesignFlowRate object and is based on environmental conditions modifying a design flow rate.  The second is the “Effective Leakage Area” model based on Sherman and Grimsrud (1980) and accessed using the ZoneInfiltration:EffectiveLeakageArea input object.  The third is the “Flow Coefficient” model based on Walker and Wilson (1998) and accessed using the ZoneInfiltration:FlowCoefficient input object. The model formulations for the Effective Leakage Area and Flow Coefficient models are from the ASHRAE Handbook of Fundamentals (2001 Chapter 26; 2005 Chapter 27) where they are referred to as “Basic” and “Enhanced”, respectively.

### Infiltration Design Flow Rate

Infiltration (Ref Object: ZoneInfiltration:DesignFlowRate) is the unintended flow of air from the outdoor environment directly into a thermal zone. Infiltration is generally caused by the opening and closing of exterior doors, cracks around windows, and even in very small amounts through building elements. In this model, the user defines a design flow rate that can be modified by temperature differences and windspeed. The basic equation (Coblenz and Achenbach 1963) used to calculate infiltration with this model is:

<div>$$Infiltration = \left( {{I_{design}}} \right)\left( {{F_{schedule}}} \right)\left[ {A + B\left| {\left( {{T_{zone}} - {T_{odb}}} \right)} \right| + C\left( {WindSpeed} \right) + D\left( {Windspee{d^2}} \right)} \right]$$</div>

More advanced infiltration calculations are possible using the EnergyPlus AirflowNetwork model for natural infiltration driven by wind when the HVAC system does not operate and/or driven by wind and forced air for times when the HVAC system operates. Exfiltration (the leakage of zone air to the outside) is generally handled better as zone exhaust air in the zone equipment description.

The question of typical values for these coefficients is subject to debate. Ideally, one should do a detailed analysis of the infiltration situation and then determine a custom set of coefficients using methods such as those laid out in Chapter 26 of the ASHRAE Handbook of Fundamentals. The EnergyPlus defaults are 1,0,0,0 which gives a constant volume flow of infiltration under all conditions.

BLAST (one of the EnergyPlus predecessors) used the following values as defaults:  0.606, 0.03636, 0.1177, 0. These coefficients produce a value of 1.0 at 0C deltaT and 3.35 m/s (7.5 mph) windspeed, which corresponds to a typical summer condition. At a winter condition of 40C deltaT and 6 m/s (13.4 mph) windspeed, these coefficients would increase the infiltration rate by a factor of 2.75.

In DOE-2 (the other EnergyPlus predecessor), the air change method defaults are (adjusted to SI units) 0, 0, 0.224 (windspeed), 0. With these coefficients, the summer conditions above would give a factor of 0.75, and the winter conditions would give 1.34. A windspeed of 4.47 m/s (10 mph) gives a factor of 1.0.

The source of the BLAST defaults is noted in the BLAST documentation as:

"Empirical equation and the coefficient default were determined from ASHRAE journal articles and other data on the effects of outdoor weather conditions."

The source of the DOE-2 defaults is based on examining the infiltration relationships described in the ASHRAE Handbook of Fundamentals.

The EnergyPlus example files use all of the above, the BLAST defaults in some (e.g., GeometryTest), the DOE-2 defaults in some (e.g., 5ZoneAirCooled), and the EnergyPlus defaults in some (e.g., LgOffVAVDetCoil).

### Infiltration by Effective Leakage Area

The Effective Leakage Area model is based on Sherman and Grimsrud (1980) and accessed using the ZoneInfiltration:EffectiveLeakageArea input object.  The model formulation used in EnergyPlus is from the ASHRAE Handbook of Fundamentals (2001 Chapter 26; 2005 Chapter 27) where it is referred to as the “Basic” model.

The Effective Leakage Area, or Sherman-Grimsrud, model is:

<div>$$Infiltration = \left( {{F_{Schedule}}} \right)\frac{{{A_L}}}{{1000}}\sqrt {{C_s}\Delta T + {C_w}{{\left( {WindSpeed} \right)}^2}} $$</div>

where,

<span>${F_{schedule}}$</span> is a value from a user-defined schedule,

<span>${A_L}$</span> is the effective air leakage area in cm<sup>2</sup> that corresponds to a 4 Pa pressure differential,

<span>${C_s}$</span> is the coefficient for stack-induced infiltration in (L/s)<sup>2</sup>/(cm<sup>4</sup>·K),

<span>$\Delta T$</span> is the absolute temperature difference between zone air and outdoor air,

<span>${C_w}$</span> is the coefficient for wind-induced infiltration in (L/s)<sup>2</sup>/(cm<sup>4</sup>·(m/s)<sup>2</sup>), and

<span>$WindSpeed$</span> is the local wind speed.

### Infiltration by Flow Coefficient

The Flow Coefficient model is based on Walker and Wilson (1998) and accessed using the ZoneInfiltration:FlowCoefficient input object.  The model formulation used in EnergyPlus is from the ASHRAE Handbook of Fundamentals (2001 Chapter 26; 2005 Chapter 27) where it is referred to as the “Enhanced” or “AIM-2” model.

The Enhanced, or AIM-2, model is:

<div>$$Infiltration = \left( {{F_{Schedule}}} \right)\sqrt {{{\left( {c\,{C_s}\Delta {T^n}} \right)}^2} + {{\left( {c\,{C_w}{{\left( {s * WindSpeed} \right)}^{2n}}} \right)}^2}} $$</div>

where,

<span>${F_{schedule}}$</span> is a value from a user-defined schedule,

<span>$c$</span> is the flow coefficient in m<sup>3</sup>/(s·Pa<sup>n</sup>),

<span>${C_s}$</span> is the coefficient for stack-induced infiltration in (Pa/K)<sup>n</sup>,

<span>$n$</span> is the pressure exponent,

<span>${C_w}$</span> is the coefficient for wind-induced infiltration in (Pa·s<sup>2</sup>/m<sup>2</sup>)<sup>n</sup>, and

<span>$s$</span> is the shelter factor.

#### References:

Coblenz, C. W. and Achenbach, P. R. 1963. Field Measurement of Ten Electrically-Heated Houses. ASHRAE Transactions pp 358-365.

Sherman, M.H. and D.T. Grimsrud. 1980. Infiltration-pressurization correlation: Simplified physical modeling. ASHRAE Transactions 86(2):778

Walker, I.S., and D.J. Wilson. 1998. Field validation of equations for stack and wind driven air infiltration calculations.  International Journal of HVAC&R Research 4(2).

ASHRAE Handbook of Fundamentals. 2005. Chapter 27. (and 2001 Chapter 26).

### Ventilation

EnergyPlus contains two models for ventilation.  The “Design Flow Rate” model, inherited from EnergyPlus’ predecessor programs, is accessed through the ZoneVentilation:DesignFlowRate object and is based on environmental conditions modifying a design flow rate.  The “Wind and Stack with Open Area” model, based on equations defined in Chapter 16 of the 2009 ASHRAE Handbook of Fundamentals, is accessed using the ZoneVentilation:WindandStackOpenArea input object. Since the “Wind and Stack with Open Area” object requires the height difference between the midpoint of the lower opening and the neutral pressure level, which is difficult to estimate, this object should be used with care (e.g., research only).

These two ventilation objects can be used alone or in combination to determine ventilation air for a zone. If multiple ZoneVentilation:\* objects are specified for a zone, then the total zone ventilation flow rate is the sum of the ventilation air flow rates calculated by each ZoneVentilation object.

### Ventilation Design Flow Rate

Ventilation (Ref Object: ZoneVentilation:DesignFlowRate) is the purposeful flow of air from the outdoor environment directly into a thermal zone in order to provide some amount of non-mechanical cooling.  Ventilation as specified by this input syntax is intended to model “simple” ventilation as opposed to the more detailed ventilation investigations that can be performed with the AirflowNetwork model.  Simple ventilation in EnergyPlus can be controlled by a schedule and through the specification of minimum, maximum and delta temperatures. The temperatures can be either single constant values for the entire simulation or schedules which can vary over time. Specific details are given in the Input/Output reference document. As with infiltration, the actual flow rate of ventilation can be modified by the temperature difference between the inside and outside environment and the wind speed. The basic equation used to calculate ventilation using this model is:

<div>$$Ventilation = \left( {{V_{design}}} \right)\left( {{F_{schedule}}} \right)\left\lfloor {A + B\left| {{T_{zone}} - {T_{odb}}} \right| + C\left( {WindSpeed} \right) + D\left( {WindSpee{d^2}} \right)} \right\rfloor $$</div>

More advanced ventilation calculations are possible using the EnergyPlus AirflowNetwork model.

The following description is copied from the Infiltration discussion above. The question of typical values for these coefficients is subject to debate. Ideally, one should do a detailed analysis of the ventilation situation and then determine a custom set of coefficients using methods such as those laid out in Chapter 26 of the ASHRAE Handbook of Fundamentals. The EnergyPlus defaults are 1,0,0,0 which gives a constant volume flow of ventilation under all conditions.

BLAST (one of the EnergyPlus predecessors) used the following values as defaults:  0.606, 0.03636, 0.1177, 0. These coefficients produce a value of 1.0 at 0C deltaT and 3.35 m/s (7.5 mph) windspeed, which corresponds to a typical summer condition. At a winter condition of 40C deltaT and 6 m/s (13.4 mph) windspeed, these coefficients would increase the ventilation rate by a factor of 2.75.

In DOE-2 (the other EnergyPlus predecessor), the air change method defaults are (adjusted to SI units) 0, 0, 0.224 (windspeed), 0. With these coefficients, the summer conditions above would give a factor of 0.75, and the winter conditions would give 1.34. A windspeed of 4.47 m/s (10 mph) gives a factor of 1.0.

The source of the BLAST defaults is noted in the BLAST documentation as:

"Empirical equation and the coefficient default were determined from ASHRAE journal articles and other data on the effects of outdoor weather conditions."

The source of the DOE-2 defaults is based on examining the infiltration relationships described in the ASHRAE Handbook of Fundamentals.

The EnergyPlus example files use all of the above, the BLAST defaults in some (e.g., AirflowNetwork\_Simple\_house), the DOE-2 defaults in some (e.g., VentilationSimpleTest – has all 3), and the EnergyPlus defaults in some (e.g., 5ZoneNightVent2).

### Ventilation by Wind and Stack with Open Area

For this model (Ref Object: ZoneVentilation:WindandStackOpenArea), the ventilation air flow rate is a function of wind speed and thermal stack effect, along with the area of the opening being modeled. This object can be used alone or in combination with ZoneVentilation:DesignFlowRate objects. This model is intended for simplified ventilation calculations as opposed to the more detailed ventilation investigations that can be performed with the AirflowNetwork model. Using the “Wind and Stack with Open Area” model, the natural ventilation flow rate can be controlled by a multiplier fraction schedule applied to the user-defined opening area and through the specification of minimum, maximum and delta temperatures. The temperatures can be either single constant values for the entire simulation or schedules which can vary over time. The equation used to calculate the ventilation rate driven by wind is given by Eq. 37 in Chapter 16 of the 2009 ASHRAE Handbook of Fundamentals:

<div>$${Q_w} = {C_w}{A_{opening}}{F_{schedule}}V$$</div>

where,

*Q<sub>w</sub>*  = Volumetric air flow rate driven by wind [m<sup>3</sup>/s]

*C<sub>w</sub>*  = Opening effectiveness [dimensionless]

*A<sub>opening</sub>*        = Opening area [m<sup>2</sup>]

*F<sub>schedule</sub>* = Open area fraction [user-defined schedule value, dimensionless]

*V*    = Local wind speed [m/s]

If the user specifies “Autocalculate” for the Opening Effectiveness input field, the opening effectiveness is calculated for each simulation time step based on the angle between the actual wind direction and the Effective Angle (a user-defined input) using the following equation:

<div>$${C_w} = 0.55 - \frac{{\left| {EffectiveAngle - WindDirection} \right|}}{{180}}*0.25$$</div>

The difference |EffectiveAngle – WindDirection| should be between 0 and 180 degrees. If the difference |EffectivAngle – WindDirection| is greater than 180, the difference is reset to be minus 180 degrees. This equation is a linear interpolation using the values recommended by the 2009 ASHRAE Handbook of Fundamentals (page 16.13): 0.5 to 0.6 for perpendicular winds and 0.25 to 0.35 for diagonal winds.

The equation used for calculating the ventilation rate due to stack effect is given by Eq. 38 in Chapter 16 of the 2009 ASHRAE Handbook of Fundamentals:

<div>$${Q_s} = {C_D}{A_{opening}}{F_{schedule}}\sqrt {2g\Delta {H_{NPL}}(|{T_{zone}} - {T_{odb}}|/{T_{zone}})} $$</div>

where,

*Q<sub>s</sub>*  = Volumetric air flow rate due to stack effect [m<sup>3</sup>/s]

*C<sub>D</sub>*  = Discharge coefficient for opening [dimensionless]

*A<sub>opening</sub>*        = Opening area [m<sup>2</sup>]

*F<sub>schedule</sub>* = Open area fraction [user-defined schedule value, dimensionless]

*ΔH<sub>NPL</sub>*        = Height from midpoint of lower opening to the neutral pressure level [m].

Estimation of this value is difficult; refer to Chapter 16 of the 2009 ASHRAE Handbook of Fundamentals for guidance.

*T<sub>zone</sub>*            = Zone air dry-bulb temperature [K]

*T<sub>odb</sub>*<sub>                        </sub> = Local outdoor air dry-bulb temperature [K]

The following equation, given by Eq. 39 in Chapter 16 of the 2009 ASHRAE Handbook of Fundamentals, is used to calculate the Discharge Coefficient for Opening when the user sets the value for this input field to “Autocalculate”:

<div>$${C_D} = 0.40 + 0.0045\left| {{T_{zone}} - {T_{odb}}} \right|$$</div>

The total ventilation rate calculated by this model is the quadrature sum of the wind and stack air flow components:

<div>$$Ventilatio{n_{WindAndStack}} = \sqrt {{Q_s}^2 + {Q_w}^2} $$</div>

If desired, a simple summation, instead of quadrature summation, can be realized by inputting two ZoneVentilation:WindAndStackOpenArea objects. One object can be defined with only a wind-driven component by setting C<sub>D</sub>=0, and the other object can have only stack-effect inputs specified and set C<sub>w</sub>=0.

### Zone Air Balance Outdoor Airflow (ZoneAirBalance:OutdoorAir)

ASHRAE 2009 Handbook of Fundamentals specifies that any unbalanced supply or exhaust ventilation air, Q<sub>u,v</sub>, to a zone causes pressurization/depressurization that influences the flow of infiltration air and thus should be combined with natural infiltration, Q<sub>n</sub>, (and, if present, unbalanced duct leakage, Qu,l) in superposition. Balanced ventilation airflow, Q<sub>b,v</sub>, to a zone (such as an ERV or HRV with balanced exhaust and intake air flows) does not interact with infiltration air and is added in whole:

<div>$$Q = \sqrt {{Q_n}^2 + {Q_{u,v}}^2 + ({Q_{u,l}}^2)}  + {Q_{b,v}}$$</div>

where,

*Q*    = Combined outdoor airflow with infiltration, balanced and unbalanced outdoor air flows, and unbalanced duct leakage [m<sup>3</sup>/s]

*Q<sub>n</sub>*   = Natural infiltration airflow [m<sup>3</sup>/s]

*Q<sub>b,v</sub>* = Balanced ventilation airflow, excluding infiltration [m<sup>3</sup>/s]

*Q<sub>u,v</sub>* = Unbalanced ventilation airflow, excluding infiltration [m<sup>3</sup>/s]

*Q<sub>u,l</sub>*  = Unbalanced duct leakage: the difference between supply and return leaks [m<sup>3</sup>/s]

The natural infiltration airflow includes all outdoor airflows from all ZoneInfiltration:\* objects for the same zone.

<div>$${Q_n} = \sum\limits_i {{Q_{Infiltration,i}}} $$</div>

where,

*Q<sub>Infiltration,i</sub>*      = Outdoor airflow rate given in the ith ZoneInfiltration:\* objects for the same zone

The balanced ventilation airflow is the sum of outdoor airflows from all ZoneVentilation: DesignFlowRate objects with Ventilation Type = Balanced:

<div>$${Q_{b,v}} = \sum\limits_i {{Q_{v,Balanced,i}}} $$</div>

where,

*Q<sub>v,Balanced,i</sub>*     = Ventilation rate with “Balanced” ventilation type defined in the ith ZoneVentilation:DesignFlowRate object for the same zone

The unbalanced ventilation airflow is given by the following equation:

<div>$${Q_{u,v}} = {\left[ {{{\left( {\sum\limits_i {{Q_{v,Natural,i}}}  + \sum\limits_i {{Q_{v,Wind,i}}} } \right)}^2} + {{\left( {\sum\limits_i {{Q_{v,Intake,i}}} } \right)}^2} + {{\left( {\sum\limits_i {{Q_{v,Exhaust,i}}} } \right)}^2} + {{\left( {\sum\limits_i {Max\left( {0,\;({Q_{ERV,Exh,i}} - {Q_{ERV,Sup,i}})} \right)} } \right)}^2}} \right]^{0.5}}$$</div>

where

*Q<sub>v,Exhaust,i</sub>*      = Ventilation rate with “Exhaust” type in the ith ZoneVentilation:DesignFlowRate object for the same zone

*Q<sub>v,Intake,i</sub>*        = Ventilation rate with “Intake” type in the ith ZoneVentilation:DesignFlowRate object for the same zone

*Q<sub>v,Natural,i</sub>*       = Ventilation rate with “Natural” type in the ith ZoneVentilation:DesignFlowRate object for the same zone

*Q<sub>v,Wind,v</sub>*        = Ventilation rate in the ith ZoneVentilation:WindandStackOpenArea object for the same zone

*Q<sub>ERV,Sup,i</sub>*       = Supply flow rate given in the ith ZoneHVAC:EnergyRecoveryVentilator object

*Q<sub>ERV,Exh,i</sub>*       = Exhaust flow rate given in the ith ZoneHVAC:EnergyRecoveryVentilator object

For Ventilation Type = Intake in the ZoneVentilation:DesignFlowRate object, an appropriate amount of fan heat will be ignored and the outdoor temperature will be used in the zone air heat balance equation.

This object provides a simple airflow interaction model without having to use the AirflowNetwork capabilities, when the Air Balance Method is specified as Quadrature.

### Reference

ASHRAE. 2009. 2009 ASHRAE Handbook – Fundamentals, Chapter 16, Atlanta: American Society of Heating, Refrigerating, and Air-Conditioning Engineers, Inc.

Air Exchange
------------

Air exchange and interchange between zones is treated as a convective gain. Temperature-difference-controlled or constant air mixing can be specified as a one-way or cross-zone phenomenon modeled using the ZoneMixing or ZoneCrossMixing objects. Air exchange through doorways between refrigerated spaces can be modeled using the ZoneRefrigerationMixing object.

For one-way mixing (using ZoneMixing object(s)), the mixing air flow is only used for the energy and mass balance for the receiving zone. The mass referred in this section includes air, water vapor and CO<sub>2</sub>. The source zone energy and mass balance are not effected, although the user may choose to enter complementary pairs of one-way mixing objects. Multiple mixing flows can be defined for any receiving zone. For cross-zone mixing (using ZoneCrossMixing object(s)), the mixing air flow impacts the mass and energy balances in both the source and receiving zones. No more than one ZoneCrossMixing object can be used for any receiving zone. A separate ZoneCrossMixing object must be used for each of the two zones exchanging air if the mixing flow is bi-directional and based on a temperature difference greater than zero.

For refrigerated space air exchange (using ZoneRefrigerationDoorMixing object(s)), the mixing air flow impacts the mass and energy balances in both the source and receiving zones. A single object accounts for the two-way air flow with the energy and mass exchanges determined by  the air density difference between the two zones.

### Temperature Difference Controlled Air Exchange

The volume of air flow into the receiving zone is specified by the user with a number of control parameters and schedules listed in the Input Output Guide. The user can turn this one-way flow on or off based on the temperature difference between the source and receiving zones, or it may be independent of the temperature difference. The density and specific heat of the air flowing into the receiving zone are determined using the average temperature and average humidity ratio in the source and receiving zones. The humidity ratio of the air flowing into the receiving zone is set equal to the humidity ratio of the source zone. The mass, moisture,and energy terms are then used as described in two previous sections, Basis for the Zone and Air System Integration, and Moisture Predictor-Corrector.

<div>$$
  \begin{array}{cl}
    \rho_{Avg} &= f \left( \frac{T_{ReceivingZone} + T_{SourceZone}}{2},\frac{W_{ReceivingZone} + W_{SourceZone}}{2},P_{Barometric} \right) \\
    c_{P,Avg} &= f \left( \frac{T_{ReceivingZone} + T_{SourceZone}}{2},\frac{W_{ReceivingZone} + W_{SourceZone}}{2}\right) \\
    \dot m_{MixingFlowToReceivingZone} &= \sum_{AllSourceZones} \rho_{Avg}\dot V_{Air} \\
    \dot Q_{MixingFlowToReceivingZone} &= \sum_{AllSourceZones} \rho_{Avg}C_{p,Avg}\dot V_{Air}\left(T_{sourceZone}-T_{receivingZone}\right) \\
    \text{Moisture}_{MixingFlowToReceivingZone} &= \sum_{AllSourceZones} \rho_{Avg} \dot V_{Air} W_{SourceZone}
  \end{array}
$$</div>  
  
where:

c<sub>P,Avg</sub>                                   = Average specific heat of air within the two zones (J/kg.K)

<span>${\dot m_{{\rm{MixingFlowToReceivingZone}}}}$</span>          = Mass of moist air flowing into the receiving zone (kg<sub>air</sub>/s)

Moisture<sub>MixingFlowToReceivingZone</sub>    = Moisture mass flow rate into the receiving zone (kg<sub>H2O</sub>/s)

P<sub>Barometric</sub>                              = Outside barometric pressure (Pa)

ρ<sub>Avg\\                                                                         </sub> = Average density of air within the two zones (kg/s)

<span>${\dot Q_{{\rm{MixingFlowToReceivingZone}}}}$</span>          = Energy added to receiving zone air by mixing mass flow (W)

T<sub>ReceivingZone                                                      </sub> = Temperature in the Receiving Zone (<sup>o</sup>C)

T<sub>SourceZone</sub>                              = Temperature in the Source Zone (<sup>o</sup>C)

<span>${\dot V_{Air}}$</span>                                   = Volume rate of air flow defined by the user (m<sup>3</sup>/s)

W<sub>ReceivingZone</sub>              = Humidity Ratio in the Receiving Zone (kg<sub>H2O</sub>/kg<sub>dry\\ air</sub>)

W<sub>SourceZone</sub>                             = Humidity Ratio in the Source Zone (kg<sub>H2O</sub>/kg<sub>dry\\ air</sub>)

For cross-mixing, the mass of moist air exchanged between the two zones is assumed to be equal.  Again, the density and specific heat are based on the average conditions in the two zones. Note that the temperature and humidity ratio differences ensure that when the energy and  moisture terms are used in the Moisture Predictor-Corrector, they correctly reflect a loss or gain in each zone.

<div>$$
  \begin{array}{cl}
    \dot{m}_{MixingFlowToReceivingZone} &= \dot{m}_{MixingFlowToSourceZone} = \rho_{Avg}\dot{V}_{Air} \\
    \dot{Q}_{MixingFlowToSourceZone}    &= \rho_{Avg} C_{p,Avg} \dot{V}_{Air} \left( T_{ReceivingZone}-T_{SourceZone} \right) \\
    \dot{Q}_{MixingFlowToReceivingZone} &= \rho_{Avg} C_{p,Avg} \dot{V}_{Air} \left( T_{SourceZone} - T_{ReceivingZone} \right) \\
    \text{Moisture}_{MixingFlowToSourceZone} &= \rho_{Avg} \dot{V}_{Air} W_{ReceivingZone} \\
    \text{Moisture}_{MixingFlowToReceivingZone} &= \rho_{Avg} \dot{V}_{Air} W_{SourceZone}
  \end{array}
$$</div>
    
where:

<span>${\dot m_{{\rm{MixingFlowToSourceZone}}}}$</span>             = Mass of moist air flowing into the source zone (kg<sub>air</sub>/s)

Moisture<sub>MixingFlowToSourceZone</sub>       = Moisture mass flow rate into the source zone (kg<sub>H2O</sub>/s)

<span>${\dot Q_{{\rm{MixingFlowToSourceZone}}}}$</span>             = Sensible energy added to source zone air by mixing mass flow (W)

<span>${\dot Q_{{\rm{MixingFlowToReceivingZone}}}}$</span>          = Sensible energy added to receiving zone air by mixing mass flow, W

<span>$Moistur{e_{{\rm{MixingFlowToSourceZone}}}}$</span>= Latent load added to source zone air by mixing mass flow (kg<sub>H2O</sub>/s)

<span>$Moistur{e_{{\rm{MixingFlowToReceivingZone}}}}$</span>= Latent load added to receiving zone air by mixing mass flow (kg<sub>H2O</sub>/s)

### Density Difference Controlled Air Exchange

When closed refrigerated spaces exchange air with other closed spaces, the air flow is determined by the difference in air density between the two spaces. The fundamental assumption for this case is that the mass of dry air exchanged between the two spaces is the same.(Gosney and Olama,  1975] This assumption applies to situations where the colder of the two spaces is essentially sealed to other air flows, that is, there are no open doors or exhaust air flows. Multiple refrigeration door mixing objects can be used for the zone, but if there are multiple doors open at the same time for any significant amount of time, the model will not give results appropriate for that condition.

The sensible and latent energy loads are modeled according to the guidance specified in (ASHRAE 2006d, ASHRAE 2009, and Gosney and Olama, 1975).  Equal dry air exchange is assumed, that is, the mass of dry air infiltrating into the receiving zone is assumed to equal the mass of dry air infiltrating out of the source zone.

<div>$$
  \begin{array}{cl}
    h_{zoneA},\rho_{zoneA} &= f (T_{zoneA},W_{zoneA},P_{Barometric}) \\
    h_{zoneB},\rho_{zoneB} &= f (T_{zoneB},W_{zoneB},P_{Barometric}) \\
    \rho_{zoneA} &\gt \rho_{zoneB} \\
    \dot{Q}_{Mixing} &= \dot{Q}_{FullFlow} \times \text{Schedule}_{DoorOpen} \times F_{Flow} \times (1-F_{Protection}) \\
    \dot{Q}_{FullFlow} &= B (h_{zoneB}-h_{zoneA}) \\
    B &= 0.221 A_{door} \rho_{zoneA} F_{Density} \sqrt{ \left(1-\frac{\rho_{zoneB}}{\rho_{zoneA}}\right) g H_{Door} } \\
    F_{Density} &= \left[ \frac{2}{1+\left(\rho_{zoneA}/\rho_{zoneB}\right)^{1/3}} \right]^{1.5} \\
    \dot{m}_{DryAirZonesAB} &= \frac{\dot{Q}_{Mixing}}{h_{zoneB}-h_{zoneA}} \\
    \dot{m}_{MixingFlowZoneBtoA} &= \sum_{AllZoneBs} \dot{m}_{DryAirZonesAB}\left(1+W_{ZoneB}\right) \\
    \dot{Q}_{MixingFlowZoneBtoA} &= \sum_{AllZoneBs} \dot{m}_{ZoneBtoA} C_{p,ZoneB} \left(T_{zoneB}-T_{zoneA}\right) \\
    \text{Moisture}_{MixingFlowZoneBtoA} &= \sum_{AllZoneBs} \dot{m}_{ZoneBtoA} \left( W_{zoneB}-W_{zoneA} \right) \\
    \dot{m}_{MixingFlowZoneAtoB} &= \sum_{AllZoneAs} \dot{m}_{DryAirZonesAB}\left(1+W_{ZoneA}\right) \\
    \dot{Q}_{MixingFlowZoneAtoB} &= \sum_{AllZoneAs} \dot{m}_{ZoneBtoA} C_{p,ZoneA} \left(T_{zoneA}-T_{zoneB}\right) \\
    \text{Moisture}_{MixingFlowZoneAtoB} &= \sum_{AllZoneAs} \dot{m}_{ZoneBtoA} \left( W_{zoneA}-W_{zoneB} \right) 
  \end{array}
$$</div>

where:

A<sub>door</sub>            =  Area of door between Zones A and B (m<sup>2</sup>)

F<sub>Flow</sub>            =  Doorway flow factor, = 0.8 if ΔT &gt; 11<sup>o</sup>C; =1.1 if ΔT &lt;= 11<sup>o</sup>C

F<sub>Protection</sub>        = Doorway protection factor, = 0 for no protection; =  0.5 for an air curtain; and 0.9 for a strip curtain (dimensionless)

g                =  Gravitational constant (m/s<sup>2</sup>)

h<sub>ZoneA                     </sub> =  enthalpy of the air within Zone A (J/kg)

h<sub>ZoneB                     </sub> =  enthalpy of the air within Zone B (J/kg)

H<sub>door</sub>            =  Height of door between source and receiving zones (m)

Q<sub>FullFlow</sub>        = Sensible and latent refrigeration load (on Zone A) for fully established flow (W)

Q<sub>Mixing</sub>          = Sensible and latent mixing refrigeration load on Zone A for the time step (W)

m<sub>DryAirZoneAB</sub>   = Mass of dry air exchanged between zones A and B (kg<sub>air</sub>/s)

Schedule<sub>DoorOpen</sub>        = Value scheduled by user, fraction of time door open during time step (dimensionless)

W<sub>ZoneA                  </sub> =  Humidity ratio of the air within Zone A (kg<sub>H2O</sub>/kg<sub>air</sub>)

W<sub>ZoneB</sub>          =  Humidity ratio of air within Zone B (kg<sub>H2O</sub>/kg<sub>air</sub>)

Ρ<sub>ZoneA                    </sub> =  Density of air within Zone A (kg/m<sup>3</sup>)

ρ<sub>ZoneB</sub>           =  Density of air within Zone B (kg/m<sup>3</sup>)

### References

ASHRAE. 2006d. *Refrigeration Handbook*, Chapter 13. Atlanta: American Society of Heating,

Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2009. *Fundamentals Handbook*, Chapter 1. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Gosney, W.B., Olama, G.A.-L. 1975. Heat and Enthalpy Gains through Cold Room Doorways,  Proceedings of the Institute of Refrigeration, vol. 72, pp 31-41

Calculation of Zone Air Temperature
-----------------------------------

The zone air heat balance is the primary mechanism for linking the loads calculation to the system simulation.  As such, the zone air temperature becomes the main interface variable.  Its role in the integration process was described previously (“Basis for the Zone and Air System Integration”).

Building System Simulation System Manager / Processes
=====================================================

EnergyPlus uses a loop based HVAC system formulation.  An example of the dual duct VAV system is shown below.

Air Loops
---------

### Definition of Air Loop

In EnergyPlus an air loop is a central forced air HVAC system. The term “loop” is used because in most cases some air is recirculated so that the air system forms a fluid loop. The air loop is just the “air side” of a full HVAC system.  The input objects related to these air loops begin “AirLoopHVAC.”

For simulation purposes the air loop is divided into 2 parts: the primary air system (representing the supply side of the loop) and the zone equipment (representing the demand side of the loop). The primary air system includes supply and return fans, central heating and cooling coils, outside air economizer, and any other central conditioning equipment and controls. The zone equipment side of the loop contains the air terminal units as well as fan coils, baseboards, window air conditioners, and so forth. Supply and return plenums are also included on the zone equipment side of the loop.

### Simulation Method

Simulating a forced air system and its associated zones can be done in a number of ways. EnergyPlus uses algebraic energy and mass balance equations combined with steady state component models. When the zone air and the air system are modeled with algebraic equations (steady state) then – in cases with recirculated air – there will be one or more algebraic loops. In other words it is not possible to solve the equations directly; instead iterative methods are needed. Typically a humidity ratio and a mass flow rate will be variables involved in the iterative solution.

In EnergyPlus the zone humidity ratios and temperatures are decoupled from the solution of the air system equations. The zone air is assigned heat and moisture storage capacities and the capacity effects are modeled by 1<sup>st</sup> order ordinary differential equations. During each system simulation time step new zone temperatures and humidities are predicted using past values. The zone temperatures and humidities are then held constant during the simulation of the air system (and the plant). Then the zone temperatures and humidity ratios are corrected using results from the system simulation. As a result the usual algebraic loops arising in steady state air system simulations are eliminated from the EnergyPlus system simulation. The zone temperatures, humidity ratios, and heating and cooling demands are known inputs to the system simulation.

The need for iteration can be reintroduced by the need for system control. If system setpoints are fixed, externally determined, or lagged and control is local (sensor located at a component outlet, actuator at a component inlet) then iteration can be confined to the components and the overall air system equations can be solved directly. However these requirements are too restrictive to simulate real systems. System setpoints are held fixed during a system time step. But controller sensors are allowed to be remote from the location of the actuator. Consequently EnergyPlus uses iteration over the entire primary air system in order to converge the system controllers.

### Component Models

EnergyPlus component models are algorithmic with fixed inputs and outputs. They are embodied as Fortran90 subroutines within software modules. For each component several choices of inputs and outputs are possible. There is no one choice that will be most usable and efficient for all system configurations and control schemes. For reasons of consistency and comprehensibility the requirement was imposed that all EnergyPlus models be forward models. That is, the component inputs correspond to the inlet conditions and the outputs to the outlet conditions.  If another choice of inputs and outputs is needed it is obtained by numerical inversion of the forward model.

### Iteration Scheme

The primary air system simulation uses successive substitution starting at the return air inlet node and proceeding in the flow direction to the supply air outlet nodes. The iteration proceeds until an individual actuator-controller has converged (the sensed value matches the setpoint within the specified tolerance). The system controllers are simulated in sequence. During this sequence of iterative solutions the air mass flow rates are held constant. The controllers are converged by the method of interval halving. This method was chosen (rather than for instance Newton-Raphson) for its robustness.

### Determination of Air Mass Flow Rates

In most cases the air mass flow rate of the central air system is set by zone equipment downstream of the primary air system. The air terminal unit components with their built in dampers and controllers respond to the zone heating and cooling loads by setting air flow rates at their inlet nodes. These flow rates are passed back upstream to the primary air system, establishing the flow rates in the primary air system branches. These flow rates are held fixed while the primary air system is simulated.

Air Loop Simulation
-------------------

A complete simulation of each primary air system – zone equipment air loop is done in the following manner.

* If this is the first simulation this system time-step, just call *ManageAirLoops* (simulates the primary air systems) and *ManageZoneEquipment* (simulates the zone equipment sets) once and quit. This initial pass is simulated with full design air flow rates and allows the zone equipment to set the flow rates for each zone that will meet the zone loads.

* Otherwise loop over primary air systems and zone equipment sets until the temperatures, flow rates, enthalpies, humidity ratios etc. agree to within tolerance at each primary air system – zone equipment gap.

```
DO WHILE ((SimAirLoops .OR. SimZoneEquipment) .AND. (IterAir.LE.MaxAir) )
  IF (SimAirLoops) THEN
    CALL ManageAirLoops(FirstHVACIteration,SimAirLoops,SimZoneEquipment)
    SimPlantDemandLoops = .TRUE
    SimElecCircuits =.TRUE.
  END IF

  IF (SimZoneEquipment) THEN
    CALL ResolveAirLoopFlowLimits(IterAir+1)
    CALL ManageZoneEquipment(FirstHVACIteration,SimZoneEquipment,SimAirLoops)
    SimPlantDemandLoops = .TRUE.
    SimElecCircuits =.TRUE.
  END IF

  IterAir = IterAir + 1

END DO

CALL ResolveLockoutFlags(SimAirLoops)
```


The logical flags *SimAirLoops* and *SimZoneEquipment* are used to signal whether the primary air systems or the zone equipment sets need to be resimulated. These flags are set by the subroutine *UpdateHVACInterface* which is called  from within *ManageAirLoops* and *ManageZoneEquipment* at the end of each half-loop simulation. *UpdateHVACInterface* (when called from *ManageAirLoops*) passes the values at the outlet nodes of a primary air system on to the inlet nodes of the corresponding zone equipment half-loop and similarly (when called from *ManageZoneEquipment*) passes the values of the outlet nodes of a zone equipment half-loop on to the inlet nodes of its corresponding  primary air system. Each time *UpdateHVACInterface* is called it also checks whether the values at the half-loop outlet nodes are in agreement with the values at the downstream half-loop inlet nodes. If they are not it sets the simulate flag of the downstream half-loop to *true*. The values checked by *UpdateHVACInterface* and their tolerances are as follows.

<table class="table table-striped">
<tr>
<th>Quantities</th>
<th>Tolerances</th>
</tr>
<tr>
<td>specific enthalpy [J/kg}</td>
<td>10.0</td>
</tr>
<tr>
<td>mass flow rate [kg/s]</td>
<td>0.01</td>
</tr>
<tr>
<td>humidity ratio [kg H<sub>2</sub>O / kg dry air]</td>
<td>0.0001</td>
</tr>
<tr>
<td>quality</td>
<td>0.01</td>
</tr>
<tr>
<td>air pressure [Pa]</td>
<td>10.0</td>
</tr>
<tr>
<td>temperature [C]</td>
<td>0.01</td>
</tr>
<tr>
<td>energy [J]</td>
<td>10.0</td>
</tr>

</table>



*ResolveAirLoopFlowLimits* is invoked to deal with zone equipment – primary air system flow mismatches. For instance the zone air terminal units (ATUs) may be asking for more air than the central fan can supply. In this case *ResolveAirLoopFlowLimits* takes the air flow that the fan can supply and apportions it among the ATUs in proportion to their design maximum air flow rates (*ResolveAirLoopFlowLimits* sets the <span>${\dot m_{\max avail,node}}$</span> at the entering node of each ATU in the system).

At the end of the air loop simulation *ResolveLockoutFlags* is called. This subroutine checks if any air system component has requested that the economizer be locked out. If such a request has been made and if the economizer is active, *ResolveLockoutFlags* sets *SimAirLoops* to *true* and the *EconoLockout* flag to *true* to ensure that the air loop will be resimulated with the economizer forced off.

Primary Air System Simulation
-----------------------------

When the EnergyPlus HVAC simulation manager needs to simulate the primary air system side of the air loop it calls *ManageAirLoops*, the primary air system simulation manager subroutine.

Note that “air loop” is used inconsistently in the program: sometimes it means the full loop consisting of both supply & demand sides – primary air system and zone equipment; sometimes it means just the supply side – the primary air system.

Like the other manager routines in EnergyPlus, *ManageAirLoops* has a very simple structure:

Table 39.  ManageAirLoop Code


```
IF (GetInputFlag) THEN  !First time subroutine has been entered
      CALL GetAirPathData ! Get air loop descriptions from input file
      GetInputFlag=.false.
  END IF

    ! Initialize air loop related parameters
  CALL InitAirLoops(FirstHVACIteration)

    ! Call the AirLoop Simulation
  IF (SysSizingCalc) THEN
    CALL SizeAirLoops
  ELSE
    CALL SimAirLoops(FirstHVACIteration,SimZoneEquipment)
  END IF

  ! No Update

    ! Report information at the Manage Air Loop Level
  CALL ReportAirLoops
```

1.  If the user input data has not been input, get the data and store it in the air loop data structures.

2.  Perform air loop initialization calculations:

    a. at the beginning of the simulation (one time initializations);

    b. at the start of each environment (design day or simulation run period);
 
    c.  before each air loop simulation.

3. If automatic sizing of the loop flow rates is called for, do it.

4. Otherwise perform a simulation of the air loop.

### Input data

The input data specifying an air loop consists of:

1. the loop configuration;

    a. Splitters, Mixers, and Branches;

    b. Components on the Branches

2. loop control;

    a. Controllers;

    b. System Availability Managers;

3. connection to zone equipment;

4. design flow rate.

These objects and their data are described in the EnergyPlus *Input Output Reference* document. The utility routines used to get and check the data are described in the EnergyPlus *Guide for Module Developers*, section Input Services.

### Initialization Calculations

#### One Time Calculations

##### Zones Served by System

The main one time calculation involves figuring out what zones are served by each air loop. The EnergyPlus input does not explicitly describe which zones receive supply air from a given air loop. Instead that knowledge is embedded implicitly in the overall air loop – zone equipment network description. For sizing calculations it is important to have a data structure that explicitly shows which zones each air loop serves. For instance, the air loop design supply air flow rate is obtained by summing the design heating or cooling air flow rates of the zones connected to the air loop.

For each air loop, the following calculation is performed.

(1)  For each air loop outlet branch, the corresponding zone equipment inlet node is identified.

(2)  This node number is compared to the inlet node of all AirLoopHVAC:SupplyPaths. When a match is found, the AirLoopHVAC:ZoneSplitter for this supply path is identified.

(3)  The outlet nodes of the AirLoopHVAC:ZoneSplitter are compared to the cooling inlet nodes of all the zone ZoneHVAC:AirDistributionUnits. When a match is found this zone is identified as being served by cooling supply air from the air loop.

(4)  Similarly the outlet nodes of the AirLoopHVAC:ZoneSplitter are compared with the heating inlet nodes of all ZoneHVAC:AirDistributionUnits. A match indicates that this zone is served by heating supply air from the air loop.

(5)  The case where there is no AirLoopHVAC:ZoneSplitter for a AirLoopHVAC:SupplyPath must be handled. In this case the program looks for a match between the zone equipment inlet node and an ZoneHVAC:AirDistributionUnit heating or cooling inlet node. When a match is found that zone is identified as being served with heating or cooling supply air from the air loop.

(6)  The list of cooled and heated zones are saved in the air loop data structure AirToZoneNodeInfo.

##### Branch Sizing

If this *not* an air loop sizing calculation, but is the first pass through the HVAC code in a normal simulation, loop over all the branches in all air loops and trigger the branch design air flow auto-sizing calculation. The actual calculation is described in the Sizing section of this document.

#### Begin Environment Initializations

For each air loop, loop over all the branches in the loop. Initialize each branch mass flow rate:

<div>$${\dot m_{br,\max }} = {\rho_{std}} \cdot {\dot V_{br,\max }}$$</div>

<div>$${\dot m_{br,\min }} = {\rho_{std}} \cdot {\dot V_{br,\min }}$$</div>

where <span>${\rho_{std}}$</span> is the density of air at 20 degrees C, humidity ratio = 0, standard pressure.

For each branch, loop over all the nodes on the branch and set the node data to the following values:

<div>$${T_{node}} = {20^{\rm{o}}}C$$</div>

<div>$${W_{node}} = {W_{oa}}$$</div>

<div>$${h_{node}} = {\mathop{\rm PsyHFnTdbW}\nolimits} {\rm{(}}20.0,{W_{oa}}{\rm{)}}$$</div>

<div>$${\dot m_{node}} = {\dot m_{br,\max }}$$</div>

<div>$${\dot m_{\max ,node}} = {\dot m_{br,\max }}$$</div>

<div>$${\dot m_{\max avail,node}} = {\dot m_{br,\max }}$$</div>

<div>$${\dot m_{\min ,node}} = 0.0$$</div>

<div>$${\dot m_{setpt,node}} = 0.0$$</div>

<div>$${\dot m_{\min avail,node}} = 0.0$$</div>

<div>$${p_{node}} = {p_{std,baro}}$$</div>

<div>$$Q{u_{node}} = 0.0$$</div>

where <span>${W_{oa}}$</span> is the humidity ratio of the outside air; <span>${\rm{PsyHFnTdbW}}$</span>is the EnergyPlus psychrometric function for enthalpy *h*, given temperature and humidity ratio; and *Qu* is quality.

#### System Time Step Initializations

For each branch in each air loop, loop over all the nodes on the branch and set <span>${\dot m_{setpt,node}} = 0.0$</span>; if it is the start of an HVAC solution sequence set <span>${\dot m_{\max avail,node}} = {\dot m_{\max ,node}}$</span>. Then set the mass flow rate setpoints for the air loop nodes.

1)    On each air loop, loop over the outlet branches and find the loop outlet nodes. If it is the start of an HVAC solution sequence, set <span>${\dot m_{setpt,outletnode}} = {\dot m_{outletbr,\max }}$</span>. This will insure that during the first pass through the full loop that the mass flow rate will be at the maximum. Otherwise, set <span>${\dot m_{setpt,outletnode}} = {\dot m_{zone{\rm{ }}eq{\rm{ }}inletnode}}$</span>. This sets the air loop flow rate to the total zone requirement.

2)    Pass the mass flow rate setpoint upstream to the start of the outlet branches; through the splitter, if one exists; and upstream to the beginning node of the splitter inlet branch.

3)    Sum the total return air mass flow rate and save it in the AirLoopFlow data structure.

4)    For each air loop, loop over the inlet nodes and, at the start of each HVAC solution sequence, set the entering node mass flow rate equal to the primary air system design mass flow rate (subject to it not being larger than the entering node mass flow rate setpoint).

### Central air system simulation

The subroutine *SimAirLoops* does the actual simulation the central air system equipment for all the air loops. The simulation of a full air loop (central equipment plus zone terminal units and equipment) requires the interaction of 2 managers: *ManageAirLoops* and *ManageZoneEquipment*. Thus a single call to *SimAirLoops* results in a simulation of all the central air system equipment, but this is one part of a larger iterative simulation of the full air loops involving the zone equipment as well.

*SimAirLoops* accomplishes its task using a set of nested loops.

* Loop over all of the central air systems (*Air Primary Loops*).

* For each air system, make 1 or 2 simulation passes

* Loop over each controller in the *Air Primary Loop*

* For each controller, repeat the simulation of all the *Air Primary Loop* components until the controller has converged

* Loop over each branch in the *Air Primary Loop*

* On each branch, simulate in sequence each component

During and at the end of each loop some tests are performed.

At the end of the first pass of loop 2, a decision is made on whether a second pass is needed. The first pass has been performed assuming that there is a mass flow balance in the central air system simulation. This is usually the case. A call to *ResolveSysFlow* checks the mass balance and imposes a mass balance if there is not a balance. The lack of a system mass balance requires a resimulation of the central air system: i.e., a second pass in loop 2.

In loop 3 a call to *ManageControllers* simulates controller action and checks for controller convergence. If convergence is achieved loop 3 is exited.

After all the controllers on a loop are converged,  steps 5 & 6 are repeated one more time to ensure all the components on the loop have final values.

At the end of the primary air system simulation a call to *UpdateHVACInterface* passes the primary air system outlet node data to the zone equipment inlet nodes. If the data across the supply side – demand side gap doesn’t match to within a preset tolerance, the flag *SimZoneEquipment* is set to *true* to ensure that the zone equipment side gets resimulated. Finally a flag indicating whether the economizer is active is set. This flag is used at a higher level to decide whether the primary air system needs to be resimulated if an HVAC component is calling for economizer lockout.

Outdoor Air System
------------------

The AirLoopHVAC:OutdoorAirSystem is a subsystem of the primary air system (object AirLoopHVAC). To the primary air system it appears to be a single component. Within the subsystem are components and controllers very much like the primary air system. The purpose of the outside air system is to simulate the splitting of the return air into relief and recirculated air; mix the recirculated and outside air to obtain the mixed air (all accomplished by the OutdoorAir:Mixer); simulate the components in the outside air stream; control the components and outside air flow rate (economizer control). The outside air system differs from the primary air system in that it is not described in terms of splitters, mixers, and branches. Instead the components are simply listed in simulation order in an AirLoopHVAC:OutdoorAirSystem:EquipmentList input object. The components other than the OutdoorAir:Mixer are assumed to be in the outside air stream. The connectivity is defined by upstream component’s outlet node = downstream component’s inlet node. The OutdoorAir:Mixer should be the first component in the AirLoopHVAC:OutdoorAirSystem:EquipmentList object.

### Simulation

The data for and simulation of the outside air system are contained in the MixedAir module. This includes the data and simulation of the OutdoorAir:Mixer and the Controller:OutdoorAir. The simulation of the outside air system is straightforward.

* All controllers other than Controller:OutdoorAir are moved up to the primary air system level, where they are simulated with the primary air system controllers.

* The Controller:OutdoorAir is simulated.

* The compnents contained in the outside air system are simulated in the order of their input in the AirLoopHVAC:OutdoorAirSystem:EquipmentList.

Outdoor Air Mixer
-----------------

The OutdoorAir:Mixer is the fundamental component of the outside air system. There should always be one OutdoorAir:Mixer in an AirLoopHVAC:OutdoorAirSystem. The outside air mixer splits the primary air system (AirLoopHVAC) return air into relief and recirculated air streams. Then it mixes the outside air stream with the recirculated air stream to obtain the mixed air stream. The outdoor air mixer has 2 inlet flow nodes: the return air node and the outside air node. It has 2 outlet flow nodes: the relief air node and the mixed air node.

### Simulation

Given the air mass flow rates and conditions (humidity ratio, specific enthalpy) at the return air node, relief air node, and outside air node, the simulation uses mass and energy balance to calculate the air mass flow rate, humidity ratio, and specific enthalpy at the mixed air node. The mixed air temperature is calculated from the mixed air humidity ratio and specific enthalpy using the EnergyPlus psychrometric routine *PsyTdbFnHW*.

Zone Equipment Simulation
-------------------------

When the EnergyPlus HVAC simulation manager needs to simulate the zone equipment side of the air loop it calls *ManageZoneEquipment*, the zone equipment simulation manager subroutine. Like the other managers, *ManageZoneEquipment* has a very simple structure:

```
        IF (GetInputFlag) THEN
          CALL GetZoneEquipment
          GetInputFlag = .FALSE.
        END IF

        CALL InitZoneEquipment(FirstHVACIteration)

        IF (ZoneSizingCalc) THEN
          CALL SizeZoneEquipment
        ELSE
          CALL SimZoneEquipment(FirstHVACIteration, SimAir)
        END IF

        CALL RecordZoneEquipment(SimAir)

        CALL ReportZoneEquipment

        SimZone = .False.

        RETURN
```
1. If the user input data has not been input, get the data and store it in the zone equipment data structures

2. Perform zone equipment initialization calculations.

3. If calculation of the design zone air flow rates and loads needs to be done, do it. The results of this calculation are stored in the zone sizing data structures and used by the component automatic sizing algorithms and the central system sizing calculations.

4. Otherwise simulate all of the zone equipment.

5. Transfer the zone equipment outlet node data to the inlet nodes of the primary air systems and check for convergence (done in RecordZoneEquipment by calling UpdateHVACInterface).

### Input data

The input specifying a set of zone equipment consists of:

1. the ZoneHVAC:EquipmentConnections object data;

    a. the zone connection to the air loop – air inlet nodes, exhaust nodes, outlet node, zone node;

    b. the components serving each zone – air terminal units, fan coils etc.;

2. zone supply air path data;

    a. zone splitters and supply plenums;

3. zone return air path data;

    a. zone mixer and return plenums;

### Initialization Calculations

#### One Time Calculations

There are no one time calculations for zone equipment

#### Begin Environment Initializations

For each controlled zone initialize the zone inlet, exhaust and zone nodes to standard conditions. Namely:

<div>$${T_{node}} = {20^{\rm{o}}}C$$</div>

<div>$${W_{node}} = {W_{oa}}$$</div>

<div>$${h_{node}} = {\mathop{\rm PsyHFnTdbW}\nolimits} {\rm{(}}20.0,{W_{oa}}{\rm{)}}$$</div>

<div>$${\dot m_{node}} = 0$$</div>

<div>$$Q{u_{node}} = 1.0$$</div>

<div>$${p_{node}} = {p_{oa}}$$</div>

where *W<sub>oa</sub>* is the humidity of the outside air; <span>${\rm{PsyHFnTdbW}}$</span>is the EnergyPlus psychrometric function for enthalpy *h*, given temperature and humidity ratio; *p<sub>oa</sub>* is the pressure of the outside air; and *Qu* is quality.

#### System Time Step Initializations

For each controlled zone, set the exhaust nodes conditions equal to the zone node conditions; except set the exhaust nodes mass flow rate and min and max available mass flow rates to zero.

### Simulation

The subroutine *SimZoneEquipment* does the actual simulation of all the zone equipment. Note that this includes components that are part of the demand side of an air loop as well as components that are independent of any air loop.

For zone equipment components that are part of the demand side of an air loop the simulation sequence is effectively performed in the direction of the air flow. First the supply air plenums and zone splitters are simulated in their input order. Then the air terminal units are simulated followed by the zone return plenums and zone mixer. Each air terminal unit sets its inlet node to the air mass flow rate required to satisfy its zone load. These mass flow rates are then passed back upstream to the air loop demand-side inlet nodes at the end of each zone equipment simulation sequence. These demand-side inlet mass flow rates are then used as mass flow rate setpoints in the air loop supply-side simulation.

If multiple air-conditioning components are attached to a zone, the components are simulated in the order specified by the user assigned priority given in the ZoneHVAC:EquipmentList object.

For each full air loop there should be 1 supply air path for each primary air system outlet (i.e. 1 for single duct systems,  2 for dual duct systems). For each full air loop there should be one return air path. The supply air paths consist of any combination of zone splitters and zone supply air plenums as long as it forms a tree structure with the supply air path inlet node the root and the air terminal unit inlet nodes as the leaves. The return air path configuration is limited to a single mixer; there may be multiple return plenums.

1. Loop over all the supply air paths.

    a. Loop over each component (supply plenum or zone splitter) on the supply air path and simulate each component. The components are simulated in input order.

2. Loop over all the controlled zones.

    a. Set the required system output.

    b. Loop over the components serving the zone in the user prioritized order.

        i. Simulate each component.

        ii. Increment the required system output.

3. Loop over all the supply air paths

    a. Loop over the components on each supply air path in reverse input order. This reverse order simulation passes the air terminal units inlet mass flows back upstream to the return air path inlet node.

    b. Check to see if the supply air path inlet node mass flow rate has changed. If it has set the *SimAir* flag to *true*. This signals the HVAC manager that the supply-side of the air loop needs to be resimulated.

4. Calculate the zone air flow mass balance – the zone inlet and exhaust mass flow rates are summed and the zone node and return air node mass flow rates are determined by a mass balance for each zone.

5. Calculate the conditions at each zone return air node. Here energy not included in the zone energy balance such as light-heat-to-return-air is added to the return nodes of the controlled zones.

6. Loop over all of the return air paths.

    a. Loop over each component (return plenum or zone mixer) on the return air path and simulate each component.

This completes a single simulation sequence of all the zone equipment.

Air Path Components
-------------------

### Overview

The air path from the outlet of an AirLoopHVAC (the supply side of a full air loop / central air system) to the zone air distribution units (terminal units) is specified in a AirLoopHVAC:SupplyPath. The AirLoopHVAC:SupplyPath consists of AirLoopHVAC:ZoneSplitters and AirLoopHVAC:SupplyPlenums hooked together outlets to inlet.

The air path from the zone return nodes to the AirLoopHVAC inlet node is described in a AirLoopHVAC:ReturnPath object. The  AirLoopHVAC:ReturnPath consists of AirLoopHVAC:ZoneMixers and AirLoopHVAC:ReturnPlenums hooked together outlet to inlets.

### Zone Supply Air Path

The AirLoopHVAC:SupplyPaths are simulated just before the zone equipment is simulated and just after the zone equipment is simulated (in module ZoneEquipmentManager, subroutine SimZoneEquipment). In both cases the simulation consists of looping over all the AirLoopHVAC:SupplyPaths and simulating each component (AirLoopHVAC:ZoneSplitter or AirLoopHVAC:SupplyPlenum) in the path. For the “just before” simulation a flag *FirstCall* is set to *True* which tells the zone splitter and zone supply plenum models to do a downstream simulation (pass component inlet conditions to component outlets, except for air mass flow rate). For the “just after” simulation, *FirstCall* = *False*, which tells the components to do an upstream simulation (set the component inlet air mass flow rate to the sum of the component outlet air mass flow rates, do nothing with other properties).

### Zone Splitter

The AirLoopHVAC:ZoneSplitter divides an inlet air stream into multiple outlet streams. Its data and simulation model are encapsulated in the module *SplitterComponent*. There are two simulation modes. If *SimAirLoopSplitter* is called with input parameter *FirstCall* = *True* then the splitter is simulated in downstream mode. The outlet air streams’ humidity ratio, pressure, enthalpy, and temperature are set to the conditions on the inlet air stream.  If *SimAirLoopSplitter* is called with input parameter *FirstCall* = *False*, the splitter is simulated in the upstream mode. In this case the inlet air stream air mass flow rate is set to the sum of the outlet air mass flow rates. The same calculation is done for the maximum available and minimum available air flow rates.

### Zone Supply Plenum

The AirLoopHVAC:SupplyPlenum acts analogously to the AirLoopHVAC:ZoneSplitter. The only difference is that the AirLoopHVAC:SupplyPlenum is associated with a Zone for which it sets the supply air flow rate and from which it gets its outlet air conditions. The AirLoopHVAC:SupplyPlenum divides an inlet air stream into multiple outlet streams. Its data and simulation model are encapsulated in the module *ZonePlenum*. There are two simulation modes. If *SimAirZonePlenum* is called with input parameter *FirstCall* = *True* then the plenum is simulated in downstream mode. The outlet air streams’ humidity ratio, pressure, enthalpy, and temperature are set to the zone conditions.  If *SimAirZonePlenum* is called with input parameter *FirstCall* = *False*, the plenum is simulated in the upstream mode. In this case the inlet air stream air mass flow rate is set to the sum of the outlet air mass flow rates. The same calculation is done for the maximum available and minimum available air flow rates.

### Zone Return Air Path

The AirLoopHVAC:ReturnPaths are simulated after all the zone equipment is simulated (in module ZoneEquipmentManager, subroutine SimZoneEquipment). The simulation is accomplished by a call to *SimReturnAirPath* (in module *ReturnAirPathManager*). The simulation just consists of looping over all the AirLoopHVAC:ReturnPaths and simulating the components (AirLoopHVAC:ZoneMixer or AirLoopHVAC:ReturnPlenum) in each path.

### Zone Mixer

The AirLoopHVAC:ZoneMixer combines multiple inlet air streams into a single outlet air stream. Its data and simulation model are encapsulated in the module *MixerComponent*. The following mass and energy balance equations are used.

<div>$${\dot m_{air,out}} = \sum\limits_{i = 1,n} {{{\dot m}_{air,in,i}}} $$</div>

<div>$${\dot m_{air,out}}\cdot {W_{air,out}} = \sum\limits_{i = 1,n} {{{\dot m}_{air,in,i}}} \cdot {W_{air,in,i}}$$</div>

<div>$${\dot m_{air,out}}\cdot {h_{air,out}} = \sum\limits_{i = 1,n} {{{\dot m}_{air,in,i}}} \cdot {h_{air,in,i}}$$</div>

<div>$${\dot m_{air,out}}\cdot {P_{air,out}} = \sum\limits_{i = 1,n} {{{\dot m}_{air,in,i}}} \cdot {P_{air,in,i}}$$</div>

<div>$${T_{air,out}} = PsyTdbFnHW({h_{air,out}},{W_{air,out}})$$</div>

Where <span>$\dot m$</span>is air mass flow rate, *W* is humidity ratio, *h* is specific enthalpy, *P* is pressure, and *T* is temperature. *PsyTdbFnHW* is the EnergyPlus psychrometric function for drybulb temperature as a function of enthalpy and humidity ratio. The air mass flow rate calculation is also done for the maximum and minimum available mass flow rates.

### Zone Return Plenum

The AirLoopHVAC:ReturnPlenum acts analogously to the AirLoopHVAC:ZoneMixer. The only difference is that the AirLoopHVAC:ReturnPlenum is associated with a Zone for which it sets the supply air flow rate and from which it gets its outlet air conditions. The AirLoopHVAC:ReturnPlenum combines multiple inlet air streams into a single outlet air stream. Its data and simulation model are encapsulated in the module *ZonePlenum*. The outlet air mass flow rate is obtained from

<div>$${\dot m_{air,out}} = \sum\limits_{i = 1,n} {{{\dot m}_{air,in,i}}} $$</div>

The outlet air temperature, enthalpy, humidity ratio and pressure are set to the zone conditions.

In addition to its normal function of acting as an air stream mixer, the return plenum can have 2 types of special connection to upstream air terminal units.

(1) The user can model the effects of duct leakage in VAV single duct systems using the Simplified Duct Leakage Model (see ZoneHVAC:AirDistributionUnit for how to set up this model). After the normal outlet air flow calculation is completed as above, the calculation loops over the air distribution units connected to the zones that feed air to the plenum and adds in to the outlet air mass flow rate the leakage air flow rates from the upstream leaks defined in the ZoneHVAC:AirDistributionUnit inputs. This connection between the leaks and the plenum is not explicit: no extra nodes are defined in the return plenum or in the terminal unit.

(2) The user can model secondary (recirculated) air drawn from the plenum into a fan powered induction unit (AirTerminal:SingleDuct:SeriesPIU:Reheat or AirTerminal:SingleDuct:ParallelPIU:Reheat). In this case the connection is explicit: extra outlet nodes are defined in the return plenum which act as the secondary air inlet nodes for the terminal units. The recirculated air flow rates are set by the terminal units. The outlet return air is then:

<div>$${\dot m_{air,out}} = \sum\limits_{i = 1,n} {{{\dot m}_{air,in,i}}}  - \sum\limits_{j = 1,m}^{} {{{\dot m}_{air,recirc,j}}} $$</div>

Plant Load Profile
------------------

The LoadProfile:Plant object is used to simulate a scheduled demand profile. This can be useful when the building loads are already known. Demanded load and flow rate are schedules specified in the object definition. The load profile can specify heating and cooling loads. Cooling loads are entered as negative numbers. The actual load met is dependent on the performance of the supply loop components.

The LoadProfile:Plant object must be connected on the demand side of the plant loop. If desired, multiple LoadProfile:Plant objects can be combined in series and/or parallel.

### Calculation Model

The LoadProfile:Plant object calculates the outlet water temperature based on the inlet water temperature from the plant loop and user inputs for the scheduled plant load and the requested flow rate.  The calculation can be expressed with the equation:

<div>$${T_{out}} = {T_{in}} - \frac{{{Q_{load}}}}{{\dot m{c_p}}}$$</div>

where

<span>${T_{out}}$</span> = the outlet water temperature

<span>${T_{in}}$</span> = the inlet water temperature

<span>${Q_{load}}$</span> = the scheduled plant load

<span>$\dot m$</span> = the water mass flow rate

<span>${c_p}$</span> = the specific heat of water

The user requested flow rate is not always available from the plant loop.  The actual flow rate used in the calculation is the lesser of the user requested value and the plant available value.

Note that the LoadProfile:Plant object can still request and receive flow even if the scheduled plant load is zero.  In this case the outlet temperature will be the same as the inlet temperature.  This allows users to drive the plant loop flow without necessarily affecting the loop temperature.

For reporting purposes the energy consumption of the object is calculated using the equation:

<div>$$E = {Q_{load}}\Delta t$$</div>

where

<span>$E$</span> = the energy consumption

<span>${Q_{load}}$</span> = the scheduled plant load

<span>$\Delta t$</span> = the time step interval

Plant/Condenser Loops
---------------------

### Integration of System and Plant

In order to integrate the air handling system simulation with the zones simulation, methods were developed to model the system air loop and its interactions with the zones due to temperature controls and the relative difference between the zone and supply air temperatures. A similar situation is encountered when integrating the central plant simulation. Typically, the central plant interacts with the systems via a fluid loop between the plant components and heat exchangers, called either heating or cooling coils. In EnergyPlus the performance of the air systems and plant are interdependent because the simulations are combined. The plant outputs must match the system inputs and vice versa. That is, the temperature of the chilled water leaving the plant must equal the temperature of the water entering the coils, and the chilled water flow rate must satisfy mass continuity. In addition, coil controls are usually necessary to ensure that the values of chilled water flow variables entering and leaving the coil remain in a reasonable range. Plants can also interact with each other so that the operation of a chilled water loop and chiller will affect the operation of a condenser water loop.

### Current Primary System Modeling Methodology

There are two main types of loops within the HVAC simulation in EnergyPlus: an air loop and a plant loop. The air loop is assumed to use air as the transport medium as part of an air handling system while the plant loops use a liquid fluid of the user’s choosing (typically water).  Condenser loops are a special case of plant loop that are for heat rejection and are distinguished by slightily different control options and applicable equipment types.  A user may have any number of each type of loop in a particular input file. There are no explicit limits on the number of loops within the program—the user is only limited by computer hardware. Execution speed will naturally vary with the complexity of the input file.

Plant loops are further divided into “half-loops” or “semi-loops” for organizational clarity and simulation logistics (see Figure “Connections between the Main HVAC Simulation Loops and Half-Loops”). These sub-loops, or half-loop sides, are matched pairs that consist of half of a main plant loop. Plant loops are broken into supply and demand sides. The plant demand side half-loop contains equipment that places a load on the primary equipment. This might include coils, baseboards, radiant systems, etc. The load is met by primary equipment such as chillers or boilers on the supply side half-loop. Each supply side half-loop must be connected to a demand side half-loop and vice versa. A similar breakdown is present on condenser loops where the demand side includes the water side of chiller’s condensers while the supply side includes condenser equipment such as cooling towers.

![](EngineeringReference/media/image1957.svg.png)

Figure 120. Connections between the Main HVAC Simulation Loops and Half-Loops.

The breakdown into two half-loops allows for better handling and control of information and simulation flow throughout the program. Direct connections between the half-loops of the air, plant, and condenser loops are enhanced by components with connections between the various main loop types. For example, coils (heating or cooling) are in reality heat exchangers with an air and a water or refrigerant side. The air side of the coil is handled within the air loop where the control of the device is also maintained. The fluid side of the coil is handled within the plant demand side, which passes the energy requirements of the coil on to the plant supply side. All loops are simulated together by successively modeling each half-loop in a particulary calling order. Overall iterations ensure that the results for the current time step are balanced and updated information has been passed to both sides of the sub-loops as well as across to the other side of air loop connections such as coils.

The plant equipment on a half-loop is described by a set of branches for that half-loop.  Components can be arranged on a branch in series, and branches can be placed in parallel, with some restrictions. Figure “Branch Layout for Individual Plant Half-Loops” provides an overview of the intended branch layout for each plant half-loop. Branches are individual legs within the loop structure. Thus, the segment between point A and point B is defined as a branch, as is the section between points E and F. There may be multiple sections (C1 to D1 through Cn to Dn) in between the splitter and mixer.

Each half-loop may only have one splitter and one mixer. Thus, equipment may be in parallel between the mixer and splitter, however, within any single branch, there can only be components in series and not in parallel. The topology rules for individual half-loops allow a reasonable amount of flexibility without requiring a complicated solver routine to determine the actual flow and temperature conditions. Note that since plant supply and demand are broken up into two separate half-loops, chillers or boilers may be in parallel to each other in the supply side and coils may be in parallel to each other on the demand side. Thus, the restriction of only a single splitter and mixer on a particular half-loop does not unduly limit the allowable configurations. In some cases a single branch can be used to define an entire half-loop, but in general a half-loop should have a splitter and a mixer even if all equipment on the sub-loop is simply in series.

In addition, to avoid the need for overly complex solver routines, there are some restrictions on the placement of pumps within a particular half-loop. There are two general types of pumps, loop pumps and branch pumps. A pump that is the first component on the first branch (between A and B) is termed a “loop pump” while any pump in the parallel section (between Ci and Di) is termed a “branch pump”.   The simplest and most common arrangement is to have one loop pump on the supply side inlet.  In plant demand half-loops pumps can be placed only in the inlet branch. This will allow simulation of primary-secondary systems. For more information on pumps and pump placement rules, see the section on PipingSystem:Underground Simulation Pumps in this document.

![](EngineeringReference/media/image1958.svg.png)

Figure 121. Branch Layout for Individual Plant Half-Loops

Essentially, each branch is made up of one or more components linked together in series. The branch has system nodes that store properties at a location on the loop (temperature, enthalpy, flow rate, etc.) at the beginning and end of the branch as well as between components. Components on the branch take the conditions of the node at their inlet and use that information as well as overall control information to simulate the component and write the outlet data to the node following the component. This information is then used either by the next component on the branch or establishes the outlet conditions for the branch.

Although the plant model in EnergyPlus is quite flexible, in most cases the topology of the plant system in the model will be somewhat different from the topology of the actual plant system in a building.  EnergyPlus is focused on modeling building energy performance over long periods of time and is not intended as a completely flexible system that can directly model any actual plant system with its full complexity and exact layout.  Given the design of an actual complex plant system, the modeler will typically need to develop a simpler system that conforms to EnergyPlus’s capabilities and strives to capture the issues important for energy consumption modeling.  Just like complex geometry should be simplified into thermal zones for energy models, complex plants should to be simplified into sets of pairs of closed half-loops with the allowed branch topologies.

### Plant Manager

#### Plant Half-Loop Calling Order

Because there can be multiple plant loops in a model that depend on each other, one job of the plant manager is to determine an appropriate calling order for the half-loops.  The intial starting calling order (and the order always used prior to EnergyPlus Version 7) is as follows:

1.    Call all the demand side half-loops of the plant loops (in input object order)

2.    Call all the supply side half-loops of plant loops (in input object order)

3.    Call all the demand side half-loops of condenser loops (in input object order)

4.    Call all the supply side half-loops of the condenser loops (in input object order).

This initial calling order is then revised during a setup phase of program execution when the plant component models are iteratively read in, initialized and sized.  The algorithm is based on information provided by those component models that connect loops together.  The components register that two loop-sides are connected and declare which one places demands on the other.  If a half loop is connected and places demands on anther loop, then the calling order for the independent demanding loop is placed just ahead of the dependent loaded half-loop.  For example a water cooled chiller component model reports that the supply side of the chilled water loop is connected to the demand side of the condenser loop and that the chilled water loop places demands on the condenser loop.  The plant manger algorithm is iterative and repeatedly calls all of the half loops a total of four times.  After this setup phase, the calling order is fixed for the rest of the simulation.

### Plant Flow Resolver

#### Overview of the Plant Flow Resolver Concept

An important aspect of the solution procedure within plant loops is the method used to solve for the fluid flow rates throughout the various half-loops. This involves making the supply side meet a particular load and flow situation based on the simulation of the demand side loops. Load distribution is an issue that must be addressed as well as how flow rates are adjusted and temperatures are updated. These issues are discussed in the next several subsections, and the algorithms described are important to how the plant simulation functions.

In the first step, the plant loop manager calls the appropriate module to simulate (in flow order) all of the components on each branch of the loop except for splitters and mixers. In this step, each component would set the conditions at the outlet node including temperature, flow rate, maximum allowed (design) flow rate, minimum allowed (design) flow rate, maximum available flow rate, and minimum available flow rate. This would be based purely on the component’s own control scheme and thus each component would be free to request as much (or as little) flow as desired.

In the second step, the loop manager would resolve the flow at all nodes and through all branches of the local loop. The components are then simulated with the corrected flows. For this iteration, the flow resolver sets the flow rate through each loop component.

#### Overall Loop Flow Rate

The plant models determine an overall fluid flow rate for each loop based on the dynamic requests and needs of the components on the loop.  The flow resolver examines the requests and needs of each half-loop and chooses an overall flow rate.  As individual plant components are modeled, they register their requests for fluid flow which are stored on the inlet node (variable called MassFlowRateRequest).   These requests for flow are used for two purposes, overall loop flows and resolution of parallel flows inside a splitter/mixer.  For determining the overall loop flow request, the requests by individual components are further qualified into three categories based on the nature of the device.

1.    Need flow and turns loop on

2.    Need flow if loop is already on

3.    Take what ever flow they get.

The loop will only run at all if there are flow requests of type 1.  If there are flow requests of type 2, they will not turn on the loop but may affect the overall flow rate if it is already on because of some non-zero type 1 requests.  Flow requests of type 3 will not affect the overall loop flow rate.  These classifications are hard coded and cannot be altered by the user.

#### Pump Control for Plant and Condenser Loops.

The pump is quite simply the component that drives the flow (also see PipingSystem:Underground Simulation Pumps). . How it reacts depends on several different conditions. In total, there are three different decision variables, two of which are defined by user input. These three deciding factors are whether the pump is constant or variable speed, whether the pump operation is continuous or intermittent, and whether or not there is a request for overall loop flow. After the overall loop flow request has been determined the simulation knows what the loop would like to do.  The next thing it does is simulation all the loop pumps to see what the pumps can actually provide. Then the overall loop flow is bounded by the minimum and maximum that the loop pumps can provide at that time. The operation of a constant speed pump is fairly straightforward. If the user designates a constant speed pump that is operating continuously, the pump will run regardless of whether or not there is a load. This may have the net effect of adding heat to the loop if no equipment is turned on. If the pump is constant speed and operates intermittently, the pump will run at its capacity if a load is sensed and will shut off if there is no load on the loop.

A variable speed pump is defined with maximum and minimum flow rates that are the physical limits of the device. If there is no load on the loop and the pump is operating intermittently, then the pump can shutdown. For any other condition such as the loop having a load and the pump is operating intermittently or the pump is continuously operating (regardless of the loading condition), the pump will operate and select a flow somewhere between the minimum and maximum limits. In these cases where the pump is running, it will try to meet the flow request for the overall loop.

In many cases, the first estimate of flow requested by the demand side tends to be fairly accurate and the flow rate does not vary in subsequent iterations. However, because there is the possibility that the coils or some other component might request more flow in future iterations during the same time step, the program must not only set flow rates but also maintain a record of the current maximum and minimum flow rate limits. This information is important not only to the pump itself but also to other pieces of equipment which may control their flow rates and thus require knowledge of the limits within which they may work. In general, the decisions on what to set the maximum and minimum flow rates is directly related to the type of pump (constant or variable speed). For constant speed pumps, the maximum and minimum flow rate values are the same and thus if the flow requested does not match this, the other components must either deal with the flow or a bypass branch must be available to handle the excess flow. For variable speed pumps, the maximum and minimum flow rates are set by the user-defined limits.

#### Plant/Condenser Supply Side

Component models, such as boilers, chillers, condensers and cooling towers are simulated on the supply side of the plant and condenser loops. In order to allow specification of realistic configurations, the plant loop managers were designed to support parallel-serial connection of component models on the loop. In addition, loop managers were designed to support both semi-deterministic models (e.g. the parameter estimation models of the ASHRAE Primary Toolkit [Pedersen 2001]) and “demand based” models (e.g. the performance map models of BLAST and DOE2.1E). As a result, the loop manager must be able to simulate models that require the mass flow rate as an input and models that calculate the mass flow rate as an output—sometimes in the context of a single loop configuration.

In order to achieve these design criteria without resorting to a pressure based flow network solver in the HVAC portion of the code, a rules-based “flow resolver” was developed for the EnergyPlus plant manager. The flow resolver is based on the following assumptions and limitations:

* Each loop is only allowed to have a single splitter and a single mixer

* Due to the fact that there can only be one splitter and one mixer on a given loop, it follows logically that there can be at most one bypass on each loop side

* No other components may be in series with a bypass, i.e., a branch that contains a bypass may have no other equipment on that branch

* Equipment may be in parallel only between the splitter and mixer components of a loop

* Equipment may be hooked together in series in each branch of the loop

* Flow rates on individual branches will be controlled using maximum and minimum available flow rate limits

The flow resolver employs a simple predictor-corrector algorithm to enforce mass continuity across the plant loop splitter as shown in the following figure.

![](EngineeringReference/media/image1959.png)

Figure 122. Plant/Condenser Supply Side Solution Scheme.

As previously discussed, the pump establishes the total loop mass flow rate by setting the flow in the first supply side branch. In the second step, a predictor algorithm calls to simulate each piece of equipment on the loop and they update their mass flow rate requests based on the current flow rates, temperatures and load dispatch requests. The loop manager calls the appropriate module to simulate (in flow order) all of the components on each branch of the loop except for splitters and mixers. In this step, each component sets the conditions at its outlet node including temperature and sets component flows on the inlet node.   Each component and branch is classified for their type of flow control.  Prior to version 7 this was input by the user where branch objects were tagged in the user input file as an ACTIVE, SERIESACTIVE, PASSIVE or BYPASS type of model.  As of version 7 this has been hard coded and the input is no longer used.  An ACTIVE flow control type describes a demand based plant model that calculates mass flow rate as an output. An ACTIVE component when OFF will shut down the whole branch irrespective of the type of other components on the branch. A SERIESACTIVE branch is like an ACTIVE component except that there are more than one ACTIVE components on the branch so that two components requests may be at odds with each other and so it might not shut down the whole branch when the component is OFF. The flow resolution algorithm is same for both ACTIVE and SERIESACTIVE components and in the rest of the document description of one type will fit the other type too. A PASSIVE type describes a semi-deterministic model that is simulated with the mass flow rate as an input. The BYPASS type designates a loop bypass.

The predictor algorithm first establishes the desired flow rate of each branch by searching for ACTIVE components on the branch. The first ACTIVE component in simulation order sets the desired branch flow. Branches with only PASSIVE components require a flow rate between the minimum and maximum allowable branch flow. Branches with a BYPASS component have a branch flow only when all other branches combined cannot handle the entire loop flow.

The loop flow resolver  makes any necessary “corrections” to the requested branch flows in order to enforce overall continuity on the loop. If mass conservation allows all ACTIVE branches to be satisfied, then the remaining flow is divided between the PASSIVE branches and as a last resort, the BYPASS. If there is insufficient flow to meet the branch demand, ACTIVE branch requests are met first in the order that the branches appear in the branch list in the input file.

The flow rate is resolved first for each individual branch. For every branch, the program cycles through each node on the branch and determines what the flow requests and flow limits are. The most restrictive flow constraints are assumed to be valid for the entire branch regardless of component type. Active components are given highest priority for requesting a particular flow rate. If there is more than one active component on a particular branch, then it is assumed that the active component on the branch with the highest flow request dictates the flow request for the entire branch.

Once all of the branches have set their flow rates and constraints, the splitter and mixer must resolve the various flow requests. The mixer and any branch following the mixer is passive. Thus, all of the flow control happens at the splitter. The splitter first attempts to sum the maximum and minimum constraints from all of the active branches coming out of the device and compares those to the constraints that are valid for the branch leading into the splitter. When there is a mismatch between the outlet constraints and the inlet constraints, the simulation will defer to the inlet constraints due to the fact that the pump is in reality controlling flow on the loop. Since the constraints of the pump would be passed across to the demand side from the supply side, an assumption is made that the coils or other demand side components must live within the bounds of the pump.

Once the flow has been resolved at the splitter, the branch flow rates and constraints between the splitter and mixer can be adjusted, if necessary. In some cases, this will be mandatory to maintain a mass balance at the splitter. When the flow rate coming out of the splitter does not match the active branch requests, individual branch flow rates must be adjusted to provide for the extra flow or the “flow deficit”. When there is extra flow, the excess flow is sent through any bypass branch first and then is sent to passive branches in reverse order of their appearance in the splitter outlet list. When all of these branches have been exhausted and there is still excess flow, flow will be increased to the active branches, also in reverse order. The reverse order guarantees that the branch appearing first has the highest priority to receive the flow rate it has requested.

if there is not enough flow to meet all active branch requests (i.e., a “flow deficit”), then the flow rates through the bypass and passive branches are set to zero. The flow rates through the active branches will then be decreased in reverse order until the splitter outlet flow rate matches the available flow at the splitter inlet. For a plant loop flow deficit, the bypass and passive branch flows are also set to zero, and flow rates for each active branch are calculated as follows:

<div>$${\dot m_{br}} = \frac{{{{\dot m}_{br\_request}}}}{{{{\dot m}_{tot\_request}}}}*{\dot m_{tot\_available}}$$</div>

where:

<div>$$
  \begin{array}{rl}
    \dot m_{br} &= \rm{ final resolved branch flow rate} \\
    \dot m_{br\_request} &= \rm{ requested branch flow rate } \\
    \dot m_{tot\_request} &= \rm{ total loop mass flow rate request} \\
    \dot m_{tot\_available} &= \rm{ total loop mass flow rate available}
  \end{array}
$$</div>

It is also necessary to monitor the flow constraints at the branches and components since once the flow rates are changed, the components must be resimulated by the controlling loop (air loop, zone equipment, or plant supply side). The controllers for these components must know if the constraints have been modified so that the simulation does not toggle between a component requesting a flow that the pump cannot meet and the pump then resetting the flow to what it can provide. Note that once a flow rate for any component has changed that this signals the need to resimulate any sub-loop to which it might have an indirect connection. Currently, this means that if a flow rate on the plant demand side changes, the simulation must recalculate the conditions on both the air loop and zone equipment sub-loops since coils and other equipment could be on either side of the main air loop. Similarly, if the condenser demand side simulation results in a change in flow rate through a chiller condenser, then the plant supply side must be triggered to perform its calculations again. Care has been taken to avoid cases where the various half-loops might simply keep triggering the resimulation of their indirect connections in an infinite loop.

#### Loop Capacitance and Pump Heat

The plant model includes simplified methods of modeling fluid capacitance and the temperature rise because of pumping and friction. The transition from load or energy based plant models to a loop based arrangement makes variables of both the flow rate and the fluid temperature. This means there are more degrees of freedom that must be controlled. The flow resolver concept discussed previously controls the fluid flow rates through the components and maintains an overall mass flow balance through the loop. However, the temperatures still need to be controlled and modeled. A purely iterative procedure can be expected to converge to the appropriate loop temperatures, but the procedure can become slow to converge under conditions where the demand changes rapidly or the supply components may not have enough capacity to meet the system demand. This situation is somewhat analogous to that existing in the link between the zone and the air system. In that case, the convergence and stability of the iterative solution was greatly improved by adding the thermal capacitance of the zone air and other fast responding mass within the zone. Based on that experience, it was decided to add thermal capacitance to the plant loop model to benefit from the added stability. Because the thermal capacitance in the zone/system interaction is relatively small, it was necessary to use a third order numerical solution there. Although the plant loop’s fluid thermal capacitance is relatively high, the fluid flows also have high heat capacity and can change temperatures rapidly a simple first order solution was not found to be satisfactory and an exact analytical solution was needed.

In realistic conditions there is often some delay between changes in supply conditions and corresponding changes at demand side components due to the transport of fluid round the loop having a finite velocity.

The act of pumping fluid around a loop adds heat to the fluid through friction.  The slight warming occurs at the pump and all around the circuit.  The amount of heat is equal to the work done on the fluid by the pump.  This so-called pump heat is a complicating factor in plant simulation because the pump heat alters the load on primary equipment.  A simple method of accounting for pumping heat is needed that doesn’t increase the difficulties of the numerical solution and (as of version 7) in EnergyPlus this accomplished by including the pump heat in the loop capacitance model.

Plant loops include a simple loop capacitance model to simulate these effects based on a well-stirred tank model. Each half-loop has a well-stirred tank located at its inlet as indicated in Figure 123. The temperature of the tank is modeled as a function of the tank mass, inlet fluid flow rate and temperature, and pump heat.  No energy is lost or gained because of storage in the loop capacitance.



![Loop Capacitance.tif](EngineeringReference/media/image1962.png)

Figure 123. Loop Capacitance Tank Models

The total plant loop volume is separated into two tanks, on on each half-loop inlet. For normal loops (without common pipes) each tank is one half of the plant loop volume. For common pipe plant loops, the tank on the supply side inlet has three fourths of the volume and the tank on the demand side inlet has one fourth. Each plant loop is assigned a total fluid volume as user input or an autocalculate routine based on the design flow rate. The size of the thermal capacitance affects the speed of recovery from situations where the setpoint was not maintained. The user must estimate a fluid volume based on the size of the pipes in the loop. Note that rough estimates seem to be sufficient. Loop capacitance (m<sup>3</sup>) could be calculated from pipe size data but this is not usually known. If zero capacitance is specified the above formulation reduces to an instantaneous update in demand update temperature and the demand inlet temperature becomes the supply outlet temperature at the previous time step. If a very large capacitance is specified unrealistic time delay may result and there may be poor response to changes in loop setpoint temperature. The loop capacitance ‘autocalculate’ option gives reasonable values and is calculated as follows,

<div>$$Capacity = \frac{{{{\dot m}_s}*{t_{sys}}*3600}}{{0.8\rho }}$$</div>

The tank temperature is modeled by drawing a control volume and energy balance around the tank and solving for the temperature.  The temperature of each tank is recalculated whenever the two half-loops are interfaced together. The tank temperature history is stored at the end of the simulation timestep.  The model equation for tank (and outlet temperature) is formulated as follows:

<div>$${T_{tank,new}} = \frac{{\dot m{c_p}{T_{inlet}} + \frac{{{M_{tank}}{c_p}{T_{tank,old}}}}{{{t_{sys}}3600}} + {{\dot Q}_{pumpheat}}}}{{\mathop {m{c_P} + }\limits^ \frac{{{M_{tank}}{c_p}}}{{{t_{sys}}3600}}}}$$</div>

The tank temperature at the end of the simulation timestep is solved by the analytical approach and expressed as

<div>$$T_{tank}^t = \left( {T_{tank}^{t - \delta t} - \frac{{\dot m{c_p}{T_{inlet}} + {{\dot Q}_{pumpheat}}}}{{\dot m{c_p}}}} \right)\exp \left( { - \frac{{\dot m{c_p}}}{{{M_{tank}}{c_p}}}t} \right) + \frac{{\dot m{c_p}{T_{inlet}} + {{\dot Q}_{pumpheat}}}}{{\dot m{c_p}}}$$</div>

where:

<span>$T_{tank}^{t - \delta t}$</span>          = Previous system time-step tank temperature [°C]

<span>$T_{tank}^t$</span>           = Current tank and tank outlet temperature [°C]

<span>$\dot m$</span>              = Current fluid mass flow rate through the tank [kg/s]

<span>$\delta t$</span>             = Duration of system time step [second]

<span>${c_P}$</span>             = Heat capacity of fluid [J/kg]

<span>${M_{tank}}$</span>         = Mass of the water in the tank [kg]

<span>${\dot Q_{pumpheat}}$</span>    = Heat generated by a pump in the tank [W]

When modeling plants using one of the common pipe modes for plant loops, the same tank model is used but the tanks are situated differently and account for extra connections.  For common pipe situation, the tanks are located on the outlet of a half loop with common pipe interactions downstream of the tank.

The average temperature is reported as the tank temperature. The average temperature is defined as the value of an integral function of tank temperature on an interval [*0*,*δt*]

<div>$$\mathop T\limits^ -   = \frac{1}{{\delta t}}\int_0^{\delta t} {T_{tank}^tdt} \;\; = \frac{{{M_{tank}}{c_p}}}{{\dot m{c_p}\delta t}}\left( {T_{tank}^{t - \delta t} - \frac{{\dot m{c_p}{T_{inlet}} + {{\dot Q}_{pumpheat}}}}{{\dot m{c_p}}}} \right)\left( {1 - \exp \left( { - \frac{{\dot m{c_p}}}{{{M_{tank}}{c_p}}}\delta t} \right)} \right) + \frac{{\dot m{c_p}{T_{inlet}} + {{\dot Q}_{pumpheat}}}}{{\dot m{c_p}}}$$</div>

#### Plant Flow Resolver Input

The input specifically related to the flow resolver consists of the plant BranchList and the plant ConnectorList as shown in the Input Output Reference. User defined names link the plant loop to its branches (contained in the BranchList) and define the loop splitters and mixers contained in the ConnectorList. The Connector:Splitter and Connector:Mixer syntax in turn define the relative connection of the branches to each other on the loop.

The Branch definition is input in simulation and connection order for all of the components on the branch. The simulation assumes that the inlet node of the first component listed on the branch is the branch inlet node and the outlet node of the last component listed on the branch is the branch outlet node. Examples of all the input syntax is shown in the Input/Output Reference for the appropriate object.

### Summary of Load Distribution Schemes

Five load distribution schemes are employed in EnergyPlus. The figure below illustrates the plant load distribution algorithm. The total loop demand is calculated and used in the **ManagePlantLoopOperation** routine to determine which equipment is available based on the supervisory control scheme specified by the user. Once all available components have been identified the loop demand is distributed to the available components based on the user specified load distribution scheme.

 ![](EngineeringReference/media/image1974.png)

Figure 124. Load Distribution Scheme



The OPTIMAL scheme first loads each component to its optimal part load ratio (specified in input). Any remaining loop demand is distributed evenly to all the components. The UNIFORMLOAD scheme first divides the load evenly among all available components. If some components do not have the capacity to meet the uniformly distributed load, the remaining load is divided among the remaining components. The SEQUENTIALLOAD scheme loads each component one at a time to capacity until the loop demand is met. The components are loaded up in the order that they appear in the equipment list specified in input. The UNIFORMPLR scheme loads all equipment uniformly by maintaining uniform part load ratios across all equipment on the equipment list. If the load is below the load required by the plant to operate at the largest component minimum part load ratio, the last item is removed from each equipment list. This process is repeated until the plant can operate above the largest component minimum part load ratio. The SEQUENTIALUNIFORMPLR scheme loads all equipment in the order specified on the equipment list to capacity while operating all operational equipment at uniform part load ratios.



*Note:* For all schemes, if the load for any individual component is less than the component load at the minimum PLR, the individual component model will false load or reduce duty cycle while operating at the minimum part load ratio until the load is met.

### Summary of Plant Loop Demand Calculation Schemes

There are two plant loop demand calculations schemes in EnergyPlus. There is a **SingleSetPoint** and a **DualSetPointDeadband**; the **SingleSetPoint** is the default if that field is left blank in the PlantLoop object. In the SingleSetPoint scheme the Plant Loop requires that a Setpoint Manager set a single setpoint value that sets Node%TempSetPoint. Examples of this Setpoint Manager would be: the objects SetpointManager:Scheduled, SetpointManager:OutdoorAirReset, etc. For the DualSetPointDeadband scheme the Plant Loop requires that a Setpoint Manager that sets the high and low setpoint values for Node%TempSetPointHi and Node%TempSetPointLo. Examples of this setpoint manager would be: SetpointManager:Scheduled:DualSetpoint. Look in the Input Output Reference for the correct usage of these SetpointManagers.

The Plant Loop Demand Calculation Scheme determines the amount of heating or cooling necessary to bring the temperature of the Plant Loop to its setpoint(s). When this value is determined then the Load Distribution scheme explained in the previous section takes this value and distributes the load to the appropriate equipment. The demand calculation scheme determines how the load is calculated. In the next section is a summary of the 2 algorithms and how they are used.

#### Loop Demand Calculation Scheme SingleSetPoint

The SingleSetPoint scheme for the PlantLoop takes the value that is placed on the Node%TempSetPoint and calculates the heating or cooling load necessary to obtain that setpoint.

        DeltaTemp    = LoopSetPoint - LoopTempIn

        LoopDemand = mdot \* Cp \* DeltaTemp

The sign of the Loop Demand determines if the loop has a cooling or heating load. Then the Load Distribution scheme distributes this calculated load to the appropriate equipment.

#### Loop Demand Calculation Scheme DualSetPointDeadband

The DualSetPointDeadband scheme for the PlantLoop takes the value that is placed on the Node%TempSetPointHi and Node%TempSetPointLo calculates the heating or cooling load necessary to obtain that setpoint; if in the DeadBand then no load is calculated. The pseudo code below shows the basis of the algorithm.

```
        !Calculate the demand on the loop
        IF (mdot > 0.0) THEN
          LoadtoHeatingSetPoint = mdot*Cp*(LoopSetPointLo - LoopTempIn)
          LoadtoCoolingSetPoint = mdot*Cp*(LoopSetPointHi - LoopTempIn)
          ! Possible combinations:
          ! 1  LoadToHeatingSetPoint > 0 & LoadToCoolingSetPoint > 0 -->  Heating required
          ! 2  LoadToHeatingSetPoint < 0 & LoadToCoolingSetPoint < 0 -->  Cooling Required
          ! 3  LoadToHeatingSetPoint < 0 & LoadToCoolingSetPoint > 0 -->  Dead Band Operation
          ! 4  LoadToHeatingSetPoint > 0 & LoadToCoolingSetPoint < 0 -->  Not Feasible
          IF (LoadToHeatingSetPoint .GT. 0.0 .AND. LoadToCoolingSetPoint .GT. 0.0) THEN
             LoopDemand = LoadToHeatingSetPoint
          ELSE IF (LoadToHeatingSetPoint .LT. 0.0 .AND. LoadToCoolingSetPoint .LT. 0.0) THEN
             LoopDemand = LoadToCoolingSetPoint
          ELSE IF (LoadToHeatingSetPoint .LT. 0.0 .AND. LoadToCoolingSetPoint .GT. 0.0) THEN
             LoopDemand = 0.0
          ELSE
             CALL ShowSevereError
          END IF
        ELSE
          LoopDemand = 0.0
        END IF

        IF(ABS(LoopDemand) < LoopDemandTol) LoopDemand = 0.0
```


The sign of the Loop Demand determines if the loop has a cooling or heating load. Then the Load Distribution scheme distributes this calculated load to the appropriate equipment, if there is any.

### Plant and Condenser Equipment Operation Schemes

Plants and condenser loops must have some mechanism for controlling the operation of the loop and which equipment is available under different operating conditions. Once the Loop load is calculated by the return conditions from the demand side and using the loop setpoint, this load needs to be allocated to the supply equipment according to the users input. This is mainly done by the operation schemes.

Each operation scheme must have the type of operation scheme, its identifying name, and the schedule that defines its availability. The first scheme appearing in the list is given the highest priority; the second scheme has second highest priority, etc. In other words, if according to its schedule, the first operation scheme is available, then it is used by the simulation to define how the plant or condenser loop operates. If it is not available, the second operation scheme in the list is checked to see if it is available until the highest priority scheme that is also available is found. See the Input Output Reference for input field details.

### Plant Operation Schemes

See the Input Output Reference for input field details. The options for plant control schemes are:

#### Uncontrolled Loop Operation

The PlantEquipmentOperation:Uncontrolled scheme takes the full capacity of the supply equipment and cools or heats the loop accordingly. An example would be a cooling tower where the cooling tower would cool the condenser loop with all of its available capacity and not be limioted by a capacity range or setpoint. Uncontrolled loop operation simply specifies a group of equipment that runs ‘uncontrolled’. If the loop runs, this equipment will run also, unless turned off by the loop flow resolver to maintain continuity in the fluid loop.

#### Cooling Load Range Based Operation or Heating Load Range Based Operation

PlantEquipmentOperation:CoolingLoad (or PlantEquipmentOperation:HeatingLoad) defines the different ranges and which equipment list is valid for each range. In each trio, there is a lower limit for the load range, an upper limit for the load range, and a name that links to an equipment availability list (PlantEquipmentList). Load range operation is used when the loop load is calculated and then the equipment is selected in the proper range. This allows for the most efficient operation of the plant equipment or for the user to determine the most efficient plant configuration. When the equipment list has been deteremined then the load is allocated to the equipment in a manner selected by the user with “Optimal or Sequential” load distribution scheme. The load range based operation scheme has two statements associated with it: a main statement that defines the ranges that individual priority settings are valid and the lists of equipment that may be used for each range.

### Condenser Operation Schemes

This is very similar to the plant operation schemes, but there are several more options avaible with the CondenserLoop. The condenser operation schemes apply to the equipment on the ‘supply side’ of the condenser loop—pumps, cooling towers, ground coupled heat exchangers, etc. The keywords select the algorithm that will be used to determine which equipment is available for each time step. The ‘*Range Based Operation’* schemes select a user specified set of equipment for each user specified range of a particular simulation variable. ‘*Load* *Range* *Based’*  schemes compare the demand on the condenser supply side with specified load ranges and associated equipment lists. ‘*Outdoor…Range Based’* schemes compare the current value of an environmental parameter with user specified ranges of that parameter. See the Input Output Reference for input field details.

#### Uncontrolled Loop Operation

The PlantEquipmentOperation:Uncontrolled scheme takes the full capacity of the supply equipment and cools or heats the loop accordingly. An example would be a cooling tower where the cooling tower would cool the condenser loop with all of its available capacity and not be limioted by a capacity range or setpoint. Uncontrolled loop operation simply specifies a group of equipment that runs ‘uncontrolled’. If the loop runs, this equipment will run also, unless turned off by the loop flow resolver to maintain continuity in the fluid loop.

#### Cooling Load Range Based Operation or Heating Load Range Based Operation

PlantEquipmentOperation:CoolingLoad (or PlantEquipmentOperation:HeatingLoad) statement defines the different ranges and which equipment list is valid for each range. In each trio, there is a lower limit for the load range, an upper limit for the load range, and a name that links to an equipment availability list (CondenserEquipmentList). Load range operation is used when the loop load is calculated and then the equipment is selected in the proper range. This allows for the most efficient operation of the plant equipment or for the user to determine the most efficient plant configuration. When the equipment list has been deteremined then the load is allocated to the equipment in a manner selected by the user with “Optimal or Sequential” load distribution scheme. The load range based operation scheme has two statements associated with it: a main statement that defines the ranges that individual priority settings are valid and the lists of equipment that may be used for each range.

#### Outdoor Drybulb Range Based Operation, Outdoor Wetbulb Range Based Operation,  Outdoor RHPercent Range Based Operation

The various “PlantEquipmentOperation:Outdoor\*” statements define the different ranges of the various environmental parameters and which equipment list is valid for each range. After the keyword and the identifying name, a series of data trios is expected. In each trio, there is a lower limit for the load range, an upper limit for the load range, and a name that links to an equipment availability list (the “CondenserEquipmentList”).

#### Outdoor Drybulb Temperature Difference Based Operation,. Outdoor Wetbulb Temperature Difference Based Operation



The various “PlantEquipmentOperation:Outdoor\*Difference” statements control strategies help to control any condenser equipment based on the difference between a reference node temperature and any environmental temperature. For example a cooling tower can be controlled by a strategy, which looks at the difference between the tower inlet temperature and wet-bulb temperature. A difference range is specified for each equipment list.

### Primary-Secondary Loop Systems

The method to simulate a primary-secondary system in EnergyPlus is termed Common Pipe.

#### Common Pipe

Common pipe feature eliminates the need of specifying two different EnergyPlus loops each for Primary and Secondary half loops. Instead the user can set up the system as it is used in real life applications. A common pipe simulation requires that pumps be placed on both Demand (Secondary) and Supply (Primary) sides of the loop. A typical Common Pipe layout as used in EnergyPlus is shown in figure 92. The major assumptions in the common pipe implementation are as follows:

* Pumps are placed on both demand and supply side of the loop.

* Secondary pump flow rate can be less than, equal to or greater than the primary pump flow rate.

* The flow at the inlet node of the half loop is equal to the flow at the outlet node of the half loop.

* The pumps can have different schedules and any loop can be shut off when the other loop is still running.

![CommonPipe](EngineeringReference/media/image1975.png)

Figure 125. Common Pipe Layout Schematic

Common pipe simulation is done during the interface update call at both Supply-to-Demand and Demand-to-Supply. Appropriate checks are used to make sure that the effect of flow reversal in between iteration is taken care of. Moreover, the common pipe keeps track of the flow rates and temperatures at all the four nodes linked to it; namely, the inlet and outlet nodes of each sub loop. This record will help to decide if loops have converged or not. In situations where the primary component meets the setpoint and the coil controls does not change its flow request, the common pipe converges quickly. The simple description of the control algorithm for common Pipe implementation is as follows:

1. At FirstHVACiteration, the common pipe flow is initialized to zero.

2. Common pipe is simulated at interfaces and thus we will have 2 different flows handle on either side of interface.

3. Loops and corresponding flow rates are assigned inlet or outlet (to common pipe) depending on the interface which calls it. So when common pipe is called from demand to supply interface, the inlet loop is demand side and outlet loop is supply side and vice versa.

4. Inlet flow is compared to outlet flow and the difference is set as the common pipe flow.

5. At each interface the common pipe flow is assigned a direction which can be into the interface (Inlet flow &lt; Outlet flow) or away from interface (Inlet flow &gt; Outlet flow).

6. Outlet temperature is calculated depending on the flow rate and flow direction. When flow is away from interface outlet flow temperature is same as inlet flow temperature. For a common pipe flow into the interface, the outlet flow temperature is calculated as mixed temperature of inlet flow and the common pipe flow.

7. At demand to supply interface, the supply side inlet node temperature and flow rate are updated every iteration. At supply to demand interface, only flow is updated. The temperature is updated only at the end of timestep.

8. Loops iterate till the flow and temperatures at all the 4 concerned nodes do not change.

#### Two-Way Common Pipe

A model referred to as Two-Way Common Pipe is available which provides a way to model Primary-Secondary systems as a single Plant Loop.  In a typical EnergyPlus plant loop simulation, the only half loop inlet/outlet node that is controlled is the supply side outlet node. In some cases this requirement becomes a limitation in analyzing different options. A good example is ice thermal storage application, where during charging phase, the coil setpoint can be different from the ice storage equipment setpoint. With this model, the interface between the two half loops includes two additional flow paths that essentially split a single plant loop into both primary and secondary loop sides.  Though the Two-Way common pipe is designed to be generic some assumptions apply in modeling the component. The assumptions are as follows

* The secondary flow may be less than, equal to, or greater than the primary flow.

* The mass flow rate at the Primary Side Outlet Node is always equal to the mass flow rate at the Primary Side Inlet Node.

* The mass flow rate at the Secondary Side Outlet Node is always equal to the mass flow rate at the Secondary Side Inlet Node.

* Only one additional node, either primary-side inlet or secondary-side inlet, (along with the primary-side/supply-side outlet node) can be controlled. The system of equations that describe the loop interface will be under specified if both the Primary and Secondary Inlet nodes have to be controlled.

Figure 126 shows a schematic of the Two-Way Common Pipe. There are two common pipe legs, shown as broken lines, allow for some recirculation at the half loop level.  The model allows for common pipe flow in either or both directions. The model determines flow rates in the common pipes and temperatures at nodes based on the following:

* Which additional node is being controlled to meet a temperature setpoint? If the primary-side inlet node is controlled, then the flows are controlled to deliver the desired temperature at supply side inlet. If the secondary-side inlet node is controlled then the flows are controlled to deliver the desired temperature at the demand side inlet.

* Is the specified setpoint achievable with current secondary and primary outlet conditions? If the setpoint is not achievable, then the flow in each common pipe leg is reduced to its minimum possible value.

* At the controlled node, with known demand outlet temperature, supply outlet temperature, primary flow rate and secondary flow rate, and energy balance is used to calculate recirculation flows in the common pipes for that particular half loop, so that the desired temperature setpoint is achieved.

* With a known flow in one common pipe leg, the flow on Primary to Secondary (or secondary to primary) is easily obtained by mass balance.

* When the Two Way Common Pipe is controlling conditions at the secondary-side, or demand side, inlet node, then the loop capacitance model usually used for the conditions at the demand inlet is not used as it would interfere with control.

![](EngineeringReference/media/image1976.svg.png)

Figure 126. Schematic of a Two-Way Common Pipe used in Primary-Secondary System.

### Heat Recovery Loop Systems

Heat Recovery is accomplished by specifying another set of supply and demand loops. Each of the heat recovery components, i.e. engine driven and combustion turbine chillers, and internal combustion and combustion turbine generators is designed to use the existing component/loop/solution structure to facilitate the simulation with the existing demand side manager and the supply side manager. Heat recovery normally contains components that produce heat that can be recovered, and the ability to store or use that heat elsewhere in the system. The component that can store the excess heat and allow it to be used elsewhere in the system or for domestic hot water is the Water Heater:Simple and is defined in the Input/Output Reference.

![](EngineeringReference/media/image1977.png).

Figure 127. Example of a Heat Recovery Loop Simulation

In the example above there is a chilled water Loop with chilled water supplied by a diesel engine driven chiller. There is a hot water Loop that is being supplied by the water heater: simple. There is also scheduled domestic hot water usage on the water heater which excess demand can be met by a number of user-specified heating sources. Then on the demand side of the heat recovery loop there is the engine driven chiller, internal combustion, and combustion turbine electric generators with specified mass flows to recover the heat. This hot water is pump on the supply side by the heat recovery pump and provides the heat to the water heater to meet the water heater setpoint. This is probably one of the more complex configurations and interactions that would take place in heat recovery, but using the Plant supply and demand side configurations this can be extended to meet most user configurations. The plant water heater can also be used to just meet scheduled domestic hot water use, provide a hot water source for PlantLoop equipment, or provide a hot water storage tank for heat recovery as a single function. Or any combination of the above can be configured. Example files of some of these configurations are provided with the installation.

### Plant Pressure Drop Simulation

As of version 4.0, there is an added feature which allows better calculation of pressure in plant and condenser loops. Without any method, the loops essentially ignore the node pressures. This is suitable for many applications, however may cause inaccuracies in the pump power. This is especially prominent in cases where the loop flow may change drastically over a wide range of configurations, as the pump power is based on a rated power value and rated pump head value. As the loop components turn on and off, the pressure drop will change, and so the pump power should be dynamically updated with these changes.

#### Overall model features:

Calculates loop pressure drop based on pressure drop information which is placed on branches. These are entered in terms of generic curves (linear, quadratic) or pressure drop information (minor loss/friction factor).

Loop pressure drop is used as the new pump head. No information is entered about the pump curve, so it is assumed that the pump will always be able to meet this operating point. Future enhancements will allow the pump to ride a curve based on the given pressure head.

Model does not resolve flow rates on parallel branches to match pressure drop, this is explained further below, but basically it takes the maximum pressure drop from parallel pressure components and applies that to all parallel components.

Model works for the following configurations:

1. Pump Location

2. Loop Pump

3. Branch Pumps

4. Loop Types

5. PlantLoop

6. CondenserLoop

The supply side inlet (before the pump) is always set to standard atmospheric pressure. This allows the node pressures around the loop to stay positive. The actual values of pressure are not all that important, it is the delta pressure that is of interest for our calculations, but this makes the pressure values appear realistic if one plots the pressure around the loop.

The pressure drop is at the branch level, not the component level. If multiple components are found on a single branch, the pressure drop is always applied to the last component on the branch. This is coordinated with the rule that a pump must always be the first component if it is found on a branch.

Calculations use the branch flow rate and the branch entering temperature to calculate properties for the whole branch.

#### Detailed Restrictions:

Pressure drop curves must not be placed on branches which only contain a pump. Pressure curves may be placed on the supply inlet branch with a pump as long as there are other components on that same branch, following the pump.

If using branch pumps, pressure drop curves found on the supply inlet branch will be ignored. Put pressure drop information after pumps.

Currently, pressure drop simulations are not allowed with common pipe (demand pump) simulations. A future version of the pressure drop system will allow this by allowing each pump to handle the pressure drop of the given loop side (demand or supply).

#### Detailed Calculation Steps:

Before the demand side is simulated, the pressure system is initialized. All node pressures are reset, and pressure drop values for branches are re-initialized.

After all components on a branch are simulated, the pressure drop for that branch is calculated. This pressure drop is registered in the pressure drop system to be used in subsequent loop level calculations.

Once the entire loop (demand then supply sides) is simulated, the loop level pressure drop calculations are performed using the following steps:

Beginning at demand side outlet (linked to supply inlet), and working backwards, the node pressure is updated and loop pressure is summed by “adding pressure drops” as they are found around the loop. By working backward, we are able to easily preserve the pump inlet pressure as a realistic value (standard atmospheric pressure).

When a parallel system is encountered, a special operation is performed. Since we are not resolving flows with this version of the pressure simulation, the parallel system is set to use the largest value of pressure drop found on the parallel branches. In this manner, the highest pressure drop component essentially governs the set of parallel branches, and the other components must match the pressure drop in order to achieve their desired flow rate. This is performed by placing “imaginary” valves in the splitter. This allows individual branches to report their own pressure information, while the splitter accounts for the required pressure drop to match the governing branch. This is shown graphically in the figure below.

![SplitterValves](EngineeringReference/media/image1978.png)

Figure 128: Explanation of valves inherently built into Splitter object

Because the splitter automatically handles the pressure drop required to match the pressures in the parallel system, the mixer will have uniform flow entering from all branches and exiting.

These calculations are performed around the loop and result in a value of pressure drop for the entire loop.

Pump power requires a value of pressure head before it can add heat to the loop, which is done before any components are calculated, and any pressure system calculations are performed. Because of this, the pump power is based on rated head during the first iteration. On subsequent iterations, the pump power is based on the dynamic pressure head calculated by pressure drop information.

If anything drastically changes between one iteration and the next, the loop will be re-simulated, and the latest value of pressure head will be used. By the time the loop is converged, the pressure head between the current and most previous iterations will agree to within simulation tolerance. Thus the pump is using a lagged value of pressure head, but once the loop is converged, the lagged and current values will agree.

#### Pressure Drop Calculations:

There are two types of pressure drop curves that can be entered, each with its own calculation engine:

Generic: A curve of any form (single independent variable) such as linear or quadratic may represent the pressure drop in Pascals as a function of current mass flow rate in kg/s. This is common for regressing component pressure drop such as heat pumps into a quadratic best fit form. The branch pressure drop is then calculated by evaluating this curve with the given branch flow rate.

Pressure Information: This calculation involves two types of pressure drop: frictional effects and minor losses. The governing equation is:

<div>$$\Delta P = \left( {f\frac{L}{D} + K} \right)\frac{{\rho {V^2}}}{2}$$</div>

The user enters value for the minor loss coefficient K to represent all the minor losses on that branch. If the user is entering friction information, the minor loss coefficient may be zero or blank.

The user enters roughness, e, or a fixed value of friction factor to account for frictional losses on the branch, as well as an equivalent length L. If the user enters roughness then the friction factor is calculated from a Moody chart approximation (Haaland, 1983):

<div>$$f = {\left\{ { - 1.8\log \left[ {{{\left( {\frac{{e/D}}{{3.7}}} \right)}^{1.11}} + \frac{{6.9}}{{{\mathop{\rm Re}\nolimits} }}} \right]} \right\}^{ - 2}}$$</div>

If the user enters minor loss information, then the friction factor information can be left out.

The diameter is an equivalent value and is used to calculate relative roughness for friction calculations as well as velocity for any pressure drop calculation.

#### Riding Pump Curves to Determine Loop Operating Point

In addition to being able to provide a means of calculating loop pressure drop, EnergyPlus can also perform a “loop-level” pump-system flow resolution.  The pressure drop components that were described in the previous sections are combined with the input of a dimensionless pump pressure-flow curve and at each iteration, these are utilized in determining a proper operating point for the loop.

Some restrictions do apply to this simulation.  As with the basic pressure drop simulation, common pipes are not valid in the current release.  For this pump curve phase, the simulation is also restricted to “loop pumps” such that pumps should not be used on the parallel branches between a mixer and splitter.

The idea of riding a pump curve, as it is currently implemented, is based on a constant speed pump.  A variable speed pump in EnergyPlus can already effectively vary its flow/pressure characteristics to meet the demand.  Thus, this phase is only implemented for the Pump:ConstantSpeed model.

The model works by approximating the loop with a quadratic pressure drop form, then iterating to find an operating point.  The entire plant loop then iterates to find the operating point that attempts to match the requested flows.  Note that when doing a pressure based pump simulation, the loop will likely not hit setpoint every timestep, while doing the simpler approach (non-pressure) may result in a tighter-controlled simulation.  In deciding this, you must consider the realism of the pressure approach vs. the non-pressure approach which may be more tightly controlled and will have less input requirements.

In the first iteration of the plant, there is not yet enough information to determine a pressure-flow simulation, so flow through the loop is set to the rated flow rate of the pump (irrespective of pump performance curve). For this rated flow rate pressure drop in each branch will be calculated by plant pressure system. So after this first pass through the loop, the pressure system now has a valid system flow-pressure point.  From this point (pressure drop in the branch and rated mass flow rate) a pressure constant for each branch is calculated assuming quadratic relationship between pressure drop and mass flow rate.

<div>$${K_{Branch(i)}} = \Delta {P_{Branch(i)}}/{m_{Rated}}^2$$</div>

If there are parallel branches then equivalent K is calculated from following formula.

<div>$$\frac{1}{{\sqrt {{K_{ParallelEquivalent}}} }} = \sum\limits_{j = 1}^m {\frac{1}{{\sqrt {{K_{Branch(j)}}} }}} $$</div>

From all these ‘K’ values of the branches a corresponding K value for complete loop is calculated. This representative K value for the loop will lock down a system curve for a single iteration.  This K value will change throughout the higher-level plant iterations and simulation time steps.

The Non-dimensional pump curve is entered in following way,

<div>$$\psi  = {C_4} \times {\varphi ^4} + {C_3} \times {\varphi ^3} + {C_2} \times {\varphi ^2} + {C_1} \times \varphi  + {C_0}.$$</div>

C<sub>1-4</sub> are curve coefficients with last mandatory non-zero constant term C<sub>0</sub> (as pump curve will not pass through origin).

The nondimensional variables in the previous equation are defined in terms of the following expressions:

Ψ – Non-dimensional pressure rise:  <span>$\psi  = \frac{{\Delta P}}{{\rho {N^2}{D^2}}}$</span>

φ - Non-dimensional flow:  <span>$\varphi  = \frac{{\dot m}}{{\rho N{D^3}}}$</span>

The user preprocesses mass flow and pressure values into these nondimensional forms in order to generate the curve fit.  The program then resolves the nondimensional forms into actual values based on the pump speed, diameter, and fluid density.  This gives the proper pressure-flow relationship for the simulation.

#### Pump-System Operating Point Flow Resolver:

The pressure drop components and the pump curve are described in the prior sections.  The routine which actually uses these curves to resolve to an operating point is described here.  This routine is called by the pump model as it is determining what flow it should be using.  The flow resolver reads the non-dimensional pump curve, loop pressure constant (K value) and rated mass flow rate (or mass flow rate from last iteration). The resolver finds the intersection of the two curves by successive substitution with 0.9 as a damping factor. If the flow rate is outside (or if in any iteration move out of) the range for which pump curve-fit is suggested, the resolver will bring the value within range, thus it is important to specify the curve-fit range (in terms of non-dimensional flow rate) for pump curve by the user.  It was observed that simple successive substitution (sometimes) diverges depending on shape of curves and/or location of operating point. Damping factor provides stability to successive substitution and it was observed that it converges for less number of iteration, speeding up the function. The damping factor was set as 0.9 as it showed full stability during testing, although a more optimum value may be available for a particular set of curves.  A future version may have an improved selection algorithm for the damping factor itself.

#### References

Haaland, SE. 1983. "Simple and Explicit Formulas for the Friction Factor in Turbulent Flow". Transactions ASIVIE, Journal of Fluids Engineering 103: pp. 89-90.

Steam Systems and Component Models
----------------------------------

A steam system uses the vapor phase of water to supply enthalpy or kinetic energy through the piping network.  In case of EnergyPlus, the steam system is designed to provide energy solely for the building heating requirements.  Hot steam from the boiler or steam generator in buildings can be used to heat a conditioned space with suitable heat transfer equipment such as fan-coils units, unit-heaters, radiators and convectors or steam can also heat water through shell and tube heat exchangers, and hot water can be supplied to the terminal units to provide the zone heating requirements.

The advantages that steam system offer over hot water or other heating systems are:

1. Steam flows through the system unaided by external energy source such as pumps; pressure difference moves steam across the system.

2. Steam, because of its low-density, can be used in high-rise buildings where water systems create excessive pressure.

3. Terminal units such as heating coils can be added or removed without making any changes to the system.

4. Steam components can be repaired or replaced by closing the steam supply without the difficulties associated with draining and refilling like in the water systems.

5. Steam is pressure-temperature dependent, therefore the system temperature can be controlled by varying either steam pressure or temperature.

6. Steam can be distributed through out the system without any change in temperature.

In view of the advantages mentioned, the steam systems are suitable for applications where heat is required for process and comfort heating such as in industrial plants, hospitals, restaurants, dry cleaning plants laundries and commercial buildings.  They are also suitable in places where the heating medium has to travel great distances such as in facilities with scattered building locations or where the building height would result in excessive pressure in a water system, or locations where the load changes occur intermittently.  Thus steam system is an essential and necessary development step for EnergyPlus.

From EnergyPlus simulation point of view, the advantage associated with a steam system is that steam can be distributed through out the system without change in temperature.  This means that the boiler outlet temperature can simply be set equal to the heating coil inlet temperature for a steam system.

Another simulation-based advantage associated with the steam system is Steam Quality, which does not change from boiler outlet to coil inlet.  Actual building steam systems are equipped with condensate drains through out the system, these drains remove, almost immediately any condensate that is formed during steam transportation, thereby maintaining the steam quality at constant value of 1.0 through out the high-pressure steam side.

The HVAC steam system implementation includes simulation models for two phase steam equipment like steam boiler, steam to air heating coils, steam pipes and condensate pumps, which can be connected to the generic loop framework.

### Steam Loop Assumptions

To replicate the working of an actual building steam system in a satisfactory manner with simulation, it was necessary to make certain assumptions.  These assumptions help simplify the loop complexity and increase usability.  The effects of the assumptions made are described in detail below.

The following figure describes the Temperature Entropy Ts diagram based on which the steam system operates in EnergyPlus.  The steam side of the loop operates on constant saturation pressure of steam: PSteam, the waterside of the loop operates at atmospheric pressure Patm.



![SteamSchematic](EngineeringReference/media/image1986.png)

Figure 129. Schematic of Temperature – Entropy Diagram for Steam loop

It should be noted that the figure is simply a schematic and not a scaled representation of the process on a Mollier Chart.  For the following descriptions, please refer to the schematic figure above.

*  Process 1–2 on the Ts diagram, represents condensation of steam in the coil at constant pressure; this is where the steam gives up latent heat to the zone.

*  Process 2–3 represents the subcooling of condensed steam at higher pressure, this subcooling takes place inside the steam coil, just before the steam trap.  The delta temperature represented by 2-3 is the degree of subcooling in the steam coil, and is a user input to the steam coil.  This subcool generally accounts for 1 to 2 % of the total heat transfer in the steam coil.

*  Process 3–4’ represents the isenthalpic expansion of water from high-pressure steam side to atmospheric pressure across the steam trap.  As steam gives up its latent heat at the steam coil the condensate that forms in the steam coil still exists at higher pressure.  This condensate is discharged to a lower pressure across the steam trap, this condensate contains more heat than necessary to maintain the liquid phase at the lower pressure, this excess heat causes some of the condensate to vaporize or flash to steam at lower pressure at some quality.  The amount of water that flashes to steam can be calculated by the following equation

<div>$$\% Flash\,\,Steam\,\, = \frac{{{h_{4'}} - \,{h_4}}}{{{h_{fg}}}}\,\, \times \,\,\,100$$</div>

Where h4’ is Enthalpy of liquid at steam pressure just before condensate is supposed to leave the coil.  Enthalpy at Point 3 is equal to enthalpy at point 4’, since it is an isenthalpic process, and  hfg is the latent enthalpy of the fluid at atmospheric pressure.

For example, water at 102LC and 120 Kpa flashes to steam at at100LC and atmospheric pressure, with quality equal to 0.003.  This results in loss of some latent capacity of steam and is one of the terms contributing to loop loss in steam system.

*  Process 4’- 4 represents the condensation of the flashed steam, which has exited from steam trap into the condensate drain.  Condensation occurs at atmospheric pressure Patm, there is loss in latent capacity due to this unavoidable process, only condensate can be returned back to the boiler in a steam system.

*  Process 4-5 represents the loop sub cooling at atmospheric pressure; this is the sub cooling of the condensate that takes place during condensate return to the boiler because the return loop is not insulated, loop sub cooling is of the order of 20LC to 30LC.  This is a user-defined input in every steam coil, because the variability in location of steam coils in a building will result in different condensate return temperatures for each of the coils.

*  Process 5-6 represents the temperature and pressure rise in condensate due to pump heat addition.  The pumping process generates heat, which is added to the condensate.  The condensate is pumped back to the boiler at higher pressure.

*  Process 6-2 represents the sensible heat addition by the boiler to the return condensate.

*  Process 2-1 represents the latent enthalpy of steam, added by the boiler to the water to convert it to steam at saturation pressure.

*  Point 3, which is outlet of the coil and Point 5, which is inlet of the pump are specified directly by the user, subsequently the loop losses in EnergyPlus are directly summed up as the enthalpy difference between point 3 and 5, which is calculated by fluid property routines in EnergyPlus.  This helps to maintain flexibility and at the same time helps negate the intermediate points calculation in the system.

Aspects of the steam loop such as quality of steam, steam pressure, and steam generation which play an important role in EnergyPlus simulation are described in following sections.

#### Constant Pressure Steam loop

The steam loop in EnergyPlus is pressure driven and it is assumed to operate at constant pressure on the gaseous-steam part, while the condensate return loop is assumed to operate at atmospheric pressure.  The steam loop essentially operates at saturation pressure corresponding to the steam temperature; the steam boiler serves to maintain the loop temperature.  The boiler model determines the amount of energy required to generate the required amount of steam.

Factors such as friction in pipes, which tend to cause small amount of pressure drop in steam loop are neglected in the model.  It is assumed that the steam pipes are fairly well insulated to prevent heat loss and subsequent condensation of steam in the pipes.  In actual systems small quantities of steam, which condenses due to heat loss during transportation is removed immediately from the system by steam drains.  This helps eliminate water hammer, degradation of steam quality and heat transfer capability.

#### Steam Generation at Saturated Conditions:

Building steam heating systems avoid supplying superheated steam because superheat damages the building HVAC equipment.  Superheated steam is generated only if there is a cogeneration power system in building such as steam turbine, which requires superheated steam.  The purpose of having superheated steam is redundant for building steam heating systems because the amount of energy carried by the same is negligible compared to the latent heat. A simple enthalpy calculation, based on each unit of steam mass flow rate (1 kg/s), has been provided in this section to describe the negligible effect of superheat..

Case 1: Loop Operating at Saturation Conditions (no superheat), calculating enthalpy of saturated steam at boiler outlet temperature.

Boiler Outlet Temperature = 105BC,

<div>$${h_{Case1:NoSuperheat}} = [{h_f}_{{{105}^ \bullet }C}]$$</div>

<div>$${h_{Case1:NoSuperheat}} = \,\,\,\,2684000\,\,\,\,\,\,J$$</div>

Case 2: Loop operating with Superheated steam, calculating enthalpy of superheated steam for 5BC superheat.

Degree of Superheat = 5BC

Boiler Outlet Temperature = 110BC,

<div>$${h_{Case2:Superheat}} = [{h_f}_{{{110}^ \bullet }C}]$$</div>

<div>$${h_{Case2:Superheat}} = \,\,\,2691000\,\,\,\,\,\,\,\,J$$</div>

The energy difference between the superheated state and the saturated state as calculated in the following equation.  A 5BC superheat provides only a 0.2608% increase in heat transfer.  The advantage of this additional increase in heat transfer is negligible, especially when considering the economic aspect of sizing a bigger heat exchanger to accommodate additional superheat transfer.  The detrimental effects of superheated steam on the building HVAC system also come into effect once superheat is used.

<div>$$\Delta {Q_{2 - 1}}\,\,\, = \,\,\,\frac{{2691000\, - 2684000}}{{2684000}}\,\, \times 100\,\,\,\, = \,\,0.2608\,\,\,percent$$</div>

Based on the reasoning above the steam loop in EnergyPlus is designed and implemented to operate at saturated conditions.

#### Steam Quality

The boiler operation is assumed capable to generate steam at quality equal to1.0 every time.  This is a reasonable assumption, since in practice the variability in generated steam quality would only occur if the boiler operation were not properly controlled.

The steam loop is assumed to have perfect transport mechanism.  There is no transportation losses due to friction and heat transfer with surroundings.  This assumption helps maintain the quality of steam through out the system constant value of either 0 or 1.

Steam enters the coils at boiler outlet conditions.  Steam coils are designed with steam traps, which only allow condensed steam to leave the coil; hence the steam always condenses and leaves the coil at quality of 0.0.

With the above simplifying assumption enables the EnergyPlus steam loop to be solved without problems.

#### Steam Traps

Steam traps are essential part of the steam system; they are indirect flow controllers of the loop.  Purpose of steam trap is to allow only condensate out of the coil from higher-pressure steam to lower atmospheric pressure condensate return line.  Points 3-4C, in schematic  Figure 129, represent this process across the steam trap on the Ts diagram.  The expansion process across the steam trap is assumed to be isenthalpic.  There is possibility of flashing of high-pressure condensate across the trap because of pressure drop, resulting in generation of steam at lower pressure, this steam generated at lower pressure subsequently condenses in the return piping, and heat is lost to the atmosphere.  This heat lost is a part of the steam loop losses.

Steam traps are modeled in the EnergyPlus steam coil by assigning the condensate outlet from the coil a quality of 0.0 and sub cooling the condensate at lower pressure.

Although condensate from the steam coil contains valuable heat, attempting to utilize this heat by holding the condensate in the coil reduces the heat transfer area.  It causes operational problems because it retains air, which further reduces heat transfer and non-condensable gases such as carbon dioxide, which cause slow corrosion of the steam coil.  Steam moves rapidly in mains and supply piping so when condensate accumulates to the point where the steam can push a slug of it, serious damage can occur from the resulting water hammer, hence the condensate should be immediately removed from the steam coil.  This is achieved with steam traps.

Hence an ideal steam trap should remove all condensate, air, and non-condensable gases that might be in the system, with little or no loss of steam.

#### Loop Losses

Subcooling of condensate in condensate return piping and flash steam condensing across the steam trap constitute the unavoidable loop losses in the EnergyPlus simulation steam system.  These losses can be inferred from Figure 129 and are summed up by calculating enthalpy difference between points 3 and 5 on the schematic Ts diagram.

Unavoidable losses in the EnergyPlus steam loop occur due to pressure drop across the steam trap, which causes flashing of steam and loss in some percentage of latent heat of steam, process 3-4’ and 4’-4 on the Ts diagram in Figure 129.  The condensate is pumped backed to the boiler through return pipe network, which is not insulated.  Sub cooling of the condensate occurs in the return network, represented by process 4-5 on the Ts diagram in Figure 129.  This loop sub cool contributes to significant percentage of loop losses.

In practical systems the return pipeline to the boiler is not insulated despite the condensate containing some valuable heat, however due to low mass flow rate of steam, this amount is negligible and only recovered if separate heat recovery systems are used by coupling them to the loop.  The condensate is occasionally collected in a receiver and then pumped back to the boiler.  EnergyPlus simulation mimics practical systems by assumed that the return pipeline is not insulated and accounts for this by calculating loop losses.

The loop losses are calculated in the steam coil simulation model rather that the steam pipe simulation, because the condensate sub cool in the return loop is a direct function of the location of the steam coil in the building.  In building energy software like EnergyPlus the user would have a fair idea about location of steam coils rather than the location of condensate return piping.

### Steam To Air Heat Exchanger

#### Description of Model:

The steam to air heat exchanger (Coil:Heating:Steam input object) is the terminal equipment in the steam loop on the demand side that satisfies the heating requirements of the various zones.  The steam-to-air heat exchanger simulation model in EnergyPlus calculates the mass flow rate of steam desired to meet the heating demand.

A heating coil can be used either as a zone coil or a coil in the air loop depending on the user and application.  The steam coil simulation model is designed to take these two locations into consideration.  An air-loop steam heating coil is temperature controlled and the zone coil is zone load controlled.  This relatively simple and straightforward concept of coil control is preferred over the iterative method to determine mass flow rates using various numeric techniques.  The assumptions made in the coil model are described in the section below.

This model accounts for the latent heat transfer and sensible cooling of water; the question of superheat is eliminated because steam is assumed to be saturation conditions.  Steam enters the coil at quality equal to 1.0, at saturation temperature and leaves the coil with desired degree of sub cooling.  The user inputs the desired degree of subcooling, which determines the condensate outlet condition from the coil.

EnergyPlus heat balance methods determine the amount of heating required in the zone to maintain the zone at the desired conditions.  Based on this value of heating load, the zone coil determines the mass flow rate of steam required since the heating coil load is the control variable in a zone coil.  The following equation describes this calculation to determine steam mass flow rate required for the desired heating capacity. The steam latent heat of vaporization, *h*<sub>fg</sub> and the condensate heat capacity, *C*<sub>p,w</sub> are evaluated at the steam coil inlet node temperature and standard barometric pressure of 101325.0 Pa.

<div>$${\dot m_{zc}}\,\,\,\, = \,\,\,\,\,\frac{{{Q_{zc}}}}{{{h_{fg}} + {c_{p,w}} \times \Delta {T_{sc}}}}$$</div>

In case of the air loop-heating coil, the load on the coil is calculated within the coil simulation routine.  The air loop coil is setpoint controlled and heats the air to maintain the air stream at the desired setpoint, the setpoint is a user input, generally in the range of 12B C to 16BC. The following equation describes the air loop coil load.

<div>$${Q_{al}}\,\, = \,\,{\dot m_a}\,\,\, \times \,\,\,\,\,{c_{p,a}}\,\,\, \times \,\,\,\,\,\left[ {{T_{sp}}\,\,\, - \,\,\,{T_a}} \right]$$</div>

The following equation is used to determine the steam mass flow rate required by the air loop coil to meet the heating requirements.

<div>$${\dot m_{al}}\,\,\,\, = \,\,\,\,\,\frac{{{Q_{al}}}}{{{h_{fg}} + {c_{p,w}} \times \Delta {T_{sc}}}}$$</div>

Each of the zone coils and air loop coils are simulated independently and the steam mass flow rates for each is added over every time step of simulation.  This value of total mass flow rate is reported to the boiler, which in turns supplies this required amount of steam.

The control of the steam to air coil is a complex issue.  The loop splitter-splits total steam flow from the boiler and delivers the required amount of steam to each of the coils connected to the loop through the steam pipe network.  In cases where the system is undersized, the coils demand more mass flow rate of steam than the boiler can generate.  The splitter in this case cannot provide all the coils with requested steam mass flow.  Subsequently the coils are starved of steam and the zone temperatures fall.  In some cases the user might schedule off the coil, they should then not operate.  These issues need to be taken care of in the implementation of the steam coil simulation model.  The control algorithm for the steam coil operation under various situations is best explained with the help of pseudo-code using standard IF THEN ELSE blocks.



\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*PSEUDO CODE SECTION STARTS\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*



#### Steam coil is zone load controlled.

<div>$$IF\,\,\,\,\,(Coil\, = LoadControlled)\,\,\,\,\,\,THEN\,$$</div>



Check for operational conditions only then continue simulation further.  The operational conditions are the inlet mass flow rates of steam and air to the coil, the user schedule to the coil and heating load on the coil.  The coil is simulated only if these conditions are met.

<div>$$IF\,\,\,\left[ {\,({{\dot m}_s}\,\,\, > \,\,\,0)\,\,.\,\,\,and.\,\,\,({{\dot m}_a} > \,\,\,0)\,\,.and.\,\,(Schedule\,\, = \,\,\,ON)\,.and.\,\,\,({Q_{ZC}}\,\, > \,\,0.0)\,} \right]\,\,\,THEN$$</div>

If the heating demand from the zone-heating coil is greater than coil capacity, then the heating coil is undersized, and the coil can only deliver its maximum heating capacity to the zone.  In this case the heating demand on the coil is set equal to this lower value of maximum heating capacity.  If the above is not true then the simulation ignores this statement and proceeds to the next one.

<div>$$IF\,\,\,\left[ {\,\,\,({Q_{ZC}}\,\, > \,\,{Q_{Z{C_{Max}}}})} \right]\,\,\,\,\,\,THEN\,\,\,\,\,\,\left[ {{Q_{ZC}} = \,\,{Q_{Z{C_{Max}}}}} \right]$$</div>

The following equation calculates the steam mass flow rate required by the coil.  This flow rate is required to meet the heating requirements for the zone.  This value of mass flow is requested from the splitter outlet.

<div>$${\dot m_{zc}}\,\,\,\, = \,\,\,\,\,\frac{{{Q_{zc}}}}{{{h_{fg}} + {c_{p,w}} \times \Delta {T_{sc}}}}$$</div>

If the calculated value of steam mass flow with the previous equation is greater than the maximum inlet steam flow that the splitter can provide to the coil at that time step.  Then the requested coil flow rate is set equal to the inlet steam flow rate.  This is the maximum amount of steam that can be supplied to the coil at this moment.  The coil can provide heating capacity equal to this limited amount of steam.  If the requested flow rate is less that what the splitter can provide then the program ignores the logic of the IF Loop Below

<div>$$IF\,\,({\dot m_{zc}}\,\, > \,\,{\dot m_{in}})\,\,THEN\,\,(\,\,\,{\dot m_{zc}}\,\, = \,\,{\dot m_{in}})$$</div>

Re-Calculating the coil heating capacity with the lower value of steam mass flow rate.

<div>$${Q_{ZC}} = {\dot m_{zc}}\,\, \times \,\,({h_{fg}} + {c_{p,w}} \times \Delta {T_{sc}})$$</div>

<div>$$END\,\,IF$$</div>

The following equations calculate the outlet condensate-water and outlet air temperatures to the zone based on the amount of heating capacity provided by the coil.

      <div>$$T{w_{out}} = \,\,T{s_{in}}\,\, - \,\,\,\Delta {T_{sc}}$$</div>

<div>$$T{a_{out}}\,\,\, = \,\,T{a_{in}}\,\, + \,\,\,\frac{{{Q_{zc}}}}{{\,{{\dot m}_a}\, \times \,\,\,{c_{p,a}}}}$$</div>

<div>$$ELSE$$</div> Else the coil is not running and in this case set outlets to inlets.

<div>$${\dot m_s} = 0\,,\,\,\,{\dot m_a} = 0\,,\,\,\,\,\,\,\,\,\,\,\,\,{Q_{zc}} = 0,\,\,\,\,\,\,\,\,\,\,\,\,T{w_{out}} = T{s_{in\,\,,\,\,\,\,}}\,\,\,\,\,\,T{a_{out}} = T{a_{in}}$$</div>



<div>$$END\,\,IF$$</div>



<span>$END\,\,IF$</span> End IF for the zone load controlled coil.



#### Steam coil is temperature controlled.

<div>$$IF\,\,\,\,\,(Coil\, = TemperatureControlled)\,\,\,\,\,\,THEN\,$$</div>

Check for operational conditions and continue simulation further.  The operational conditions are the inlet mass flow rates of steam and air to the coil, the user schedule to the coil and delta temp exists between the setpoint and air inlet temperature.  The coil is simulated only if these conditions are met.

<div>$$IF\,\left[ \begin{array}{l}\,({{\dot m}_s}\,\,\, > \,\,\,0)\,\,.\,and.\,({{\dot m}_a} > \,\,\,0)\,\,.and.\,\,(Schedule\,\, = \,\,\,ON)\,.and.\,\\\,\,({T_{SP}} - T{a_{in}})\,\, > \,\,0.0001)\,\end{array} \right]\,THEN$$</div>

Calculate the heating load on the coil using setpoint and inlet air temperatures.

<div>$${Q_{al}}\,\, = \,\,\,{\dot m_a}\, \times \,\,\,C{p_a}\,\, \times \,\,\,\,[\,\,{T_{sp}}\,\, - \,\,\,{T_a}]$$</div>

The logic loop for temperature-controlled coil begins here.  In case the heating load on the coil is negative, which might occur if the setpoint is below the air inlet temperature, the coil operation needs to be shut off.

<div>$$IF\,\,({Q_{al}}\,\,\, < \,\,\,\,0.0)\,\,\,\,THEN$$</div>

Assigning the inlet to outlet and mass flows to zero shuts off the coil operation.

<div>$${\dot m_s} = 0\,,\,\,\,{\dot m_a} = 0\,,\,\,\,\,\,\,\,\,\,\,\,\,{Q_{al}} = 0,\,\,\,\,\,\,\,\,\,\,\,\,T{w_{out}} = T{s_{in\,\,,\,\,\,\,}}\,\,\,\,\,\,T{a_{out}} = T{a_{in}}$$</div>

If air loop coil load is greater than maximum coil load calculated at maximum steam mass flow rate, in such case the coil is undersized, the coil can only deliver to the air loop its maximum heating capacity.  Setting the air loop coil load equal to maximum load on coil.  If this is not the case then the program ignores this ELSE IF block and proceeds to the next one.

<div>$$ELSE\,\,\,IF\,\,\,\,\left[ {\,\,\,({Q_{al}}\,\, > \,\,{Q_{a{l_{Max}}}})} \right]\,\,\,\,\,\,THEN\,\,\,\,\,\,\left[ {{Q_{al}} = \,\,{Q_{a{l_{Max}}}}} \right]$$</div>

If the heating coil is under sized then it can only provide its maximum heating capacity, in this case the air temperature will be below the setpoint, and is calculated based on this maximum allowed value of heat transfer.  Calculating the air and water outlet temperatures.

<div>$$T{a_{out}}\,\,\, = \,\,T{a_{in}}\,\, + \,\,\,\frac{{{Q_{al}}}}{{\,\,{{\dot m}_a}\, \times \,\,\,{c_{p,a}}}}$$</div>

<div>$$T{w_{out}} = \,\,T{s_{in}}\,\, - \,\,\,\Delta {T_{sc}}$$</div>

Determining the mass flow rate of steam required by the undersized coil.  This value of mass flow is requested from the splitter outlet.

<div>$${\dot m_{al}}\,\,\,\, = \,\,\,\,\,\frac{{{Q_{al}}}}{{{h_{fg}} + {c_{p,w}} \times \Delta {T_{sc}}}}$$</div>

A check is introduced to determine if this requested mass flow rate is greater than what the splitter outlet can provide to the coil at that particular time step of simulation.  In this case the requested value of steam mass flow is greater that what the splitter can provide to that coil, subsequently set the requested coil flow rate equal to the inlet steam flow rate, delivered to the coil by the splitter.  This is the maximum amount of steam that can be supplied to the coil at this moment.  If the requested flow rate is less that what the splitter can provide then the program ignores the logic of the IF Loop.

<div>$$IF\,\,\,({\dot m_{al}}\,\, > \,\,{\dot m_{in}})\,\,THEN\,\,(\,\,\,{\dot m_{al}}\,\, = \,\,{\dot m_{in}})$$</div>

Re-Calculating the coil heating capacity and air outlet temperature with the lower value of steam mass flow rate provided by the splitter.

<div>$${Q_{al}}\,\,\,\, = \,\,\,\,{\dot m_{al}}({h_{fg}} + {c_{p,w}} \times \Delta {T_{sc}})$$</div>

<div>$$T{a_{out}}\,\,\, = \,\,T{a_{in}}\,\, + \,\,\,\frac{{{Q_{al}}}}{{\,\,{{\dot m}_a}\, \times \,\,\,{c_{p,a}}}}$$</div>

<div>$$End\,\,\,IF$$</div>

If the above two IF ELSE block are not true, then the coil is perfectly sized, the splitter can provide the required mass flow rate to the coil, and the setpoint temperature can be maintained as desired.

<div>$$ELSE$$</div>

The ideal case where the coils can meet the required setpoint temperature.  Setting the outlet air temperature to the setpoint, calculating the water outlet temperature and the required steam mass flow rate.

<div>$$T{a_{out}}\,\,\, = \,\,{T_{SP}}$$</div>

<div>$$T{w_{out}} = \,\,T{s_{in}}\,\, - \,\,\,\Delta {T_{sc}}$$</div>

<div>$${Q_{al}}\,\, = \,\,\,{\dot m_a}\, \times \,\,\,{c_{p,a}}\,\, \times \,\,\,\,[\,\,{T_{sp}}\,\, - \,\,\,{T_a}]$$</div>

<span>$END\,\,IF$</span>   End IF statement, for the air coil heating loop.

<span>$END\,\,IF$</span>         End IF statement for the operating condition loop

<span>$END\,\,IF$</span>   End IF statement for the Temperature Setpoint Controlled Coil

The steam coil model encapsulates the above described control logic along with the other necessary simulation code for reading the user inputs and the code for reporting the simulation results.

\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*PSEUDO CODE SECTION ENDS\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

The two main types of coil control discussed above are followed by common simulation code in the coil model.  This code calculates the loop losses occurring due to flashing of steam across the steam trap, isenthalpic expansion occurring across the steam trap due to pressure difference, and loss occurring due to condensate sub cooling returning back to the boiler.  The above-mentioned two processes are explained in Figure 129 as process 3-4’ and 4-5.

The loop loss calculation is included in the steam coil simulation model, because the degree of subcooling in the return piping for the condensate is solely a function of the coil location.  In practical applications a coil, which is further away from boiler would return back condensate at much lower temperatures compared to coil, which is closer to boiler.  Hence for user ease it makes perfect sense to include this input into the coil and calculate the pump inlet conditions in the steam coil simulation model itself.

The loop losses in the EnergyPlus steam system is calculated by determining the enthalpy difference between point 3 and 5.  The simulation code that determines the loop loss is common to both the coil models, this helps determine the condensate pump inlet conditions.

The following equation is used to calculate condensate enthalpy at coil outlet, point 3 in Figure 129.  Point 2 represents condensed steam; enthalpy at this point is calculated directly by EnergyPlus property routines.

<div>$${h_{f3}} = {h_{f2}} - {c_{p,w}} \times \Delta {T_{SC}}$$</div>

Point 4 is at atmospheric pressure, enthalpy at this is calculated directly by EnergyPlus property routines.  It is saturation enthalpy of steam at quality equal to 0.0 and saturation temperature at atmospheric pressure.

Point 5 is inlet to the pump; enthalpy at this point is calculated with the following equation  The delta temperature represents the degree of loop subcooling occurring during condensate return back to the pump.

<div>$${h_{f5}} = {h_{f4}} - {c_{p,w}} \times \Delta {T_{LSC}}$$</div>

Subsequently loop loss for each coil would be enthalpy difference between 3 and 5 and is calculated using the following equation

<div>$$\Delta {Q_{loss}} = {\dot m_s}\,\,\, \times \,\,\,\,({h_{f3}} - {h_{f5}})$$</div>

The total loop loss would be a summation of the individual losses occurring for each of the steam coils, this is the unavoidable loss in current steam system.

A simple schematic describing the coil framework, inlet and outlet conditions to the coil and the flow rate resolution is shown in Figure 130.  Five zone coils and one air loop coil are described in the picture, Qzone is calculated by EnergyPlus heat balance and it is the input to the zone coils, while in air loop coil the Qal is calculated within the simulation model



![SchematicSteamCoil](EngineeringReference/media/image2032.png)

Figure 130. Schematic of Steam Coil Connection to the Steam Loop

As depicted in the figure above the steam condenses on entering the coils, sub cools by the specified amount and leaves the heat exchanger as water.  The steam in the heat exchanger at any moment has to condense eventually since steam trap at the outlet to coil permits only water to leave the coil.  Steam traps being an essential part of the loop are modeled by controlling the coil outlet condition at quality equal to 0.0.  Subsequently the amount of heat transferred to air is a direct function of latent heat and the degree of sub cooling desired by the user.

#### Model Assumptions

The steam coils works on two basic assumptions, firstly, it’s assumed that perfect latent heat transfer takes place over every time step, secondly, the user specified degree of subcooling occurs in the coil.  Steam coils always use steam traps- purpose of which is to only let water out of the coil, hence the modeler knows with certainty the outlet dryness faction of steam coil is at quality equal to 0.0, because water leaves coil.  Hence the heat transfer is equal to latent heat of steam, which is independent of UA value of coil when averaged over time step of EnergyPlus simulation.

In practice there is 1% to 2 % sub cooling of the outlet water stream, the user with desired degree of subcool input accounts for this, subsequently UA calculation for the coil model become superfluous and is neglected in the EnergyPlus model.

Ideally for sub-cooling UA would play an important role, however sub cooling in steam coil constitutes negligible amount of heat transfer, hence this model avoids the UA calculation.  This is a very reasonable assumption since sensible heat transfer is barely 1% to 2 % of the total heat transfer in steam coils, simply due to large latent heat capacity of coil. NOTE in his thesis he gives a little example here which is probably not necessary for the Docs.

### Condensate Pump

The steam loop operates at a pressure differential over the gaseous and liquid part of the loop; subsequently a condensate pump is required to pump the condensed steam back to the boiler at the required pressure.  Two main reasons for condensed steam to be returned to the boiler is energy savings in reheating water since the water is at high temperature, secondly the water is treated by chemicals to prevent corrosion in the pipes and equipment.  This is an expensive process and therefore it’s economical to reuse the chemically treated water.

#### Description of Pump Model

The pump model designed in EnergyPlus is a variable speed condensate pump.  Condensation of steam produces water, this takes place at variable rate hence the return water flow rate would be variable but constant when averaged over a time step.  Condensate pumps operate intermittently; the pump will run at its capacity if a load/flow rate is sensed and will shut off if there is no load on the loop.

The condensate pump essentially operates between maximum and minimum flow rates, which are the physical limits of the device.  The pump is designed to meet the flow request made by demand side components, which are the coils in case of steam system.

The main difference between the variable volume pump and the constant volume pump is the Part Load Performance Curve.  The fraction of full load power is determined by the third order equation, which follows:

<div>$${P_{Frac}}\,\, = \,\,{C_1} + \,{C_2} \times PLR\,\, + \,\,\,{C_3} \times PL{R^2}\,\, + \,\,{C_4} \times PL{R^3}$$</div>

In preceding equation, PLR stands for part load ratio while C1 to C4 are pump- part load coefficients.  The following five equations describe the pump operation and calculation of pump output variables such as total power, shaft power and pump heat to fluid etc.

<div>$$\dot V\,\, = \,\,\frac{{\,\dot m\,}}{{{\rho_w}}}$$</div>

Using the previous equation the pump volume flow rate is determined; the user enters the value of the maximum and minimum volume flow rate.

The pump part load ratio is a function of the pump volume flow rate at any instance determined by the loop and the pump nominal volume flow rate, which is a user input.  The following equation calculates the Part Load Ratio (PLR).

<div>$$PLR = \,\frac{{\dot V}}{{{{\dot V}_{nom}}}}$$</div>

The pump power is calculated as described in following equation.  Pump power is a product of fractional full load power and pump nominal power use.  Fractional full load power is calculated in a preceding equation while pump nominal power is a user input to the model.

<div>$$P = {P_{Frac}} \times {P_{Nom}}$$</div>

The shaft power is simply the product of the pump power and motor efficiency, this is required to calculate the heat generated and delivered to the fluid being pumped.  The following equation is used to calculate pump shaft power.

<div>$${P_S}\,\,\, = P\,\,\,\, \times \,\,\,\,{\eta_m}$$</div>

The model assumes that all heat generated and lost ends up in the fluid to the loop, this assumption is necessary since EnergyPlus operates on a closed loop.  The following equation is used to calculate the pump heat to the fluid, which raises the condensate temperature.  The pump motor efficiency is defined by the user input and the fractional motor loss to fluid is the amount of heat generated by the pump motor that is added to the fluid loop (as opposed to being lost to the environment where the pump is located).  FracMotorLossToFluid is also a user input

<div>$${P_H} = {P_S}\,\,\, + \,(\,P\,\, - {P_S}) \times {F_{mf}}$$</div>

The shaft power relates to the increase in head through the pump to the loop operating pressure.  The head lost through the piping network due to frictional heat, represents the heat gain by the fluid throughout the network.  .  For model simplicity, this heat is added along with the heat resulting from the pump motor.  The difference between the pump power and the shaft power is the inefficiency of the pump, or the amount of energy input into the pump that the motor converts to heat rather than mechanical energy.  Some of this heat is added to the fluid being pumped.  These two above-mentioned terms are used in the PumpHeatToFluid equation for calculating P<sub>H</sub> shown above.

A simple energy balance over the pump based on the pump inlet conditions and flow rate is used to calculate the pump outlet temperature.  The condensate outlet temperature from the pump is slightly higher than inlet due to the heat dissipation to the fluid steam during pumping action.  This is calculated in the following equation.  The pump water outlet temperature is the boiler inlet temperature.

<div>$${T_{{w_{out}}}} = {T_{{w_{in}}}}\,\,\, + \,\,\,\,\,\frac{{{P_H}}}{{\,\dot m\,\,\, \times \,\,\,\,{c_{p,w}}}}$$</div>

Pump control is an important part of the steam loop.  Existing control structure from EnergyPlus has been utilized to operate the condensate pump.  The pump is simulated first on the supply side of the loop after the demand side loop has determined what the demand on the loop will be.

A simple schematic describing the flow across the pump is shown in the following figure

![SchmaticCondensatePump](EngineeringReference/media/image2040.png)

Figure 131.  Schematic of Condensate Pump in Steam Loop

#### Model Assumptions

Due to the fact that a pump is a mechanical device that acts on the fluid it is circulating, it causes the fluid temperature rise.  The EnergyPlus model assumes that all pressure increase caused by the pump will eventually be lost due to friction, and that friction will be added as heat to the fluid.  Although the plant and condenser loops in steam systems are simple pressure-based models, a simplifying assumption has be made in EnergyPlus to assume the heat resulting from the pump itself and from friction throughout the loop is added at the fluid being pumped.  In case of steam, this assumption is easily justified because the volume flow rate of water is very small in the loop.

### Steam Pipe

#### Description of Model

The steam pipe essentially serves as “energy carrier” and transfers the node conditions from one point of the pipe to another.  It’s simply a node inlet to node outlet connection, transferring values from inlet to outlet.  The pipe forms an important part of the framework connecting various equipments from the supply to demand side and inlet and outlets of the equipments.

The steam pipe supports two additional properties, which are pressure and quality, unlike its water counterpart.  Pipe simulation model in EnergyPlus is hardwired to water as a fluid type; this necessitated the development of similar model supporting pressure and quality for the steam system.

#### Model Assumptions

The piping network in the developed steam system is assumed to perfectly distribute steam, return the condensate, and remove air and non-condensable gases.  It is also assumed that the pipes are sized to distribute steam not only at full load but also at partial loads and excess loads that can occur during system warm up.

The steam pipe is perfect and there is no losses occurring in transportation.  This assumption was necessitated since if pipe losses were accounted for, the loss would have to be distributed into the zone, which would be a very complex issue in itself, since in EnergyPlus the pipes are unaware of their locations and simply serve as connectors.

Loop, Equipment Sizing and other Design Data
============================================

The importance of correct equipment sizing is often ignored in discussions of building simulation methods. The lack of reliable, efficient and flexible sizing calculations can present a serious barrier to the adoption and acceptance of building simulation programs. This section describes the sizing methodology implemented in EnergyPlus. This method includes:

1.    A zone by zone heat balance load and air-flow calculation for multiple design days;

2.    Significant user control with modest input requirements;

3.    Zone, system and plant level calculations of design heating and cooling capacities and fluid flow rates;

4.    Modular, component-specific sizing algorithms for each HVAC component.

5.    Options for monitoring how the initial sizes operate over multiple design days and then making adjustments and repeating plant level calculations

Sizing Manager
--------------

The sizing calculations in EnergyPlus are managed by a sizing manager contained in the software module *SizingManager*. The main sizing manager routine *ManageSizing* is called from *ManageSimulation* before the annual simulation sequence is invoked. *ManageSizing* performs the following tasks.

*  By calling *GetSizingParams*, *GetZoneSizingInput*, *GetSystemSizingInput* and *GetPlantSizingInput* reads in all the user sizing input contained in objects *Sizing:Parameters*, *Sizing:Zone*, *Sizing:System* and *Sizing:Plant*. These objects and their data are described in the EnergyPlus Input Output Reference, Group – Design Objects.

*  Set the *ZoneSizingCalc* flag equal to *true*.

*  Loop over all the sizing periods by each day. **This starts the zone design calculations.**

    * Call *UpdateZoneSizing(BeginDay)* to initialize zone design load and flow rate  sequences.

    * Loop over hours in the day

        * Loop over zone time steps in each hour

            * Call *ManageWeather* to obtain outside conditions for this time-step.

            * Call *ManageHeatBalance* to do a full heat balance calculation for each zone. The call to *ManageHeatBalance* also brings about an HVAC simulation. *ZoneSizingCalc = true* signals the *HVACManager* to ignore the real HVAC system and instead run the ideal zonal system (described below) used to calculate design loads and flow rates. HVACManager also calls *UpdateZoneSizing(DuringDay)* to save the results of the ideal zonal system calculation in the design load and flow rate sequences.

        * Call *UpdateZoneSizing(EndDay)* to calculate peaks and moving averages from the zone design sequences for each design day.

* Call *UpdateZoneSizing(EndZoneSizingCalc)* to calculate for each zone the peak heating & cooling loads and flow rates over all the sizing periods (design days and sizing periods from the weather file, if specified). The corresponding design load and flow rate sequences are saved for use in the system design calculations. **This ends the zone design calculations.**

*  Set the *SysSizingCalc* flag equal to *true*.

* Call *ManageZoneEquipment* and *ManageAirLoops* to read in the zone and central system inputs needed for the system design calculations. The program needs enough information to be able to figure out the overall air loop connectivity.

*  Loop over all the sizing periods by each day. **This starts the system design calculations.**

    * Call *UpdateSysSizing(BeginDay)* to initialize system design load and flow rate  sequences.

    * Loop over hours in the day

        * Loop over zone time steps in each hour

            * Call *ManageWeather* to obtain outside conditions for this time-step.

            * Call *UpdateSysSizing(DuringDay)* to save the results of the system design calculations in the system design load and flow rate sequences.

    * Call *UpdateSysSizing(EndDay)* to calculate peaks and moving averages from the system design sequences for each sizing period.

* Call *UpdateSysSizing(EndSysSizingCalc))* to calculate for each system the peak heating & cooling loads and flow rates over all the sizing periods (design days and sizing periods from the weather file, if specified). The corresponding design load and flow rate sequences are saved for use in the component sizing calculations. **This ends the system design calculations.**

* And this ends the tasks of the Sizing Manager.

HVAC Sizing Simulation Manager
------------------------------

After the Sizing Manager has completed its initial pass, all the data needed to complete a running model should be available and the program is ready to run the main simulation(s).  However, as of Version 8.3 there is now an option of applying some advanced sizing calculations using what are called HVAC Sizing Simulations.  

With this new sizing method we distinguish between different kinds of simulations and introduce some new terminology.  The Primary Simulations are the main simulations that are the final version of the model to be run.  Prior to Version 8.3, these are just the usual simulations with the final results.  When the program is running the zone heat balance model over the sizing periods for zone sizing (for step 3 in the Sizing Manager description above), we call those Ideal Loads Sizing Simulations.  When the program is running the zone heat balance model over the sizing periods for component loads calculations we call those Ideal Component Loads Simulations. HVAC Sizing Simulations are a kind of simulation, where the program creates copies of sizing periods and runs them as complete EnergyPlus simulations with the most current equipment sizes and full HVAC systems.  The advanced sizing algorithms monitor what occurred during those sizing periods and determines if new size results are needed and signals systems and components to repeat their sizing calculations.  The process can repeat in an iterative manner and a Sizing Pass refers to a set of the HVAC Sizing Simulations for each of the sizing periods (e.g. two design days).  

If the user has selected a sizing option that requires HVAC Sizing Simulations the main ManageSimulation will call ManageHVACSizingSimulation before going on to the main simulations.  

* Instantiate a new HVACSizingSimulationManager object.  

* Call DetermineSizingAnalysesNeeded(). This checks what user input and decides what, if anything, needs to be done for advanced sizing algorithms.   This involves, for example, checking the input in Sizing:Plant object to see if coincident sizing option has been selected.

* Call SetupSizingAnalyses().  This method creates the data logging apparatus needed to monitor operation during HVAC Sizing Simulations.  Individual sizing algorithms include selecting specific variables, such as system node states or load output variables, that will be recorded. 

* Loop over some number of Sizing Passes.  The set of sizing periods, run as HVAC Sizing Simulations, can iterate up to a maximum limit on the number of passes

    * Loop over all the sizing periods by each day.  This runs the HVAC Sizing Simulations which have basically the same set of calls as are used for marching through time and calling of EnergyPlus modeling for the Primary Simulations (in ManageSimulation).

        * Call PostProcessLogs().  This method applies running averages (if desired) and averages system timestep data to fill zone timestep data in the records.

        * Call ProcessCoincidentPlantSizeAdjustments(). This method retrieves data from the logs and calls for the coincident plant sizing algorithm to execute. Set flag if the sizing analyses request another Sizing Pass.  (See the section below on Coincident Plant Sizing.)

        * Call RedoKickOffAndResize(). The methods calls SetupSimulation() and sets flag to signal that system and component level sizing methods need to be called again.  These are fake timesteps used to initialize and are not part of a Simulation.

    * Break out of Sizing Pass loop if size results did not change or the limit on Sizing Passes has been reached.

* Empty HVACSizingSimulationManager object to free memory

Currently the only application for HVAC Sizing Simulations is to improve the sizing of plant loops using the “Coincident” sizing option.  However this approach may be expanded in the future to extend advanced sizing methods to air-side equipment. 


Zone Design Loads and Air Flow Rates
------------------------------------

### Overview

There is no single best way to establish design HVAC flow rates and size HVAC equipment. Different building designs, climates, and HVAC systems will impose varying constraints on the designer. The method used to size an HVAC system in a hot, moist climate such as Miami will be different than the method used for a building in Albuquerque. The type of building is also relevant – a simple watts per square foot loads estimate could be adequate for a building containing a network server farm while a detailed, dynamic loads simulation would be necessary for a passive solar building. In the end the designer’s experience and engineering judgement will play an important role in any sizing calculation.

HVAC equipment sizing begins with the calculation of space heating and cooling loads. A space cooling  (heating) load is defined as the rate at which heat must be removed (added) to a space to maintain a constant temperature. The current industry standard method for calculating space loads is the *heat balance method*  [ASHRAE Fundamentals (2001), page 29.1; Pedersen et al., (1997); Pedersen (2001). Since EnergyPlus is a heat balance based simulation program it is straightforward for the program to use this method for calculating zone loads.

### Zone Design Data Arrays

The zone design data arrays are:

*ZoneSizingInput(i)* stores the input data from the Sizing:Zone objects.

*CalcZoneSizing(i,j)* stores the results of the zone design calculations for all zones and all design days. The index i is for the controlled zones, j for design days.

*CalcFinalZoneSizing(i)* stores the results of the zone design calculations for the peak heating and cooling cases for each zone. The index i is for the controlled zones.

*ZoneSizing(i,j)* corresponds to *CalcZoneSizing* but includes the effect of the user specified sizing factor or user specified zone design flow rate.

*FinalZoneSizing(i)* corresponds to *CalcFinalZoneSizing* but includes the effect of the user specified sizing factor or user specified zone design flow rate.

The data stored in *CalcZoneSizing*, *CalcFinalZoneSizing*, *ZoneSizing* and *FinalZoneSizing* includes the following data items.



Table 40.  Zone Sizing Data

<table class="table table-striped">
<tr>
<th>Name</td>
<th>Description</td>
</tr>
<tr>
<td>All the data from ZoneSizingInput</td>
<td> </td>
</tr>
<tr>
<td>DesHeatMassFlow</td>
<td>the zone design heating air mass flow rate in [kg/s]</td>
</tr>
<tr>
<td>DesCoolMassFlow</td>
<td>the zone design cooling air mass flow rate in [kg/s]</td>
</tr>
<tr>
<td>DesHeatLoad</td>
<td>the zone design heating load in [W]</td>
</tr>
<tr>
<td>DesCoolLoad</td>
<td>the zone design cooling load in [W]</td>
</tr>
<tr>
<td>DesHeatDens</td>
<td>the zone design heating air density [kg/m<sup>3</sup>]</td>
</tr>
<tr>
<td>DesCoolDens</td>
<td>the zone design cooling air density [kg/m<sup>3</sup>]</td>
</tr>
<tr>
<td>DesHeatVolFlow</td>
<td>the zone design heating air volume flow rate [m<sup>3</sup>/s]</td>
</tr>
<tr>
<td>DesCoolVolFlow</td>
<td>the zone design cooling air volume flow rate [m<sup>3</sup>/s]</td>
</tr>
<tr>
<td>DesHeatCoilInTemp</td>
<td>zone heating coil design air inlet temperature [C]</td>
</tr>
<tr>
<td>DesCoolCoilInTemp</td>
<td>zone cooling coil design air inlet temperature [C]</td>
</tr>
<tr>
<td>DesHeatCoilInHumRat</td>
<td>the zone heating coil design air inlet humidity ratio [kg/kg]</td>
</tr>
<tr>
<td>DesCoolCoilInHumRat</td>
<td>the zone cooling coil design air inlet humidity ratio [kg/kg]</td>
</tr>
<tr>
<td>HeatMassFlow</td>
<td>current zone heating air mass flow rate at the HVAC time step [kg/s]</td>
</tr>
<tr>
<td>CoolMassFlow</td>
<td>current zone cooling air mass flow rate at the HVAC time step [kg/s]</td>
</tr>
<tr>
<td>HeatLoad</td>
<td>Current zone heating load [W]</td>
</tr>
<tr>
<td>CoolLoad</td>
<td>Current zone cooling load [W]</td>
</tr>
<tr>
<td>HeatZoneTemp</td>
<td>Current zone temperature during heating [C]</td>
</tr>
<tr>
<td>HeatZoneRetTemp</td>
<td>current zone return temperature during heating [C]</td>
</tr>
<tr>
<td>CoolZoneTemp</td>
<td>Current zone temperature during cooling [C]</td>
</tr>
<tr>
<td>CoolZoneRetTemp</td>
<td>current zone return temperature during cooling [C]</td>
</tr>
<tr>
<td>HeatZoneHumRat</td>
<td>Current zone humidity ratio during heating [C]</td>
</tr>
<tr>
<td>CoolZoneHumRat</td>
<td>Current zone humidity ratio during cooling [C]</td>
</tr>
<tr>
<td>ZoneTempAtHeatPeak</td>
<td>zone temperature at maximum heating [C]</td>
</tr>
<tr>
<td>ZoneRetTempAtHeatPeak</td>
<td>zone return temperature at maximum heating [C]</td>
</tr>
<tr>
<td>ZoneTempAtCoolPeak</td>
<td>zone temperature at maximum cooling [C]</td>
</tr>
<tr>
<td>ZoneRetTempAtCoolPeak</td>
<td>zone return temperature at maximum cooling [C]</td>
</tr>
<tr>
<td>ZoneHumRatAtHeatPeak</td>
<td>zone humidity ratio at maximum heating [kg/kg]</td>
</tr>
<tr>
<td>ZoneHumRatAtCoolPeak</td>
<td>zone humidity ratio at maximum cooling [kg/kg]</td>
</tr>
<tr>
<td>TimeStepNumAtHeatMax</td>
<td>zone time step number (in the day) at the heating peak</td>
</tr>
<tr>
<td>TimeStepNumAtCoolMax</td>
<td>zone time step number (in the day) at the cooling peak</td>
</tr>
<tr>
<td>HeatDDNum</td>
<td>design day index of design day causing heating peak</td>
</tr>
<tr>
<td>CoolDDNum</td>
<td>design day index of design day causing cooling peak</td>
</tr>
<tr>
<td>MinOA</td>
<td>design minimum outside air [m3/s]</td>
</tr>
<tr>
<td>HeatFlowSeq(i)</td>
<td>daily sequence of zone heating air mass flow rates (zone time step) [kg/s]</td>
</tr>
<tr>
<td>CoolFlowSeq(i)</td>
<td>daily sequence of zone cooling air mass flow rates (zone time step) [kg/s]</td>
</tr>
<tr>
<td>HeatLoadSeq(i)</td>
<td>daily sequence of zone heating loads (zone time step) [W]</td>
</tr>
<tr>
<td>CoolLoadSeq(i)</td>
<td>daily sequence of zone cooling loads (zone time step) [W]</td>
</tr>
<tr>
<td>HeatZoneTempSeq(i)</td>
<td>daily sequence of zone temperatures (heating, zone time step) [C]</td>
</tr>
<tr>
<td>HeatZoneRetTempSeq(i)</td>
<td>daily sequence of zone return temperatures (heating, zone time step) [C]</td>
</tr>
<tr>
<td>CooltZoneTempSeq(i)</td>
<td>daily sequence of zone temperatures (cooling, zone time step) [C]</td>
</tr>
<tr>
<td>CoolZoneRetTempSeq(i)</td>
<td>daily sequence of zone return temperatures (cooling, zone time step) [C]</td>
</tr>
<tr>
<td>HeatZoneHumRatSeq(i)</td>
<td>daily sequence of zone humidity ratios (heating, zone time step) [kg/kg]</td>
</tr>
<tr>
<td>CoolZoneHumRatSeq(i)</td>
<td>daily sequence of zone humidity ratios (cooling, zone time step) [kg/kg]</td>
</tr>

</table>



### Zone Design Load Calculation

As described in the preceding section, the Sizing Manager initiates the zone design calculation by looping over all of the design days and calling the Heat Balance Manager for each zone time-step in each design day. The Heat Balance manager then causes the HVAC Manager to be called in a manner identical to a normal simulation. The *ZoneSizingCalc* set to *true* signals the HVAC Manager to ignore the actual HVAC system and instead calculate the design zone loads and air flow rates using an ideal zonal system.

In module *HVACManager*, subroutine *ManageHVAC* calls *SimHVAC*. *SimHVAC* checks *ZoneSizingCalc*. If it is *true*, *SimHVAC* calls *ManageZoneEquipment* and returns, rather than simulating the actual system. In turn *ManageZoneEquipment* checks if *ZoneSizingCalc* is *true*; if it is it calls *SizeZoneEquipment* rather than *SimZoneEquipment*.

*SizeZoneEquipment* assumes that each controlled zone is served by an ideal air conditioning unit. This unit supplies heating or cooling air at a fixed, user input temperature and humidity (specified in the Sizing:Zone objects). The units have infinite capacity – the flow rate can be any amount. The calculation steps are as follows.

1)    Loop over all the controlled zones.

2)    If the system is active (zone temperature not in the deadband and zone load greater than 1 watt) the sign of the zone load is used to determine whether heating or cooling is required and *T<sub>in</sub>* and W*<sub>in</sub>* are set to the appropriate values from the Sizing:Zone input. When the SupplyTemperature method is specified in the Sizing:Zone object, *T<sub>in</sub>* is fixed at the cooling or heating supply temperature. When the TemperatureDifference method is selected, *T<sub>in</sub>* is calculated at each time step using the current zone air temperature. The system output *Q<sub>sys</sub>* is simply set equal to the zone demand – it is assumed that the ideal system can always meet the zone load. The air flow rate corresponding to the load is just

<div>$${\dot m_{sys}} = {Q_{sys}}/({C_{p,air}} \cdot ({T_{in}} - {T_z}))$$</div>

If the system is not active, the mass flow rate is set to zero and the system output is left at zero.

3)    The results for each zone are stored in the zone sizing data arrays.

### Updating and Adjusting the Zone Results

The results from *SizeZoneEquipment* are at the system time-step and are for all design days. These results then need to be summed or averaged over the zone time-step, peak values calculated for each design day, a heating & a cooling load sequence chosen for each zone from all the design day results, possible further smoothing of results done, zone coil loads calculated, and user sizing multipliers or user specified design flows taken into account. These tasks are accomplished by the subroutine *UpdateZoneSizing*. It is called at the start of each design day (*CallIndicator = BeginDay*), at the zone time-step (*CallIndicator = DuringDay*), at the end of the design day (*CallIndicator = EndDay*) and at the end of the zone design calculation (*CallIndicator = EndZoneSizingCalc*).

#### BeginDay

The environment (in this case, a design day) name and number are stored in the zone sizing data structures

#### DuringDay

The calculated and stored sequences are summed or averaged over the zone time-step.

#### EndDay

(1)  Smooth the design sequences by applying a moving, fixed-width averaging window to the sequences. The width of the window is user specified in the *Sizing:Parameters* input object. The sequences that are smoothed are:

(a)  *CoolFlowSeq*

(b)  *CoolLoadSeq*

(c)  *HeatFlowSeq*

(d)  *HeatLoadSeq*

(e)  *CoolZoneRetTempSeq*

(f)   *HeatZoneRetTempSeq*

(2)  The peak heating and cooling loads and mass & volume flow rates are extracted from each set of design sequences.

(3)  Using the time of the peak and the design outside air fraction the design zone heating and cooling coil inlet temperatures and humidity ratios are calculated.

(4)  For each zone, looking at the results for all of the design days, the design days that cause the peak heating and peak cooling for that zone are chosen and the corresponding design sequences and peak loads and flow rates are saved in the CalcFinalZoneSizing array. This finishes the calculated – unmodified by the user – portion of the zone design calculation.

#### EndZoneSizingCalc

(1)  Write out onto a comma-separated file the calculated design sequences for each zone: *HeatLoadSeq*, *CoolLoadSeq*, *HeatFlowSeq*, *CoolFlowSeq* and the corresponding peaks and volumetric flow peaks.

(2)  The data in *CalcZoneSizing* and *CalcFinalZoneSizing* is moved to *ZoneSizing* and *FinalZoneSizing*. The user modifications to the calculated sizing will be applied to and stored in *ZoneSizing* and *FinalZoneSizing*.

(3)  The user can modify the calculated zone design results by specifying heating and cooling sizing factors at the global or zone level or by specifying and actual design heating or cooling zone design volumetric flow rate. All of this input is treated as a sizing factor. If the user inputs a cooling design volumetric flow rate for a zone it is divided by the calculated cooling design volumetric flow rate for the zone to give a zone cooling sizing factor. Note that the user can input a zone sizing factor or a zone design flow rate – not both – so there is never a conflict.

(4)  Once the zone heating and cooling sizing factors are established, the design flow and load sequences as well as peak loads and flows are multiplied by the appropriate sizing factor and stored in *ZoneSizing* and *FinalZoneSizing*. This is the data that will be used for sizing zone HVAC equipment and in the system sizing calculation.

(5)  The outside air fractions are recalculated using the new user-modified design flow rates and new design zone coil inlet conditions calculated and stored. At this point the condition that the design flow rates are never allowed to be less than the minimum outside air flow rate is imposed.

If *outside air method* is *flow/zone*, the input *outside air flow per zone* value will be used, even if it is zero or blank. If *outside air method* is *sum*, the sum of the *outside air flow per person* \* *DesignNumberOfPeople* + *outside air flow per area* \* *ZoneArea* will be used. If *outside air method* is *maximum*, the maximum of the *outside air flow per person* \* *DesignNumberOfPeople* and *outside air flow per area* \* *ZoneArea* will be used. If *outside air method* is *flow/person*, *outside air flow per person* will be used to calculate the design minimum outside airflow rate.

If *cooling design air flow method* is *flow/zone*, then *cooling design air flow rate* will be used for the design max cooling air flow rate.  If *cooling design air flow method* is *design day*, then the design day calculation will set the design max cooling air flow rate. If  *cooling design air flow method* is *design day with limit*, then the maximum from *cooling min flow per area* and *cooling min flow* will set a lower limit on the design max cooling air flow rate. In all cases, the maximum from *cooling min flow per area*, *cooling min flow*, and *cooling min flow fraction* will set a minimum zone cooling air flow rate. In all cases the maximum design cooling air flow rate must be &gt;= to the ventilation requirement.

If *heating design air flow method* is *flow/zone*, then *heating design air flow rate* will be used for the design max heating air flow rate.  If *heating design air flow method* is *design day*, then the design day calculation will set the design max heating air flow rate. If *heating design air flow method* is *design day with limit*, then the maximum from *heating max flow per area*, *heating max flow* and *heating max flow fraction* will set an upper limit on the design max heating air flow rate. The design max heating air flow rate must always be &gt;= the ventilation requirement. In each case, the outside airflow will be modified based on zone ventilation effectiveness specified in the zone sizing object.

**This concludes the calculation of the zone design flow rates and loads.**

### Zone HVAC Scalable Sizing

For zone HVAC equipments scalable sizing applies to supply air flow rate and capacity for both cooling and heating.  The scalable sizing method allowed for supply air flow rates include: *FractionOfAutosizedCoolingAirflow*, *FractionOfAutosizedHeatingAirflow*, *FlowPerFloorArea, FlowPerCoolingCapacity*, and *FlowPerHeatingCapacity*.  The supply air flow rate scalable sizing methods are defined as follows:



***FlowPerFloorArea***: the simulation engine determine the supply air flow rates from the user specified *supply air flow rates per unit floor area* and the zone floor area of the zone served by the zone HVAC equipment.



***FractionOfAutosizedCoolingAirflow***: the simulation engine determines the supply air flow rates from the user specified *flow fraction* and *autosized cooling design supply air flow rate*.



***FractionOfAutosizedHeatingAirflow***: the simulation engine determines the supply air flow rates from the user specified *flow fraction* and *autosized heating design supply air flow rate*.



***FlowPerCoolingCapacity***: he simulation engine determines the supply air flow rates from the user specified *supply air flow per cooling capacity value* and *autosized cooling design capacity*.



***FlowPerHeatingCapacity***: the simulation engine determines the supply air flow rates from the user specified *supply air flow per heating capacity value* and *autosized heating design capacity*.



The scalable capacity sizing may be indirectly impacted by the scalable supply air flow rates sizing values. Moreover, the autosized cold water, hot water and steam flow rates in the parent zone HVAC objects and capacity in child components are determined using the scalable sizing method.  Scalable capacity sizing methods allowed for cooling and heating include: *CapacityPerFloorArea, FractionOfAutosizedCoolingCapacity*, *FractionOfAutosizedHeatingCapacity*. The scalable sizing capacity methods are defined as follows:



**CapacityPerFloorArea**: the simulation engine determines the cooling or heating capacity from user specified capacity per floor area value and the floor area of the zone served by the zone HVAC equipment.



**FractionOfAutosizedCoolingCapacity**: the simulation engine sizes the cooling capacity from the user specified *capacity fraction* and *autosized cooling design capacity* value.



**FractionOfAutosizedHeatingCapacity**: the simulation engine sizes the heating capacity from the user specified *capacity fraction* and *autosized heating design capacity* value.

System Design Loads and Air Flow Rates
--------------------------------------

### Overview

The purpose of the system design calculation is to estimate design heating and cooling loads and air flow rates for each air loop in the simulation problem. The calculation sequence for system level design loads and air flow rates resembles the calculation sequence for zone loads and air flow rates. There is an update subroutine *UpdateSysSizing* called at the beginning, during, and end  of a loop in the Sizing Manager over all the design days. The major difference is that this calculation is done at the zone time-step only. There is no idealized component calculation triggered at the system time-step as in the zone calculation. The system design calculation operates at the zone time step using the design environment weather data and the data stored in the zone sizing arrays. The results of the system design calculation are stored in the system sizing arrays described below.

### System Design Data Arrays

The system design data arrays are:

*SysSizInput(i)* stores the input data from the Sizing:System objects.

*SysSizing(i,j)* stores the results of the system design calculations for all systems and all design days. The index i is for air loops, j for design days.

*CalcSysSizing(i*) stores the results of the system design calculations for the peak heating and cooling cases for each air loop. The index i is for the air loops.

*FinalSysSizing(i*) corresponds to *CalcSysSizing* but includes the effect of the user specified sizing factor or user specified system design flow rate.

The data stored in *SysSizing*, *CalcSysSizing* and *FinalSysSizing* includes the following data items.



Table 41.  System Sizing Data

<table class="table table-striped">
<tr>
<th>Name</td>
<th>Description</td>
</tr>
<tr>
<td>All the data from SysSizInput</td>
<td> </td>
</tr>
<tr>
<td>CoinCoolMassFlow</td>
<td>coincident peak cooling mass flow rate [kg/s]</td>
</tr>
<tr>
<td>CoinHeatMassFlow</td>
<td>coincident peak heating mass flow rate [kg/s]</td>
</tr>
<tr>
<td>NonCoinCoolMassFlow</td>
<td>noncoincident peak cooling mass flow rate [kg/s]</td>
</tr>
<tr>
<td>NonCoinHeatMassFlow</td>
<td>noncoincident peak heating mass flow rate [kg/s]</td>
</tr>
<tr>
<td>DesMainVolFlow</td>
<td>design main supply duct volume flow [m<sup>3</sup>/s]</td>
</tr>
<tr>
<td>DesHeatVolFlow</td>
<td>design heat supply duct volume flow [m<sup>3</sup>/s]</td>
</tr>
<tr>
<td>DesCoolVolFlow</td>
<td>design cool supply duct volume flow [m<sup>3</sup>/s]</td>
</tr>
<tr>
<td>SensCoolCap</td>
<td>design sensible cooling capacity [W]</td>
</tr>
<tr>
<td>TotCoolCap</td>
<td>design total cooling capacity [W]</td>
</tr>
<tr>
<td>HeatCap</td>
<td>design heating capacity [W]</td>
</tr>
<tr>
<td>PreheatCap</td>
<td>design preheat capacity [W]</td>
</tr>
<tr>
<td>MixTempAtCoolPeak</td>
<td>mixed air temperature at the time of the cooling peak [C]</td>
</tr>
<tr>
<td>MixHumRatAtCoolPeak</td>
<td>mixed air humidity ratio at the time of the cooling peak [kg water/kg dry air]</td>
</tr>
<tr>
<td>RetTempAtCoolPeak</td>
<td>return air temperature at the time of the cooling peak [C]</td>
</tr>
<tr>
<td>RetHumRatAtCoolPeak</td>
<td>return air humidity ratio at the time of the cooling peak [kg water/kg dry air]</td>
</tr>
<tr>
<td>OutTempAtCoolPeak</td>
<td>outside air temperature at the time of the cooling peak [C]</td>
</tr>
<tr>
<td>OutHumRatAtCoolPeak</td>
<td>outside air humidity ratio at the time of the cooling peak [kg water/kg dry air]</td>
</tr>
<tr>
<td>HeatMixTemp</td>
<td>design mixed air temperature for heating [C]</td>
</tr>
<tr>
<td>HeatMixHumRat</td>
<td>design mixed air humidity ratio for heating [kg water/kg dry air]</td>
</tr>
<tr>
<td>HeatRetTemp</td>
<td>design return air temperature for heating [C]</td>
</tr>
<tr>
<td>HeatRetHumRat</td>
<td>design return air humidity ratio for heating [kg water/kg dry air]</td>
</tr>
<tr>
<td>HeatOutTemp</td>
<td>design outside air temperature for heating [C]</td>
</tr>
<tr>
<td>HeatOutHumRat</td>
<td>design outside air humidity ratio for heating [kg water/kg dry air]</td>
</tr>
<tr>
<td>HeatFlowSeq(i)</td>
<td>daily sequence of system heating air mass flow rate (zone time step) [kg/s]</td>
</tr>
<tr>
<td>CoolFlowSeq(i)</td>
<td>daily sequence of system cooling air mass flow rate (zone time step) [kg/s]</td>
</tr>
<tr>
<td>SumZoneCoolLoadSeq(I)</td>
<td>daily sequence of zones' summed cooling load (zone time step) [W]</td>
</tr>
<tr>
<td>CoolZoneAvgTempSeq(I)</td>
<td>daily sequence of zones flow weighted average temperature (zone time step) [W]</td>
</tr>
<tr>
<td>SensCoolCapSeq(I)</td>
<td>daily sequence of system sensible cooling capacity (zone time step) [W]</td>
</tr>
<tr>
<td>TotCoolCapSeq(I)</td>
<td>daily sequence of system total cooling capacity (zone time step) [W]</td>
</tr>
<tr>
<td>HeatCapSeq(i)</td>
<td>daily sequence of system heating capacity (zone time step) [W]</td>
</tr>
<tr>
<td>PreHeatCapSeq(i)</td>
<td>daily sequence of system preheat capacity (zone time step) [W]</td>
</tr>
<tr>
<td>SysCoolRetTempSeq(i)</td>
<td>daily sequence of system cooling return temperatures  (zone time step) [C]</td>
</tr>
<tr>
<td>SysCoolRetHumRatSeq(I)</td>
<td>daily sequence of system cooling return humidity ratios (zone time step) [kg water/kg dry air]</td>
</tr>
<tr>
<td>SysHeatRetTempSeq(i)</td>
<td>daily sequence of system heating return temperatures  (zone time step) [C]</td>
</tr>
<tr>
<td>SysHeatRetHumRatSeq(I)</td>
<td>daily sequence of system heating return humidity ratios (zone time step) [kg water/kg dry air]</td>
</tr>
<tr>
<td>SysCoolOutTempSeq</td>
<td>daily sequence of system cooling outside temperatures (zone time step) [C]</td>
</tr>
<tr>
<td>SysCoolOutHumRatSeq</td>
<td>daily sequence of system cooling outside humidity ratios (zone time step) [kg water/kg dry air]</td>
</tr>
<tr>
<td>SysHeatOutTempSeq</td>
<td>daily sequence of system heating outside temperatures (zone time step) [C]</td>
</tr>
<tr>
<td>SysHeatOutHumRatSeq</td>
<td>daily sequence of system heating outside humidity ratios (zone time step) [kg water/kg dry air]</td>
</tr>
</table>

### System Design Flow Rate and Load Summation and Adjustment

There is no system level subroutine corresponding to *SizeZoneEquipment.* Instead the system design loads and flow rates are calculated using the zone level results. The zone design flow rates for the zones served by an air loop are summed to obtain the system level design flow rates. These air flows are mixed with the system level design minimum outside air flow rate to obtain system design coil loads. These activities are all performed within the *UpdateSysSizing* subroutine in the *SimAirServingZones* module. It is called at the start of each design day (*CallIndicator = BeginDay*), at the zone time-step (*CallIndicator = DuringDay*), at the end of the design day (*CallIndicator = EndDay*) and at the end of the zone design calculation (*CallIndicator = EndSysSizingCalc*).

There is a logical flag *SysSizingCalc* corresponding to *ZoneSizingCalc*.  It is used to allow the component routines to distinguish a normal simulation call from a being called during a system sizing calculation.

#### BeginDay

(1)  The environment (in this case, a design day) name is stored in the system sizing data structures.

(2)  Loop over the zones cooled by this air loop:

(a)  *NonCoinCoolMassFlow<sub>sys</sub>*=*DesCoolMassFlow<sub>zone</sub>*

(3)  Loop over the zones heated by this air loop:

(a)  *NonCoinHeatMassFlow<sub>sys</sub>*=*DesHeatMassFlow<sub>zone</sub>*

#### DuringDay

(1)  Loop over the zones cooled by this air loop:

*CoolFlowSeq<sub>sys</sub>(i)* =*CoolFlowSeq <sub>zone</sub>*(i)

*SysCoolRetTemp(i)*=(*CoolZoneRetTempSeq(i)· CoolFlowSeq<sub>zone</sub>(i)*)*/ CoolFlowSeq<sub>sys</sub>(i)*

*SysCoolRetHumRat(i)*=(*CoolZoneHumRatSeq(i)· CoolFlowSeq<sub>zone</sub>(i)*)*/ CoolFlowSeq<sub>sys</sub>(i)*

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *CoolFlowSeq<sub>sys</sub>(i)*

*T<sub>mix</sub>*=*T<sub>outside</sub>*· *FracOA* + *SysCoolRetTemp(i)*(1 – *FracOA*)

*W<sub>mix</sub>*=*W<sub>outside</sub>*· *FracOA* + *SysCoolRetHumRat (i)*(1 – *FracOA*)

*SysCoolOutTempSeq(i)*= *T<sub>outside</sub>*

*SysCoolOutHumRatSeq(i)*= *W<sub>outside</sub>*

Get the current (zone time-step) system cooling capacity:

*SysSensCoolCap<sub>cur</sub>*=*C<sub>p,air</sub>*· *CoolFlowSeq<sub>sys</sub>(i)* ·( *T<sub>mix</sub>*-*T<sub>sup</sub>*)

*SensCoolCapSeq(I)*= *SysSensCoolCap<sub>cur</sub>*

If *SysSensCoolCap<sub>cur</sub>* is the maximum for the day so far then save *SysSensCoolCap<sub>cur</sub>*  as the design value:

*SensCoolCap(i )<sub>sys</sub>*= *SysSensCoolCap<sub>cur</sub>*

And save the corresponding mixed, return and outside conditions:

*CoolMixTemp<sub>sys</sub>*= *T<sub>mix</sub>*

*CoolMixHumRat<sub>sys</sub>*=*W<sub>mix</sub>*

*CoolRetTemp<sub>sys</sub>*= *SysCoolRetTemp(i)*

*CoolRetHumRat<sub>sys</sub>*= *SysCoolRetHumRat(I)*

*CoolOutTemp<sub>sys</sub>*= *T<sub>outside</sub>*

*CoolOutHumRat<sub>sys</sub>*= *W<sub>outside</sub>*

Here     *r<sub>air</sub>*is the density of dry air at 20C and standard elevation corrected pressure, [kg/m<sup>3]</sup>;

            *FracOA* is the outside air fraction;

*            C<sub>p,air</sub>* is the specific heat of dry air at 20C, [J/kg-K];

*            T<sub>sup</sub>* is the user specified design cooling supply temperature [C];

*            T<sub>mix</sub>* is the current mixed air temperature [C];

*            W<sub>mix</sub>* is the current mixed air humidity ratio [kg water / kg dry air];

            *T<sub>outside</sub>* is the current outside air temperature [C];

*            W<sub>outside</sub>* is the current outside air humidity ratio [kg water / kg dry air].

(2)  Loop over the zones heated by this air loop.

*HeatFlowSeq<sub>sys</sub>(i)* =*HeatFlowSeq <sub>zone</sub>*(i)

*SysHeatRetTemp(i)*=(*HeatZoneRetTempSeq(i)· HeatFlowSeq<sub>zone</sub>(i)*)*/*

*HeatFlowSeq<sub>sys</sub>(i)*

*SysHeatRetHumRat(i)*=(*HeatZoneHumRatSeq(i)· HeatFlowSeq<sub>zone</sub>(i)*)*/*

* HeatFlowSeq<sub>sys</sub>(i)*

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *HeatFlowSeq<sub>sys</sub>(i)*

*T<sub>mix</sub>*=*T<sub>outside</sub>*· *FracOA* + *SysHeatRetTemp(i)*(1 – *FracOA*)

*W<sub>mix</sub>*=*W<sub>outside</sub>*· *FracOA* + *SysHeatRetHumRat (i)*(1 – *FracOA*)

*SysHeatOutTempSeq(i)*= *T<sub>outside</sub>*

*SysHeatOutHumRatSeq(i)*= *W<sub>outside</sub>*

Get the current (zone time-step) system heating capacity:

*SysHeatCap<sub>cur</sub>*=*C<sub>p,air</sub>*· *MinFlowRat<sub>sys</sub>*·*HeatFlowSeq<sub>sys</sub>(i)* ·( *T<sub>sup</sub>*-*T<sub>mix</sub>*)

*HeatCapSeq(I)*= *SysHeatCap<sub>cur</sub>*

If *SysHeatCap<sub>cur</sub>* is the maximum for the day so far then save *SysHeatCap<sub>cur</sub>*  as the design value:

*HeatCap(i )<sub>sys</sub>*= *SysHeatCap<sub>cur</sub>*

And save the corresponding mixed, return and outside conditions:

*HeatMixTemp<sub>sys</sub>*= *T<sub>mix</sub>*

*HeatMixHumRat<sub>sys</sub>*=*W<sub>mix</sub>*

*HeatRetTemp<sub>sys</sub>*= *SysHeatRetTemp(i)*

*HeatRetHumRat<sub>sys</sub>*= *SysHeatRetHumRat(I)*

*HeatOutTemp<sub>sys</sub>*= *T<sub>outside</sub>*

*HeatOutHumRat<sub>sys</sub>*= *W<sub>outside</sub>*

Here *MinFlowRat<sub>sys</sub>* is the user specified minimum supply flow ratio.

#### EndDay

If the user has specified *coincident* system sizing then:

*DesCoolVolFlow<sub>sys</sub>*=*r<sub>air</sub>*·*CoinCoolMassFlow<sub>sys</sub>*

*DesHeatVolFlow<sub>sys</sub>*=*r<sub>air</sub>*·*CoinHeatMassFlow<sub>sys</sub>*

*DesMainVolFlow<sub>sys</sub>*=**Max**(*DesCoolVolFlow<sub>sys</sub>*, *DesHeatVolFlow<sub>sys</sub>*)

If the user has specified *noncoincident*system sizing then:

*DesCoolVolFlow<sub>sys</sub>*=*r<sub>air</sub>*·*NonCoinCoolMassFlow<sub>sys</sub>*

*DesHeatVolFlow<sub>sys</sub>*=*r<sub>air</sub>*·*NonCoinHeatMassFlow<sub>sys</sub>*

*DesMainVolFlow<sub>sys</sub>*=**Max**(*DesCoolVolFlow<sub>sys</sub>*, *DesHeatVolFlow<sub>sys</sub>*)

Based on the outdoor air method selected, the *DesCoolVolFlow<sub>sys</sub>* and *DesHeatVolFlow<sub>sys</sub>* are modified based on the system ventilation effciency calculated based on the maximum outdoor air fraction.

#### EndSysSizingCalc

At this point all the calculations have been done in *SysSizing(i,j)*: we have results for each design day. Now these results need to be processed to find the heating and cooling design quantities for each system over all the design days.

For coincident sizing the task is quite easy.

(1)  Loop over all of the air loops.

(a)  Loop over all of the design days.

(i)    If the value of *DesCoolVolFlow* in *SysSizing* for the current design day is greater than the value stored in *CalcSysSizing*, then move *DesCoolVolFlow* from *SysSizing* into *CalcSysSizing* along with *CoolDesDay*, *CoinCoolMassFlow*, *SensCoolCap*, *CoolFlowSeq(i)*, *SensCoolCapSeq(i),* *CoolMixTemp*, *CoolRetTemp*, *CoolMixHumRat*, *CoolRetHumRat*, *CoolOutTemp*, *CoolOutHumRat*, *SysCoolRetTempSeq(i)*, *SysCoolRetHumRatSeq(i)*, *SysCoolOutTempSeq(i)* and *SysCoolOutHumRatSeq(i)*.

(ii)   If the value of *DesHeatVolFlow* in *SysSizing* for the current design day is greater than the value stored in *CalcSysSizing*, then move *DesHeatVolFlow* from *SysSizing* into *CalcSysSizing* along with *HeatDesDay*, *CoinHeatMassFlow*, *HeatCap*, *PreHeatCap*, *HeatFlowSeq(i)*, *HeatCapSeq(i),* *PreHeatCapSeq(i), HeatMixTemp*, *HeatRetTemp*, *HeatMixHumRat*, *HeatRetHumRat*, *HeatOutTemp*, *HeatOutHumRat*, *SysHeatRetTempSeq(i)*, *SysHeatRetHumRatSeq(i)*, *SysHeatOutTempSeq(i)* and *SysHeatOutHumRatSeq(i)*.

At the end of each design day loop the peak cooling and the peak heating data will be stored in *CalcSysSizing*. At this point we set *DesMainVolFlow* in *CalcSysSizing* equal to the maximum of *DesCoolVolFlow* and *DesHeatVolFlow.*

For noncoincident sizing the task is harder since we don’t have a single time-step during which all the zone peaks occur. So there is no obvious value for outside air temperature at the peak, return air temperature at the peak and so forth. We must return to the zone sizing data and calculate average values for return and outside conditions.

(b)  Loop over all of the zones cooled by this air loop

(i)    In *FinalZoneSizing* replace the value in *DesCoolCoilInTemp* with the user specified *CoolSupTemp<sub>sys</sub>*. Do the same for *DesCoolCoilInHumRat* and *CoolSupHumRat*. This ensures that zone equipment connected to an air loop will use the system design supply air conditions as coil entering conditions.

(ii)   *NonCoinCoolMassFlow<sub>sys</sub>*=*DesCoolMassFlow<sub>zone</sub>*

*SysCoolRetTemp*=(*ZoneRetTempAtCoolPeak·DesCoolMassFlow<sub>zone</sub>*)

/*NonCoinCoolMassFlow<sub>sys</sub>*

*SysCoolRetHumRat*=(*ZoneHumRatAtCoolPeak·*

*DesCoolMassFlow<sub>zone</sub>*)/*NonCoinCoolMassFlow<sub>sys</sub>*

*SysCoolOutTemp*=(*T<sub>OA,zone\\ peak</sub>·DesCoolMassFlow<sub>zone</sub>*)/

* NonCoinCoolMassFlow<sub>sys</sub>*

*SysCoolOutHumRat*=(*W<sub>OA,zone\\ peak</sub>·DesCoolMassFlow<sub>zone</sub>*)/

* NonCoinCoolMassFlow<sub>sys</sub>*

At the end of the zone loop calculate mixed air conditions and the system sensible cooling capacity.

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *NonCoinCoolMassFlow<sub>sys</sub>*

*T<sub>mix</sub>* =*SysCoolOutTemp*· *FracOA* + *SysCoolRetTemp*· (1 – *FracOA*)

*W<sub>mix</sub>* = *SysCoolOutHumRat* · *FracOA* + *SysCoolRetHumRat* ·

(1 – *FracOA*)

*SysSensCoolCap*=*C<sub>p,air</sub>*· *NonCoinCoolMassFlow* ·( *T<sub>mix</sub>*-*T<sub>sup</sub>*)

Then (for noncoincident sizing) the variables calculated in section (ii) are moved into the *CalcSysSizing* Array.

(c)  Loop over all of the zones heated by this air loop.

(i)    In *FinalZoneSizing* replace the value in *DesHeatCoilInTemp* with the user specified *HeatSupTemp<sub>sys</sub>*. Do the same for *DesHeatCoilInHumRat* and *HeatSupHumRat*. This ensures that zone equipment connected to an air loop will use the system design supply air conditions as coil entering conditions.

(ii)   *NonCoinHeatMassFlow<sub>sys</sub>*=*DesHeatMassFlow<sub>zone</sub>*

*SysHeatRetTemp*=(*ZoneRetTempAtHeatPeak·DesHeatMassFlow<sub>zone</sub>*)

/*NonCoinHeatMassFlow<sub>sys</sub>*

*SysHeatRetHumRat*=(*ZoneHumRatAtHeatPeak·*

*DesHeatMassFlow<sub>zone</sub>*)/*NonCoinHeatMassFlow<sub>sys</sub>*

*SysHeatOutTemp*=(*T<sub>OA,zone\\ peak</sub>·DesHeatMassFlow<sub>zone</sub>*)/

* NonCoinHeatMassFlow<sub>sys</sub>*

*SysHeatOutHumRat*=(*W<sub>OA,zone\\ peak</sub>·DesHeatMassFlow<sub>zone</sub>*)/

* NonCoinHeatMassFlow<sub>sys</sub>*

At the end of the zone loop calculate mixed air conditions and the system sensible cooling capacity.

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *NonCoinHeatMassFlow<sub>sys</sub>*

*T<sub>mix</sub>* =*SysHeatOutTemp*· *FracOA* + *SysHeatRetTemp*· (1 – *FracOA*)

*W<sub>mix</sub>* = *SysHeatOutHumRat* · *FracOA* + *SysHeatRetHumRat* ·

(1 – *FracOA*)

*SysHeatlCap*=*C<sub>p,air</sub>*· *NonCoinHeatlMassFlow* ·( *T<sub>sup</sub>*-*T<sub>mix</sub>*)

Then (for noncoincident sizing) the variables calculated in section (ii) are moved into the *CalcSysSizing* Array.

(2)  We now have the calculated system sizing data. This data needs to be altered to take into account the user input system design flow rates (if any), or the fact that the user may have requested that the system flow rate be sized on the ventilation requirement. Note that user specified sizing ratios have already been applied to the zone sizing data which have been used in out preceding system sizing calculation. Thus the user specified sizing ratios do not have to be explicitly taken into account at the system level.

First we move the calculated system sizing data from *CalcSysSizing* array into the *FinalSysSizing* array. *FinalSysSizing* will contain the user modified system design data when we are all done.

Loop over the air loops.

(i)    As in the zone case, the user specified system design flow rates are turned into sizing ratios by dividing the user input value by the calculated value. The same strategy is employed for sizing on the ventilation requirement: the design ventilation flow rate is divided by the calculated design flow rate value. For each air loop this gives us a *SizRat<sub>cool</sub>* and *SizRat<sub>heat</sub>*.

*CoinCoolMassFlow*= *SizRat<sub>cool</sub>*· *CoinCoolMassFlow<sub>calc</sub>*

*NonCoinCoolMassFlow*= *SizRat<sub>cool</sub>*· *NonCoinCoolMassFlow<sub>calc</sub>*

*DesCoolVolFlow*= *SizRat<sub>cool</sub>*· *DesCoolVolFlow<sub>calc</sub>*

Since the flow rates have been altered the outside air fraction will change. This will alter the design mixed air conditions and lead to an altered value for the cooling capacity. This must be done for the time-step sequence and for the peak value.

(ii)   Loop over the zone timesteps (index=*i*).

*CoolFlowSeq<sub>sys</sub>(i)*= *SizRat<sub>cool</sub>*· *CoolFlowSeq<sub>sys,calc</sub>(i)*

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *CoolFlowSeq<sub>sys</sub>(i)*

*T<sub>mix</sub>*= *SysCoolOutTempSeq(i)·FracOA +*

*SysCoolRetTempSeq(i)·(*1-FracOA)

*SensCoolCapSeq(i)*= *C<sub>p,air</sub>*· *CoolFlowSeq<sub>sys</sub>(i)* ·( *T<sub>mix</sub>*-*T<sub>sup</sub>*)

(iii)  Do the same calculation for peak cooling.

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *DesCoolVolFlow*

*T<sub>mix</sub>*= *CoolOutTemp<sub>sys</sub>·FracOA + CoolRetTemp<sub>sys</sub>·(*1-FracOA)

*W<sub>mix</sub>*= *CoolOutHumRat<sub>sys</sub>·FracOA + CoolRetHumRat<sub>sys</sub>·*

*(*1-FracOA)

*SensCoolCap<sub>sys</sub>*= *C<sub>p,air</sub>*· *DesCoolVolFlow<sub>sys</sub>* ·( *T<sub>mix</sub>*-*T<sub>sup</sub>*)

*T<sub>mix</sub>* and *W<sub>mix</sub>* are saved in *FinalSysSizing* *.*

(iv) Do the same calculation for the heating case.

*CoinHeatMassFlow*= *SizRat<sub>heat</sub>*· *CoinHeatMassFlow<sub>calc</sub>*

*NonCoinHeatMassFlow*= *SizRat<sub>heat</sub>*· *NonCoinHeatMassFlow<sub>calc</sub>*

*DesHeatVolFlow*= *SizRat<sub>heat</sub>*· *DesHeatVolFlow<sub>calc</sub>*

(v)  Loop over the zone timesteps (index=*i*).

*HeatFlowSeq<sub>sys</sub>(i)*= *SizRat<sub>Heat</sub>* · *HeatFlowSeq<sub>sys,calc</sub>(i)*

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *HeatFlowSeq<sub>sys</sub>(i)*

*T<sub>mix</sub>*= *SysHeatOutTempSeq(i)· FracOA +*

* SysHeatRetTempSeq(i)·* *(*1-FracOA)

*HeatCapSeq(i)*= *C<sub>p,air</sub>*· *HeatFlowSeq<sub>sys</sub>(i)* ·(*T<sub>sup</sub>*-*T<sub>mix</sub>*)

(vi) Do the same calculation for peak heating.

*FracOA=r<sub>air</sub>*· *DesOutAirVolFlow<sub>sys</sub>*/ *DesHeatVolFlow*

*T<sub>mix</sub>*= *HeatOutTemp<sub>sys</sub>·FracOA + HeatRetTemp<sub>sys</sub>·* *(*1-FracOA)

*W<sub>mix</sub>*= *HeatOutHumRat<sub>sys</sub>·FracOA + HeatRetHumRat<sub>sys</sub>·*

*(*1-FracOA)

*HeatCap<sub>sys</sub>*= *C<sub>p,air</sub>*· *DesHeatVolFlow<sub>sys</sub>* ·( *T<sub>sup</sub>*-*T<sub>mix</sub>*)

*T<sub>mix</sub>* and *W<sub>mix</sub>* are saved in *FinalSysSizing* *.*

(vii)*DesMainVolFlow<sub>sys</sub>*=**MAX**(*DesCoolVolFlow<sub>sys</sub>*,*DesHeatVolFlow<sub>sys</sub>*)

**This concludes the system design calculation.**

** **

**Scalable System HVAC Sizing**

The scalable system sizing applies to system supply air flow rates and sysyem capacity in coolin and heating modes.



**Scalable System Air Flow Sizing**

The scalable sizing methods for supply air flow rate allowed are  either, *FlowPerFloorArea*, *FractionOfAutosizedCoolingAirflow*, or *FlowPerCoolingCapacity*. The scalable system air flow sizing methods are defined as follows:





*FlowPerFloorArea* means the program calculates the cooling supply air volume flow rate from zone floor area served by the airloop and user specified *Flow Per Floor Area* value.



*FractionOfAutosizedCoolingAirflow* means the program calculates the cooling supply air volume flow rate from user specified fraction and the autosized design cooling supply air volume flow rate value determined by the simulation.



*FractionOfAutosizedHeatingAirflow* means the program calculates the heating supply air volume flow rate from user specified fraction and the autosized design heating supply air volume flow rate value determined by the simulation.



*FlowPerCoolingCapacity* means the supply air volume is calculated from user specified flow per cooling capacity and design cooling capacity determined by the simulation.



*FlowPerHeatingCapacity* means the supply air volume is calculated from user specified flow per heating capacity and design heating capacity determined by the simulation.



**Scalable System Capacity Sizing**

The scalable sizing methods for system capacity available are: *CapacityPerFloorArea*, *FractionOfAutosizedCoolingCapacity* and *FractionOfAutosizedHeatingCapacity*. The scalable system capacity sizing methods are defined as follows:



*CapacityPerFloorArea* means the program calculates the design capacity from user specified capacity per floor area and floor area of the zones served by the airloop.



*FractionOfAutosizedCoolingCapacity* means the program calculates the design cooling capacity from user specified fraction and the auto-sized design cooling capacity.

** **

*FractionOfAutosizedHeatingCapacity* means the program calculates the design heating capacity from user specified fraction and the auto-sized design heating capacity.

Plant Loop Sizing
-----------------

### Introduction

The program needs to be able to autosize the fluid flow rate in each plant fluid loop. The design plant loop flow rates are set by the sum of the needs of the demanding components on each loop. For chilled water loops these components will be cooling coils. For hot water loops – hot water coils. And for condenser loops – various types of chiller that use condenser water for cooling. Each component that uses water for heating or cooling stores its design water flow rate (in its sizing routine) in the array *CompDesWaterFlow*, labeled by its inlet water supply node number. These individual component design water flow rates are then accessed, summed for each plant loop, and stored in the *PlantSizingData* array. This array also contains the user specified design values for each plant loop.

### Hot and Chilled Water Loop Sizing

#### Maximum Loop Volumetric Flow Rate

The loop maximum volumetric flow rate (m<sup>3</sup>) is just set equal to the value stored in the *PlantSizData* array for this loop.

#### Volume of the plant loop

Since the loop capacitance has a stability requirement of <span>$(\dot V\cdot \Delta tstep/V) \le 1$</span> the volume is set so that the stability requirement will be 0.8 at the zone time step, which is the largest time step encountered at the max flow rate the loop can reach.

<div>$$Vloop = (\dot Vloop,max\cdot \Delta tstep,zone\cdot 3600)/0.8$$</div>

### Condenser Loop Sizing

#### Maximum Loop Volumetric Flow Rate

The loop maximum volumetric flow rate (m<sup>3</sup>) is just set equal to the value stored in the *PlantSizData* array for this loop.

#### Volume of the plant loop

Since the loop capacitance has a stability requirement of <span>$(\dot V\cdot \Delta tstep/V) \le 1$</span> the volume is set so that the stability requirement will be 0.8 at the zone time step, which is the largest time step encountered at the max flow rate the loop can reach.

<div>$$Vloop = (\dot Vloop,max\cdot \Delta tstep,zone\cdot 3600)/0.8$$</div>

Coincident Plant Sizing using HVAC Sizing Simulation
----------------------------------------------------

Coincident plant sizing is an advanced sizing method that uses HVAC Sizing Simulations to determine coincident flows.  This section describes the algorithm used for sizing plant loop flow rate based on the coincidence of flow requests that actually occur when operating the system.  The purpose is to provide a more accurate value for the plant loop design flow rate.  This value is held in PlantSizData( PltSizIndex ).DesVolFlowRate.  For plant, this flow rate is the main independent variable used by component models in their sizing routines (along with the design temperature difference in Sizing:Plant). The code is contained in a PlantCoinicidentAnalysis object, one for each plant loop that is to be sized using the coincident method using HVAC Sizing Simulation.

The analysis will proceed as follows:

1. Find the maximum mass flow rate over all Sizing Periods, along with the coinciding return temperature and load.  Record which sizing period and timestep. This system node used for logging here is the plant loop supply side inlet node. 

2. Find the maximum load, and the coinciding mass flow and return temperature. Record which sizing period and timestep. For a heating or steam plant loop, the load that is logged is associated with the output variable called Plant Supply Side Heating Demand Rate.  For a cooling or condenser plant loop, the load log is as for the output variable called Plant Supply Side Cooling Demand Rate.

3. Calculate a maximum design flow rate from the maximum load, from step 2, and the temperature difference entered in the Plant:Sizing object and the specific heat (at 5°C) of the plant fluid.  

4. Compare the flow rate from step 1 to the flow rate from step 3 and take the higher.

5. Apply a sizing factor to the flow rate from Step 4, if desired.  The user can select among different options for which sizing factor use.  

6. Compare the flow rate from step 5 to the current value for plant loop flow rate and calculate a normalized change using 

    * <span>$
        \rm{Normalized_Change} = \frac{ \left| \rm{NewFlowRate}-\rm{PreviousFlowRate} \right|} \rm{PreviousFlowRate}
      $</span>

7. Normalized_Change = <span>$\frac{\left|\text{NewFlowRate}-\text{PreviousFlowRate}\right|}{\text{PreviousFlowRate}}$</span>
    * Compare magnitude of Normalized_Change to a threshold, currently set at 0.005, to determine if it was significant or not.
    * If change is significant, then alter the size result for that plant loop. Set flags that sizes have changed and sizing calculations need to be called again.  Trigger special setup timesteps with flags set so that all plant system and component level sizes will be recomputed.  Not this will call and resize all of plant so that if one loop has coincident sizing and it places a load on a loop that has noncoincident sizing, the noncoincident loop might still change size because the loop it depends on changed.  Call for another Sizing Pass. 
    * If change is not significant, then leave the sizes alone and do not trigger resizing. Do not call for another Sizing Pass. 

See OutputDetailsAndExamples documentation for a description of a fairly comprehensive report sent the EIO file called “Plant Coincident Sizing Algorithm” which provides the user details for each execution of  the algorithm. There is also a predefined summary table 

The algorithm described above can have powerful impacts on the sizes of plant loops.  It is not uncommon for a hot water plant to size out at around half of what would be determined from the noncoincident sum of the sizes of all the components connected to the loop.  The maximum load aspect of the algorithm is able to increase plant flow rates above the size of the pumps, whereas the flow rate aspect of the algorithm is only able to reduce the flow rates.  It can happen that load spikes cause sizes to increase after the first Sizing Pass, and then the coincident flow rate bring the sizes back down some during subsequent Sizing Passes.  It is worthwhile to explore multiple Sizing Passes, or iterations, because sometimes the algorithm will switch between coincident flow and coincident demand from one Sizing Pass and gradually find a size that just meets conditions.  Be aware that all the controls and and EMS are also      


Component Sizing
----------------

### Introduction

In EnergyPlus each HVAC component sizes itself. Each component module contains a sizing subroutine. When a component is called for the first time in a simulation, it reads in its user specified input data and then calls the sizing subroutine. This routine checks the autosizable input fields for missing data and calculates the data when needed.

A number of high-level variables are used in the sizing subroutines.

*CurDuctType* (in *DataSizing*) contains the information about the current duct type. The types can be *main*, *cooling*, *heating* or *other*.

*CurZoneEqNum* (in *DataSizing*) is the current zone equipment set index and indicates that the component is a piece of zone equipment and should size itself using the zone sizing data arrays.

*CurSysNum* (in *DataSizing*) is the current air loop index and indicates that the component is part of the primary air system and should size itself using the system sizing data arrays.

### Fan Sizing

Fan sizing is done in subroutine *SizeFan*.

#### Max Flow Rate

If the fan is part of the central air system then check the duct type.

For duct type = *main, other* or default, <span>$\dot{V}_{fan,max} = \text{DesMainVolFlowsys}$</span>

For duct type=*cooling*, <span>$\dot{V}_{fan,max} = \text{DesCoolVolFlowsys}$</span>

For duct type=*heating*, <span>$\dot{V}_{fan,max} = \text{DesHeatVolFlowsys}$</span>

If the fan is zone equipment then check whether it is part of a component that only does heating.

For heating only <span>$\dot{V}_{fan,max} = \text{DesHeatVolFlowzone}$</span>;

Otherwise <span>$\dot{V}_{fan,max} = \max\left(\text{DesHeatVolFlowzone},\text{DesCoolVolFlowzone}\right)$</span>

If the max fan flow rate is less than *SmallAirVolFlow* the max flow rate is set to zero.

### Coil:Cooling:Water

The sizing is done in function *SizeWaterCoil* of module *WaterCoils*

#### Initial Calculations

For central cooling coils, the first step is to determine the design air flow rate, load, and design air entering and exit conditions. The coil design air flow rate is not generally the same as the maximum system air flow rate (used to size the central fans). The cooling coil peak load (either sensible or total) can occur at a different time than the system peak flow rate. Hence the coil air entering conditions can be different than those at the peak system flow rate. Also, the method of controlling the coil's cooling output may also affect coil design flow rate as well as the coil design exit temperature and humidity.

By choosing Type of Load to Size On = _Sensible_ or _Total_ in Sizing:System the user indicates to the program to save the cooling coil air flow rate and system air conditions (mixed, return, outside) at the time of either the system cooling sensible or total load peak. Note that the choice _VentilationRequirement_ uses the time of the sensible peak.

Choosing Central Cooling Capacity Control Method = _VAV_, _Bypass_, _VT_, or _OnOff_ indicates which type of cooling output control the program should assume when calculating the design air flow rate.  The function _GetCoilDesFlowT_ in module _ReportSizingManager_ calculates the air flow rate and exit air temperature for each capacity control method. 

<table class="table table-striped">
<caption>Cooling coil calculations for different capacity control methods</caption>
<tr>
 <th>Control Method</th>
 <th>Calculations</th>
</tr>
<tr>
 <td>VAV</td>
 <td><span>$ \begin{array}{rl} T_{cc,exit} &= T_{cool,supply} \\ 
                          \dot{V}_{cc,air} &= \frac{\dot{m}_{cc,air,peak}}{\rho_{air}} \end{array} $</span></td>
</tr>
<tr>
 <td>Bypass</td>
 <td><span>$ \begin{array}{rl} T_{cc,exit} &= T_{cool,supply} \\ 
                          \dot{V}_{cc,air} &= \dot{V}_{cc,air,max}\cdot\max \left(0, \min \left(1, \frac{T_{mix,at-peak}-T_{sup,avg}}{T_{mix,at-peak}-T_{cc,exit}}\right) \right) \end{array} $</span></td>
</tr>
<tr>
 <td>VT</td>
 <td><span>$ \begin{array}{rl} T_{cc,exit} &= \max\left(T_{cool,supply}, T_{sup,avg}\right) \\ 
                          \dot{V}_{cc,air} &= \dot{V}_{cc,air,max} \end{array} $</span></td>
</tr>
<tr>
 <td>OnOff</td>
 <td><span>$ \begin{array}{rl} T_{cc,exit} &= T_{cool,supply} \\ 
                          \dot{V}_{cc,air} &=\dot{V}_{sys,air,max} \end{array} $</span></td>
</tr>
</table>

Where: 

<div>$$ T_{sup,avg} = T_{zones,avg}-\sum_{zones}\frac{\dot{Q}_{sens,at-peak}}{\rho_{air}c_{p,air}\dot{V}_{cool,air,max}}$$</div>

and:

* <span>$C_{p,air}$</span>: the specific heat of air (J/kgC)

* <span>$\dot{m}_{cc,air,peak}$</span>: the air mass flow rate through the cooling coil at the sensible or total system peak cooling load (m3/s)

* <span>$\sum_{zones}\dot{Q}_{sens,at-peak}$</span>: sum of the zone sensible cooling loads at the time of the peak system cooling load

* <span>$\rho_{air}$</span>: the density of air (kg/m3)

* <span>$T_{cc,exit}$</span>: the design cooling coil exit temperature (c)

* <span>$ T_{cool,supply} $</span>: the supply air temperature for cooling specified in Sizing:System (C)

* <span>$ T_{mix,at-peak} $</span>: the mixed air temperature at the time of the system peak cooling load (C)

* <span>$ T_{zones,avg} $</span>: the average zone temperature at the time of the system peak cooling load (C)

* <span>$ \dot{V}_{cc,air} $</span>: the design volumetric air flow rate through the cooling coil (m3/s). This is the flow rate at either the sensible or total cooling load peak from the design period calculations. 

* <span>$ \dot{V}_{cool,air,max} $</span>: the maximum cooling volumetric air flow rate from the design calculations (m3/s). This flow rate occurs at the maximum zone cooling demand.

* <span>$ \dot{V}_{sys,air,max} $</span>: the maximum volumetric air flow rate from the design calculations (m3/s). This flow rate occurs at either the maximum zone cooling or heating demand.

#### Design Coil Load - System Coils

Design coil load (cooling capacity) is not an input for Coil:Cooling:Water. It is used for calculating the design water flow rate.

The design load is calculated as:

<div>$$ \dot{Q}_{coil,des} = \dot{m}_{a,coil,des}\left(h_{a,coil,des,in}-h_{a,coil,des,out}\right) $$</div>

Where:

* <span>$ h_{a,coil,des,in} $</span>: is the coil design inlet air enthalpy (J/kg)

* <span>$ h_{a,coil,des,out} $</span>: is the coil design outlet air enthalpy (J/kg), and 

* <span>$ \dot{m}_{a,coil,des} $</span>: is the coil design air mass flow rate (kg/s)

The design air mass flow rate depends on the location of the coil.  If the coil is in the outside air stream, the flow rate is set to 

<div>$$\rho_{air}\dot{V}_{a,coil,oa,des}$$</div> where <span>$\dot{V}_{a,coil.oa,des}$</span> is the design outside air volumetric flow rate for the system.  Otherwise, it is set to:

<div>$$\rho_{air}\dot{V}_{cc,air}$$</div>

where <span>$\dot{V}_{cc,air}$</span> is calculated above in the Initial Calculations section.

To obtain the inlet and outlet enthalpies, we need the inlet and outlet temperatures and humidity ratios. The inlet and outlet conditions depend on whether the coil is in the outside air stream and if it is not, whether or not there is outside air preconditioning.

##### **Coil in outside air stream**:<a name="CoilVsSpacePeakCondition1"></a>

* <span>$T_{air,in,des}=T_{out,cool,at-peak}$</span> (the outside air temperature at the design cooling peak)
  
* <span>$T_{air,out,des}=T_{sys,precool}$</span> (the specified Precool Design Temperature from the System:Sizing object)

* <span>$W_{air,in,des} = W_{out,cool,at-peak}$</span> (the outside humidity ratio at the design cooling peak)

* <span>$W_{air,out,des}=W_{sys,precool}$</span> (the specified Precool Design Humidity Ratio from the System:Sizing object)
  
##### **Coil in main air stream, no preconditioning of outside air** <a name="CoilVsSpacePeakCondition2"></a>

* <span>$T_{air,in,des}=T_{mix,cool,at-peak}$</span> (the mixed air temperature at the design cooling peak)
  
* <span>$W_{air,in,des} = W_{mix,cool,at-peak}$</span> (the mixed humidity ratio at the design cooling peak)

* <span>$T_{air,out,des}=T_{cc,exit}$</span> (calculated above in the Initial Calculation section)

* <span>$W_{air,out,des}=W_{sup,cool}$</span> (the specified Central Cooling Design Supply Air Humidity Ratio from the Sizing:System object)

##### **Coil in main air stream, outside air preconditioned** <a name="CoilVsSpacePeakCondition3"></a>

The oustide air fraction is calculated as  (where V<sub>cc,air</sub> is calculated as above)

* <span>$f_{oa}=\frac{\dot V_{air,out,des}}{\dot{V}_{cc,air}}$</span>

* <span>$T_{air,in,des}=f_{oa}T_{precool} + \left(1-f_{oa}\right)T_{ret,cool,at-peak}$</span>(Precool temperature is the specified Precool Design Temperature from System:Sizing Manager; T_ret_cool_at-peak is the return temperature at the system cooling peak load)

* <span>$W_{air,in,des}=f_{oa}W_{precool} + \left(1-f_{oa}\right)W_{ret,cool,at-peak}$</span>(Precool humidity ratio is the specified Precool Design Humidity Ratio from System:Sizing Manager; W_ret_cool_at-peak is the return humidity ratio at the system cooling peak load)
  
* <span>$T_{air,out,des}=T_{cc,exit}$</span> (calculated above in the Initial Calculation section)

* <span>$W_{air,out,des}=W_{sup,cool}$</span> (the specified Central Cooling Design Supply Air Humidity Ratio from the Sizing:System object)

With the inlet and outlet conditions established, we can obtain the inlet and outlet enthalpies:

<div>$$ \begin{array}{rl}
  h_{air,coil,des,in} &= \text{PsyHFnTdbW}\left(T_{air,in,des},W_{air,in,des}\right) \\
  h_{air,coil,des,out} &= \text{PsyHFnTdbW}\left(T_{air,out,des},W_{air,out,des}\right) \\
\end{array}$$</div>

Where PsyHFnTdbW is the EnergyPlus function for calculation air specific enthalpy given the air temperature and humidity ratio.  We now have all we need to calculate the design coil capacity, <span>$\dot{Q}_{coil,des}$</span>.

#### Design Coil Load - Zone Coils

If the coil is part of an AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction unit or an ZoneHVAC:FourPipeFanCoil, the cooling load (cooling capacity) is passed down from the terminal unit or fan coil sizing calculations. Otherwise the load is defined as:

<div>$$\dot{Q}_{coil,des} = \dot{m}_{a,coil,des}\left(h_{a,coil,des,in}-h_{a,coil,des,out}\right)$$</div>

Where:

* <span>$ h_{a,coil,des,in} $</span>: is the coil design inlet air enthalpy (J/kg)

* <span>$ h_{a,coil,des,out} $</span>: is the coil design outlet air enthalpy (J/kg), and 

* <span>$ \dot{m}_{a,coil,des} $</span>: is the coil design air mass flow rate (kg/s)

The enthalpies are given by:

<div>$$ \begin{array}{lr}
  h_{air,coil,des,in} &= \text{PsyHFnTdbW}\left(T_{air,in,des},W_{air,in,des}\right) \\
  h_{air,coil,des,out} &= \text{PsyHFnTdbW}\left(T_{air,out,des},W_{air,out,des}\right) \\
\end{array}$$</div>

Where the inputs to those functions are the coil inlet design conditions.  For coils in terminal units these are set at the system level to the system design supply air temperature. For zonal units they are set to design return air, mixed air, or outside air as appropriate to the unit. T<sub>air,out,des</sub> is set to the zone cooling design supply air temperature as specified in the _Zone:Sizing_ inputs. W<sub>air,out,des</sub> is set to the zone cooling design supply air humidity ratio as specified in the _Zone:Sizing_ inputs.

#### Design Water Flow Rate (m<sup>3</sup>/s) - System Coils

The design water volumetric flow rate is calculated using:

<div>$$ \dot{V}_{w,coil,des} = \frac{\dot{Q}_{coil,des}}{\rho_w c_{p,w} \Delta T_{w,des}} $$</div>

Where <span>$\Delta T_{w,des}$</span> is just the *Loop Design Temperature Difference* user input from *Sizing:Plant* (if the coil is in the outside air stream, 1/2 the *Loop Design Temperature Difference* is used). The design coil load *Load<sub>coil,des</sub>* is calculated from:

#### Design Water Flow Rate (m<sup>3</sup>/s) - Zone Coils

If the coil is part of an AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction unit or an ZoneHVAC:FourPipeFanCoil, the chilled water flow rate is passed down from the terminal unit or fan coil sizing calculations. Otherwise the flow is set to:

<div>$$ \dot{V}_{w,coil,des} = \frac{\dot{Q}_{coil,des}}{\rho_w c_{p,w} \Delta T_{w,des}} $$</div>

Where <span>$\Delta T_{w,des}$</span> is just the *Loop Design Temperature Difference* user input from *Sizing:Plant*.

#### Design Air Flow Rate - System Coils

The design air volumetric flow rate for the system cooling coil is set to:

1. the design outside air flow rate if the coil is in the outside air stream;

2. the coil design flow rate from function GetCoilDesFlowT described in section "Initial Calculations";

3. the design flow rate set by the parent component (such as a unitary system) containing the cooling coil.

#### Design Air Flow Rate - Zone Coils

Zone chilled water coils are always part of a zone HVAC component. In almost all cases the design flow rate is passed down from the design flow rate of the parent component. Otherwise if the parent component does cooling only the flow rate for the coil is set to the zone design cooling flow rate. And if the parent component does both cooling and heating, the coil flow rate is set to the maximum of the zone design cooling and heating flow rates.

#### Design Air Inlet Temperature - System Coils

The inlet air temperature depends on whether the coil is in the outside air stream and if it is not, whether or not there is outside air preconditioning.

* Coil in outside air stream: <span>$T_{air,in,des}=T_{out,cool,at-peak}$</span> (the outside air temperature set at the design cooling peak).

* Coil in main air stream, no preconditioning of outside air: <span>$T_{air,in,des}=T_{mix,cool,at-peak}$</span> (the mixed air temperature at the cooling design peak).

* Coil in main air stream, outside air preconditioned.  The outside air fraction is calculated as <span>$f_{oa}= \dot V_{air,out,des}/\dot V_{cc,air}$</span>, where <span>$\dot V_{cc,air}$</span> is calculated above.  Then <span>$T_{air,in,des}=f_{oa}T_{precool}+\left(1-f_{oa}\right)T_{ret,cool,at-peak}$</span>, where <span>$T_{precool}$</span> is the specified *Precool Design Temperature* from *System:Sizing*, and <span>$T_{ret,cool,at-peak}$</span> is the return temperature at the system cooling peak load.

#### Design Air Inlet Temperature - Zone Coils

The design inlet temperature depends on whether the coil is in a terminal unit or a zonal unit, and where the coil is positioned within the unit.

1. For the AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction terminal unit the design inlet temperature is set to the zone temperature at the time of the zone cooling peak, since the coil is located in the induced air stream.

2. For fan coil units the design inlet temperature is set to the mixed air temperature: <span>$T_{air,in,des}=f_{oa}T_{oa,coolpeak} + \left(1-f_{oa}\right)T_{z,coolpeak}$</span>, where <span>$f_{oa} = \rho_a \dot V_{z,oa,des} / \dot m_{z,cool,des}$</span>

3. In all other cases the design inlet temperature is set to the zone design cooling coil inlet temperature which is calculated in the zone sizing simulation and is basically the same calculation as the fan coil unit.

#### Design Air Outlet Temperature - System Coils

The outlet air temperature depends on whether the coil is in the outside air stream.

1. Coil in outside air stream: T<sub>air,out,des</sub> = T<sub>sys,des,precool</sub> (the specified Precool Design Temperature from the Sizing:System object).

2. Coil in main air stream: the design outlet air temperature is set to the temperature calculated in the Initial Calculation section above.

#### Design Air Outlet Temperature - Zone Coils

If the coil is part of an AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction unit, then:

<div>$$
 \begin{array}{rl}
  \dot{Q}_{coil,des} &= c_{p,air}\rho_{air}\dot{V}_{w,coil,des}\Delta T_{w,des} \\
  T_1 &= T_{air,in,des} - \dot{Q}_{coil,des} / \left(\rho_{air}c_{p,air}\dot V_{air,coil,des}\right) \\
  T_2 &= T_{w,out,des} + 2 \\
  T_{air,out,des} &= \max \left(T_1,T_2\right)
 \end{array}
$$</div>

For all other cases T<sub>air,out,des</sub> is set to T<sub>z,sup,des</sub> (the zone design supply air temperature as specified in Sizing:Zone).

#### Design Inlet Air Humidity Ratio - System Coils

The design inlet humidity ratio depends on whether the coil is in the outside air stream and if it is not, whether or not there is outside air preconditioning.

* Coil in outside air stream: <span>$W_{air,in,des}=W_{out,cool,at-peak}$</span> (the outside air humidity ratio at the design cooling peak).

* Coil in main air stream, no preconditioning of outside air: <span>$W_{air,in,des}=W_{mix,cool,at-peak}$</span> (the mixed air humidity ratio at the cooling design peak).

* Coil in main air stream, outside air preconditioned.  The outside air fraction is calculated as <span>$f_{oa}= \dot V_{air,out,des}/\dot V_{cc,air}$</span>, where <span>$\dot V_{cc,air}$</span> is calculated above.  Then <span>$W_{air,in,des}=f_{oa}W_{precool}+\left(1-f_{oa}\right)W_{ret,cool,at-peak}$</span>, where <span>$W_{precool}$</span> is the specified *Precool Design Humidity Ratio* from *System:Sizing*, and <span>$W_{ret,cool,at-peak}$</span> is the return humidity ratio at the system cooling peak load.

#### Design Air Inlet Humidity Ratio - Zone Coils

The design inlet humidity ratio depends on whether the coil is in a terminal unit or a zonal unit, and where the coil is positioned within the unit.

1. For the AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction terminal unit the design inlet humidity ratio is set to the zone humidity ratio at the time of the zone cooling peak, since the coil is located in the induced air stream.

2. For fan coil units the design inlet humidity ratio is set to the mixed air humidity ratio: <span>$W_{air,in,des}=f_{oa}W_{oa,coolpeak} + \left(1-f_{oa}\right)W_{z,coolpeak}$</span>, where <span>$f_{oa} = \rho_a \dot V_{z,oa,des} / \dot m_{z,cool,des}$</span>

3. In all other cases the design inlet humidity ratio is set to the zone design cooling coil inlet hunidity ratio which is calculated in the zone sizing simulation and is basically the same calculation as the fan coil unit.

#### Design Outlet Air Humidity Ratio - System Coils

The outlet air humidity ratio depends on whether the coil is in the outside air stream.

* Coil in outside air stream: W<sub>air,out,des</sub> = W<sub>sys,des,precool</sub> (the specified Precool Design Humidity Ratio from the Sizing:System object)

* Coil in main air stream: W<sub>air,out,des</sub> = PsyWFnTdbRhPb(T<sub>air,out,des</sub>,0.9,P<sub>air,std</sub>), where PsyWFnTdbRhPb is the EnergyPlus psychrometric function to calculate humidity ratio from drybulb temperature, relative humidity, and atmospheric pressure. The design outlet humidity ratio is being set to the humidity ratio at 90% relative humidity and design outlet temperature.

#### Design Outlet Air Humidity Ratio - Zone Coils

* If the coil is part of an AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction unit, then:
    
    * Get the dewpoint temperature at W<sub>air,in,des</sub>: <span>$T_{dp,in}=\text{PsyTdpFnWPb}\left(W_{air,in,des},P_{air,std}\right)$</span>
    
    * If T<sub>dp,in</sub> <= T<sub>w,in,des</sub> set W<sub>air,out,des</sub> = W<sub>air,in,des</sub>.  Otherwise set W<sub>air,out,des</sub> = min(PsyWFnTdbRhPb(T<sub>air,out,des</sub>,0.9,P<sub>air,std</sub>),W<sub>air,in,des</sub>)
    
#### Design Inlet Water Temperature - System Coils

The Design Inlet Water Temperature is set to the Design Loop Exit Temperature specified in the Sizing:Plant object for the water loop serving this coil.

#### Design Inlet Water Temperature - Zone Coils

The Design Inlet Water Temperature is set to the Design Loop Exit Temperature specified in the Sizing:Plant object for the water loop serving this coil.

### Coil:Cooling:Water:DetailedGeometry Sizing

The sizing is done in subroutine *SizeWaterCoil*

#### Max Water Flow Rate of Coil

The calculation is identical to that done for *Coil:Cooling:Water*.

#### Number of Tubes per Row

<div>$$Ntube/row = {\mathop{\rm Int}\nolimits} ({\rm{13750}}\cdot \dot Vcoil,water,max)$$</div>

*N<sub>tube/row</sub>*=**Max**(*N<sub>tube/row</sub>*,3)

#### Fin Diameter

Depending on the duct type, get the coil design air flow rate.

For duct type = *main, other* or default

<div>$$\dot mair,des = \rho air\cdot DesMainVolFlowsys$$</div>

for duct type=*cooling*

<div>$$\dot mair,des = \rho air\cdot DesCoolVolFlowsys$$</div>

for duct type=*heating*

<div>$$\dot mair,des = \rho air\cdot DesHeatVolFlowsys$$</div>

<div>$$Dfin = 0.335\cdot \dot mair,des$$</div>

#### Minimum Air Flow Area

Depending on the duct type, get the coil design air flow rate.

For duct type = *main, other* or default

<div>$$\dot mair,des = \rho air\cdot DesMainVolFlowsys$$</div>

for duct type=*cooling*

<div>$$\dot mair,des = \rho air\cdot DesCoolVolFlowsys$$</div>

for duct type=*heating*

<div>$$\dot mair,des = \rho air\cdot DesHeatVolFlowsys$$</div>

<div>$$AMinAirFlow = 0.44\cdot \dot mair,des$$</div>

#### Fin Surface Area

Depending on the duct type, get the coil design air flow rate.

For duct type = *main, other* or default

<div>$$\dot mair,des = \rho air\cdot DesMainVolFlowsys$$</div>

for duct type=*cooling*

<div>$$\dot mair,des = \rho air\cdot DesCoolVolFlowsys$$</div>

for duct type=*heating*

<div>$$\dot mair,des = \rho air\cdot DesHeatVolFlowsys$$</div>

<div>$$AFinSurf = 78.5\cdot \dot mair,des$$</div>

#### Total Tube Inside Area

*A<sub>tube,total\\ inside</sub>*=4.4·*D<sub>tube,inside</sub>*·*N<sub>tube\\ rows</sub>*·*N<sub>tubes/row</sub>*

Where *D<sub>tube,inside</sub>* is the tube inside diameter.

#### Tube Outside Surf Area

*A<sub>tube,outside</sub>*=4.1·*D<sub>tube,outside</sub>*·*N<sub>tube\\ rows</sub>*·*N<sub>tubes/row</sub>*

Where *D<sub>tube,outside</sub>* is the tube outside diameter.

#### Coil Depth

*Depth<sub>coil</sub>*=*Depth<sub>tube\\ spacing</sub>*· *N<sub>tube\\ rows</sub>*

### Coil:Cooling:WaterToAirHeatPump:EquationFit Sizing

The sizing is done in subroutine *SizeHVACWaterToAir*

#### Rated Air Flow Rate

The calculation is identical to that done for *Coil:Cooling:Water*.

#### Rated Water Flow Rate

The calculation is identical to that done for *Coil:Cooling:Water*, which is the coil design load divided by the *Loop Design Temperature Difference* user input from *Sizing:Plant.* If there is a companion heating coil, the heating coil design load is used so that both modes will have the same rated water flow rate. For sizing the plant loop serving this coil, only one half of this flow rate is used since both the cooling and heating coil will save a flow rate but only one of these coils will operate at a time.

#### Rated Total Cooling Capacity

The calculation for coil operating temperatures (inlet and outlet) are identical to that done for *Coil:Cooling:Water*. The following calculations are then performed to determine the rated total cooling capacity.

<div>$${T_{WB,ratio}} = {\raise0.7ex\hbox{${\left( {{T_{WB,air,in,des}} + 273.15\,C} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {{T_{WB,air,in,des}} + 273.15\,C} \right)} {283.15\,C}}}\right.}\!\lower0.7ex\hbox{${283.15\,C}$}}$$</div>

<div>$${T_{S,ratio}} = {\raise0.7ex\hbox{${\left( {29.44\,C + 273.15\,C} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {29.44\,C + 273.15\,C} \right)} {283.15\,C}}}\right.}\!\lower0.7ex\hbox{${283.15\,C}$}}$$</div>

where:

<span>${T_{WB,ratio}} = $</span>ratio of load-side inlet air wet-bulb temperature in Kelvin to a reference temperature

<span>${T_{S,ratio}} = $</span> ratio of source-side inlet water temperature in Kelvin to a reference temperature

TCC1 = user input for Total Cooling Capacity Coefficient 1

TCC2 = user input for Total Cooling Capacity Coefficient 2

TCC3 = user input for Total Cooling Capacity Coefficient 3

TCC4 = user input for Total Cooling Capacity Coefficient 4

TCC5 = user input for Total Cooling Capacity Coefficient 5

<div>$$TotCapTempModFac = \,TCC1 + TCC2\left( {{T_{WB,ratio}}} \right) + TCC3\left( {{T_{S,ratio}}} \right) + TCC4 + TCC5$$</div>

The 4<sup>th</sup> and 5<sup>th</sup> coefficient (TCC4 and TCC5) used in the above equation are multipliers for the load-side and source-side flow ratios, respectively. For sizing, these ratios are assumed to be 1.

The enthalpy of the entering air is then compared with the enthalpy of the exiting air. The calculations for air enthalpy are identical to that done for *Coil:Cooling:Water*. If the entering air enthalpy is less than the exiting air enthalpy, a reference value of 48,000 J/kg is used as the entering air enthalpy. If the TotCapTempModFac calculation above yields 0 as the result, a value of 1 is used in the following calculation. If the design air mass flow rate is determined to be less than a very small flow value (0.001 kg/s) or the capacity calculated here is less than 0, the coil total cooling capacity is set equal to 0.

<div>$$\begin{array}{l}IF({H_{in}}\, > \,{H_{out}})THEN\\\,\,\,\,\,{\mathop Q\limits^\cdot_{coil,des,total}} = {\raise0.7ex\hbox{${{m_{air,des}}\left( {{H_{in}} - {H_{out}}} \right)}$} \!\mathord{\left/ {\vphantom {{{m_{air,des}}\left( {{H_{in}} - {H_{out}}} \right)} {TotCapTempModFac}}}\right.}\!\lower0.7ex\hbox{${TotCapTempModFac}$}}\\ELSE\\\,\,\,\,\,{\mathop Q\limits^\cdot_{coil,des,total}} = {\raise0.7ex\hbox{${{m_{air,des}}\left( {48000 - {H_{out}}} \right)}$} \!\mathord{\left/ {\vphantom {{{m_{air,des}}\left( {48000 - {H_{out}}} \right)} {TotCapTempModFac}}}\right.}\!\lower0.7ex\hbox{${TotCapTempModFac}$}}\\ENDIF\end{array}$$</div>

#### Rated Sensible Cooling Capacity

The calculation for coil operating temperatures (inlet and outlet) are identical to that done for *Coil:Cooling:Water*. The following calculations are then performed to determine the rated sensible cooling capacity.

<div>$${T_{DB,ratio}} = {\raise0.7ex\hbox{${\left( {{T_{DB,air,in,des}} + 273.15\,C} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {{T_{DB,air,in,des}} + 273.15\,C} \right)} {283.15\,C}}}\right.}\!\lower0.7ex\hbox{${283.15\,C}$}}$$</div>

<div>$${T_{S,ratio}} = {\raise0.7ex\hbox{${\left( {29.44\,C + 273.15\,C} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {29.44\,C + 273.15\,C} \right)} {283.15\,C}}}\right.}\!\lower0.7ex\hbox{${283.15\,C}$}}$$</div>

where:

<span>${T_{DB,ratio}} = $</span>ratio of load-side inlet air dry-bulb temperature in Kelvin to a reference temperature

SCC1 = user input for Sensible Cooling Capacity Coefficient 1

SCC2 = user input for Sensible Cooling Capacity Coefficient 2

SCC3 = user input for Sensible Cooling Capacity Coefficient 3

SCC4 = user input for Sensible Cooling Capacity Coefficient 4

SCC5 = user input for Sensible Cooling Capacity Coefficient 5

SCC6 = user input for Sensible Cooling Capacity Coefficient 6

<div>$$\begin{array}{l}SensCapTempModFac = \,SCC1 + SCC2\left( {{T_{DB,ratio}}} \right) + SCC3\left( {{T_{WB,ratio}}} \right) + SCC4\left( {{T_{S,ratio}}} \right)\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + SCC5 + SCC6\end{array}$$</div>

The 5<sup>th</sup> and 6<sup>th</sup> coefficient (SCC5 and SCC6) used in the above equation are multipliers for the load-side and source-side flow ratios, respectively. For sizing, these ratios are assumed to be 1.

The dry-bulb temperature of the entering air is then compared with the dry-bulb temperature of the exiting air. The calculations for air dry-bulb temperature are identical to that done for *Coil:Cooling:Water*. If the entering air dry-bulb temperature is less than the exiting air dry-bulb temperature, a reference value of 24 C is used as the entering air dry-bulb temperature. If the SensCapTempModFac calculation above yields 0 as the result, a value of 1 is used in the following calculation. If the design air mass flow rate is determined to be less than a very small flow value (0.001 kg/s) or the capacity calculated here is less than 0, the coil sensible cooling capacity is set equal to 0.

<div>$$\begin{array}{l}IF({T_{DB,in}}\, > \,{T_{DB,out}})THEN\\\,\,\,\,\,{\mathop Q\limits^\cdot_{coil,des,sensible}} = {\raise0.7ex\hbox{${{m_{air,des}}C{p_{air,des}}\left( {{T_{DB,in}} - {T_{DB,out}}} \right)}$} \!\mathord{\left/ {\vphantom {{{m_{air,des}}C{p_{air,des}}\left( {{T_{DB,in}} - {T_{DB,out}}} \right)} {SensCapTempModFac}}}\right.}\!\lower0.7ex\hbox{${SensCapTempModFac}$}}\\ELSE\\\,\,\,\,\,{\mathop Q\limits^\cdot_{coil,des,sensible}} = {\raise0.7ex\hbox{${{m_{air,des}}C{p_{air,des}}\left( {24 - {T_{DB,out}}} \right)}$} \!\mathord{\left/ {\vphantom {{{m_{air,des}}C{p_{air,des}}\left( {24 - {T_{DB,out}}} \right)} {SensCapTempModFac}}}\right.}\!\lower0.7ex\hbox{${SensCapTempModFac}$}}\\ENDIF\end{array}$$</div>

### Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit Sizing

For the cooling coil of VS WSHP, we specify a nominal speed level. During the sizing calculation, the Rated Air Volume Flow Rate, the Rated Water Volume Flow Rate and the Rated Total Cooling Capacity at the Selected Nominal Speed Level are determined in the same way as the *Coil:Cooling:WaterToAirHeatPump:EquationFit* object. The sensible heat transfer rate is not allowed for auto-sizing, instead, it is a function of the rated air and water flow rates, rated total cooling capacity and the Reference Unit SHR at the nominal speed level. The default nominal speed level is the highest speed. However, the model allows the user to select a nominal speed level rather than the highest.

#### Rated Air Flow Rate

The calculation is identical to that done for *Coil:Cooling:WaterToAirHeatPump:EquationFit*.

#### Rated Water Flow Rate

The calculation is identical to that done for *Coil:Cooling:WaterToAirHeatPump:EquationFit* , which is the coil design load divided by the *Loop Design Temperature Difference* user input from *Sizing:Plant.* If there is a companion heating coil, the heating coil design load is used so that both modes will have the same rated water flow rate. For sizing the plant loop serving this coil, only one half of this flow rate is used since both the cooling and heating coil will save a flow rate but only one of these coils will operate at a time.

#### Rated Total Cooling Capacity

The calculation for coil operating temperatures (inlet and outlet) are identical to that done for *Coil:Cooling:WaterToAirHeatPump:EquationFit*. The calculations for air enthalpy are similar to that done for *Coil:Cooling:WaterToAirHeatPump:EquationFit.* The difference is in calculating the total cooling capacity temperature modifier function at the selected nominal speed level, as below:

<div>$$TotCapTempModFra{c_{NominalSpeed}} = {\rm{a}} + {\rm{b*}}W{B_i} + c*WB_i^2 + {\rm{d*EWT}} + e*EW{T^2} + f*W{B_i}*EWT$$</div>

where

WB<sub>i</sub> = wet-bulb temperature of the air entering the heating coil, °C

EWT = entering water temperature, °C

a-f = regression curve-fit coefficients.

If the entering air enthalpy is less than the exiting air enthalpy, a reference value of 48,000 J/kg is used as the entering air enthalpy. If the *TotCapTempModFac* calculation above yields 0 as the result, a value of 1 is used in the following calculation. If the rated air mass flow rate is determined to be less than a very small flow value (0.001 kg/s) or the capacity calculated here is less than 0, the coil total cooling capacity is set equal to 0.

*If H<sub>in</sub> &gt; H<sub>out</sub> Then*

<div>$${\dot Q_{coil,rated,total}} = {m_{air,rated}}({H_{in}} - {H_{out}})/TotCapTempModFra{c_{NominalSpeed}}$$</div>

*Else*

<div>$${\dot Q_{coil,rated,total}} = {m_{air,rated}}(48000 - {H_{out}})/TotCapTempModFra{c_{NominalSpeed}}$$</div>

*End If*

### Coil:Heating:WaterToAirHeatPump:EquationFit Sizing

The sizing is done in subroutine *SizeHVACWaterToAir.*

#### Rated Air Flow Rate

The calculation is identical to that done for *Coil:Cooling:Water*.

#### Rated Water Flow Rate

The calculation is identical to that done for *Coil:Cooling:Water* , which is the coil design load divided by the *Loop Design Temperature Difference* user input from *Sizing:Plant.* For sizing the plant loop serving this coil, only one half of this flow rate is used since both the cooling and heating coil will save a flow rate but only one of these coils will operate at a time.

#### Rated Total Heating Capacity

The rated total heating capacity is set equal to the rated total cooling capacity.

### Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit Sizing

For the heating coil of VS WSHP, we specify a nominal speed level. During the sizing calculation, the Rated Air Volume Flow Rate and the Rated Water Volume Flow Rate are determined in the same way as the *Coil:Heating:WaterToAirHeatPump:EquationFit* object. On the other hand, the Rated Heating Capacity at the Selected Nominal Speed Level should be the same as the total cooling capacity of its corresponding cooling coil, which has to be sized first. The default nominal speed level will be the highest speed. However, the model allows the user to select a nominal speed level rather than the highest.

#### Rated Air Flow Rate

The calculation is identical to that done for Coil:Cooling:WaterToAirHeatPump:EquationFit.

#### Rated Water Flow Rate

The calculation is identical to that done for Coil:Cooling:WaterToAirHeatPump:EquationFit, which is the coil design load divided by the *Loop Design Temperature Difference* user input from *Sizing:Plant.* For sizing the plant loop serving this coil, only one half of this flow rate is used since both the cooling and heating coil will save a flow rate but only one of these coils will operate at a time.

#### Rated Total Heating Capacity

The rated total heating capacity is set equal to the rated total cooling capacity.

### Coil:Heating:Water Sizing

The sizing is done in subroutine *SizeWaterCoil*.

#### Max Water Flow Rate of Coil

##### System Coils

With the coil load from the system design data array and the user specified (in a Sizing:Plant object) design hot water temperature fall, calculate the max water flow rate:

<div>$$\dot Vcoil,water,max = HeatCapsys/(Cp,water\cdot \rho water\cdot \Delta Tplt,hw,des)$$</div>

##### Zone Coils

Using the zone design coil inlet and supply air conditions calculate the design coil load.

If the coil is not part of an induction unit then obtain the coil inlet temperature from the zone design data array;

*T<sub>in,air</sub>= DesHeatCoilInTemp<sub>zone</sub>*

If the coil is part of an induction unit take into account the induced air:

*Frac<sub>minflow</sub>*=*MinFlowFrac<sub>zone</sub>*

*T<sub>in,air</sub>*= *DesHeatCoilInTemp<sub>zone</sub>*· *Frac<sub>minflow</sub>* +

*ZoneTempAtHeatPeak<sub>­zone</sub>*·(1- *Frac<sub>minflow</sub>*)

*T<sub>out,air</sub>=HeatDesTemp<sub>zone</sub>*

W*<sub>out,air</sub>= HeatDesHumRat<sub>zone</sub>*

If the coil is part of a terminal unit the mass flow rate is determined by the volumetric flow rate of the terminal unit:

<div>$$\dot mair,des = \rho air\cdot \dot mair,des,tu$$</div>

Otherwise the design flow is obtained from the zone design data array:

<div>$$\dot mair,des = DesHeatMassFlowzone$$</div>

<div>$$Qcoil,des = cp,air\dot mair,des\cdot (Tout,air - Tin,air)$$</div>

Here *c<sub>p,air</sub>* is calculated at the outlet humidity and the average of the inlet and outlet temperatures.

With the coil load and the user specified (in a Sizing:Plant object) design hot water temperature decrease, calculate the max water flow rate:

<div>$$\dot Vcoil,water,max = Qcoil,des/(Cp,water\cdot \rho water\cdot \Delta Tplt,hw,des)$$</div>

#### UA of the Coil

To obtain the UA of the coil, we specify the model inputs (other than the UA) at design conditions and the design coil load that the coil must meet. Then we numerically invert the coil model to solve for the UA that will enable the coil to meet the design coil load given the specified inputs.

##### System Coils

The design coil load is the system design sensible cooling capacity;

*Q<sub>coil,des</sub>*= *HeatCap<sub>sys</sub>*

The required inputs for the simple coil model are:

*T<sub>in,air</sub>*= *HeatMixTemp<sub>sys</sub>*

*W<sub>in,air</sub>*= *HeatMixHumRat<sub>sys</sub>*

*T<sub>in,water</sub>*= *ExitTemp<sub>plt,hw,des</sub>*

<div>$$\dot min,water = \rho water\cdot \dot Vcoil,water,max$$</div>

Depending on the duct type, get the coil design air flow rate.

For duct type = *main, other* or default

*<span>$\dot min,air = \rho air\cdot DesMainVolFlowsys$</span>*

for duct type=*cooling*

*<span>$\dot min,air = \rho air\cdot DesCoolVolFlowsys$</span>*

for duct type=*heating*

<div>$$\dot min,air = \rho air\cdot DesHeatVolFlowsys$$</div>

We now have all the data needed to obtain UA. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function. In this case it finds the UA that will zero the residual function – the difference between the design coil load and the coil output divided by the design coil load. The residual is calculated in the function *SimpleHeatingCoilUAResidual*.

##### Zone Coils

If the coil is not part of an induction unit then obtain the coil inlet temperature from the zone design data array;

*T<sub>in,air</sub>= DesHeatCoilInTemp<sub>zone</sub>*

If the coil is part of an induction unit take into account the induced air:

*Frac<sub>minflow</sub>*=*MinFlowFrac<sub>zone</sub>*

*T<sub>in,air</sub>*= *DesHeatCoilInTemp<sub>zone</sub>*· *Frac<sub>minflow</sub>* +

*ZoneTempAtHeatPeak<sub>­zone</sub>*·(1- *Frac<sub>minflow</sub>*)

*W<sub>in,air</sub>*= *DesHeatCoilInHumRat<sub>zone</sub>*

*T<sub>in,water</sub>*= *ExitTemp<sub>plt,hw,des</sub>*

<div>$$\dot min,water = \rho water\cdot \dot Vcoil,water,max$$</div>

*T<sub>out,air</sub>=HeatDesTemp<sub>zone</sub>*

W*<sub>out,air</sub>= HeatDesHumRat<sub>zone</sub>*

If the coil is part of a terminal unit the mass flow rate is determined by the volumetric flow rate of the terminal unit:

<div>$$\dot mair,des = \rho air\cdot \dot mair,des,tu$$</div>

Otherwise the design flow is obtained from the zone design data array:

<div>$$\dot mair,des = DesHeatMassFlowzone$$</div>

<div>$$\dot Qcoil,des = cp,air\cdot \dot mair,des\cdot (Tout,air - Tin,air)$$</div>

Here *c<sub>p,air</sub>* is calculated at the outlet humidity and the average of the inlet and outlet temperatures.

We now have all the data needed to obtain UA. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function. In this case it finds the UA that will zero the residual function – the difference between the design coil load and the coil output divided by the design coil load. The residual is calculated in the function *SimpleHeatingCoilUAResidual*.

### Coil:Heating:Steam Sizing

The sizing is done in subroutine *SizeSteamCoil*.

#### Maximum Steam Flow Rate

##### System Coils

The maximum steam volumetric flow rate is calculated using:

<div>$${\dot V_{coil,steam,max}}\,\,\, = \,\,\,\,\,\frac{{Loa{d_{coil,des}}}}{{{\rho_{steam}}\left( {{h_{fg}} + {c_{p,w}}\cdot \Delta {T_{sc}}} \right)}}$$</div>

The steam density (<span>${\rho_{steam}}$</span>) is for saturated steam at 100°C (101325.0 Pa) and *h<sub>fg</sub>* is the latent heat of vaporization of water at 100°C (101325.0 Pa). *C<sub>p,w</sub>* is the heat capacity of saturated water (condensate) at 100°C (101325.0 Pa)  and <span>$\Delta {T_{sc}}$</span> is the Degree of  Subcooling defined in the Coil:Heating:Steam object input. The design coil load *Load<sub>coil,des</sub>* is calculated from:

<div>$$Loa{d_{coil,des}} = {\dot m_{air,des}}({c_{p,air}})({T_{air,coil,des,out}} - {T_{air,coil,des,in}})$$</div>

The design air mass flow rate depends on the location of the coil (duct type). For duct type =  *main,* the flow rate is set to *r<sub>air</sub>*·*DesMainVolFlow<sub>sys</sub>*·*MinSysAirFlowRatio*. If the coil is in a cooling duct the flow rate is set to *r<sub>air</sub>*·*DesCoolVolFlow<sub>sys</sub>*·*MinSysAirFlowRatio*. If the coil is in a heating duct the flow rate is set to *r<sub>air</sub>*·*DesHeatVolFlow<sub>sys</sub>*. If the coil is in any other kind of duct, the flow rate is set to *r<sub>air</sub>*·*DesMainVolFlow<sub>sys</sub>*.

For sizing, the design outlet air temperature (*T<sub>air,coil,des,out</sub>*) is the Central Heating Design Supply Air Temperature specified in the Sizing:System object.

The design inlet air temperature depends on whether the coil is being sized for 100% outdoor air or minimum outdoor air flow (per 100% Outdoor Air in Heating input field in the Sizing:System object).

1)    Sizing based on 100% Outdoor Air in Heating

*T<sub>air,coil,des,in</sub>* = *HeatOutTemp<sub>sys</sub>* (the outdoor air temperature at the design heating peak)

2)    Sizing based on minimum outdoor air flow. The outdoor air fraction is calculated as *Frac*<sub>oa</sub> = *DesOutAirVolFlow<sub>sys</sub>* / *DesVolFlow*. *DesVolFlow* is <span>${{{{\mathop m\limits^ \bullet  }_{air,des}}} \mathord{\left/ {\vphantom {{{{\mathop m\limits^ \bullet  }_{air,des}}} {{\rho_{air}}}}} \right. } {{\rho_{air}}}}$</span>*.*

*T<sub>air,coil,des,in</sub>* =*Frac*<sub>oa</sub>*· HeatOutTemp<sub>sys</sub>* + (1.- *Frac<sub>oa</sub>*)·*HeatRetTemp<sub>sys</sub>* (see Table 41.  System Sizing Data)

##### Zone Coils

If the coil is part of an *AirTerminal:SingleDuct:\** unit (e.g., *AirTerminal:SingleDuct:ConstantVolume:Reheat, AirTerminal:SingleDuct:VAV:Reheat, AirTerminal:SingleDuct:SeriesPIU:Reheat, etc.)*, the maximum steam flow rate is set equal to the terminal unit’s maximum steam flow rate. Otherwise (e.g., the zone-level coil is part of *ZoneHVAC:PackagedTerminalAirConditioner, ZoneHVAC:UnitVentilator, ZoneHVAC:UnitHeater or ZoneHVAC:VentilatedSlab*) the calculation is similar to that at the system level. A design load is calculated:

<div>$$Loa{d_{coil,des}} = {\dot m_{air,des}}({c_{p,air}})({T_{air,coil,des,out}} - {T_{air,coil,des,in}})$$</div>

where:

<span>${\dot m_{air,des}}$</span>= *DesHeatMassFlow<sub>zone</sub>* (see Table 40.  Zone Sizing Data)

*T<sub>air,coil,des,in</sub>* = *DesHeatCoilInTemp<sub>zone</sub>* (see Table 40)

*T<sub>air,coil,des,out</sub>* =*HeatDesTemp<sub>zone</sub>* (user input from Sizing:Zone object)

<span>${c_{p,air}}$</span> = Specific heat of air (evaluated at the average of inlet and outlet air temperatures, and at the zone heating design supply air humidity ratio *HeatDesHumRat<sub>zone</sub>* [user input from Sizing:Zone object])

<div>$${\dot V_{coil,steam,max}}\,\,\, = \,\,\,\,\,\frac{{Loa{d_{coil,des}}}}{{{\rho_{steam}}\left( {{h_{fg}} + {c_{p,w}}\cdot \Delta {T_{sc}}} \right)}}$$</div>

The terms in the denominator of this equation (*ρ<sub>steam</sub>*, *h<sub>fg</sub>*, etc.) are evaluated in the same way as described above for steam System Coils.

### Sizing of Gas and Electric Heating Coils

The sizing calculation is done in subroutine *SizeHeatingCoil* in module *HeatingCoils*.

#### Nominal Capacity of the Coil

##### System Coils

The value is obtained from the system design array.

*Cap<sub>nom</sub>*= *HeatCap<sub>sys</sub>*

##### Zone Coils

The capacity is calculated from the design coil inlet and outlet conditions.

If the coil is not part of an induction unit then obtain the coil inlet temperature from the zone design data array;

*T<sub>in,air</sub>= DesHeatCoilInTemp<sub>zone</sub>*

If the coil is part of an induction unit take into account the induced air:

*Frac<sub>minflow</sub>*=*MinFlowFrac<sub>zone</sub>*

*T<sub>in,air</sub>*= *DesHeatCoilInTemp<sub>zone</sub>*· *Frac<sub>minflow</sub>* +

*ZoneTempAtHeatPeak<sub>­zone</sub>*·(1- *Frac<sub>minflow</sub>*)

*T<sub>out,air</sub>=HeatDesTemp<sub>zone</sub>*

W*<sub>out,air</sub>= HeatDesHumRat<sub>zone</sub>*

*Q<sub>coil,des</sub>*=*C<sub>p,air</sub>*· *DesHeatMassFlow<sub>zone</sub>*·(*T<sub>out,air</sub>*-*T<sub>in,air</sub>*)

Here *c<sub>p,air</sub>* is calculated at the outlet humidity and the average of the inlet and outlet temperatures.

### DX Coil Sizing

The sizing calculations are done in subroutine *SizeDXCoil* in module *DXCoils*. This section covers the sizing of the objects

1.    Coil:Cooling:DX:SingleSpeed

2.    Coil:Heating:DX:SingleSpeed

3.    Coil:Cooling:DX:TwoSpeed

#### Rated Air Volume Flow Rate

#### System Coils

The rated air flow rate is obtained from the system design array.

<div>$$\dot Vair,rated = DesMainVolFlowsys$$</div>

#### Zone Coils

The rated air flow rate is the maximum of the heating and cooling design flow rates from the zone design array.

<div>$$\dot Vair,rated = Max(DesCoolVolFlowzone,DesHeatVolFlowzone)$$</div>

#### Rated Total Cooling Capacity

#### System Coils

The rated cooling capacity is obtained by dividing the peak cooling capacity by the *Cooling Capacity Modifier Curve* evaluated at peak mixed wetbulb and outdoor drybulb temperatures.

*T<sub>mix</sub>*= *CoolMixTemp<sub>sys</sub>*

*W<sub>mix</sub>*=*CoolMixHumRat<sub>sys</sub>*

*T<sub>sup</sub>*=*CoolSupTemp<sub>sys</sub>*

*W<sub>sup</sub>*=*CoolSupHumRat<sub>sys</sub>*

*T<sub>outside</sub>*=*CoolOutTemp<sub>sys</sub>*

*r<sub>air</sub>*=*PsyRhoAirFnPbTdbW*(*p<sub>air,std</sub>*, *T<sub>mix</sub>*,*W<sub>mix</sub>*)

*h<sub>mix</sub>*= *PsyHFnTdbW*(*T<sub>mix</sub>*,*W<sub>mix</sub>*)

*h<sub>sup</sub>*= *PsyHFnTdbW*(*T<sub>sup</sub>*,*W<sub>sup</sub>*)

*T<sub>mix,wb</sub>*= *PsyTwbFnTdbWPb*(*T<sub>mix</sub>*,*W<sub>mix</sub>*, *p<sub>air,std</sub>*)

*CapModFac*=*CurveValue*(CCapFTemp,*T<sub>mix,wb</sub>*,*T<sub>outside</sub>*)

<div>$$CCappeak = \rho air\cdot \dot Vair,rated\cdot (hmix - hsup)$$</div>

*CCap<sub>rated</sub>*=*CCap<sub>peak</sub>*/ *CapModFac*

We check that the design volume flow per total capacity is within the prescribed range:

<div>$$FlowCapRatio = \dot Vair,rated/CCaprated$$</div>

If *FlowCapRatio* &lt; *FlowCapRatio<sub>min</sub>*  then

<div>$$CCaprated = \dot Vair,rated/FlowCapRatiomin$$</div>

If *FlowCapRatio* &gt; *FlowCapRatio<sub>max</sub>*  then

<div>$$CCaprated = \dot Vair,rated/FlowCapRatiomax$$</div>

where

*FlowCapRatio<sub>min</sub>* = 0.00004027 m<sup>3</sup>/s per watt (300 cfm/ton)

And

*FlowCapRatio<sub>max</sub>*= 0.00006041 m<sup>3</sup>/s per watt (450 cfm/ton)

The sizing calculation for DX cooling coils for 100% dedicated outdor air system (DOAS) are identical to regular DX cooling coils.  However, they operate operate at different flow to capacity ratio ranges and are within the prescribed range below:

*FlowCapRatio<sub>min</sub>* = 0.00001677 m<sup>3</sup>/s per Watt (125 cfm/ton)

And

*FlowCapRatio<sub>max</sub>*= 0.00003355 m<sup>3</sup>/s per Watt (250 cfm/ton)



#### Zone Coils

The rated cooling capacity for zone coils is calculated in the same manner as for system coils.

*T<sub>mix</sub>*= *DesCoolCoilInTemp<sub>zone</sub>*

*W<sub>mix</sub>*= *DesCoolCoilInHumRat<sub>zone</sub>*

*T<sub>sup</sub>*= *CoolDesTemp<sub>zone</sub>*

*W<sub>sup</sub>*= *CoolDesHumRat<sub>zone</sub>*

*T<sub>outside</sub>*=*T<sub>outside</sub>,<sub>desday,peak</sub>*

*r<sub>air</sub>*=*PsyRhoAirFnPbTdbW*(*p<sub>air,std</sub>*, *T<sub>mix</sub>*,*W<sub>mix</sub>*)

*h<sub>mix</sub>*= *PsyHFnTdbW*(*T<sub>mix</sub>*,*W<sub>mix</sub>*)

*h<sub>sup</sub>*= *PsyHFnTdbW*(*T<sub>sup</sub>*,*W<sub>sup</sub>*)

*T<sub>mix,wb</sub>*= *PsyTwbFnTdbWPb*(*T<sub>mix</sub>*,*W<sub>mix</sub>*, *p<sub>air,std</sub>*)

*CapModFac*=*CurveValue*(CCapFTemp,*T<sub>mix,wb</sub>*,*T<sub>outside</sub>*)

<div>$$CCappeak = \rho air\cdot \dot Vair,rated\cdot (hmix - hsup)$$</div>

*CCap<sub>rated</sub>*=*CCap<sub>peak</sub>*/ *CapModFac*

We check that the design volume flow per total capacity is within the prescribed range:

<div>$$FlowCapRatio = \dot Vair,rated/CCaprated$$</div>

If *FlowCapRatio* &lt; *FlowCapRatio<sub>min</sub>*  then

<div>$$CCaprated = \dot Vair,rated/FlowCapRatiomin$$</div>

If *FlowCapRatio* &gt; *FlowCapRatio<sub>max</sub>*  then

<div>$$CCaprated = \dot Vair,rated/FlowCapRatiomax$$</div>

where

*FlowCapRatio<sub>min</sub>* = 0.00004027 m<sup>3</sup>/s per watt (300 cfm/ton)

And

*FlowCapRatio<sub>max</sub>*= 0.00006041 m<sup>3</sup>/s per watt (450 cfm/ton)

We check the design flow to the total cooling capacity rato for dedicated zone outdoor unit DX cooling coils to be within the limits prescribed below:

*FlowCapRatio<sub>min</sub>* = 0.00001677 m<sup>3</sup>/s per Watt (125 cfm/ton)

And

*FlowCapRatio<sub>max</sub>*= 0.00003355 m<sup>3</sup>/s per Watt (250 cfm/ton)

#### Rated Total Heating Capacity

For Coil:Heating:DX:SingleSpeed the rated heating capacity is set equal to the cooling capacity.

#### Rated SHR

The rated sensible heat ratio is calculated to be the sensible cooling (from rated inlet conditions to user specified supply conditions) divided by the total cooling (from rated inlet to specified supply).

*T<sub>in,rated</sub>*= 26.6667 <sup>o</sup>C (80 <sup>o</sup>F)

*W<sub>in,rated</sub>*= 0.01125 (corresponds to 80 <sup>o</sup>F drybulb, 67 <sup>o</sup>F wetbulb)

*C<sub>p,air</sub>*= *PsyCpAirFnWTdb*(*W<sub>in,rated</sub>*, *T<sub>in,rated</sub>*)

For system coils

*T<sub>sup</sub>*=*CoolSupTemp<sub>sys</sub>*

*W<sub>sup</sub>*=*CoolSupHumRat<sub>sys</sub>*

For zone coils

*T<sub>sup</sub>*= *CoolDesTemp<sub>zone</sub>*

*W<sub>sup</sub>*= *CoolDesHumRat<sub>zone</sub>*

Then

*h<sub>rated</sub>*= *PsyHFnTdbW*(*T<sub>in,rated</sub>*, *W<sub>in,rated</sub>*)

*h<sub>sup</sub>*= *PsyHFnTdbW*(*T<sub>sup</sub>*, *W<sub>sup</sub>*)

*Dh*<sub>rated,sup</sub>=*h<sub>rated</sub>*-*h<sub>sup</sub>*

*DQs<sub>rated,sup</sub>*=*C<sub>p,air</sub>*·(*T<sub>in,rated</sub>*-*T<sub>sup</sub>*)

*SHR<sub>rated</sub>*=*DQs<sub>rated,sup</sub>*/*Dh*<sub>rated,sup</sub>

#### Evaporative Condenser Air Volume Flow Rate

The evaporative condenser air volume flow rate (m<sup>3</sup>/s) is set to 0.000114 m<sup>3</sup>/s per watt (850 cfm/ton) times the total rated cooling capacity.

#### Evaporative Condenser Air Volume Flow Rate, Low Speed

The evaporative condenser air volume flow rate, low speed (m<sup>3</sup>/s) is set to 1/3 times 0.000114 m<sup>3</sup>/s per watt (850 cfm/ton) times the total rated cooling capacity.

#### Evaporative Condenser Pump Rated Power Consumption

The evaporative condenser pump rated power consumption is set equal to the total cooling capacity times 0.004266 watts pump power per watt capacity (15 W/ton).

#### Evaporative Condenser Pump Rated Power Consumption, Low Speed

The evaporative condenser pump rated power consumption, low speed, is set equal to 1/3 times the total cooling capacity times 0.004266 watts pump power per watt capacity (15 W/ton).

#### Rated Air Volume Flow Rate, low speed

The rated air volume flow rate, low speed, is set equal to 1/3 times the full rated air volume flow rate.

#### Rated Total Cooling Capacity, Low Speed

The rated total cooling capacity, low speed, is set equal to 1/3 times the full rated total cooling capacity.

#### Rated SHR, low speed

The rated sensible heat ratio, low speed, is set equal to the full speed SHR.

#### Resistive Defrost Heater Capacity

For the heat pump the resistive defrost heat capacity is set equal to the cooling capacity.

### DX MultiSpeed Coil Sizing

The sizing calculations are done in subroutine *SizeDXCoil* in module *DXCoils*. This section covers the sizing of the objects

* Coil:Heating:DX:MultiSpeed

* Coil:Cooling:DX: MultiSpeed

The rated air volume flow rate, rated total cooling capacity, rated heating capacity, rated SHR, evaporative condenser air volume flow rate, evaporative condenser pump rated power consumption at the highest speed are sized in the same ways as DX Coil Sizing.

After the sizes are determined at the highest speed, the sizes in the rest of speeds are assumed to

<div>$$Valu{e_n} = \frac{n}{{NumberOfSpeed}}*Valu{e_{NumberOfSpeed}}$$</div>

where

Value<sub>n</sub>         = Any autosizable variable at Speed n, except SHR

SHR<sub>n</sub> = SHR<sub>NumberOfSpeed</sub>

n    = Speed Index number from 1 to NumberOfSpeed-1

NumberOfSpeed     = The highest speed number

### Coil:Cooling:DX:VariableSpeed Sizing

For the variable-speed DX cooling coil, we specify a nominal speed level. During the sizing calculation, the Rated Total Cooling Capacity at the Selected Nominal Speed Level is determined in the same way as the Coil:Cooling:DX:SingleSpeed object. If the user chooses to autosize the Rated Air Volume Flow Rate, the flow rate, as compared to the Rated Total Cooling Capacity, is sized to have the same ratio as the air volume flow rate to the total cooling capacity at the nominal speed, of the Reference Unit. The sensible heat transfer rate is not allowed for auto-sizing, instead, it is a function of the rated air flow, rated total cooling capacity and the Reference Unit SHR at the nominal speed level. The default nominal speed level is the highest speed. However, the model allows the user to select a nominal speed level rather than the highest.

***Rated Total Cooling Capacity***

The calculation for coil operating temperatures (inlet and outlet) are identical to that done for Coil:Cooling:DX:SingleSpeed. The calculations for air enthalpy are similar to that done for Coil:Cooling:DX:SingleSpeed*.* The difference is in calculating the total cooling capacity temperature modifier function at the selected nominal speed level, as below:

<div>$$TotCapTempModFra{c_{NominalSpeed}} = {\rm{a}} + {\rm{b*}}W{B_i} + c*WB_i^2 + {\rm{d*}}D{B_o} + e*D{B_o}{T^2} + f*W{B_i}*D{B_o}$$</div>

where

WB<sub>i</sub> =wet-bulb temperature of the air entering thecooling coil, °C

DB<sub>o</sub> =condenser entering air temperature, °C

a-f = regression curve-fit coefficients.

If the entering air enthalpy is less than the exiting air enthalpy, a reference value of 48,000 J/kg is used as the entering air enthalpy. If the *TotCapTempModFac* calculation above yields 0 as the result, a value of 1 is used in the following calculation. If the rated air mass flow rate is determined to be less than a very small flow value (0.001 kg/s) or the capacity calculated here is less than 0, the coil total cooling capacity is set equal to 0.

*If H<sub>in</sub> &gt; H<sub>out</sub> Then*

<div>$${\dot Q_{coil,rated,total}} = {m_{air,rated}}({H_{in}} - {H_{out}})/TotCapTempModFra{c_{NominalSpeed}}$$</div>

*Else*

<div>$${\dot Q_{coil,rated,total}} = {m_{air,rated}}(48000 - {H_{out}})/TotCapTempModFra{c_{NominalSpeed}}$$</div>

*End If*

The other sizing procedures, e.g. evaporative condenser pump, etc., are the same as Coil:Cooling:DX:SingleSpeed.

### Coil:Heating:DX:VariableSpeed Sizing

For the variable-speed DX heating coil, we specify a nominal speed level. During the sizing calculation, the Rated Heating Capacity at the Selected Nominal Speed Level should be the same as the total cooling capacity of its corresponding cooling coil, which has to be sized first. The default nominal speed level will be the highest speed. However, the model allows the user to select a nominal speed level rather than the highest. If the user chooses to autosize the Rated Air Volume Flow Rate, the flow rate, as compared to the Rated Heating Capacity, is sized to have the same ratio as the air volume flow rate to the heating capacity at the nominal speed, of the Reference Unit. The other sizing procedures are the same as Coil:Heating:DX:SingleSpeed.

### Pump Sizing

The loop pumps’ autosizable inputs are nominal volumetric flow rate and nominal power consumption. We have

*Eff<sub>tot</sub>*=*Eff<sub>mot</sub>*·*Eff<sub>impeller</sub>*

The motor efficiency is an input. Since we need the total efficiency to calculate the nominal power consumption we assume an impeller efficiency of 0,78 for purposes of sizing.

#### Rated Volumetric Flow Rate

This is just set equal to the design loop demand obtained from summing the needs of the components on the demand side of the loop.

#### Rated Power Consumption

<div>$$\dot Qnom = Hnom\cdot \dot Vnom/Efftot$$</div>

*H<sub>nom</sub>*, the nominal head, is an input.

### Electric Chiller Sizing

Generally chillers will need nominal cooling capacity, evaporator flow rate and condenser flow rate. All 3 quantities can be straightforwardly obtained using the user specified loop sizing data and the loop design flow rates.

All chillers on a loop are sized to meet the full loop load. If there are multiple chillers on a loop that call for autosizing, they will all be assigned the same cooling capacity and evaporator flow rate.

#### Nominal Cooling Capacity

<div>$$\dot Qchiller,nom = Cp,w\cdot \rho w\cdot \Delta Tloop,des\cdot \dot Vloop,des$$</div>

where

*C<sub>p,w</sub>* is the specific heat of water at 5 <sup>o</sup>C;

*r<sub>w</sub>* is the density of water at standard conditions (5.05 <sup>o</sup>C);

*DT<sub>loop,des</sub>* is the chilled water loop design temperature rise;

<span>$\dot Vloop,des$</span>is the loop design volumetric flow rate.

#### Design Evaporator Volumetric Water Flow Rate

<div>$$\dot Vevap,des = \dot Vloop,des$$</div>

#### Design Condenser Volumetric Water Flow Rate

<div>$$\dot Vcond,des = \dot Qchiller,nom\cdot (1 + 1/COPchiller,nom)/(\Delta Tloop,des\cdot Cp,w\cdot \rho w)$$</div>

where

*C<sub>p,w</sub>* is the specific heat of water at design condenser inlet temperature;

*r<sub>w</sub>* is the density of water at standard conditions (5.05 <sup>o</sup>C);

*DT<sub>loop,des</sub>* is the chilled water loop design temperature rise;

*COP<sub>chiller,nom</sub>* is the chiller nominal COP.

Boiler Sizing

Generally boilers will need nominal heating capacity and rate. Both quantities can be straightforwardly obtained using the user specified loop sizing data and the loop design flow rates.

All boilers on a loop are sized to meet the full loop load. If there are multiple boilers on a loop that call for autosizing, they will all be assigned the same heating capacity and flow rate.

#### Nominal Capacity

<div>$$\dot Qboiler,nom = Cp,w\cdot \rho w\cdot \Delta Tloop,des\cdot \dot Vloop,des$$</div>

where

*C<sub>p,w</sub>* is the specific heat of water at the boiler design outlet temperature;

*r<sub>w</sub>* is the density of water at standard conditions (5.05 <sup>o</sup>C);

*DT<sub>loop,des</sub>* is the hot water loop design temperature decrease;

<span>$\dot Vloop,des$</span>is the loop design volumetric flow rate.

#### Design Evaporator Volumetric Water Flow Rate

<div>$$\dot Vdes = \dot Vloop,des$$</div>

### Plant Heat Exchanger Sizing

The sizing of plant heat exchanger component (object: HeatExchanger:FluidToFluid) involves determining design flow rates for both sides, a UA value, and a nominal capacity for reporting.  The component has a sizing factor for fine control and uses the design temperatures defined in the Sizing:Plant object.

The Loop Supply Side design flow rate, <span>${\dot V_{Sup,des}}$</span>, is set equal to the design flow rate for that loop, multiplied by the component sizing factor, <span>${f_{comp}}$</span>.

<div>$${\dot V_{Sup,des}} = {\dot V_{loop,des}}*{f_{comp}}$$</div>

The Loop Demand Side design flow rate,<span>${\dot V_{Dmd,des}}$</span> , is set equal to the Loop Supply Side design flow rate.

<div>$${\dot V_{Dmd,des}} = {\dot V_{Sup,des}}$$</div>

The design heat transfer capacity and UA for the heat exchanger are calculated using the design temperatures for the two plant loops.  The loop design temperature difference for the Loop Supply Side, <span>$\Delta {T_{SupLoop,Des}}$</span>, is used to determine a nominal capacity.

<div>$$\dot Q = {\mathop V\limits^._{Sup,des}}\rho {c_p}\Delta {T_{SupLoop,Des}}$$</div>

A loop-to-loop design temperature difference, <span>$\Delta {T_{LoopToLoop,Des}}$</span>, is determined depending on the nature of the plant loop connected to the Loop Supply Side.  The Sizing:Plant object includes  classifications for the type of loop that include Heating, Steam, Cooling, or Condenser. For Cooling and Condenser loop types, the loop design temperature difference is added to the design exit temperature for the Loop Supply Side, <span>${T_{SupLoop,Exit}}$</span>.  For Heating and Stem loop types, the loop design temperature difference is subtracted from the design exit temperature.  This adjusted supply side temperature is then compared to the design exit temperature for the Loop Demand Side,<span>${T_{DmdLoop,Exit}}$</span> .

<span>$\Delta {T_{LoopToLoop,Des}} = \left( {{T_{SupLoop,Exit}} + \Delta {T_{SupLoop,Des}}} \right) - {T_{DmdLoop,Exit}}$</span>    (Cooling, Condenser)

<span>$\Delta {T_{LoopToLoop,Des}} = \left( {{T_{SupLoop,Exit}} - \Delta {T_{SupLoop,Des}}} \right) - {T_{DmdLoop,Exit}}$</span>    (Heating, Steam)

<div>$$\Delta {T_{LoopToLoop,Des}} = MAX\left( {ABS\left( {\Delta {T_{LoopToLoop,Des}}} \right),2.0} \right)$$</div>

The UA (U-Factor Time Area Value) is determined by assuming that the target capacity can be delivered for the loop-to-loop temperature difference which after substituting and rearranging becomes:

<div>$$UA = \frac{{{{\mathop {V}\limits }_{Sup,des}}\rho {c_p}\Delta {T_{SupLoop,Des}}}}{{\Delta {T_{LoopToLoop,Des}}}}$$</div>

A nominal capacity for the heat exchanger is determined from the design flow rates and UA (regardless of if they were automatically sized or input by the user) and the expected operating temperatures of the two loops.  The loop operating temperatures are obtained from the input in Sizing:Plant object if it is present for that loop.  If no Sizing:Plant is present then the loop’s overall setpoint is used (if the loop’s load scheme is DualSetpointDeadband then the average of the high and low setpoints is used).  The full heat exchanger model is then calculated for the maximum loop flow rates and expected loop temperatures as inlets to the heat exchanger.  The absolute value for the model result for heat transfer rate is then used as the capacity of the heat exchanger.  This capacity is reported and may be used for controls based on operation scheme.

### Humidifier Sizing

The rated power, or nominal electric power input of an Electric Steam Humidifier (Humidifier:Steam:Electric) is calculated from user specified rated capacity (m<sup>3</sup>/s) and the enthalpy change of the water from a reference temperature (20.0°C) to saturated steam at 100.0°C. Autosizing procedure assumes that electrical heating element in the humidifier heat the water from the reference temperature and generate saturated steam at 100°C, and electric to thermal energy conversion efficiency of 100.0%.

#### Rated Power

<div>$${P_{rated}} = {\dot V_{rated}} \cdot {\rho_w} \cdot \left( {{h_{fg}} + {C_{p,w}} \cdot \Delta {T_w}} \right)$$</div>

where

*C<sub>p,w</sub> is the specific heat of water at average temperature ((100+20)/2 = 60.0* *°C), (J/kgK);*

*r<sub>w</sub> is the density of water at standard conditions (5.05* *°C);*

*DT<sub>w</sub>  is the sensible temperature rise of water (100.0 – 20.0=80.0* *°C);*

*<span>${\dot V_{rated}}$</span> is the rated capacity of the humidifier in volumetric flow rate.*

*h<sub>fg</sub> is the latent heat of vaporization of water at 100.0°C, (J/kg);*

#### Gas Fired Humidifier Sizing

The rated power, or nominal gas use rate of a gas steam humidifier (Humidifier:Steam:Gas) is calculated from user specified rated volumetric capacity (m3/s) and the enthalpy change of the water from a reference temperature of 20.0°C to a saturated steam at 100.0°C. Autosizing procedure assumes that gas heater in the humidifier convert the water from the reference temperature and generate saturated steam at 100°C, using gas to thermal energy conversion rated thermal efficiency. 

Rated Gas Use Rate

The rated or nominal gas use rate is given by:

<div>$$Q_{NG,nom} = \frac{\dot{V}_{cap,nom}\rho_w\left(h_{fg}+c_{p,w}\Delta T_w\right)}{\eta_{rated}}$$</div>

Where, 

- Cp,w: specific heat of water at average temperature ((100+20)/2 = 60.0 °C), (J/kgK);

- rho_w: density of water at standard condition (5.05 °C);

- DeltaTw: sensible temperature rise of water (100.0 – 20.0=80.0 °C);

- V_cap_nom: rated or nominal capacity of the humidifier, (m3/s)

- h_fg: latent heat of vaporization of water at 100.0°C, (J/kg);

- eta_rated: thermal efficiency at rated condition;


#### Rated Capacity

<div>$${\dot m_w} = {\dot m_a}\left( {{\omega_o} - {\omega_i}} \right)$$</div>

where

<span>${\dot m_w}$</span>* iswater mass flow rate, kg/s;*

<span>${\dot m_a}$</span>* is design air mass flow rate, kg/s;*

*ω<sub>o</sub> is design outlet humidity ratio, kg-water/kg-air; *

*ω<sub>i</sub> is design inlet humidity ratio, kg-water/kg-air.*



The air mass flow rate and humidity ratios are determined based upon zone design conditions. If the unit is part of zone equipment, then:



<div>$${\dot m_a} = Max\left( {DesCoolVolFlo{w_{zone}},DesHeatVolFlo{w_{zone}}} \right) \cdot {\rho_a}$$</div>

<div>$${\omega_i} = Min\left( {OutHumRatAtCoolPea{k_{zone}},OutHumRatAtHeatPea{k_{zone}}} \right)$$</div>

      <span>${\omega_o} = Max\left( {ZoneHumRatAtCoolPea{k_{zone}},ZoneHumRatAtHeatPea{k_{zone}}} \right)$</span>



where

*r<sub>a</sub> is the density of air at design conditions, kg/s.*

* *

If the unit is part of the central air system, then check if outdoor air system is present. If outdoor air system is part of the air loop and design outdoor air flow rate is greater than zero, then:

<div>$${\dot m_a} = DesOutAirVolFlo{w_{sys}} \cdot {\rho_a}$$</div>

<div>$${\omega_i} = Min\left( {CoolOutHumRa{t_{sys}},HeatOutHumRa{t_{sys}}} \right)$$</div>

      <span>${\omega_o} = Max\left( {CoolSupHumRa{t_{sys}},HeatSupHumRa{t_{sys}}} \right)$</span>

Otherwise, air mass flow rate is determined as follows:

for duct type = *main*

<div>$${\dot m_a} = DesMainAirVolFlo{w_{sys}} \cdot {\rho_a}$$</div>

for duct type = *cooling*

<div>$${\dot m_a} = DesCoolVolFlo{w_{sys}} \cdot {\rho_a}$$</div>

for duct type = *heating*

<div>$${\dot m_a} = DesHeatVolFlo{w_{sys}} \cdot {\rho_a}$$</div>

for duct type = *other*

<span>${\dot m_a} = DesMainVolFlo{w_{sys}} \cdot {\rho_a}$</span>,

and the humidity ratios are:

<div>$${\omega_i} = Min\left( {CoolMixHumRa{t_{sys}},HeatMixHumRa{t_{sys}}} \right)$$</div>

      <span>${\omega_o} = Max\left( {CoolSupHumRa{t_{sys}},HeatSupHumRa{t_{sys}}} \right)$</span>

### Cooling Tower Sizing

The quantities needed to autosize a cooling tower include the design water flow rate, the nominal fan power and air flow rate, and the tower UA. This data may be need to be given at more than one operating point:, for instance – high speed fan, low speed fan and free convection.

EnergyPlus provides two input choices: the user can input the design water flow rate and tower UA at each operating point or the tower nominal capacity (and let the program calculate the water flow rate and UA). Choice of input method will affect the sizing calculations in ways noted below.

#### Design Water Flow Rate

If *Tower Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* then

<div>$$\dot Vtower,w,des = \dot Vloop,des$$</div>

If *Tower Performance Input Method* = *NominalCapacity* then

<div>$$\dot Vtower,w,des = 5.382E - 8\cdot \dot Qtower,nom$$</div>

where 5.382·10<sup>-08</sup> is m<sup>3</sup>/s per watt corresponds to the rule-of-thumb of sizing the tower flow rate at 3 gallons per minute per ton. For the CoolingTower:VariableSpeed:Merkel model with NominalCapacity input method, the user can input the value used to scale design water flow rate from nominal capacity and the default is 5.382·10<sup>-08</sup> m<sup>3</sup>/s/W.

#### Fan Power at Design Air Flow Rate

The nominal fan power is sized to be 0.0105 times the design load.

If *Tower Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* then

<div>$$\dot Qtower,nom = Cp,w\cdot \rho w\cdot \dot Vtower,w,des\cdot \Delta Tloop,des$$</div>

where

*C<sub>p,w</sub>* is the specific heat of water at the condenser loop design exit temperature;

*r<sub>w</sub>* is the density of water at standard conditions (5.05 <sup>o</sup>C);

*DT<sub>loop,des</sub>* is the condenser water loop design temperature rise;

Finally

<div>$$\dot Qfan,nom = 0.0105\cdot \dot Qtower,nom$$</div>

For the CoolingTower:VariableSpeed:Merkel model, the design fan power is determined using a scaling factor, in units of Watts per Watt, that can be input by the user.  The default value is 0.0105 which is the same as above.

#### Design Air Flow Rate

We assume a fan efficiency of 0.5 and a fan pressure rise of 190 Pascals. Then

<div>$$\dot Vtower,air,des = \dot Qfan,nom\cdot 0.5\cdot \rho air/190$$</div>

where

r<sub>air</sub> is the density of air at standard conditions.

For the CoolingTower:VariableSpeed:Merkel model, the design air flow rate is determined from the nominal capacity using a scaling factor, <span>${f_{airflow/W}}$</span>,in units of m<sup>3</sup>/s/W.  The default value is 2.76316\*10<sup>-5</sup>.  When the input field is left blank, the default is used as follows

<div>$${\dot V_{tower,air,des}} = {\dot Q_{tower,nom}} \bullet {f_{airflow/W}} \bullet \frac{{101325}}{{{P_{std,altitude}}}}$$</div>

where, <span>${P_{std,altitude}}$</span> is the standard barometric pressure for the location’s elevation.

When the input field is filled with a hard value, the pressure scaling is not used

<div>$${\dot V_{tower,air,des}} = {\dot Q_{tower,nom}} \bullet {f_{airflow/W}}$$</div>

#### Tower UA Value at Design Air Flow Rate

To obtain the UA of the tower, we specify the model inputs (other than the UA) at design conditions and the design tower load that the tower must meet. Then we numerically invert the tower model to solve for the UA that will enable the tower to meet the design tower load given the specified inputs.

The design tower load is:

for *Tower Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate*

<div>$$\dot Qtower,des = Cp,w\cdot \rho w\cdot \dot Vtower,w,des\cdot \Delta Tloop,des$$</div>

for *Tower Performance Input Method* = *NominalCapacity*

<span>$\dot Qtower,des = 1.25\cdot \dot Qtower,nom$</span>(to allow for compressor heat)

Where, <span>${f_{des,heat,ratio}}$</span> is the ratio of actual heat rejection capacity to nominal capacity.  This ratio is available as a user input with a default value of 1.25 (to allow for compressor heat).

Then we assign the inputs needed for the model.

*T<sub>in,air</sub>*=35 <sup>o</sup>C (95 <sup>o</sup>F design air inlet temperature)

*T<sub>in,air,wb</sub>*=25.6 <sup>o</sup>C (78 <sup>o</sup>F design air inlet wetbulb temperature)

*W<sub>in</sub>* is calculated from the entering air drybulb and wetbulb.

The  inlet water mass flow rate is just the design volumetric flow rate times the density of water.

The inlet water temperature is set slightly differently for the 2 input methods. For

*UFactorTimesAreaAndDesignWaterFlowRate*

*T<sub>in,water</sub>*=*T<sub>loop,exit,des</sub>*+*DT<sub>loop,des</sub>*

*NominalCapacity*

*T<sub>in,water</sub>*=35 <sup>o</sup>C (95 <sup>o</sup>F design inlet water temperature).

We now have all the data needed to obtain UA. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function. In this case it finds the UA that will zero the residual function – the difference between the design tower load and the tower output divided by the design tower load. The residual is calculated in the function *SimpleTowerUAResidual.*

#### Air Flow Rate at Low Fan Speed

The nominal air flow rate at low fan speed is set to a fraction of the full speed air flow rate. The fraction is available for user input in the field called Low Fan Speed Air Flow Rate Sizing Factor. The default is 0.5.

#### Fan Power at Low Fan Speed

The fan power at low fan speed is set to a fraction of the fan power at full speed.  The fraction is available for user input in the field called Low Fan Speed Fan Power Sizing Factor. The default is 0.16.

#### Tower UA Value at Low Fan Speed

For *Tower Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* the low speed UA is set to a fraction of the full speed UA.  The fraction is available for user input in the field called Low Fan Speed U-Factor Times Area Sizing Factor. The default is 0.6. For *Tower Performance Input Method* = *NominalCapacity* the low speed UA is calculated in the same manner as the full speed UA using <span>$\dot Qtower,nom,lowspeed$</span> instead of <span>$\dot Qtower,nom$</span>.

#### Air Flow Rate in Free Convection Regime

The free convection air flow rate is set to a fraction of the full air flow rate. The fraction is available for user input in the field called Free Convection Regime Air Flow Rate Sizing Factor. The default is 0.1.

#### Tower UA Value in Free Convection Regime

For *Tower Performance Input Method* = *UA and Design Water Flow Rate* the low speed UA is set to a fraction of the full speed UA. The fraction is available for user input in the field called Free Convection U-Factor Times Area Value Sizing Factor. The default is 0.1. For *Tower Performance Input Method* = *NominalCapacity* the low speed UA is calculated in the same manner as the full speed UA using <span>$\dot Qtower,nom,freeconv$</span> instead of <span>$\dot Qtower,nom$</span>.

### Fluid Cooler Sizing

The quantities needed to autosize a fluid cooler include the design water flow rate, the nominal fan power, air flow rate, and the fluid cooler UA. This data may need to be given at more than one operating point:, for instance – high speed fan and low speed fan.

EnergyPlus provides two input choices: the user can input the design water flow rate and fluid cooler UA at each operating point or the fluid cooler nominal capacity and the water flow rate (and let the program calculate UA). Choice of input method will affect the sizing calculations in ways noted below.

#### Design Water Flow Rate

The design water flow rate is sized as follows

<div>$${\dot V_{fluidcooler,w,des}} = {\dot V_{loop,des}}$$</div>

#### Fan Power at Design Air Flow Rate

The nominal fan power is sized to be 0.0105 times the design load.

If *Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* then

<div>$${\dot Q_{fluidcooler,nom}} = {C_{p,w}} \bullet {\rho_w} \bullet {\dot V_{fluidcooler,w,des}} \bullet \Delta {T_{loop,des}}$$</div>

  where

*  C<sub>p,w</sub>* is the specific heat of water at the condenser loop design exit temperature;

* * *r<sub>w</sub>* is the density of water at standard conditions (5.05 <sup>o</sup>C);

* * *DT<sub>loop,des</sub>* is the condenser water loop design temperature rise;

  Finally

<div>$${\dot Q_{fan,nom}} = 0.0105 \bullet {\dot Q_{fluidcooler,nom}}$$</div>

#### ElseifPerformance Input Method= NominalCapacitythen

      <span>${\dot Q_{fan,nom}} = 0.0105 \bullet {\dot Q_{fluidcooler,nom}}$</span>

  Where

      <span>${\dot Q_{fluidcooler,nom}}$</span> is provided by the user.

#### Design Air Flow Rate

* For Performance Input Method = UFactorTimesAreaAndDesignWaterFlowRate

  <span>${\dot Q_{fluidcooler,nom}} = {C_{p,w}} \bullet {\rho_w} \bullet {\dot V_{fluidcooler,w,des}} \bullet \Delta {T_{loop,des}}$</span>

* For Performance Input Method = NominalCapacity

  <span>${\dot Q_{fluidcooler,nom}}$</span> is provided by the user.

  <span>${\dot V_{fluidcooler,air,des}} = {\dot Q_{fluidcooler,nom}}/({T_{in,water}} - {T_{in,air}})*4$</span>

Where,

*T<sub>in,water  </sub>* = Design entering water temperature provided by the user

*T<sub>in,air       </sub>* = Design air inlet temperature provided by the user

#### Fluid cooler UA Value at Design Air Flow Rate

To obtain the UA of the fluid cooler, we specify the model inputs (other than the UA) at design conditions and the design fluid cooler load that the fluid cooler must meet. Then we numerically invert the fluid cooler model to solve for the UA that will enable the fluid cooler to meet the design fluid cooler load given the specified inputs.

The design fluid cooler load is:

* For Performance Input Method = UFactorTimesAreaAndDesignWaterFlowRate

  <span>${\dot Q_{fluidcooler,nom}} = {C_{p,w}} \bullet {\rho_w} \bullet {\dot V_{fluidcooler,w,des}} \bullet \Delta {T_{loop,des}}$</span>

* For Performance Input Method = NominalCapacity

  <span>${\dot Q_{fluidcooler,nom}}$</span> is provided by the user.

Then we assign the inputs needed for the model.

*T<sub>in,air      </sub>* = Design air inlet temperature provided by the user

*T<sub>in,air,wb</sub>* = Design air inlet wetbulb temperature provided by the user

*W<sub>in</sub>* is calculated from the entering air drybulb and wetbulb.

The  inlet water mass flow rate is just the design entering volumetric flow rate times the density of water.

The inlet water temperature is set slightly differently for the 2 input methods. For

* UFactorTimesAreaAndDesignWaterFlowRate

<div>$${T_{in,water}} = {T_{loop,exit,des}} + \Delta {T_{loop,des}}$$</div>

* NominalCapacity

<div>$${T_{in,water}} = Provided\,by\,the\,user$$</div>

We now have all the data needed to obtain UA. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function. In this case it finds the UA that will zero the residual function – the difference between the design fluid cooler load and the fluid cooler output divided by the design fluid cooler load. The residual is calculated in the function *SimpleFluidCoolerUAResidual.*

#### Air Flow Rate at Low Fan Speed

The nominal air flow rate at low fan speed is set to a fraction of the full speed air flow rate. The fraction is available for user input in the field called Low Fan Speed Air Flow Rate Sizing Factor. The default is 0.5.

#### Fan Power at Low Fan Speed

The fan power at low fan speed is set to a fraction of the fan power at full speed. The fraction is available for user input in the field called Low Fan Speed Fan Power Sizing Factor. The default is 0.16.

#### Fluid cooler UA Value at Low Fan Speed

For *Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* the low speed UA is set to a fraction of the full speed UA. .  The fraction is available for user input in the field called Low Fan Speed U-Factor Times Area Sizing Factor. The default is 0.6. For *Performance Input Method* = *NominalCapacity* the low speed UA is calculated in the same manner as the full speed UA using <span>${\dot Q_{fluidcooler,nom,lowspeed}}$</span> instead of <span>${\dot Q_{fluidcooler,nom}}$</span>.

### Evaporative Fluid cooler Sizing

The quantities needed to autosize an evaporative fluid cooler include the design water flow rate, the nominal fan power, air flow rate, and the fluid cooler UA. This data may need to be given at more than one operating point:, for instance – high speed fan and low speed fan.

EnergyPlus provides three input choices: the user can input the design water flow rate and fluid cooler UA at each operating point (*UFactorTimesAreaAndDesignWaterFlowRate*) or the fluid cooler design capacity and the water flow rate and let the program calculate UA (*UserSpecifiedDesignCapacity*) or only the fluid cooler design capacity and let the program calculate UA and the water flow rate (*StandardDesignCapacity*). Choice of input method will affect the sizing calculations in ways noted below.

#### Design Water Flow Rate

If *Performance Input Method* = *StandardDesignCapacity* then

<div>$${\dot V_{fluidcooler,w,des}} = 5.382E - 8\cdot {\dot Q_{fluidcooler,standarddesign}}$$</div>

Else

<div>$${\dot V_{fluidcooler,w,des}} = {\dot V_{loop,des}}$$</div>

where 5.382·10<sup>-08</sup> is m<sup>3</sup>/s per watt corresponds to the rule-of-thumb of sizing the fluid cooler flow rate at 3 gallons per minute per ton.

#### Fan Power at Design Air Flow Rate

The design fan power is sized to be 0.0105 times the design load.

If *Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* then

<div>$${\dot Q_{fluidcooler,design}} = {C_{p,w}} \bullet {\rho_w} \bullet {\dot V_{fluidcooler,w,des}} \bullet \Delta {T_{loop,des}}$$</div>

where

*C<sub>p,w</sub>* is the specific heat of water at the condenser loop design exit temperature;

*r<sub>w</sub>* is the density of water at standard conditions (5.05 <sup>o</sup>C);

*DT<sub>loop,des</sub>* is the condenser water loop design temperature rise;

Finally

<div>$${\dot Q_{fan,design}} = 0.0105 \bullet {\dot Q_{fluidcooler,design}}$$</div>

#### Else

<div>$${\dot Q_{fan,design}} = 0.0105 \bullet {\dot Q_{fluidcooler,design}}$$</div>

Where

<span>${\dot Q_{fluidcooler,design}}$</span>is the design capacity provided by the user for the other two performance input methods

#### Design Air Flow Rate

We assume a fan efficiency of 0.5 and a fan pressure rise of 190 Pascals. Then

<div>$${\dot V_{fluidcooler,air,des}} = {\dot Q_{fan,design}} \bullet 0.5 \bullet {\rho_{air}}/190$$</div>

where

r<sub>air</sub> is the density of air at standard conditions.

#### Fluid cooler UA Value at Design Air Flow Rate

To obtain the UA of the evaporative fluid cooler, we specify the model inputs (other than the UA) at design conditions and the design fluid cooler load that the fluid cooler must meet. Then we numerically invert the fluid cooler model to solve for the UA that will enable the fluid cooler to meet the design fluid cooler load given the specified inputs.

The design fluid cooler load is:

* For Performance Input Method = UFactorTimesAreaAndDesignWaterFlowRate

<div>$${\dot Q_{fluidcooler,design}} = {C_{p,w}} \bullet {\rho_w} \bullet {\dot V_{fluidcooler,w,des}} \bullet \Delta {T_{loop,des}}$$</div>



* For Performance Input Method = StandardDesignCapacity

<span>${\dot Q_{fluidcooler,design}} = 1.25 \bullet {\dot Q_{fluidcooler,standarddesign}}$</span> (to allow for compressor heat)

Then we assign the inputs needed for the model.

*T<sub>in,air      </sub>* = 35 <sup>o</sup>C (95 <sup>o</sup>F design air inlet temperature)

*T<sub>in,air,wb</sub>* = 25.6 <sup>o</sup>C (78 <sup>o</sup>F design air inlet wetbulb temperature)

*W<sub>in</sub>* is calculated from the entering air drybulb and wetbulb.



* For Performance Input Method = UserSpecifiedDesignCapacity

<div>$${\dot Q_{fluidcooler,design}} = {\dot Q_{fluidcooler,userspecifieddesign}}$$</div>

Where, <span>${f_{des,heat,ratio}}$</span> is the ratio of actual heat rejection capacity to nominal capacity.  This ratio is available as a user input with a default value of 1.25 (to allow for compressor heat)

Then we assign the inputs needed for the model.

*T<sub>in,air      </sub>* = Design air inlet temperature provided by the user

*T<sub>in,air,wb</sub>* = Design air inlet wetbulb temperature provided by the user

*W<sub>in</sub>* is calculated from the entering air drybulb and wetbulb.



The inlet water mass flow rate is just the design entering volumetric flow rate times the density of water.

The inlet water temperature is set slightly differently for the 3 input methods. For

* UFactorTimesAreaAndDesignWaterFlowRate

<div>$${T_{in,water}} = {T_{loop,exit,des}} + \Delta {T_{loop,des}}$$</div>

* StandardDesignCapacity

<div>$${T_{in,water}} = 35^\circ C\;(95^\circ F\,design\,inlet\,water\,temperature)$$</div>

* UserSpecifiedDesignCapacity

<div>$${T_{in,water}} = Provided\,by\,the\,user$$</div>



We now have all the data needed to obtain UA. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function. In this case it finds the UA that will zero the residual function – the difference between the design fluid cooler load and the fluid cooler output divided by the design fluid cooler load. The residual is calculated in the function *SimpleEvapFluidCoolerUAResidual.*

#### Air Flow Rate at Low Fan Speed

The design air flow rate at low fan speed is set to a fraction of the full speed air flow rate. The fraction is available for user input in the field called Low Fan Speed Air Flow Rate Sizing Factor. The default is 0.5.

#### Fan Power at Low Fan Speed

The fan power at low fan speed is set to a fraction of the fan power at full speed. The fraction is available for user input in the field called Low Fan Speed Fan Power Sizing Factor. The default is 0.16.

#### Fluid cooler UA Value at Low Fan Speed

For *Performance Input Method* = *UFactorTimesAreaAndDesignWaterFlowRate* the low speed UA is set to a fraction of the full speed UA. The fraction is available for user input in the field called Low Fan Speed U-Factor Times Area Sizing Factor. The default is 0.6. For *Performance Input Method* = *StandardDesignCapacity* (and similarly for *UserSpecifiedDesignCapacity method*) the low speed UA is calculated in the same manner as the full speed UA using <span>${\dot Q_{fluidcooler,standarddesign,lowspeed}}$</span> instead of <span>${\dot Q_{fluidcooler,standarddesign}}$</span>.

### Fan Coil Unit Sizing

Fan Coil units are compound components: each unit contains a fan, hot water coil, chilled water coil and outside air mixer. The inputs that may need to be autosized are the nominal unit air flow rate, the maximum hot and chilled water flow rates, and the design outside air flow rate. The data needed for sizing the units is obtained from the zone design arrays and the user specified plant sizing input.

#### Maximum Air Flow Rate

<div>$$\dot Vair,max = Max(DesCoolVolFlowzone,DesHeatVolFlowzone)$$</div>

#### Maximum Outside Air Flow Rate

<div>$$\dot Voutsideair,max = Min(MinOAzone,\dot Vair,max)$$</div>

#### Maximum Hot Water Flow

*T<sub>coil,in</sub>*=*DesHeatCoilInTemp<sub>zone</sub>*

*T<sub>coil,out</sub>*=*HeatDesTemp<sub>zone</sub>*

<sub><span>$\dot Qcoil,des = cp,air\cdot DesHeatMassFlowzone\cdot (Tout,coil - Tin,coil)$</span></sub>

<div>$$\dot Vmax,hw = \dot Qcoil,des/(cp,w\cdot \rho w\cdot \Delta Tloop,des)$$</div>

where

*c<sub>p,air</sub>* is evaluated at the average of the inlet & outlet temperatures and the coil outlet humidity ratio.

#### Maximum Cold Water Flow

*T<sub>coil,in</sub>*=*DesColdCoilInTemp<sub>zone</sub>*

*T<sub>coil,out</sub>*=*ColdDesTemp<sub>zone</sub>*

*W<sub>coil,in</sub>*= *DesCoolCoilInHumRat<sub>zone</sub>*

*W<sub>coil,out</sub>*= *CoolDesHumRat<sub>zone</sub>*

*H<sub>coil,in</sub>*= *PsyHFnTdbW*(*T<sub>coil,in</sub>*, *W<sub>coil,in</sub>*)

*H<sub>coil,out</sub>*= *PsyHFnTdbW*(*T<sub>coil,out</sub>*, *W<sub>coil,out</sub>*)

<sub><span>$\dot Qcoil,des = DesCoolMassFlowzone\cdot (hin,coil - hout,coil)$</span></sub>

<div>$$\dot Vmax,hw = \dot Qcoil,des/(cp,w\cdot \rho w\cdot \Delta Tloop,des)$$</div>

where

*c<sub>p,air</sub>* is evaluated at the average of the inlet & outlet temperatures and the coil outlet humidity ratio.

### Window Air Conditioner Sizing

Window air conditioners are compound components: each unit contains a fan, a DX coil and an outside air mixer. The inputs that may need to be autosized are the nominal unit air flow rate and the design outside air flow rate. The data needed for sizing the units is obtained from the zone design arrays.

#### Maximum Air Flow Rate

<div>$${\dot V_{air,max}} = DesCoolVolFlo{w_{max}}$$</div>

#### Maximum Outside Air Flow Rate

<div>$$\dot Voutsideair,max = Min(MinOAzone,\dot Vair,max)$$</div>

### Unit Ventilator Sizing

Unit ventilators are compound components: each unit contains an outdoor air mixer, a fan, a heating coil, and a cooling coil. The inputs that may need to be autosized are the maximum supply air flow rate and the maximum/minimum outside air flow rates. The data needed for sizing the units is obtained from the zone design arrays.

#### Maximum Air Flow Rate

If both the cooling and heating coil are present, then:

<div>$${\dot V_{supplyair,max}} = MAX\left( {DesCoolVolFlo{w_{zone}},DesHeatVolFlo{w_{zone}}} \right)$$</div>

If only the heating coil is present, then:

<div>$${\dot V_{supplyair,max}} = DesHeatVolFlo{w_{zone}}$$</div>

If only cooling coil is present, then:

<div>$${\dot V_{supplyair,max}} = DesCoolVolFlo{w_{zone}}$$</div>

If neither heating nor cooling coil is present, then:

<div>$${\dot V_{supplyair,max}} = MinO{A_{zone}}$$</div>

#### Maximum Outside Air Flow Rate

<div>$${\dot V_{outsideair,max}} = {\dot V_{air,max}}$$</div>

#### Minimum Outside Air Flow Rate

<div>$${\dot V_{outsideair,min}} = Min\left( {MinO{A_{zone}},{{\dot V}_{air,max}}} \right)$$</div>

### Packaged Terminal Heat Pump Sizing

Packaged terminal heat pumps are compound components: each unit contains a supply air fan, a DX cooling coil, a DX heating coil, a GAS or ELECTRIC supplemental heating coil, and an outside air mixer. The inputs that may need to be autosized are the supply air and outside air volumetric air flow rates during cooling operation, heating operation, and when no cooling or heating is needed. In addition, the maximum supply air temperature from the supplemental heater can also be automatically selected. The data needed for sizing the units are obtained from the zone design arrays.

#### Supply air volumetric flow rate during cooling operation

<div>$${\mathop V\limits^ \cdot_{SA\,\,,\,cooling}} = \,\,MAX(DesCoolVolFlowzone,\,DesHeatVolFlowzone)$$</div>

#### Supply air volumetric flow rate during heating operation

<div>$${\mathop V\limits^ \cdot_{SA\,\,,\,heating}} = \,\,MAX(DesCoolVolFlowzone,\,DesHeatVolFlowzone)$$</div>

#### Supply air volumetric flow rate when no cooling or heating is needed

<div>$${\mathop V\limits^ \cdot_{SA\,,\,no\,cool\,or\,heat}} = \,\,MAX(DesCoolVolFlowzone,\,DesHeatVolFlowzone)$$</div>

#### Outside air volumetric flow rate during cooling operation

<div>$${\mathop V\limits^ \cdot_{OA\,,\,\,cooling}} = {\rm{MIN}}(MinO{A_{zone}},{\mathop {\,V}\limits^ \cdot_{SA\,,\,\,cooling}})$$</div>

#### Outside air volumetric flow rate during heating operation

<div>$${\mathop V\limits^ \cdot_{OA\,,\,\,heating}} = {\rm{MIN}}(MinO{A_{zone}},{\mathop {\,V}\limits^ \cdot_{SA\,,\,\,heating}})$$</div>

#### Outside air volumetric flow rate when no cooling or heating is needed

<div>$${\mathop V\limits^ \cdot_{OA\,,\,no\,\,cool\,or\,heat}} = {\rm{MIN}}(MinO{A_{zone}},{\mathop {\,V}\limits^ \cdot_{SA\,,\,no\,\,cool\,or\,heat}})$$</div>

#### Maximum supply air temperature from supplemental heater

<div>$${T_{SA,\max }} = HeatDesTem{p_{zone}}$$</div>

### MultiSpeed Heat Pump Sizing

MultiSpeed heat pumps are compound components: each unit contains a supply air fan, a multispeed DX cooling coil, a multispeed DX heating coil, and a GAS or ELECTRIC supplemental heating coil. The inputs that may need to be autosized are the supply air volumetric air flow rates during cooling operation, heating operation, and when no cooling or heating is needed. The data needed for sizing the units are obtained from the controlled zone design arrays.

#### Supply air volumetric flow rate during cooling operation at the highest speed

<div>$${\mathop V\limits^ \cdot_{SA\,\,,\,cooling}} = \,\,MAX(DesCoolVolFlowzone,\,DesHeatVolFlowzone)/ZoneFraction$$</div>

#### Supply air volumetric flow rate during heating operation at the highest speed

<div>$${\mathop V\limits^ \cdot_{SA\,\,,\,heating}} = \,\,MAX(DesCoolVolFlowzone,\,DesHeatVolFlowzone)/ZoneFraction$$</div>

#### Supply air volumetric flow rate when no cooling or heating is needed

<div>$${\mathop V\limits^ \cdot_{SA\,,\,no\,cool\,or\,heat}} = \,\,MAX(DesCoolVolFlowzone,\,DesHeatVolFlowzone)/ZoneFraction$$</div>

where

ZoneFraction           = Fraction of the total volume flow that goes through the controlling zone

#### Supply air volumetric flow rate during cooling operation at Speed n (1 to NumberOfSpeed-1)

<div>$${\mathop V\limits^ \cdot_{SA\,\,,\,cooling,n}} = \frac{n}{{NumberOfSpeed}}{\mathop V\limits^ \cdot_{SA\,\,,\,cooling}}$$</div>

#### Supply air volumetric flow rate during heating operation at Speed n (1 to NumberOfSpeed-1)

<div>$${\mathop V\limits^ \cdot_{SA\,\,,\,heating,n}} = \frac{n}{{NumberOfSpeed}}{\mathop V\limits^ \cdot_{SA\,\,,\,heating}}$$</div>

where

n    = Speed Index number from 1 to NumberOfSpeed-1

NumberOfSpeed     = The highest speed number

### Single Duct Terminal Units

These are all the EnergyPlus components whose names begin with "*AirTerminal:SingleDuct:*" (except for Cooled Beam units). This includes *Uncontrolled, ConstantVolume:Reheat, VAV:NoReheat, VAV:Reheat, VAV:Reheat:VariableSpeedFan, VAV:HeatAndCool:NoReheat, VAV:HeatAndCool:Reheat, SeriesPIU:Reheat, ParallelPIU:Reheat,* and *ConstantVolume:FourPipeInduction*. The inputs that may need to be autosized are the various maximum air flow rates through the unit, minimum air flow rates, and maximum hot water and/or chilled water flow rates if heating or cooling coils are present.

*Note:* all zone design flow rates and loads referenced below may have been altered by system sizing inputs. For instance, if the user specifies a *Cooling Design Air Flow Method = Flow/System*  and specifies a *Cooling Design Air Flow Rate* the zone cooling design values will be altered to match the specified system flow rate.

#### Maximum Air Flow Rate

<div>$${\dot V_{air,\max ,{\rm{terminal}}}} = Max(DesCoolVolFlowzone,DesHeatVolFlowzone)$$</div>

#### Maximum Heating Air Flow Rate

<div>$${\dot V_{air,max,heat,terminal}} = DesHeatVolFlowzone$$</div>

#### Maximum Primary and Secondary Air Flow Rates

For the PIU terminal units, the maximum primary and secondary air flow rates are sized to the same value as the maximum total air flow rate.

#### Minimum Air Flow Rate

Basically minimum air flow rates are sized to the ventilation air requirement. This may be more or less complicated.

For the PIU's, the minimum primary air flow fraction is set to

<span>$\mathop {MinOA}\nolimits_{zone} /{\dot V_{air,max,primary,terminal}}$</span>.

For other VAV terminal units

<div>$${\dot V_{air,min,terminal}} = Fra{c_{air,\min }}*DesVolFlowzone$$</div>

where, *Fracair,min*corresponds to the minimum flow fraction of the teminal unit. This value is provided as user input, typically as the field “Zone Minimum Air Flow Fraction.” For the VAV terminals that allow scheduling minimum flow fraction (e.g., AirTerminal:SingleDuct:VAV:Reheat), there are two ways that *Fracair,min*can be determined. If a value is entered in the input field Constant Minimum Air Flow Fraction, then it is always used for *Fracair,min*. If the mimimum air flow fraction method is “Schedule” and the Constant Minimum Air Flow Fraction is left blank, then the program uses the average of the minimum and maximum values in the schedule for *Fracair,min*.

#### Fan On Flow Fraction

For the parallel PIU, this is set to the minimum primary air flow fraction.

#### Max Hot  Water Flow

<div>$${T_{coil,in}} = DesHeatCoilInTem{p_{zone}}$$</div>

<div>$${T_{coil,out}} = HeatDesTem{p_{zone}}$$</div>

The coil load and max hot water flow rate are then:

<sub><span>$\dot Qcoil,des = cp,air\cdot \rho air\cdot \dot Vair,coil,heating\cdot (Tout,coil - Tin,coil)$</span></sub>

<div>$$\dot Vmax,hw = \dot Qcoil,des/(cp,w\cdot \rho w\cdot \Delta Tloop,des)$$</div>

where

*c<sub>p,air</sub>* is evaluated at the average of the inlet & outlet temperatures and the coil outlet humidity ratio.

The four-pipe induction unit sizes the heating coil differently: to meet the zone load rather than match the design zone supply temperature. The load on the hot water coil is then the zone load minus whatever the central system does.

<div>$${\dot Q_{coil,des}} = {\dot Q_{zone,des}} - {c_{p,air}}{\rho_{air}}{\dot V_{air,primary,des}}({T_{coil,in}} - {T_{zone,heatpeak}})$$</div>

where

<div>$${T_{coil,in}} = DesHeatCoilInTem{p_{zone}}$$</div>

<div>$${T_{zone,heatpeak}} = ZoneTempAtHeatPea{k_{zone}}$$</div>

<div>$${\dot V_{air,primary,des}} = {\dot V_{air,max,terminal}}/(1 + {R_{induc}})$$</div>

#### Max Chilled Water Flow

The chilled water flow for the four-pipe induction unit is sized analogously to the hot water flow.

### Indirect Evaporative Cooler Sizing

The model for the object called EvaporativeCooler:Indirect:ResearchSpecial has a field for the secondary fan flow rate that can be autosized.

#### Secondary Fan Flow Rate

The secondary fan is not part of an airstream that is directly modeled in EnergyPlus.  Because the primary side air flows can be autosized as part of the air system, it is convenent to also scale the size of the secondary flow.   If the cooler is part of the main loop of a central air system, then the secondary fan flow rate is sized to equal to the main design flow rate.

<div>$$\dot Vfan,max = DesMainVolFlowsys$$</div>

If the cooler is part of the outdoor air path of a central air system, then the secondary fan flow rate is sized to be the maximum of either the design minimum outdoor air flow rate or one-half of the main design flow rate.

<div>$${\dot V_{fan,\max }} = MAX({\rm{DesOutAirVolFlow, 0}}{\rm{.5*DesMainVolFlow)}}$$</div>

### Secondary DX Coils Sizing

The secondary DX coils model does not have a standalone object and it is models as add-on feature to the DX Coils. When the secondary DX coil is added to a primary DX cooling coil, the heat rejected to secondary zone is sensible only and is treated as tnternal gain, hence secondary air flow rate is not required in the model.  Where as when the secondary DX coil is added to a primary DX heating coil, then the heat removed from  secondary zone may have sensible and latent components and is treated as tnternal gain. The sensible/latent component split among other parameters requires secondary coil air flow rate. Hence secondary coil air flow rate sizing is added based on the primary DX cooling coil only.

<div>$$\dot{V}_\rm{SecCoil} = \dot{V}_\rm{PriHeatCoil}\cdot \text{ScalingFactor}$$</div>

where

* <span>$\dot{V}_\text{SecCoil}$</span> is the secondary coil design air flow rate (m3/s)
* <span>$\dot{V}_\text{SecCoil}$</span> is the primary heating DX coil design air flow rate (kg/s)
* <span>$\text{ScalingFactor}$</span> is the secondary DX coil air flow rarte scaling factor (-)

### Desiccant Dehumidifier Sizing

The sizing of dehumidifier with no fans is done in subroutine SizeDesiccantDehumidifier.

#### Nominal Process Air Flow Rate

If the unit is part of zone equipment, then:

<div>$${\dot V_p} = Max\left( {DesCoolVolFlo{w_{zone}},DesHeatVolFlo{w_{zone}}} \right)$$</div>

If the unit is part of the central air system, then check if outdoor air system is present. If outdoor air system is part of the air loop and design outdoor air flow rate is greater than zero, then:

<div>$${\dot V_p} = DesOutAirVolFlo{w_{sys}}$$</div>

Otherwise, nominal process air flow rate is determined as follows:

for duct type = *main*

<div>$${\dot V_p} = DesMainVolFlo{w_{sys}}$$</div>

for duct type = *cooling*

<div>$${\dot V_p} = DesCoolVolFlo{w_{sys}}$$</div>

for duct type = *heating*

<div>$${\dot V_p} = DesHeatVolFlo{w_{sys}}$$</div>

for duct type = *other*

<div>$${\dot V_p} = DesMainVolFlo{w_{sys}}$$</div>

### Evaporative Cooler Sizing

The sizing of evaporative cooler objects is done in subroutine SizeEvapCooler.

#### Secondary Fan Flow Rate

<div>$$\dot V = DesMainVolFlo{w_{sys}}$$</div>

Note that it is only applicable to indirect CELdek pad object.

#### Direct Pad Area

As from the continuity equation, the area of direct pad is directly determined by assuming face air velocity of 3m/s as:

<div>$${A_{pad}} = \frac{{DesMainVolFlo{w_{sys}}}}{V}$$</div>

where

* \(A_\rm{pad} is area of direct pad, m<sup>2</sup>

* \(V\) is face air velocity, m/s

#### Direct Pad Depth

The solution of the following regression equation is used, assuming saturation effectiveness of 70% and face air velocity of 3m/s:

<div>$$\epsilon = 0.792714 + 0.958569D - 0.25193V - 1.03215D^2 + 0.0262659V^2 + 0.914869DV - 1.48241VD^2 - 0.018992 D V^3 + 1.13137D^3V + 0.0327622 D^2V^3 - 0.145384D^3 V^2$$</div>

where

* \(D\) is depth of pad, m
* \(\epsilon\)is saturation effectiveness

### Heat Recovery Sizing

The sizing of heat exchanger objects is done in subroutine SizeHeatRecovery.

#### Nominal Supply Air Flow Rate

If the unit is part of zone equipment, then:

<div>$${\dot V_p} = Max\left( {DesCoolVolFlo{w_{zone}},DesHeatVolFlo{w_{zone}}} \right)$$</div>

If the unit is part of the central air system, then check if outdoor air system is present. If outdoor air system is part of the air loop and design outdoor air flow rate is greater than zero, then:

<div>$${\dot V_p} = DesOutAirVolFlo{w_{sys}}$$</div>

Otherwise, nominal supply air flow rate is determined as follows:

for duct type = *main*

<div>$${\dot V_p} = DesMainVolFlo{w_{sys}}$$</div>

for duct type = *cooling*

<div>$${\dot V_p} = DesCoolVolFlo{w_{sys}}$$</div>

for duct type = *heating*

<div>$${\dot V_p} = DesHeatVolFlo{w_{sys}}$$</div>

for duct type = *other*

<div>$${\dot V_p} = DesMainVolFlo{w_{sys}}$$</div>

#### Nominal Supply Air Flow Rate

It is assumed to be equal to the nominal supply air flow rate.

### Low Temperature Radiant System Sizing

The sizing is done in subroutine *SizeLowTempRadiantSystem*.

#### ZoneHVAC:LowTemperatureRadiant:Electric:

##### Nominal Capacity

<div>$$Cap = DesHeatLoa{d_{zone}} \cdot HeatSizingFactor$$</div>

#### ZoneHVAC:LowTemperatureRadiant:VariableFlow:

##### Maximum Hot Water Flow

<div>$${\dot V_h} = \frac{{DesHeatLoa{d_{zone}} \cdot HeatSizingFactor}}{{\Delta {T_h} \cdot {c_{p,h}} \cdot {\rho_h}}}$$</div>

where

<span>${\dot V_h}$</span>* is maximum hot water flow rate, m<sup>3</sup>/s*

*c<sub>p,h</sub> is specific heat of hot water at reference condition (60°C), J/kgK*

*r<sub>h</sub> is the density of water at reference condition (60°C), kg/m<sup>3</sup>*

##### Maximum Cool Water Flow

<div>$${\dot V_c} = \frac{{DesCoolLoa{d_{zone}} \cdot CoolSizingFactor}}{{\Delta {T_c} \cdot {c_{p,c}} \cdot {\rho_c}}}$$</div>

<span>${\dot V_c}$</span>* is maximum chilled water flow rate, m<sup>3</sup>/s*

*c<sub>p,c</sub> is specific heat of hot water at reference condition (5°C), J/kgK*

*r<sub>c</sub> is the density of chilled water at reference condition (5°C), kg/m<sup>3</sup>*

##### Hydronic Tubing Length

<div>$$TubeLength = \frac{{TotalSurfaceArea}}{{TubeSpacing}}$$</div>

Note that tube spacing is assumed to be 0.15m.

#### ZoneHVAC:LowTemperatureRadiant:ConstantFlow:

##### Rated Flow Rate

The object provides both cooling and heating, and also operates in a single operating mode such as cooling-only or heating-only mode. Thus, the rated flow rate is determined, depending upon the operating mode of the unit. If the unit operates in a single operating mode, either design chilled water or hot water flow rate is chosen. The larger of the two is chosen if the unit provides both cooling and heating. The flow rates are determined in the same fashion to the variable flow system above.

##### Hydronic Tubing Length

The length of hydronic tube is determined as described in the variable flow radiant system above.

### Unitary System Sizing

The AirloopHVAC:UnitarySystem object incorporates all coils types and fans as a complete packaged system. The fans and coils are optional allowing virtually any system type to be modeled. Sizing of this object depends on the coils selected. For single coil systems, the associated air flow rate is used as the operating flow rate (i.e., cooling or heating). For systems with both a cooling and heating coil, this methodology still applies except for DX systems (Heat Pumps) where the greater of the cooling or heating air flow rate is used. Heat pumps are defined as systems having both a DX cooling and DX heating coil. The inputs that may need to be autosized are the supply air air volumetric air flow rates during cooling operation, heating operation, and when no cooling or heating is needed. The data needed for sizing the units are obtained from the zone design arrays.

#### Supply Air volumetric flow rate during cooling operation:

<div> $$ \dot V_{SA,cooling} = \text{DesCoolVolFlow}_{zone} / \text{ZoneFraction} $$ </div>

#### Supply Air volumetric flow rate during heating operation:

<div> $$ \dot V_{SA,heating} = \text{DesHeatVolFlow}_{zone} / \text{ZoneFraction} $$ </div>

#### Supply Air volumetric flow rate when DX coils are used as a system:

<div> $$ \dot V_{SA} = \max \left(\text{DesCoolVolFlow}_{zone}, \text{DesHeatVolFlow}_{zone}\right) / \text{ZoneFraction} $$ </div>

where:

* ZoneFraction = Fraction of the total volume flow that goes through the controlling zone

The unitary system object also allows scalable sizing as follows:

Flow Per Floor Area:

<div>$$ \dot V_{SA} = \left(\text{FlowPerFloorArea}\right)\left(\text{TotalFloorArea}\right) $$</div>

Fraction of Autosized Cooling Value:

<div>$$ \dot V_{SA,cooling} = \dot V_{SA,des,cooling}\left(\text{FractionOfCoolingValue}\right) $$</div>

Fraction of Autosized Heating Value:

<div>$$ \dot V_{SA,heating} = \dot V_{SA,des,heating}\left(\text{FractionOfHeatingValue}\right) $$</div>

Flow Per Cooling Capacity

<div>$$ \dot V_{SA,cooling} = \dot Q_{coil,des,cooling}\left(\text{FractionOfCoolingValue}\right) $$</div>

Flow Per Heating Capacity

<div>$$ \dot V_{SA,heating} = \dot Q_{coil,des,heating}\left(\text{FractionOfHeatingValue}\right) $$</div>

#### Maximum Supply Air Temperature

The maximum supply air temperature can also be automatically selected. The value is determined from the Sizing:Zone or Sizing:System object depending on where the object is used in the simulation (i.e., as zone or air loop equipment).
Maximum supply air temperature

<div>$$T_{SA,max} = \text{HeatDesTemp}_{ZoneOrSystem}$$</div>

Zone Outdoor Air Design Data
----------------------------

Outdoor air design data may be required for many aspects of a building computer model. Sizing of HVAC equipment, infiltration and ventilation, and specific outdoor air requirements for different zone types are a few examples where required outdoor air quantities may vary. Since there would be a significant chance for data input errors if each individual aspect of the simulation model allowed for independent input of outdoor air design data, this general object is used to define outdoor air design data and this data set may be used throughout the building simulation model.

The design data is provided as a group of inputs that are recognized by designers as standard practice. This information may be used individually or used as a group to calculate summations or maximums of the entered data. These design data include values for:

* Outdoor air per person
* Outdoor air per zone floor area
* Outdoor air per zone
* Outdoor air changes per hour

This design data is entered in an outdoor air design data object and may be referenced by other objects during the simulation. A single specification for outdoor air design data may be used by all other appropriate objects within EnergyPlus, or multiple outdoor air design data objects may be specified and these design data objects may be used as necessary by other objects when outdoor air design quantaties vary for any reason.

### Design Outdoor Air Calculation

The outdoor air design data is entered as a group and referenced through name association to this group of design data (Ref. DesignSpecification:OutdoorAir). The reference name in the following example is "ZoneOAData".

A DesignSpecification:OutdoorAir example:

```idf
DesignSpecification:OutdoorAir,
    ZoneOAData,            !- Name
    Maximum,               !- Outdoor Air Method
    0.00944,               !- Outdoor Air Flow per Person {m3/s}
    0.00305;               !- Outdoor Air Flow per Zone Floor Area {m3/s-m2}
    ,                      !- Outdoor Air Flow per Zone
    ,                      !- Outdoor Air Flow Air Changes per Hour
    Min OARequirements Sched; !- Outdoor Air Flow Rate Fraction Schedule Name
```


Given this set of data, the quantity of outdoor air is calculated based on the Outdoor Air Method specified in each outdoor air design data object. In this example, the maximum of the per person and per zone floor area is used to establish the outdoor air quantity.

As previously mentioned, this group of outdoor air design data is reference by other objects used in the simulation. The reference is by the *name* of the outdoor air design data object. Any reference to this name by other objects simply means that the object referencing this data set will use the values specified in this common object. Note that a zone name is not included in the list of data and the calculation of occupancy, zone floor area, or zone volume is implied through this named reference and *the connection to a zone via the referencing object*. For example, if a terminal unit references an outdoor air design data object, the zone served by that terminal unit is used to determine the occupancy, zone floor area, and zone volume in the following calculations.

<div>$$O{A_{people}} = Oc{c_{zone}}\left( {OAFlowperPerson} \right)$$</div>

<div>$$O{A_{floor\,area}} = {A_{zone}}\left( {OAFlowperFloorArea} \right)$$</div>

<div>$$O{A_{zone}} = \left( {OAFlowperZone} \right)$$</div>

<div>$$O{A_{ACH}} = {V_{zone}}\left( {{\raise0.7ex\hbox{${OAFlowAirChangesperHour}$} \!\mathord{\left/ {\vphantom {{OAFlowAirChangesperHour} {3600}}}\right.}\!\lower0.7ex\hbox{${3600}$}}} \right)$$</div>

where:

<span>$O{A_{people}}$</span>= outdoor air volume flow rate based on occupancy, [m<sup>3</sup>/s]

<span>$Oc{c_{zone}}$</span>= number of occupants in zone, [people]

<span>$OAFlowperPerson$</span>= outdoor air volume flow rate per person, [m<sup>3</sup>/s-person]

<span>$O{A_{floor\;area}}$</span>= outdoor air volume flow rate based on zone floor area, [m<sup>3</sup>/s]

<span>${A_{zone}}$</span>= zone floor area, [m<sup>2</sup>]

<span>$OAFlowperFloorArea$</span>= outdoor air volume flow rate per zone floor area, [m<sup>3</sup>/s-m<sup>2</sup>]

<span>$O{A_{zone}}$</span>= zone outdoor air volume flow rate, [m<sup>3</sup>/s]

<span>$OAFlowperZone$</span>= outdoor air volume flow rate per zone, [m<sup>3</sup>/s]

<span>$O{A_{ACH}}$</span>= outdoor air volume flow rate based on air changes per hour, [m<sup>3</sup>/s]

<span>${V_{zone}}$</span>= zone volume, [m<sup>3</sup>]

<span>$OAFlowAirChangesperHour$</span>= outdoor air volume flow in air changes per hour, [m<sup>3</sup>/s-m<sup>3</sup>]

Given the calculations for each specific type of design data, the method used to calculate the outdoor air design data is then based on a user selected method for this specific outdoor air design data object. The outdoor air methods used to calculate the outdoor air quantity and the associated value for outdoor air volume flow rate are shown here.

Flow/Person =&gt; <span>$O{A_{people}}$</span>

Flow/Area =&gt; <span>$O{A_{floor\,area}}$</span>

Flow/Zone =&gt; <span>$O{A_{zone}}$</span>

AirChanges/Hour =&gt; <span>$O{A_{ACH}}$</span>

Sum =&gt; <span>$O{A_{people}}\, + \,O{A_{floor\,area}}\, + \,O{A_{zone}}\, + \,O{A_{ACH}}$</span>

Maximum =&gt; <span>$MAX\left( {O{A_{people}}\,,\,O{A_{floor\,area}}\,,\,O{A_{zone}}\,,\,O{A_{ACH}}} \right)$</span>

If an Outdoor Air Flow Rate Fraction Schedule Name is specified, the flow rate determined above will be multiplied by the current schedule value.

Examples of objects that reference the outdoor air design data object are:

* AirTerminal:SingleDuct:VAV:NoReheat

* AirTerminal:SingleDuct:VAV:Reheat

### References

ASHRAE Fundamentals 2001. 2001 ASHRAE Fundamentals Handbook. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Pedersen, C.O., D.E. Fisher, and R.J. Liesen. 1997. A heat balance based cooling load calculation procedure. ASHRAE Transactions, Vol. 103(2), pp. 459-468.

Pedersen, C.O. 2001. Toolkit for Building Load Calculations. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Demand Limiting
===============

Demand limiting, or demand management, is a strategy for reducing a building's demand for utilities, e.g., electricity.  Utility companies typically charge a monthly fee for "demand charges" that is based on the peak demand during a certain time period.  Often the peak demand charge is set by one exceptional day that is much higher than the peak demand for an average day during the month.  Therefore, to save utility costs, it is in the interest of building owners to find ways to manage the demand on peak days.  While demand management is generally concerned with the demand for electricity, the future will likely see demand management of other utilities, such as natural gas or water.

Demand limiting controls shut off or reduce the power to non-essential loads in order to reduce the overall building demand.  Some typical controls:

* shut off or dim electric lights, equipment, or HVAC systems

* reset the thermostatic setpoints on HVAC systems

* reduce the load of a set of similar components by rotating one or more components "off" for a short time interval

* turn on generators to meet some or all of the building's demand.

The demand limiting controls implemented in EnergyPlus are intended to allow some of the more common demand limiting strategies.  The DemandManagerAssignmentList object is a high level control that makes demand limiting decisions based on a list of possible demand limiting strategies.  Each demand limiting strategy is described in a separate DemandManager object.  Each DemandManager object controls a group of similar load objects of the same type, such as DemandManager:Lights, DemandManager:ElectricEquipment, or DemandManager:Thermostats objects.

### Algorithm

In EnergyPlus the DemandManagerAssignmentList and DemandManager objects are simulated by the Demand Manager module.  The Demand Manager is built into the overall solution method for the program.  For each zone time step, the program executes three major segments of code:

§ exterior energy use

* zone heat balance (surface heat balances, internal gains, and air flows)

* HVAC system simulation (air and plant loops)

The exterior energy use segment is completely independent of the zone heat balance and HVAC system simulation.  Exterior energy use handles energy use accounting for exterior lights and exterior equipment that are outside of the building and are not part of the zone heat balance.  The zone heat balance segment includes all of the surface heat balances, internal heat gains, and air flows.  The HVAC system simulation includes air and plant loops with their associated HVAC components.  The behaviour of the HVAC system depends on the results of the zone heat balance.  The HVAC system simulation operates on a variable "system" time step which is automatically shortened if necessary for stability.

The Demand Manager is called after the first pass through the HVAC system simulation, before the system time step is shortened.  After evaluating the DemandManagerAssignmentList object, the Demand Manager decides if demand limiting is required.  If demand limiting is required, the individual DemandManager objects are surveyed to determine which loads can be limited.  Based on the *Demand Manager Priority* selected, the Demand Manager then decides which DemandManager objects should be activated.  In turn, the activated DemandManager objects set the demand limiting hooks on their respective load objects.  Finally, depending on the type of DemandManager objects that were activated, one or more of the major segments of code must be called to be resimulated because the load conditions have changed.  The code segments depend on the type of DemandManager and the relationship of its load objects to the overall solution method.  The table below shows the different DemandManager types and the related code segments that must be resimulated.



Table 42. Demand Manager Types and Resimulation.

<table class="table table-striped">
<tr>
<th>Demand Manager Type</th>
<th>Resimulate Exterior Energy</th>
<th>Resimulate Zone Heat Balance</th>
<th>Resimulate HVAC System</th>
</tr>
<tr>
<td>DemandManager:ExteriorLights</td>
<td>ü</td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>DemandManager:Lights</td>
<td> </td>
<td>ü</td>
<td>ü</td>
</tr>
<tr>
<td>DemandManager:ElectricEquipment</td>
<td> </td>
<td>ü</td>
<td>ü</td>
</tr>
<tr>
<td>DemandManager:Thermostats</td>
<td> </td>
<td> </td>
<td>ü</td>
</tr>

</table>



All demand limiting controls are disabled during warmup days and sizing runs.

#### Sequential Priority

If the *Demand Manager Priority* field of the DemandManagerAssignmentList object is set to SEQUENTIAL, each DemandManager in the list is activated in sequence from first to last until demand is reduced below the limit or until all managers are activated.  A DemandManager is skipped if it cannot reduce the demand.  Possible reasons that a manager cannot reduce demand include:

* not enough load to limit

* not available because of its *Availability Schedule*

* already activated; load limited during a previous time step.

For each DemandManager in the list that is successfully activated, one or more of the major code segments must be called to be resimulated (see above).  The DemandManagerAssignmentList object is then reevaluated to determine if further demand limiting is required before the next DemandManager is activated.

The implication of sequential priority is that a DemandManagerAssignmentList with many DemandManagers may make many passes through the Demand Manager before all demand limiting decisions are finalized.  Each pass requires an additional resimulation of the current time step.  In some cases this could significantly slow down the overall simulation runtime.  The use of the *Minimum Limit Duration* field can help to ensure that not every DemandManager is being activated at every time step.

#### All Priority

If the *Demand Manager Priority* field of the DemandManagerAssignmentList object is set to ALL, all DemandManagers in the list are activated simultaneously to achieve the maximum demand reduction.  This priority option requires only one final resimulation after all DemandManagers are activated.



Alternative Modeling Processes
==============================

### RoomAir Models

The group of models described in this section is used to account for non-uniform room air temperatures that may occur within the interior air volume of a zone.  These models are accessed using the RoomAirModelType input object. RoomAir modeling was added to EnergyPlus starting with Version 1.2.  Although there are many types of analyses (comfort, indoor air quality, etc) that might benefit from localized modeling of how room air varies across space, only the *temperature* distribution of room air within the zone is currently addressed in EnergyPlus.  This allows surface heat transfer and air system heat balance calculations to be made taking into account natural thermal stratification of air and different types of intentional air distribution designs such as under-floor and side-wall displacement ventilation that purport to extract room air at higher-than-mean temperatures.  Note that EnergyPlus does **not** have completely general methods of modeling room air that are applicable to every conceivable type of airflow that might occur in a zone.  Such models (e.g. RANS-CFD) are too computationally expensive to use with EnergyPlus for the foreseeable future. The models that are available in EnergyPlus offer only limited modeling capabilities for select room airflow configurations.  Also note that because the complete mixing model for room air has long been the standard in building energy simulation, there is not currently a consensus on how to best model non-uniform air temperatures in buildings.  Therefore, it is up to the user to have a good understanding of when, where, and how to apply the room air models available in EnergyPlus.  The rest of this section provides some guidance in the way of examples and further discussion of the models available in EnergyPlus.

EnergyPlus offers the different types of air models listed in the table below along with the input objects associated with the use of that model.



Table 43.  Summary of room air models available in EnergyPlus

<table class="table table-striped">
<tr>
<th>Air model name</th>
<th>Applicability</th>
<th>Input Objects Required</th>
</tr>
<tr>
<td>Well-Mixed</td>
<td>All zones</td>
<td>None, default</td>
</tr>
<tr>
<td>User Defined</td>
<td>Any zone where the user has prior knowledge of the temperature pattern</td>
<td>‘RoomAirModelType’, ‘RoomAir:TemperaturePattern:UserDefined’, ‘RoomAir:TemperaturePattern: xx’</td>
</tr>
<tr>
<td>One-Node Displacement Ventilation (Mundt)</td>
<td>displacement ventilation in typical office-type zones</td>
<td>‘RoomAirModelType’, ‘RoomAirSettings:OneNodeDisplacementVentilation’, ‘RoomAir:Node’’</td>
</tr>
<tr>
<td>Three-Node Displacement Ventilation (UCSD)</td>
<td>displacement ventilation</td>
<td>‘RoomAirModelType’, ‘RoomAirSettings:ThreeNodeDisplacementVentilation’</td>
</tr>
<tr>
<td>Under-Floor Air Distribution Interior Model (UCSD)</td>
<td>Interior zones served by a UFAD system</td>
<td>‘RoomAirModelType’, ‘RoomAirSettings:UnderFloorAirDistributionInterior’</td>
</tr>
<tr>
<td>Under-Floor Air Distribution Exterior Model (UCSD)</td>
<td>Exterior zones served by a UFAD system</td>
<td>‘RoomAirModelType’, ‘RoomAirSettings:UnderFloorAirDistributionExterior’</td>
</tr>
<tr>
<td>UCSD Cross Ventilation</td>
<td>cross ventilation</td>
<td>‘RoomAirModelType’, ‘RoomAirSettings:CrossVentilation’</td>
</tr>

</table>

The room air models are coupled to the heat balance routines using the framework described by Griffith and Chen (2004).  Their framework was modified to include features needed for a comprehensive program for annual energy modeling rather than one for hourly load calculations.  The formulation is largely shifted from being based on the setpoint temperature to one based on the current mean air temperature.  This is necessary to allow for floating temperatures and dual setpoint control where there may be times that the mean zone temperatures are inside the dead band.  The coupling framework was also extended to allow for exhaust air flows (e.g. bathroom exhaust fans) in addition to air system return flows.

The inside face temperature calculation is modified by rewriting the zone air temperature, *T<sub>a</sub>*, with an additional subscript, *i*, for the surface index (<span>${T_{{a_j}}} \to {T_{{a_{i,j}}}}$</span>or <span>${T_{{a_{}}}} \to {T_{{a_i}}}$</span>).  The inside face heat balance is solved for its surface temperature using,

<div>$${T_{{s_{i,j}}}} = \frac{{{T_{s{o_{i,j}}}}{Y_{i,o}} + \sum\limits_{k = 1}^{nz} {{T_{s{o_{i,j - k}}}}} {Y_{i,k}} - \sum\limits_{k = 1}^{nz} {{T_{{s_{i,j - k}}}}} {Z_{i,k}} + \sum\limits_{k = 1}^{nq} {{\Phi_{i,k}}{{q''}_{k{i_{i,j - k}}}} + {T_{{a_{i,j}}}}{h_{{c_{i,j}}}} + {{q''}_{LWS}} + {{q''}_{LWX}} + {{q''}_{SW}} + {{q''}_{sol}}} }}{{{Z_{i,o}} + {h_{{c_{i,j}}}}}}$$</div>

where,         *T<sub>s</sub>*         is the inside face temperature

*i*           subscript indicates individual surfaces

      *j*           subscript indicates current time step

      *k*          subscript indicates time history steps

      *T<sub>so</sub>*        is the outside face temperature

      *Y<sub>i</sub>        * are the cross CTF coefficients

      *Z<sub>i                  </sub>* are the inside CTF coefficients

      *Φ<sub>i</sub>*         are the flux CTF coefficients

      <span>${q''_{ki}}$</span>       is the conduction heat flux through the surface

      <span>${h_{{c_i}}}$</span>       is the surface convection heat transfer coefficient

      *T<sub>a</sub>*         is the near-surface air temperature

      <span>${q''_{LWS}}$</span>    is the longwave radiation heat flux from equipment in zone

      <span>${q''_{LWX}}$</span>    is the net long wavelength radiation flux exchange between zone surfaces

      <span>${q''_{SW}}$</span>     is the net short wavelength radiation flux to surface from lights

      <span>${q''_{sol}}$</span>      is the absorbed direct and diffuse solar (short wavelength) radiation

#### References:

Griffith, B. and Q. Chen. 2004. Framework for coupling room air models to heat balance load and energy calculations (RP-1222). International Journal of Heating, Ventilating, Air-conditioning and Refrigerating Research. ASHRAE, Atlanta GA.  Vol 10. No 2. April 2004.

### User Defined RoomAir Temperatures

The input object RoomAir:TemperaturePattern:UserDefined provides a capabity for users to define the sort of air temperature pattern he or she expects in the zone.  With these models, the pattern is generally set beforehand and does not respond to conditions that evolve during the simulation.  (Exception: the pattern available through the RoomAir:TemperaturePattern:TwoGradient object will switch between two different pre-defined vertical gradients depending on the current value of certain temperatures or thermal loads. )

The user-defined patterns obtain the mean air temperature, <span>${T_{MAT}}$</span>, from the heat balance domain and then produce modified values for:

      <span>${T_{ai}}$</span>       the adjacent air temperature which is then used in the calculation of inside face surface temperature during the heat balance calculations,

      <span>${T_{leaving}}$</span>  the temperature of air leaving the zone and entering the air system returns

      <span>${T_{exhaust}}$</span>  the temperature of air leaving the zone and entering the exhaust.

      <span>${T_{stat}}$</span>     the temperature of air “sensed” at the thermostat (not currently used in air system control because air system flows use load-based control).

The user defined room air models used indirect coupling so that the patterns provide values for, or ways to calculate, how specific temperatures differ from <span>${T_{MAT}}$</span>.  The various <span>$\Delta T$</span> values determined from the model are applied to <span>${T_{MAT}}$</span> as follows:

<div>$${T_{ai}} = \Delta {T_{ai}} + {T_{MAT}}$$</div>

(where “*i’s”* represents each surface in the zone that is affected by the model)

<div>$${T_{leaving}} = \Delta {T_{return}} + {T_{MAT}}$$</div>

<div>$${T_{exhaust}} = \Delta {T_{exhaust}} + {T_{MAT}}$$</div>

<div>$${T_{stat}} = \Delta {T_{stat}} + {T_{MAT}}$$</div>

The patterns defined by the object ‘RoomAir:TemperaturePattern:SurfaceMapping’ are fairly straightforward.  The user directly inputs values for <span>$\Delta {T_{ai}}$</span> for each surface.  The pattern “maps” specific surfaces, identified by name, to <span>$\Delta {T_{ai}}$</span> values.  This provides completely general control (but in practice may be cumbersome to use).  The other patterns focus on temperature changes in the vertical direction.  Surfaces do not need to be identified, but all the surfaces with the same height will be assigned the same <span>$\Delta {T_{ai}}$</span> values.

The patterns defined by the object ‘RoomAir:TemperaturePattern:NondimensonalHeight’ apply a temperature profile based on a non-dimensionalized height, <span>${\rm Z}$</span>.  The height of each surface is defined to be the z-coordinate of the surface’s centroid relative to the average z-coordinate of the floor surfaces.  The zone ceiling height is used as the length scale to non-dimensionalize each surface’s height so that,

<div>$${{\rm Z}_i} = ({z_{i,centroid}} - {z_{floorAvg}})/Ceiling\;Height$$</div>

(where “*i’s”* represents each surface in the zone that is affected by the model)

The values for <span>${Z_i}$</span> are constrained to be between 0.01 and 0.99 because the value is meant to describe the air layer near the surface (say approximate 0.1 m from the surface) rather than the surface itself.

The user-defined profile is treated as a look up table or piecewise linear model.  The values for <span>$\Delta {T_{ai}}$</span> are determined by searching the <span>${\rm Z}$</span> values in the user-defined profile and performing linear interpolation on the associated <span>$\Delta {T_a}$</span> values.

The patterns defined by the object ‘RoomAir:TemperaturePattern:ConstantGradient’ apply a constant temperature gradient in the vertical direction.  The model assumes that <span>${T_{MAT}}$</span> occurs at the mid-plane so that <span>${{\rm Z}_{{T_{MAT}}}} = 0.5$</span> (by definition).  The surface <span>${Z_i}$</span> values are compared to <span>${Z_{{T_{MAT}}}}$</span>and then scaled with zone ceiling height to obtain values for the change in height (in units of meters), <span>$\Delta z$</span>.  The user defined gradient, <span>$grad$</span>, (units of ºC/m) is then used to determine <span>$\Delta {T_{ai}}$</span> values using

<div>$$\Delta {T_{ai}} = \Delta z * grad$$</div>

The patterns defined by the object ‘RoomAir:TemperaturePattern:TwoGradient’ are very similar to the constant gradient pattern above but the value of <span>$grad$</span> used at any given time is selected by interpolating between two user-defined values for <span>$grad$</span>.  Five options are available, three based on temperatures and two based on thermal loads – see the Input Output Reference.  The user provides upper and lower bounding values.  If the current value of the “sensing” variable lies between the upper and lower bounds, then <span>$grad$</span> is determined using linear interpolation.  If the designated value is above the upper bound then the upper value for <span>$grad$</span> is used (no extrapolation).  Similarly, if the designated value is below the lower bound, then the lower value for <span>$grad$</span> is used.  Note that “upper” and “lower” indicate the temperature and heat rate bounds and that the values for <span>$grad$</span> do not have to follow in the same way; the <span>$grad$</span> value for the lower bound could be higher than the <span>$grad$</span> value for the upper bound (providing a something of a reverse control scheme).  Rather than directly using <span>$\Delta T$</span> values from the user, the temperatures for the return air, exhaust and thermostat are determined based on user-entered heights (in units of meters from the floor) and applying the current value for <span>$grad$</span>.

### One-Node Displacement Ventilation RoomAir Model

The input object RoomAirSettings:OneNodeDisplacementVentilation provides a simple model for displacement ventilation.  Mundt (1996) points out that a floor air heat balance provides a simple and reasonably accurate method of modeling the temperature near the floor surface. The slope of a linear temperature gradient can then be obtained by adding a second upper air temperature value that comes from the usual overall air system cooling load heat balance.  The figure below diagrams the temperature distribution versus height being calculated by the model.  Mundt’s floor air heat balance is extended to include convection heat gain from equipment and by ventilation or infiltration that may be introduced near the floor in order to maintain all the terms in the air heat balance of the Heat Balance Model.  This yields the following heat balance for a floor air node,

<div>$$\rho \,{c_p}\dot V({T_{AirFloor}} - {T_{Supply}}) = {h_{cFloor}}{A_{Floor}}({T_{Floor}} - {T_{AirFloor}}) + {Q_{ConvSourceFloor}} + {Q_{InfilFloor}}$$</div>

where

*ρ* is the air density

*c<sub>p</sub>* is the air specific heat at constant pressure

<span>$\mathop V\limits^\cdot  $</span>is the air system flow rate

*T<sub>supply</sub>* is the air system’s supply air drybulb temperature

*h<sub>cFloor</sub>*  is the convection heat transfer coefficient for the floor

*A<sub>floor</sub>* is the surface area of the floor

*T<sub>floor</sub>* is the surface temperature of the floor

*Q<sub>convSourceFloor</sub> * is the convection from internal sources near the floor (&lt; 0.2 m)

*Q<sub>InfilFloor</sub>*  is the heat gain (or loss) from infiltration or ventilation near the floor



“Floor splits” are the fraction of total convective or infiltration loads that are dispersed so as to add heat to the air located near the floor.  The user prescribes values for floor splits as input.  No guidance is known to be available to use in recommending floor splits, but the user could for example account for equipment known to be near the floor, such as tower computer cases, or supplementary ventilation designed to enter along the floor.  The equation above can be solved directly for *T<sub>AirFloor</sub>* and is used in the form of the equation below,

<div>$${T_{AirFloor}} = \frac{{\rho \,{c_p}\dot V{T_{Supply}} + \sum {{h_{cFloor}}{A_{Floor}}{T_{Floor}}}  + {{\dot Q}_{ConvSourceFloor}} + {{\dot Q}_{InfilFloor}}}}{{\rho \,{c_p}\dot V + \sum {{h_{cFloor}}{A_{Floor}}} }}$$</div>

The upper air node temperature is obtained by solving the overall air heat balance for the entire thermal zone for the temperature of the air leaving the zone and going into the air system return, *T<sub>leaving</sub>*.

<div>$${T_{Leaving}} = \frac{{ - {{\dot Q}_{sys}}}}{{p{c_p}\dot V}} + {T_{Supply}}$$</div>

where <span>${\dot Q_{sys}}$</span> is the air system heat load with negative values indicating a positive cooling load.  Values for <span>${\dot Q_{sys}}$</span> are computed by the load calculation routines and passed to the air model.  The vertical temperature gradient or slope, *dT/dz*, is obtained from,

<div>$$\frac{{dT}}{{dz}} = \frac{{{T_{Leaving}} - {T_{AirFloor}}}}{{{H_{return}}}}$$</div>

where *H<sub>return</sub>* is the distance between the air system return and the floor air node assumed to be 0.1 m from the floor and *z* is the vertical distance.

![](EngineeringReference/media/image2341.svg.png)

Figure 132.  Height versus temperature schematic for Mundt model

The constant slope allows obtaining temperatures at any vertical location using,

<div>$${T_{{a_i}}} = {T_{leaving}} - \frac{{dT}}{{dz}}({z_{leaving}} - {z_i})$$</div>

So for example the temperatures near the ceiling can easily be determined. Accounting for the location of the thermostat inside the zone (e.g. 1.1 m) is accomplished by returning the temperature for the appropriate height to the appropriate air node used for control. If the walls are subdivided in the vertical direction as shown in the figure above, then the air model can provide individual values for each surface based on the height and slope.  However, no additional heat balances are necessarily made (in the air domain) at these points as all the surface convection is passed to the model in the totaled value for <span>${\dot Q_{sys}}$</span>.

#### References

Mundt, E. 1996. The performance of displacement ventilation systems-experimental and theoretical studies, Ph. D. Thesis, Royal Institute of Technology, Stockholm.

### Three-Node Displacement Ventilation RoomAir Model

#### Overview

The input object RoomAirSettings:ThreeNodeDisplacementVentilation provides a simple model for heat transfer and vertical temperature profile prediction in displacement ventilation. The fully-mixed room air approximation that is currently used in most whole building analysis tools is extended to a three node approach, with the purpose of obtaining a first order precision model for vertical temperature profiles in displacement ventilation systems. The use of three nodes allows for greatly improved prediction of thermal comfort and overall building energy performance in low energy cooling strategies that make use of unmixed stratified ventilation flows.

The UCSD Displacement Ventilation Model is one of the non-uniform zone models provided through the Room Air Manager in EnergyPlus. The intent is to provide a selection of useful non-uniform zone air models to enable the evaluation of air-conditioning techniques that use stratified or partially stratified room air. Such techniques include displacement ventilation (DV) and underfloor air distribution (UFAD) systems. The methodology can also include, in principle, natural displacement ventilation and also wind-driven cross-ventilation (CV).

#### Displacement Ventilation

A DV system is a complete contrast to a conventional forced air system. In a conventional system conditioned air is delivered at ceiling level and the intent is to create a fully mixed space with uniform conditions. In a DV system conditioned air is delivered at floor level and low velocity in order to minimize mixing and to establish a vertical temperature gradient. The incoming air “displaces” the air above it which, in turn,  is exhausted through ceiling level vents. In DV a noticeable interface occurs between the occupied zone of the room and a mixed hot layer near the ceiling of the room(Dominique & Guitton, 1997). Maintaining the lower boundary of this warm layer above the occupied zone is one of the many unique challenges of displacement ventilation design. Often DV systems use 100% outside air. The vertical displacement air movement means that convective heat gains introduced near the ceiling will be removed without affecting the occupied region of the room. Also a fraction of the heat gains that occur in the occupied zones rise as plumes into the upper part of the space, thereby reducing the cooling load. Similarly the fresh air will be used more effectively than with a fully mixed system: the fresh air won’t be “wasted” in the upper, unoccupied region of the room. Finally, the vertical temperature gradient means that the average room temperature can be higher for a DV conditioned room than with a conventionally conditioned room: the occupants feel the lower temperature in the lower region of the room and are unaffected by the higher temperature near the ceiling. However, whenever the outside air temperature is above ≈19°C this advantage is mostly lost: the internal loads must be removed from the space independently of the airflow pattern (during the warmer hours buildings tend to be almost closed to the outside, operating in closed loop). The inflow temperature advantage is then only useful for the minimum outside air that must always be provided (in most cases this remaining advantage is negligible).

DV systems have limitations. In order to avoid chilling the occupants the supply air temperature used for DV is considerably higher than that used in conventional forced-air systems. This can lead to problems in removing both sensible and latent loads. Exterior spaces may have conditions that are not conducive to establishing a vertical temperature gradient. DV systems seem to be best suited to interior spaces with only moderate loads.

#### Non-uniform zone models

Several types of models have been proposed as suitable for inclusion in building energy simulation (BES) programs. These models must be simple enough not to impose an undue computational burden on a BES program, yet provide enough predictive capability to produce useful comparisons between conventional and stratified zone operation strategies. ASHRAE RP-1222 (Chen & Griffith 2002) divides the candidate models into two categories: *nodal* and *zonal*. Nodal models describe the zone air as a network of nodes connected by flow paths; each node couples convectively to one or more surfaces. Zonal models are coarse–grained finite volume models. ASHRAE RP-1222 provides a short history (and examples) of each type of model. In terms of nodal models for displacement ventilation we mention the Mundt model (Mundt 1996), since it is implemented in EnergyPlus, and the Rees-Haves model (Rees & Haves 2001) since it is a well developed nodal-type model and is implemented in the RP-1222 toolkit. The Rees-Haves model, while successful in predicting the flow and temperature field for geometries similar to those used in its development, can suffer from lack of flexibility and clarity in the modeling approximations. When dealing with diverse geometries it is not clear that the flow coefficients used in the model are applicable or why they can be used since plumes, the fundamental driving mechanisms of the displacement flow, are not explicitly modeled. This is the main difference between the DV models implemented in theRP-1222 toolkit and the model that is described here.

The UCSD DV model is closer to a nodal model than to a zonal model. However, it is best to classify it in a separate category: plume equation based multi-layer models (Linden *et al*. 1990, Morton *et al*. 1956). These models assume that the dominant mechanism is plume-driven flow from discrete internal sources and that other effects (such as buoyancy driven flow at walls or windows) may be neglected. Alternatively, these heat sources also produce plumes that can be included in the model. The result is a zone divided vertically into two or more well separated regions – each region characterized by a single temperature or temperature profile. This characterization allows the physics of the heat gains and the ventilation flow to be represented in a realistic manner, without the introduction of *ad hoc* assumptions.

#### Model Description

#### Single Plume Two Layer Model

The simplest form of the plume equation based models is the case of a single plume in an adiabatic box with constant supply air flow. For this configuration two layers form in the room: a lower layer with similar density and temperature as the inflow air and a mixed upper layer with the same density / temperature as the outflow air. The main assumption of this model, successfully validated against scaled model experiments (Linden *et al.* 1990), is that the interface between the two layers occurs at the height (h) where the vertical buoyancy driven plume flow rate is the same as the inflow rate. For a point source of buoyancy in a non-stratified environment (a plume) the airflow rate increases with vertical distance from the source according to:

<div>$$\dot V = C\cdot {B^{1/3}}{z^{5/3}}$$</div>

where

<span>$\dot V$</span>= plume volume flux [m3/s]

<span>$B$</span>= buoyancy flux  [m4/s3]

<span>$z$</span>= vertical distance above source [m]

<div>$$C = \frac{6}{5}\alpha {(\frac{9}{{10}}\alpha )^{1/3}}{\pi ^{2/3}}$$</div>

<span>$\alpha $</span>= plume entrainment constant; a value of  0.127 is used, suitable for top-hat profiles for density and velocity across the plumes.

For an ideal gas

<div>$$\Delta \rho /\rho  = \Delta {\rm T}/{\rm T}$$</div>

resulting in the following relation between heat input rate and buoyancy flux:

<div>$$B = \frac{{g\dot Q}}{{\rho {C_p}T}}$$</div>

where

<span>$\rho $</span>= density of air [kg/m3]

<span>$T$</span>= air temperature [K]

<span>$g$</span>= acceleration of gravity [m/s2]

<span>$\dot Q$</span>= heat input rate [W]

<span>${C_p}$</span>=specific heat capacity of air [J/kgK]

Since the plume volume flow rate increases with height with exponent 5/3, for any room inflow rate (F, (m<sup>3</sup>/s)) there will always be a height (h,(m)) where the plume driven flow rate matches the inflow rate. This height is obtained by setting (1.1) equal to F and solving for z=h:

<div>$$h = {F^{3/5}}/({C^{3/5}}{B^{1/5}})$$</div>

Substituting in and introducing air properties at 20 C gives:

<div>$$h = 24.55\cdot {F^{3/5}}/{\dot Q^{1/5}}$$</div>

#### Multiple Plumes and Wall Heat Transfer

Of course, it would be rare for a real world case to consist of a single point-source plume originating on the floor, unaffected by heat gains from walls and windows. For multiple plumes of equal strength a straight-forward extension of the single is possible. N plumes of unequal strength result in the formation of n vertical layers. This case is much more complex but if we are satisfied with a first order precision model the equal strength model can be used by averaging the plume strengths (Carrilho da Graça, 2003). Even in a case where all plumes are of equal strength, nearby plumes may coalesce. Plumes that are less than 0.5 meters apart at their source will coalesce within 2 meters (Kaye & Linden,2004).

As the complexity of the physical systems modeled increases some limitations must be imposed. In particular, the biggest challenge remains the interaction between wall driven boundary layers (positively and negatively buoyant) and displacement flows. For this reason, the model that is developed below is not applicable when:

1.    Downward moving buoyancy driven airflow rate is of the same order of magnitude as plume driven flow (these airflow currents are typically generated on lateral surfaces or in the ceiling whenever these surfaces are much cooler than the room air).

2.    Upward moving wall or floor generated buoyancy flux in the lower layer is of the same order of magnitude as plume driven flow.

Although these limitations are significant it is important to note that even in the presence of dominant convection from the floor surface, a buoyancy, two layer flow can be established whenever the plume buoyancy flux is more than 1/7 of the horizontal flux (Hunt *et al.* 2002). A two layer structure can also originate when the only heat source is a heated portion of the room floor, as long as the heated area does not exceed 15% of the room floor (Holford *et al.* 2002).

For the case of multiple non-coalescing plumes (n), with equal strength, the total vertical airflow for a given height is:

<div>$$\mathop V\limits^\cdot   = Cn{B^{{\raise0.5ex\hbox{$\scriptstyle 1$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle 3$}}}}{z^{{\raise0.5ex\hbox{$\scriptstyle 5$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle 3$}}}}$$</div>

resulting in a mixed layer height of:

<div>$$h = \frac{{24.55{F^{{\raise0.5ex\hbox{$\scriptstyle 3$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle 5$}}}}}}{{{{\left( {{n^3}\dot Q} \right)}^{{\raise0.5ex\hbox{$\scriptstyle 1$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle 5$}}}}}}$$</div>

#### Implementation

The model predicts three temperatures that characterize the three main levels in the stratification of the room:

1.    a floor level temperature T<sub>floor</sub> to account for the heat transfer from the floor into the supply air

2.    an occupied subzone temperature T<sub>oc</sub> representing the temperature of the occupied region;

3.    an upper level temperature T<sub>mx</sub> representing the temperature of the upper, mixed region and the outflow temperature.

We assume that the model for multiple, equal strength plumes (equations and will be adequate for our calculations. The supply air flow rate <span>$\dot V$</span> is obtained by summing all the air flows entering the zone: supply air, infiltration, ventilation, and inter-zone flow. The heat gain <span>$\dot Q$</span> is estimated by summing all the convective internal gains located in the occupied subzone – task lights, people, equipment – and dividing this power equally among the n plumes. With these assumptions we can describe the implementation.

The UCSD DV model is controlled by the subroutine *ManageUCSDDVModel* which is called from the *RoomAirModelManager*. The *RoomAirModelManager* selects which zone model will be used for each zone.

The calculation is done in subroutine *CalcUCSDDV*. First we calculate the convective heat gain going into the upper and lower regions.

<div>$$
  \dot Q_{ocz} = \dot Q_{oc,conv} + \dot Q_{tl,conv} + \dot Q_{eleq,conv} + \dot Q_{gaseq,conv} + \dot Q_{otheq,conv} + \dot Q_{hw,conv} + \dot Q_{stmeq,conv} + \dot Q_{bb,conv}
$$</div>

<div>$${\dot Q_{mxz}} = {\dot Q_{gl,conv}} + {\dot Q_{ltp}} + {\dot Q_{htrad,conv}}$$</div>

<div>$${\dot Q_{tot,conv}} = {\dot Q_{ocz}} + {\dot Q_{mxz}}$$</div>

Next we sum up the inlet air flows in the form of MCP (mass flow rate times the air specific heat capacity) and MCPT (mass flow rate times C<sub>p</sub> times air temperature).

<div>$$MC{P_{zone}} = MC{P_i} + MC{P_{vent}} + MC{P_{mix}}$$</div>

<div>$$MC{P_{sys}} = \sum\limits_{inlets} {{{\dot m}_i}} {C_{p,i}}$$</div>

<div>$$MC{P_{tot}} = MC{P_{zone}} + MC{P_{sys}}$$</div>

<div>$$MCP{T_{zone}} = MCP{T_i} + MCP{T_{vent}} + MCP{T_{mix}}$$</div>

<div>$$MCP{T_{sys}} = \sum\limits_{inlets} {{{\dot m}_i}} {C_{p,i}}{T_i}$$</div>

<div>$$MCP{T_{tot}} = MCP{T_{zone}} + MCP{T_{sys}}$$</div>

The number of plumes per occupant <span>${N_{plumesperpers}}$</span> is a user input. The total number of plumes in the zone is:

<div>$${N_{plumes}} = {N_{occ}} \cdot {N_{plumesperperson}}$$</div>

The gains fraction <span>$F{r_{gains}}$</span>is a user input via a schedule. It is the fraction of the convective gains in the occupied subzone that remain in that subzone. Using this we calculate the total power in the plumes and the power per plume.

<div>$${\dot Q_{plumes}} = (1 - F{r_{gains}}) \cdot {\dot Q_{tot,conv}}$$</div>

<div>$${\dot Q_{perplume}} = {\dot Q_{plumes}}/{N_{plumes}}$$</div>

We now make an initial estimate of the height fraction *Fr<sub>hb</sub>* (height of the boundary layer divided by the total zone height).

<div>$$F{r_{hb}} = \left( {{{24.55} \mathord{\left/ {\vphantom {{24.55} {{H_{ceil}}}}} \right. } {{H_{ceil}}}}} \right){\left( {\frac{{0.000833 \cdot MC{P_{tot}}}}{{{N_{plumes}} \cdot \dot Q_{perplume}^{1/3}}}} \right)^{3/5}}$$</div>

where 0.000833  = <span>$1/({\rho_{air}} \cdot {c_{p,air}})$</span>converts <span>$MC{P_{tot}}$</span> to a volumetric flow rate. Next we iterate over the following 3 steps.

#### Iterative procedure

1.    Call subroutine *HcUCSDDV* to calculate a convective heat transfer coefficient for each surface in the zone, an effective air temperature for each surface, and HA<sub>mx</sub>, HAT<sub>mx</sub>, HA<sub>oc</sub>, HAT<sub>oc</sub>, HA<sub>fl</sub>, and HAT<sub>fl</sub>. Here HA is <span>$\sum\limits_{surfaces} {{h_{c,i}}}  \cdot {A_i}$</span> for a region and HAT is <span>$\sum\limits_{surfaces} {{h_{c,i}}}  \cdot {A_i} \cdot {T_i}$</span> for a region. The sum is over all the surfaces bounding the region; <span>${h_{c,i}}$</span> is the convective heat transfer coefficient for surface i, <span>${A_i}$</span> is the area of surface i,  and <span>${T_i}$</span> is the surface temperature of surface i.

2.    Recalculate <span>$F{r_{hb}}$</span> using the equation .

3.    Calculate the three subzone temperatures: *T<sub>floor,</sub> T<sub>oc</sub>* and *T<sub>mx</sub>*.

The h<sub>c</sub>’s calculated in step 1 depend on the subzone temperatures and the boundary layer height. In turn the subzone temperatures depend on the HA and HAT’s calculated in step 1. Hence the need for iteration

Next we describe each steps 1 and 3 in more detail.

#### Step 1

Subroutine *HcUCSDDV* is quite straightforward. It loops through all the surfaces in each zone and decides whether the surface is located in the upper, mixed subzone or the lower, occupied subzone, or if the surface is in both subzones. If entirely in one subzone the subzone temperature is stored in the surface effective temperature variable *TempEffBulkAir(SurfNum)* and h<sub>c</sub> for the surface is calculated by a call to subroutine *CalcDetailedHcInForDVModel*. This routine uses the “detailed” natural convection coefficient calculation that depends on surface tilt and <span>$\Delta {T^{1/3}}$</span>. This calculation is appropriate for situations with low air velocity.

For surfaces that bound 2 subzones, the subroutine calculates h<sub>c</sub> for each subzone and then averages them, weighting by the amount of surface in each subzone.

During the surface loop, once the h<sub>c</sub> for a surface is calculated, the appropriate subzone HA and HAT sums are incremented. If a surface is in 2 subzones the HA and HAT for each subzone are incremented based on the area of the surface in each subzone.

#### Step 3

The calculation of  subzone temperatures follows the method used in the ***ZoneTempPredictorCorrector*** module and described in the section **Basis for the System and Zone Integration**. Namely a third order finite difference expansion of the temperature time derivative is used in updating the subzone temperatures. Otherwise the subzone temperatures are obtained straightforwardly by solving an energy balance equation for each subzone.

<div>$$
  T_{fl} = (C_{air,fl} \cdot (3 \cdot T_{ - 1,fl} - (3/2) \cdot T_{ - 2,fl} + (1/3) \cdot T_{ - 3,fl}) + HAT_{fl} + MCPT_{tot})  / ((11/6) \cdot C_{air,fl} + HA_{fl} + MCP_{tot})
$$</div>

<div>$$
  \begin{array}{l}
    T_{oc} = (C_{air,oc} \cdot (3 \cdot T_{ - 1,oc} - (3/2) \cdot T_{ - 2,oc} + (1/3) \cdot T_{ - 3,oc}) + \dot Q_{ocz} \cdot Fr_{gains} + HAT_{oc} + T_{fl} \cdot MCP_{tot}) / (11/6) \cdot C_{air,oc} + HA_{oc} + MCP_{tot})
    T_{mx} = (C_{air,mx} \cdot (3 \cdot T_{ - 1,mx} - (3/2) \cdot T_{ - 2,mx} + (1/3) \cdot T_{ - 3,mx}) + \dot Q_{ocz} \cdot (1 - Fr_{gains}) + \dot Q_{mxz} + HAT_{mx} + T_{oc} \cdot MCP_{tot}) / ((11/6) \cdot C_{air,mx} + HA_{mx} + MCP_{tot})
  \end{array}
$$</div>

Here <span>${C_{air,fl}}$</span>, <span>${C_{air,oc}}$</span>, and <span>${C_{air,mx}}$</span> are the heat capacities of the air volume in each subzone. <span>${C_{air,mx}}$</span> is calculated by

<div>$${R_{air,mx}} = {V_{mx}} \cdot (\Delta {z_{mx}}/{z_{ceil}}) \cdot {\rho_{air,mx}} \cdot {c_{p,air,mx}} \cdot Mu{l_{cap}}/(\Delta {t_z} \cdot 3600)$$</div>

<div>$${C_{air,mx}} = {R_{air,mx}} \cdot \Delta {t_z}/\Delta {t_{sys}}$$</div>

The other subzone air heat capacities are calculated in the same manner.

#### Mixed calculation

The above iterative procedure assumed that displacement ventilation was taking place: i.e., conditions were favorable temperature stratification in the zone. Now that this calculation is complete and the subzone temperatures and depths calculated, we check to see if this assumption was justified. If not, zone conditions must be recalculated assuming a well-mixed zone.

If <span>${T_{mx}} < {T_{oc}}$</span> or <span>$MC{P_{tot}} \le 0$</span> or <span>${H_{fr}} \cdot {H_{ceil}} < {H_{fl,top}} + \Delta {z_{occ,\min }}$</span> then the following mixed calculation will replace the displacement ventilation calculation.

**Note:**  <span>$\Delta {z_{occ,\min }}$</span> is the minimum thickness of occupied subzone. It is set to 0.2 meters. <span>${H_{fl,top}}$</span>is the height of the top of the floor subzone. It is defined to be 0.2 meters; that is, the floor subzone is always 0.2 meters thick and <span>${T_{fl}}$</span> is the temperature at 0.1 meter above the floor surface.

The mixed calculation iteratively calculates surface convection coefficients and room temperature just like the displacement ventilation calculation described above. In the mixed case however, only one zone temperature *T<sub>avg</sub>* is calculated. The 3 subzone temperatures are then set equal to *T<sub>avg</sub>*.

First, *Fr<sub>hb</sub>*  is set equal to zero.

Then the code iterates over these steps.

1.    Calculate *T<sub>avg</sub>* using

<div>$$
  T_{avg} = (C_{air,z} \cdot (3 \cdot T_{ - 1,z} - (3/2) \cdot T_{ - 2,z} + (1/3) \cdot T_{ - 3,z}) + \dot Q_{tot,conv} + HAT_{oc} + HAT_{mx} + HAT_{fl} + MCPT_{tot}) / ((11/6) \cdot C_{air,z} + HA_{oc} + HA_{mx} + HA_{fl} + MCP_{tot})
$$</div>

<div>$${T_{mx}} = {T_{avg}}$$</div>

<div>$${T_{oc}} = {T_{avg}}$$</div>

<div>$${T_{fl}} = {T_{avg}}$$</div>

2.    Call *HcUCSDDV* to calculate the *h<sub>c</sub>*’s.

3.    Repeat step 1

#### Final calculations

The displacement ventilation calculation finishes by calculating some report variables. Using equation , setting the boundary height to 1.5 meters and solving for the flow, we calculate a minimum flow fraction:

<div>$${\dot V_{\min }} = {(1.5/{\rm{24}}{\rm{.55)}}^{{\rm{5/3}}}} \cdot {N_{plumes}} \cdot \dot Q_{perplume}^{1/3}$$</div>

<div>$$F{r_{\min flow}} = .000833 \cdot MC{P_{tot}}/{\dot V_{\min }}$$</div>

We define heights:

<div>$${H_{trans}} = F{r_{hb}} \cdot {H_{ceil}}$$</div>

<div>$${H_{mxavg}} = ({H_{ceil}} + {H_{trans}})/2$$</div>

<div>$${H_{ocavg}} = ({H_{fltop}} + {H_{trans}})/2$$</div>

<div>$${H_{flavg}} = {H_{fltop}}/2$$</div>

Using the user defined comfort height we calculate the comfort  temperature.

If mixing:

<div>$${T_{comf}} = {T_{avg}}$$</div>

If displacement ventilation:

If *H<sub>comf</sub>* &lt; *H<sub>flavg</sub>*

<div>$${T_{comf}} = {T_{fl}}$$</div>

Else if <span>${H_{comf}} \ge {H_{flavg}}$</span> and <span>${H_{comf}} < {H_{ocavg}}$</span>

<div>$${T_{comf}} = ({T_{fl}}({H_{ocavg}} - {H_{comf}}) + {T_{mx}}({H_{comf}} - {H_{flavg}})/({H_{ocavg}} - {H_{flavg}})$$</div>

Else if <span>${H_{comf}} \ge {H_{ocavg}}$</span> and <span>${H_{comf}} < {H_{mxavg}}$</span>

<div>$${T_{comf}} = ({T_{oc}}({H_{mxavg}} - {H_{comf}}) + {T_{mx}}({H_{comf}} - {H_{ocavg}})/({H_{mxavg}} - {H_{ocavg}})$$</div>

Else if <span>${H_{comf}} \ge {H_{mxavg}}$</span> and <span>${H_{comf}} < {H_{ceil}}$</span>

<div>$${T_{comf}} = {T_{mx}}$$</div>

Using the user defined thermostat height we calculate the temperature at the thermostat.

If mixing:

<div>$${T_{stat}} = {T_{avg}}$$</div>

If displacement ventilation:

If *H<sub>stat</sub>* &lt; *H<sub>flavg</sub>*

<div>$${T_{stat}} = {T_{fl}}$$</div>

Else if <span>${H_{stat}} \ge {H_{flavg}}$</span> and <span>${H_{stat}} < {H_{ocavg}}$</span>

<div>$${T_{stat}} = ({T_{fl}}({H_{ocavg}} - {H_{stat}}) + {T_{mx}}({H_{stat}} - {H_{flavg}})/({H_{ocavg}} - {H_{flavg}})$$</div>

Else if <span>${H_{stat}} \ge {H_{ocavg}}$</span> and <span>${H_{stat}} < {H_{mxavg}}$</span>

<div>$${T_{stat}} = ({T_{oc}}({H_{mxavg}} - {H_{stat}}) + {T_{mx}}({H_{stat}} - {H_{ocavg}})/({H_{mxavg}} - {H_{ocavg}})$$</div>

Else if <span>${H_{stat}} \ge {H_{mxavg}}$</span> and <span>${H_{stat}} < {H_{ceil}}$</span>

<div>$${T_{stat}} = {T_{mx}}$$</div>

The average temperature gradient is:

If <span>${H_{mxavg}} - {H_{flavg}} > 0.1$</span>

<div>$$Grad{T_{avg}} = ({T_{mx}} - {T_{fl}})/({H_{mxavg}} - {H_{flavg}})$$</div>

else <div>$$Grad{T_{avg}} =  - 9.999$$</div>

The maximum temperature gradient is:

If  <span>${H_{ocavg}} - {H_{flavg}} > 0.1$</span>

<div>$$Grad{T_{\max ,1}} = ({T_{oc}} - {T_{fl}})/({H_{ocavg}} - {H_{flavg}})$$</div>

else <span>$Grad{T_{\max ,1}} =  - 9.999$</span>

If  <span>${H_{mxavg}} - {H_{ocavg}} > 0.1$</span>

<div>$$Grad{T_{\max ,2}} = ({T_{mx}} - {T_{oc}})/({H_{mxavg}} - {H_{ocavg}})$$</div>

else <span>$Grad{T_{\max ,2}} =  - 9.999$</span>
 and

<div>$$Grad{T_{\max }} = \max (Grad{T_{\max ,1}},Grad{T_{\max ,2}})$$</div>

For reporting purposes, if the zone is deemed to be mixed, the displacement ventilation report variables are set to flag values.

If <span>${T_{mx}} < {T_{oc}}$</span> or <span>$MC{P_{tot}} \le 0$</span> or <span>${H_{fr}} \cdot {H_{ceil}} < {H_{fl,top}} + \Delta {z_{occ,\min }}$</span> or <span>${T_{mx}} - {T_{oc}} < \Delta {T_{Crit{\mathop{\rm Re}\nolimits} p}}$</span>

<div>$$Grad{T_{avg}} =  - 9.999$$</div>

<div>$$Grad{T_{\max }} =  - 9.999$$</div>

<div>$$F{R_{\min ,flow}} =  - 1.0$$</div>

<div>$${H_{trans}} =  - 9.999$$</div>

Finally, the zone node temperature is set to *T<sub>mx</sub>*.

#### References

Carrilho da Graca, G. 2003. Simplified models for heat transfer in rooms. Ph. D. Thesis, University of California, San Diego.

Chen, Q., and B. Griffith. 2002. Incorporating Nodal Room Air Models into Building Energy Calculation Procedures. ASHRAE RP-1222 Final Report.

Cooper, P. and P.F. Linden. 1996. Natural ventilation of an enclosure containing two buoyancy sources. Journal of Fluid Mechanics, Vol. 311, pp. 153-176.

Dominique, M. and P. Guitton. 1997.  Validation of displacement ventilation simplified models. Proc. of Building Simulation.

Holford, J.M., G.R. Hunt and P.F. Linden. 2002. Competition between heat sources in a ventilated space. Proceedings of RoomVent 2002, pp. 577-580.

Hunt, G.R., J.M. Holford and P.F. Linden. 2002. Characterization of the flow driven by a finite area heat source in a ventilated enclosure. Proceedings of RoomVent 2002, pp.  581-584.

Hunt, G.R. and P.F. Linden.  2001. Steady-state flows in an enclosure ventilated by buoyancy forces assisted by wind. . Journal of Fluid Mechanics, Vol. 426,  pp. 355-386.

Kaye, K.N. and P.F. Linden.  2004. Coalescing axisymmetric turbulent plumes*.* Journal of Fluid Mechanics,  Vol. 502, pp. 41--63.

Linden, P.F., G.F. Lane-Serff and D.A. Smeed. 1990. Emptying filling boxes: the fluid mechanics of natural ventilation. Journal of Fluid Mechanics, Vol. 212, pp. 309-335.

Linden, P.F. and P. Cooper. 1996. Multiple sources of buoyancy in a naturally ventilated enclosure. Journal of Fluid Mechanics, Vol. 311, pp. 177-192.

Morton, B.R., G.I. Taylor andJ.S. Turner. 1956. Turbulent gravitational convection from maintained and instantaneous sources. Proceedings of the Royal Society of London, Vol A234, pp. 1-23.

Mundt, E. 1996. The Performance of Displacement Ventilation Systems – Experimental and Theoretical Studies, Ph. D. Thesis, Bulletin N38, Building Services Engineering KTH, Stockholm.

Rees, S.J., and P. Haves. 2001. A nodal model for displacement ventilation and chilled ceiling systems in office spaces. Building and Environment, Vol. 26, pp. 753-762.

### Under-Floor Air Distribution Interior Zone Model

#### Overview

The input object RoomAirSettings:UnderFloorAirDistributionInterior provides a simple model for heat transfer and nonuniform vertical temperature profile for interior zones of a UFAD system. These zones are expected to be dominated by internal loads, a portion of which (such as occupants and workstations) will act to generate plumes. The plumes act to potentially create room air stratification, depending on the type & number of diffusers, the amount and type of load, and the system flowrate. In order to better model this situation the fully-mixed room air approximation that is currently used in most whole building analysis tools is extended to a two node approach, with the purpose of obtaining a first order precision model for vertical temperature profiles for the interior zones of UFAD systems. The use of 2 nodes allows for greatly improved prediction of thermal comfort and overall building energy performance for the increasingly popular UFAD systems.

TheUCSD UFAD Interior Zone Model is one of the non-uniform zone models provided through the Room Air Manager in EnergyPlus. The intent is to provide a selection of useful non-uniform zone air models to enable the evaluation of air-conditioning techniques that use stratified or partially stratified room air. Such techniques include displacement ventilation (DV) and underfloor air distribution (UFAD) systems. The methodology can also include natural displacement ventilation and also wind-driven cross-ventilation (CV).

#### Underfloor air distribution systems

UFAD systems represent, in terms of room air stratification, an intermediate condition between a well-mixed zone and displacement ventilation. Air is supplied through an underfloor plenum at low pressure through diffusers in the raised floor. The diffusers can be of various types: e.g., swirl, variable-area, displacement, and produce more or less mixing in the zone. UFAD systems are promoted as saving energy due to: higher supply air temperature; low static pressure; cooler conditions in the occupied subzone than in the upper subzone; and sweeping of some portion of the convective load (from ceiling lights, for instance) into the return air without interaction with the occupied region of the zone.

Modeling a UFAD system is quite complex and involves considerably more than just a non-uniform zone model. The zones’ coupling to the supply and return plenums must be modeled accurately (particularly radiative transfer from a warm ceiling to a cool floor and on into the supply plenum by conduction). The supply plenum must be accurately modeled, giving a good estimate of the supply air temperature and conduction heat transfer between supply & return plenums through the slab. The HVAC system must be modeled including return air bypass and various types of fan powered terminal units.

The UCSD UFAD interior zone model is similar to the UCSD DV model. The most obvious difference is that the UFAD model has no separate near-floor subzone. Like the UCSD DV model it is a plume equation based multi-layer model (2 layers in this case). The zone is modeled as being divided into 2 well separated subzones which we denote as “occupied” and “upper”. Each subzone is treated as having a single temperature. The boundary between the 2 subzones moves up & down each time step as a function of zone loads and supply air flow rate. Thus at each HVAC time step, the height of the boundary above the floor must be calculated, portions of surfaces assigned to each subzone, and a separate convective heat balance performed on each subzone.

#### Model Description

The UFAD interior zone model is based upon non-dimensional analysis of the system and using the non-dimensional description to make a comparison between full-scale UCB test chamber data & small-scale UCSD salt tank measurements.

In order to do the non-dimensional comparisons, we need to define two dimensionless parameters. One is <span>$\Gamma $</span>, and the other is <span>$\phi $</span>. Lin & Linden (Lin & Linden, 2005) showed that in a UFAD system, the buoyancy flux of the heat source <span>$(B)$</span>and the momentum flux of the cooling jets <span>$(M)$</span>are the controlling parameters on the stratification. Since <span>$[B] = {L^4}{T^{ - 3}}$</span>and<span>$[M] = {L^4}{T^{ - 2}}$</span>, we can have a length scale as <span>${M^{3/4}}/{B^{1/2}}$</span>.

*Definition of* *Gfor the single-plume single-diffuser basic model*

We observed, in our small-scale experiments, that the total room height does not affect the interface position, or the height of the occupied zone. In other words, *H* might not be the critical length scale for the stratification. Therefore, we started to use <span>$\sqrt A $</span> as the reference length. Then <span>$\Gamma $</span>is defined as

<div>$$\Gamma  = \frac{{{M^{3/4}}}}{{{B^{1/2}}{A^{1/2}}}} = \frac{{{{({Q^2}/A)}^{3/4}}}}{{{B^{1/2}}{A^{1/2}}}} = \frac{{{Q^{3/2}}}}{{{A^{5/4}}{B^{1/2}}}}$$</div>

*Definition for multi-diffuser and multi-source cases*

We only considered single-diffuser, single-source cases in above analysis. Suppose there are *n* equal diffusers and *m* equal heat sources in a UFAD room. We shall divide the number of diffusers up into a number of separate heat sources so that each subsection with *n’=n/m* diffusers per heat source will have the same stratification as other subsections. Further, the air flow and the heat load into the subsection *Q’* and *B’* will be<span>$Q' = Q/m$</span><span>$B' = B/m$</span>respectively, where *Q’* and *B’* are the total air flow and the total heat load for the entire UFAD space. Then the momentum flux each diffuser per heat source carries is<span>${M_d} = {(\frac{1}{{n'}}Q')^2}/A$</span>. will be modified as

<div>$$\Gamma  = \frac{{{{(n'{M_d})}^{3/4}}}}{{B{'^{1/2}}\sqrt {n'A} }} = \frac{{Q{'^{3/2}}}}{{{{(n'A)}^{5/4}}B{'^{1/2}}}} = \frac{{{Q^{3/2}}}}{{m{{(n'A)}^{5/4}}{B^{1/2}}}}$$</div>

*Full-scale cases*

Because *B* is the buoyancy flux of the heat sources and *M* is the momentum flux of the cooling jets, in a real full-scale room, we shall consider the total room net heat load (plume heat input, minus the room losses) and the total net flow rate coming from the diffusers (input room air flow, minus the room leakage). Further, if the diffuser is swirl type, the vertical momentum flux should be used.

<div>$$\Gamma  = \frac{{{{(Q\cos \theta )}^{3/2}}}}{{m{{(n'A)}^{5/4}}{{(0.0281W)}^{1/2}}}}$$</div>

where, *Q* is the net flow rate coming out from all diffusers (m<sup>3</sup>/s); *W* is the total net heat load (kW); *A* is the effective area of each diffuser (m<sup>2</sup>); *n’* is the number of diffusers per heat source; *q* is the angle between the diffuser slots and the vertical direction and *m* is the number of heat sources

*Definition of* *F*

In our theoretical model, two-layer stratification forms at steady state, provided that each diffuser carries the same momentum flux, and each heat source has the same heat load. We could define a dimensionless parameter *F*, which indicates the strength of stratification.

*Small-scale cases*

In our salt-water tank experiments, fluid density *r* is measured. Define that

<div>$$\phi  = \frac{{{\rho_u} - {\rho_l}}}{{{\rho_u} - {\rho_o}}}$$</div>

where, *r<sub>u</sub>* and *r<sub>l</sub>* are the fluid density of the upper layer and lower layer, separately; and *r<sub>o</sub>* is the source density at the diffusers.

Therefore, *r<sub>l</sub>* =*r<sub>o</sub>* gives *f*=*1*, which means the largest stratification (displacement ventilation case); *r<sub>l</sub>* =*r<sub>u</sub>* leads to *f*=*0*, in which case there is no stratification (mixed ventilation case).

*Full-scale cases*

Similarly, we can define *f* for full-scale cases by using temperature.

<div>$$\phi  = \frac{{{T_r} - {T_{oz}}}}{{{T_r} - {T_s}}}$$</div>

where *T<sub>r</sub>*, *T<sub>oz</sub>*, and *T<sub>s</sub>* are the return air temperature, the occupied zone temperature and the supply temperature, respectively (K). Again *f=1* occurs in displacement ventilation; while *f=0* happens in mixed ventilation.

*Comparisons between full-scale UCB data and small-scale UCSD data*

![](EngineeringReference/media/image2469.png)

Figure 133. Data comparisons in the non-dimensional (a) regular G-fplot

![](EngineeringReference/media/image2470.png)

Figure 134. (b) log-log G-fplot.}

The figures (Figure 133. Data comparisons in the non-dimensional (a) regular G-fplot and Figure 134. (b) log-log G-fplot.} show the comparisons between UCB's data and the UCSD salt tank data in the *G-f* plot. As seen in the figures, the full-scale and small-scale data are on the same trend curve. This provides the evidence that the salt-tank experiments have included most characteristics of a UFAD system. Note that big *G* (&gt;20) of UCB's experiments all have large DDR (from *1.19* to *2.18*). The largest DDR (*2.18*) even gives a negative<span>$({T_r} - {T_{oz}})/({T_r} - {T_s})$</span>, which is NOT shown in the figures.)

We could work out the occupied zone temperature by using the least-square fitting line suggested in figure 1(b). Hence the interface height is needed to determine a entire two-layer stratification. Figure 135 shows the dimensionless interface height<span>$(h/\sqrt {n'A} )$</span>of the UCSD small-scale experiments plotted against *G*. Note that for the experiments with elevated heat source, the interface heights have been modified by<span>$h' = h - \frac{1}{2}{h_s}$</span> where *h<sub>s</sub>* is the vertical position of the elevated heat source. All data then are located along a line in Figure 135. Since the salt-tank experiments are concluded to represent important characteristics of a full-scale UFAD room, this figure provides some guidelines for estimate the interface position in a real UFAD room.

![](EngineeringReference/media/image2474.png)

Figure 135. Non-dimensional interface height of small-scale experiments.

*Formulas for EnergyPlus based on the dimensionless parameter* *G*

If we have input including the supply temperature *T<sub>s</sub>* (K); the number of diffusers *n*; the number of heat sources *m*; the vertical position of the heat sources *h<sub>s</sub>* (m); the heat load *W* (kW); the effective area of a diffuser *A* (m<sup>2</sup>); and the total supply air flow rate *Q* (m<sup>3</sup>/s) then the output will be

<div>$${T_r} = \frac{{0.0281W}}{{Qg}}{T_s} + {T_s}$$</div>

<div>$${T_{oz}} = {T_r} - 1.6{\Gamma ^{ - 0.76}}({T_r} - {T_s})$$</div>

<div>$$h = \sqrt {\frac{n}{m}A} (7.43ln(\Gamma ) - 1.35) + \frac{1}{2}{h_s}$$</div>

where *T<sub>r</sub>* is the return temperature (K); *T<sub>oz</sub>* is the occupied subzone temperature (K); *h* is the interface height (m); and *G* is defined above.

#### Implementation

The implementation closely follows the procedure described in the displacement ventilation zone model. The model predicts two temperatures that characterize the two main levels in the stratification of the room:

1.    an occupied subzone temperature T<sub>oc</sub> representing the temperature of the occupied region;

2.    an upper level temperature T<sub>mx</sub> representing the temperature of the upper, mixed region and the outflow temperature.



We will use to calculate the interface height and do a heat balance calculation on each subzone. *G* is given by . The supply air flow rate <span>$\dot V$</span> is obtained by summing all the air flows entering the zone: supply air, infiltration, ventilation, and inter-zone flow. The heat gain <span>$\dot Q$</span> is estimated by summing all the convective internal gains located in the occupied subzone – task lights, people, equipment – and dividing this power equally among the n plumes. With these assumptions we can describe the implementation.

The UCSD UFI model is controlled by the subroutine *ManageUCSDUFModels* which is called from the *RoomAirModelManager*. The *RoomAirModelManager* selects which zone model will be used for each zone.

The calculation is done in subroutine *CalcUCSDUI*. First we calculate the convective heat gain going into the upper and lower regions.

<div>$$
  \dot Q_{ocz} = \dot Q_{oc,conv} + \dot Q_{tl,conv} + \dot Q_{eleq,conv} + \dot Q_{gaseq,conv} + \dot Q_{otheq,conv} + \dot Q_{hw,conv} + \dot Q_{stmeq,conv} + \dot Q_{bb,conv} + \dot Q_{waterheater,conv} + \dot Q_{fuelcell,conv}
$$</div>

<div>$${\dot Q_{mxz}} = {\dot Q_{gl,conv}} + {\dot Q_{ltp}} + {\dot Q_{htrad,conv}}$$</div>

<div>$${\dot Q_{tot,conv}} = {\dot Q_{ocz}} + {\dot Q_{mxz}}$$</div>

Next we sum up the inlet air flows in the form of MCP (mass flow rate times the air specific heat capacity) and MCPT (mass flow rate times C<sub>p</sub> times air temperature).

<div>$$MC{P_{zone}} = MC{P_i} + MC{P_{vent}} + MC{P_{mix}}$$</div>

<div>$$MC{P_{sys}} = \sum\limits_{inlets} {{{\dot m}_i}} {C_{p,i}}$$</div>

<div>$${\dot m_{systot}} = \sum\limits_{inlets} {{{\dot m}_i}} $$</div>

<div>$$MC{P_{tot}} = MC{P_{zone}} + MC{P_{sys}}$$</div>

<div>$$MCP{T_{zone}} = MCP{T_i} + MCP{T_{vent}} + MCP{T_{mix}}$$</div>

<div>$$MCP{T_{sys}} = \sum\limits_{inlets} {{{\dot m}_i}} {C_{p,i}}{T_i}$$</div>

<div>$$MCP{T_{tot}} = MCP{T_{zone}} + MCP{T_{sys}}$$</div>

The number of plumes per occupant <span>${N_{plumesperpers}}$</span> is a user input. The total number of plumes in the zone is:

<div>$${N_{plumes}} = {N_{occ}} \cdot {N_{plumesperperson}}$$</div>

Using this we calculate the total power in the plumes and the power per plume.

<div>$${\dot Q_{plumes}} = {\dot Q_{ocz}}$$</div>

<div>$${\dot Q_{perplume}} = {\dot Q_{plumes}}/{N_{plumes}}$$</div>

The number of diffusers per plumes is also a user input. To obtain the number of diffusers in the zone:

<div>$${N_{diffusers}} = {N_{plumes}}\cdot {N_{diffusersperplume}}$$</div>

The area *A<sub>diff</sub>* is also a user input. For swirl diffusers and for displacement diffusers this area is used as input. For the variable area diffusers, though, we calculate the area. We assume 400 ft/min velocity at the diffuser and a design flow rate per diffuser is 150 cfm (.0708 m<sup>3</sup>/s). The design area of the diffuser is 150 ft<sup>3</sup>/min /  400 ft/min = .575 ft<sup>2</sup> = .035 m<sup>2</sup>. Then the variable area each time step is

<div>$${A_{diff}} = {\dot m_{systot}}/(.0708\cdot {N_{diffusers}})$$</div>

We now calculate the height fraction *Fr<sub>hb</sub>* (height of boundary layer divided by the total zone height).

<div>$$\Gamma  = \frac{{{{({{\dot m}_{systot}}\cdot \cos ({\theta_{throw}}))}^{3/2}}}}{{{N_{plumes}}{{({N_{diffusersperplume}}\cdot {A_{diff}})}^{5/4}}{{(0.0281\cdot 0.001\cdot {{\dot Q}_{plumes}})}^{1/2}}}}$$</div>

<div>$$F{r_{hb}} = \frac{{{{({N_{diffusersperplume}}\cdot {A_{diff}})}^{1/2}}(7.43\ln (\Gamma ) - 1.35 + 0.5{H_s})}}{{{H_{ceil}}}}$$</div>

where *q<sub>throw</sub>* is a user input: the angle between the diffuser slots and vertical; and *H<sub>s</sub>* is the source height above the floor (m).

Next we iterate over the following 2 steps.

#### Iterative procedure

1.    Call subroutine *HcUCSDUF* to calculate a convective heat transfer coefficient for each surface in the zone, an effective air temperature for each surface, and HA<sub>mx</sub>, HAT<sub>mx</sub>, HA<sub>oc</sub>, HAT<sub>oc</sub>. Here HA is <span>$\sum\limits_{surfaces} {{h_{c,i}} \cdot {A_i}} $</span> for a region and HAT is <span>$\sum\limits_{surfaces} {{h_{c,i}} \cdot {A_i}}  \cdot {T_i}$</span> for a region. The sum is over all the surfaces bounding the region; <span>${{h_{c,i}}}$</span> is the convective heat transfer coefficient for surface i, <span>${A_i}$</span> is the area of surface i,  and <span>${T_i}$</span> is the surface temperature of surface i.

2.    Calculate the two subzone temperatures: *T<sub>oc</sub>* and *T<sub>mx</sub>*.

The h<sub>c</sub>’s calculated in step 1 depend on the subzone temperatures. In turn the subzone temperatures depend on the HA and HAT’s calculated in step 1. Hence the need for iteration

Next we describe each steps 1 and 2 in more detail.

#### Step 1

Subroutine *HcUCSDUF* is quite straightforward. It loops through all the surfaces in each zone and decides whether the surface is located in the upper, mixed subzone or the lower, occupied subzone, or if the surface is in both subzones. If entirely in one subzone the subzone temperature is stored in the surface effective temperature variable *TempEffBulkAir(SurfNum)* and h<sub>c</sub> for the surface is calculated by a call to subroutine *CalcDetailedHcInForDVModel*. This routine uses the “detailed” natural convection coefficient calculation that depends on surface tilt and <span>$\Delta {T^{1/3}}$</span>. This calculation is appropriate for situations with low air velocity.

For surfaces that bound 2 subzones, the subroutine calculates h<sub>c</sub> for each subzone and then averages them, weighting by the amount of surface in each subzone.

During the surface loop, once the h<sub>c</sub> for a surface is calculated, the appropriate subzone HA and HAT sums are incremented. If a surface is in 2 subzones the HA and HAT for each subzone are incremented based on the area of the surface in each subzone.

#### Step 2

The calculation of  subzone temperatures follows the method used in the ***ZoneTempPredictorCorrector*** module and described in the section **Basis for the System and Zone Integration**. Namely a third order finite difference expansion of the temperature time derivative is used in updating the subzone temperatures. Otherwise the subzone temperatures are obtained straightforwardly by solving an energy balance equation for each subzone.

<div>$$
  \begin{array}{cl}
    T_{oc} &= (C_{air,oc} \cdot (3 \cdot T_{ - 1,oc} - (3/2) \cdot T_{ - 2,oc} + (1/3) \cdot T_{ - 3,oc}) + \dot Q_{ocz} \cdot Fr_{gains} + HAT_{oc} + MCPT_{tot}) / ((11/6) \cdot C_{air,oc} + HA_{oc} + MCP_{tot}) \\
    T_{mx} &= (C_{air,mx} \cdot (3 \cdot T_{ - 1,mx} - (3/2) \cdot T_{ - 2,mx} + (1/3) \cdot T_{ - 3,mx}) + \dot Q_{ocz} \cdot (1 - Fr_{gains}) + \dot Q_{mxz} + HAT_{mx} + T_{oc} \cdot MCP_{tot}) / ((11/6) \cdot C_{air,mx} + HA_{mx} + MCP_{tot})
  \end{array}
$$</div>

Here <span>${C_{air,oc}}$</span> and <span>${C_{air,mx}}$</span> are the heat capacities of the air volume in each subzone. <span>${C_{air,mx}}$</span> is calculated by

<div>$${R_{air,mx}} = {V_{mx}} \cdot \left( {\Delta {z_{mx}}/{z_{ceil}}} \right) \cdot {\rho_{air,mx}} \cdot {c_{p,air,mx}} \cdot Mu{l_{cap}}/\left( {\Delta {t_z} \cdot 3600} \right)$$</div>

<div>$${c_{air,mx}} = {R_{air,mx}} \cdot \Delta {t_z}/\Delta {t_{sys}}$$</div>

The gains fraction <span>$F{r_{gains}}$</span>is a user input via a schedule. It is the fraction of the convective gains in the occupied subzone that remain in that subzone.

The other subzone air heat capacities are calculated in the same manner.

#### Mixed calculation

The above iterative procedure assumed that the UFAD nonuniform zone model was appropriate: i.e., conditions were favorable temperature stratification in the zone. Now that this calculation is complete and the subzone temperatures and depths calculated, we check to see if this assumption was justified. If not, zone conditions must be recalculated assuming a well-mixed zone.

If <span>${T_{mx}} < {T_{oc}}$</span> or <span>$MC{P_{tot}} \le 0$</span> or <span>${H_{fr}} \cdot {H_{ceil}} < \Delta {z_{occ,\min }}$</span> then the following mixed calculation will replace the UFAD interior zone calculation.

**Note:**  <span>$\Delta {z_{occ,min}}$</span> is the minimum thickness of occupied subzone. It is set to 0.2 meters.

The mixed calculation iteratively calculates surface convection coefficients and room temperature just like the displacement ventilation calculation described above. In the mixed case however, only one zone temperature *T<sub>avg</sub>* is calculated. The 3 subzone temperatures are then set equal to *T<sub>avg</sub>*.

First, *Fr<sub>hb</sub>*  is set equal to zero.

Then the code iterates over these steps.

Calculate *T<sub>avg</sub>* using

<div>$$\begin{array}{l}{T_{avg}} = ({C_{air,z}} \cdot (3 \cdot {T_{ - 1,z}} - (3/2) \cdot {T_{ - 2,z}} + (1/3) \cdot {T_{ - 3,z}}) + \\\quad \quad {{\dot Q}_{tot,conv}} + HA{T_{oc}} + HA{T_{mx}}MCP{T_{tot}})/((11/6) \cdot {C_{air,z}} + H{A_{oc}} + H{A_{mx}} + MC{P_{tot}})\end{array}$$</div>

<div>$${T_{mx}} = {T_{avg}}$$</div>

<div>$${T_{oc}} = {T_{avg}}$$</div>

Call *HcUCSDUF* to calculate the *h<sub>c</sub>*’s.

Repeat step 1

#### Final calculations

The UFAD interior zone calculation finishes by calculating some report variables.

We define heights:

<div>$${H_{trans}} = F{r_{hb}} \cdot {H_{ceil}}$$</div>

<div>$${H_{mxavg}} = \left( {{H_{ceil}} + {H_{trans}}} \right)/2$$</div>

<div>$${H_{ocavg}} = {H_{trans}}/2$$</div>

Using the user defined comfort height we calculate the comfort  temperature.

If mixing:

<div>$${T_{comf}} = {T_{avg}}$$</div>

If UFAD:

If  <span>${H_{comf}} < {H_{ocavg}}$</span>

<div>$${T_{comf}} = {T_{occ}}$$</div>

Else if <span>${H_{comf}} \ge {H_{ocavg}}$</span> and <span>${H_{comf}} < {H_{mxavg}}$</span>

<div>$${T_{comf}} = \left( {{T_{oc}}\left( {{H_{mxavg}} - {H_{comf}}} \right) + {T_{mx}}\left( {{H_{comf}} - {H_{ocavg}}} \right)} \right)/\left( {{H_{mxavg}} - {H_{ocavg}}} \right)$$</div>

Else if <span>${H_{comf}} \ge {H_{mxavg}}$</span> and <span>${H_{comf}} < {H_{ceil}}$</span>

<div>$${T_{comf}} < {T_{mx}}$$</div>

Using the user defined thermostat height we calculate the temperature at the thermostat.

If mixing:

<div>$${T_{stat}} < {T_{avg}}$$</div>

If UFAD:

If<span>${H_{stat}} < {H_{ocavg}}$</span>

<div>$${T_{stat}} = {T_{occ}}$$</div>

Else if <span>${H_{stat}} \ge {H_{ocavg}}$</span> and <span>${H_{stat}} < {H_{mxavg}}$</span>

<div>$${T_{stat}} = \left( {{T_{oc}}\left( {{H_{mxavg}} - {H_{stat}}} \right) + {T_{mx}}\left( {{H_{stat}} - {H_{ocavg}}} \right)} \right)/\left( {{H_{mxavg}} - {H_{ocavg}}} \right)$$</div>

Else if <span>${H_{stat}} \ge {H_{mxavg}}$</span> and <span>${H_{stat}} < {H_{ceil}}$</span>

<div>$${T_{stat}} = {T_{mx}}$$</div>

The average temperature gradient is:

If <span>${H_{mxavg}} - {H_{occavg}} > 0.1$</span>

<div>$$Grad{T_{avg}} = ({T_{mx}} - {T_{occ}})/({H_{mxavg}} - {H_{occavg}})$$</div>

else <span>$Grad{T_{avg}} = 0.0$</span>

Finally, the zone node temperature is set to *T<sub>mx</sub>*.

Other variables that are reported out are <span>$\Gamma $</span>and <span>$\phi $</span>.

<div>$$\phi  = ({T_{mx}} - {T_{occ}})/({T_{mx}} - {T_{sup}})$$</div>

where <span>${T_{sup}}$</span>is the zone supply air temperature.

#### References

Lin, Y.J. and P.F. Linden. 2005. A model for an under floor air distribution system. Energy&Building, Vol. 37, pp. 399-409.

### Under-Floor Air Distribution Exterior Zone Model

#### Overview

The input object RoomAirSettings:UnderFloorAirDistributionExterior provides a simple model for heat transfer and a nonuniform vertical temperature profile for exterior zones of a UFAD system. These zones are expected to be dominated by internal loads, a portion of which (such as occupants and workstations) will act to generate plumes, and by window solar and conduction heat gains. The solar radiation penetrating the room is not expected to generate plumes. However, a window plume is likely to be generated in sunny conditions, particularly if an interior blind is deployed. Thus the exterior UFAD zone will have potentially have plumes from people and equipment and plumes arising from the windows. The plumes act to potentially create room air stratification, depending on the type & number of diffusers, the amount and type of load, and the system flowrate. In order to better model this situation the fully-mixed room air approximation that is currently used in most whole building analysis tools is extended to a two node approach, with the purpose of obtaining a first order precision model for vertical temperature profiles for the exterior zones of UFAD systems. The use of 2 nodes allows for greatly improved prediction of thermal comfort and overall building energy performance for the increasingly popular UFAD systems.

TheUCSD UFAD Exterior Zone Model is one of the non-uniform zone models provided through the Room Air Manager in EnergyPlus. The intent is to provide a selection of useful non-uniform zone air models to enable the evaluation of air-conditioning techniques that use stratified or partially stratified room air. Such techniques include displacement ventilation (DV) and underfloor air distribution (UFAD) systems. The methodology can also include natural displacement ventilation and also wind-driven cross-ventilation (CV).

#### Underfloor air distribution systems

UFAD systems represent, in terms of room air stratification, an intermediate condition between a well-mixed zone and displacement ventilation. Air is supplied through an underfloor plenum at low pressure through diffusers in the raised floor. The diffusers can be of various types: e.g., swirl, variable-area, displacement, and produce more or less mixing in the zone. UFAD systems are promoted as saving energy due to: higher supply air temperature; low static pressure; cooler conditions in the occupied subzone than in the upper subzone; and sweeping of some portion of the convective load (from ceiling lights, for instance) into the return air without interaction with the occupied region of the zone.

Modeling a UFAD system is quite complex and involves considerably more than just a non-uniform zone model. The zones’ coupling to the supply and return plenums must be modeled accurately (particularly radiative transfer from a warm ceiling to a cool floor and on into the supply plenum by conduction). The supply plenum must be accurately modeled, giving a good estimate of the supply air temperature and conduction heat transfer between supply & return plenums through the slab. The HVAC system must be modeled including return air bypass and various types of fan powered terminal units.

The UCSD UFAD exterior zone model is similar to the UCSD interior zone model. The most obvious difference is that the exterior UFAD has 2 different types of plume sources: people & equipment and windows. Like the UCSD UFAD interior model it is a plume equation based multi-layer model (2 layers in this case). The zone is modeled as being divided into 2 well separated subzones which we denote as “occupied” and “upper”. Each subzone is treated as having a single temperature. The boundary between the 2 subzones moves up & down each time step as a function of zone loads and supply air flow rate. Thus at each HVAC time step, the height of the boundary above the floor must be calculated, portions of surfaces assigned to each subzone, and a separate convective heat balance performed on each subzone.

#### Model Description

As in the interior zone case, we define 2 dimensionless parameters: <span>$\Gamma $</span>and <span>$\phi $</span>. The definitions of the 2 parameters are the same as in the previous section (equations , , , , and ). As in the previous case, the experimental data can be plotted versus <span>$\Gamma $</span>and lines fitted to the data give the following formulas for occupied subzone temperature and interface height.

<div>$${T_{oz}} = {T_r} - 1.4{\Gamma ^{ - 0.6}}({T_r} - {T_s})$$</div>

<div>$$h = \sqrt {\frac{n}{m}A} (11.03ln(\Gamma ) - 10.73) + \frac{1}{2}{h_s}$$</div>

where *T<sub>oz</sub>* is the occupied subzone temperature (K); *T<sub>r</sub>* is the return temperature (K); *G* is the dimensionless height parameter defined above; *T<sub>s</sub>* is the supply temperature (K); *h* is the interface height (m); *n* is the number of diffusers; *m* is the number of heat sources; *A* is the effective area of a diffuser (m<sup>2</sup>); and *h<sub>s</sub>* is the vertical position of the heat sources (m). The formula for *T<sub>r</sub>* is the same as in the previous section.

#### Implementation

The implementation closely follows the procedure described in the UFAD interior zone model. The model predicts two temperatures that characterize the two main levels in the stratification of the room:

1.    an occupied subzone temperature T<sub>oc</sub> representing the temperature of the occupied region;

2.    an upper level temperature T<sub>mx</sub> representing the temperature of the upper, mixed region and the outflow temperature.

We will use to calculate the interface height and do a heat balance calculation on each subzone. *G* is given by . The supply air flow rate <span>$\dot V$</span> is obtained by summing all the air flows entering the zone: supply air, infiltration, ventilation, and inter-zone flow. The heat gain <span>$\dot Q$</span> is estimated by summing all the convective internal gains located in the occupied subzone – task lights, people, equipment – and adding to this the convective gain coming from the window surface. With these assumptions we can describe the implementation.

The UCSD UFE model is controlled by the subroutine *ManageUCSDUFModels* which is called from the *RoomAirModelManager*. The *RoomAirModelManager* selects which zone model will be used for each zone.

The calculation is done in subroutine *CalcUCSDUEI*. First we calculate the convective heat gain going into the upper and lower regions.

<div>$$
  \dot Q_{ocz} = \dot Q_{oc,conv} + \dot Q_{tl,conv} + \dot Q_{eleq,conv} + \dot Q_{gaseq,conv} + \dot Q_{otheq,conv} + \dot Q_{hw,conv} + \dot Q_{stmeq,conv} + \dot Q_{bb,conv} + \dot Q_{waterheater,conv} + \dot Q_{fuelcell,conv}
$$</div>

<div>$${\dot Q_{mxz}} = {\dot Q_{gl,conv}} + {\dot Q_{ltp}} + {\dot Q_{htrad,conv}}$$</div>

<div>$${\dot Q_{tot,conv}} = {\dot Q_{ocz}} + {\dot Q_{mxz}}$$</div>

Next we sum up the inlet air flows in the form of MCP (mass flow rate times the air specific heat capacity) and MCPT (mass flow rate times C<sub>p</sub> times air temperature).

<div>$$MC{P_{zone}} = MC{P_i} + MC{P_{vent}} + MC{P_{mix}}$$</div>

<div>$$MC{P_{sys}} = \sum\limits_{inlets} {{{\dot m}_i}} {C_{p,i}}$$</div>

<div>$${\dot m_{systot}} = \sum\limits_{inlets} {{{\dot m}_i}} $$</div>

<div>$$MC{P_{tot}} = MC{P_{zone}} + MC{P_{sys}}$$</div>

<div>$$MCP{T_{zone}} = MCP{T_i} + MCP{T_{vent}} + MCP{T_{mix}}$$</div>

<div>$$MCP{T_{sys}} = \sum\limits_{inlets} {{{\dot m}_i}} {C_{p,i}}{T_i}$$</div>

<div>$$MCP{T_{tot}} = MCP{T_{zone}} + MCP{T_{sys}}$$</div>

For exterior zone model, we assume one plume: <span>${N_{plumes}} = 1$</span>. The number of diffusers in the zone <span>${N_{diffusers}}$</span>is a user input.

The area *A<sub>diff</sub>* is also a user input. For swirl diffusers, linear bar grilles, and displacement diffusers this area is used as input. For the variable area diffusers, though, we calculate the area. We assume 400 ft/min velocity at the diffuser and a design flow rate per diffuser is 150 cfm (.0708 m<sup>3</sup>/s). The design area of the diffuser is 150 ft<sup>3</sup>/min /  400 ft/min = .575 ft<sup>2</sup> = .035 m<sup>2</sup>. Then the variable area each time step is

<div>$${A_{diff}} = {\dot m_{systot}}/(.0708\cdot {N_{diffusers}})$$</div>

We now make an initial estimate of the convective gain from the windows.

<div>$${\dot Q_{win,conv}} = \sum\limits_{i = 1,{n_{win}}} {{h_{c,i}}} {A_{win,i}}{T_{winsurf,i}} - {h_{c,i}}{A_{win,i}}{T_{mat}}$$</div>

Then

<div>$${\dot Q_{plumes}} = {\dot Q_{ocz}} + {\dot Q_{win,conv}}$$</div>

We now calculate the height fraction *Fr<sub>hb</sub>* (height of boundary layer divided by the total zone height).

<div>$$\Gamma  = \frac{{{{({{\dot m}_{systot}}\cdot \cos ({\theta_{throw}}))}^{3/2}}}}{{{{({N_{diffusers}}\cdot {A_{diff}})}^{5/4}}{{(0.0281\cdot 0.001\cdot {{\dot Q}_{plumes}})}^{1/2}}}}$$</div>

<div>$$F{r_{hb}} = \frac{{{{({N_{diffusers}}\cdot {A_{diff}})}^{1/2}}(11.03ln(\Gamma ) - 10.73 + 0.5{H_s})}}{{{H_{ceil}}}}$$</div>

where *q<sub>throw</sub>* is a user input: the angle between the diffuser slots and vertical; and *H<sub>s</sub>* is the source height above the floor (m).

Next we iterate over the following 2 steps.

#### Iterative procedure

1.    Call subroutine *HcUCSDUF* to calculate a convective heat transfer coefficient for each surface in the zone, an effective air temperature for each surface, and HA<sub>mx</sub>, HAT<sub>mx</sub>, HA<sub>oc</sub>, HAT<sub>oc</sub>, HA<sub>mx,win</sub>,HAT<sub>mx,win</sub>,HA<sub>oc,win</sub>,and HAT<sub>oc,win</sub>. Here HA is <span>$\sum\limits_{surfaces} {{h_{c,i}} \cdot {A_i}} $</span> for a region and HAT is <span>$\sum\limits_{surfaces} {{h_{c,i}} \cdot {A_i}}  \cdot {T_i}$</span> for a region. The sum is over all the surfaces bounding the region; <span>${h_{c,i}}$</span> is the convective heat transfer coefficient for surface i, <span>${A_i}$</span> is the area of surface i,  and <span>${T_i}$</span> is the surface temperature of surface i. Variables with the *win* subscript are summed over window surfaces only. Then the convective gain from the window is recalculated:

                              <span>${\dot Q_{win,conv}} = HA{T_{mx,win}} + HA{T_{oc,win}} - H{A_{mx,win}}{T_{mx}} - H{A_{oc,win}}{T_{oc}}$</span>

and the power in the plume is recalculated: <span>${\dot Q_{plumes}} = {\dot Q_{ocz}} + {\dot Q_{win,conv}}$</span>.

2.    Calculate the two subzone temperatures: *T<sub>oc</sub>* and *T<sub>mx</sub>*.

The h<sub>c</sub>’s calculated in step 1 depend on the subzone temperatures. In turn the subzone temperatures depend on the HA and HAT’s calculated in step 1. Hence the need for iteration

Next we describe each steps 1 and 3 in more detail.

#### Step 1

Subroutine *HcUCSDUF* is quite straightforward. It loops through all the surfaces in each zone and decides whether the surface is located in the upper, mixed subzone or the lower, occupied subzone, or if the surface is in both subzones. If entirely in one subzone the subzone temperature is stored in the surface effective temperature variable *TempEffBulkAir(SurfNum)* and h<sub>c</sub> for the surface is calculated by a call to subroutine *CalcDetailedHcInForDVModel*. This routine uses the “detailed” natural convection coefficient calculation that depends on surface tilt and <span>$\Delta {T^{1/3}}$</span>. This calculation is appropriate for situations with low air velocity.

For surfaces that bound 2 subzones, the subroutine calculates h<sub>c</sub> for each subzone and then averages them, weighting by the amount of surface in each subzone.

During the surface loop, once the h<sub>c</sub> for a surface is calculated, the appropriate subzone HA and HAT sums are incremented. If a surface is in 2 subzones the HA and HAT for each subzone are incremented based on the area of the surface in each subzone. The subroutine calculates a separate HA and HAT for the windows for use in calculating the window convective gain.

#### Step 2

The calculation of 
subzone temperatures follows the method used in the ***ZoneTempPredictorCorrector*** module and described in the section **Basis for the System and Zone Integration**. Namely a third order finite difference expansion of the temperature time derivative is used in updating the subzone temperatures. Otherwise the subzone temperatures are obtained straightforwardly by solving an energy balance equation for each subzone.

<div>$$
 \begin{array}{rl}
  T_{oc} &= (C_{air,oc} \cdot (3 \cdot T_{ - 1,oc} - (3/2) \cdot T_{ - 2,oc} + (1/3) \cdot T_{ - 3,oc}) + \dot Q_{ocz} \cdot Fr_{gains} + HAT_{oc} + MCPT_{tot})/((11/6) \cdot C_{air,oc} + HA_{oc} + MCP_{tot}) \\
  T_{mx} &= (C_{air,mx} \cdot (3 \cdot T_{ - 1,mx} - (3/2) \cdot T_{ - 2,mx} + (1/3) \cdot T_{ - 3,mx}) + \dot Q_{ocz} \cdot (1 - Fr_{gains}) + \dot Q_{mxz} + HAT_{mx} + T_{oc} \cdot MCP_{tot})/((11/6) \cdot C_{air,mx} + HA_{mx} + MCP_{tot})
 \end{array}
$$</div>

Here <span>${C_{air,oc}}$</span> and <span>${C_{air,mx}}$</span> are the heat capacities of the air volume in each subzone. <span>${C_{air,mx}}$</span> is calculated by

<div>$${R_{air,mx}} = {V_{mx}} \cdot \left( {\Delta {z_{mx}}/{z_{ceil}}} \right) \cdot {\rho_{air,mx}} \cdot {c_{p,air,mx}} \cdot Mu{l_{cap}}/\left( {\Delta {t_z} \cdot 3600} \right)$$</div>

<div>$${c_{air,mx}} = {R_{air,mx}} \cdot \Delta {t_z}/\Delta {t_{sys}}$$</div>

The gains fraction <span>$F{r_{gains}}$</span> is a user input via a schedule. It is the fraction of the convective gains in the occupied subzone that remain in that subzone.

The other subzone air heat capacities are calculated in the same manner.

#### Mixed calculation

The above iterative procedure assumed that the UFAD zone model was applicable: i.e., conditions were favorable temperature stratification in the zone. Now that this calculation is complete and the subzone temperatures and depths calculated, we check to see if this assumption was justified. If not, zone conditions must be recalculated assuming a well-mixed zone.

If <span>${T_{mx}} < {T_{oc}}$</span> or <span>$MC{P_{tot}} \le 0$</span> or <span>${H_{fr}} \cdot {H_{ceil}} < \Delta {z_{occ,\min }}$</span> then the following mixed calculation will replace the UFAD exterior zone calculation.

**Note:**  <span>${\Delta_{occ,min}}$</span> is the minimum thickness of occupied subzone. It is set to 0.2 meters.

The mixed calculation iteratively calculates surface convection coefficients and room temperature just like the displacement ventilation calculation described above. In the mixed case however, only one zone temperature *T<sub>avg</sub>* is calculated. The 2 subzone temperatures are then set equal to *T<sub>avg</sub>*.

First, *Fr<sub>hb</sub>*  is set equal to zero.

Then the code iterates over these steps.

Calculate *T<sub>avg</sub>* using

<div>$$\begin{array}{l}{T_{avg}} = ({C_{air,z}} \cdot (3 \cdot {T_{ - 1,z}} - (3/2) \cdot {T_{ - 2,z}} + (1/3) \cdot {T_{ - 3,z}}) + \\\quad \quad {{\dot Q}_{tot,conv}} + HA{T_{oc}} + HA{T_{mx}}MCP{T_{tot}})/((11/6) \cdot {C_{air,z}} + H{A_{oc}} + H{A_{mx}} + MC{P_{tot}})\end{array}$$</div>

<div>$${T_{mx}} = {T_{avg}}$$</div>

<div>$${T_{oc}} = {T_{avg}}$$</div>

Call *HcUCSDUF* to calculate the *h<sub>c</sub>*’s.

Repeat step 1

#### Final calculations

The UFAD exterior zone calculation finishes by calculating some report variables.

We define heights:

<div>$${H_{trans}} = F{r_{hb}} \cdot {H_{ceil}}$$</div>

<div>$${H_{mxavg}} = \left( {{H_{ceil}} + {H_{trans}}} \right)/2$$</div>

<div>$${H_{ocavg}} = {H_{trans}}/2$$</div>

Using the user defined comfort height we calculate the comfort  temperature.

If mixing:

<div>$${T_{comf}} = {T_{avg}}$$</div>

If UFAD:

If  <span>${H_{comf}} < {H_{ocavg}}$</span>

<div>$${T_{comf}} = {T_{occ}}$$</div>

Else if <span>${H_{comf}} \ge {H_{ocavg}}$</span> and <span>${H_{comf}} < {H_{mxavg}}$</span>

<div>$${T_{comf}} = \left( {{T_{oc}}\left( {{H_{mxavg}} - {H_{comf}}} \right) + {T_{mx}}\left( {{H_{comf}} - {H_{ocavg}}} \right)} \right)/\left( {{H_{mxavg}} - {H_{ocavg}}} \right)$$</div>

Else if <span>${H_{comf}} \ge {H_{mxavg}}$</span> and <span>${H_{comf}} < {H_{ceil}}$</span>

<div>$${T_{comf}} < {T_{mx}}$$</div>

Using the user defined thermostat height we calculate the temperature at the thermostat.

If mixing:

<div>$${T_{stat}} = {T_{avg}}$$</div>

If UFAD:

If<span>${H_{stat}} < {H_{ocavg}}$</span>

<div>$${T_{stat}} = {T_{occ}}$$</div>

Else if <span>${H_{stat}} \ge {H_{ocavg}}$</span> and <span>${H_{stat}} < {H_{mcavg}}$</span>

<div>$${T_{stat}} = \left( {{T_{oc}}\left( {{H_{mxavg}} - {H_{stat}}} \right) + {T_{mx}}\left( {{H_{stat}} - {H_{ocavg}}} \right)} \right)/\left( {{H_{mxavg}} - {H_{ocavg}}} \right)$$</div>

Else if <span>${H_{stat}} \ge {H_{mxavg}}$</span> and <span>${H_{stat}} < {H_{ceil}}$</span>

<div>$${T_{stat}} = {T_{mx}}$$</div>

The average temperature gradient is:

If <span>${H_{mxavg}} - {H_{occavg}} > 0.1$</span>

<div>$$Grad{T_{avg}} = ({T_{mx}} - {T_{occ}})/({H_{mxavg}} - {H_{occavg}})$$</div>

else <span>$Grad{T_{avg}} = 0.0$</span>

Finally, the zone node temperature is set to *T<sub>mx</sub>*.

Other variables that are reported out are <span>$\Gamma $</span>and <span>$\phi $</span>.

<div>$$\phi  = ({T_{mx}} - {T_{occ}})/({T_{mx}} - {T_{sup}})$$</div>

where <span>${T_{sup}}$</span>is the zone supply air temperature.

#### References

Qing Liu. 2006. The Fluid Dynamics of an Underfloor Air Distribution System. A PhD dissertation in Engineering Sciences (Systems Science) at UC San Diego.

### Cross Ventilation Room Air Model

#### Overview

The input object RoomAirSettings:CrossVentilation provides a simple model, developed by UCSD, for heat transfer and vertical temperature profile prediction in cross ventilated rooms. This model was developed using scaling analysis, experimental correlations, computational fluid dynamics, and approximate solutions of the Navier-Stokes equations. The model distinguishes two regions in the room, the main jet region and the recirculations, and predicts characteristic airflow velocities and average air temperatures. The model consists of a set of analytical expressions that clearly display the first order effects of room geometry and inflow characteristics on Cross Ventilation airflow and heat transfer.

#### Cross-Ventilation

The CV model is developed from analysis of the flow structure inside a cross-ventilated room, which naturally divides into distinct jet and recirculation flow regions. The flows are calculated for different room and opening geometries using CFD. Correlations with room and aperture parameters are then deduced for a characteristic temperature and velocity in the jet and recirculation regions.

The SS 2-opening model is developed from analysis of wind tunnel data for pressure and ventilation rates, correlating the flow rate with the pressure difference between the two openings, with contributions from both the mean and unsteady components. The local velocity estimate is also based on wind tunnel data, and gives the velocity as a function of wind angle.

#### Approach

With the widespread availability of air conditioning, natural ventilation became a rare feature in commercial buildings in the US. The recent resurgence of the use of natural ventilation relies on systems whose performance can be predicted and controlled, often working in conjunction with mechanical ventilation and cooling systems in hybrid ventilation configurations. In this contemporary approach natural ventilation deals with thermal and air renewal requirements in the cold and mild season and often plays a limited role in the warm season (due to the need to control indoor velocities and noise levels). Whereas traditional natural ventilation systems often use large openings (1-4m<sup>2</sup>), both recent and expected future examples tend to use smaller openings (0.2-1m<sup>2</sup>), often in multiple opening configurations that allow for efficient heat removal with controlled indoor velocities.

The modeling approach used is based on simplified solutions of the Navier Stokes equations that are integrated into scaling formulae that predict relevant flow quantities (characteristic velocities and temperatures) in distinct regions of the flow. The scaling expressions that will be developed use the principle of flow similarity: for a given room geometry and flow regime (either laminar or turbulent), the flow pattern is constant. In the present case, where the goal is to predict internal velocities using as input the inflow velocity (that can be estimated by the airflow rate predicted by the AirflowNetwork model), the principle can be stated as:

(Velocity in a given position in the room) = (Inflow velocity) × (Constant)

The constant is non-dimensional and depends on the position or room zone where the prediction is being made. For a given geometry the constant can be measured experimentally or inferred from a detailed CFD simulation. It is expected that the constant may depend on non-dimensional room geometry parameters that can be inferred from a careful analysis of the flow. The proposed CV model uses a set of CFD simulations, in conjunction with simplified solutions of the Navier Stokes equations, to obtain the constants and their dependence on room geometry features.

The updated CV model proposed in this document was developed using inlet areas *A*<sub>in</sub> and room cross-section areas *A*<sub>RM</sub> in the following range:

0.5% &lt; *A*<sub>in</sub>/*A*<sub>RM</sub> &lt; 5%

whereas the existing model used

3.2% &lt; *A*<sub>in</sub>/*A*<sub>RM</sub> &lt; 21%

The room lengths for which these models are expected to be applied range between the smallest room size of 4m and the maximum achievable CV room flushing length of 15-18m.



![](EngineeringReference/media/image2622.png)

Figure 136. Development of an axisymmetric jet from airflow through a window.

Air flows into the room through an inflow window in the form of an approximately axisymmetric jet, with characteristic diameter *L*=*A*<sub>in</sub><sup>1/2</sup>, that is confined by the room surfaces (see Figure 137). The initial portion of the jet (up to six diameters) is called the potential core and is characterized by shear layer development along the perimeter of the jet. After this phase the jet transitions into a self similar profile whose centerline velocity decays as 1/*x*', where *x*' = *x*/*D* (Awbi, 2003).

For the relevant room length range the geometries used in the two models result in:

      New model:       6 &lt; x' &lt; 60

      Existing model:             2 &lt; x' &lt; 18

The smaller openings used in the new model result in significantly more space for jet development along the room length. In all but the shortest rooms the jet will enter the fully developed stage characterized by a 1/*x*' centerline velocity decay rate. For this reason, the updated model uses the average jet velocity profile as opposed to shear layer momentum transfer.

#### Components of the flow

Figure 136 shows the schematic development of a free axisymmetric jet in an unconfined environment, and Figure 137 depicts the confinement effects. The air entrained by the jet is detrained at the outlet, creating two recirculation zones that do not exist in a free jet.

The recirculation flow is similar to the flow in a lid driven cavity, where here the driving force is the confined jet flow. Turbulent lid driven cavity flows have been shown to have self-similar velocity profiles, as shown in Figure 138.

The model is based on the hypothesis that the flow is composed of:

      A – Lid driven cavity flows (in the recirculation regions).

      B – A confined axisymmetric jet flow.

![](EngineeringReference/media/image2623.png)

Figure 137. Top view of a cross ventilated room. The air entrained by the jet is detrained at the outlet, typically creating two recirculation zones.



![](EngineeringReference/media/image2624.png)

Figure 138. Top view of one half of a cross ventilated room. The flow is approximately composed of a confined jet and two lid driven cavity flows (one on each side).

The goal of the model is to obtain the value and functional form of the constant term shown in the scaling laws for the characteristic average velocities in the two flow regions: jet and recirculation regions.

To estimate the average jet velocity we integrate along the depth of the room (including both the core region and the 1/*x*' velocity decay region) to derive an average maximum jet velocity, *V*<sub>J,m</sub>:∙

<div>$${V_{J,m}} = {U_{in}}\sqrt {{A_{in}}} \left\{ {6 + 6.3\ln \left( {{D^*}/6\sqrt {{A_{in}}} } \right)} \right\}/{D^*}$$</div>

(To allow for wind angle effects the room depth *D* has been replaced by *D*\* - see a later section.) The lid-driven cavity flow profile that characterizes the recirculation region has a maximum velocity that is approximately one half of the driving velocity, which in this case is due to the jet. For this reason we define the separation between the two regions along the virtual surface where the jet reaches 50% of its maximum, centerline, velocity.

The analysis of the flow revealed that the room containment effect leads to higher velocities for cases that combine a large inflow opening with a small room cross-section area. In order to account for this effect we propose to use the following non-dimensional scaling parameter:

<div>$${C_{RM}} = {\left( {{A_{in}}/{A_{RM}}} \right)^{1/2}}$$</div>

The expression used for the scaling of the average jet velocity is then:

<div>$${U_J} = {C_1}{C_{RM}}{V_{J,m}}$$</div>

or

<div>$${U_J} = {C_1}\frac{{{Q_{in}}}}{{\sqrt {{A_{in}}{A_{RM}}} }}\left( {{V_{J,m}}/{U_{in}}} \right)$$</div>

where the constant *C*<sub>1</sub> will be obtained from the results of a set of CFD simulations shown in the next section.

In addition to the jet velocity the characteristic recirculation flow velocity <span>${U_R}$</span> is also an interesting parameter that, according to the self-similar flow profile hypothesis shown in Figure 138, should scale with a similar expression to the one shown above for the jet (although with a different correlation constant, *C*<sub>2</sub>). The modeling hypothesis can also be tested by evaluating its capability to predict the maximum recirculation flow rate, which can be predicted by multiplying the average velocity by the room cross-section area:

<div>$${Q_R} = {C_3}\frac{{{Q_{in}}}}{{{C_{RM}}}}\left( {{V_{J,m}}/{U_{in}}} \right)$$</div>

Because of the self-similar velocity profile shape that occurs in the recirculation, the near wall velocity (used to predict forced convection) can be estimated simply by multiplying the characteristic recirculation velocity by two.

The expressions obtained apply in the turbulent regime (because the CFD simulations on which they are based are for that regime). Both velocity correlations presented below have the functional form:

<div>$$V = aX + b$$</div>

where *a* is *C*<sub>1</sub>, *C*<sub>2</sub> or *C*<sub>3</sub>, X is a velocity scale and *b* is a constant that results from the best fit. The model has a lower limit on the value of *X*: if *X* is too small the flow is no longer turbulent. This limit implies that the point *X* = 0 is never achieved, avoiding the unrealistic prediction of *V*(0)=*b*.

In addition to the velocity and airflow rate predictions described above it is also essential to predict the temperature variations in the two zones of the flow. In most cases these variations will be positive due to the internal sensible heat gains. However\`, as a result of room surface heat transfer, in some cases the variations may be negative. Analysis of the CFD simulations that are presented in the next section revealed that approximately all the exhaust air comes from the jet regions. For this reason, the heat gains affect the two regions differently:



·        Heat gains in the jet region only affect this region (no temperature increase in the recirculation regions)

·        Heat gains in the recirculations affect both jet and recirculation regions (because they must be exhausted by the jets).

In order to predict the temperature increase, heat gains were inserted into the recirculation regions for different room geometries in the set of simulations presented in the next section. The volume containing the heat gains extended over the whole depth of the room, from floor to ceiling, and in the lateral direction from halfway between the window edge and the wall all the way to the wall. Applying energy conservation principles to predict the temperature increase in the jet and recirculation region as a function of the sensible heat gains in each region (the sum of internal gains and internal surface heat transfer) we can obtain the average value of temperature increase in each region:

<div>$$\Delta {T_J} = {C_{T,J}}\frac{{q'{'_{RM}}}}{{\rho {c_p}{Q_{in}}}}$$</div>

<div>$$\Delta {T_R} = {C_{T,R}}\frac{{q'{'_{RM}}}}{{\rho {c_p}{Q_{in}}}}$$</div>

where q’’<sub>RM</sub> is the total internal heat gain for the room, r and *c*<sub>p</sub> are the density and specific heat capacity of air, respectively, and *C*<sub>T,J</sub>, *C*<sub>T,R</sub> are constants.

#### Results

Table 44 lists the cases used to develop the updated CV model, which predicts the output variables defined in Table 45 (see also Figure 139). Figure 140, Figure 141, and Figure 142 show plots of the data derived from the CFD simulations of these test cases, and the lines giving the best fit to the data. Table 46 summarizes the correlation formulae and constants. Finally, Table 47 provides estimates for the error of the correlation in each test case.

![](EngineeringReference/media/image2634.png)

Figure 139. Jet and recirculation regions in typical vertical cross-section through room (y-z plane). Jet boundary occurs where jet velocity has fallen to 50% of centerline maximum. Remainder of cross-section is treated as recirculation. Volumetric heat sources ar

Table 44. Test cases used to develop correlations

<table class="table table-striped">
  <tr>
    <th rowspan="2">Case</th>
    <th>Opening area</th>
    <th>Room width</th>
    <th>Room depth</th>
    <th>Room height</th>
  </tr>
  <tr>
    <td>A in (m 2 )</td>
    <td>W (m)</td>
    <td>D (m)</td>
    <td>H (m)</td>
  </tr>
  <tr>
    <td>1</td>
    <td>0.25</td>
    <td>6</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>2</td>
    <td>0.25</td>
    <td>11</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>3</td>
    <td>0.5</td>
    <td>9</td>
    <td>4.5</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>4</td>
    <td>0.5</td>
    <td>9</td>
    <td>6</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>5</td>
    <td>0.5</td>
    <td>6</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>6</td>
    <td>0.5</td>
    <td>9</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>7</td>
    <td>0.5</td>
    <td>11</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>8</td>
    <td>0.5</td>
    <td>13.5</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>9</td>
    <td>0.5</td>
    <td>9</td>
    <td>13.5</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>10</td>
    <td>0.5</td>
    <td>9</td>
    <td>18</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>11</td>
    <td>0.5</td>
    <td>13.5</td>
    <td>18</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>12</td>
    <td>1</td>
    <td>9</td>
    <td>9</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>13</td>
    <td>1</td>
    <td>9</td>
    <td>13.5</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td>14</td>
    <td>1</td>
    <td>9</td>
    <td>18</td>
    <td>2.3</td>
  </tr>
  <tr>
    <td colspan="5">RANGE (max:min ratio)</td>
  </tr>
  <tr>
    <td></td>
    <td>4</td>
    <td>2.25</td>
    <td>4</td>
    <td>1</td>
  </tr>
</table>

Table 45. Definitions of output variables

<table class="table table-striped">
<tr>
<th>Output variable</th>
<th>Symbol</th>
<th>Units</th>
<th>Definition</th>
</tr>
<tr>
<td>Jet velocity</td>
<td><span>${U_J}$</span></td>
<td>m/s</td>
<td>Volume-averaged jet region velocity. The averaging volume is bounded at each x along the room depth by the line in the y-z plane where the jet velocity drops to 50% of its maximum centerline value.</td>
</tr>
<tr>
<td>Recirculation zone velocity</td>
<td><span>${U_R}$</span></td>
<td>m/s</td>
<td>Area-averaged velocity in the y-z plane with maximum flow. The averaging area is the recirculation part of the room cross-section. Typically the plane of maximum flow occurs at x ~ 2D/3 (D/3 before the outlet).</td>
</tr>
<tr>
<td>Recirculation zone flow rate</td>
<td><span>${Q_R}$</span></td>
<td>m<sup>3</sup>/s</td>
<td>Total flow rate for the recirculation regions in the plane of maximum flow (see above).</td>
</tr>
<tr>
<td>Jet temperature rise</td>
<td><span>$\Delta {T_J}$</span></td>
<td>°C</td>
<td>Volume-averaged temperature variations in the jet region, over the same volume used to define the jet velocity average.</td>
</tr>
<tr>
<td>Recirculation zone temperature rise</td>
<td><span>$\Delta {T_R}$</span></td>
<td>°C</td>
<td>Volume-average temperature variations in the recirculation region. The average is calculated over the cuboidal volume placed in each recirculation containing the volumetric sensible heat gains (see main text).</td>
</tr>
</table>

See also Figure 139. Note the *x*-coordinate is along the room, the *y*-coordinate is across the room and the *z*-coordinate is vertical.

Table 46. Correlation formulae in the form Y = aX + b

<table class="table table-striped">
<tr>
<th> </th>
<th>Y</th>
<th>X</th>
<th>a</th>
<th>b</th>
<th>R<sup>2</sup></th>
</tr>
<tr>
<td>Jet velocity</td>
<td><span>${U_J}/{U_{in}}$</span></td>
<td><span>$\sqrt {{A_{in}}/{A_{RM}}} \cdot \left( {{V_{J,m}}/{U_{in}}} \right)$</span></td>
<td>1.6173</td>
<td>0.1466</td>
<td>0.8343</td>
</tr>
<tr>
<td>Recirculation zone velocity</td>
<td><span>${U_R}/{U_{in}}$</span></td>
<td><span>$\sqrt {{A_{in}}/{A_{RM}}} \cdot \left( {{V_{J,m}}/{U_{in}}} \right)$</span></td>
<td>0.8911</td>
<td>0.0393</td>
<td>0.6464</td>
</tr>
<tr>
<td>Recirculation zone flow rate</td>
<td><span>${Q_R}/{U_{in}}$</span></td>
<td><span>$\sqrt {{A_{in}}{A_{RM}}} \cdot \left( {{V_{J,m}}/{U_{in}}} \right)$</span></td>
<td>0.4444</td>
<td>0.1751</td>
<td>0.6761</td>
</tr>
<tr>
<td>Jet temperature rise</td>
<td><span>$\Delta {T_J}$</span></td>
<td><span>$\frac{{q'{'_{RM}}}}{{\rho {c_p}{Q_{in}}}}$</span></td>
<td>0.8254</td>
<td>0</td>
<td>n/a</td>
</tr>
<tr>
<td>Recirculation zone temperature rise</td>
<td><span>$\Delta {T_R}$</span></td>
<td><span>$\frac{{q'{'_{RM}}}}{{\rho {c_p}{Q_{in}}}}$</span></td>
<td>1.2734</td>
<td>0</td>
<td>n/a</td>
</tr>

</table>

Table 47. Accuracy of correlation formulae in predicting test case results

<table class="table table-striped">
  <tr>
    <th colspan="5">Cases</th>
    <th colspan="5">Errors (%)</th>
  </tr>
  <tr>
    <td>ID</td>
    <td>A (m2)</td>
    <td>W (m)</td>
    <td>D (m)</td>
    <td>H (m)</td>
    <td>Jet Velocity</td>
    <td>Recirculation Velocity</td>
    <td>Recirculation Flow Rate</td>
    <td>Jet Temperature Rise</td>
    <td>Recirculation Temperature Rise</td>
  </tr>
  <tr>
    <td>1</td>
    <td>0.25</td>
    <td>6</td>
    <td>9</td>
    <td>2.3</td>
    <td>16</td>
    <td>45</td>
    <td>60</td>
    <td>1</td>
    <td>10</td>
  </tr>
  <tr>
    <td>2</td>
    <td>0.25</td>
    <td>11</td>
    <td>9</td>
    <td>2.3</td>
    <td>5</td>
    <td>43</td>
    <td>32</td>
    <td>5</td>
    <td>7</td>
  </tr>
  <tr>
    <td>3</td>
    <td>0.5</td>
    <td>9</td>
    <td>4.5</td>
    <td>2.3</td>
    <td>2</td>
    <td>18</td>
    <td>27</td>
    <td>15</td>
    <td>2</td>
  </tr>
  <tr>
    <td>4</td>
    <td>0.5</td>
    <td>9</td>
    <td>6</td>
    <td>2.3</td>
    <td>6</td>
    <td>32</td>
    <td>28</td>
    <td>7</td>
    <td>1</td>
  </tr>
  <tr>
    <td>5</td>
    <td>0.5</td>
    <td>6</td>
    <td>9</td>
    <td>2.3</td>
    <td>7</td>
    <td>6</td>
    <td>21</td>
    <td>7</td>
    <td>0</td>
  </tr>
  <tr>
    <td>6</td>
    <td>0.5</td>
    <td>9</td>
    <td>9</td>
    <td>2.3</td>
    <td>10</td>
    <td>4</td>
    <td>6</td>
    <td>15</td>
    <td>17</td>
  </tr>
  <tr>
    <td>7</td>
    <td>0.5</td>
    <td>11</td>
    <td>9</td>
    <td>2.3</td>
    <td>6</td>
    <td>7</td>
    <td>0</td>
    <td>14</td>
    <td>20</td>
  </tr>
  <tr>
    <td>8</td>
    <td>0.5</td>
    <td>13.5</td>
    <td>9</td>
    <td>2.3</td>
    <td>14</td>
    <td>9</td>
    <td>5</td>
    <td>21</td>
    <td>2</td>
  </tr>
  <tr>
    <td>9</td>
    <td>0.5</td>
    <td>9</td>
    <td>13.5</td>
    <td>2.3</td>
    <td>10</td>
    <td>11</td>
    <td>17</td>
    <td>7</td>
    <td>8</td>
  </tr>
  <tr>
    <td>10</td>
    <td>0.5</td>
    <td>9</td>
    <td>18</td>
    <td>2.3</td>
    <td>10</td>
    <td>25</td>
    <td>29</td>
    <td>8</td>
    <td>3</td>
  </tr>
  <tr>
    <td>11</td>
    <td>0.5</td>
    <td>13.5</td>
    <td>18</td>
    <td>2.3</td>
    <td>8</td>
    <td>2</td>
    <td>23</td>
    <td>9</td>
    <td>6</td>
  </tr>
  <tr>
    <td>12</td>
    <td>1</td>
    <td>9</td>
    <td>9</td>
    <td>2.3</td>
    <td>2</td>
    <td>5</td>
    <td>3</td>
    <td>3</td>
    <td>4</td>
  </tr>
  <tr>
    <td>13</td>
    <td>1</td>
    <td>9</td>
    <td>13.5</td>
    <td>2.3</td>
    <td>8</td>
    <td>10</td>
    <td>10</td>
    <td>3</td>
    <td>6</td>
  </tr>
  <tr>
    <td>14</td>
    <td>1</td>
    <td>9</td>
    <td>18</td>
    <td>2.3</td>
    <td>0</td>
    <td>18</td>
    <td>6</td>
    <td>13</td>
    <td>2</td>
  </tr>
  <tr>
    <td colspan="5">Average</td>
    <td>8</td>
    <td>17</td>
    <td>19</td>
    <td>9</td>
    <td>6</td>
  </tr>
</table>

In each case the error is the percentage difference between the given correlation prediction and the test case result obtained from CFD, i.e. 100\*|(correlation prediction – CFD)/CFD|.



<span>$\sqrt {{A_{in}}/{A_{RM}}} \left( {{V_{J,m}}/{U_{in}}} \right)$</span><span>${U_J}/{U_{in}}$</span>![](EngineeringReference/media/image2652.png)

Figure 140. Jet velocity correlation.



<span>$\sqrt {{A_{in}}/{A_{RM}}} \left( {{V_{J,m}}/{U_{in}}} \right)$</span><span>${U_R}/{U_{in}}$</span>![](EngineeringReference/media/image2655.png)

Figure 141. Recirculation region velocity correlation.



<span>$\sqrt {{A_{in}}{A_{RM}}} \left( {{V_{J,m}}/{U_{in}}} \right)$</span><span>${Q_R}/{U_{in}}$</span>![](EngineeringReference/media/image2658.png)

Figure 142. Recirculation region flow rate.

#### Wind angle effects

When the incoming wind is not normal to the façade the jet enters the room at an angle, as shown in Figure 143.

![](EngineeringReference/media/image2659.png)

Figure 143. Schematic of jet resulting from wind at angle φ to façade.

This oblique geometry has two main effects on the flow and consequent correlation predictions:

The inflow area is reduced, creating a larger inflow velocity for the same flow rate.

The room flow path length is increased, from *D* to *D*\*, resulting in a larger apparent depth.

The first effect increases indoor velocities while the second effect decreases the velocities.

#### Multiple apertures

CFD simulations for rooms with more than one inflow aperture show that the model can be applied to these configurations with minimal adjustments. As a result of increased dissipation in the central recirculation region, where two distinct recirculation flows collide (Figure 144), the airflow velocities are reduced by 5-10%, as shown in the charts in Figure 145.

![](EngineeringReference/media/image2660.png)

Figure 144. Flow regions for a room with 2 inlets and 2 outlets.

![](EngineeringReference/media/image2661.png)![](EngineeringReference/media/image2662.png)

Figure 145. Jet velocity and recirculation velocity for the two halves of 3 different 2-inlet rooms, A-C, compared with the corresponding 1-inlet rooms.

***Heat transfer in recirculating flows***

In most cross ventilation flows with recirculations the mixing between recirculation and inflow jet is only partial. Figure 146 shows a schematic representation of the heat transfer process (showing a top view of one half of a symmetrical room). The flow is divided into three distinct streams with connected temperature variations:

The main jet (labeled J in the figure).

The part of the recirculation flow that exchanges heat with the jet (label R).

The wall boundary layer part of the recirculation flow (label W).

![](EngineeringReference/media/image2663.png)

Figure 146. Top view of the flow structure in case R.

The light gray arrows show flow direction. The dark gray arrows show heat transfer in the shear layer. The recirculation region coordinate system is shown in the figure, with coordinate *r* varying between 0 and *L*.

#### Heat transfer in a shear layer

It is possible to use a formulation with a heat transfer area, a convection heat transfer coefficient and an average shear layer temperature difference to model the heat exchange between jet and recirculation flows:

<span>${Q_{y = 0}} = {A_{SL}}\,{h_{SL}}\,\Delta {T_{SL}}$</span>, <span>${A_{SL}} = L\,\,P\,,\,\,{h_{SL}} = \frac{{\rho \,{C_P}\,F}}{{{C_D}\,\,{A_{IN}}\,\,4\,\sigma \,\sqrt \pi  }}$</span>

Locally, the heat transfer process is driven by the variable, local, temperature difference:

<div>$$\rho \,{C_P}\,F\,\frac{{\partial \,{T_J}(x)}}{{\partial \,x}} =  - \,\frac{{{A_{SL}}\,{h_{SL}}}}{L}\,\left( {{T_J}(x) - {T_R}(x)} \right) = \frac{{P\,\,\left( {{T_J}(x) - {T_R}(x)} \right)}}{{{C_D}\,{A_{IN}}\,4\,\sigma \,\sqrt \pi  }}$$</div>

#### Predicting air temperature in the recirculation region of the flow

An accurate representation of system behavior must consider both the local heat transfer in the shear layer (varying along the *x* direction, driven by the temperature profiles *T<sub>J</sub>(x)* and *T<sub>R</sub>(x)*) and the heat transfer in the wall boundary layers (with temperature *T<sub>W</sub>(r)*). Both transfers can be modeled using differential equations, resulting in the following system of equations:

<div>$$
  \begin{array}{rl}
    \rho C_p F R \frac{\partial T_W \left(r\right)}{\partial r} &= \frac{A_S h_S}{L} \left(T_S - T_W \left(r\right)\right) \\
    \rho C_p F R \frac{\partial T_R \left(x\right)}{\partial x} &= \frac{A_{SL} h_{SL}}{L} \left(T_J\left(x\right) - T_R \left(x\right)\right) \\
    \rho C_p F \frac{\partial T_J \left(x\right)}{\partial x} &= \frac{A_{SL} h_{SL}}{L} \left(T_J\left(x\right) - T_R \left(x\right)\right) 
  \end{array}
$$</div>

The relevant boundary conditions are:

<div>$${T_W}({L_{}}) = {T_R}(0)\,,\,{T_W}(0) = {T_R}(L)\,,\,\,{T_J}(0) = {T_{IN}}$$</div>

The first equation in models heat transfer in the wall layer. The second models the temperature variation of the portion of the recirculation flow that is in contact with the jet, it differs from the third equation only in a sign (the temperature variation in *T<sub>R</sub>* is symmetric to the variation in *T<sub>J</sub>*) and the flow rate (*F.R* for the recirculation and *F* for the main jet). The temperature in the recirculation region is given by:

<div>$${T_W}(r) = {T_S} - ({T_S} - {T_{IN}})\,\frac{{{e^{\frac{{{h_S}\,{A_S}}}{{\rho \,{C_P}\,R\,F}}\frac{r}{{{L_{}}}}}}\,({e^{ - \frac{{{A_{SL}}\,{h_{SL}}\,(1 + R)}}{{\rho \,{C_P}\,R\,F}}}} - 1)}}{{{e^{ - \frac{{{A_{SL}}\,{h_{SL}}\,(1 + R)}}{{\rho \,{C_P}\,R\,F}}}} - {e^{\frac{{{h_S}\,{A_S}}}{{\rho \,{C_P}\,R\,F}}}}\,(1 + R) + R}}$$</div>

#### Heat transfer in recirculating flows with internal gains

Whereas surface heat transfer is an important component of room heat transfer, internal gains often dominate the room temperature field. Referring to the previously used subdivision of the room into jet and recirculation regions we can see that gains can occur exclusively in the jet region, exclusively in the recirculation region or in both regions.

#### Heat gains in the jet region

The effect of gains in the jet region on room air temperature distribution is simple to model and, within the first order accuracy goal, can be characterized as follows:

For gains occurring in the jet region (between the inlet and the room outlet) a change in inflow temperature is an adequate, conservative approximation. From energy conservation we conclude that the altered inflow temperature is given by:

<div>$${T_{ING}} = {T_{IN}} + \frac{{{G_J}}}{{\rho {C_P}F}}$$</div>

Gains occurring in the jet region, close to the outlet can be ignored in a first order accuracy model.

Clearly the two approaches described above are only exact when: the gains occur at the inlet and perfectly mix with the inflow jet (for the first case), or whenever the gains occur very close to the outlet (in the second case). In all other situations, the first approach provides a conservative approximation. In the model implementation in EnergyPlus the user will not define the exact location of the heat gains within each region of the flow therefore, heat gains in the jet region, are inserted in two equal parts in two separate points of the jet flow (in the room entrance and before the exit, see points r=0 and r=L<sub>R</sub> in Figure 146).

#### Heat gains in the recirculation region

When heat gains occur in the recirculation region significant heat accumulation occurs due to the limited heat transfer ability of the shear layer. Due to this limited ability, the recirculation is partially isolated from the main jet flow and higher temperatures are generated in this region whenever heat gains are present. The concept of a global heat transfer coefficient is not applicable.

In the case of a flow in a room with adiabatic surfaces and heat gains in the recirculation region the indoor air temperatures can be predicted using the solution to the following system of equations:

<div>$$
  \begin{array}{rl}
    \rho C_p F R \left(T_R\left(0\right) - T_R\left(L\right)\right) &= G_R \\
    \rho C_p F R \frac{\partial T_R \left(x\right)}{\partial x} &= \frac{A_{SL} h_{SL}}{L} \left(T_J\left(x\right) - T_R \left(x\right)\right) \\
    \rho C_p F \frac{\partial T_J \left(x\right)}{\partial x} &= \frac{A_{SL} h_{SL}}{L} \left(T_J\left(x\right) - T_R \left(x\right)\right)
  \end{array}
$$</div>

This system of equations differs from system F16 in several ways. Because there is no wall heat transfer there is no need to split the recirculation flow in two parts (*R* and *W*). The temperature increase in the recirculation flow is simply defined by the internal gains (first equation in ). The second and third equations in model shear layer heat transfer are similar in the two cases ( and ).

The recirculation flow temperature at *x*=0 is given by:

<div>$${T_R}(0) = {T_{IN}} + \left( {\frac{1}{{{e^{\frac{{{A_{SL}}{h_{SL}}\,(1 + R)}}{{\rho \,{C_P}F\,R}}}} - 1}} + 1} \right)\frac{{{G_R}(1 + R)}}{{\rho \,{C_P}F\,R}}$$</div>

The temperature in the recirculation is inversely proportional to the recirculation flow ratio (*R*) and the shear layer area (measured by the product: *A<sub>SL</sub> h<sub>SL</sub>*). As both of these parameters increase this expression becomes similar to . The recirculation flow temperature at *x=L* is given by:

<div>$${T_R}(L) = {T_R}(0) + \Delta {T_R}$$</div>

The temperature variations in the recirculation flow is given by:

<div>$$\Delta {T_R} = \frac{{{G_R}}}{{\rho \,{C_P}\,F\,R}}$$</div>

#### Combined effects of surface heat transfer and internal gains in the recirculation region

In this case, the following system of equations must be solved:

<div>$$
  \begin{array}{rl}
    \rho C_p F R \frac{\partial T_W \left(r\right)}{\partial r} &= -\frac{A_S h_S}{L} \left(T_S - T_W \left(r\right)\right) - \frac{G_R}{L_R} \\
    \rho C_p F R \frac{\partial T_R \left(x\right)}{\partial x} &= \frac{A_{SL} h_{SL}}{L} \left(T_J\left(x\right) - T_R \left(x\right)\right) \\
    \rho C_p F \frac{\partial T_J \left(x\right)}{\partial x} &= \frac{A_{SL} h_{SL}}{L} \left(T_J\left(x\right) - T_R \left(x\right)\right) 
  \end{array}
$$</div>

With the boundary conditions: <span>${T_W}(L) = {T_R}(0)\,,\,{T_W}(0) = {T_R}(L)\,,\,\,{T_J}(0) = {T_{IN}}$</span>

For simplicity the heat gains are considered to be evenly distributed along the recirculation path. The temperature variation in the recirculation region is given by:

<div>$${T_W}(r) = {T_S} + \frac{{{G_R}}}{{{A_S}\,{h_S}}} - \frac{{{e^{\frac{{{h_S}\,{A_S}}}{{\rho \,{C_P}\,R\,F}}\frac{r}{{{L_R}}}}}\,({e^{ - \frac{{{A_{SL}}\,{h_{SL}}\,(1 + R)}}{{\rho \,{C_P}\,R\,F}}}} - 1)\,({G_R} + {A_S}\,{h_S}\,({T_S} + {T_{IN}}))}}{{{e^{ - \frac{{{A_{SL}}\,{h_{SL}}\,(1 + R)}}{{\rho \,{C_P}\,R\,F}}}} + R - {e^{\frac{{{h_S}\,{A_S}}}{{\rho \,{C_P}\,R\,F}}}}\,(1 + R)}}$$</div>



Table 48. List of variables for CV model

<table class="table table-striped">
<tr>
<th>Symbol</th>
<th>Units</th>
<th>Description</th>
</tr>
<tr>
<td>a</td>
<td>-</td>
<td>Slope of correlation line of best fit</td>
</tr>
<tr>
<td>A<sub>in</sub></td>
<td>m<sup>2</sup></td>
<td>Inlet area</td>
</tr>
<tr>
<td>A<sub>RM</sub></td>
<td>m<sup>2</sup></td>
<td>Room cross-sectional area</td>
</tr>
<tr>
<td>b</td>
<td>-</td>
<td>Intercept of correlation line of best fit</td>
</tr>
<tr>
<td>c<sub>p</sub></td>
<td>J/kg/K</td>
<td>Specific heat capacity of air</td>
</tr>
<tr>
<td>C<sub>RM</sub></td>
<td>-</td>
<td>Confinement scaling factor, (A<sub>in</sub>/A<sub>RM</sub>)<sup>1/2</sup></td>
</tr>
<tr>
<td>C<sub>1</sub></td>
<td>-</td>
<td>Correlation constant for jet velocity</td>
</tr>
<tr>
<td>C<sub>2</sub></td>
<td>-</td>
<td>Correlation constant for recirculation velocity</td>
</tr>
<tr>
<td>C<sub>3</sub></td>
<td>-</td>
<td>Correlation constant for recirculation flow rate</td>
</tr>
<tr>
<td>D</td>
<td>m</td>
<td>Room depth, distance between inlet and outlet facades</td>
</tr>
<tr>
<td>D*</td>
<td>m</td>
<td>Effective room depth adjusted for wind angle</td>
</tr>
<tr>
<td>H</td>
<td>m</td>
<td>Room height</td>
</tr>
<tr>
<td>            <span>$q'{'_{RM}}$</span></td>
<td>W</td>
<td>Total heat input from internal heat sources</td>
</tr>
<tr>
<td>Q<sub>in</sub></td>
<td>m<sup>3</sup>/s</td>
<td>Inlet flow rate, A<sub>in</sub> U<sub>in</sub></td>
</tr>
<tr>
<td>            <span>${Q_R}$</span></td>
<td>m<sup>3</sup>/s</td>
<td>Maximum recirculation region flow rate</td>
</tr>
<tr>
<td>U<sub>in</sub></td>
<td>m/s</td>
<td>Inlet velocity, average over inlet area</td>
</tr>
<tr>
<td>U<sub>m</sub></td>
<td>m/s</td>
<td>Maximum centerline velocity of jet</td>
</tr>
<tr>
<td>U<sub>0</sub></td>
<td>m/s</td>
<td>Uniform inlet velocity of jet</td>
</tr>
<tr>
<td>            <span>${U_J}$</span></td>
<td>m/s</td>
<td>Volume-averaged jet velocity</td>
</tr>
<tr>
<td>            <span>${U_R}$</span></td>
<td>m/s</td>
<td>Average recirculation region velocity over plane of maximum flow</td>
</tr>
<tr>
<td>V</td>
<td>m/s</td>
<td>Velocity scale</td>
</tr>
<tr>
<td>V<sub>J,m</sub></td>
<td>m/s</td>
<td>Average of U<sub>m</sub> over room depth</td>
</tr>
<tr>
<td>W</td>
<td>m</td>
<td>Room width</td>
</tr>
<tr>
<td>x</td>
<td>m</td>
<td>Coordinate along room depth, 0 ≤ x ≤ D</td>
</tr>
<tr>
<td>x'</td>
<td>-</td>
<td>Non-dimensional x-coordinate, x/D</td>
</tr>
<tr>
<td>X</td>
<td>m/s</td>
<td>Velocity correlation parameter</td>
</tr>
<tr>
<td>Y</td>
<td>m</td>
<td>Lateral coordinate across room width</td>
</tr>
<tr>
<td>Z</td>
<td>m</td>
<td>Vertical coordinate</td>
</tr>
<tr>
<td>            <span>$\Delta {T_J}$</span></td>
<td>°C</td>
<td>Average jet temperature variation</td>
</tr>
<tr>
<td><span>$\Delta {T_R}$</span></td>
<td>°C</td>
<td>Average recirculation region temperature variation</td>
</tr>
<tr>
<td>r</td>
<td>kg/m<sup>3</sup></td>
<td>Density of air</td>
</tr>
<tr>
<td>φ</td>
<td>°</td>
<td>Wind direction relative to façade normal</td>
</tr>

</table>

#### References

Awbi, H.B. (2003) *Ventilation of Buildings* (2<sup>nd</sup> edition). Routledge, 536pp.

Carrilho da Graca, G. 2003.Simplified models for heat transfer in rooms. Ph. D. Thesis, University of California, San Diego.

Kalema, T., Haapala, T. \`995. Effect of interior heat transfer coefficients on thermal dynamics and energy consumption, Energy and Buildings 22 (2) pp. 101-113.

Aynsley, R.M., Melbourne, W., Vickery, B.J. 1977. Architectural Aerodynamics. Applied Science London.

Baturin, V. V. , Billington, N. S. 1972. Fundamentals of Industrial Ventilation, Franklin Book Company 1972, pp. 174-179.

Neiswanger, L., Johnson, G.A., Carey, V.P. 1987. An experimental study of high Raleigh number mixed convection in a rectangular enclosure with restricted inlet and outlet openings. Transactions of ASME, Vol. 109, 446-453.

Ohba, M., Irie, K., Kurabuchi, T. 2001. Study on airflow characteristics inside and outside a CVmodel, and ventilation flow rate using wind tunnel experiments. Journal of Wind Engineering and Industrial Aerodynamics, in press.

Chandra, S., Kerestecioglu, A.A. 1984. Heat transfer in naturally ventilated rooms data from full-scale measurements, ASHRAE Transactions, Volume 90, part 1b 211-224.

Altmayer, E.F., Gadgil, A.J., Bauman, F.S., Kammerud, R.C. Correlations for convective heat transfer from room surfaces. ASHRAE Transactions, No. 2764.

Spitler, J. D., Pedersen, C.O., Fisher, D.E. 1991. Interior Convective Heat Transfer in Buildings with Large Ventilative Flow Rates. ASHRAE Transactions, Vol. 97, Pt.1, pp. 505-515.

Awbi, H.B. & Hatton, A. 1999. Natural convection from heated room surfaces, Energy and Buildings, 30, 233-244.

Siebers, D. L., Schwind, R. G., Moffat, R. J. 1983. Experimental Mixed Convection Heat Transfer From a Large Vertical Surface in a Horizontal Flow. SAND 83-8225, Sandia National Laboratories, Livermore CA.

Awbi, H.B. & Hatton, A. 2000. Mixed convection from heated room surfaces, Energy and Buildings, 32, 153-166.

Bejan, A. 1994. Convection Heat Transfer 2nd ed, Wiley, USA.

AirflowNetwork Model
--------------------

### Overview

The AirflowNetwork model provides the ability to simulate the performance of an air distribution system, including supply and return leaks, and calculate multizone airflows driven by outdoor wind and forced air during HVAC system operation. The pressure and airflow model described here was developed based on AIRNET (Walton 1989). This detailed model is used to simulate thermal conduction and air leakage losses for constant volume air distribution systems (e.g., in residential or light commercial buildings). The multizone airflow calculations are performed at the HVAC system time step which, among other benefits,.allows for modeling hybrid ventilation systems.

### Model Description

The input object AirflowNetwork:SimulationControl provides access to the airflow network method, which consists of a set of nodes connected by airflow components through linkages. The objects AirflowNetwork:Multizone:Zone,  AirflowNetwork:Multizone:ExternalNode, and AirflowNetwork:Distribution:Node represent airflow nodes. The objects AirflowNetwork:Multizone:Surface and AirflowNetwork:Distribution:Linkage represent airflow linkages. The other objects with a relationship between pressure and airflow represent airflow components.

The AirflowNetwork model consists of three sequential steps:

* Pressure and airflow calculations

* Node temperature and humidity calculations

* Sensible and latent load calculations

The pressure and airflow calculations determine pressure at each node and airflow through each linkage given wind pressures and forced airflows. Based on the airflow calculated for each linkage, the model then calculates node temperatures and humidity ratios given zone air temperatures and zone humidity ratios.  Using these node temperatures and humidity ratios, the sensible and latent loads from duct system conduction and leakage are summed for each zone. The sensible and latent loads obtained in this step are then used in the zone energy balance equations to predict HVAC system loads and to calculate the final zone air temperatures, humidity ratios, and pressures.

The present AirflowNetwork model may only be applied to a single heating and cooling system that uses a single air distribution system (a single AirLoopHVAC object). The model excludes the impact of the air and duct system thermal capacitance. The impact of thermal capacity will be addressed in future upgrades to this model.

### Pressure and Airflow Calculations

The EnergyPlus airflow network consists of a set of nodes linked by airflow components. Therefore, it is a simplified airflow model, compared to detailed models such as those used in computational fluid dynamics (CFD) models. The node variable is pressure and the linkage variable is airflow rate. A brief description is presented below. A detailed description of the airflow network model may be found in the work of Walton (1989), Dols and Walton (2002), and Walton and Dols (2003).

#### Initialization

Newton’s method is used to solve for node air pressures and it requires an initial set of values for the node pressures. There are two initialization methods available. The first is linear initialization and equivalent to Initialization flag = 0. These initial values may be obtained by including in each airflow component a linear approximation relating airflow to pressure drop:

<div>$$\mathop {{m_i}}\limits^ \bullet   = {C_i}\rho \left( {{\raise0.7ex\hbox{${\Delta {P_i}}$} \!\mathord{\left/ {\vphantom {{\Delta {P_i}} \mu }}\right.}\!\lower0.7ex\hbox{$\mu $}}} \right)$$</div>

where

<span>$\mathop {{m_i}}\limits^ \bullet  $</span> = Air mass flow rate at i-th linkage [kg/s]

*C<sub>i</sub>*  = Air mass flow coefficient [m<sup>3</sup>]

<span>$\Delta P$</span><sub>i                      </sub> = Pressure difference across the i-th linkage [Pa]

*µ   *            = Air viscosity [Pa-s]

This initialization handles stack effects very well and tends to establish the proper direction for the airflows. The linear approximation is provided by the laminar regime.

The second initialization method assumes the initial pressures are zero and uses Newton’s method directly.

#### Convergence criteria

Conservation of air mass flow rate at each linkage provides the convergence criterion. When the sum of mass flow rates in all the linkages approaches zero within the convergence tolerance, the solution has converged. The solution is assumed to have converged when the sum is less than the convergence value, in order to reduce the number of iterations and obtain sufficient accuracy. There are two convergence criteria used in the AirflowNetwork model: Relative airflow convergence tolerance and Absolute airflow convergence tolerance.

Relative airflow tolerance = <span>$\frac{\left| \sum \dot m_i \right|}{\sum \dot m_i}$</span>

Absolute airflow tolerance = <span>$\left| \sum \dot m_i \right|$</span>

The relative airflow tolerance is equivalent to the ratio of the absolute value of the sum of all network airflows to the sum of the network airflow magnitudes.  The absolute airflow tolerance is the summation of the absolute value of all network airflows. The solution has converged when both of these convergence criteria have been met.

#### Linkage models

A linkage used in the AirflowNetwork model has two nodes, inlet and outlet, and is linked by a component which has a relationship between airflow and pressure.  The pressure difference across each component in a linkage is assumed to be governed by Bernoulli’s equation:

<div>$$\Delta P = \left( {Pn + \frac{{\rho V_n^2}}{2}} \right) - \left( {Pm + \frac{{\rho V_m^2}}{2}} \right) + \rho g\left( {zn - zm} \right)$$</div>

 where

*ΔP*            = Total pressure difference between nodes n and m [Pa]

*P<sub>n</sub>, P<sub>m</sub>*        = Entry and exit static pressures [Pa]

*V<sub>n</sub>, V<sub>m</sub>*        = Entry and exit airflow velocities [m/s]

*ρ   *         = Air density [kg/m<sup>3</sup>]

*g*                = Acceleration due to gravity [9.81 m/s<sup>2</sup>]

*z<sub>n</sub>, z<sub>m</sub>*          = Entry and exit elevations [m]

By rearranging terms and adding wind pressure impacts, the above equation may be rewritten in the format used by the airflow network model:

<div>$$\Delta P = {P_n} - {P_m} + {P_S} + {P_W}$$</div>

where

*P<sub>n</sub>, P<sub>m</sub>* <sub>              </sub> = Total pressures at nodes n and m [Pa]

*P<sub>S</sub>*              = Pressure difference due to density and height differences [Pa]

*P<sub>W </sub>*            = Pressure difference due to wind [Pa]

The Input Output Reference provides the relationship between airflow and pressure for the most of the components (Ref.AirflowNetwork Model). The relationship between airflow and pressure for the AirflowNetwork:Multizone:Component:DetailedOpening, AirflowNetwork:Multizone:Component:SimpleOpening, and AirflowNetwork:Multizone:Component:HorizontalOpening objects are provided in detail in this reference.

![](EngineeringReference/media/image2691.svg.png)

Figure 147. The general problem of gravitational flow through a vertical opening

The schematic drawing of a possible air flow pattern through a detailed vertical opening (AirflowNetwork:Multizone:Component:DetailedOpening) is shown in Figure 147. The equations used below are extracted from the COMIS Fundamentals manual (1990).

The air density is assumed to be a linear function of height:

<div>$${\rho_i}(z) = {\rho_{0i}} + {b_i}z$$</div>

The pressure difference is assumed to be linear and simulate the effect of turbulence:

 <span>$\Delta {P_t} = {P_{t0}} + {b_t}z$</span>

The reference pressures on each side are given at the bottom of the opening. By assuming the Bernoulli hypothesis on both sides, the pressure difference can be defined at any level of z as:

<div>$${P_1}(z) - {P_2}(z) = ({P_{01}} - {P_{02}}) - g\left[ {({\rho_{01}}z + {b_1}{z^2}/2) - ({\rho_{02}}z + {b_2}{z^2}/2)} \right] + ({P_{t0}} + {b_t}z)$$</div>

The velocity at any level z is given by

<div>$$v(z) = \sqrt {2\frac{{{P_1}(z) - {P_2}(z)}}{\rho }} $$</div>

The locations of the two possible neutral planes are given by an equilibrium in pressure which leads to a zero velocity point. By assuming the left terms in the equation above to be zero, one may have:

<div>$$g({b_1} - {b_2}){z^2}/2 + \left[ {g({\rho_{01}} - {\rho_{02}}) - {b_t}} \right]z + ( - {P_{01}} + {P_{02}} - {P_{t0}}) = 0$$</div>

This equation above can have two, one, or zero real solutions.  The zero solution represents a one-way flow through the opening and may be expressed in the following equation:

<div>$$\dot m = {C_d}\theta \int\limits_{z = 0}^{z = H} {\rho \nu (z)Wdz} $$</div>

The one real solution represents two-way (bi-directional) flow, which may be written in the following equations.

<div>$${\dot m_{0,z1}} = {C_d}\theta \int\limits_{z = 0}^{z = z1} {\rho \nu (z)Wdz} $$</div>

<div>$${\dot m_{z1,H}} = {C_d}\theta \int\limits_{z = z1}^{z = H} {\rho \nu (z)Wdz} $$</div>

The two real solutions represent three-way flow, which may be written in the following equations.

<div>$${\dot m_{z2,H}} = {C_d}\theta \int\limits_{z = z2}^{z = H} {\rho \nu (z)Wdz} $$</div>

<div>$${\dot m_{z1,z2}} = {C_d}\theta \int\limits_{z = z1}^{z = z2} {\rho \nu (z)Wdz} $$</div>

<div>$${\dot m_{z2,H}} = {C_d}\theta \int\limits_{z = z2}^{z = H} {\rho \nu (z)Wdz} $$</div>

where

*C<sub>d</sub>*  = discharge coefficient [dimensionless]

*θ*    = Area reduction factor [dimensionless]

*W*   = Opening width [m]

The discharge coefficient, opening width, opening height, and start height factor are modulated based on opening factors. A detailed description of opening factor calculations may be found in the Input Output Reference (Ref. AirflowNetwork:Multizone:Zone, AirflowNetwork:Multizone:Surface, and

AirflowNetwork:Multizone:Component:DetailedOpening).

The above calculation procedure is used for a normal rectangular window. For a horizontally pivoted rectangular window, the calculation procedure is slightly different. A schematic drawing of a horizontally-pivoted window is shown in Figure 148.

![PivotedWindow](EngineeringReference/media/image2703.png)

Figure 148.  Schematic drawing of a horizontally-pivoted window

The opening angle α (0-90°) is linearly proportional to the window opening factor (0-1.0). An opening factor of 1.0 is equal to an opening angle of 90°. The heights in the pivoted area are expressed as:

<div>$$h2 = AxisHeight(1 - \cos (\alpha ))$$</div>

<div>$$h4 = AxisHeight + (WindowHeight - AxisHeight)\cos (\alpha )$$</div>

When z &lt; h2 or z &gt; h4, where z is the distance from the bottom of the window, the integration procedure is the same as the procedure for a normal rectangular window. When h2&lt;z&lt;h4, the window width W in the above equations is modified as:

 <span>${W_{pivot}} = \sqrt {\frac{1}{{\frac{1}{{{W^2}}} + \frac{1}{{{{(2(AxisHeight - z)\tan (\alpha ))}^2}}}}}} $</span>

The mass flow rate in the pivoted area becomes:

<div>$${\dot m_{pivot}} = {C_d}\theta \int\limits_{z = h2}^{z = h4} {\rho \nu (z){W_{pivot}}dz} $$</div>

It should be pointed out that the discharge coefficient is modulated based on opening factors, while opening width, opening height, and start height factor do not apply for a horizontally-pivoted window. The actual window width and height are used to calculate airflows for a horizontally-pivoted window.

The schematic drawing of air flow patterns through a simple vertical opening (AirflowNetwork:Multizone:Component:SimpleOpening) is shown in Figure 149. The equations used below are available from Walton (1989).

![](EngineeringReference/media/image2708.svg.png)

Figure 149. Schematic of large opening and associated three flow patterns

The air density for each node is assumed to be constant. The hydrostatic equation is used to relate pressures at various heights for each node:

<div>$$Pn\left( y \right) = {P_{0n}} - {\rho_n}gy$$</div>

<div>$${P_m}(y) = {P_{0m}} - {\rho_m}gy$$</div>

where

*P<sub>0n</sub>, P<sub>0m</sub> = <sub> </sub>*pressure at nodes (zones) n and m at y = 0, the reference elevation of the opening [Pa]

*ρ<sub>n</sub>, ρ<sub>m</sub><sub> </sub> =*air densities of zones n and m [kg/m<sup>3</sup>]

*P<sub>n</sub>, P<sub>m</sub> =*reference pressures of zones n and m [Pa]

It is assumed that the velocity of the airflow as a function of height is given by the orifice equation (Brown and Solvason 1962):

<div>$$v(y) = {C_d}\sqrt {2\frac{{{P_n}(y) - {P_m}(y)}}{\rho }} $$</div>

 where

*C<sub>d</sub>*<sub>  </sub>= discharge coefficient [dimensionless]

*ρ*  = density of the air going through the opening [kg/m<sup>3</sup>]

The neutral height, Y, where the velocity of the air is zero, may be calculated in the following equation:

<div>$$Y = \frac{{{P_{on}} - {P_{0m}}}}{{g({\rho_n} - {\rho_m})}}\,\,\,\,\,\,\,\,or\,\,\,\,\,\,\,\frac{{{P_{om}} - {P_{0n}}}}{{g({\rho_m} - {\rho_n})}}$$</div>

When the neutral plane is within the opening (first pattern in Figure 149), two-way (bi-directional) flows occur. The total flow through a large opening is the sum of both flows.

<div>$${\dot m_{0,Y}} = {C_d}\theta \int\limits_{y = 0}^{y = Y} {\rho \nu (y)Wdy} $$</div>

<div>$${\dot m_{Y,H}} = {C_d}\theta \int\limits_{y = Y}^{y = H} {\rho \nu (y)Wdy} $$</div>

When the neutral plane is below or above the large opening (second and third pattern in Figure 149), one-way flow occurs.

<div>$${\dot m_{}} = {C_d}\theta \int\limits_{y = 0}^{y = H} {\rho \nu (y)Wdy} $$</div>

The opening width is modulated based on opening factors. A detailed description of opening factor calculations may be found in the Input Output Reference (Ref. AirflowNetwork:Multizone:Zone, AirflowNetwork:Multizone:Surface, and AirflowNetwork:Multizone:Component:DetailedOpening).

The above two objects are used to simulate airflows across large vertical openings. The simple opening component (AirflowNetwork:Multizone:Component:SimpleOpening) assumes the pressure difference across the opening is a function of height varied from opening bottom to top, so that two-way flow may be obtained if appropriate (Walton 1989). The Detailed Opening component (AirflowNetwork:Multizone:Component:DetailedOpening) assumes both the pressure difference across the opening and air density are a function of height, so that three-way flow may be obtained (COMIS 1990). If these opening models would be used for horizontal openings, the pressure difference across the opening and air density remain constant, so that only one-way flow is possible using the detailed and simple opening components which are meant for vertical or near-vertical openings. In reality, there are two-way flows (air recirculation) across a large horizontal opening caused by buoyancy due to temperature and pressure difference and forced flow driven by air pressure difference only. Therefore, a horizontal opening component (AirflowNetwork:Multizone:Component:HorizontalOpening) is available to simulate airflows across large horizontal openings with the possibility of two-way flow by combining forced and buoyancy airflows together.

The model for horizontal openings consists of forced airflow, buoyancy airflow, purge pressure and sloping plane. The model is mainly from a NIST report presented by Cooper (1989). The sloping plane (Bolmqvist and Sandberg 2004) portion of the model was added to allow for staircase simulations.

For simplicity, a two zone building (upper and lower zones) connected by a large horizontal opening is used to describe the model, as shown in Figure 150. Forced and buoyancy airflows are described separately below.

![AirflowNetwork-4](EngineeringReference/media/image2716.png)

Figure 150. Air movements across a horizontal opening

Forced airflows

The air mass flow rate is determined by the pressure difference across the opening. The relationship between pressure and airflow is the same as AIRNET for a component (see AirflowNetwork:Multizone:Component:SimpleOpening description above). Since the height of the opening is constant, the forced airflow is unidirectional. A positive value for pressure difference indicates flow direction is from the lower zone to the upper zone across the opening, while a negative value represents flow in the opposite direction. The following description addresses forced air mass flow rates and partial derivatives for three possible scenarios of pressure difference:

P<sub>L</sub> = P<sub>U</sub>

<span>${\dot m_U}$</span>= <span>${\dot m_L}$</span>= 0

where:

P<sub>L</sub>               = Air pressure in the lower zone [Pa]

P<sub>U</sub>              = Air pressure in the upper zone [Pa]

<span>${\dot m_U}$</span>            = Air mass flow rate from the lower zone to the upper zone driven by forced airflow pressure difference [kg/s]

<span>${\dot m_L}$</span>            = Air mass flow rate from the upper zone to the lower zone driven by forced airflow pressure difference [kg/s]

1)           P<sub>L</sub> &gt; P<sub>U</sub>

<span>${\dot m_U}$</span>= 0

<div>$${\mathop m\limits^ \bullet_L} = {\rho_L}A{C_d}{\left( {\frac{{2\Delta P}}{{{\rho_{ave}}}}} \right)^{0.5}}$$</div>

<div>$$\frac{{{{\mathop {\partial m}\limits^ \bullet  }_L}}}{{\partial {P_L}}} = {\rho_L}A{C_d}{\left( {\frac{1}{{2\Delta P{\rho_{ave}}}}} \right)^{0.5}}$$</div>

where:

ρ<sub>L</sub>   = Air density in the lower zone [kg/m<sup>3</sup>]

A    = Opening area [m<sup>2</sup>]

C<sub>d     </sub> = Discharge coefficient [Dimensionless]

ρ<sub>ave</sub> = Average air density between the lower and upper zones [Pa]

ΔP  = Pressure difference P<sub>L</sub> - P<sub>U</sub> [Pa]

2)           P<sub>L</sub> &lt; P<sub>U</sub>

<span>${\mathop m\limits^ \bullet_{_L}}$</span>= 0

<div>$${\mathop m\limits^ \bullet_U} =  - {\rho_U}A{C_d}{\left( {\frac{{2\left| {\Delta P} \right|}}{{{\rho_{ave}}}}} \right)^{0.5}}$$</div>

<div>$$\frac{{\partial \mathop {{m_U}}\limits^ \bullet  }}{{\partial {P_L}}} = {\rho_U}A{C_d}{\left( {\frac{1}{{2\left| {\Delta P} \right|{\rho_{ave}}}}} \right)^{0.5}}$$</div>

where**:**

ρ<sub>U</sub>   = Air density in the upper zone [kg/m<sup>3</sup>]

A    = Opening area [m<sup>2</sup>]

C<sub>d     </sub> = Discharge coefficient [Dimensionless]

ρ<sub>ave</sub> = Average air density between the lower and upper zones [Pa]

ΔP  = Pressure difference P<sub>L</sub> - P<sub>U</sub> [Pa]

##### Buoyancy airflows

Buoyancy flow only occurs when the air density in the upper zone is greater than the air density in the lower zone. The flow is bi-directional and the amount of upper flow is equal to the lower flow across the opening. The following discussion assumes the air density in the upper zone is greater than the air density in the lower zone. Otherwise, the buoyancy flow rate is equal to zero. It is also assumed that the maximum buoyancy flow occurs when the pressure difference across the opening due to forced airflows is zero. The maximum buoyancy flow may be expressed as a part of Cooper’s model:

<div>$${\mathop m\limits^ \bullet_{buo,\max }} = {\rho_{ave}}*0.055{\left( {\frac{{g\left| {\Delta \rho } \right|D_{_H}^5}}{{{\rho_{ave}}}}} \right)^{0.5}}$$</div>

where:

<span>${\mathop m\limits^ \bullet_{_{buo,\max }}}$</span> = Buoyancy mass flow rate at zero forced airflow pressure difference [kg/s]

g    = Gravity acceleration [m/s<sup>2</sup>]

D<sub>H   </sub> = Hydraulic diameter [m]

ρ<sub>ave</sub> = Average air density between the lower and upper zones [kg/m<sup>3</sup>]

Δρ  = Density difference between the lower and upper zones [kg/m<sup>3</sup>]

##### Combined airflows

When forced and buoyancy flows co-exist, it is possible to have either unidirectional or bi-directional flows. For example, when the upward force due to pressure difference is greater than the buoyancy force (downward), unidirectional flow occurs. Bi-directional flow only occurs when the upward imposed force is less than the buoyancy force. The critical pressure between unidirectional and bi-directional flows is called the purge pressure (Tan and Jaluria 1992). The purge pressure is a function of opening geometry and the buoyancy force (ΔP/(gΔρD<sub>H</sub>)) and may be expressed as (Cooper 1998):

<div>$$\Delta {P_{Flood}} = \left| {C_{Shape}^2\frac{{g\Delta \rho D_H^5}}{{2{A^2}}}} \right|$$</div>

where:

ΔP<sub>Flood</sub> = Purging pressure [Pa]

g    = Gravity acceleration [m/s<sup>2</sup>]

D<sub>H   </sub> = Hydraulic diameter [m]

A    = Opening area [m<sup>2</sup>]

Δρ  = Density difference between the lower and upper zones [kg/m<sup>3</sup>]

C<sub>Shape</sub> = Shape factor [dimensionless]

<div>$$C_{Shape}^{} = \left\{ \begin{array}{l}0.754\;\;\;{\rm{for}}\;{\rm{a}}\;{\rm{circle}}\;{\rm{opening}}\\0.942(w/D)\;{\rm{for}}\;{\rm{a}}\;{\rm{rectangle}}\;{\rm{opening}}\end{array} \right\}$$</div>

where:

w    = Opening width [m]

D    = Opening depth [m]

As mentioned above, when the air pressure difference between two zones is zero there is the maximum bi-directional flow due to the buoyancy force. When the pressure difference increases from 0 and is less than |ΔP<sub>Flood</sub>|, there is some bi-directional flow across the opening, but less than the maximum flow. If the pressure difference keeps increasing and exceeds |ΔP<sub>Flood</sub>|, there is no bi-directional flow.  Cooper’s model assumes the buoyancy flow varies linearly with pressure difference.

<div>$${\mathop m\limits^ \bullet_{buo}} = \left\{ \begin{array}{l}{\mathop m\limits^ \bullet_{buo,\max }}*\left( {1 - \frac{{\left| {\Delta P} \right|}}{{\left| {\Delta {P_{Flood}}} \right|}}} \right)\;\,\,If\;\Delta \rho  > 0\;and\;\frac{{\left| {\Delta P} \right|}}{{\left| {\Delta {P_{Flood}}} \right|}} < 1\\0\;\,\,\,Otherwise\end{array} \right\}$$</div>

The total air flow across the opening is based on superposition of the forced and buoyancy flows, and may be expressed for three different pressure difference scenarios as follows:

a.                            P<sub>L</sub> = P<sub>U</sub>

<div>$${\mathop m\limits^ \bullet_{_U}} = {\mathop m\limits^ \bullet_{buo}}$$</div>

<div>$${\mathop m\limits^ \bullet_{_L}} = {\mathop m\limits^ \bullet_{buo}}$$</div>

<div>$$\frac{{{{\mathop {\partial m}\limits^ \bullet  }_L}}}{{\partial {P_L}}} = 0$$</div>

b.                           P<sub>L</sub> &gt; P<sub>U</sub>

<div>$${\mathop m\limits^ \bullet_{_U}} = {\mathop m\limits^ \bullet_{buo}}$$</div>

<div>$${\mathop m\limits^ \bullet_L} = {\rho_L}A{C_d}{\left( {\frac{{2\Delta P}}{{{\rho_{ave}}}}} \right)^{0.5}} + {\mathop m\limits^ \bullet_{buo}}$$</div>

<div>$$\frac{{{{\mathop {\partial m}\limits^ \bullet  }_L}}}{{\partial {P_L}}} = {\rho_L}A{C_d}{\left( {\frac{1}{{2\Delta P{\rho_{ave}}}}} \right)^{0.5}} - \frac{{{{\mathop m\limits^ \bullet  }_{buo,\max }}}}{{\left| {\Delta {P_{Flood}}} \right|}}$$</div>

where:

ρ<sub>L</sub>   = Air density in the lower zone [kg/m<sup>3</sup>]

A    = Opening area [m<sup>2</sup>]

C<sub>d     </sub> = Discharge coefficient [dimensionless]

Ρ<sub>ave</sub> = Average air density between the lower and upper zones [Pa]

ΔP  = Pressure difference P<sub>L</sub> - P<sub>U</sub> [Pa]

c.                            P<sub>L</sub> &lt; P<sub>U</sub>

<div>$${\mathop m\limits^ \bullet_{_L}} = {\mathop m\limits^ \bullet_{buo}}$$</div>

<div>$${\mathop m\limits^ \bullet_U} =  - {\rho_U}A{C_d}{\left( {\frac{{2\left| {\Delta P} \right|}}{{{\rho_{ave}}}}} \right)^{0.5}} + {\mathop m\limits^ \bullet_{buo}}$$</div>

<div>$$\frac{{\partial \mathop {{m_U}}\limits^ \bullet  }}{{\partial {P_L}}} = {\rho_U}A{C_d}{\left( {\frac{1}{{2\left| {\Delta P} \right|{\rho_{ave}}}}} \right)^{0.5}} + \frac{{{{\mathop m\limits^ \bullet  }_{buo,\max }}}}{{\left| {\Delta {P_{Flood}}} \right|}}$$</div>

*Sloping plane*

![](EngineeringReference/media/image2741.png)

Figure 151. A Staircase is attached to the horizontal opening.

When a staircase is introduced as shown in Figure 151, the effective opening area will be used to replace A (opening area) in the above equations. The effective area may be estimated as (Bolmqvist and Sandberg 2004):

<div>$${A_{eff}} = A\sin \alpha (1 + \cos \alpha )$$</div>

where:

A<sub>eff</sub>  = Effective area of horizontal opening [m<sup>2</sup>]

A    = Area of horizontal opening [m<sup>2</sup>]

α    = Angle between the stair plane and horizontal opening plane [degrees]

Note: the hydraulic diameter calculation is based on the effective opening area, while the opening depth remains the same.

Figure 152 demonstrates possible forced and buoyancy flow rates at different ratios of pressure difference to purging pressure across a horizontal opening when the upper zone air density is greater than the lower zone air density. The pressure difference is the lower zone pressure minus the upper zone pressure. Otherwise, the buoyancy flow is zero. In addition, when the absolute ratio is above 1, the buoyancy flow is also zero. The following table provides a brief description for the legend listed in Figure 152.

Table 49.  Legend Description

<table class="table table-striped">
<tr>
<th>Legend</th>
<th>Description</th>
* </tr>
<tr>
<td>Forced downward</td>
<td>Forced flow rate from upper to lower at P<sub>L</sub>-P<sub>U</sub> &lt; 0</td>
</tr>
<tr>
<td>Forced upward</td>
<td>Forced flow rate from lower to upper at P<sub>L</sub>-P<sub>U</sub> &gt; 0</td>
</tr>
<tr>
<td>Buoyancy upward</td>
<td>Total upward flow rate due to buoyancy only at P<sub>L</sub>-P<sub>U</sub> &lt; 0</td>
</tr>
<tr>
<td>Buoyancy downward</td>
<td>Total downward flow rate due to buoyancy only at P<sub>L</sub>-P<sub>U</sub> &gt; 0</td>
</tr>
<tr>
<td>Combined downward</td>
<td>Total downward flow at P<sub>L</sub>-P<sub>U</sub> &lt; 0 (Forced downward + buoyancy upward)</td>
</tr>
<tr>
<td>Combined upward</td>
<td>Total upward flow at P<sub>L</sub>-P<sub>U</sub> &gt; 0 (Forced upward + buoyancy downward)</td>
</tr>

</table>

![](EngineeringReference/media/image2743.svg.png)

Figure 152. Flow rates at different pressure differences

#### Wind pressure calculations

The wind pressure is determined by Bernoulli’s equation, assuming no height change or pressure losses:

<div>$${p_w} = {C_p}\rho \frac{{{V_{ref}}^2}}{2}$$</div>

where:

*p<sub>w  </sub>*            = Wind surface pressure relative to static pressure in undisturbed flow [Pa]

*ρ*                = Air density [kg/m<sup>3</sup>]

*V<sub>ref</sub>*             = Reference wind speed at local height [m/s]

*C<sub>p</sub>*              = Wind surface pressure coefficient [dimensionless]

*V<sub>ref</sub>* may be expressed as (Ref, Local Wind Speed Calculations):

<div>$${V_{ref}} = {V_{met}}{\left( {\frac{{{\delta_{met}}}}{{{z_{met}}}}} \right)^{{\alpha_{met}}}}{\left( {\frac{z}{\delta }} \right)^\alpha }$$</div>

*C<sub>p</sub>* is a function of location on the building envelope and wind direction. When Wind Pressure Coefficient Type = “INPUT”, the*C<sub>p</sub>* values are explicitly defined in the input for AirflowNetwork:Multizone:Wind Pressure Coefficient Values. When Wind Pressure Coefficient Type = “AVERAGE-SURFACE CALCULATION” and the building shape is rectangular, the program uses the following equations to calculate wind pressure coefficient (*C<sub>p</sub>*) values for different wind directions. For a low rise building, the normalized surface pressure coefficient may be written as (Swami and Chandra 1988):

<div>$${C_{p,n}} = 0.6*\ln \left[ \begin{array}{l}1.248 - 0.703\sin (\alpha /2) - 1.175{\sin ^2}(\alpha ) + 0.131{\sin ^3}(2\alpha G)\\ + \,0.769\cos (\alpha /2) + 0.07{G^2}{\sin ^2}(\alpha /2) + 0.717{\cos ^2}(\alpha /2)\end{array} \right]$$</div>

where

*C<sub>p,n</sub>*            = *C<sub>p</sub>* value at a given angle between wind direction and the outward normal of the surface under consideration [dimensionless]

α                = Angle between wind direction and outward normal of wall under consideration [deg]

*G*               = Natural log of the ratio of the width of the wall under consideration to the width of the adjacent wall [dimensionless]

*n*                = Index of incident angle at 30-degree increments

For walls of a high rise building, a two-dimensional array of surface-averaged wind pressure coefficients is generated based on wind incident angle and side ratio. The wind pressure coefficients are provided in 2001 ASHRAE Fundamentals Handbook, p. 16.5, Fig. 7, “Surface Averaged Wall Pressure Coefficients for Tall Buildings”. The original work was performed by Atkins et al. (1979). The incident angle has an increment of 30 degrees. The side ratio values are 0.25, 1.0, and 4.0. For a given incident angle and building aspect ratio, the program uses linear interpolation to calculate the corresponding wind pressure coefficient *C<sub>p,n</sub>*.

For the roof of a high rise building, a two-dimensional array of surface-averaged wind pressure coefficients is also generated based on wind incident angle and side ratio. The wind pressure coefficients are provided in 2001 ASHRAE Fundamentals Handbook, p. 16.6, Fig. 9, “Surface Averaged Roof Pressure Coefficients for Tall Buildings”. The original work was performed by Holmes (1986). The incident angle has an increment of 30 degrees. The side ratio values are 0.25, 1.0, and 4.0. At a given wind incident angle and building aspect ratio, the program uses linear interpolation to calculate the corresponding wind pressure coefficient *C<sub>p,n</sub>*.

The wind surface pressure at the given incident angle can be calculated by combining the above two equations:

<div>$${p_{w,n}} = {C_{p,n}}\rho \frac{{{V_{ref}}^2}}{2}$$</div>

#### Solution method

Based on the relationship between airflow rate and pressure drop for each component, a system of equations for all components can be assembled together in an n x n square matrix, where n is the number of nodes. Newton’s method is used to iteratively solve for the air pressure at each node. A new estimated vector for all node pressures, {P}\*, is computed from the current estimated vector of node pressures, {P}, by:

<div>$${\left\{ P \right\}^*} = \left\{ P \right\} - \left\{ C \right\}$$</div>

where the correction vector, {C}, is computed by the matrix relationship:

<div>$$\left[ J \right]\left\{ C \right\} = \left\{ B \right\}$$</div>

{B} is a column vector with each component given by:

<div>$${B_n} = \sum\limits_i {\mathop {{m_i}}\limits^ \bullet  } $$</div>

where n is the node number and i indicates all flow paths connecting node n to other nodes, and [J] is the square Jacobian matrix whose elements are given by:

<div>$${J_{n,m}} = \sum\limits_i {\frac{{\partial \mathop m\limits^ \bullet  }}{{\partial {P_m}}}} $$</div>

#### Convergence acceleration

The convergence tolerance is used to check the sum of the mass flow rates by applying mass conservation. The convergence acceleration equation shown below is used to correct the node pressures to more rapidly obtain a solution. By assuming a constant ratio of correction values from one iteration to the next, the following method is applied:

<div>$${P_n}^* = {P_n} - {C_n}/(1 - r)$$</div>

where

*r*     = the ratio of C<sub>n</sub> for the current iteration to its value for the previous iteration [dimensionless]

*C<sub>n</sub>*  = Correction value at the n<sub>th</sub> node [Pa]

*P<sub>n</sub>* <sub>   </sub> = Estimated pressure at the n<sub>th</sub> node [Pa]

*P<sub>n</sub><sup>\*</sup><sub></sub>*<sub>  </sub> = Corrected pressure at the n<sub>th</sub> node used in the next iteration [Pa]

This method is similar to a Steffensen iteration (Conte and de Boor 1972) which is used as a fixed-point iteration method for individual nonlinear equations.

The iteration correction method presented in the above equation gives a variable factor. When the solution is close to convergence, the solution method converges quadratically. By limiting cases where the value of r is less than some value, such as -0.5, the solution will not interfere with the rapid convergence. It has not been proven that the convergence acceleration equation will always lead to convergence, but it can be shown that it will not prevent convergence. Newton’s method converges when the estimated solution values are within some distance, called the radius of convergence, or the correct solution. Applying the convergence acceleration equation when -1 &lt; r &lt;0, will cause a smaller correction than Newton’s method, which therefore, can not force the iterations outside the radius of convergence. When r&lt;-1, the solution diverges in an oscillatory fashion. When r&gt;1, the solution also diverges, but in a nonoscillatory manner. For 0&lt;r&lt;1, the solution is approached from one direction. In all three cases, the convergence acceleration equation applies as long as r is truly constant over several iterations. However, for the last case, this involves a true extrapolation of correction factor which is very sensitive to the accuracy of r. This is most extreme for the case of r=1, which would cause an infinite correction.

### Node Temperature Calculations

A brief description of the air node temperature calculation is given below. A detailed description can be found in the work of Swami et al. (1992). The following equation is used to calculate temperature distribution across a duct element at the given airflow rate and inlet air temperature:

<div>$$\mathop m\limits^ \bullet  {C_p}\frac{{dT}}{{dx}} = UP(T{}_\infty  - T)$$</div>

where

*C<sub>p</sub>*  = Specific heat of airflow [J/kg•K]

<span>$\mathop m\limits^ \bullet  $</span>  = Airflow rate [kg/s]

*P*    = Perimeter of a duct element [m]

*T*    = Temperature as a field variable [°C]

<span>$T{}_\infty $</span>            = Temperature of air surrounding the duct element [°C]

*U*   = Overall heat transfer coefficient [W/m<sup>2</sup>•K]

<div>$$U = \frac{1}{{\frac{1}{{{h_i}}} + \frac{1}{{{h_o}}} + \sum {\frac{{{t_j}}}{{{k_j}}}} }}$$</div>

*h<sub>i</sub>*         = Inside heat transfer coefficient [W/m<sup>2</sup>•K]

*h<sub>o</sub>*<sub>                 </sub> = Outside heat transfer coefficient [W/m<sup>2</sup>•K]

*t<sub>j</sub>*          = Thickness at j-th layer [m]

*k<sub>j</sub>*          = Thermal conductivity at j-th layer [W/m•K]



The outlet air temperature at the end of the duct (x=L) is:

<div>$${T_o} = {T_\infty } + ({T_i} - {T_\infty })*\exp \left( { - \frac{{UA}}{{\mathop {m{C_p}}\limits^ \bullet  }}} \right)$$</div>

where

      *T<sub>i</sub>*         = Inlet air temperature [°C]

      *T<sub>o</sub>*         = Outlet air temperature [°C]

      *T<sub>∞</sub>*        = Temperature of air surrounding the duct element [°C]

      *A*          = Surface area (Perimeter \* Length) [m<sup>2</sup>]



The heat transfer by convection to ambient, *Q*, is:

<div>$$Q = \mathop m\limits^ \bullet  {C_p}({T_\infty } - {T_i})\left[ {1 - \exp \left( { - \frac{{UA}}{{\mathop {m{C_p}}\limits^ \bullet  }}} \right)} \right]$$</div>

The outlet air temperature can be calculated using the above equation at the given inlet air temperature. Since the inlet temperature at one linkage is the outlet temperature for the connected linkage, the outlet air temperatures at all nodes are solved simultaneously. A square linear system assembled by the AirflowNetwork model is expressed below:

<div>$$\{ M\} [T] = [B]$$</div>

where

      {M}       = Airflow matrix

      [T]        = Temperature vector

      [B]        = Given boundary conditions

The zone air temperatures and primary air loop component (fan and coils) outlet conditions are used as prescribed conditions in the AirflowNetwork model. In addition, the temperature difference across zone loop components (terminal units) is held constant during the calculations. For example, thermal zone temperatures calculated during the previous system time step are used as prescribed temperatures when calculating all other node temperatures. The zone air temperature is assumed constant (prescribed) throughout the AirflowNetwork iterative solution. The fan and coil outlet air temperatures, and terminal unit temperature differences are assumed constant within an AirflowNetwork iteration. The sensible heat gains calculated during the AirflowNetwork solution are then used to predict a new zone air temperature.

### Node Humidity Ratio Calculations

A brief description of the air node humidity ratio calculation is given below. A detailed description can found in the work of Swami et al. (1992). The following equation is used to calculate humidity ratio distribution across a duct element at the given airflow rate and inlet air humidity ratio:

<div>$$\mathop m\limits^ \bullet  \frac{{dW}}{{dx}} = {U_m}P(W{}_\infty  - W)$$</div>

where

<span>$\mathop m\limits^ \bullet  $</span>             = Airflow rate [kg/s]

*P   *            = Perimeter of a duct element [m]

*W  *            = Humidity ratio [kg/kg]

<span>$W{}_\infty $</span>           = Humidity ratio of air surrounding the duct element [kg/kg]

*U<sub>m</sub>*             = Overall moisture transfer coefficient [kg/m<sup>2</sup>•s]

<div>$${U_m} = \frac{1}{{\frac{1}{{{h_{m,i}}}} + \frac{1}{{{h_{m,o}}}} + \sum {\frac{{{t_j}}}{{{D_j}}}} }}$$</div>

*h<sub>m,i</sub>* <sub>                        </sub>             = Inside moisture transfer coefficient [kg/m<sup>2</sup>•s]

*h<sub>m,o               </sub>*<sub>                       </sub> = Outside moisture transfer coefficient [kg/m<sup>2</sup>•s]

*t<sub>j</sub>*                = Thickness at j-th layer [m]

D<sub>j</sub>               = Moisture diffusivity at j-th layer [kg/m•s]

The outlet air humidity ratio at the end of the duct (x=L) is:

<div>$${W_o} = {W_\infty } + ({W_i} - {W_\infty })*\exp \left( { - \frac{{{U_m}A}}{{\mathop m\limits^ \bullet  }}} \right)$$</div>

where

*W<sub>i</sub>*              = Inlet air humidity ratio [kg/kg]

*W<sub>o </sub>*            = Outlet air humidity ratio [kg/kg]

*A*                = Surface area (Perimeter \* Length) [m<sup>2</sup>]

The moisture transfer by convection to ambient, *Q<sub>m</sub>*, is

<div>$${Q_m} = \mathop m\limits^ \bullet  ({W_\infty } - {W_i})\left[ {1 - \exp \left( { - \frac{{{U_m}A}}{{\mathop m\limits^ \bullet  }}} \right)} \right]$$</div>

The outlet air humidity ratio can be calculated using the above equation at the given inlet air humidity ratio. Since the inlet humidity ratio at one linkage is the outlet humidity ratio for the connected linkage, the outlet air humidity ratio at all nodes are solved simultaneously. A square linear system assembled by the AirflowNetwork model is expressed below:

<div>$$\{ {M_m}\} [W] = [{B_m}]$$</div>

where

{M<sub>m</sub>}            = Airflow matrix

[W]             = Humidity ratio vector

[B<sub>m</sub>]                        = Given boundary conditions

The zone air humidity ratios and primary air loop component (fan and coils) outlet conditions are used as prescribed conditions in the AirflowNetwork model. For example, thermal zone humidity ratios calculated during the previous system time step are used as prescribed humidity ratios when calculating all other node humidity ratios. The zone air humidity ratio is assumed constant (prescribed) throughout the AirflowNetwork iterative solution. The coil outlet air humidity ratio is assumed constant within an AirflowNetwork iteration. The latent heat gains calculated during the AirflowNetwork solution are then used to predict a new zone air humidity ratio.

### Sensible and Latent Load Calculations

The zone sensible and latent loads calculated in the AirflowNetwork model consist of multizone, duct conduction and leakage. In addition, the impact of infiltration and mixing is accounted for in this calculation. The multizone load only includes incoming airflows from outside (infiltration) and other adjacent zones (mixing) with and without forced-air fan operation. It is divided into two terms: variable and constant. The constant term is the sum of the mass flow rate multiplied by the specific heat for both infiltration and mixing. The variable term includes the impact of zone and outdoor air temperature. Each of these terms is used in the zone energy balance equation. The sensible load items from the multizone load calculations may be written as follows:

<div>$$MC{P_{airflow}} = \mathop {{m_{\inf }}}\limits^\cdot  {C_p} + \sum {\left( {\mathop {{m_{mix}}}\limits^\cdot  {C_p}} \right)} $$</div>

<div>$$MCP{T_{airflow}} = \mathop {{m_{\inf }}}\limits^\cdot  {C_p}{T_{amb}} + \sum {\left( {\mathop {{m_{mix}}}\limits^\cdot  {C_p}{T_{zone}}} \right)} $$</div>

where

*MCP<sub>airflow</sub>* = Sum of air mass flow rate multiplied by specific heat for infiltration and mixing [W/K]

*MCPT<sub>airflow</sub>* = Sum of air mass flow rate multiplied by specific heat and temperature for infiltration and mixing [W]

<span>${\mathop m\limits^\cdot_{\inf }}$</span>           = Incoming air mass flow rate from outdoors [kg/s]

<span>${\mathop m\limits^\cdot_{mix}}$</span>          = Incoming air mass flow rate from adjacent zones [kg/s]

*T<sub>amb</sub>*            = Outdoor air dry-bulb temperature [°C]

*T<sub>zone</sub>*           = Adjacent zone air temperature [°C]

The latent load items from multizone load calculations may be written as follows:

<div>$${M_{airflow}} = \mathop {{m_{\inf }}}\limits^\cdot   + \sum {\mathop {{m_{mix}}}\limits^\cdot  } $$</div>

<div>$$M{W_{airflow}} = \mathop {{m_{\inf }}}\limits^\cdot  {W_{amb}} + \sum {\mathop {{m_{mix}}}\limits^\cdot  } {W_{zone}}$$</div>

where

*M<sub>airflow</sub>* = Sum of air mass flow rates for infiltration and mixing [kg/s]

*MW<sub>airflow</sub>* = Sum of air mass flow rate multiplied by humidity ratio for infiltration and mixing [kg/s]

<span>${\mathop m\limits^\cdot_{\inf }}$</span>           = Incoming air mass flow rate from outdoors [kg/s]

<span>${\mathop m\limits^\cdot_{mix}}$</span>          = Incoming air mass flow rate from adjacent zones [kg/s]

*W<sub>amb</sub>*           = Outdoor air humidity ratio [kg/kg]

*W<sub>zone</sub>*          = Adjacent zone air humidity ratio [kg/kg]

The air distribution system (ADS) loads due to duct conduction and leakage depend on the air distribution system component (e.g., duct) location. The air distribution system sensible and latent loads are calculated for each zone as follows:

<div>$${Q_{ADS,i}} = \sum\limits_j {{Q_{cond(i,j)}} + } \sum\limits_j {{Q_{leak(i,j)}}} $$</div>

<div>$${Q_{ADS,m,i}} = \sum\limits_j {{Q_{cond,m(i,j)}} + } \sum\limits_j {{Q_{leak,m(i,j)}}} $$</div>

where

*Q<sub>ADS,i</sub>*         = Total sensible load in the i-th zone due to ADS losses [W]

*Q<sub>cond(ij)</sub>*       = Duct wall conduction loss at the j-th duct located in the i-th zone [W]

*Q<sub>leak(ij)</sub>*        = Sensible supply leak loss at the j-th linkage located in the i-th zone [W]

*Q<sub>ADS,m,i</sub>*       = Total latent load in the i-th zone due to ADS losses [kg/s]

*Q<sub>cond,m(ij)</sub>*= Duct wall vapor diffusion loss at the j-th duct located in the i-th zone [kg/s]

*Q<sub>leak,m(ij)</sub>* = Latent supply leak loss at the j-th linkage located in the i-th zone [kg/s]

### Impacts of Supply Air Constant Volume Fan Control on Load: Cycling vs. Continuous

The AirflowNetwork model currently allows two types of constant volume fans: Fan:ConstantVolume and Fan:OnOff. The Fan:ConstantVolume object has only one type of supply air fan operation mode: continuous fan, cycling compressor (ContinuousFanWithCyclingCompressor). However, the Fan:OnOff has two types of supply air fan operation modes: cycling fan, cycling compressor (CyclingFanAndCompressor) or continuous fan, cycling compressor (ContinuousFanWithCyclingCompressor). The CyclingFanAndCompressor operation mode is frequently referred to as “AUTO fan”, where the compressor(s) and supply air fan operate in unison to meet the zone heating or cooling load, and cycle off together when the heating or cooling load has been met. The ContinuousFanWithCyclingCompressor operation mode is often referred to as “fan ON”, where the compressor(s) cycle on and off to meet the zone heating or cooling load but the supply air fan operates continuously regardless of compressor operation. The supply air fan operation mode is specified in an HVAC system object based on a given fan operation mode schedule (e.g., AirLoopHVAC:UnitaryHeatCool object).

The determination of the zone sensible and latent loads caused by multizone airflows and forced air distribution system operation is dependent on the supply air fan operation mode (see Sensible and Latent Load Calculations section above). The zone loads calculated by the AirflowNetwork model are added to zone sensible and latent balances in the ZonePredictorCorrector module to calculate zone air temperatures and humidity ratios (see Integration of the AirflowNetwork Model section below). For the case of continuous fan/cycling compressor, the zone loads during forced air distribution system operation are calculated with the system design air mass flow rate without modification, since the system air node conditions (temperature and humidity) reflect the average values for the time step considering the coil/fan on and off periods during the time step.

For the case of cycling fan/cycling compressor, where the forced air distribution system can operate for a portion of the simulation time step, the airflows are determined based on the air distribution system part-load ratio (ratio of the average air mass flow rate for the time step divided by the design air mass flow rate). The **airflows** for the AirflowNetwork:Distribution:Linkage objects are reported during the air distribution system on cycle, since no airflow is assumed during the system off cycle. The **airflows** for the AirflowNetwork:Multizone:Surface objects are weighted by the air distribution system part-load ratio. The **zone loads** are the sum of energy losses during both the air distribution system on and off cycle at each system time step. The energy losses when the air distribution system is on are calculated using the system “on” air flow rate multiplied by the air distribution system run time fraction. The energy losses when the air distribution system is off are obtained from the multizone airflow calculations (without forced air through the air distribution system) and these losses are multiplied by (1.0 - system run time fraction), assuming no airflows through the air distribution system when the fan is off. The formulas used to calculate airflows and zone loads are given below:

Airflow

Airflow = Airflow during ADS on cycle \* ADS Part-load ratio + Airflow during ADS off cycle \* (1.0 – ADS Part-load ratio)

where ADS = Air Distribution System

Zone load

System run time fraction = Maximum run time fraction of coils and fans in the air distribution system

Zone energy losses = Zone energy loss during ADS on cycle \* System run time fraction + Zone energy loss during ADS off cycle \* (1.0 - System run time fraction)

The calculation of loads due to multizone airflow, without forced air distribution system operation, is performed when the HVAC system is first simulated during a simulation time step (FirstHVACIteration = True). The calculation of loads due to air distribution system operation is performed on subsequent iterations within the same simulation time step when the mass flow rate at the supply air fan inlet is greater than 0.0 (and FirstHVACIteration = False).

### Airflow Calculation Procedure using A Supply Variable Air Volume Fan

The AirflowNetwork model currently also allows a variable air volume fan type as Fan:VariableVolume. The allowed terminal type is AirTerminal:SingleDuct:VAV:Reheat only. Other types of terminals will be added later.

In general, the supply fan air flow rate in a VAV central system is determined by a sum of terminal flow rates when the AirflowNetwork model is not applied. When the AirflowNetwork model is applied and the supply air fan flow rate is given, each terminal flow is determined by pressure resistance of each supply air pathway. It is possible that the delivered air flow rate from the pressure resistance at each terminal may be totally different from the desired flow rate determined by terminal units. Therefore, it is not easy to meet both requirements. The following compromised approach, including possible supply and return leaks in an air distribution system, is implemented.

1. Set up terminal airflows in the AirflowNetwork module based on the SimVAV subroutine in the HVACSingleDuctSystem module.

2.    Require AirflowNetwork:Distribution:Component:LeakageRatio objects to define supply leaks, so that the values of the Effective Leakage Ratio field are used to decide the supply fan flow rates. The base of the ratio will be actual supply fan flow rate, instead of the maximum fan flow rate used in the constant volume fan systems.

3.    Assign the supply fan airflow rate based on the sum of all terminal flow rates and all supply leak ratios until it reaches the maximum fan flow rate

<div>$${\dot m_{fan}} = \frac{{\mathop \sum \nolimits_i^n {{\dot m}_{i,terminal}}}}{{1 - \mathop \sum \nolimits_j^k {F_j}}}$$</div>

where

<span>${\dot m_{fan}}$</span>          = The supply fan flow rate

<span>${\dot m_{i,terminal}}$</span>    = The flow rate at the ith terminal, which is determined in the subroutine SimVAV in the HVACSingleDuctSystem module

n    = Number of terminals

<span>${F_j}$</span> = The fraction of the supply fan flow rate at the jth supply leak, given in the AirflowNetwork:Distribution:Component:LeakageRatio objects.

k    = Number of supply leaks

4.    If the calculated supply fan flow rate is above the maximum limit of the supply fan flow rate, and the supply leak ratios remain the same, the supply fan flow rate is set to the maximum limit, and the terminal flow rates are reduced proportionally weighted by a ratio of the maximum supply fan flow rate by input to the calculated supply fan flow rate. Therefore, a sum of all terminal rates and all supply leak rates is equal to the maximum supply fan rate. *** ***

<div>$$R = \frac{{{{\dot m}_{fan,max}}}}{{{{\dot m}_{fan,cal}}}}$$</div>

<div>$${\dot m_{i,terminal,final}} = {\dot m_{i,terminal}}*R$$</div>

where

R    = The ratio of the maximum fan flow rate given in the inputs to the requested fan flow rate based on the above equation

<span>${\dot m_{fan,max}}$</span>      = The maximum supply fan flow rate by input

<span>${\dot m_{fan,cal}}$</span>       = The calculated supply fan flow rate

<span>${\dot m_{i,terminal,final}}$</span>           = The final flow rate at each terminal adjusted by the ratio

### Integration of the AirflowNetwork Model

The loads calculated by the AirflowNetwork model are integrated into the EnergyPlus heat balance equation in a similar manner as described elsewhere in this document in the section “Basis for the Zone and System Integration”. The mass flow rate summations and sensible and latent loads described in the previous section are included in the calculation of zone temperature and humidity ratio.

The revised zone temperature update equation becomes:

<div>$$T_z^t = \frac{{\sum\limits_{i = 1}^{{N_{sl}}} {\mathop {{Q_i}}\limits^ \bullet  }  + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} {A_i}{T_{si}} + MCPTairflow + {{\mathop m\limits^ \bullet  }_{sys}}{C_p}{T_{{\rm{supply}}}} + QADS,z - \left( {\frac{{{C_z}}}{{\delta t}}} \right)\left( { - 3T_z^{t - \delta t} + \frac{3}{2}T_z^{t - 2\delta t} - \frac{1}{3}T_z^{t - 3\delta t}} \right)}}{{\left( {\frac{{11}}{6}} \right)\frac{{{C_z}}}{{\delta t}} + \sum\limits_{i = 1}^{{N_{surfaces}}} {{h_i}} A + MCPairflow + {{\mathop m\limits^ \bullet  }_{sys}}C}}$$</div>

Where MCPT<sub>airflow</sub> is the sum of mass flow rate multiplied by specific heat and temperature for infiltration and mixing, Q<sub>ADS,z</sub> is the added total sensible load in the zone due to Air Distribution System losses, and MCP<sub>airflow</sub> is the sum of mass flow rate multiplied by specific heat for infiltration and mixing as calculated in the AirflowNetwork model described above.

The revised coefficient (B) used in the zone humidity ratio calculation is shown below:

<div>$$B = \sum {k{g_{mas{s_{{\rm{Sched Loads}}}}}}}  + M{W_{airflow}} + {\dot m_{sy{s_{in}}}}{W_{sys}} + \sum\limits_{i = 1}^{surfs} {{A_i}{h_{mi}}{\rho_{ai{r_z}}}{W_{surf{s_i}}}}  + QADS,m,z$$</div>

Where MW<sub>airflow</sub> is the sum of mass flow rate multiplied by humidity ratio for infiltration and mixing and Q<sub>ADS,m,z\\  </sub>is the added total latent (moisture) load in the zone due to Air Distribution System losses from the AirflowNetwork model described above. This coefficient is used in the prediction of moisture as described in the section “Moisture Predictor-Corrector” found elsewhere in this document.

### Model Output

The available outputs from the AirflowNetwork model are described in the EnergyPlus Input Output Reference manual.

### Occupant Ventilation Control

The AirflowNetwork:OccupantVentilationControl object enhances the AirflowNetwork model and provides more practical and advanced controls for window opening and closing operations, based on Marais & Teichmann (2014). This control includes minimum open and closed time control, indoor thermal comfort control, and opening and closing probability controls.

#### Procedures of occupant ventilation control

It should be pointed that the open elapsed time and closed elapsed time are not independent. In other words, when one of the elapsed times value is greater than 0, then other elapsed time value must be equal to 0. The model is either tracking a window as open, in which case the open elapsed time grows, or as closed, in which case the closed elapsed time grows. 

The calculation procedures are presented in the following steps:

Step 1: Open elapsed time check 

The model checks the open elapsed time first. When the open elapsed time is greater than 0 and less than the minimum opening time, a window will remain open. Otherwise, the model goes to Step 2.  

    Open elapsed time > minimum open time

Step 2: Closed elapsed time check 

This step checks the closed elapsed time. When the closed elapsed time is greater than 0 and less than the minimum closed time, a window will remain closed. Otherwise, the model goes to Step 3. 

    Closed elapsed time > minimum closed time

Step 3: Elapsed time only? 

When either the open elapsed time or the closed elapsed time is long enough (greater than the minimum time) and no other checks are needed, the model returns to the other ventilation control defined in the Ventilation Control Mode field in AirflowNetwork:MultiZone:Zone or AirflowNetwork:MultiZone:Surface. If other checks are needed, the following steps will be performed. 

Step 4: Thermal comfort temperature calculation 

The thermal comfort check requires the thermal comfort temperature and the comfort band. The comfort temperature of Tcomf is calculated as a function of the outdoor dry-bulb temperature Tout. The comfort temperature calculation may be based on two curves and a boundary temperature point. 

<div>$$
  T_{comf} = \left\{ \begin{array}{ll} \rm{Low Temp Curve,} & \min T_{out} < x \leq \rm{Boundary Point} \\ \rm{High Temp Curve,} & \rm{Boundary Point} \leq x < \max T_{out}  \end{array}\right.
$$</div>

Step 5: Thermal band calculation 

The comfort band is calculated as a function of the design personal dissatisfaction PPD. 

<div>$$\theta = -0.0028 \left(100-\rm{PPD}\right)^2 + 0.3419 \left(100-\rm{PPD}\right) – 6.6275 $$</div>

This equation is valid for PPD 0% to 35%

Step 6: Upper boundary check of thermal comfort 

After calculation of the comfort temperature and band, the thermal comfort check will be performed using the zone air operative temperature Tg. The check consists of upper and lower boundary checks.

The upper boundary check checks window opening status and uses the following logic:

<div>$$T_g > \left(T_{comf} + \theta\right)$$</div>

If the above logic check is true, the opening probability check will be performed. The detailed description is given in the opening probability section. 

If the above logic check is false, no action is needed.

If the opening probability check is true and upper boundary check is satisfied, a window will be opened, regardless of open/closed status at the previous time step. If the opening probability check is false and upper boundary check is satisfied, a window will remain at the status from the previous time step.

<div>$$T_g > \left(T_{comf} + \theta\right) \&\& \rm{OpeningProbability}$$</div>

Step 7: Lower boundary check of thermal comfort 

The lower boundary check will follow the upper boundary check to check the window closing status, using the following logic.

<div>$$T_g < \left(T_{comf} - \theta\right)$$</div>

If the above logic check is true, the closing probability check will be performed. The detailed description is given in the closing probability section. 

If the above logic check is false, no action is needed.

If the closing probability check is true and lower boundary check is satisfied, a window will be closed, regardless of open/closed status at the previous time step. If the closing probability check is false and lower boundary check is satisfied, a window will remain at the status from the previous time step.

<div>$$T_g < \left(T_{comf} - \theta\right) \&\& \rm{ClosingProbability}$$</div>

The output variables from the model are open status, opening probability status, and closing probability status. The detailed description of opening status is given in the Airflow Network Outputs section in the Input Output Reference.

Note: The upper and lower boundary checks are not independent. In other words, when one of boundary check is satisfied, the other check will be dissatisfied.  
 
#### Procedures of opening probability control

Opening probability control provides an optional random number check. The control logic of opening probability is described in the following steps.

Step 1: Closed elapsed time check 

This check requires that closed elapsed time is longer than the minimum closing time. 

Closed time > minimum closed time

If the time duration is not long enough, the output is false so that a window remains closed. 

If the time duration is long enough, an occupancy check is performed.

Step 2: Occupancy check 

If a zone is not occupied and the occupancy check is requested, the output is false. If the zone is occupied, the next step is to check the setpoints using zone air temperature at the previous time step as a reference. 

Step 3: Setpoint check 

There are 5 temperature control types. The following types are available:

* No control: Bypass

* Single heating setpoint: If Tzon > setpoint, go to next step. Otherwise, return false.

* Single cooling setpoint: If Tzon < setpoint, go to next step. Otherwise, return false.

* Single heating and cooling setpoint: no action by returning false

* Dual heating and setpoints: If heating setpoint < Tzon < Cooling setpoint, go to next step. Otherwise, return false.

Step 4: Select bypass or opening probability check 

A choice is provided at this stage so that the opening probability check may be performed or bypassed. If bypassed, the output will be true to open a window. If performed, probability will be determined from a schedule. 

Step 5: Perform opening probability check 

The opening probability (OP) value is determined from a schedule.

OP = Schedule value or specific function

If the probability value is greater than a random number, the output is true. 

OP > random number (random number is between 0 and 1)

Otherwise, the result will be false.    

#### Procedures of closing probability control

The control logic of closing probability is described as follows. 

Step 1: Open elapsed time check 

This check requires that open elapsed time is longer than the minimum opening time.
 
Open time > minimum open time

If the time duration is not long enough, the output is false and the window remains open. Otherwise, Step 2 will be performed.

Step 2: Select by-pass or closing probability check 

A choice is provided at this step so that the closing probability check may be performed or bypassed. If bypassed, the output will be true to close a window. If performed, the closing probability will be calculated. The closing probability (CP) value is given from a schedule.

CP = Schedule value or specific function

If the closing probability check is performed and the closing probability is greater than a random number, the output is true. 

CP > random number (random number is between 0 and 1)

Otherwise, the result will be false.    


### References

Atkins, R. E., J. A. Peterka, and J. E. Cermak. 1979. “Averaged pressure coefficients for rectangular buildings,” Wind Engineering, Proceedings of the Fifth International Conference 7:369-80, Fort Collins, CO. Pergamon Press, NY.

Bolmqvist, C. and M. Sandberg, 2004, “Air Movements through Horizontal Openings in Buildings – A Model Study,” International Journal of Ventilation, Vol. 3, No. 1, pp. 1-9

COMIS Fundamentals. 1990. Edited by Helmut E. Feustel and Alison Rayner-Hooson, LBL-28560, Lawrence Berkeley Laboratory, Berkeley, CA

Conte, S. D. and C de Boor. 1972.Elementary Numerical Analysis: an Algorithmic Approach, McGraw-Hill.

Cooper, L., 1989, “Calculation of the Flow Through a Horizontal Ceiling/Floor Vent,” NISTIR 89-4052, National Institute of Standards and Technology, Gaithersburg, MD

Dols, W. S. & G. N. Walton. 2002. “CONTAMW 2.0 User Manual,” NISTIR 6921, National Institute of Standards and Technology, Gaithersburg , Maryland

Holmes, J. D. 1986. Wind Loads on low-rise buildings: The structural and environmental effects of wind on buildings and structures, Chapter 12, Faculty of Engineering, Monash University, Melbourne, Australia

Marais, J. M. & C. Teichmann, “Window Simulation Methods Required for Manual Window Ventilated Buildings,” Fifth German-Austrian IBPSA Conference, September 22-24, 2014, RWTH Aachen University, Germany 

Swami, M. V. and S. Chandra. 1988. Correlations for pressure distribution on buildings and calculation of natural-ventilation airflow, ASHRAE Transactions 94(1988) (Pt 1), pp. 243-266.

Swami, M. V., L. Gu, & V. Vasanth. 1992. “Integration of Radon and Energy Models for Building,” FSEC-CR-553-92, Florida Solar Energy Center, Cocoa, Florida

Tan, Q. and Y. Jaluria, 1992, “Flow through Horizontal Vents as Related to Compartment Fire Environments,” NIST-GCR-92-607, National Institute of Standards and Technology, Gaithersburg, Maryland

Walton, G. N. 1989. “AIRNET – A Computer Program for Building Airflow Network Modeling,” NISTIR 89-4072, National Institute of Standards and Technology, Gaithersburg, Maryland

Walton, G. N. & W. S. Dols. 2003. “CONTAM 2.1 Supplemental User Guide and Program Documentation,” NISTIR 7049, National Institute of Standards and Technology, Gaithersburg, Maryland
On-Site Generation
==================

Electric Load Center Distribution Manager
-----------------------------------------

### Overview

The electric load center distribution manager (object name: ElectricLoadCenter:Distribution) operates on-site generators specified in the simulation and reports the amount of generated and purchased electricity. Electric load centers really serve as a “load” to the generators and “supply” power to the rest of the building. The internal meters used by EnergyPlus for reporting do all of the demand tracking. For more details on the individual inputs required see the Input Output Reference document.

The electric load center manager sums all of the building and system electric loads and provides operating schemes for the generators. The electric load center objects are operated in the order they are defined in the input data file (IDF), and generators are dispatched sequentially in the order they are specified within each load center object. The electricity produced from photovoltaic arrays is handled somewhat separately and is always “used” to reduced the demand that the generators will try to meet for that time step. What is not provided by the on-site generation equipment, and electric storage units if specified, is met by (purchasing) off-site electricity.

The available operating schemes are “Baseload”, “DemandLimit”, “TrackElectrical,” “TrackSchedule,” “TrackMeter,” “FollowThermal” and “FollowThermalLimitElectrical.”  These operating schemes affect how loads are dispatched to the generators, in effect telling the generators whether or not to run and requesting power levels.

The BASELOAD scheme operates the generators at their rated (requested) electric power output when the generator is scheduled ON (ref. ElectricLoadCenter:Generators in the Input Output Reference). The Baseload scheme requests all generators scheduled ON (available) to operate, even if the amount of electric power generated exceeds the total facility electric power demand.

The DEMAND LIMIT scheme limits the amount of purchased electricity from the utility to the amount specified in the input. The Demand Limit scheme tries to have the generators meet all of the demand above the purchased electric limit defined by the user.

The TRACK ELECTRICAL scheme tries to have the generators meet all of the electrical demand for the building.

The TRACK METER scheme tries to have the generators meet all the electrical demand from a meter chosen by the user rather than the usual meter for the entire facility. The meter can be a custom meter so that generators are tied to only certain loads in the building.

The TRACK SCHEDULE scheme tries to have the generators meet all of the electrical demand determined by a user-defined schedule.

The FOLLOW THERMAL and FOLLOW THERMAL LIMIT ELECTRICAL schemes run the generators to meet thermal demand. The thermal demand is determined from the plant modeling and depends on the flow requested by other components on the demand side of the plant loop, the loop temperatures, and the loop temperature setpoint. The electric load center distribution manager converts the thermal load to an electrical load using a nominal ratio of the thermal to electrical power production for each generator. For these schemes, the generator needs to be connected to the supply side of a plant loop and serve components that use hot water on the demand side of the plant loop. The thermal load request is obtained from the plant data structure (structure location in code is PlantLoop%LoopSide%Branch%Comp%MyLoad).The distribution manager converts the thermal load, <span>${q_{thermal}}$</span>, to an electrical load using:

<div>$${q_{Elect}} = \frac{{{q_{thermal}}}}{{ThermElectRatio}}$$</div>

where,

<span>$ThermElectRatio$</span> is a nominal, constant, user-defined value for the ratio of thermal production to electrical production for a cogenerator. This ratio is used for supervisory control and dispatch of the electric power request to the generator; however, the cogenerator model may determine that actual performance varies from this nominal value at different times in the simulation when operating conditions differ from those used for the nominal ratio.

For all operating schemes except BASELOAD, a total electric load reduction target (or thermal load converted to electrical equivalent) is established for the load center based on the specific operating scheme. The load center then requests that its generators operate, one-by-one in the order specified, until the target is met or exceeded. Generators that are not scheduled as ‘available’ for the simulation time step are not called to operate. The requested power demand to be met by each generator is the **smaller of** the nominal ‘rated’ electric power output (as specified in the ElectricLoadCenter:Generators object) or the remaining total electric load reduction target for the load center. After each electric generator is requested to operate, the actual electric power delivered by the generator, which may be greater than or less than the requested amount due to inputs specified in the generator performance model (e.g., Generator:CombustionTurbine, Generator:MicroTurbine, etc.), is used to update the remaining total electric power target for the other generators associated with this load center.

Most of the operating schemes will sequentially load the available electric load centers and generators. EnergyPlus can accept multiple “ElectricLoadCenter:Distribution” objects with different operating schemes. Because of this, there are two levels of reporting, one for the whole building and a second for each load center. The whole-building results are managed with the internal meters for the entire model. The individual load-center results are summed for those generators connected to a particular load center. The total electricity purchased is reported both in power and energy units. This value is positive when the amount of energy is purchased from the utility. This value can be negative when the total electricity produced is greater than the facility electrical needs. The excess will either be available for storage or to sell back to the electric utility company.

The order of input objects (ElectricLoadCenter:Distribution) in the input file is significant and used to structure how generators are dispatched with the first load centers and generators managed before the later ones. Therefore, load centers listed earlier in the file effectively have a higher priority.

Electric load centers can have one of five different configurations. Load centers can get fairly complicated and include power conditioning and storage. Separate inverter models are used to condition DC power from photovoltaics into AC power for the building and utility. Load centers serving PV need to be specified with a direct current buss. The other generators may have inverters inside the devices but these are already embedded in the generator models. The load center can also manage electrical storage (ref. Electrical Storage below).

The most basic configuration is selected with the keyword “Alternating Current” for the Electrical Buss Type, shown in the following diagram.

![ACtopology](EngineeringReference/media/image7480.png)

Figure 333. Basic Alternating Current Schematic

The *AlternatingCurrent* load centers have AC generators with no storage and behave in the following way. All electric demand not met by the sum of the electrical power produced by the available generators will be met by purchased electricity. If a generator is needed in the simulation for a small load and the load is less than the generator’s minimum part load ratio, the generator will operate at the minimum part load ratio and the excess will either reduce demand or the excess energy will be exported back to the electric utility company. The purchased electrical demand limit is the user input for the demand limit above which the generators will try and meet the entire electrical load on the building. It is possible to prescribe a set of ElectricLoadCenter:Distribution objects with inconsistent or conflicting operating schemes, so users need to be careful.

A configuration with AC generators with on-site electrical storage is selected with the keyword “AlternatingCurrentWithStorage” and is shown in the following diagram.



![ACwithStorageTopology](EngineeringReference/media/image7481.png)

Figure 334. AC Generators with On-site Electrical Storage Schematic

The *AlternatingCurrentWithStorage* load centers attempt to augment the generator electricity production so that the power requests are met. Storage control logic is discussed below under Electrical Storage.

The basic configuration for photovoltaic generators is selected using the “DirectCurrentWithInverter” keyword and is shown in the following diagram.



![DCwithInverterTopology](EngineeringReference/media/image7482.png)

Figure 335. Direct Current With Inverter Photovoltaic Generators Schematic

The *DirectCurrentWithInverter* load centers collect DC power from various PV arrays, run the DC power through an inverter and produce AC power. The PV arrays produce DC power based on the availability of sunshine and do not respond to load requests made by the electric load center. The AC output from the inverter is what is recorded as electricity production.

If the PV-based load center is equipped with DC electrical storage that is connected before the inverter, then the buss type should be “DirectCurrentWithInverterDCStorage” and is shown in the following diagram.



![DCwithInverterDCStorageTopology](EngineeringReference/media/image7483.png)

Figure 336. PV based Load Center with DC Electrical Storage Schematic

The *DirectCurrentWithInverterDCStorage* load centers charge or draw DC power to meet the requested electrical load.

If the PV-based load center is equipped with AC electrical storage that is connected after the inverter, then the buss type should be “DirectCurrentWithInverterACStorage” and is shown in the following diagram.



![DCWithInverterACStorage](EngineeringReference/media/image7484.png)

Figure 337. PV Based Load Center with AC Electrical Storage Schematic

The *DirectCurrentWithInverterACStorage* load centers charge or draw AC power to meet the requested electrical load.

### Electric Load Center Generators

The electric load center generators (object name: ElectricLoadCenter:Generators) provide a set of scheduled electric generators for electric power generation. Here is where the user lists what generators and PVs are available at any given time. For more details on the individual inputs required see the EnergyPlus Input Output Reference.

### Inverters

EnergyPlus includes three models for converting Direct Current (DC) electrical power into Alternating Current (AC) electrical power. The DC power into the inverter, <span>${P_{DC - in}}$</span>, is converted to AC power out, <span>${P_{AC - out}}$</span>, of the inverter using:

<div>$${P_{AC - out}} = {P_{DC - in}} \cdot {\varepsilon_{inverter}}$$</div>

The inverter efficiency is determined using one of the three models. For the“Simple” inveter model, efficiency is constant and input by the user. For the “Look Up Table” model, the efficiency is calculated using linear interpolation. For the “Function of Power” model, the efficiency is calculating using a single-variable curve object. For both the Look Up Table and Function of Power models, the power production is normalized by <span>${P_{DC - in}}$</span>.

The thermal losses are calculated from the difference between <span>${P_{DC - in}}$</span> and <span>${P_{AC - out}}$</span>.

### Electrical Storage

EnergyPlus includes two models for storing electrical energy: a simple model that is not intended to represent any specific type of storage technology and a battery model that represents the kinetic battery model originally developed by Manwell and McGowan.

The simple model might be called “constrained bucket with energy losses.”  The “bucket” holds a quantity of Joules of electrical energy, refered to as the state of charge. There are losses and limits to storing and drawing power but otherwise the bucket just holds electricity. The user sets constraints on the rates of charging,<span>${P_{stor - {\rm{charge - max}}}}$</span>, and drawing, <span>${P_{stor - {\rm{d}}raw{\rm{ - max}}}}$</span>. The user defines efficiencies for charging,<span>${\varepsilon_{{\rm{charge}}}}$</span>, and drawing, <span>${\varepsilon_{draw}}$</span>. The user defines an initial state of charge and a maximum state of charge.

The storage control algorithms determine a value for the charging power, <span>${P_{stor - ch\arg e}}$</span>, or the drawing power, <span>${P_{stor - draw}}$</span>. The basic storage control algorithm is to compare the requested generator electricity loads to the current available supply and make up the difference with storage. If extra power is generated, then store it. If there is a shortage, then attempt to draw from storage to meet the remaining electricity request. The load center dispatchs a requested electric load for each generator, runs each generator, and then stores the actual power. This power dispatch can be a function of many different things depending on the operating scheme. The sum of the generator load requests,<span>${P_{load - request}}$</span>, is then compared to the sum of the generator production, <span>${P_{{\rm{gen}} - {\rm{supply}}}}$</span>

<div>$$IF\quad ({P_{load - request}} < {P_{gen - \sup ply}})\quad {P_{stor - ch\arg e}} = {P_{gen - \sup ply}} - {P_{load - request}}$$</div>

<div>$$IF\quad ({P_{load - request}} > {P_{gen - \sup ply}})\quad {P_{stor - draw}} = {P_{load - request}} - {P_{gen - \sup ply}}$$</div>

The limits <span>${P_{stor - {\rm{charge - max}}}}$</span> and <span>${P_{stor - {\rm{d}}raw{\rm{ - max}}}}$</span> are applied.

If charging, the new state of charge, <span>$Q_{stor}^{t + \Delta t}$</span>, is determined using:

<div>$$Q_{stor}^{t + \Delta t} = Q_{stor}^t + {P_{stor - ch\arg e}} \cdot {\varepsilon_{{\rm{charge}}}} \cdot \Delta t$$</div>

If drawing, the new state of charge is:

<div>$$Q_{stor}^{t + \Delta t} = Q_{stor}^t - \frac{{{P_{stor - draw}} \cdot \Delta t}}{{{\varepsilon_{draw}}}}$$</div>

Where <span>$\Delta t$</span> is the length of the system time step in seconds.

The storage device has an availability schedule. If it is not available then no power can be drawn or stored.

The gross electric power drawn and stored includes losses in the form of heat. These thermal losses are calculated from the user-specified efficiencies for charging and drawing and gross electric power stored and drawn. The thermal (heat) losses are included in a zone heat balance if the user specifies a thermal zone. A user-defined radiative split is used to divide thermal losses into radiation and convection portions. If no zone is specified, then the thermal losses are simply disregarded (e.g., rejected to outdoors and do not impact the zone air heat balance).

### Electrical Storage – Kinetic Battery Model

The Kinetic Battery Model (KiBaM) (object: ElectricLoadCenter:Storage:Battery) was originally developed by Manwell and McGowan (1993) for use in time series performance models of hybrid energy systems. The model is called kinetic because it is based on a chemical kinetics process to simulate the battery charging and discharging behavior. The model, with different improvements and modifications, has been incorporated into the software Hybrid2 and HOMER as the electrical storage module of hybrid and distributed power systems. In 2005, KiBaM was implemented as a stand-alone application in support of the European Union Benchmarking research project (Bindner et al. 2005).

The Kinetic Battery Model assumes that the battery charge is distributed over two tanks: an available-charge tank and a bound-charge tank. The tank for available charges can supply electrons directly to the load, whereas the tank for chemically bound charges can only supply electrons to the available-charge tank. At any time, the total charge <span>$q$</span> in the battery is the sum of the available charge (<span>${q_1}$</span>) and bound charge (<span>${q_2}$</span>). That is:

<div>$$q = {q_1} + {q_2}$$</div>

Based on the governing equations on the change of charge in both tanks (Manwell and McGowan 1993), the battery capacity can be related to a constant charge/discharge current (<span>$I$</span>) as the following equation:

<div>$${q_{\max }}(I) = \frac{{{q_{\max }}k \cdot c \cdot t}}{{1 - {e^{ - kt}} + c(kt - 1 + {e^{ - kt}})}}$$</div>

where,

<span>${q_{\max }}(I)$</span>  : Maximum capacity (Ah) at charge or discharge current I

<span>${q_{\max }}$</span>       : Maximum capacity (Ah) at infinitesimal current

<span>$t$</span>            : Charge or discharge time (hr), defined by <span>$t = \frac{{{q_{\max }}(I)}}{I}$</span>

<span>$k$</span>           : Constant coefficient (hr<sup>-1</sup>)

<span>$c$</span>           : Parameter indicating the ratio of available charge capacity to total capacity

Assuming that a constant current is used in any time step for charging and discharging, the available charge (<span>${q_1}$</span>) and bound charge (<span>${q_2}$</span>) at any time step are given by:

<div>$${q_1} = {q_{1,0}}{e^{ - k\Delta t}} + \frac{{({q_0}kc - I)(1 - {e^{ - k\Delta t}})}}{k} - \frac{{Ic(k\Delta t - 1 + {e^{ - k\Delta t}})}}{k}$$</div>

<div>$${q_2} = {q_{2,0}}{e^{ - k\Delta t}} + {q_0}(1 - c)(1 - {e^{ - k\Delta t}}) - \frac{{I(1 - c)(k\Delta t - 1 + {e^{ - k\Delta t}})}}{k}$$</div>

where,

<span>${q_{1,0}}$</span>  :  Available charge at the beginning of time step (Ah)

<span>${q_{2,0}}$</span> :  Bound charge at the beginning of time step (Ah)

<span>${q_0}$</span>   :  Total charge at the beginning of time step (Ah), <span>${q_0} = {q_{1,0}} + {q_{2,0}}$</span>

<span>$\Delta t$</span>   :  Length of time step (hr)

KiBaM views the battery as a voltage source in series with an electric resistance (Figure 338). The internal resistance is assumed to be constant and the open circuit voltage varies with current and state of charge.

![](EngineeringReference/media/image7528.svg.png)

Figure 338. Electrical equivalent model for KiBaM

The battery’s open circuit voltage is modeled in the same form for charging and discharging, but with different coefficients. The open circuit voltage in charging (<span>${E_c}$</span>) and in discharging (<span>${E_d}$</span>) can be respectively expressed as:

<div>$${E_c} = {E_{0,d}} + {A_c}{X_c} + \frac{{{C_c}{X_c}}}{{{D_c} - {X_c}}}$$</div>

<div>$${E_d} = {E_{0,c}} + {A_d}{X_d} + \frac{{{C_d}{X_d}}}{{{D_d} - {X_d}}}$$</div>

where,

<span>${E_{0,c}}$</span>               : Open circuit voltage for a fully charged battery

<span>${E_{0,d}}$</span>               : Open circuit voltage for a fully discharged battery

<span>${A_c}$</span>, <span>${C_c}$</span>, <span>${D_c}$</span>   : Constant parameters for charging

<span>${A_d}$</span>, <span>${C_d}$</span>, <span>${D_d}$</span>  : Constant parameters for discharging

<span>${X_c}$</span>, <span>${X_d}$</span>        : Normalized maximum capacity at a given charging or discharging current, calculated as:

<div>$$
  X = \left\{
    \begin{array}{cl}
      q_0 / q_{max}(I) & \; (charging) \\
      (q_{max}-q_0)/q_{max}(I) & \; (discharging)
    \end{array}
  \right.
$$</div>

It needs to be noted that the performance curve (Curve:RectangularHyperbola2) used in the model input covers the 2<sup>nd</sup> and the 3<sup>rd</sup> item of the open circuit voltage equation. Due to the reformatting of performance curve, the voltage function regression coefficients can map to the curve coefficients as follows:

<span>${C_1} =  - C$</span> ;<span>${C_2} =  - D$</span>;<span>${C_3} = A$</span>

With open circuit voltage, the battery terminal voltage (V) can be calculated as:

<div>$$V = E - IR$$</div>

where, R is the battery internal resistance in Ohms; the current is positive for discharging and negative for charging.

Given desired power in/out of the battery, the desired charge or discharge current can be calculated from the basic power equation: <span>$P = VI$</span>. In this calculation, iteration is needed to ensure the electric current has converged and the battery operation satisfies all specified technical constraints such as maximum discharge current and charge rate limit.

KiBaM assumes that battery life is a primary function of charge/discharge cycles. One cycle is defined as the process of starting from a certain state of charge (SOC), the battery is discharged to a lower SOC and then recharged back to the starting SOC. It is regarded that the magnitude of cycle plays more important than the average of SOC during the cycle. This means that in terms of the impact on battery life, the cycle from 90% to 70% and then recharge back to 90% of SOC is equivalent to another cycle from 50% to 30% and then recharge back to 50% of SOC.  Battery life in terms of the number of cycles is predicted as a function of the cycle range measured by the fractional depth of discharge. A double exponential equation is used to capture the damage to batteries due to cycling. The equation takes the following form where the coefficients need to be derived from battery test data via curve fitting.

<div>$${C_F} = {C_1} + {C_2}{e^{{C_3}R}} + {C_4}{e^{{C_5}R}}$$</div>

where,

<span>${C_F}$</span>    :    Cycles to failure

<span>${C_1}$</span>-<span>${C_5}$</span>:    Regression coefficients

R       :    Cycle range in terms of fractional SOC

Following Hybrid2, the rainflow counting method (Downing and Socie 1982) is used to count battery cycles within a state of charge time series. Based on the number of cycles for each fractional SOC range, the battery damage is estimated as:

<div>$$D = \sum\limits_{i = 1}^{} {\left( {{N_i}\frac{1}{{{C_{F,i}}}}} \right)} $$</div>

where,

D    : Fractional battery damage. For example, a value of 0.5 at the end of simulation means that half of the battery life is used up after the length of the simulation period.

<span>${C_{F,i}}$</span>: Number of cycles to failure for the i-th cycle range

<span>${N_i}$</span>  : Total number of cycles over the simulation with the i-th cycle range

It needs to be noted that the temperature effects on battery performance and battery self-discharge are not supported in the current model.

#### References

Bindner H., Cronin T., Lundsager P., Manwell J.F., Abdulwahid U., and Baring-Gould I. 2005. Lifetime Modeling of Lead Acid Batteries. Riso National Laboratory, Roskilde, Denmark.

Downing S. D. and Socie D. F. 1982.  Simple rainflow counting algorithms, International Journal of Fatigue, 1982.

Manwell J. F. and McGowan J. G. 1993. A lead acid battery storage model for hybrid energy systems, Solar Energy 50(5): 399- 405.

### Electric Load Center Transformers

Transformers (object name: ElectricLoadCenter:Transformer) are an integral part of the electric distribution system. They have two broad applications closely related to building energy simulation. First, transformers are used to lower the voltage of electricity from utility primary circuits to customer secondary circuits, and in this case they are called distribution transformers. Second, transformers are used to output the surplus power from onsite generators to the electricity grid.

Distribution transformers reduce the voltage on utility distribution lines (34.5 kV or less) to a lower secondary voltage (600 V or less) suitable for customer equipment. Distribution transformers are usually categorized according to the medium used for cooling and insulation (liquid or air), the voltage class that they serve (low or medium), and the number of phases (single phase or three phase).

Liquid-immersed transformers rely on oil or other fire resistant liquid around the coils for cooling. In contrast, dry type transformers rely only on the natural convection of air for insulation and cooling. Medium-voltage transformers step from utility line voltage down to a lower secondary voltage, depending on the application. The secondary voltage from a medium-voltage transformer is usually at 277 V for single phase and 480 V for three phase. This secondary voltage can be directly used as 480 V three-phase power for large motors or as 277 V single-phase power for some fluorescent lighting. However, for most industrial and commercial facilities, low-voltage transformers are needed to reduce the above voltages further to 208/120 V. Common 120 V loads are wall plugs and incandescent lighting.

Most liquid-immersed transformers are owned by utilities and they are of the medium-voltage type. Virtually all dry type transformers are owned by commercial and industrial customers (Barnes et al. 1996). Of the dry type transformers, those of the medium-voltage type are generally special-order items while those of the low-voltage type are commodity items. The efficiency requirement of distribution transformers is covered by the NEMA (National Electrical Manufactures Association) Standard TP 1. ASHRAE 90.1-2010 will cite the NEMA Standard TP 1 to stipulate the efficiency requirement for the low-voltage dry type distribution transformers.

There are two main types of energy losses in transformers: no load loss and load loss. The no load loss comes primarily from the switching of the magnetic fields in the core material. Hence, it is also called the core loss. The no load (core) loss is roughly constant and exists continuously in the core material as long as the transformer is energized. The load loss comes from the electrical resistance in the windings when there is a load on the transformer. Hence, the load loss is also called the winding loss. The load (winding) loss is proportional to the load squared with a small temperature correction.

Given the no load loss (NL) and the load loss (LL) at rated load and conditions, the total energy losses in a transformer at time t is calculated as:

<div>$$TL(t) = NL + LL(t) = NL + LL*P{(t)^2}*{f_T}(t)$$</div>

where,

<span>$TL(t)$</span>        Total energy loss at time t (W)

<span>$LL(t)$</span>        Load loss at time t (W)

<span>$P(t)$</span>          Per unit load at time t

<span>${f_T}(t)$</span>         Temperature correction factor for the load loss at time t



The per unit load at time t is calculated as:

<div>$$P(t) = \frac{{Load(t)}}{{{S_B}}}$$</div>

where,

<span>$Load(t)$</span>Transformer load at time t (W)

<span>${S_B}$</span> Transformer nameplate rating (VA)

The temperature correction factor at time t is calculated as (NEMA 2002):

<div>$${f_T}(t) = {L_{dc}}*\frac{{R(t)}}{{{R_{ref}}}} + {L_{eddy}}*\frac{{{R_{ref}}}}{{R(t)}}$$</div>

where,

<span>${L_{dc}}$</span>            Per unit load loss due to electrical resistance

<span>${L_{eddy}}$</span>          Per unit load loss due to eddy currents

<span>$R(t)$</span>          Winding electrical resistance at time t

<span>${R_{ref}}$</span>           Winding electrical resistance at the full load reference conditions

The ratio of winding electrical resistance is calculated as:

<div>$$\frac{{R(t)}}{{{R_{ref}}}} = \frac{{F + {T_{winding}}(t) + {T_{amb}}(t)}}{{F + {T_{winding,ref}} + {T_{amb,ref}}}}$$</div>

where,

<span>$F$</span>  Thermal coefficient of resistance for the winding material (=225 for aluminum and 234.5 for copper)

<span>${T_{winding,ref}}$</span>Winding temperature rise at the full load reference conditions (°C)

<span>${T_{winding}}(t)$</span>Winding temperature rise at time t (°C)

<span>${T_{amb,ref}}$</span>       Ambient temperature at the reference condition (=20 °C)

<span>${T_{amb}}(t)$</span>      Ambient temperature at time t (°C)

The Ambient temperature <span>${T_{amb}}(t)$</span>is equal to the zone temperature if a thermal zone is specified in the input; otherwise, it is assumed equal to 20 °C. The winding temperature rise at time t is calculated as (Barnes et al. 1997):

<div>$${T_{winding}}(t) = P{(t)^{1.6}}*{T_{winding.ref}}$$</div>

Based on the derived total energy losses in a transformer, the transformer efficiency at time t can be calculated according to the following equation:

<div>$$\eta (t) = \frac{{Load(t)}}{{Load(t) + NL + LL(t)}}$$</div>

The above procedure describes how to calculate the total transformer energy losses based on the no load loss and load loss at rated conditions. The transformer model also supports the case when the nominal transformer efficiency is given. In this case, the user needs to provide the nameplate efficiency and the corresponding per unit load, the maximum efficiency and the corresponding per unit load, and the reference conductor temperature at which the nameplate efficiency is measured. Given these information, both no load loss and load loss at rated conditions can be derived as below.

The nameplate efficiency can be expressed as:

<div>$${\eta_{np}} = \frac{{{S_B}*{P_{np}}}}{{{S_B}*{P_{np}} + NL + LL*P_{np}^2*{f_{T,np}}}}$$</div>

where,

<span>${\eta_{np}}$</span>            Nameplate efficiency

<span>${S_B}$</span> Nameplate rating (VA)

<span>${P_{np}}$</span>            Per unit load at which the nameplate efficiency is measured

<span>${f_{T,np}}$</span>          Applied temperature correction factor for the nameplate efficiency

Maximum efficiency generally occurs when the load loss is equal to the no-load loss. Because the no-load loss does not vary with the load on the transformer, the following relationship can be established:

<div>$$NL = L{L_{\max ,\eta }} = LL*P_{\max ,\eta }^2*{f_{T,\max  - \eta }}$$</div>

where,

<span>${P_{\max ,\eta }}$</span>         Per unit load at which the maximum efficiency is obtained

<span>${f_{T,\max  - \eta }}$</span>     Applied temperature correction factor for the maximum efficiency

Transformers typically have close per unit loads for the nameplate efficiency and the maximum efficiency. Therefore, it is reasonable to assume that the applied temperature correction factors are equal at those two efficiencies. This implies that:

<div>$$\frac{{L{L_{np}}}}{{L{L_{\max ,\eta }}}} = \frac{{LL*{P_{np}}^2*{f_{T,np}}}}{{LL*{P_{\max ,\eta }}^2*{f_{T,\max  - \eta }}}} = {\left( {\frac{{{P_{np}}}}{{{P_{\max ,\eta }}}}} \right)^2}$$</div>

Rearranging Equation and combining it with Equation leads to:

<div>$$L{L_{np}} = L{L_{\max ,\eta }}*{\left( {\frac{{{P_{np}}}}{{{P_{\max ,\eta }}}}} \right)^2} = NL*{\left( {\frac{{{P_{np}}}}{{{P_{\max ,\eta }}}}} \right)^2}$$</div>

Combining Equations and , we can obtain the no load loss as:

<div>$$NL = \frac{{{S_B}*{P_{np}}*(1 - {\eta_{np}})}}{{{\eta_{np}}*\left[ {1 + {{\left( {\frac{{{P_{ref}}}}{{P{}_{\max ,\eta }}}} \right)}^2}} \right]}}$$</div>

Substitute NL into Equation , we can calculate the load loss at rated conditions as:

<div>$$LL = \frac{{NL}}{{{f_{T,\max  - \eta }}*P_{\max ,\eta }^2}} = \frac{{NL}}{{{f_{T,np}}*P_{\max ,\eta }^2}}$$</div>

Since both no load and load losses at rated conditions are known, the total energy losses in a transformer at time t can then be calculated according to Equation

#### References:

Barnes, PR., JW. Van Dyke, BW. McConnell, and S. Das. 1996. Determination Analysis of Energy Conservation Standards for Distribution Transformer, ORNL-6847. Oak Ridge National Laboratory, Oak Ridge, TN.

Barnes, PR., S. Das, BW. McConnell, and JW. Van Dyke. 1997. Supplement to the “Determination Analysis” (ORNL-6847) and Analysis of the NEMA Efficiency Standard for Distribution Transformer, ORNL-6925. Oak Ridge National Laboratory, Oak Ridge, TN.

NEMA. 2002. NEMA Standards Publication TP 1-2002: Guide for Determining Energy Efficiency for Distribution Transformers. National Electrical Manufactures Association, Rosslyn, VA.

Photovoltaic Arrays
-------------------

The Photovoltaics.f90 module includes three different models referred to as “Simple”, “Equivalent One-Diode” and “Sandia” and the choice will determine the mathematical models (and input data) used to determine the energy produced by solar/electric conversion panels. The EnergyPlus photovoltaic array models are called one at a time at the HVAC system timestep along with other electrical generation components such as gas turbines and diesel engines.

All of the photovoltaic models share the same models for predicting incident solar radiation that are also used for the solar thermal calculations and are described in the section Climate, Sky and Solar/Shading Calculations.

Note that some of the terminology used to discussed photovoltaics overlaps with terminology used to discuss Fortran programs. The word *module* may refer to a PV panel or to a fortran90 programming entity. *Model* may refer to a manufacturers production model for a specific type of PV module or to a mathematical model used for engineering analysis. *Array* may refer to a collection of PV modules wired together or to a mathematical variable with multiple elements.

The PV modules are assumed to always run when the total incident solar is greater than 0.3 Watts. If the incident solar is less than 0.3, then the modules produce no power.

PV arrays are managed by an electric load center. The load center is a “load” with respect to generating equipment but is a “supply center” for the rest of the building. PV arrays need to be connected to ElectricLoadCenter:Distribution objects that have a DC buss type.

### Simple Model

The Generator:PV:Simple object describes about the simplest model for predicting photovoltaic energy production. In this model the user specifies the efficiency with which surfaces convert incident solar radiation to electricity. (In the other models this efficiency is determined as part of the model.)  The full geometric model for solar radiation is used, including sky models, shading, and reflections, to determine the incident solar resource. The model accepts arbitrary conversion efficiencies and does not require actual production units be tested to obtain empirical performance coefficients. (The Energy+.idd sets the range of conversion efficiencies to be on [0..1], but the user could alter the Energy+.idd to extend this range if desired.)

#### Mathematical Description

Table 89. Nomenclature for Simple Photovoltaic model

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
</tr>
<tr>
<td>P</td>
<td>Electrical power produced by photovoltaics [W]</td>
</tr>
<tr>
<td>A<sub>surf</sub></td>
<td>Net area of surface  [m<sup>2</sup>]</td>
</tr>
<tr>
<td>f<sub>activ</sub></td>
<td>Fraction of surface area with active solar cells [ ]</td>
</tr>
<tr>
<td>G<sub>T</sub></td>
<td>Total solar radiation incident on PV array [W/m<sup>2</sup>]</td>
</tr>
<tr>
<td>h<sub>cell</sub></td>
<td>Module conversion efficiency [ ]</td>
</tr>
<tr>
<td>h<sub>invert</sub></td>
<td>DC to AC conversion efficiency  [ ]</td>
</tr>

</table>



The usable electrical power produced by a PV surface are calculated using:

<div>$$P = {A_{surf}} \cdot {f_{activ}} \cdot {G_T} \cdot {\eta_{cell}} \cdot {\eta_{invert}}$$</div>

On the right hand side of this equation, only G<sub>T</sub> is calculated by EnergyPlus and the rest are user inputs. Power levels are assumed constant over the timestep to arrive at energy production.

There are two modes that can be selected by the user that govern how the PV system is coupled to the building surfaces. If the integration mode is selected as ‘DECOUPLED’ then no adjustments are made to account for energy extracted in the form of electricity. If the integration mode is selected as ‘INTEGRATED’ then the energy extracted in the form of electricity is removed from surface heat transfer calculations using a sink term. This sink term is lagged from the previous timestep.

### Equivalent One-Diode Model

This model predicts the electrical performance of a photovoltaic (PV) array. This model is also known as the “TRNSYS PV” model.

Mathematically speaking, the EnergyPlus PV module employs equations for an empirical equivalent circuit model to predict the current-voltage characteristics of a single module. This circuit consists of a DC current source, diode, and either one or two resistors. The strength of the current source is dependent on solar radiation and the IV characteristics of the diode are temperature-dependent. The results for a single module equivalent circuit are extrapolated to predict the performance of a multi-module array.

The module employs a “four-parameter” equivalent circuit to model crystalline (both mono and poly) PV modules developed at the University of Wisconsin – Madison [2]. The values of these parameters cannot normally be obtained directly from manufacturers’ catalogs. However, the PV module will automatically calculate them from commonly available data. The PV module also includes an optional incidence angle modifier correlation to calculate how the reflectance of the PV module surface varies with the angle of incidence of solar radiation.

The module determines PV current as a function of load voltage. Other OUTPUTS include current and voltage at the maximum power point along the IV curve, open-circuit voltage, short circuit current as well as electrical load met and unmet.

Table 90. General Nomenclature for the PV model

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
</tr>
<tr>
<td>b</td>
<td>Slope of PV array [degrees]</td>
</tr>
<tr>
<td>g</td>
<td>Empirical PV curve-fitting parameter</td>
</tr>
<tr>
<td>e<sub>g</sub></td>
<td>Semiconductor bandgap [eV]</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Module conversion efficiency</td>
</tr>
<tr>
<td>m<sub>Isc</sub></td>
<td>Temperature coefficient of short-circuit current [A/K]</td>
</tr>
<tr>
<td>m<sub>Voc</sub></td>
<td>Temperature coefficient of open-circuit voltage [V/K]</td>
</tr>
<tr>
<td>q</td>
<td>Angle of incidence for solar radiation [degrees]</td>
</tr>
<tr>
<td>ta</td>
<td>Module transmittance-absorptance product</td>
</tr>
<tr>
<td>ta<sub>normal</sub></td>
<td>Module transmittance-absorptance product at normal incidence</td>
</tr>
<tr>
<td>G<sub>T</sub></td>
<td>Total radiation incident on PV array</td>
</tr>
<tr>
<td>G<sub>T,beam</sub></td>
<td>Beam component of incident radiation</td>
</tr>
<tr>
<td>G<sub>T,diff</sub></td>
<td>Diffuse component of incident radiation</td>
</tr>
<tr>
<td>G<sub>T,gnd</sub></td>
<td>Ground-reflected component of incident radiation</td>
</tr>
<tr>
<td>G<sub>T,NOCT</sub></td>
<td>Incident radiation at NOCT conditions</td>
</tr>
<tr>
<td>G<sub>T,ref</sub></td>
<td>Incident radiation at reference conditions</td>
</tr>
<tr>
<td>I</td>
<td>Current</td>
</tr>
<tr>
<td>I<sub>L</sub></td>
<td>Module photocurrent</td>
</tr>
<tr>
<td>I<sub>L,ref</sub></td>
<td>Module photocurrent at reference conditions</td>
</tr>
<tr>
<td>I<sub>o</sub></td>
<td>Diode reverse saturation current</td>
</tr>
<tr>
<td>I<sub>o,ref</sub></td>
<td>Diode reverse saturation current at reference conditions</td>
</tr>
<tr>
<td>I<sub>sc</sub></td>
<td>Short-circuit current</td>
</tr>
<tr>
<td>I<sub>sc,ref</sub></td>
<td>Short-circuit current at reference conditions</td>
</tr>
<tr>
<td>I<sub>mp</sub></td>
<td>Current at maximum power point along IV curve</td>
</tr>
<tr>
<td>I<sub>mp,ref</sub></td>
<td>Current at maximum power point along IV curve, reference conditions</td>
</tr>
<tr>
<td>IAM</td>
<td>Dimensionless incidence angle modifier</td>
</tr>
<tr>
<td>K</td>
<td>Boltzmann constant [J/K]</td>
</tr>
<tr>
<td>NP</td>
<td>Number of modules in parallel in array</td>
</tr>
<tr>
<td>NS</td>
<td>Number of modules in series in array</td>
</tr>
<tr>
<td>N<sub>s</sub></td>
<td>Number of individual cells in module</td>
</tr>
<tr>
<td>P</td>
<td>PV output power</td>
</tr>
<tr>
<td>P<sub>max</sub></td>
<td>PV output power at maximum power point along IV curve</td>
</tr>
<tr>
<td>Q</td>
<td>Electron charge constant</td>
</tr>
<tr>
<td>R<sub>s</sub></td>
<td>Module series resistance [W]</td>
</tr>
<tr>
<td>R<sub>sh</sub></td>
<td>Module shunt resistance [W]</td>
</tr>
<tr>
<td>T­<sub>c</sub></td>
<td>Module temperature [K]</td>
</tr>
<tr>
<td>T<sub>c,NOCT</sub></td>
<td>Module temperature at NOCT conditions [K]</td>
</tr>
<tr>
<td>T<sub>c,ref</sub></td>
<td>Module temperature at reference conditions [K]</td>
</tr>
<tr>
<td>U<sub>L</sub></td>
<td>Array thermal loss coefficient</td>
</tr>
<tr>
<td>V</td>
<td>Voltage</td>
</tr>
<tr>
<td>V<sub>mp</sub></td>
<td>Voltage at maximum power point along IV curve</td>
</tr>
<tr>
<td>V<sub>mp,ref</sub></td>
<td>Voltage at maximum power point along IV curve, reference conditions</td>
</tr>
<tr>
<td>V­<sub>oc</sub></td>
<td>Open-circuit voltage</td>
</tr>
<tr>
<td>V<sub>oc,ref</sub></td>
<td>Open-circuit voltage at reference conditions [V]</td>
</tr>

</table>

#### Mathematical Description

##### PV Section 1: Four-Parameter Model

The four-parameter equivalent circuit model was developed largely by Townsend [1989] and is detailed by Duffie and Beckman [1991]. The model was first incorporated into a component for the TRNSYS simulation package by Eckstein [1990]. The EnergyPlus module employs the Eckstein model for crystalline PV modules, using it whenever the short-circuit IV slope is set to zero or a positive value as modified by Ulleberg [2000]. The four parameter model assumes that the slope of the IV curve is zero at the short-circuit condition:

<div>$${\left( {\frac{{dI}}{{dV}}} \right)_{v = 0}} = 0$$</div>

This is a reasonable approximation for crystalline modules. The “four parameters” in the model are *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* g, and *R<sub>s</sub>.* These are empirical values that cannot be determined directly through physical measurement. The EnergyPlus model calculates these values from manufactures’ catalog data as discussed in the following section on calculating these parameters

The four-parameter equivalent circuit is shown in the following figure:

![](EngineeringReference/media/image7592.svg.png)

Figure 339. Equivalent circuit in the four parameter model

*V* is the load voltage and *I* is the current flowing through the load and PV.

**Determining Performance under Operating Conditions**

The IV characteristics of a PV change with both insolation and temperature. The PV model employs these environmental conditions along with the four module constants *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* g, and *R<sub>s</sub>* to generate an IV curve at each timestep.

The current-voltage equation of circuit shown in the previous figure is as follows:

<div>$$I = {I_L} - {I_o}\left[ {\exp \left( {\frac{q}{{\gamma k{T_c}}}\left( {V + I{R_s}} \right)} \right) - 1} \right]$$</div>

*R<sub>s</sub>* and g are constants. The photocurrent *I<sub>L</sub>* depends linearly on incident radiation:

<div>$${I_L} = {I_{L,ref}}\frac{{{G_T}}}{{{G_{T,ref}}}}$$</div>

The reference insolation *G<sub>ref</sub>*  is nearly always defined as 1000 W/m<sup>2</sup>. The diode reverse saturation current *I<sub>o</sub>* is a temperature dependent quantity:

<div>$$\frac{{{I_o}}}{{{I_{o,ref}}}} = {\left( {\frac{{{T_c}}}{{{T_{c,ref}}}}} \right)^3}$$</div>

Equation gives the current implicitly as a function of voltage. Once *I<sub>o</sub>* and *I<sub>L</sub>* are found from Eqs. 3 and 4, Newton’s method is employed to calculate the PV current. In addition, an iterative search routine finds the current (*I<sub>mp</sub>*)  and voltage (*V<sub>mp</sub>*)  at the point of maximum power along the IV curve.

**Calculating *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>*** **g, and *R<sub>s</sub>***

The Idf specification for the PV model include several values which must be read from manufacturers’ PV module catalogs. The manufactures’ values are used to determine the equivalent circuit characteristics *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* g, and *R<sub>s</sub>*. These characteristics define an equivalent circuit that is employed to find the PV performance at each timestep, as described previously. This section describes the algebra and calculation algorithms used to solve for the four equivalent circuit characteristics.

Three of these values, *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* g, may be isolated algebraically. The first step is to substitute the current and voltage into Eq. at the open-circuit, short circuit, and maximum power conditions:

<div>$$0 = {I_{L,ref}} - {I_{o,ref}}\left[ {\exp \left( {\frac{q}{{\gamma k{T_{c,ref}}}}{V_{oc,ref}}} \right) - 1} \right] - \frac{{{V_{oc,ref}}}}{{{R_{sh}}}}$$</div>

<div>$${I_{sc,ref}} = {I_{L,ref}} - {I_{o,ref}}\left[ {\exp \left( {\frac{{q{I_{sc,ref}}{R_s}}}{{\gamma k{T_{c,ref}}}}} \right) - 1} \right] - \frac{{{I_{sc,ref}}{R_s}}}{{{R_{sh}}}}$$</div>

<div>$${I_{mp,ref}} = {I_{L,ref}} - {I_{o,ref}}\left[ {\exp \left( {\frac{q}{{\gamma k{T_{c,ref}}}}\left( {{V_{mp,ref}} + {I_{mp,ref}}{R_s}} \right)} \right) - 1} \right] - \frac{{{V_{mp,ref}} + {I_{mp,ref}}{R_s}}}{{{R_{sh}}}}$$</div>

In each case the “-1” term is may be dropped to simplify the algebra. This approximation has little influence on the right side of the equations since because the magnitude of *I<sub>o</sub>* is very small, generally on the order of 10<sup>-6</sup> A. Some rearrangement then yields the following three expressions which isolate *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* g:

<div>$${I_{L,ref}} \approx {I_{sc,ref}}$$</div>

<div>$$\gamma  = \frac{{q\left( {{V_{mp,ref}} - {V_{oc,ref}} + I_{mp,ref}^{}{R_s}} \right)}}{{k{T_{c,ref}}\ln \left( {1 - \frac{{{I_{mp,ref}}}}{{{I_{sc,ref}}}}} \right)}}$$</div>

<div>$${I_{o,ref}} = \frac{{{I_{sc,ref}}}}{{\exp \left( {\frac{{q{V_{oc,ref}}}}{{\gamma k{T_{c,ref}}}}} \right)}}$$</div>

At this point an additional equation is needed in order to determine the last unknown parameter. Taking the analytical derivative of voltage with respect to temperature at the reference open-circuit condition derives the fourth equation. This analytical value is matched to the open-circuit temperature coefficient, a catalog specification:

<div>$$\frac{{\partial {V_{oc}}}}{{\partial {T_c}}} = {\mu_{voc}} = \frac{{\gamma k}}{q}\left[ {\ln \left( {\frac{{{I_{sc,ref}}}}{{{I_{o,ref}}}}} \right) + \frac{{{T_c}\mu_{isc}^{}}}{{{I_{sc,ref}}}} - \left( {3 + \frac{{q\varepsilon }}{{Ak{T_{c,ref}}}}} \right)} \right]$$</div>

where

<div>$$A = \frac{\gamma }{{{N_s}}}$$</div>

The “TRNSYS PV model” uses an iterative search routine in these four equations to calculate the equivalent circuit characteristics. The first step is to set upper and lower bounds for the series resistance parameter *R<sub>s</sub>*:  physical constraints require the *R<sub>s</sub>* value to lie between 0 and the value such that g = *N<sub>s</sub>*. The initial guess for *R<sub>s</sub>* is midway between these bounds. g and *I<sub>o,ref</sub>*  are found from Eq. and Eq. , while Eq. gives a trivial solution for *I<sub>L,ref</sub>*.  The model then employs Eq. to compare the analytical and catalog values for m<sub>voc</sub>. When all other variables are held constant, the analytical value for m<sub>voc</sub> increases monotonically with series resistance (Townsend 1989). If the analytical voltage coefficient is less than the catalog value, the lower bound for *R<sub>s</sub>* is reset to the present guess value. Likewise, the upper bound is set to the current value if the calculated m<sub>voc</sub> is too large. After resetting the upper or lower bound for *R<sub>s</sub>*, a new guess value is found by averaging the bounds. This procedure repeats until *R<sub>s</sub>* and g converge. Note that for *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* g, and *R<sub>s</sub>* are assumed to be constant and are calculated only on the first call in the simulation. Alternatively, the user may enter a known series resistance by entering a **positive** value in the IDF. In this case the iterative routine described above is skipped and Eqs. , , and find *I<sub>L,ref</sub>*, *I<sub>o,ref,</sub>* and g directly from the given value of *R<sub>s</sub>*.

##### PV Section 2 : Module Operating Temperature

The PV model uses one of five methods for determining cell temperature data. The cell temperature of a PV module is important because the hotter the temperature of the panel, the lower its electrical output. The cell temperature calculation method is chosen by the user in the EnergyPlus IDF file through a parameter choice in the IDD entry called Integration and Cell Temperature Mode.

If the value of this parameter is “**Decoupled NOCT Conditions**” then the cell temperature of the PV is modeled using the method from the Duffie and Beckman (1991) for estimating cell temperature. This is based upon the standard NOCT (Nominal Operating Cell Temperature) measurements to compute the module temperature Tc at each timestep. The NOCT temperature (Tc,NOCT) is the operating temperature of the module with a wind speed of 1 m/s, no electrical load, and a certain specified insolation and ambient temperature [Beckman and Duffie, 1991]. The values for insolation GT,NOCT  and ambient temperature *T<sub>a,NOCT</sub>* are usually 800 W/m<sup>2</sup> and 20º C. *h<sub>c</sub>* is the convesion efficiency of the module, which varies with ambient conditions. ta is a user-defined constant.

The equation is:

<div>$${T_c} = {T_a} + \frac{{\left( {1 - {\raise0.7ex\hbox{${{\eta_c}}$} \!\mathord{\left/ {\vphantom {{{\eta_c}} {\tau \alpha }}}\right.}\!\lower0.7ex\hbox{${\tau \alpha }$}}} \right)}}{{\left( {{\raise0.7ex\hbox{${{G_T}\tau \alpha }$} \!\mathord{\left/ {\vphantom {{{G_T}\tau \alpha } {{U_L}}}}\right.}\!\lower0.7ex\hbox{${{U_L}}$}}} \right)}}$$</div>

If the user specifies the “**Decoupled Ulleberg Dynamic”** mode for calculating cell temperature, then a method developed by Ulleberg is used:

<div>$${\left. {{T_{cell}}} \right|_t} = {T_{ambient}} + \left( {{{\left. {{T_{cell}}} \right|}_{t - 1}} - {T_{ambient}}} \right)*{e^{\frac{{ - UL}}{{Cap}}\Delta t}}$$</div>

In other words, the cell temperature is a function of the privious cell temperature and the thermal capacity of the PV module material.

If the user specifies “**Integrated Surface Outside Face”** for this parameter, then the temperature result from EnergyPlus’s modeling of surfaces is used for the cell temperature. Also the energy exported from the surface as electricity becomes a sink in the internal source modeling for the heat transfer surface.

If the user specifies “**Integrated Transpired Collector”** for this parameter, then the temperature result for the unglazed transpired collector surfaces is used for the cell temperature. Also the energy exported from the collector surface as electricity is deprecated using a source term in the collector’s temperature modeling.

If the user specifies “**Integrated Exterior Vented Cavity”** for this parameter, then the temperature result for the exterior cavity is used for the cell temperature. Also the energy exported from the baffle surface as electricity is deprecated using a source term in the baffle’s temperature modeling.

##### PV Section 3 : Multi-Array Modules

The electrical calculations discussed in the sections above deal only with a single module. The EnergyPlus PV component may be used to simulate arrays with any number of modules. The IDF defines the number of modules in series (NS) and modules in parallel (NP) for the entire array. The total number of modules in the array is the product of NS and NP. When simulating a single module only, both NS and NP are set to 1. The single-module values for all currents and voltages discussed in PV Section 1 are multiplied by NP or NS to find values for the entire array. This approach neglects module mismatch losses.

With the above equations, and the assumption that the panels operate at the maximum power point, it is a direct calculation to determine DC power production. The performance of an array of identical modules is assumed to be linear with the number of modules in series and parallel. The inverter efficiency is applied linearly to derate the energy production. The inverter capacity forms a limit for power production from a PV generator. A ‘load’ is passed the PV array acting as a generator and various trivial calculations compare PV production to this load. If the PV array is associated with a surface that is associated with a zone, then if the zone has any multipliers associated with it, electricity production will be multiplied accordingly.

#### References

Duffie, John A. and William A. Beckman. 1991. *Solar Engineering of Thermal Processes*. New York: John Wiley & Sons, Inc..

Eckstein, Jürgen Helmut. 1990. *Detailed Modeling of Photovoltaic Components*. M. S. Thesis – Solar Energy Laboratory, University of Wisconsin, Madison: 1990.

Ulleberg, Øystein. *HYDROGEMS Component Library for TRNSYS 15 User Manual*, Institute for Energy Technology, Kjeller, Norway * *

### Sandia Photovoltaic Performance Model

The third model available in EnergyPlus for predicting the electricity generated by photovoltaics is referred to as the Sandia model. This model is based on work done at Sandia National Lab, Albuquerque, NM by David King -- with the help of many others. The model consists of a series of empirical relationships with coefficients that are derived from actual testing. Once the coefficients for a particular module are available, it is straightforward matter to use the model equations to calculate five select points on the current-voltage curve.

The implementation in EnergyPlus is also based on work done by Greg Barker (2003) for the National Renewable Energy Lab who implemented the Sandia model in FORTRAN77 as a custom type (Type101) for the TRNSYS computer program.

There are several climate and solar orientation inputs to the model that are managed elsewhere in EnergyPlus including: incident beam solar, incident diffuse solar, incidence angle of beam solar, solar zenith Angle, outdoor drybulb, wind speed, and elevation.

#### Mathematical Description

This section presents the mathematical description of the Sandia model from a draft report by King et, al. (2003). The core of the model predicts the performance of a single PV module. The following nomenclature and equations summarize the Sandia model.

Table 91. Nomenclature for Sandia PV model

<table class="table table-striped">
<tr>
<th>Mathematical variable</th>
<th>Description</th>
</tr>
<tr>
<td>I<sub>sc</sub></td>
<td>Short-circuit current (A)</td>
</tr>
<tr>
<td>I<sub>mp</sub></td>
<td>Current at the maximum-power point (A)</td>
</tr>
<tr>
<td>I<sub>x</sub></td>
<td>Current at module V = 0.5 V<sub>oc</sub>, defines 4th point on I-V curve</td>
</tr>
<tr>
<td>I<sub>xx</sub></td>
<td>Current at module V = 0.5 (V<sub>oc</sub> + V<sub>mp</sub>), defines a 5th point on the I-V curve</td>
</tr>
<tr>
<td>V<sub>oc</sub></td>
<td>Open-circuit voltage (V)</td>
</tr>
<tr>
<td>V<sub>mp</sub></td>
<td>Voltage at maximum-power point (V)</td>
</tr>
<tr>
<td>P<sub>mp</sub></td>
<td>Power at maximum-power point (W)</td>
</tr>
<tr>
<td>fd</td>
<td>Fraction of diffuse irradiance used by module</td>
</tr>
<tr>
<td>N<sub>s</sub></td>
<td>Number of cells in series in a module’s cell-string</td>
</tr>
<tr>
<td>N<sub>p</sub></td>
<td>Number of cell-strings in parallel in module</td>
</tr>
<tr>
<td>k</td>
<td>Boltzmann’s constant, 1.38066E-23 (J/k)</td>
</tr>
<tr>
<td>q</td>
<td>Elementary charge, 1.60218E-19 (coulomb)</td>
</tr>
<tr>
<td>T<sub>c</sub></td>
<td>Cell temperature inside module (°C)</td>
</tr>
<tr>
<td>δ(T<sub>c</sub>)</td>
<td>‘Thermal voltage’ per cell at temperature T<sub>c</sub>, approximately 1 volt for a typical 26-cell crystalline silicon module</td>
</tr>
<tr>
<td>E<sub>e</sub></td>
<td>‘Effective’ solar irradiance</td>
</tr>
<tr>
<td>E<sub>b</sub></td>
<td>Beam solar irradiance</td>
</tr>
<tr>
<td>E<sub>diff</sub></td>
<td>Diffuse solar irradiance</td>
</tr>
<tr>
<td>C<sub>0</sub> , C<sub>1</sub></td>
<td>Empirical coefficients relating I<sub>mp</sub> to E<sub>e</sub> , C<sub>0</sub> + C<sub>1</sub>= 1 (both dimensionless)</td>
</tr>
<tr>
<td>C<sub>2</sub> , C<sub>3</sub></td>
<td>Empirical coefficients relating V<sub>mp</sub> to E<sub>e</sub>(C<sub>2</sub> dimensionless, C<sub>3</sub> is 1/V)</td>
</tr>
<tr>
<td>C<sub>4</sub> , C<sub>5</sub></td>
<td>Empirical coefficients relating I<sub>x</sub> to E<sub>e</sub>, C<sub>4</sub> + C<sub>5</sub> = 1 (both dimensionless)</td>
</tr>
<tr>
<td>C<sub>6</sub> , C<sub>7</sub></td>
<td>Empirical coefficients relating I<sub>xx</sub> to E<sub>e,</sub> C<sub>6</sub> + C<sub>7</sub> = 1 (both dimensionless)</td>
</tr>
<tr>
<td>n</td>
<td>Empirically determined ‘diode factor’ for individual cells</td>
</tr>
<tr>
<td>AMa</td>
<td>Absolute Air Mas</td>
</tr>
<tr>
<td>AOI</td>
<td>Solar angle-of-incidence (degrees) from normal</td>
</tr>
<tr>
<td>f<sub>1</sub>(AM<sub>a</sub>)</td>
<td>Empirical polynomial function used to relate short-circuit current to the solar spectrum via air mass</td>
</tr>
<tr>
<td>f<sub>2</sub>(AOI)</td>
<td>Empirical polynomial function used to relate short-circuit current to the solar angle-of-incidence</td>
</tr>
<tr>
<td>a<sub>0</sub>, a<sub>1</sub>, a<sub>2</sub>, a<sub>3</sub>, a<sub>4</sub></td>
<td>Empirical coefficients for f<sub>1</sub>(AM<sub>a</sub>) polynomial</td>
</tr>
<tr>
<td>b<sub>0</sub>, b<sub>1</sub>, b<sub>2</sub>, b<sub>3</sub>, b<sub>4</sub>,b<sub>5</sub>,b<sub>6</sub></td>
<td>Empirical coefficients for f<sub>1</sub>(AOI) polynomial</td>
</tr>
<tr>
<td>T<sub>o</sub></td>
<td>Reference cell temperature for rating, typically fixed at 25°C</td>
</tr>
<tr>
<td>I<sub>sco</sub></td>
<td>Short circuit current at reference conditions</td>
</tr>
<tr>
<td>I<sub>mpo</sub></td>
<td>Max power point current at reference conditions</td>
</tr>
<tr>
<td>V<sub>mpo</sub></td>
<td>Voltage at max power at reference conditions</td>
</tr>
<tr>
<td>V<sub>oco</sub></td>
<td>Open circuit voltage at reference conditions</td>
</tr>
<tr>
<td>I<sub>xo</sub></td>
<td>Current at V = 0.5 Voc and at reference conditions</td>
</tr>
<tr>
<td>I<sub>xxo</sub></td>
<td>Current at V = 0.5 (Vmp + Voc) and at reference conditions</td>
</tr>
<tr>
<td>α<sub>Isc</sub></td>
<td>Normalized temperature coefficient for I<sub>sc</sub> (1/°C)</td>
</tr>
<tr>
<td>α<sub>Imp</sub></td>
<td>Normalized temperature coefficient for I<sub>mp</sub> (1/°C)</td>
</tr>
<tr>
<td>β<sub>Voc</sub>(E<sub>e</sub>)</td>
<td>Temperature coefficient for module open-circuit-voltage as function of E<sub>e</sub></td>
</tr>
<tr>
<td>β<sub>Voco</sub></td>
<td>Temperature coefficient for module open-circuit-voltage at reference conditions</td>
</tr>
<tr>
<td>m<sub>βVoco</sub></td>
<td>Coefficient for irradiance dependence of open-circuit-voltage-temperature coefficient, often zero (V/°C)</td>
</tr>
<tr>
<td>β<sub>Vmp</sub>(E<sub>e</sub>)</td>
<td>Temperature coefficient for module maximum-power-voltage as a function of E<sub>e</sub></td>
</tr>
<tr>
<td>β<sub>Vmpo</sub></td>
<td>Temperature coefficient for module maximum-power-voltage at reference conditions</td>
</tr>
<tr>
<td>m<sub>βVmpo</sub></td>
<td>Cofficient for irradiance dependence of maximum-power-voltage-temperature coefficient, often zero (V/°C)</td>
</tr>
<tr>
<td>T<sub>m</sub></td>
<td>PV module temperature at back suface (°C)</td>
</tr>
<tr>
<td>T<sub>a</sub></td>
<td>Ambient outdoor drybulb temperature (°C)</td>
</tr>
<tr>
<td>E</td>
<td>Solar irradiance incident on module surface (W/m<sup>2</sup>)</td>
</tr>
<tr>
<td>WS</td>
<td>Wind speed at standard 10-m height (m/s)</td>
</tr>
<tr>
<td>a</td>
<td>Empirical coefficient relating module temperature at low wind and high solar irradiance</td>
</tr>
<tr>
<td>b</td>
<td>Empirical coefficient relating module temperature decrease with increasing wind speed</td>
</tr>
<tr>
<td>T<sub>c</sub></td>
<td>Temperature of solar cell inside module (°C)</td>
</tr>
<tr>
<td>E<sub>o</sub></td>
<td>Reference solar irradiance (1000 W/m<sup>2</sup>)</td>
</tr>
<tr>
<td>ΔT</td>
<td>Temperature difference between T<sub>c</sub> and T<sub>m</sub>at E<sub>o</sub>(°C),
(This is d(Tc) in Sandia database)</td>
</tr>

</table>

The current implementation in EnergyPlus focuses on determining performance at the maximum power-point but also calculates, and reports, four other points on the I-V curve so that the data are available for analyses outside of EnergyPlus. The equations below use the module performance parameters that are available in a database provided by Sandia National Laboratory (see www.sandia.gov/pv). The following equations form the basis of the Sandia model implemented in EnergyPlus:

<div>$${I_{sc}} = {I_{sco}} \cdot {f_1}\left( {A{M_a}} \right) \cdot \left\{ {\left( {{E_b} \cdot {f_2}\left( {AOI} \right) + {f_d} \cdot {E_{diff}}} \right)/{E_o}} \right\} \cdot \left\{ {1 + {\alpha_{Isc}} \cdot \left( {{T_c} - {T_o}} \right)} \right\}$$</div>

<div>$${I_{mp}} = {I_{mpo}} \cdot \left\{ {{C_o} \cdot {E_e} + {C_1} \cdot E_e^2} \right\} \cdot \left\{ {1 + {\alpha_{{\mathop{\rm Im}\nolimits} p}} \cdot ({T_c} - {T_o}} \right\}$$</div>

<div>$${V_{oc}} = {V_{oco}} + {N_s} \cdot \delta ({T_c}) \cdot \ln ({E_e}) + {\beta_{Voc}}({E_e}) \cdot \left( {{T_c} - {T_o}} \right)$$</div>

<div>$${V_{mp}} = {V_{mpo}} + {C_2} \cdot {N_s} \cdot \delta \left( {T_c^{}} \right) \cdot \ln \left( {{E_e}} \right) + {C_3} \cdot {N_3} \cdot {\left\{ {\delta \left( {T_c^{}} \right) \cdot \ln \left( {{E_e}} \right)} \right\}^2} + {\beta_{Vmp}}({E_e}) \cdot ({T_c} - {T_o})$$</div>

<div>$${P_{mp}} = {I_{mp}} \cdot {V_{mp}}$$</div>

<div>$${I_x} = {I_{xo}} \cdot \left\{ {{C_4} \cdot {E_e} + {C_5} \cdot E_e^2} \right\} \cdot \left\{ {1 + ({\alpha_{Isc}}) \cdot ({T_c} - {T_o})} \right\}$$</div>

<div>$${I_{xx}} = {I_{xxo}} \cdot \left\{ {{C_6} \cdot {E_e} + {C_7} \cdot E_e^2} \right\} \cdot \left\{ {1 + ({\alpha_{{\mathop{\rm Im}\nolimits} p}}) \cdot ({T_c} - {T_{o)}}} \right\}$$</div>

where,

<div>$${E_e} = {I_{sc}}/\left[ {{I_{sco}} \cdot \left\{ {1 + {\alpha_{Isc}} \cdot ({T_c} - {T_o})} \right\}} \right]$$</div>

<div>$$\delta ({T_c}) = n \cdot k \cdot ({T_c} + 273.15)/q$$</div>

<div>$${f_1}\left( {A{M_a}} \right) = {a_0} + {a_1}A{M_a} + {a_2}{\left( {A{M_a}} \right)^2} + {a_3}{\left( {A{M_a}} \right)^3} + {a_4}{\left( {A{M_a}} \right)^4}$$</div>

<div>$${f_2}\left( {AOI} \right) = {b_0} + {b_1} \cdot AOI + {b_2}{\left( {AOI} \right)^2} + {b_3}{\left( {AOI} \right)^3} + {b_4}{\left( {AOI} \right)^4} + {b_5}{\left( {AOI} \right)^5}$$</div>

<div>$${\beta_{Voc}}({E_e}) = {\beta_{Voco}} + {m_{\beta Voc}} \cdot (1 - {E_e})$$</div>

<div>$${\beta_{Vmp}}({E_e}) = {\beta_{Vmpo}} + {m_{\beta Vmp}} \cdot (1 - {E_e})$$</div>

<div>$${T_m} = E \cdot \left\{ {{e^{a + b \cdot WS}}} \right\} + {T_a}$$</div>

<div>$${T_c} = {T_m} + \frac{E}{{{E_o}}} \cdot \Delta T$$</div>

With the above equations, and the assumption that the panels operate at the maximum power point, it is a direct calculation to determine DC power production. The performance of an array of identical modules is assumed to be linear with the number of modules in series and parallel. The inverter efficiency is applied linearly to derate the energy production. The inverter capacity forms a limit for power production from a PV generator. A ‘load’ is passed the PV array acting as a generator and various trivial calculations compare PV production to this load. If the PV array is associated with a surface that is associated with a zone, then if the zone has any multipliers associated with it, electricity production will be multiplied accordingly.

The equation above for T<sub>m</sub> is used to predict back-of-module temperature when the mode ‘SANDIA RACK’ is selected. This would be appropriate for most rack mounted PV installations. If the user selects ‘EPLUS INTEGRATED’ then the back-of-module temperature is obtained from the outside face surface temperature calculated by the full complement of Heat Balance models using Conduction Transfer Functions that is native to EnergyPlus. And energy exported from the surface is accounted for using a source/sink term that is lagged from the previous timestep (pingpong).

#### References

King, D.L., Boyson, W.E., Kratochvil J.A. 2003. Photovoltaic Array Performance Model. Sandia National Laboratories, Albuquerque, NM 87185, November 2003  currently in DRAFT

Barker, G. 2003 (unknown). Predicting Long-Term Performance of Photovoltaic Arrays. Submitted as deliverable for NREL subcontract LAX-1-30480-02. Currently in DRAFT

Davis, M.W., Fanney, A.H., and Dougherty B.P. 2002. Measured Versus Predicted Performance of Building Integrated Photovoltaics. from the conference Solar 2002, Sunrise on the Reliable Energy Economy, June 15-19, 2002, Reno, NV. Available from NIST website.

King, D.L. 1996. Photovoltaic Module and Array Performance Characterization Methods for All System Operating Conditions. Sandia National Laboratory. Albuquerque, NM 87185

Generators
----------

### Internal Cumbustion Engine

The engine-driven generator model was originally developed for the BLAST program and was subsequently adapted for use in EnergyPlus. The model uses the following set of equations all of which are quadratic fits to the PLR (Part Load Ratio) of the generator.  The coefficients must be derived from manufacturers data.

<div>$$\frac{{electric\,\,energy\,\,output}}{{fuel\,\,energy\,\,input}} = \frac{{electric\,\,energy\,\,output}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {a_1} + {a_2}PLR + {a_3}PL{R^2}$$</div>

The electrical load and engine generator nominal load capacity are used to compute the part load ratio.

<div>$$PLR = \frac{{Electric energy output}}{{nominal generating capacity}}$$</div>

The exhaust gas temp and flow rate are used if a stack heat exchanger is used to recover waste heat from the exhaust.  This temperature is the inlet temperature to the heat exchanger which is modeled in a UA-effectiveness form:

<div>$$\frac{{Total\,Exhaust\,heat}}{{fuel\,energy\,input}} = \frac{{Total\,\,Exhaust\,\,heat}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {d_1} + {d_2}PLR + {d_3}PL{R^2}$$</div>

<div>$$\frac{{Exhaust\,\,Gas\,\,Temp\,\,\left\{ K \right\}}}{{fuel\,\,energy\,\,input}} = \frac{{Exhaust\,\,Gas\,\,Temp\,\,\left\{ K \right\}}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {e_1} + {e_2}PLR + {e_3}PL{R^2}$$</div>

The exhaust flow rate is then calculated as:

<div>$${\dot m_{exhaust}} = \frac{{Total\,\,Exhaust\,\,heat}}{{C{p_{exhaust}} \cdot \left( {{T_{exhaust}} - {T_{reference}}} \right)}}$$</div>

where T<sub>reference</sub> is the reference temperature for the fuel lower heating value, and is given as 25°C in manufacturer’s data, and

<div>$${T_{stack}} = {T_{DesignMinExhaust}} + {\frac{{\left( {{T_{exhaust}} - {T_{DesignMinExhaust}}} \right)}}{{{\rm{exp}}\left( {\frac{{{\rm{UA}}}}{{{{{\rm{\dot m}}}_{{\rm{exhaust}}}}C{p_{exhaust}}}}} \right)}}^2}$$</div>

Finally heat recovered from the lube oil and the water jacket are accounted for as follows:

<div>$$\frac{{Recoverable\,\,jacket\,\,heat}}{{fuel\,\,energy\,\,input}} = \frac{{Recoverable\,\,jacket\,\,heat}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {b_1} + {b_2}PLR + {b_3}PL{R^2}$$</div>

<div>$$\frac{{Recoverable\,\,lube\,\,oil\,\,heat}}{{fuel\,\,energy\,\,input}} = \frac{{Recoverable\,\,lube\,\,oil\,\,heat}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {c_1} + {c_2}PLR + {c_3}PL{R^2}$$</div>

The manufacturer must supply the recoverable water jacket heat, lube oil heat and exhaust heat and associated fuel consumption for a range of load conditions.  This data is then fit to the PLR to obtain the fifteen a,b,c,d, and e coefficients.

### Turbine Generator

The combustion turbine generator model was originally developed for the BLAST program and was subsequently adapted for use in EnergyPlus. The model uses the following set of equations all of which are equation fits to the PLR (Part Load Ratio) of the generator and the entering air temperature. The coefficients must be derived from manufacturers data. For electric power generated in Watts, the fuel input rate is calculated in J/s.

<div>$$\frac{{{\rm{fuel energy input rate}}}}{{{\rm{electric power output}}}} = \left[ {{a_1} + {a_2}PLR + {a_3}PL{R^2}} \right] * \left[ {{b_1} + {b_2}\Delta T + {b_3}\Delta {T^2}} \right]$$</div>

The electrical load and engine generator nominal load capacity are used to compute the part load ratio.

<div>$$PLR = \frac{{{\rm{Electric energy output}}}}{{{\rm{nominal generating capacity}}}}$$</div>

The temperature difference shows the deviation of ambient air temperature from the manufacturers design air temperature.

<div>$$\Delta T = {T_{air}} - {T_{design}}$$</div>

A second curve fit calculates the exhaust temperature (C) by multiplying the exhaust temperature (C) for a particular part load by a correction factor based on the deviation from design temperature.

<div>$${{\rm{T}}_{exhaust}} = \left[ {{c_1} + {c_2}PLR + {c_3}PL{R^2}} \right] * \left[ {{d_1} + {d_2}\Delta T + {d_3}\Delta {T^2}} \right]$$</div>

The exhaust gas temp is used if a stack heat exchanger is used to recover waste heat from the exhaust.  This temperature is the inlet temperature to the heat exchanger which is modeled in a UA-effectiveness form:

<div>$${T_{stack}} = {T_{DesignMinExhaust}} + {\frac{{\left( {{T_{exhaust}} - {T_{DesignMinExhaust}}} \right)}}{{{\rm{exp}}\left( {\frac{{{\rm{UA}}}}{{{{{\rm{\dot m}}}_{{\rm{exhaust}}}}C{p_{exhaust}}}}} \right)}}^2}$$</div>

Where the design minimum exhaust temperature is a user input to the model and the exhaust mass flow rate and the UA are fit from manufacturers data as follows:

<div>$$UA = {e_3}{{\rm{(Nominal Generating Capacity)}}^{e4}}$$</div>

<div>$$\frac{{{\rm{exhaust gas flow rate}}}}{{{\rm{Nominal Generating Capacity}}}} = \left[ {{f_1} + {f_2}\Delta T + {f_3}\Delta {T^2}} \right]$$</div>

Finally, heat recovered from the lube oil is accounted for as follows:

<div>$$\frac{{{\rm{Recoverable lube oil heat}}}}{{{\rm{electric power generated}}}} = {g_1} + {g_2}PLR + {g_3}PL{R^2}$$</div>

### Microturbine Generator

Microturbine generators are small combustion turbines that produce electricity on a relatively small scale (e.g., 25kW to 500kW). This model uses nominal performance at reference conditions along with several modifier curves to determine electrical power output and fuel use at non-reference conditions. The modifier curve coefficients must be derived from manufacturers data. Standby and ancillary power can also be taken into account.

Exhaust air energy recovery for heating water can be also be modeled. Similar to electrical power output, thermal power (heat recovery to water) output is calculated using nominal performance at reference conditions with modifier curves to account for variations at non-reference conditions. The ElectricLoadCenter:Generators and ElectricLoadCenter:Distribution objects are used to define the availability and control of the electric generators included in the simulation (ref. ElectricLoadCenter:Generators and ElectricLoadCenter:Distribution).

For each simulation time step that the generator is being asked to operate (i.e., produce electrical power as determined by the ElectricLoadCenter), the full load electrical output of the generator is determined using the user-defined reference electrical power output along with a bi-quadratic modifier curve to account for differences in the combustion air inlet temperature and elevation for the current simulation time step compared to the reference temperature and elevation (i.e., the modifier curve should evaluate to 1.0 at the reference combustion air inlet temperature and reference elevation).

<div>$${P_{Elec,Full\,Load\,}} = {P_{Elec,Ref}}\left( {PowerFTempElev} \right)$$</div>

<div>$$PowerFTempElev = {a_1} + {a_2}\left( {{T_{a,i}}} \right) + {a_3}{\left( {{T_{a,i}}} \right)^2} + {a_4}\left( {Elev} \right) + {a_5}{\left( {Elev} \right)^2} + {a_6}\left( {{T_{a,i}}} \right)\left( {Elev} \right)$$</div>

where:

<span>${P_{Elec,Full\,Load}}$</span>= Full load electrical power output (W)

<span>${P_{Elec,Ref}}$</span>= Reference Electrical Power Output, user input (W)

<span>$PowerFTempElev$</span>= User-defined Electric Power Modifier Curve (function of temperature and elevation) evaluated at the current combustion air inlet temperature and elevation

<span>${T_{a,i}}$</span>= Combustion air inlet temperature (°C)

<span>$Elev$</span>= Elevation (m). This value obtained from the Location object or the weather file.

The full load electrical power output of the generator is then checked against the minimum and maximum full load electrical power outputs specified by the user:

<div>$${P_{Elec,Full\,Load}} = MIN\left( {{P_{Elec,Full\,Load}},{P_{FL\_Max}}} \right)$$</div>

<div>$${P_{Elec,Full\,Load}} = MAX\left( {{P_{Elec,Full\,Load}},{P_{FL\_Min}}} \right)$$</div>

<span>${P_{FL\_Max}}$</span> = Maximum Full Load Electrical Power Output, user input (W)

<span>${P_{FL\_Min}}$</span> = Minimum Full Load Electrical Power Output, user input (W)

The actual (operating) electrical power output from the generator is determined next based on the load requested by the Electric Load Center, the generator’s minimum and maximum part-load ratios, and the ancillary power.

<div>$${P_{Elec,Operating}} = MAX\left( {0.0,\left( {Load + {P_{Ancillary}}} \right)} \right)$$</div>

<div>$${P_{Elec,Operating}} = MIN\left( {{P_{Elec,Operating}},{P_{Elec,Full\,Load}}} \right)$$</div>

```
 IF (P_elec_fullload > 0) THEN
   PLR = P_elec_operating / P_elec_fullload
   PLR = MIN( PLR, PLR_max )
   PLR = MAX( PLR, PLR_min )
 ELSE
   PLR = 0
 END IF
 P_elec_operating = P_elec_fullload * PLR
```

where:

<span>${P_{Elec,Operating}}$</span>= Actual (operating) electrical power output (W)

<span>$Load$</span>  = Electrical power output being requested by the Electric Load Center (W)

<span>${P_{Ancillary}}$</span> = Ancillary Power, user input (W)

<span>$PLR$</span>= Part-load ratio of the electric generator

<span>$PL{R_{\max }}$</span>= Maximum part-load ratio of the electric generator (i.e., the maximum value for the independent variable [PLR] defined in the Curve:Quadratic or Curve:Cubic object for the Electrical Efficiency Modifier Curve [function of part-load ratio])

<span>$PL{R_{\min }}$</span>= Minimum part-load ratio of the electric generator (i.e., the minimum value for the independent variable [PLR] defined in the Curve:Quadratic or Curve:Cubic object for the Electrical Efficiency Modifier Curve [function of part-load ratio])

The generator’s electrical efficiency is then calculated based on the user-specified reference electrical efficiency (lower heating value [LHV] basis) and two electrical efficiency modifier curves.

<div>$$ElecEfficiencyFTemp = {b_1} + {b_2}\left( {{T_{a,i}}} \right) + {b_3}{\left( {{T_{a,i}}} \right)^2}\,\,\,\,or\,\,\,\,\,{b_1} + {b_2}\left( {{T_{a,i}}} \right) + {b_3}{\left( {{T_{a,i}}} \right)^2} + {b_4}{\left( {{T_{a,i}}} \right)^3}$$</div>

<div>$$ElecEfficiencyFPLR = {c_1} + {c_2}\left( {PLR} \right) + {c_3}{\left( {PLR} \right)^2}\,\,\,\,or\,\,\,\,\,{c_1} + {c_2}\left( {PLR} \right) + {c_3}{\left( {PLR} \right)^2} + {c_4}{\left( {PLR} \right)^3}$$</div>

<div>$$ElecEf{f_{Operating}} = ElecEf{f_{Ref,LHV}}\left( {ElecEfficiencyFTemp} \right)\left( {ElecEfficiencyFPLR} \right)$$</div>

where:

<span>$ElecEfficiencyFTemp$</span> = User-defined Electrical Efficiency Modifier Curve (function of temperature) evaluated at the current combustion air inlet temperature

<span>$ElecEfficiencyFPLR$</span> = User-defined Electrical Efficiency Modifier Curve (function of part-load ratio) evaluated at the current operating part-load ratio

<span>$ElecEf{f_{Operating}}$</span> = Electrical efficiency at the current operating conditions

<span>$ElecEf{f_{Ref,LHV}}$</span> = Reference Electrical Efficiency (LHV [lower heating value] Basis),     user input

The fuel energy consumption rate (LHV Basis) is then calculated as follows:

<div>$${\dot Q_{Fuel,LHV}} = {\raise0.7ex\hbox{${{P_{Elec,Operating}}}$} \!\mathord{\left/ {\vphantom {{{P_{Elec,Operating}}} {ElecEf{f_{Operating}}}}}\right.}\!\lower0.7ex\hbox{${ElecEf{f_{Operating}}}$}}$$</div>

where:

<span>${\dot Q_{Fuel,LHV}}$</span> = Fuel energy consumption rate, LHV basis (W)

If *ElecEff<sub>Operating</sub>* is equal to zero, then *P<sub>Operating</sub>* and <span>${\dot Q_{Fuel,LHV}}$</span><sub> </sub>are set to zero. The fuel mass flow rate is then calculated.

<div>$${\dot m_{fuel}} = {\raise0.7ex\hbox{${{{\dot Q}_{Fuel,LHV}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{Fuel,LHV}}} {\left( {LHV*1000} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {LHV*1000} \right)}$}}$$</div>

where:

<span>${\dot m_{fuel}}$</span> = Mass flow rate of fuel being consumed by the generator (kg/s), report variable “Generator &lt;FuelType&gt; Mass Flow Rate [kg/s]”

*LHV* = Fuel Lower Heating Value, user input (kJ/kg)

The ancillary power is calculated next using the user-specified ancillary power and ancillary power modifier curve. The ancillary power modifier curve is a quadratic function with the generator’s fuel mass flow rate as the independent variable. If an ancillary power modifier curve is not specified in the input file, the modifier is assumed to be 1.0 and the ancillary power will be constant throughout the simulation.

<div>$$AnciPowFMdotFuel = {d_1} + {d_2}\left( {{{\dot m}_{fuel}}} \right) + {d_3}{\left( {{{\dot m}_{fuel}}} \right)^2}$$</div>

<div>$${P_{Ancillary,Operating}} = {P_{Ancillary}}\left( {AnciPowFMdotFuel} \right)$$</div>

where:

<span>$AnciPowFMdotFuel$</span> = User-defined Ancillary Power Modifier Curve (function of fuel input) evaluated at the actual fuel mass flow rate. This multiplier is assumed to be 1.0 if an ancillary power modifier curve name is not specified in the input.

<span>${P_{Ancillary}}$</span> = Ancillary power, user input (W)

<span>${P_{Ancillary,Operating}}$</span> = Ancillary electric power at the current fuel mass flow rate (W), report variable “Generator Ancillary Electric Power [W]”.

If ancillary power is constant for the simulation (e.g., no modifier curve defined), then the calculations continue as described below. However, if an ancillary power modifier curve has been defined, then the calculations described above for *P<sub>ElecOperating</sub>*, *ElecEff<sub>Operating</sub>*, <span>${\dot Q_{Fuel,LHV}}$</span><sub> </sub>and *P<sub>Ancillary,Operating</sub>* are recalculated in sequence until the solution converges.

The generator’s “net” electrical power output is calculated as the difference between the generator’s actual power output and the ancillary electric power as follows.

<div>$${P_{Elec,Produced}} = {P_{Elec,Operating}} - {P_{Ancillary,Operating}}$$</div>

where:

<span>${P_{Elec,Produced}}$</span> = Generator net electric power output, report variable “Generator Produced Electric Power [W]”

The fuel energy consumption rate (higher heating value basis) for the generator is then calculated as follows:

<div>$${\dot Q_{Fuel,HHV}} = {\dot m_{fuel}}\left( {HHV} \right)\left( {1000} \right)$$</div>

where:

<span>${\dot Q_{Fuel,HHV}}$</span> = fuel energy consumption rate (W), report variables “Generator &lt;FuelType&gt; HHV Basis Rate [W]” and “Generator Fuel HHV Basis Rate [W]”

<span>$HHV$</span>= Fuel Higher Heating Value, user input (kJ/kg)

Standby electrical power may also be modeled to simulate controls or other parasitics used by the generator. The standby power is calculated only when the generator is not operating (i.e., *Load* from the Electric Load Center is zero). If the generator operates for a given timestep (i.e., *Load* &gt; 0.0), the standby power is set equal to 0.

<div>$$\begin{array}{l}IF\,\,\left( {Load\, <  = 0.0} \right)\,\,THEN\\\,\,\,\,\,{P_{Standby}} = {P_{Standby,user\,input}}\\ELSE\\\,\,\,\,\,{P_{Standby}} = 0.0\\END\,IF\end{array}$$</div>

where:

<span>${P_{Standby,user\,input}}$</span> = Standby power, user input (W)

<span>${P_{Standby}}$</span> = Report variable “Generator Standby Electric Power” (W)

Report variables for electric energy produced, electric efficiency (LHV basis), fuel consumption (HHV basis), standby electric consumption and ancillary electric consumption are calculated as follows:

<div>$${E_{Elec,Produced}} = {P_{Elec,Produced}}\left( {TimeStepSys} \right)\left( {3600} \right)$$</div>

<div>$$ElecEf{f_{Operating,LHV}} = {\raise0.7ex\hbox{${{P_{Elec,Produced}}}$} \!\mathord{\left/ {\vphantom {{{P_{Elec,Produced}}} {{{\dot Q}_{Fuel,LHV}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot Q}_{Fuel,LHV}}}$}}$$</div>

<div>$${Q_{Fuel,HHV}} = {\dot Q_{Fuel,HHV}}\left( {TimeStepSys} \right)\left( {3600} \right)$$</div>

<div>$${E_{Standby}} = {P_{Standby}}\left( {TimeStepSys} \right)\left( {3600} \right)$$</div>

<div>$${E_{Ancillary}} = {P_{Ancillary,Operating}}\left( {TimeStepSys} \right)\left( {3600} \right)$$</div>

where:

<span>${E_{Elec,Produced}}$</span> = Report variable “Generator Produced Electric Energy [J]”

<span>$ElecEf{f_{Operating,LHV}}$</span>= Report variable “Generator LHV Basis Electric Efficiency [-]”

<span>${Q_{Fuel,HHV}}$</span> = Report variables “Generator &lt;FuelType&gt; HHV Basis Energy [J]” and “Generator Fuel HHV Basis Energy [J]”

<span>${E_{Standby}}$</span> = Report variable “Generator Standby Electric Energy [J]”

<span>${E_{Ancillary}}$</span> =  Report variable “Generator Ancillary Electric Energy [J]”

*TimeStepSys*= HVAC system simulation time step (hr)

In addition to calculating electric power production and fuel usage, the model is able to determine thermal power (heat recovery) output for heating water.  For this case, the water flow rate through the heat recovery heat exchanger is established first. If the Heat Recovery Water Flow Operating Mode (user input) is set to Plant Control, then the Reference Heat Recovery Water Flow Rate (user input) is requested whenever the generator operates (constant value), but the actual flow rate may be restricted by other plant components (e.g., pump). If the Heat Recovery Water Flow Operating Mode is set to Internal Control, then the requested water flow when the generator operates is determined by the Reference Heat Recovery Water Flow Rate and a flow rate modifier curve.

<div>$$\begin{array}{l}IF\,\,\left( {Plant\,Control} \right)\,\,THEN\\\,\,\,\,\,{{\dot m}_w} = {{\dot V}_{w,Ref}}\left( {{\rho_w}} \right)\\ELSEIF\,\left( {Internal\,Control} \right)\,THEN\\\,\,\,\,\,\,HeatRecFlowFTempPow = {e_1} + {e_2}\left( {{T_{w,i}}} \right) + {e_3}{\left( {{T_{w,i}}} \right)^2} + {e_4}\left( {{P_{net}}} \right) + {e_5}{\left( {{P_{net}}} \right)^2} + {e_6}\left( {{T_{w,i}}} \right)\left( {{P_{net}}} \right)\\\,\,\,\,\,\,{{\dot m}_w} = {{\dot V}_{w,Ref}}\left( {{\rho_w}} \right)\left( {HeatRecFlowFTempPow} \right)\\END\,IF\end{array}$$</div>

 where:

<span>${\dot m_w}$</span>= Report variable “Generator Heat Recovery Water Mass Flow Rate [kg/s]”

<span>${\dot V_{w,Ref}}$</span>= Reference Heat Recovery Water Flow Rate (m<sup>3</sup>/s), user input

<span>${\rho_w}$</span>= Density of water (kg/m<sup>3</sup>) at 5.05°C

<span>$HeatRecFlowFTempPow$</span>= User-defined Heat Recovery Water Flow Rate Modifier Curve (function of temperature and power) evaluated at the current inlet water temperature and net electrical power output. This multiplier is assumed to be 1.0 if a water flow rate modifier curve name is not specified in the input.

<span>${T_{w,i}}$</span>= Heat recovery inlet water temperature (°C), report variable “Generator Heat Recovery Inlet Temperature [C]”

<span>${P_{net}}$</span>= Net electrical power output from the generator (W)

The methodology for determining thermal power (heat recovery to water) is similar to that used for calculating electric power production. The generator’s steady-state thermal efficiency is calculated based on the user-specified reference thermal efficiency (LHV basis) and a thermal efficiency modifier curve.

<div>$$ThermalEf{f_{SS\,}} = ThermalEf{f_{Ref,LHV}}\left( {ThermalEffFTempElev} \right)$$</div>

<div>$$ThermalEffFTempElev = {f_1} + {f_2}\left( {{T_{a,i}}} \right) + {f_3}{\left( {{T_{a,i}}} \right)^2} + {f_4}\left( {Elev} \right) + {f_5}{\left( {Elev} \right)^2} + {f_6}\left( {{T_{a,i}}} \right)\left( {Elev} \right)$$</div>

where:

<span>$ThermalEf{f_{SS}}$</span>= Steady-state thermal efficiency at current conditions

<span>$ThermalEf{f_{Ref,LHV}}$</span>= Reference Thermal Efficiency (LHV Basis), user input

<span>$ThermalEffFTempElev$</span>= User-defined Thermal Efficiency Modifier Curve (function of temperature and elevation) evaluated at the current combustion air inlet temperature and elevation. This multiplier is assumed to be 1.0 if a thermal efficiency modifier curve name is not specified in the input.

The steady-state thermal power produced (heat recovery rate) is then calculated:

<div>$${P_{Thermal,SS}} = ThermalEf{f_{SS}}\left( {{{\dot Q}_{Fuel,LHV}}} \right)$$</div>

The actual (operating) thermal power is then calculated using the steady-state thermal power and three modifier curves:

<span>${P_{Thermal,Operating}} = {P_{Thermal,SS}}\left( {HeatRecRateFPLR} \right)\left( {HeatRecRateFTemp} \right)\left( {HeatRecRateFFlow} \right)$</span><span>$\begin{array}{l}HeatRecRateFPLR = {g_1} + {g_2}\left( {PLR} \right) + {g_3}{\left( {PLR} \right)^2}\,\,\,\,\, - \,or\, - \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{g_1} + {g_2}\left( {PLR} \right) + {g_3}{\left( {PLR} \right)^2} + {g_4}{\left( {PLR} \right)^3}\end{array}$</span>

<div>$$HeatRecRateFTemp = {h_1} + {h_2}\left( {{T_{w,i}}} \right) + {h_3}{\left( {{T_{w,i}}} \right)^2}$$</div>

<div>$$HeatRecRateFFlow = {i_1} + {i_2}\left( {{{\dot m}_w}} \right) + {i_3}{\left( {{{\dot m}_w}} \right)^2}$$</div>

where:

<span>${P_{Thermal,Operating}}$</span>= Report variable “Generator Produced Thermal Rate [W]”

<span>$HeatRecRateFPLR$</span>= User-defined Heat Recovery Rate Modifier Curve (function of part-load ratio) evaluated at the current operating part-load ratio. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

<span>$HeatRecRateFTemp$</span>= User-defined Heat Recovery Rate Modifier Curve (function of inlet water temperature) evaluated at the current inlet water temperature. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

<span>$HeatRecRateFFlow$</span>= User-defined Heat Recovery Rate Modifier Curve (function of water flow rate) evaluated at the current heat recovery water flow rate. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

The heat recovery output water temperature is then calculated.

<div>$${T_{w,o}} = {\rm{ }}{T_{w,i}}{\rm{ }} + {\rm{ }}{\raise0.7ex\hbox{${{P_{Thermal,Operating}}}$} \!\mathord{\left/ {\vphantom {{{P_{Thermal,Operating}}} {\left( {{{\dot m}_w}{\rm{ }}*{\rm{ }}C{p_w}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {{{\dot m}_w}{\rm{ }}*{\rm{ }}C{p_w}} \right)}$}}$$</div>

where:

<span>${T_{w,o}}$</span>= Heat recovery outlet water temperature (°C), report variable “Generator Heat Recovery Outlet Temperature [C]”

<span>$C{p_w}$</span>= Heat capacity of water (J/kg-K)

If the calculated heat recovery outlet water temperature exceeds to Maximum Heat Recovery Water Temperature (user input), then the outlet water temperature is reset to the maximum temperature (user input) and the thermal power is recalculated.

If combustion air inlet and outlet node names are specified in the input, along with exhaust air flow rate and exhaust air temperature information, then the model calculates the exhaust air conditions for each simulation time step. The exhaust air mass flow rate is first calculated based on the Reference Exhaust Air Mass Flow Rate, two modifier curves and an air density adjustment. Since fans are volumetric flow devices, the ratio of the air density at actual inlet air conditions to air density at reference inlet air conditions is used as an adjustment factor.

<span>${\dot m_{ExhAir}} = {\dot m_{ExhAir,Ref}}\left( {ExhFlowFTemp} \right)\left( {ExhFlowFPLR} \right)\left( {{\raise0.7ex\hbox{${{\rho_{a,i}}}$} \!\mathord{\left/ {\vphantom {{{\rho_{a,i}}} {{\rho_{a,Ref}}}}}\right.}\!\lower0.7ex\hbox{${{\rho_{a,Ref}}}$}}} \right)$</span><span>$\begin{array}{l}ExhFlowFTemp = {j_1} + {j_2}\left( {{T_{a,i}}} \right) + {j_3}{\left( {{T_{a,i}}} \right)^2}\,\,\,\,\, - \,or\, - \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{j_1} + {j_2}\left( {{T_{a,i}}} \right) + {j_3}{\left( {{T_{a,i}}} \right)^2} + {j_4}{\left( {{T_{a,i}}} \right)^3}\end{array}$</span>

<div>$$\begin{array}{l}ExhFlowFPLR = {k_1} + {k_2}\left( {PLR} \right) + {k_3}{\left( {PLR} \right)^2}\,\,\,\,\, - \,or\, - \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{k_1} + {k_2}\left( {PLR} \right) + {k_3}{\left( {PLR} \right)^2} + {k_4}{\left( {PLR} \right)^3}\end{array}$$</div>

where:

<span>${\dot m_{ExhAir}}$</span>= Exhaust air mass flow rate (kg/s)

<span>${\dot m_{ExhAir,Ref}}$</span>= Reference Exhaust Air Mass Flow Rate (kg/s), user input

<span>$ExhFlowFTemp$</span>= User-defined Exhaust Air Flow Rate Modifier Curve (function of temperature) evaluated at the current combustion air inlet temperature. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

<span>$ExhFlowFPLR$</span> = User-defined Exhaust Air Flow Rate Rate Modifier Curve (function of part-load ratio) evaluated at the current operating part-load ratio. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

<span>${\rho_{a,i}}$</span>= Density of the combustion inlet air (kg/m<sup>3</sup>)

<span>${\rho_{a,Ref}}$</span>= Density of combustion inlet air at reference conditions (kg/m<sup>3</sup>)

In an analogous fashion, the exhaust air temperature is calculated using the Nominal (reference) Exhaust Air Outlet Temperature and two modifier curves.

<span>${T_{a,o}} = {T_{a,o,Nom}}\left( {ExhAirTempFTemp} \right)\left( {ExhAirTempFPLR} \right)$</span><span>$\begin{array}{l}ExhAirTempFTemp = {l_1} + {l_2}\left( {{T_{a,i}}} \right) + {l_3}{\left( {{T_{a,i}}} \right)^2}\,\,\,\,\, - \,or\, - \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{l_1} + {l_2}\left( {{T_{a,i}}} \right) + {l_3}{\left( {{T_{a,i}}} \right)^2} + {l_4}{\left( {{T_{a,i}}} \right)^3}\end{array}$</span>

<div>$$\begin{array}{l}ExhAirTempFPLR = {m_1} + {m_2}\left( {PLR} \right) + {m_3}{\left( {PLR} \right)^2}\,\,\,\,\, - \,or\, - \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{m_1} + {m_2}\left( {PLR} \right) + {m_3}{\left( {PLR} \right)^2} + {m_4}{\left( {PLR} \right)^3}\end{array}$$</div>

where:

<span>${T_{a,o}}$</span>= Exhaust air outlet temperature (°C)

<span>${T_{a,o,Nom}}$</span>= Nominal Exhaust Air Outlet Temperature (°C), user input

<span>$ExhAirTempFTemp$</span>= User-defined Exhaust Air Temperature Modifier Curve (function of temperature) evaluated at the current combustion air inlet temperature. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

<span>$ExhAirTempFPLR$</span> = User-defined Exhaust Air Flow Rate Rate Modifier Curve (function of part-load ratio) evaluated at the current operating part-load ratio. This multiplier is assumed to be 1.0 if a modifier curve name is not specified in the input.

The above calculations for exhaust air outlet temperature assume no heat recovery to water is being done.  If thermal power (water heating) is being produced, then the exhaust air outlet temperature is recalculated as follows:

<div>$${T_{a,o}} = {T_{a,o}} - {\raise0.7ex\hbox{${{P_{Thermal,Operating}}}$} \!\mathord{\left/ {\vphantom {{{P_{Thermal,Operating}}} {\left( {{{\dot m}_{ExhAir}}*C{p_{air}}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {{{\dot m}_{ExhAir}}*C{p_{air}}} \right)}$}}$$</div>

where:

<span>$C{p_{air}}$</span>= Heat capacity of air at the actual combustion air inlet conditions (J/kg-K)

The exhaust air outlet humidity ratio is also calculated.

<div>$${w_{a,o}} = {w_{a,i}} + {\raise0.7ex\hbox{${\left[ {{{{{\dot m}_{fuel}}\left( {HHV - LHV} \right)\left( {1000} \right)} \mathord{\left/ {\vphantom {{{{\dot m}_{fuel}}\left( {HHV - LHV} \right)\left( {1000} \right)} {\left( {{h_{fg,16}}} \right)}}} \right. } {\left( {{h_{fg,16}}} \right)}}} \right]}$} \!\mathord{\left/ {\vphantom {{\left[ {{{{{\dot m}_{fuel}}\left( {HHV - LHV} \right)\left( {1000} \right)} \mathord{\left/ {\vphantom {{{{\dot m}_{fuel}}\left( {HHV - LHV} \right)\left( {1000} \right)} {\left( {{h_{fg,16}}} \right)}}} \right. } {\left( {{h_{fg,16}}} \right)}}} \right]} {\left( {{{\dot m}_{ExhAir}}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {{{\dot m}_{ExhAir}}} \right)}$}}$$</div>

where:

<span>${w_{a,o}}$</span>= Exhaust air outlet humidity ratio (kg/kg)

<span>${w_{a,i}}$</span>= Exhaust air inlet humidity ratio (kg/kg)

<span>${h_{fg,16}}$</span>= Enthalpy of vaporization of moisture at 16°C (J/kg)

The remaining report variables are calculated as follows.

<div>$${E_{Thermal,Produced}} = {P_{Thermal,Operating}}\left( {TimeStepSys} \right)\left( {3600} \right)$$</div>

<div>$$ThermalEf{f_{Operating,LHV}} = {\raise0.7ex\hbox{${{P_{Thermal,Operating}}}$} \!\mathord{\left/ {\vphantom {{{P_{Thermal,Operating}}} {{{\dot Q}_{Fuel,LHV}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot Q}_{Fuel,LHV}}}$}}$$</div>

where:

<span>${E_{Thermal,Produced}}$</span>= Report variable “Generator Produced Thermal Energy [J]”

<span>$ThermalEf{f_{Operating,LHV}}$</span>= Report variable “Generator Thermal Efficiency LHV Basis [-]”

### Micro-Cogenerator

The input object Generator:MicroCHP provides a model that is a direct implementation of a model developed by IEA Annex 42 – The Simulation of Building-Integrated Fuel Cell and Other Cogeneration Systems (FC+COGEN-SIM).  Annex 42 was formed as a working group within the International Energy Agency (IEA) program on Energy Conservation in Buildings and Community Systems (ECBCS). A full description of the model specification can be found in the report by Subtask B of FC+COGEN-SIM with the title “Specifications for Modelling Fuel Cell and Combustion-Based Residential Cogeneration Device within Whole-Building Simulation Programs.”  The “Micro CHP” model in EnergyPlus is the one referred to as “A Generic Model for Combustion-based Residential Cogeneration Devices.”

The Micro CHP model is a straightforward empirical model with the exception that it is dynamic with respect to thermal heat recovery where performance is cast as a function of engine temperature.  It is also dynamic with respect to possible warm up and cool down periods that may affect the ability of the generator to deliver the requested power.  The relevant model equations are:

<div>$${\eta_e} = f({\dot m_{cw}},{T_{cw,i}},{P_{net,ss}})$$</div>

<div>$${\eta_q} = f({\dot m_{cw}},{T_{cw,i}},{P_{net,ss}})$$</div>

<div>$${q_{gross}} = {P_{net,ss}}/{\eta_e}$$</div>

<div>$${q_{gen,ss}} = {\eta_q}{q_{gross}}$$</div>

<div>$${\dot N_{fuel}} = {q_{gross}}/LH{V_{fuel}}$$</div>

<div>$$
  \dot m_{fuel}^{t+\Delta t} = \left\{
    \begin{array}{cl}
      \dot m_{fuel,demand}^{t+\Delta t}       &\; if d\dot m_{fuel} / dt \le (d\dot m_{fuel}/dt)_{max} \\
      \dot m_{fuel,demand}^t \pm (d\dot m_{fuel}/dt)_{max}      &\; if d\dot m_{fuel} / dt \gt (d\dot m_{fuel}/dt)_{max} 
    \end{array}
  \right.
$$</div>

<div>$${\dot m_{air}} = f({P_{net,ss}})$$</div>

<div>$$
  P_{net}^{t+\Delta t} = \left\{
    \begin{array}{cl}
      P_{net,ss}^{t+\Delta t}       &\; if dP_{net} / dt \le (dP_{net}/dt)_{max} \\
      P_{net,ss}^t \pm (dP_{net}/dt)_{max}      &\; if dP_{net} / dt \gt (dP_{net}/dt)_{max} 
    \end{array}
  \right.
$$</div>

<div>$${[MC]_{eng}}\frac{{d{T_{eng}}}}{{dt}} = U{A_{HX}}\left( {{T_{cw,p}} - {T_{eng}}} \right) + U{A_{loss}}\left( {{T_{room}} - {T_{eng}}} \right) + {q_{gen,ss}}$$</div>

<div>$${[MC]_{cw}}\frac{{d{T_{cw,o}}}}{{dt}} = {[\dot m{c_p}]_{cw}}\left( {{T_{cw,i}} - {T_{cw,o}}} \right) + U{A_{HX}}\left( {{T_{eng}} - {T_{cw,o}}} \right)$$</div>

where,

<span>${\eta_e}$</span> is the steady-state, part load, electrical conversion efficiency of the engine (-)

<span>${\eta_q}$</span> is the steady-state part load, thermal conversion efficiency of the engine (-)

<span>${\dot m_{cw}}$</span> is the mass flow rate of plant fluid through the heat recovery section [kg/s]

<span>${T_{cw,i}}$</span> is the bulk temperature of the plant fluid entering the heat recovery section (<sup>o</sup>C)

<span>${T_{cw,o}}$</span> is the bulk temperature of the plant fluid leaving the heat recovery section (<sup>o</sup>C)

<span>${P_{net,ss}}$</span>is the steady-state electrical output of the system (W),

<span>${q_{gross}}$</span> is the gross heat input into the engine (W),

<span>${q_{gen,ss}}$</span> is the steady-state rate of heat generation within the engine (W)

<span>$LH{V_{fuel}}$</span> is the lower heating value of the fuel used by the system (J/kg or J/kmol),

<span>${\dot N_{fuel}}$</span> is the molar fuel flow rate (kmol/s)

<span>${\dot m_{fuel}}$</span> is the mass fuel flow rate (kg/s)

<span>${\dot m_{air}}$</span> is the mass flow rate of air thru the engine (kg/s)

<span>${[MC]_{eng}}$</span> is the thermal capacitance of the engine control volume (W/K)

<span>${T_{eng}}$</span> is the temperature of the engine control volume (C)

<span>$U{A_{HX}}$</span>is the effective thermal conductance between the engine control volume and the cooling water control volume (W/K).

<span>$U{A_{loss}}$</span> is the effective thermal conductance between the engine control volume and the surrounding environment (W/K)

<span>${T_{room}}$</span> is the air temperature of the surrounding environment (C)

<span>${[MC]_{cw}}$</span> is the thermal capacitance of the encapsulated cooling water and heat exchanger shell in immediate thermal contact (J/K)

<span>${[\dot m{c_p}]_{cw}}$</span> is the thermal capacity flow rate associated with the cooling water (W/K)

The functional forms for <span>${\eta_e}$</span> and <span>${\eta_q}$</span> are 2<sup>nd</sup> order trivariate polynomials with all of the cross terms.

EnergyPlus solves these for state values for the engine mass temperature, <span>${T_{eng}}$</span>, and the outlet plant node, <span>${T_{cw,o}}$</span>, in the following manner. The last two equations are interrelated but otherwise ordinary differential equations with the general form

<div>$$\frac{{dT}}{{dt}} = a + bT$$</div>

and have analytical solution

<div>$$T = \left( {{T_o} + {\raise0.7ex\hbox{$a$} \!\mathord{\left/ {\vphantom {a b}}\right.}\!\lower0.7ex\hbox{$b$}}} \right){e^{bt}} - {\raise0.7ex\hbox{$a$} \!\mathord{\left/ {\vphantom {a b}}\right.}\!\lower0.7ex\hbox{$b$}}$$</div>

The engine temperature at the current timestep is calculated using

<div>$$a = \frac{{U{A_{HX}}}}{{{{[MC]}_{eng}}}}*{T_{cw,o}} + \frac{{U{A_{loss}}}}{{{{[MC]}_{eng}}}}*{T_{room}} + \frac{{{q_{gen,ss}}}}{{{{[MC]}_{eng}}}}$$</div>

<div>$$b =  - \left( {\frac{{U{A_{HX}}}}{{{{[MC]}_{eng}}}} + \frac{{U{A_{loss}}}}{{{{[MC]}_{eng}}}}} \right)$$</div>

The plant node outlet fluid temperature (heat recovered) is solved using

<div>$$a = \frac{{{{[\dot m{c_p}]}_{cw}}}}{{{{[MC]}_{cw}}}}*{T_{cw,i}} + \frac{{U{A_{HX}}}}{{{{[MC]}_{cw}}}}*{T_{eng}}$$</div>

<div>$$b =  - \left( {\frac{{{{[\dot m{c_p}]}_{cw}}}}{{{{[MC]}_{cw}}}} + \frac{{U{A_{HX}}}}{{{{[MC]}_{cw}}}}} \right)$$</div>

The interrelation of these two is handled by sequential substitution using an iteration scheme that alternates between calculations of <span>${T_{eng}}$</span> and <span>${T_{cw,o}}$</span>.  The iteration loop exits once the energy is determined to be balanced using the following criteria:

Number of iterations &gt; 3\\

<div>$$\frac{{{{\left( {{q_{gen,ss}}} \right)}_{\max }}}}{{10000000}} > U{A_{HX}}\left( {{T_{cw,o}} - {T_{eng}}} \right) + U{A_{loss}}\left( {{T_{room}} - {T_{eng}}} \right) + {q_{gen,ss}} - {[MC]_{eng}}\frac{{d{T_{eng}}}}{{dt}}$$</div>

<div>$$\frac{{{{\left( {{q_{gen,ss}}} \right)}_{\max }}}}{{10000000}} > {[\dot m{c_p}]_{cw}}\left( {{T_{cw,i}} - {T_{cw,o}}} \right) + U{A_{HX}}\left( {{T_{eng}} - {T_{cw,o}}} \right) - {[MC]_{cw}}\frac{{d{T_{cw,o}}}}{{dt}}$$</div>

The Micro CHP model has a number of different operating modes.  The operating mode for a given system timestep is determined from the mode during the previous timestep, user inputs, and high-level controls from elsewhere in EnergyPlus.  The operating mode is reported for the state at the end of each timestep.  The following table summarizes the various operating modes and the criteria for switching to a new mode for any given timestep.  The EnergyPlus implementation adds the “Off” mode to the modes specified by Annex 42 which corresponds to the unit being scheduled to be unavailable.  The difference between OFF and Standby modes determines whether or not standby power is consumed.

<table class="table table-striped">
<tr>
<th>Operating mode</th>
<th>Main Criteria</th>
<th>Notes</th>
</tr>
<tr>
<td>Off</td>
<td>Availability schedule value = 0</td>
<td>No consumption of power or fuel.</td>
</tr>
<tr>
<td>Stand By</td>
<td>Availability schedule value ≠ 0</td>
<td>Consumes stand by power but no fuel</td>
</tr>
<tr>
<td>Warm Up</td>
<td>Load (thermal or electric) &gt; 0.0
Availability schedule value ≠ 0
Time Delay &lt; elapsed time since entering warm up mode
Engine temp &lt; nominal engine temp</td>
<td>Two alternate sub-modes:  Stirling Engines use warm up by “nominal engine temperature” while Internal Combustion Engines use “time delay”
Fuel is consumed but no power is produced</td>
</tr>
<tr>
<td>Normal Operation</td>
<td>Load (thermal or electric) &gt; 0.0 Availability schedule value ≠ 0 Time Delay &gt; elapsed time since entering warm up mode
Engine temp &gt;= nominal temp</td>
<td>Fuel is consumed and power is produced</td>
</tr>
<tr>
<td>Cool Down</td>
<td>Load (thermal or electric) = 0.0
Availability schedule value ≠ 0</td>
<td>Two alternate sub-modes where engine can be forced to go thru a complete cool down cycle before allowed to go back into warm up or normal mode.
No fuel is consumed and no power is produced.</td>
</tr>

</table>

For timesteps where the generator switches from warm up mode to normal mode in the middle of the timestep, part load ration values are calculated for the portion of the time step that the generator is in normal operation.

The engine and heat recovery thermal conditions are modeled for all modes so, for example, an engine that is off but still warm could provide some hot water recovery.

The engine model can use an arbitray fuel mixture that is defined by the user – see the entry for Generator:FuelSupply.

#### References

Kelly, N. and A. Ferguson. 2007. A Generic Model Specification for Combustion-based Residential Cogeneration Devices. In *Specifications for Modelling Fuel Cell and Combustion-Based Residential Cogeneration Device within Whole-Building Simulation Programs*. I. Beausoleil-Morrison and N. Kelly editors.  Draft report of Annex 42 of the International Energy Agency ECBCS.

### Fuel Cell Cogenerator

The Generator:FuelCell input objects provides a model which is a direct implementation of a model developed by IEA Annex 42 – The Simulation of Building-Integrated Fuel Cell and Other Cogeneration Systems (FC+COGEN-SIM).  Annex 42 was formed as a working group within the International Energy Agency (IEA) program on Energy Conservation in Buildings and Community Systems (ECBCS).  A full description of the model specification can be found in the report by Subtask B of FC+COGEN-SIM with the title “Specifications for Modelling Fuel Cell and Combustion-Based Residential Cogeneration Device within Whole-Building Simulation Programs.”  The “Specifications for Modelling Fuel Cell Cogeneration Devices within Whole-Building Simulation Programs.”

The Annex 42 Fuel Cell model is characterized as a “grey box” empirical model where a mixture of thermodynamic principles and empirical performance maps are used to model the cogeneration performance of a fairly complex device with many individual subsystems.  In EnergyPlus, the individual subsystems are separate into individual input objects such as Generator:FuelCell:PowerModule or Generator:FuelCell:ExhaustGasToWaterHeatExchanger. The resulting model is relatively complex requiring on the order of one hundred inputs.  The model is not for the faint of heart; this model is far more involved than most component models in building simulation.  This stems from the fact that fuel cell cogenerators are complicated devices that interact with the built environment in a number of ways.  Fuel cells could drawn in gas/fuel, air, and water with as many as six separate streams.  In addition to electricity and heated water, they also give off heat in the form of convection and radiation and exhaust air out of the zone.  The devices may take a long time to start up and include storage to follow loads rather than attempt to vary the power the fuel cell.  The fuel cell model allows examining system level interactions over annual timeframes that include all the important interactions with a building’s energy and comfort systems.

The Annex 42 fuel cell model is described more thoroughly in the references (see below).  Here we provide a summary of the relevant model equations which are taken from the Annex 42 model specification.  The first equation is the main energy balance for the fuel cell power module (includes the fuel reformation and fuel cell stacks).  This energy balance is used to model the enthalpy of the product gases that leave the fuel cell power module.

<div>$$\begin{array}{l}{\sum\limits_i {\left( {{{\dot N}_i} \cdot \left[ {{{\hat h}_i} - {\Delta_f}\hat h_i^o} \right]} \right)}_{fuel}} + {\sum\limits_i {\left( {{{\dot N}_i} \cdot \left[ {{{\hat h}_i} - {\Delta_f}\hat h_i^o} \right]} \right)}_{air}} + {{\dot N}_{liq - water}} \cdot \left( {{{\left[ {\hat h - {\Delta_f}{{\hat h}^o}} \right]}_{{H_2}O,liq}} - {\Delta_f}\hat h_{{H_2}O,fg}^o} \right)\\\quad \quad  + {{\dot H}_{dilution - air - in}} + {{\dot N}_{fuel}} \cdot LH{V_{fuel}} + {P_{el,ancillaries - AC}}\\ = {P_{el}} + {\sum\limits_i {\left( {{{\dot N}_i} \cdot \left[ {{{\ddot h}_i} - {\Delta_f}\hat h_i^o} \right]} \right)}_{FCPM - cg}} + {q_{s - cool}} + {q_{skin - loss}} + {{\dot H}_{dilution - air - out}}\end{array}$$</div>

The remaining equations describe various terms and the balance of systems.  The electrical efficiency is modeled using:

<div>$${\varepsilon_{el}} = \left[ {{\varepsilon_0} + {\varepsilon_1} \cdot {P_{el}} + {\varepsilon_2} \cdot P_{el}^2} \right] \cdot \left[ {1 - {N_{stops}} \cdot D} \right] \cdot \left[ {1 - (MAX(\int\limits_{} {dt - {t_{threshold}},0.0))}  \cdot L} \right]$$</div>

<div>$${P_{blower - el}} = {b_0} + {b_1} \cdot {\dot N_{air}} + {b_2} \cdot \dot N_{air}^2 + {b_3} \cdot \dot N_{air}^3$$</div>

In several places the model is formulated to offer different options.  For example, the flow rate of process air can be described either as a function of electrical power produced or the fuel flow rate.

<div>$${\dot N_{air}} = \left[ {{a_0} + {a_1} \cdot {P_{el}} + {a_2} \cdot P_{el}^2} \right].\left[ {1 + {a_3} \cdot {T_{air}}} \right]$$</div>

or

<div>$${\dot N_{air}} = \left[ {{a_0} + {a_1} \cdot {{\dot N}_{fuel}} + {a_2} \cdot \dot N_{fuel}^2} \right].\left[ {1 + {a_3} \cdot {T_{air}}} \right]$$</div>

<div>$${\dot N_{liq - water}} = {w_0} + {w_1} \cdot {\dot N_{fuel}} + {w_2} \cdot \dot N_{fuel}^2$$</div>

<div>$${P_{pump - el}} = {p_0} + {p_1} \cdot {\dot N_{water}} + {p_2} \cdot \dot N_{water}^2 + {p_3} \cdot \dot N_{water}^3$$</div>

<div>$${P_{comp - el}} = {c_0} + {c_1} \cdot {\dot N_{fuel}} + {c_2} \cdot \dot N_{fuel}^2 + {c_3} \cdot \dot N_{fuel}^3$$</div>

<div>$${P_{el,ancillaries - AC}} = an{c_0} + an{c_1} \cdot {\dot N_{fuel}}$$</div>

<div>$${P_{el,aux - ancillaries}} = {x_0} + {x_1} \cdot {\dot N_{aux - fuel}}$$</div>

<div>$${q_{HX}} = {\varepsilon_{HX}} \cdot {\left( {\dot N{{\hat c}_p}} \right)_{\min }} \cdot \left( {{T_{aux - mix}} - {T_{water,in}}} \right)$$</div>

<div>$${q_{HX}} = {\left( {UA} \right)_{eff}} \cdot \frac{{\left( {{T_{aux - mix}} - {T_{water,out}}} \right) - \left( {{T_{HX - exh}} - {T_{water,in}}} \right)}}{{\ln \left( {\frac{{{T_{aux - mix}} - {T_{water,out}}}}{{{T_{HX - exh}} - {T_{water,in}}}}} \right)}}$$</div>

<div>$${\left( {UA} \right)_{eff}} = h{x_{s,0}} + h{x_{s,1}} \cdot {\dot N_{water}} + h{x_{s,2}} \cdot \dot N_{water}^2 + h{x_{s,3}} \cdot {\dot N_{aux - mix}} + h{x_{s,4}} \cdot \dot N_{aux - mix}^2$$</div>

or

<div>$${\left( {UA} \right)_{eff}} = {\left[ {\frac{1}{{{{\left( {hA} \right)}_{gas}}}} + \frac{1}{{{{(hA)}_{water}}}} + {F_{HX}}} \right]^{ - 1}}$$</div>

where,

<span>${F_{HX}}$</span> is an adjustment factor,

<div>$$h_{gas} = h_{gas}^0 \left( \frac{\dot N_{gas}}{\dot N_{gas}^0} \right)^n}$$</div>

<div>$${h_{water}} = h_{water}^0 \cdot {\left( {\frac{{{{\dot N}_{water}}}}{{\dot N_{water}^0}}} \right)^m}$$</div>

<div>$${q_{HX}} = {\left( {UA} \right)_{eff}} \cdot \frac{{\left( {{T_{aux - mix}} - {T_{water,out}}} \right) - \left( {{T_{HX - exh}} - {T_{water,in}}} \right)}}{{\ln \left( {\frac{{{T_{aux - mix}} - {T_{water,out}}}}{{{T_{HX - exh}} - {T_{water,in}}}}} \right)}} + {\dot N_{{H_2}O - cond}} \cdot {\hat h_{fg}}$$</div>

<div>$${\dot N_{{H_2}O - cond}} = \left( {{T_{cond - threshold}} - {T_{water,in}}} \right) \cdot \left[ {h{x_{l,1}} \cdot \left( {\frac{{{{\dot N}_{{H_2}O}}}}{{{{\dot N}_{aux - mix}}}}} \right) + h{x_{l,2}} \cdot {{\left( {\frac{{{{\dot N}_{{H_2}O}}}}{{{{\dot N}_{aux - mix}}}}} \right)}^2}} \right]$$</div>

<div>$${q_{aux - skin - losses}} = {(UA)_{aux}} \cdot ({T_{aux - mix}} - {T_{room}})$$</div>

<div>$${q_{skin - loss}} = {s_0} + {s_1} \cdot {\dot N_{fuel}} + {s_2} \cdot \dot N_{fuel}^2$$</div>

<div>$$Q_{battery}^{t + \Delta t} = Q_{battery}^t + {P_{battery - charge}} \cdot {\varepsilon_{charge}} \cdot \Delta t$$</div>

<div>$${\eta_{PCU}} = {u_0} + {u_1} \cdot {P_{PCU - in}} + {u_2} \cdot P_{PCU - in}^2$$</div>

<div>$${q_{s - cool}} = \left[ {{r_0} + {r_1}\left( {{T_{stack}} - T_{stack}^o} \right)} \right] \cdot \left[ {1 + {r_2}{P_{el}} + {r_3}P_{el}^2} \right]$$</div>

<div>$${\left( {UA} \right)_{s - cogen}} = {\left[ {\frac{1}{{{{\left( {hA} \right)}_{s - cogen}}}} + {F_{s - cogen}}} \right]^{ - 1}}$$</div>

<div>$${h_{s - cogen}} = h_{s - cogen}^0 \cdot {\left( {\frac{{{{\dot N}_{s - cogen}}}}{{\dot N_{s - cogen}^0}}} \right)^{{n_s}}}$$</div>

<div>$${P_{s - air - el}} = {f_0} + {f_1} \cdot {q_{s - air}} + {f_2} \cdot q_{s - air}^2$$</div>

The Annex 42 fuel cell was implemented directly in EnergyPlus.  A sequential substitution method is used to handle all the interactions between the different subsystems.  The main energy balance drawn for the fuel cell power module is rearranged to put all the terms on the right hand side.  The enthalpy of the product gas stream is determined from this energy balance.  The Shomate equation is used to evaluate the enthalpy and specific heat of the various streams.  The EnergyPlus implementation evaluates fluid properties using the average temperature of inlet and outlet streams whereas the Annex 42 specification often uses just the inlet temperature.  The Shomate equation is inverted using the regula falsi numerical method available within EnergyPlus to calculate the temperature of the product gases from their enthalpy.

#### References

Beausoleil-Morrison, I., A. Schatz, and F. Marechal. 2006. A model for simulating the thermal and electrical production of small-scale solid-oxide fuel cell cogeneration systems within building simulation programs.  *HVAC & R Research*. Amer. Soc. Heating, Ref. Air-Conditioning Eng. Inc. Atlanta, GA.

Beausoleil-Morrison, I., A. Weber, F. Marechal, and B. Griffith. 2007. Specifications for Modelling Fuel Cell Cogeneration Devices within Whole-Building Simulation Programs. In *Specifications for Modelling Fuel Cell and Combustion-Based Residential Cogeneration Device within Whole-Building Simulation Programs*. I. Beausoleil-Morrison and N. Kelly editors.  **Draft** report of Annex 42 of the International Energy Agency ECBCS.

### Custom Fuel Supply for Generators

The Generator:FuelSupply input object in EnergyPlus implements a fairly comprehensive capability to calculate properties of fuel mixtures from a description of the molar composition of all the constituents.  The fuel supply modeling is based on the specifications prepared by IEA Annex 42 for their generator models.  This modeling capability allows taking into consideration the exact gas composition of local natural gas service.  Or the user can explore the implications of an various alternative fuels such as alcohols or biogas.  An unlimited number of possible mixtures can be analyzed.

Gas phase thermochemistry calculations and data are programmed into EnergyPlus to handle the set of constituents listed in the table below.  The relevant properties of each fuel constituent, *i*, are calculated as a function of temperature using the Shomate equation:

<div>$${\hat h_i} - {\Delta_f}\hat h_i^o = A \cdot \left( {\frac{T}{{1000}}} \right) + \frac{B}{2} \cdot {\left( {\frac{T}{{1000}}} \right)^2} + \frac{C}{3} \cdot {\left( {\frac{T}{{1000}}} \right)^3} + \frac{D}{4} \cdot {\left( {\frac{T}{{1000}}} \right)^4} - \frac{E}{{\left( {\frac{T}{{1000}}} \right)}} + F - H$$</div>

where,

<span>${\hat h_i}$</span> is the enthalpy (J/kmol)

<span>${\Delta_f}\hat h_i^o$</span> is the molar enthalpy at the standard state (J/kmol)

<span>$T$</span> is the temperature of the gas (K)

A, B, C, D, E, F, H are the coefficients for the Shomate equation.

The lower heating value (LHV) of a fuel mixture is calculated from the molar fractions using:

<div>$$LH{V_{fuel}} = \sum\limits_i {\left( {{\chi_i} \cdot LH{V_i}} \right)} $$</div>

Where,

<div>$$LH{V_i} = \left[ {{\Delta_f}\hat h_{{C_x}{H_y}}^o - x \cdot {\Delta_f}\hat h_{C{O_2}}^o - \frac{y}{2} \cdot {\Delta_f}\hat h_{{H_2}O}^o} \right]$$</div>

*x* is the number of carbon atoms

*y* is the number of hydrogen atoms

Similarly, the higher heating value (HHV) of the fuel mixture is calculated using:

<div>$$HH{V_{fuel}} = \sum\limits_i {\left( {{\chi_i} \cdot HH{V_i}} \right)} $$</div>

Where,

<div>$$HH{V_i} = \left[ {{\Delta_f}\hat h_{{C_x}{H_y}}^o - x \cdot {\Delta_f}\hat h_{C{O_2}}^o - \frac{y}{2} \cdot {\Delta_f}\hat h_{{H_2}O}^o + \frac{y}{2} \cdot \left( {{\Delta_f}\hat h_{{H_2}O}^o - {H_{liq}}} \right)} \right]$$</div>

The Shomate coefficients used in EnergyPlus are listed in the table below.  Data source “NIST” indicates the data were directly from Chemistry WebBook.  Data source “CHEMKIN” indicates the data were developed by curve fitting library data for the CHEMKIN commercial program (which uses the Gorden-McBride polynomial rather than the Shomate formulation).

<table class="table table-striped">
<tr>
<th>Constituent</th>
<th>A</th>
<th>B</th>
<th>C</th>
<th>D</th>
<th>E</th>
<th>F</th>
<th>H</th>
<th>Source</th>
</tr>
<tr>
<td>N<sub>2</sub></td>
<td>26.092</td>
<td>8.218801</td>
<td>-1.976141</td>
<td>0.159274</td>
<td>0.044434</td>
<td>-7.98923</td>
<td>0.0</td>
<td>NIST</td>
</tr>
<tr>
<td>O<sub>2</sub></td>
<td>29.659</td>
<td>6.137261</td>
<td>-1.186521</td>
<td>0.09578</td>
<td>-0.219663</td>
<td>-9.861391</td>
<td>0.0</td>
<td>NIST</td>
</tr>
<tr>
<td>Ar</td>
<td>20.786</td>
<td>2.8259E-7</td>
<td>-1.4642E-7</td>
<td>1.0921E-8</td>
<td>-3.6614E-8</td>
<td>-6.19735</td>
<td>0.0</td>
<td>NIST</td>
</tr>
<tr>
<td>CO<sub>2</sub></td>
<td>24.99735</td>
<td>55.18696</td>
<td>-33.69137</td>
<td>7.948387</td>
<td>-0.136638</td>
<td>-403.6075</td>
<td>-393.5224</td>
<td>NIST</td>
</tr>
<tr>
<td>H<sub>2</sub>O(gas)</td>
<td>29.0373</td>
<td>10.2573</td>
<td>2.81048</td>
<td>-0.95914</td>
<td>0.11725</td>
<td>-250.569</td>
<td>-241.8264</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>H<sub>2</sub>O(liq)</td>
<td>-203.606</td>
<td>1523.29</td>
<td>-3196.413</td>
<td>2474.455</td>
<td>3.85533</td>
<td>-256.5478</td>
<td>-285.8304</td>
<td>NIST</td>
</tr>
<tr>
<td>H<sub>2</sub></td>
<td>33.066178</td>
<td>-11.363417</td>
<td>11.432816</td>
<td>-2.772874</td>
<td>-0.158558</td>
<td>-9.9808</td>
<td>0.0</td>
<td>NIST</td>
</tr>
<tr>
<td>CH<sub>4</sub></td>
<td>-0.703029</td>
<td>108.4773</td>
<td>-42.52157</td>
<td>5.862788</td>
<td>0.678565</td>
<td>-76.84376</td>
<td>-74.8731</td>
<td>NIST</td>
</tr>
<tr>
<td>C<sub>2</sub>H<sub>6</sub></td>
<td>-3.03849</td>
<td>199.202</td>
<td>-84.9812</td>
<td>11.0348</td>
<td>0.30348</td>
<td>-90.0633</td>
<td>-83.8605</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>C<sub>3</sub>H<sub>8</sub></td>
<td>-23.1747</td>
<td>363.742</td>
<td>-222.981</td>
<td>56.253</td>
<td>0.61164</td>
<td>-109.206</td>
<td>-103.855</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>C<sub>4</sub>H<sub>10</sub></td>
<td>-5.24343</td>
<td>426.442</td>
<td>-257.955</td>
<td>66.535</td>
<td>-0.26994</td>
<td>-149.365</td>
<td>-133.218</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>C<sub>5</sub>H<sub>12</sub></td>
<td>-34.9431</td>
<td>576.777</td>
<td>-338.353</td>
<td>76.8232</td>
<td>1.00948</td>
<td>-155.348</td>
<td>-146.348</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>C<sub>6</sub>H<sub>14</sub></td>
<td>-46.7786</td>
<td>711.187</td>
<td>-438.39</td>
<td>103.784</td>
<td>1.23887</td>
<td>-176.813</td>
<td>-166.966</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>CH<sub>3</sub>OH</td>
<td>14.1952</td>
<td>97.7218</td>
<td>-9.73279</td>
<td>-12.8461</td>
<td>0.15819</td>
<td>-209.037</td>
<td>-201.102</td>
<td>CHEMKIN</td>
</tr>
<tr>
<td>C<sub>2</sub>H<sub>5</sub>OH</td>
<td>-8.87256</td>
<td>282.389</td>
<td>-178.85</td>
<td>46.3528</td>
<td>0.48364</td>
<td>-241.239</td>
<td>-234.441</td>
<td>CHEMKIN</td>
</tr>

</table>

#### References

Beausoleil-Morrison, I., A. Weber, F. Marechal, and B. Griffith. 2007. Specifications for Modelling Fuel Cell Cogeneration Devices within Whole-Building Simulation Programs. In *Specifications for Modelling Fuel Cell and Combustion-Based Residential Cogeneration Device within Whole-Building Simulation Programs*. I. Beausoleil-Morrison and N. Kelly editors.  Report of Annex 42 of the International Energy Agency ECBCS.

NIST. 2003. Chemistry WebBook, National Institute of Standards and Technology Standard Reference Database Number 69, March 2003 Release, .

Gordon S. and B.J. McBride. 1971. Computer program for calculation of complex chemical equilibrium composition, rocket performance, incident and reflected shocks and Chapman-Jouguet detonations.  NASA SP-273.

### Wind Turbine

#### Overview

The wind turbine (object Generator:WindTurbine) model is intended to estimate the production of electric power of both horizontal and vertical axis wind turbine systems. Due to the cubic relationship between the wind speed and the power produced by a wind turbine, the performance of these systems is highly dependent on local wind conditions. However, differences between typical meteorological year (TMY) wind data attached to the simulation and local wind data at the site where wind turbine system is installed typically appear. The model thus estimates the air density and wind speed at the particular height of the system and factors differences between the wind speed from the TMY weather data and the local wind speed. The weather data file should thus be included in the simulation. The model also requires inputs of both an annual average wind speed that represents accurate wind profile at the location and the height where this annual average wind speed was determined.

The model calculates the power production by both horizontal axis wind turbines (HAWT) and vertical axis wind turbines (VAWT) from generic mathematical equations. Currently, a variable speed control scheme is available in EnergyPlus. The model assumes constant power generation at the rated power and the rated wind speed when the ambient wind speed is between the rated wind speed and cut out wind speed. The model does not attempt to model various types of subsystems of the entire wind turbine system such as shafts, generators and inverters due to computational convergence, time, and usability. Instead, the total system efficiency includes both conversion losses occurring during the DC-AC-DC conversion processes and delivery losses.

#### Model Description

The wind turbine is modeled as a generation component that produces electricity and delivers it directly to buildings. Wind turbine components are executed at the beginning of each time step called by the HVAC manager, and the electric load will be corrected with electricity from the wind turbine. The model calculates electricity production that both HAWTs and VAWTs produce from general mathematical equations. The model then passes the electricity to the electric load center in EnergyPlus at each HVAC system time step. The electric load center then determines the whole building electrical demand, deducting the power output by wind turbine along with any power production by photovoltaic components from the total electrical demand requested in the building. Excessive production of electricity greater than needed from wind turbine along with photovoltaic components is either sold or stored as the user specifies.

#### Input and Data

The user must input the required information according to the IO Reference Manual (ref: Generator:WindTurbine). The wind turbine model in EnergyPlus requires a unique identifying name and an availability schedule. The schedule name must refer to a valid schedule type (range 0-1) and contain values of fractional operation. Various inputs describes wind turbine configuration such as rotor type, control type, rotor diameter, overall height, and number of blades. Rated data provided in the manufacturer’s literature determines overall electricity production by using generic equations. These inputs include rated power, rated wind speed, cut in wind speed, cut out wind speed, fraction system efficiency, and maximum tip speed ratio. Two inputs such as annual local average wind speed and height for local average wind speed define local wind conditions at a specific location so that the model predicts wind speed and air density at the height of the wind turbine at the location.

HAWT systems need a maximum power coefficient and empirical power coefficient parameters *C<sub>1</sub>* through *C<sub>6</sub>*. The maximum power coefficient controls overall performance of the rotor which defines the power extraction efficiency from the ambient air stream. The model predicts power generation more accurately when the user inputs the empirical power coefficients *C<sub>1</sub>* through *C<sub>6</sub>* for a specific wind turbine. Three additional inputs for VAWT system are required. The model requests blade lift and drag coefficients corresponding to the maximum tip speed ratio so that tangential and normal force coefficients are obtained. Blade chord area is also requested for calculating forces on a single blade.

#### Simulation and Control

Given the inputs needed, the wind turbine model analyzes local wind speed since wind speed is critical to determine the production of electricity of wind turbine systems. To minimize uncertainty involved with wind data, it factors differences between annual average wind speed from weather data and local annual average wind speed at the particular height of the local meteorological station. It reads annual average wind speed from statistical weather file that is automatically copied during the simulation. Note that the user should attach a weather data to the simulation (for a design day simulation, the wind speed data from the design day description is used). This annual average wind speed is converted into a wind speed at the height at which local annual average wind speed that the user inputs is measured and then factored as:

<div>$${V_{LocalTMY}} = {V_{AnnualAvg}}{\left( {\frac{{{\delta_{met}}}}{{{H_{met}}}}} \right)^{{a_{met}}}}{\left( {\frac{H}{\delta }} \right)^a}$$</div>

<div>$${F_V} = \frac{{{V_{LocalTMY}}}}{{{V_{Local}}}}$$</div>

Note that the wind speed factor *F<sub>v</sub>* of 1.0 is assigned, if the user does not input the local wind conditions or the weather data file is not attached to the simulation.

The local air density can be obtained by using EnergyPlus psychrometric functions as follows:

<div>$${T_{Local}} = OutDryBulbTempAt(Z)$$</div>

<div>$${P_{Local}} = OutBaro\Pr essAt(Z)$$</div>

<div>$${\omega_{Local}} = PsyWFnTdbTwbPb({T_{Local}},{T_{wb}},{P_{Local}})$$</div>

<div>$${\rho_{Local}} = PsyRhoAirFnPbTdbW({P_{Local}},{T_{Local}},{\omega_{initial}})$$</div>

The model converts TMY wind speed into a wind speed at the specific height of the wind turbine rotor (*V<sub>z</sub>*) at the location by using EnergyPlus function as:

<div>$${V_Z} = WindSpeedAt(Z)$$</div>

The local wind speed at the rotor height (*V<sub>Local</sub>*) at the location is thus:

<div>$${V_{Local}} = \frac{{{V_Z}}}{{{F_v}}}$$</div>

The tip speed ratio (TSR) can be obtained as:

<div>$$\lambda  = \frac{{\omega R}}{{{V_{Local}}}}$$</div>

#### Horizontal Axis Wind Turbine

Once the local wind speed and air density are determined, the model calculates electrical power produced by a wind turbine system according to the rotor type. For HAWT systems, two different approximations are available. The model uses an analytical approximation when the user inputs all six empirical coefficient parameters *C<sub>1</sub>* through *C<sub>6</sub>*. The equations that define the analytical approximation are:

<div>$${C_p} = {C_1}(\frac{{{C_2}}}{{{\lambda_i}}} - {C_3}\theta  - {C_4}{\theta ^x} - {C_5}){e^{ - \frac{{{C_6}(\lambda ,\theta )}}{{{\lambda_i}}}}}$$</div>

<div>$$\frac{1}{{{\lambda_i}}} = \frac{1}{{\lambda  + 0.08\theta }} - \frac{{0.035}}{{{\theta ^3} + 1}}$$</div>

Note that the model allows changing the rotor speed to meet the maximum tip speed ratio at each time step. That is, the tip speed ratio calculated is limited by the maximum tip speed ratio. Similarly, the power coefficient calculated is also set to the maximum if the calculated is greater than the maximum.

Assuming maximum of rotor angle, i.e. zero, the power production of the wind turbine is thus obtained by:

<div>$${P_W} = \frac{1}{2}{\rho_{Local}}{A_R}V_{_{Local}}^3{C_p}(\lambda ,\theta )$$</div>

The model assumes the simple approximation, if any of empirical power coefficient parameters is not input. The power production of wind turbine is directly obtained from the kinetic energy equation:

<div>$${P_W} = \frac{1}{2}{\rho_{Local}}{A_R}V_{_{Local}}^3{C_{p,\max }}(\lambda ,\theta )$$</div>

Here, the model defines *P<sub>W</sub>* as rated power output at the rated wind speed, if either the power production of wind turbine or local wind speed is greater than the rated power or rated wind speed, respectively. The power coefficient in this particular case is thus recalculated as:

<div>$${C_p} = \frac{{{P_W}}}{{0.5{\rho_{Local}}AV_{_{Local}}^3}}$$</div>

The overall power production that includes conversion loss and delivery loss is thus:

<div>$$P = \eta {P_W}$$</div>

#### Vertical Axis Wind Turbine

![WindTurbine-1](EngineeringReference/media/image7837.png)

Figure 340. Flow velocities and force diagram of a single blade airfoil
 (Adapted from Mazharul Islam et al., 2008)

If tip speed ratio at the time step is greater than the maximum tip speed ratio, the model estimates actual rotor speed at the time step as:

<div>$$\omega R = \lambda {V_{Local}}$$</div>

The model then employs general mathematical expressions for the aerodynamic analysis of straight-bladed Darrieus-type VAWTs to predict the power production by VAWTs. Assuming quasi-steady state, the induced wind speed (*V<sub>a</sub>*) on the rotor is defined as:

<div>$${V_a} = \frac{2}{3}{V_{Local}}$$</div>

The chordal velocity (*V<sub>c</sub>*), normal velocity (*V<sub>n</sub>*), and relative flow velocity (*W*) as shown in figure above can be expressed as:

<div>$${V_c} = \omega R + {V_a}\cos \theta $$</div>

<div>$${V_n} = {V_a}\sin \theta $$</div>

<div>$$W = \sqrt {V_c^2 + V_n^2} $$</div>

The expression for the non-dimensional angle of attack (*α*) with no consideration of blade pitch is:

<div>$$\alpha  = {\tan ^{ - 1}}\left[ {\frac{{\sin \theta }}{{{{(\omega R} \mathord{\left/ {\vphantom {{(\omega R} {{V_{Local}})/({{{V_a}} \mathord{\left/ {\vphantom {{{V_a}} {{V_{Local}}}}} \right. } {{V_{Local}}}}}}} \right. } {{V_{Local}})/({{{V_a}} \mathord{\left/ {\vphantom {{{V_a}} {{V_{Local}}}}} \right. } {{V_{Local}}}}}}) + \cos \theta }}} \right]$$</div>

The tangential and normal force coefficients, respectively, are expressed as:

<div>$${C_t} = {C_l}\sin \alpha  + {C_d}\cos \alpha $$</div>

<div>$${C_n} = {C_l}\cos \alpha  + {C_d}\sin \alpha $$</div>

The net tangential and normal forces are obtained from the following expressions:

<div>$${F_t} = {C_t}\frac{1}{2}{\rho_{Local}}{A_c}{W^2}$$</div>

<div>$${F_n} = {C_n}\frac{1}{2}{\rho_{Local}}{A_c}{W^2}$$</div>

Average tangential force on a single blade can be defined as:

<div>$${F_{ta}} = \frac{1}{{2\pi }}\int_0^{2\pi } {{F_t}(\theta )d\theta } $$</div>

Substituting the values of *F<sub>t</sub>* and arranging tangential force on azimuth angle, <span>$\theta $</span>, equation above can be written as:

<div>$${F_{ta}} = \frac{1}{{4\pi }}{C_t}{\rho_{Local}}{A_c}(\int_0^{2\pi } {{{(\omega R)}^2}}  + \int_0^{2\pi } {V_a^2} )$$</div>

The expression of the total torque for the number of blades is defined as:

<div>$$Q = N{F_{ta}}$$</div>

The power production of wind turbine is thus:

<div>$${P_W} = Q\omega $$</div>

The model also defines *P<sub>W</sub>* as the rated power output at the rated wind speed, if either the power production of wind turbine or local wind speed is greater than the rated power.

The overall power production delivered from a wind turbine system is thus:

<div>$$P = \eta {P_W}$$</div>

Table 92. Nomenclature for Wind Turbine model

<table class="table table-striped">
<tr>
<th>Variable</th>
<th>Description</th>
<th>Units</th>
</tr>
<tr>
<td>A<sub>R</sub></td>
<td>swept area of rotor</td>
<td>m2</td>
</tr>
<tr>
<td>A<sub>C</sub></td>
<td>blade chord area</td>
<td>m2</td>
</tr>
<tr>
<td>a</td>
<td>site wind exponent, 0.22</td>
<td> </td>
</tr>
<tr>
<td>a<sub>met</sub></td>
<td>wind exponent, 0.14</td>
<td> </td>
</tr>
<tr>
<td>C<sub>d</sub></td>
<td>blade drag coefficient, 0.9</td>
<td> </td>
</tr>
<tr>
<td>C<sub>l</sub></td>
<td>blade lift coefficients, 0.05</td>
<td> </td>
</tr>
<tr>
<td>C<sub>n</sub></td>
<td>normal force coefficient</td>
<td> </td>
</tr>
<tr>
<td>C<sub>p</sub></td>
<td>power coefficient (performance coefficient)</td>
<td> </td>
</tr>
<tr>
<td>C<sub>t</sub></td>
<td>tangential force coefficient</td>
<td> </td>
</tr>
<tr>
<td>C<sub>1-6</sub></td>
<td>empirical power coefficient parameters</td>
<td> </td>
</tr>
<tr>
<td>g<sub>o</sub></td>
<td>standard gravity</td>
<td>m/s2</td>
</tr>
<tr>
<td>F<sub>n</sub></td>
<td>normal force in radial direction</td>
<td>N.m (J)</td>
</tr>
<tr>
<td>F<sub>t</sub></td>
<td>tangential force</td>
<td>N.m (J)</td>
</tr>
<tr>
<td>F<sub>ta</sub></td>
<td>average tangential force</td>
<td>N.m (J)</td>
</tr>
<tr>
<td>F<sub>v</sub></td>
<td>wind speed factor</td>
<td> </td>
</tr>
<tr>
<td>H</td>
<td>height of local wind speed measurement</td>
<td>m</td>
</tr>
<tr>
<td>H<sub>met</sub></td>
<td>height of turbine, 10</td>
<td>m</td>
</tr>
<tr>
<td>N</td>
<td>number of blade</td>
<td> </td>
</tr>
<tr>
<td>P</td>
<td>overall power production delivered to building </td>
<td>W</td>
</tr>
<tr>
<td>P<sub>Local</sub></td>
<td>outdoor static air pressure at rotor height</td>
<td>Pa</td>
</tr>
<tr>
<td>P<sub>W</sub></td>
<td>wind turbine power produced</td>
<td>W</td>
</tr>
<tr>
<td>Q</td>
<td>overall torque</td>
<td>N.m</td>
</tr>
<tr>
<td>R</td>
<td>turbine radius</td>
<td>m</td>
</tr>
<tr>
<td>T<sub>Local</sub></td>
<td>local air temperature at rotor height</td>
<td>℃</td>
</tr>
<tr>
<td>v</td>
<td>ambient wind speed</td>
<td>m/s</td>
</tr>
<tr>
<td>v<sub>1</sub></td>
<td>upstream wind speed</td>
<td>m/s</td>
</tr>
<tr>
<td>v<sub>2</sub></td>
<td>wind speed on the turbine</td>
<td>m/s</td>
</tr>
<tr>
<td>v<sub>3</sub></td>
<td>downstream wake velocity</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>a</sub></td>
<td>induced velocity</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>AnnualAvg</sub></td>
<td>annual average wind speed from TMY weather data</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>Local</sub></td>
<td>local wind speed at the location of the system</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>LocalTMY</sub></td>
<td>annual average wind speed converted at the local station height</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>c</sub></td>
<td>chordal velocity component</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>n</sub></td>
<td>normal velocity component</td>
<td>m/s</td>
</tr>
<tr>
<td>V<sub>Z</sub></td>
<td>wind speed adjusted at rotor height</td>
<td>m/s</td>
</tr>
<tr>
<td>W</td>
<td>relative flow velocity</td>
<td>m/s</td>
</tr>
<tr>
<td>Z</td>
<td>height of wind turbine rotor</td>
<td>m</td>
</tr>
<tr>
<td>α</td>
<td>blade angle of attack</td>
<td>deg</td>
</tr>
<tr>
<td>θ</td>
<td>azimuth angle in VAWT and pitch angle in HAWT</td>
<td>deg</td>
</tr>
<tr>
<td>ρ<sub>Local</sub></td>
<td>local density of air at rotor height</td>
<td>kg/m3</td>
</tr>
<tr>
<td>ω</td>
<td>angular velocity of turbine</td>
<td>rad/s</td>
</tr>
<tr>
<td>ω<sub>Local</sub></td>
<td>local humidity ratio at rotor height</td>
<td>kg-H2O/kg-air</td>
</tr>
<tr>
<td>x</td>
<td>exponent, 1.5</td>
<td> </td>
</tr>
<tr>
<td>λ</td>
<td>tip speed ratio</td>
<td> </td>
</tr>
<tr>
<td>λ<sub>i</sub></td>
<td>tip speed ratio at the i<sup>th</sup> pitch</td>
<td> </td>
</tr>
<tr>
<td>δ<sub>met</sub></td>
<td>wind boundary layer thickness of meteorological station, 270</td>
<td>m</td>
</tr>
<tr>
<td>δ</td>
<td>site boundary layer thickness, 370</td>
<td>m</td>
</tr>
<tr>
<td>η</td>
<td>wind turbine system efficiency</td>
<td> </td>
</tr>

</table>

#### References

Siegfried Heier. 2006. Grid Integration of Wind Energy Conversion Systems, Second Edition. Wiley, Chap. 2, pp.31-44.

Mazharul Islam, David S.K. Ting and Amir Fartaj. 2008. Aerodynamic Models for Darrieus-type Sraight-bladed Vertical Axis Wind Turbines. Renewable & Sustainable Energy Reviews, Volume 12, pp.1087-1109.

ASHRAE. 2005. Handbook of Fundamentals, pp 16.3-16.4, Atlanta: ASHRAE.

Performance Curves and Lookup Tables
====================================

The following section describes the use of performance curves and lookup tables. Each of these objects may be used in any valid input field where a performance curve name is required.

Performance curves are used directly to simulate the performance of HVAC equipment. The curves are typically created by performing a regression analysis on tabular data for a particular equipment performance metric. The regression analysis determines the equation coefficients which are the primary input to all performance curve objects. Performance tables are similar to performance curves in that they are meant to replicate a particular performance curve. Input to performance tables are made up of data pairs, the same data pairs that would be used to create performance curve coefficients. Performance tables can be interpolated using up to a 4<sup>th</sup> order polynomial equation for one independent variable tables or using a 2<sup>nd</sup> order polynomial for two independent variable tables. A regression analysis can be performed on performance tables when the simulation is instructed to use the regression analysis during the simulation (i.e., ride the curve). In addition, a performance curve object is created that can be used in future simulations and can be written to the eio file. The performance curve is written to the eio file only when the diagnostics flag is set to DisplayAdvancedReportVariables (ref. Output:Diagnostics, DisplayAdvancedReportVariables;). Lookup tables are similar to performance tables in that tabular data is used for input, however, the input 1) is more compact, 2) a regression analysis may only be performed for one and two independent variable cases, and 3) the tabular data can be read from an external file.

Performance curves and data tables are created using empirical data that are derived from information gathered through observation, experience, or experimental means. Once a curve or table object is defined, these objects can be used to generically describe HVAC equipment performance. Performance curves and performance tables may be used interchangeably in Energyplus objects as required.

Performance Curves
------------------

Performance curves define a polynomial equation which represents a conditional response to a model input. A polynomial is a mathematical expression which uses a sum of powers in one or more variables. The equation below represents an n<sup>th</sup> order univariate polynomial. The highest power in the equation represents its order or degree (n).

<div>$$y = {a_0} + {a_1}x + {a_2}{x^2} + {a_3}{x^3} + ... + {a_n}{x^n}$$</div>

A polynomial in two independent variables (multi-variate) is given by:

<div>$$z = {a_{00}} + {a_{10}}x + {a_{01}}y + {a_{11}}xy + {a_{21}}{x^2}y + {a_{12}}x{y^2} + {a_{22}}{x^2}{y^2}... + {a_{nm}}{x^n}{y^m}$$</div>

In Energyplus, the result of an equation, the dependent variable, represents the response a system or component has given an input (the independent variable) to the system or component model. This response represents the equipment performance related to the mechanism that causes this change (e.g., the change in capacity or power based on a conditional change in temperature, part-load ratio, or other phenomenon). A variety of performance curves are available to describe the most common forms of engineering equations. The coefficients (a-z) in the following equations are entered in the associated curve object to define a specific phenomenon. Minimum and maximum limits may be applied to both the independent and the dependent variables as necessary.

### Curves based on a single independent variable

A polynomial having only a single independent variable represents a one-dimensional relationship between a condition (the model input) and response (the model output). The previously described n<sup>th</sup> order univariate polynomial is representative of the following performance curves.

#### Linear Curves

A performance curve having an order or degree of 1.

<div>$$y = a + bx$$</div>

#### Quadratic Curves

A performance curve having an order or degree of 2.

<div>$$y = a + bx + c{x^2}$$</div>

#### Cubic Curves

A performance curve having an order or degree of 3.

<div>$$y = a + bx + c{x^2} + d{x^3}$$</div>

#### Quartic Curves

A performance curve having an order or degree of 4.

<div>$$y = a + bx + c{x^2} + d{x^3} + e{x^4}$$</div>

#### Exponent Curves

A performance curve having an order or degree of c.

<div>$$y = a + b{x^c}$$</div>

### Curves based on two independent variables

A polynomial having two independent variables represents a two-dimensional relationship between a condition (the model inputs) and response (the model output). The previously described n<sup>th</sup> order multi-variate polynomial is representative of the following performance curves.

#### QuadraticLinear Curves

A performance curve having an order or degree of 2 in two independent variables.

<div>$$z = a + bx + c{x^2} + dy + exy + f{x^2}y$$</div>

#### CubicLinear Curves

A performance curve having an order or degree of 3 in two independent variables.

<div>$$z = a + bx + c{x^2} + d{x^3} + ey + fxy$$</div>

#### BiQuadratic Curves

A performance curve having an order or degree of 2 in two independent variables.

<div>$$z = a + bx + c{x^2} + dy + e{y^2} + fxy$$</div>

#### BiCubic Curves

A performance curve having an order or degree of 3 in two independent variables.

<div>$$z = a + bx + c{x^2} + dy + e{y^2} + fxy + g{x^3} + h{y^3} + i{x^2}y$$</div>

Calulating performance curve coefficients in a spreadsheet is a simple matter of finding the data required to perform the regression analysis. For example, the biquadratic equation shown above is representative of the cooling capacity as a function of temperature performance curve for DX cooling coils. The fundamental equation for DX cooling coil capacity is:

<div>$$TotCapTempModFac = a + b\left( {{T_{wb,i}}} \right) + c{\left( {{T_{wb,i}}} \right)^2} + d\left( {{T_{c,i}}} \right) + e{\left( {{T_{c,i}}} \right)^2} + f\left( {{T_{wb,i}}} \right)\left( {{T_{c,i}}} \right)$$</div>

where

Twb,i = wet-bulb temperature of the air entering the cooling coil, °C

Tc,i (or Tdb,i)= dry-bulb temperature of the air entering an air-cooled condenser, °C

Given the data set shown in the table below, each of the independent variables would be calculated according to the fundamental equation above (i.e., the T, T<sup>2</sup>, and cross-product terms would be multiplied out). The data would be converted to degrees celcius and the cooling capacity would be converted to Watts. The data would also be normalized using the ARI rating point shown as highlighted in the table.

![DataTable](EngineeringReference/media/image7865.png)

The fundamental equation would be used to determine the number of independent variables and also the form of the equation. Given the example described here, the spreadsheet would be set up to look like the equation as shown in the following table. A regression analysis could then be performed on the data set. The first five columns are the independent variables and the last column is the dependent variable. A spreadsheet tool is selected to perform the regression analysis, and the coefficients are calculated and displayed in the spreadsheet.

![RegressionAnalysis](EngineeringReference/media/image7866.png)



The regression analysis and summary statistical output is shown below. The equation coefficients are shown highlighted. In this example, the equation coefficents are: a = 0.757382, b = 0.014666, c= 0.000459, d = -0.00095, e = -6.7E-05, and f = -0.00015. These coefficients would be entered in a Curve:BiQuadratic object and used to describe the cooling capacity as a function of temperature for the DX cooling coil model. Minimum and Maximum values from the tabular data are entered as Min/Max values for the curve object. The values may be relaxed slightly with care to allow extrapolation as needed. A performance table may be used to automatically perform the regression analysis as described in the following section.



![RegressionSummaryOutput](EngineeringReference/media/image7867.png)



```idf
  Curve:Biquadratic,
    CoolCapFTExample,        !- Name
    0.757382,                !- Coefficient1 Constant
    0.014666,                !- Coefficient2 x
    0.000459,                !- Coefficient3 x**2
    -0.00095,                !- Coefficient4 y
    -0.000067,               !- Coefficient5 y**2
    -0.00015,                !- Coefficient6 x*y
    17.22222,                !- Minimum Value of x
    21.66667,                !- Maximum Value of x
    18.33333,                !- Minimum Value of y
    46.11111,                !- Maximum Value of y
    ,                        !- Minimum Curve Output
    ,                        !- Maximum Curve Output
    Temperature,             !- Input Unit Type for X
    Temperature,             !- Input Unit Type for Y
    Dimensionless;           !- Output Unit Type
```




### Curves based on three independent variables

A polynomial having three independent variables represents a three-dimensional relationship between a condition (the model inputs) and response (the model output).

#### TriQuadratic Curves

A performance curve having an order or degree of 2 in three independent variables.

<div>$$\begin{array}{l}Output = a + b{x^2} + cx + d{y^2} + ey + f{z^2} + gz + h{x^2}{y^2} + ixy + jx{y^2} + k{x^2}y\\\,\,\,\, + l{x^2}{z^2} + mxz + nx{z^2} + o{x^2}z + p{y^2}{z^2} + qyz + ry{z^2} + s{y^2}z + t{x^2}{y^2}{z^2}\\\,\,\,\, + u{x^2}{y^2}z + u{x^2}y{z^2} + vx{y^2}{z^2} + w{x^2}yz + x\left( {x{y^2}x} \right) + y\left( {xy{z^2}} \right) + z\left( {xyz} \right)\end{array}$$</div>

### Pressure drop curve

#### Functional Pressure Drop Curve

A performance curve representing the minor loss and/or friction calculations in plant pressure simulations.

<div>$$\Delta P = \left[ {K + f\left( {L/D} \right)} \right]\left( {\rho {V^2}} \right)/2$$</div>

Performance Tables
------------------

Performance tables provide a method to enter specific performance data in tabular form. Tabular data represent equipment performance in a manner similar to performance curves, however, the necessity to formulate the equation coefficient is not required. Tabular data may be used to directly interpolate the actual data within the tables independent variable limits or a regression analysis may be performed to calculate the equation coefficients and use these coefficients for the associated engineering calculations. When direct interpolation is selected, the tabular data is interpolated linearly between the first independent variable and then, if used, the second independent variable. The name of a table object may be used interchangeably in any valid field where a performance curve name is required.

### Tables based on a single independent variable

The tabular data entered for polynomials with a single independent variable represent x and outupt data pairs as described in the previous section for performance curves.  The x in each of the previous equations represent the independent variable (model input) and the output represents the dependent variable. The data pairs are organized as the data point for the independent variable followed by the data point for the dependent variable. The data pairs form a one-dimensional array that may either be linearly interpolated, interpolated based on a polynomial equation, or this data may be used to calculate the equation coefficients (a-e) as described in the previous section.

The equation form is user selected as either linear, quadratic, cubic, quartic, or exponent. This choice determines: 1) where this table object may be used (i.e., certain objects may required a specific form of the equation), and 2) the degree or order used to calculate the regression coefficients. The following example describes the methodology used when tabular input data is used in place of common performance curve objects. Although Energyplus does not use a performance curve in the manner described in this example, this example is ideally suited for teaching the basics of tabular data entry.

Given a generic manufacturers fan data for a fan having a maximum flow rate of 5 m3/s and power of 125 W, the power is shown in the table below to be proportional to the cube of flow rate. Since, in this example, the flow rate is not a valid input for calculating fan power, the flow rate will be converted to flow fraction (or PLR). The power data is entered as the actual fan power and will be normalized by the program according to the maximum power of 125W. Also shown here are the performance curve outputs using the regression coefficients calculated by the program. The performance curve outputs represent the fan power ratio as a function of flow fraction. Additional significant digits are included to show the impact a given data set may have on the resulting coefficients (i.e., not quite 0 at the zero crossing, rounding causes slight errors in the actual coefficient values, etc).



<table class="table table-striped">
<tr>
<th>Air Flow (m3/s)</th>
<th>Flow Fraction  or Fan PLR</th>
<th>Power (W)</th>
<th>Power Ratio Curve Output</th>
</tr>
<tr>
<td>0</td>
<td>0</td>
<td>0</td>
<td>-1.1102230246E-16</td>
</tr>
<tr>
<td>0.5</td>
<td>0.1</td>
<td>0.125</td>
<td>0.00100000000000018</td>
</tr>
<tr>
<td>1</td>
<td>0.2</td>
<td>1</td>
<td>0.00800000000000004</td>
</tr>
<tr>
<td>3</td>
<td>0.6</td>
<td>27</td>
<td>0.215999999999995</td>
</tr>
<tr>
<td>4</td>
<td>0.8</td>
<td>64</td>
<td>0.51199999999999</td>
</tr>
</table>



The tabular data can be entered directly into a table object. The data for flow fraction (or fan part-load ratio) and power are entered as data pairs. As this example describes how the fan power changes with changes in air flow, the curve type selected is Cubic and, therefore, the minimum number of data pairs equals 4 (i.e., number of coefficients in a cubic equation) although 5 are used in this example. In addition, since calculating regression coefficients for this data set would yield more accurate results than linearly interpolating this data set, the selection is made to evaluate the curve to the limits specified. In this example, the fan in question is capable of operating up to 5 m3/s at 125 Watts (which is purposely not provided in this set of tabular data). We need this information because we want to create a fan power ratio equation with an input of 0-1 for fan part-load ratio and a table output of 0-1 for fan power ratio. Therefore, the tabular data need to be normalized at a part-load ratio of 1 (i.e., normalized to the power at full flow). The following table object describes the input necessary for this particular data set.



```idf
Table:OneIndependentVariable,
MyFanPower,   !- Name  [Fit from catalog performance data]
Cubic,     !- Curve Type
EvaluateCurveToLimits,  !- Interpolation Type
0,         !- Minimum Value of X1,
1,         !- Maximum Value of X1,
0,         !- Minimum Table Output
64,        !- Maximum Table Output
Dimensionless,  !- Input Unit Type for X1
Dimensionless,  !- Output Unit Type
125,       !- Normalization Point
0.8,64,    !- X Value #1, Output Value #1
0,0.0,     !- X Value #2, Output Value #2
0.2,1,     !- X Value #3, Output Value #3
0.1,0.125, !- X Value #4, Output Value #4
0.6,27;    !- X Value #5, Output Value #5
```



Notice in this example that:

1)    The data pairs do not need to be entered in ascending order, this data set will automatically be re-ordered in ascending order by the program.

2)    The minimum and maximum table output entered by the user uses the same units as the output values and are subsequently normalized in the same manner as the dependent variable in the data pairs.

3)    For the resulting curve object (see below), the minimum (maximum) limits are based on the lesser (greater) of the user entered value and the lower (upper) limit of the tabular data. When linearly interpolating tabular data, the limits of the data set are used unless the user entered maximum is more restrictive (e.g., 64 W in this example is not more restrictive than the data set).

4)    For the resulting curve object, the calculated coefficients may not perfectly represent the data set (i.e., in this example coefficient 1, 2, and 3 should have been 0). Duplicating the 0,0 data pair four additional times (to weight the 0 crossing) yields constant coefficients of 0. This could also be changed manually in the curve object created by the program.

5)    Referring to the figure below, a selection of LinearInterpolationOfTable would interpolate the tabular data within the limits of the data set (blue circles) resulting in a maximum X and Curve value of 0.8 and 0.512 (i.e., 64/125), respectively. Selecting EvaluateCurveToLimits allows extrapolation of the data set up to a power ratio of 1 had 125 W been entered as the maximum table output in this example.

6)    In the graph below, the linearly interpolated tabular data (blue line) represent a less accurate fan power ratio curve than the performance curve itself (red line). In this specific example, it is more accurate to rely on the performance curve results (i.e., Interpolation Type = EvaluateCurveToLimits in table object). In addition, the performance curve is able to extrapolate outside the limits of the data set since the regression analysis provides a smooth continuous curve through 1. Selecting the LagrangeInterpolationLinearExtrapolation interpolation method with a cubic curve type is similar to the performance curve results.

7)    Including additional data in the table object (e.g., data points for flow fractions = 0.4 and 1) would allow direct linear interpolation of the tabular data without significant loss of accuracy compared to the performance curve or lagrange methods.



Curve output in eio file (when using Output:Diagnostics, DisplayAdvancedReportVariables):

```
!...GENERATING NEW CURVE OBJECT
! Input as Table:OneIndependentVariable "MYFANPOWER"
! RSquared = 1.0000000000
! Standard Error = 7.3549798168E-016
! Degrees of Freedom = 5
Curve:Cubic,
 MYFANPOWER,         !- Name
 -1.1102230246E-016, !- Coefficient1 Constant
 5.0571599639E-015,  !- Coefficient2 x
 -2.1582431250E-014, !- Coefficient3 x**2
 1.0000000000,       !- Coefficient3 x**3
 0.0000000000,       !- Minimum Value of x
 1.0000000000,       !- Maximum Value of x
 0.0000000000,       !- Minimum Curve Output
 1.0000000000;       !- Maximum Curve Output
!...END GENERATING NEW CURVE OBJECT
```

![FanPowerRatioExample](EngineeringReference/media/image7870.png)

### Tables based on two independent variables

The tabular data entered for polynomials with two independent variables represent x, y and output data pairs as described in the previous section for performance curves.  The x and y in each of the previous equations represent the independent variables (model inputs) and the output represents the dependent variable. The data pairs are organized as the data points for the independent variables followed by the data point for the dependent variable. The order of the data is significant in that the x and y data are entered in the same order as shown in the model’s fundamental equation. The data pairs form a two-dimensional array that may either be linearly interpolated, interpolated using a second order polynomial, or this data may be used to calculate the equation coefficients (a-f) as described in the previous section.

The equation order or degree is user selected as biquadratic or quadraticlinear. This choice determines: 1) where this table object may be used (i.e., certain objects may required a specific form of the equation), and 2) the fundamental equation used to calculate the regression coefficients. The following example describes the methodology used when tabular input data is used in place of common performance curve objects.

Given a generic manufacturers air conditioner data for an AC system having a rated total cooling capacity of 7735.1 W, the change in capacity is shown in the table to be a function of both cooling coil entering air wet-bulb temperature and condenser entering air dry-bulb temperature. The tabular data is entered as the actual cooling capacity and will be normalized by the program according to the rated capacity of 7735.1 W. The cooling coil EIR curve could be developed in a similar fashion, except that EIR (Power / TotCap) must first be calculated from the tabular data below BEFORE entering this data into a table object. In this example, only data highlighted in yellow will be used.

![NormalizedCapacity](EngineeringReference/media/image7871.png)

The tabular data can be entered directly into a table object. As an example, for an air-cooled DX cooling coil object in Energyplus, the capacity as a function of temperature has the following fundamental equation (Ref. Single-Speed Electric DX Air Cooling Coil):

<div>$$TotCapTempModFac = a + b\left( {{T_{wb,i}}} \right) + c{\left( {{T_{wb,i}}} \right)^2} + d\left( {{T_{c,i}}} \right) + e{\left( {{T_{c,i}}} \right)^2} + f\left( {{T_{wb,i}}} \right)\left( {{T_{c,i}}} \right)$$</div>

where

Twb,i = wet-bulb temperature of the air entering the cooling coil, °C

Tc,i = dry-bulb temperature of the air entering an air-cooled condenser, °C

Given this form of the fundamental equation, the data pairs for the cooling coil are entered as entering air wet-bulb temperature, condenser entering dry-bulb temperature, and total cooling capacity. These 3 values, in this precise order, make up each data pair. As this example describes how the DX coil cooling capacity changes with changes in indoor and outdoor temperature, the curve type selected is BiQuadratic and, therefore, the minimum number of data pairs equals 6 (i.e., number of coefficients in the equation above). Evaluating this tabular data based on regression coefficients may be less desirable to the user since the data in the lower right corner of the table is somewhat flat due to controls or other hardware constraints. For the sake of this example, the regression analysis is chosen. In this example, the DX cooling coil total cooling capacity at the ARI rating point is used to normalize the capacity data (e.g., 7735.1 W at 19.4 °C EWB and 35 °C outdoor dry-bulb temperature). In addition, the minimum and maximum limits are chosen such that extrapolation of the performance curve is allowed. Notice in the example below that:

1)    The data pairs do not need to be entered in ascending order, this data set will automatically be re-ordered in ascending order by the program.

2)    As shown in the table object below, only three of the five entries for entering air wet-bulb temperature were entered in the table object and therefore used for the regression analysis. This data entry technique may save time when entering a large data set, however, it may have unforeseen consequences on the resulting regression coefficients (i.e., the coefficients may provide less accuracy than desired). Note in the figure below the difference between the manufacturers data at 19.4 °C entering air wet-bulb temperature vs the prediction made by the regression coefficients. Since this data set (i.e., the 4 data points at 19.4°C entering air wet-bulb temperature from the table above) was left out of the regression analysis, the predicted capacity at this condition is slightly under-estimated.

3)    The minimum and maximum table output entered by the user uses the same units as the output values and are subsequently normalized in the same manner as the dependent variable in the data pairs.

4)    For the resulting curve object, the minimum (maximum) limits are based on the lesser (greater) of the user entered value and the lower (upper) limit of the tabular data. When linearly interpolating tabular data, only the limits of the data set are used.

5)    For the resulting curve object, the calculated coefficients may not perfectly represent the entire data set since all data was not used (i.e., in this example the regressed data do not line up exactly with all the manufacturers data, however, do line up well with the data included in the table object).

6)    Selecting LinearInterpolationOfTable would interpolate the tabular data within the limits of the data set (characters) resulting in a maximum X1, X2 and Curve value of 22.2, 40.8 and 1.25 (i.e., 9206.0/7375.1), respectively. Note how these maximum values compare to the maximum values in the generated curve object below which chose the EvaluateCurveToLimits option instead (i.e., the user min/max inputs were used to generate these fields when creating the curve object). The minimum values would be affected in a similar manner. Selecting Lagrange or EvaluateCurveToLimits allows extrapolation of the data set to values specified by the user.

7)    In the graph below, the linearly interpolated tabular data (character data set representing manufacturers data) may better represent the capacity ratio than the performance curve (lines representing the regressed data) given the non-linear relationship between capacity and temperature shown in the table and/or graph. However, extrapolation of the data set is performed linearly and the second order affects of temperature would be lost when extrapolating. Either the data set would be expanded to include other relevant data (e.g., data at colder outdoor temperatures where cooling may be required) which could then be interpolated or additional existing data could be added to the table object to allow more accurate regression coefficients to be used to predict data outside the table data limits.



```idf
Table:TwoIndependentVariables,
CCoolCapFT,       !- Name  [Fit from catalog performance data]
BiQuadratic,      !- Curve Type
EvaluateCurveToLimits,  !- Interpolation Type
1,                !- Minimum Value of x,
30,               !- Maximum Value of x,
5,                !- Minimum Value of y,
50,               !- Maximum Value of y,
4500,             !- Minimum Table Output
15000,            !- Maximum Table Output
Temperature,      !- Input Unit Type for x
Temperature,      !- Input Unit Type for y
Dimensionless,    !- Output Unit Type
7735.1,           !- Normalization Point
17.2,29.4,7462.6, !- X, Y, and Output data pair #1
17.2,23.9,7735.1, !- X, Y, and Output data pair #2
13.9,29.4,7283.9, !- X, Y, and Output data pair #3
13.9,23.9,7474.4, !- X, Y, and Output data pair #4
13.9,35,7067.1,   !- X, Y, and Output data pair #5
13.9,40.8,6818.0, !- X, Y, and Output data pair #6
17.2,35,7157.9,   !- X, Y, and Output data pair #7
17.2,40.8,6818.0, !- X, Y, and Output data pair #8
22.2,35,8552.6,   !- X, Y, and Output data pair #9
22.2,29.4,8898.3, !- X, Y, and Output data pair #10
22.2,23.9,9206.0, !- X, Y, and Output data pair #11
22.2,40.8,8165.8; !- X, Y, and Output data pair #12
```

Curve output in eio file (when using Output:Diagnostics, DisplayAdvancedReportVariables):

```
CREATING NEW CURVE OBJECT
! Input as Table:TwoIndependentVariables "CCOOLCAPFT"
! RSquared       = 0.9993993101
! Standard Error = 3.4649248573E-003
! Sample Size    = 12
Curve:BiQuadratic,
FromTable_CCOOLCAPFT,  !- Name
  1.7214120578,  !- Coefficient1 Constant
  -0.1011737262,  !- Coefficient2 x
  3.7738833967E-003,  !- Coefficient3 x**2
  2.8686934910E-003,  !- Coefficient4 y
  -5.3785351258E-005,  !- Coefficient5 y**2
  -3.4086036156E-004,  !- Coefficient6 x*y
  1.0000000000,  !- Minimum Value of x
  30.0000000000,  !- Maximum Value of x
   5.0000000000,  !- Minimum Value of y
  50.0000000000,  !- Maximum Value of y
  0.5817636488,  !- Minimum Curve Output
  1.9392121627;  !- Maximum Curve Output
END CREATING NEW CURVE OBJECT
```

![NormalizedCapacity](EngineeringReference/media/image7873.png)

### Lookup Tables

Lookup tables provide a method to evaluate a group of data that may or may not conform to a fundamental equation. Only tabular data which conform to existing performance curve equations are currently allowed (i.e., that lookup table name is entered where any valid performance curve is allowed therefore the table data must conform to the models fundamental equation for that specific curve). Efforts to include this lookup table in the energy management system would allow custom use of lookup tables, however, calling lookup tables from the EMS system is not currenly possible. Lookup tables can interpolate the actual data using a non-linear polynomial equation (order higher than 1). As with other table or curve objects, the lookup table can be used anywhere a valid curve object name is allowed. Care must be taken to ensure the table data format is consistent with the associate model that is using the performance curve (e.g., DX cooling coil capacity as a function of temperature where independent variable X1 = indoor wet-bulb temperature and independent variable X2 = outdoor dry-bulb temperature).

The lookup tables are evaluated using the Lagrange form of the interpolation polynomial or the previously described interpolation methods of LinearInterpolationOfTable and EvaluateCurveToLimits. When using the Lagrange method, the number of points used in the interpolation is equal to 1 plus the polynomial order (e.g., a second order interpolation would use 3 points).

<div>$${p_n}\left( x \right) = \sum\limits_{i = 0}^n {{y_i}{l_i}\left( x \right)} $$</div>

<div>$${l_i}\left( x \right) = \mathop \Pi \limits_{j \ne i} \left( {\frac{{x - {x_j}}}{{{x_i} - {x_j}}}} \right)\,\,\,\,\,\,i = 0,1,...,n$$</div>

First-order Lagrange interpolation polynomial:

<div>$${p_1}\left( x \right) = \frac{{\left( {x - {x_1}} \right)}}{{\left( {{x_0} - {x_1}} \right)}}{y_0} + \frac{{\left( {x - {x_0}} \right)}}{{\left( {{x_1} - {x_0}} \right)}}{y_1}$$</div>

Second-order Lagrange interpolation polynomial:

<div>$${p_2}\left( x \right) = \frac{{\left( {x - {x_1}} \right)\left( {x - {x_2}} \right)}}{{\left( {{x_0} - {x_1}} \right)\left( {{x_0} - {x_2}} \right)}}{y_0} + \frac{{\left( {x - {x_0}} \right)\left( {x - {x_2}} \right)}}{{\left( {{x_1} - {x_0}} \right)\left( {{x_1} - {x_2}} \right)}}{y_1} + \frac{{\left( {x - {x_0}} \right)\left( {x - {x_1}} \right)}}{{\left( {{x_2} - {x_0}} \right)\left( {{x_2} - {x_1}} \right)}}{y_2}$$</div>

Third-order Lagrange interpolation polynomial:

<div>$$\begin{array}{l}{p_3}\left( x \right) = \frac{{\left( {x - {x_1}} \right)\left( {x - {x_2}} \right)\left( {x - {x_3}} \right)}}{{\left( {{x_0} - {x_1}} \right)\left( {{x_0} - {x_2}} \right)\left( {{x_0} - {x_3}} \right)}}{y_0} + \frac{{\left( {x - {x_0}} \right)\left( {x - {x_2}} \right)\left( {x - {x_3}} \right)}}{{\left( {{x_1} - {x_0}} \right)\left( {{x_1} - {x_2}} \right)\left( {{x_1} - {x_3}} \right)}}{y_1} + \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\frac{{\left( {x - {x_0}} \right)\left( {x - {x_1}} \right)\left( {x - {x_3}} \right)}}{{\left( {{x_2} - {x_0}} \right)\left( {{x_2} - {x_1}} \right)\left( {{x_2} - {x_3}} \right)}}{y_2} + \frac{{\left( {x - {x_0}} \right)\left( {x - {x_1}} \right)\left( {x - {x_2}} \right)}}{{\left( {{x_2} - {x_0}} \right)\left( {{x_2} - {x_1}} \right)\left( {{x_2} - {x_2}} \right)}}{y_3}\end{array}$$</div>

where:

x = interpolation point

x<sub>n</sub> = x value of tabular data

y<sub>n</sub> = y value of tabular data

p<sub>i</sub>(n) = polynomial (table) output

The lookup table is interpolated using the interpolation polynomial shown above. If the table input value (interpolation point) is near the bottom edge or exceeds the table boundaries, a linear extrapolation is used (2-point extrapolation). The interpolation order is determined by the user entered number of interpolation points.

A regression analysis may be performed on any lookup table having one or two indpenedent variables. As with performance tables, the resulting performance curve coefficients are calculated and used in the simulation only when the interpolation method is selected as EvaluateCurveToLimits. In addition, the performance curve is only written to the eio file when the output diagnostics flag is set to DisplayAdvancedReportVariables (ref. Output:Diagnostics, DisplayAdvancedReportVariables;)..

Using the example provided in the section above for Tables based on two indpendent variables, the lookup table object would be defined as follows:

```idf
Table:MultiVariableLookup,
CCoolCapFT,
EvaluateCurveToLimits,
3,
BiQuadratic,
SingleLineIndependentVariableWithMatrix,
,
ASCENDING,
ASCENDING,
7735.1,  !- Normalization reference
1,       !- Minimum Value of X1
30,      !- Maximum Value of X1
5,       !- Minimum Value of X2
50,      !- Maximum Value of X2
,        !- Minimum Value of X3
,        !- Maximum Value of X3
,        !- Minimum Value of X4
,        !- Maximum Value of X4
,        !- Minimum Value of X5
,        !- Maximum Value of X5
4500,    !- Minimum Table Output
15000,   !- Maximum Table Output
Temperature,  !- Input Unit Type for X1
Temperature,  !- Input Unit Type for X2
,        !- Input Unit Type for X3
,        !- Input Unit Type for X4
,        !- Input Unit Type for X5
Dimensionless,    !- Output Unit Type
   2, 3, 4,
  13.9, 17.2, 22.2,
  23.9, 29.4, 35.0, 40.8,
  7474.4,  7735.1,  9206.0,
  7283.9,  7462.6,  8898.3,
  7067.1,  7157.9,  8552.6,
  6818.0,  6818.0,  8165.8;
```




Economics Calculations
======================

Component Costs
---------------

EnergyPlus provides simple cost estimating capabilities as an aid to design analysis and for life cycle costs.  There are three broad steps involved.  The first involves determining *construction* costs by summing individual “line items.”  The second involves determining *project* costs by adjusting construction costs to account for things like profit and design fees.  The third involves comparing the current simulation to a reference case so that marginal increases can be calculated.  The reference documentation contained in this section pertains to the following input object names.

* **ComponentCost:LineItem**

* **ComponentCost:Adjustments**

* **ComponentCost:Reference**

### Line Item Costs

Line item cost calculations are generally trivial involving simple multiplication and summation.  This section documents details of how line item costs are calculated.  The program code consists mainly of a **Case** construct where the **Line Item Type** is used to control the details of how calculations are performed.

The overall philosophy is to provide methods of calculating items using either direct entry of needed data (**‘General’** using object type), or using component descriptive data entered elsewhere in the input file (e.g. **‘Lights’**), or by using quantities that are calculated by the program during the simulation (e.g. **‘Coil:DX’** and **‘Chiller:Electric’**). 

The rest of this section provides details by organized by the type of line item.

#### General

The line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-Each, *P<sub>e</sub>*:

<div>$$L = N * {P_e}$$</div>

#### Construction

This line item type is called “Construction” but is used to estimate the costs of surfaces in the model.  The Construction attribute of Surface objects is useful for categorizing surfaces.  The number of units, *N*, is determined by summing the Area, *A*, of Surface objects that have the type of construction specified in the **Item Name** field.  Surfaces are screened to eliminate any duplicates that may exist for interior partitions creating a list of 1 to *m* unique surfaces.  If a surface is associated with a Zone, then zone multiplier, *M<sub>Z</sub>*, and list multipliers, *M<sub>G</sub>*, are applied (these are usually defaulted to 1).

<div>$$N = \sum\limits_1^m {(A*{M_Z} * {M_G}} )$$</div>

The line item subtotal, *L*, is calculated by multiplying the number of units (actually units of are here), *N* (m<sup>2</sup>) by the Cost-per-Area, *P<sub>a</sub>* , ($/m<sup>2</sup>):

<div>$$L = N * {P_a}$$</div>

#### Coil:DX and Coil:Cooling:DX:SingleSpeed

DX coil costs can be estimated in one of three ways: per-each, per-kW, per-kW-COP.  The program determines which method to use based on there being non-zero values in appropriate input fields.

If **cost per each** is greater than 0.0 then the number of units, *N*, is the number of cooling coils.  This will be 1 if the **Item Name** is the name of a specific coil described elsewhere.  If the name is set to the wildcard (\*) then this will equal the total number of DX:Coils in the model.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-Each, *P<sub>e</sub>*:

<div>$$L = N * {P_e}$$</div>

If **cost per kilowatt** is greater than 0.0 then the number of units, *N*, is the number of kilowatts of total, rated, cooling capacity.  This will be based on all the DX:Coils in the model if **Item Name** is set to the wildcard (\*) and will be that of the named coil if set to a valid coil name.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt, *P<sub>kW</sub>*:

<div>$$L = N * {P_{kW}}$$</div>

If **Cost per kilowatt per coefficient-of-performance** is greater than 0.0 then the number of units, *N*, is the number of kilowatts of total, rated, cooling capacity multiplied by the nominal coefficient of performance (COP) of the DX:Coils.  This will be based on all the DX:Coils in the model if **Item Name** is set to the wildcard (\*) and will be that of the named coil if set to a valid coil name.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt-per-COP, *P<sub>kW-COP</sub>*:

<div>$$L = N * {P_{kW - COP}}$$</div>

#### Coil:Heating:Gas

Gas-fired heating coil costs can be estimated in one of three ways: per-each, per-kW, per-kW-COP.  The program determines which method to use based on there being non-zero values in appropriate input fields.

If **cost per each** is greater than 0.0 then the number of units, *N*, is the number of heaters.  This will be 1 if the **Item Name** is the name of a specific heater described elsewhere.  If the name is set to the wildcard (\*) then this will equal the total number of Coil:Heating:Gas objects in the model.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-Each, *P<sub>e</sub>*:

<div>$$L = N * {P_e}$$</div>

If **Cost per kilowatt** is greater than 0.0 then the number of units, *N*, is the number of kilowatts of total, rated, heating capacity.  This will be based on all the Coil:Heating:Gas objects in the model if **Item Name** is set to the wildcard (\*) and will be that of the named coil if set to a valid coil name.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt, *P<sub>kW</sub>*:

<div>$$L = N * {P_{kW}}$$</div>

If **Cost per kilowatt per coefficient-of-performance** is greater than 0.0 then the number of units, *N*, is the number of kilowatts of total, rated, heating capacity multiplied by the theoretical efficiency of the heater(s).  (Here we are treating gas heating efficiency as a Coefficient of Performance (COP)).  This will be based on all the Coil:Heating:Gas objects in the model if **Item Name** is set to the wildcard (\*) and will be that of the named coil if set to a valid coil name.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt-per-COP, *P<sub>kW-COP</sub>*:

<div>$$L = N * {P_{kW - COP}}$$</div>

#### Chiller:Electric

Electric chiller costs can be estimated in one of three ways: per-each, per-kW, per-kW-COP.  The program determines which method to use based on there being non-zero values in appropriate input fields.

If **cost per each** is greater than 0.0 then the number of units, *N*, is the number of chillers.  This will be 1 if the **Item Name** is the name of a specific coil described elsewhere.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-Each, *P<sub>e</sub>*:

<div>$$L = N * {P_e}$$</div>

If **Cost per kilowatt** is greater than 0.0 then the number of units, *N*, is the number of kilowatts of total, rated, cooling capacity for the specified chiller.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt, *P<sub>kW</sub>*:

<div>$$L = N * {P_{kW}}$$</div>

If **Cost per kilowatt per coefficient-of-performance** is greater than 0.0, then the number of units, *N*, is the number of kilowatts of total, rated, cooling capacity multiplied by the nominal coefficient of performance (COP) of the chiller.  This will be based on the named chiller (if set to a valid coil name).  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt-per-COP, *P<sub>kW-COP</sub>*:

<div>$$L = N * {P_{kW - COP}}$$</div>

#### Daylighting:Controls

The costs of controllers for harvesting daylight are determined by the number of reference points.  The cost for each controller, *P<sub>e</sub>* , are input.  The of units, *N*, is determined from the number of daylight reference points in all the zones if the **Item Name** is the wildcard (\*).  If **Item Name** is set to a valid Zone name then N is the number of daylight reference points in just that zone (zones can have more than one daylight controllers).  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-Each, *P<sub>e</sub>*:

<div>$$L = N * {P_e}$$</div>

#### Shading:Zone:Detailed

Shading surfaces need to be handled separately because they do not have the **Construction** attribute.  The **Item Name** must be set to a valid name for a **Shading:Zone:Detailed** object defined elsewhere in the file.  The number of units, N, is determined from the area of the named surface multiplied by zone multiplier, *M<sub>Z</sub>*, and list multipliers, *M<sub>G</sub>*:

<div>$$N = A*{M_Z} * {M_g}$$</div>

The line item subtotal, *L*, is calculated by multiplying the number of units, *N* (m<sup>2</sup>) by the Cost-per-Area, *P<sub>a</sub>* , ($/m<sup>2</sup>):

<div>$$L = N * {P_a}$$</div>

#### Lights

The cost of electric lighting systems can be modeled in two ways: per-each and per-kW.  The program determines which method to use based on there being non-zero values in appropriate input fields.  The **Item Name** must be the name of a valid Zone defined elsewhere in the input.

If **cost per each** is greater than 0.0, then the number of units, *N*, is the number lighting systems in the zone and is assumed to be 1.  Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-Each, *P<sub>e</sub>*:

<div>$$L = N * {P_e}$$</div>

If **Cost per kilowatt** is greater than 0.0 then the number of units, *N*, is the number of kilowatts in the design level for electric lighting systems defined in Lights objects associated with the zone.  The **Item Name** must be the name of a valid Zone defined elsewhere in the input.  *N* is then the sum of all the Lights associated with the named Zone. Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt, *P<sub>kW</sub>*:

<div>$$L = N * {P_{kW}}$$</div>

#### Generator:Photovoltaic

The costs of simple photovoltaic power systems can be modeled using cost per kilowatt.  The number of units, N, is the nominal rated peak power of the photovoltaic panels.  The photovoltaic generator must be modeled using the PhotovoltaicPerformance:Simple input object which is a very simplistic model and does not include input for the nominal rated peak power of the system.  Therefore a peak power is calculated using the usual 1000 W/m<sup>2</sup> of incident solar radiation, *G<sub>p</sub>*, multiplied by the active solar cell area, *A* and the efficiency, *E*, and converted to units of kilowatts.

<div>$$N = \frac{{{G_p} * A * E}}{{1000.0}}$$</div>

Where, the cell area A is calculated by multiplying the area of the surface associated with the simple photovoltaic system and the active area fraction defined in the PhotovoltaicPerformance:Simple. Then the line item subtotal, *L*, is calculated by multiplying the number of units, *N*, by the Cost-per-kilowatt, *P<sub>kW</sub>*:

<div>$$L = N * {P_{kW}}$$</div>

### Adjustments

Various adjustments are available to model total project costs from the component costs modeled using individual line items.  These adjustments are provided to allow propagating how changes in component costs are amplified by things like design fees, profit, bonding, and taxes.

The subtotal of individual line items, *S<sub>L</sub>*, is obtained by summing all line item subtotals, *L*:

<div>$${S_L} = \sum L $$</div>

For the reference building, *S<sub>L,</sub>*is user input (typically from a prior run of baseline building model).

The subtotal for miscellaneous construction costs (typically those costs not explicitly included as line items), *S<sub>m</sub>*, are calculated by multiplying the **Miscellaneous Cost Model** (per Square Meter), *C<sub>m</sub>*,  by the total conditioned floor area, *A<sub>c</sub>*:

<div>$${S_m} = {A_c} * {C_m}$$</div>

The subtotal for the amount that the construction costs should be altered because of regional differences in material and labor costs (e.g. when using national average data), *S<sub>r</sub>*, is determined by multiplying the Regional Adjustment Factor, *R<sub>f\\ ,</sub>* by the sum of *S<sub>L </sub>* and *S<sub>m:</sub>*

<div>$${S_r} = ({S_L} + {S_m}){R_f}$$</div>

Remaining adjustments are applied to the subtotal for construction costs, *S<sub>c</sub>*, which is the sum of *S<sub>L</sub>*, *S<sub>m,</sub>*, and *S<sub>r:</sub>*

<div>$${S_C} = {S_L} + {S_m} + {S_r}$$</div>

The **Design and Engineering Fee Fraction**,*F<sub>d</sub>*,is the fraction of construction costs, *S<sub>c</sub>*, attributable to costs associated with architectural and engineering services needed for the project.  The subtotal for costs associated with these fees, *S<sub>D</sub>*, are determined by multiplying *S<sub>C</sub>* by *F<sub>d</sub>*:

<div>$${S_D} = {S_c}*{F_D}$$</div>

The **Contractor Fee Fraction**,*F<sub>c</sub>*,is the fraction of construction costs, *S<sub>c</sub>*, attributable to costs associated with the contractor’s profit that should be included in the project.  The subtotal for costs associated with contracting, *S<sub>P</sub>*, are determined by multiplying *S<sub>C</sub>* by *F<sub>d</sub>*:

<div>$${S_P} = {S_c}*{F_C}$$</div>

The **Contingency Fraction**,*F<sub>S</sub>*,is the fraction of construction costs, *S<sub>c</sub>*, which should be included in a cost estimate to provide for contingencies (perhaps related to errors and uncertainty in the estimate and project).  The subtotal for contingency costs, *S<sub>S</sub>*, are determined by multiplying *S<sub>C</sub>* by *F<sub>S</sub>*:

<div>$${S_S} = {S_c}*{F_S}$$</div>

The **Permits, Bonding, Insurance Fraction,***F<sub>B</sub>*,is the fraction of construction costs, *S<sub>c</sub>*, which should be included in a cost estimate to provide for things like taxes, bonding, insurance, and permits.  The subtotal for these extra costs, *S<sub>B</sub>*, are determined by multiplying *S<sub>C</sub>* by *F<sub>B</sub>*:

<div>$${S_B} = {S_c}*{F_B}$$</div>

The **Commissioning Fee Fraction,***F<sub>CX</sub>*,is the fraction of construction costs, *S<sub>c</sub>*, which should be included in a cost estimate to provide for commissioning the building systems.  The subtotal for these extra costs, *S<sub>CX</sub>*, are determined by multiplying *S<sub>C</sub>* by *F<sub>CX</sub>*:

<div>$${S_{CX}} = {S_c}*{F_{CX}}$$</div>

Finally, the cost estimate total, *T*, is obtained by summing the various subtotals:

<div>$$T = {S_L} + {S_m} + {S_r} + {S_D} + {S_P} + {S_S} + {S_B} + {S_{CX}}$$</div>

The normalized total cost estimate, C, is calculated by dividing *T* by the total conditioned floor area, *A<sub>c</sub>*:

<div>$$C = \frac{T}{{{A_C}}}$$</div>

### Comparisons

The capability of comparing the current cost estimate to that of a reference building is provided because is common to consider the marginal increases in costs associated with applying different energy design measures.  EnergyPlus calculates and reports the difference between the current model and a reference case for all the subtotals and totals discussed above.  The reported differences are the reference values subtracted from the current value.

Tariff Computation
------------------

The EnergyPlus economic (Utility Costs) objects related to computing utility bills include:

* UtilityCost:Tariff

* UtilityCost:Qualify

* UtilityCost:Charge:Simple

* UtilityCost:Charge:Block

* UtilityCost:Ratchet

* UtilityCost:Variable

* UtilityCost:Computation

This section builds upon the discussion that appears in the Input Output Reference under the heading “EnergyPlus Economics.”  The actual computation of monthly utility bills is not difficult since it is mostly consists of multiplying energy consumptions or demands by the price on a per unit basis and adding different bill components.  The implementation in EnergyPlus becomes more complex since the objects were crafted to allow a great deal of  flexibility in specifying a utility tariff while, at the same time, being as simple as possible.

The following discussion on variables and hierarchies is based on the text that appears in the Input Output Reference.

### Conceptual Framework – Variables and Hierarchy

To understand how to use the utility bill calculation portion of EnergyPlus you first need to understand some important concepts of variables and hierarchy.  A variable, for the purposes of this section, is simply a named holder of a series of numbers. In most cases, the variable will be a named holder of 12 numbers, one number for each monthly utility bill. Here is a visualization of a variable called Electric Energy Use:

<table class="table table-striped">
<tr>
<th>Month</th>
<th>Electric Energy Use</th>
</tr>
<tr>
<td>January</td>
<td>12143</td>
</tr>
<tr>
<td>February</td>
<td>13454</td>
</tr>
<tr>
<td>March</td>
<td>14178</td>
</tr>
<tr>
<td>April</td>
<td>14876</td>
</tr>
<tr>
<td>May</td>
<td>15343</td>
</tr>
<tr>
<td>June</td>
<td>16172</td>
</tr>
<tr>
<td>July</td>
<td>16105</td>
</tr>
<tr>
<td>August</td>
<td>15762</td>
</tr>
<tr>
<td>September</td>
<td>14543</td>
</tr>
<tr>
<td>October</td>
<td>13987</td>
</tr>
<tr>
<td>November</td>
<td>13287</td>
</tr>
<tr>
<td>December</td>
<td>12403</td>
</tr>

</table>

If you have ever done any computer programming, you can think of a variable as an array.  Many of the names used in the utility bill calculation portion of EnergyPlus are names of variables.  In the case of the UtilityCost:Charge objects, the name of the object is also used as a name of a variable.

In many of today’s utility rates, the charges for energy or demand are broken into distribution and supply charges.  To allow for this, more than one charge may to be defined for a particular category.  The variables assigned to the same category are added together.

The categories are combined in following hierarchy:

#### ![](EngineeringReference/media/image7909.png)

Any charges included in the EnergyCharges category are added together. The EnergyCharges, DemandCharges and ServiceCharges are added together to form the Basis. The Basis, Adjustments and Surcharges are added together to form the Subtotal. The Subtotal and Taxes are added together to be the Total.  The total represents the total monthly charges on that tariff for the energy source used.  The combining of categories together is performed automatically unless the user specifies the UtilityCost:Computation.  In addition, each category, which is also a variable, may be used as a source. For example, a tax that is 5% of the subtotal would be shown as:

```idf
UtilityCost:Charge:Simple,
  TaxOfFivePercent,        ! Charge Variable Name
  TariffExample1,          ! Tariff Name
  Subtotal,                ! Source Variable
  Annual,                  ! Season
  Taxes,                   ! Category Variable Name
  0.05;                    ! Cost Per Unit Value (or Variable)
```

As you can see, the UtilityCost:Charge:Simple and UtilityCost:Charge:Block objects do most of the “work” of computing the annual energy cost.  The benefit of using this categorization is that totals of each category are shown in the output reports and it organizes the charges in the monthly calculations in a logical way that fits almost all tariffs.  If no categorization is desired, theoretically, all charges could be assigned to the Total category. The categories themselves are simply variable names. Charges may also be assigned to the “NotIncluded” category if the result of the charge is used as an intermediate calculation and should not be included in the Total.

The objects that create variables are:

* UtilityCost:Qualify

* UtilityCost:Charge:Simple

* UtilityCost:Charge:Block

* UtilityCost:Ratchet

* UtilityCost:Variable

### Default Order of Computation

The user has the option of two different ways to determine the order of computation. If an UtilityCost:Computation object is specified for the tariff, the sequence specified in that object is used for computing the various variables. If no UtilityCost:Computation object is specified, a sequence of computational steps is automatically derived and shown as part of the report. The routine that creates this automatic sequence of computation steps is called CreateDefaultComputation as part of the EconomicTariff module.

The order in which the computation should be made is complicated by the fact that the objects can each have variables that are inputs and others that are outputs.  Since any of the variables can be used as inputs, we must ensure that they are computed prior to being used. In other words, because the objects allow a great deal of flexibility, there is no simple default order that the computations should be made.

Luckily there are known algorithms for sorting though these types of interdependencies.  In fact, the method that spreadsheets use for sorting through the dependencies of cell formulas referencing other cells with formula is very similar.  In addition, linkers (used as part of the computer language compiling process) face similar issues of sorting through dependences. Figuring out the optimal path in a complex project represented by a PERT Chart also uses a similar algorithm.

Generically, dependency problems are usually characterized as Directed Acycle Graphs (DAGs). A DAG shows the individual formulas as circles and uses arrows between the circles to show which formula is dependent on which other formulas.  One of the simplest explanations can be seen at the following website:

 (Click on lecture 14 “Critical Path”).

The lecture and site was created by Alison Cawsey, Department of Computing and Electrical Engineering, Heriot-Watt University Edinburgh EH14 4AS, UK.  The specific algorithm that was used in EnergyPlus is described at this site and is quoted below:

Calculate, for each node, the in-degree of that node (ie, now many edges end up there). Store these in array D.

Repeat:

– Remove (output) node such that D[n]=0.

– Decrement D[x] for all nodes x that are neighbors of n (edge from n to x).

Of course in this case “node” has nothing to do with EnergyPlus nodes but is just describing one of the formulas in a DAG.  This is just one of several different methods to solve a DAG.  The general method for solving a DAG is called a topological sort. The algorithm used in EnergyPlus is one of the simplest methods available and is appropriate given the number of dependencies.  More efficient algorithms are known but are probably only appropriate for much larger number of dependencies.

One important note, if after the algorithm is exercised, and some of the formulas still have a count on the number of dependencies, it must be the result of a circular dependency and an error condition is flagged in the ERR file.

The objects have specific variables that are used as inputs and outputs, and thus the outputs are dependent on the inputs, are shown in the following table:



***Object Variables Inputs and Outputs***

<table class="table table-striped">
<tr>
<th>Object</th>
<th>Outputs</th>
<th>Inputs</th>
</tr>
<tr>
<td>Qualify</td>
<td>Name</td>
<td>Source</td>
</tr>
<tr>
<td> </td>
<td> </td>
<td>Threshold</td>
</tr>
<tr>
<td>Charge:Simple</td>
<td>Name</td>
<td>Source</td>
</tr>
<tr>
<td> </td>
<td>Category</td>
<td>Cost Per Unit</td>
</tr>
<tr>
<td>Charge:Block</td>
<td>Name</td>
<td>Source</td>
</tr>
<tr>
<td> </td>
<td>Category</td>
<td>Block Size Multiplier</td>
</tr>
<tr>
<td> </td>
<td>Remaining</td>
<td>Block Size</td>
</tr>
<tr>
<td> </td>
<td> </td>
<td>Block Cost</td>
</tr>
<tr>
<td>Ratchet</td>
<td>Name</td>
<td>Baseline</td>
</tr>
<tr>
<td> </td>
<td> </td>
<td>Adjustment</td>
</tr>
<tr>
<td> </td>
<td> </td>
<td>Multiplier</td>
</tr>
<tr>
<td> </td>
<td> </td>
<td>Offset</td>
</tr>
</table>



In addition, the hierarchy shown in the first diagram in this section also represents dependencies that are included when determining the order of computation.

The resulting order of computation is shown at the bottom of the economics report.

### Computation Steps

Once the order that the formulas should be computed is known, the actual evaluation of the formulas is based on a simple Last In First Out (LIFO) stack.  This is a common method to compute expressions where values are stored on the stack and operands work off of the top of the stack.

Life-Cycle Cost Computations
----------------------------

The objects used for performing a life-cycle cost analysis are:

* LifeCycleCost:Parameters

* LifeCycleCost:RecurringCosts

* LifeCycleCost:NonrecurringCost

* LifeCycleCost:UsePriceEscalation

* LifeCycleCost:UseAdjustment

The computation of life-cycle costs is broken into three main routines which are described below.

### ExpressAsCashFlows

Step 1. If the input file has ComponentCost:\* items, then create an additional instance of a nonrecurring cost to hold the total.

Step 2. Get the costs for each resource that has non-zero utility costs.

Step 3. Compute the inflation on a monthly basis. For cases where the inflation approach is constant dollars, the inflation is set to 1.0 for all months. For current dollar analyses, compute the inflation rate on a monthly basis. Just using 1/12 of the annual inflation is almost correct but introduces a small error so instead the inverse of the formula 4-32 from Newnan (Engineering Economic Analysis Ninth Edition by Donald Newnan, Ted Eschenbach, and Jerome Lavelle):

inflationPerMonth = ((inflation + 1.00) \*\* (1.0/12.0)) - 1

Then the inflation is applied for each month:

monthlyInflationFactor(jMonth) = (1 + inflationPerMonth) \*\* (jMonth - 1)

Step 4. Put the nonrecurring, nonrecurring, and utility costs into a monthly array for the entire length of the study period.

Step 5. Multiply the monthly costs by the monthly inflation which was set to 1.0 for constant dollar analyses.

Step 6. Multiply the monthly costs for resources with use adjustments.

Step 7. Sum the monthly costs by category.

Step 8. Based on the base date, accumulate the monthly costs into yearly costs.

### ComputePresentValue

Step 1. For each year of the study compute the discount factor (SPV) using the following formula:

SPV<sub>yr</sub> = 1 / ((1 + curDiscountRate) \*\* effectiveYear)

This formula is based on formula D.2.1.1 from NIST Handbook 135 Life Cycle Costing Manual for the Federal Energy Management Program by Sieglinde K. Fuller and Stephen R. Petersen.

Where the effectiveYear depends on the discount convention. If end of year discounting is used than the effectiveYear is the year. If middle of the year discounting is used than the effectiveYear is reduced by 0.5. If the beginning of year discounting is used, than the effectiveYear is reduced by 1.0.

For energy costs, the use price escalations are multiplied by the discount factors.

Step 2. Compute the present value for each month by multiply the monthly costs by the discount factor for each year.

Step 3. Sum the costs by category.

### ComputeTaxAndDepreciation

Step 1. Depending on the depreciation method selected the depreciation factors are set to various constants. Depreciation factors are based on IRS Publication 946 for 2009 "How to Depreciate Property." The MACRS values are based on Modified Accelerated Cost Recovery System GDS for 3, 5, 7, 10 year property are based on 200% depreciation method shown in Appendix A of IRS Publication 946 using half year. 15 and 20 are based on 150% (Chart 1 of IRS Publication 946). For Straight Line depreciation GDS is used for 27 years (actually 27.5) 31 years (actually 31.5 years) and 39 years using mid month. For 40 years ADS is used (chart 2) Table A-1 is used for 3, 4, 5, 10, 15 and 20 years. Table A-6 is for 27 years. Table A-7 for 31 years. Table A-7a for 39 years. Table A-13 for 40 years. These years are a classification of property and should not be confused with the length of the study. For 27 years, 31 years, 39 years and 40 years the June value was used. All references in this paragraph are to IRS Publication 946.

Step 2. Apply the annual depreciation factors to the capital costs.

Step 3. For each year the taxable income is the grand total of all costs minus the depreciated capital costs.

Step 4. Taxes are the taxable income times the tax rate.

Step 5. The after tax present value is

AfterTaxPresentValue<sub>yr</sub> = GrandTotal<sub>yr</sub> - Taxes<sub>yr</sub> \* SPV<sub>yr</sub>

All major results are presented on the tabular report.





Special Modules/Reporting
=========================

Environmental Impacts
---------------------

Typically when a new building technology is evaluated the energy performance of a baseline building is compared to the energy and life-cycle costs of alternatives to determine cost-effectiveness. But what if the lowest energy or life-cycle cost alternative is not the cleanest or lowest environmental impact?  By calculating environmental impact, designers can compare alternatives not only in terms of their energy performance but also their environmental performance—working towards a more sustainable design (Liesen 1997; Stroot, Nemeth, and Fournier 1996).  Environmental impacts are quantified, in part, by modeling the amount of emissions and in EnergyPlus this is done using the input objects “EnvironmentalImpactFactors,” “FuelFactors,” and “Output:EnvironmentalImpactFactors.”

Based on emissions factors entered by the user, EnergyPlus calculates the mass or volume of thirteen different pollutants: CO<sub>2</sub> (carbon dioxide), CO (carbon monoxide), CH<sub>4</sub> (methane), NO<sub>x</sub> (nitrogen oxides), N<sub>2</sub>O (nitrous oxide), SO<sub>2</sub> (sulphur dioxide), PM (particulate matter), PM<sub>10</sub> (particulate matter 10&gt;PM<sub>10</sub>&gt;2.5 microns), PM<sub>2.5</sub> (particulate matter&lt;2.5 microns), NH<sub>3</sub> (ammonia), NMVOC (non-methane volatile organic compounds), Hg (mercury), and Pb (lead) as well as water consumed through evaporation in thermo- and hydro-electric generation and high- and low-level nuclear waste from nuclear electricity generation for on- and off-site energy production.  Note that while these comprise the largest proportion of pollutants, more than one hundred other pollutants are emitted from fossil fuel combustion or electricity generation. Much of the information compiled here for fossil fuel combustion comes from *AP-42 Compilation of Air Pollutant Emission Factors* (EPA 1998a, 1998b, 1996).  For more information on pollutants, see the U.S. Environmental Protection Agency (EPA) Clearinghouse for Inventories & Emission Factors ([www.epa.gov/ttn/chief/efinformation.html](http://www.epa.gov/ttn/chief/efinformation.html)).

EnergyPlus models energy performance of on-site fossil fuels and purchased electricity (generated from a variety of fuels including natural gas, oil, gasoline, diesel, coal, hydroelectric, nuclear, wind, solar power, and biomass).  The energy performance calculated by EnergyPlus is converted into a mass or volume of pollutants emitted.  From a baseline building, alternative energy and pollution saving technologies can be explored, and the energy savings and pollution reduction can be calculated.  Figure 341 and Figure 342 illustrate a comparison of two buildings simulated using Chicago weather data in EnergyPlus and the calculated pollutant levels (based on U.S. national average pollutants) (Crawley 2003).

To calculate the mass or volume of each pollutant, consumption is multiplied by an emissions factor for each fuel (natural gas, electricity, fuel oil, diesel, or coal). In future versions, users will be able to schedule how the emissions factors by time of day, month, season and year.  For electricity, the mix of generation fuel sources—whether utility, state or regional—is used to adjust the emission factors.  If a user has emissions factors specific to the building site and equipment, these can be entered directly.  **There are no default emissions factors**.

### Types of Pollutants

EPA categorizes pollutants as either Criteria Pollutants or Hazardous Pollutants. Criteria pollutants are the six substances for which EPA has set health-based standards, including carbon monoxide (CO), nitrogen oxides (NO<sub>x</sub>), sulfur dioxide (SO<sub>2</sub>), and particulate matter (PM10 and PM2.5), ozone (O<sub>3</sub>), and lead (Pb).  Because ozone is created in atmospheric photochemical reactions of volatile organic compounds, ammonia, and other substances rather than direct building-related energy emissions, we do not calculated ozone emissions in EnergyPlus.  But we do include ozone precursors: methane (CH<sub>4</sub>), non-methane volatile organic compounds (NMVOC), and ammonia (NH<sub>3</sub>). Hazardous pollutants are substances that are known or suspected to cause serious health problems such as cancer.  We include typical hazardous substances associated with energy production and use including lead (Pb) and mercury (Hg). We also include CO<sub>2</sub> (carbon dioxide) since it is largest greenhouse gas in terms of impact.

![](EngineeringReference/media/image7910.svg.png)

Figure 341.  Example Annual Atmospheric Pollutants and Water Consumption

![](EngineeringReference/media/image7911.svg.png)

Figure 342.  Example Annual Total Carbon Equivalent for Major Greenhouse Gases

### Carbon Equivalent

The Intergovernmental Panel on Climate Change has studied the effects on the relative radiative forcing effects of various greenhouse gases.  This effect, called Global Warming Potential (GWP), is described in terms of the Carbon Equivalent of a particular greenhouse gas.  This equivalent is based on a factor of 1.0 for carbon.  This group of gases includes carbon dioxide (CO<sub>2</sub>), carbon monoxide, nitrous oxide, methane, halocarbon emission, hydrofluorocarbons (HFC), perfluorocarbons (PFC), and chlorofluorocarbons (CFC).  For building energy use, the main gases of concern are carbon dioxide, carbon monoxide, methane, and nitrous oxide.  Although carbon monoxide has a relatively short life, CO emissions into the atmosphere may have a significant impact on climate forcing due to chemical impact on CH<sub>4</sub> lifetime, and tropospheric O<sub>3</sub> and CO<sub>2</sub> photochemical production normally reacts to produce carbon dioxide, but it can’t be ignored since it is produced in incomplete combustion and the carbon remains to interact as CO<sub>2.</sub> Yet there is no agreement on its carbon equivalent (IPCC 2001). The carbon equivalent of carbon dioxide, methane, and nitrous oxide are calculated and then multiplied by their GWP on a 100 year time frame.  The Carbon Equivalents of the following gases have been determined and used in the program are shown in the following table.

Table 93. Carbon Equivalents (IPCC 2001)

<table class="table table-striped">
<tr>
<th>Gas</th>
<th>Carbon Equivalent</th>
</tr>
<tr>
<td>NO<sub>x</sub></td>
<td>80.7272</td>
</tr>
<tr>
<td>CH<sub>4</sub></td>
<td>6.2727</td>
</tr>
<tr>
<td>CO<sub>2</sub></td>
<td>0.2727</td>
</tr>
</table>

The resulting carbon equivalents by fuel type are shown in the output of the program along with the individual gas pollutants.

### Fossil Fuel Emissions Factors

Emission factors for on-site fossil fuel consumption are based on Section 1.4 Natural Gas Combustion in EPA (1998a) Table 94 shows the greenhouse gas and precursors and criteria pollutant emissions factors for natural gas.  Similar emissions factors are shown for residual fuel oil (No. 4 and No. 6 fuel oil) [Table 95], distillates (No. 1 and No. 2 fuel oil) [Table 96], residential oil furnace [Table 97], LPG (butane and propane) [Table 98], gasoline and diesel [Table 99], and coal [Table 100] in the indicated tables.  Note that a zero for a pollutant in the table may mean that no data were available, not that there are no emissions of that pollutant.

Table 94.  Emission Factors for Natural Gas

<table class="table table-striped">
<tr>
<th>Pollutant</th>
<th>Emission Factor<sup>a</sup>   (g/MJ)</th>
</tr>
<tr>
<td>Carbon Dioxide (CO<sub>2</sub>)</td>
<td>50.23439</td>
</tr>
<tr>
<td>Carbon Monoxide (CO)</td>
<td>3.51641E-02</td>
</tr>
<tr>
<td>Methane (CH<sub>4</sub>)</td>
<td>9.62826E-04</td>
</tr>
<tr>
<td>Nitrogen Oxides (NO<sub>X</sub>)</td>
<td>4.18620E-02</td>
</tr>
<tr>
<td>Nitrous Oxide (N<sub>2</sub>O)<sup>b</sup></td>
<td>9.20964E-04</td>
</tr>
<tr>
<td>Sulphur Dioxide (SO<sub>2</sub>)<sup>c</sup></td>
<td>2.51172E-04</td>
</tr>
<tr>
<td>Particulate Matter (PM)<sup>d</sup></td>
<td>3.18151E-03</td>
</tr>
<tr>
<td>Particulate Matter (PM10)<sup>d</sup></td>
<td>2.38613E-03</td>
</tr>
<tr>
<td>Particulate Matter (PM2.5)<sup>d</sup></td>
<td>7.95378E-04</td>
</tr>
<tr>
<td>Ammonia (NH<sub>3</sub>)</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Volatile Organic Compounds (NMVOC)</td>
<td>2.30241E-03</td>
</tr>
<tr>
<td>Mercury (Hg)</td>
<td>1.08841E-07</td>
</tr>
<tr>
<td>Lead (Pb)</td>
<td>2.09310E-07</td>
</tr>
<tr>
<td colspan="2">a Based on data from Tables 1.4-1, 1.4.-2 and 1.4.4  in EPA (1998a), Natural gas heat value of 1027 Btu/ft3 based on data for 2003 in Table A-4 in DOE (2004)</td>
</tr>
<tr>
<td colspan="2">b Values shown are for uncontrolled burner.  For controlled-low NO<sub>X</sub> burner, use 0.64 lb/106 ft3, 0.000627 lb/MMBtu, 0.0002679 g/MJ</td>
</tr>
<tr>
<td colspan="2">c Based on 100% conversion of fuel sulfur to SO<sub>2</sub>. Assumes sulfur content is natural gas of 2,000 grains/106 ft3. The SO2 emission factor can be converted to other natural gas sulfur contents by multiplying the SO<sub>2</sub> emission factor by the ratio of the site-specific sulfur content (grains/106 ft3) to 2,000 grains/106 ft3.</td>
</tr>
<tr>
<td colspan="2">d PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns, respectively.</td>
</tr>
<tr>
<td colspan="2">e No data</td>
</tr>
</table>

Table 95.  Emission Factors for Residual Fuel Oil (No. 4 and No. 6 Fuel Oil)
<table class="table table-striped">
  <tr>
    <th>Pollutant</th>
    <th>Emission Factor <sup>a</sup> (g/MJ)</th>
  </tr>
  <tr>
    <td>Carbon Dioxide (CO 2 )</td>
    <td>50.23439</td>
  </tr>
  <tr>
    <td>Carbon Monoxide (CO)</td>
    <td>3.52E-002</td>
  </tr>
  <tr>
    <td>Methane (CH 4 )</td>
    <td>9.63E-004</td>
  </tr>
  <tr>
    <td>Nitrogen Oxides (NO X )</td>
    <td>4.19E-002</td>
  </tr>
  <tr>
    <td>Nitrous Oxide (N 2 O) <sup>b</sup></td>
    <td>9.21E-004</td>
  </tr>
  <tr>
    <td>Sulphur Dioxide (SO 2 ) <sup>c</sup></td>
    <td>2.51E-004</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM) <sup>d</sup></td>
    <td>3.18E-003</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM10) <sup>d</sup></td>
    <td>2.39E-003</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM2.5) <sup>d</sup></td>
    <td>7.95E-004</td>
  </tr>
  <tr>
    <td>Ammonia (NH 3 )</td>
    <td>0 <sup>e</sup></td>
  </tr>
  <tr>
    <td>Volatile Organic Compounds (NMVOC)</td>
    <td>2.30E-003</td>
  </tr>
  <tr>
    <td>Mercury (Hg)</td>
    <td>1.09E-007</td>
  </tr>
  <tr>
    <td>Lead (Pb)</td>
    <td>2.09E-007</td>
  </tr>
  <tr>
    <td colspan="2"><sup>a</sup> Based on data from Tables 1.4-1, 1.4.-2 and 1.4.4 in EPA (1998a), Natural gas heat value of 1027 Btu/ft3 based on data for 2003 in Table A-4 in DOE (2004)</td>
  </tr>
  <tr>
    <td colspan="2"><sup>b</sup> Values shown are for uncontrolled burner. For controlled-low NOX burner, use 0.64 lb/106 ft3, 0.000627 lb/MMBtu, 0.0002679 g/MJ</td>
  </tr>
  <tr>
    <td colspan="2"><sup>c</sup> Based on 100% conversion of fuel sulfur to SO2. Assumes sulfur content is natural gas of 2,000 contents by multiplying the SO2 emission factor by the ratio of the site-specific sulfur content (grains/106 ft3) to 2,000 grains/106 ft3. grains/106 ft3. The SO2 emission factor can be converted to other natural gas sulfur</td>
  </tr>
  <tr>
    <td colspan="2"><sup>d</sup> PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns, respectively.</td>
  </tr>
  <tr>
    <td colspan="2"><sup>e</sup> No data.</td>
  </tr>
</table>

Table 96.  Emission Factors for Distillates (No. 1 and No. 2 Fuel Oil)

<table class="table table-striped">
  <tr>
    <th>Pollutant</th>
    <th>No. 1 Fuel Oil Emission Factor<sup>a</sup> (g/MJ)</th>
    <th>No. 2 Fuel Oil Emission Factor<sup>a</sup> (g/MJ)</th>
  </tr>
  <tr>
    <td>Carbon Dioxide (CO<sub>2</sub>)</td>
    <td>66.0233</td>
    <td>68.47998</td>
  </tr>
  <tr>
    <td>Carbon Monoxide (CO)</td>
    <td>1.54E-002</td>
    <td>1.54E-002</td>
  </tr>
  <tr>
    <td>Methane (CH<sub>4</sub>)</td>
    <td>6.63E-004</td>
    <td>6.63E-004</td>
  </tr>
  <tr>
    <td>Nitrogen Oxides (NO<sub>X</sub>)</td>
    <td>6.14E-002</td>
    <td>7.37E-002</td>
  </tr>
  <tr>
    <td>Nitrous Oxide (N<sub>2</sub>O)</td>
    <td>3.38E-004</td>
    <td>3.38E-004</td>
  </tr>
  <tr>
    <td>Sulphur Dioxide (SO<sub>2</sub>)<sup>b</sup></td>
    <td>4.36E-001</td>
    <td>4.82E-001</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM)<sup>c</sup></td>
    <td>6.14E-003</td>
    <td>6.14E-003</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM10)<sup>c</sup></td>
    <td>3.32E-003</td>
    <td>3.32E-003</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM2.5)<sup>c</sup></td>
    <td>2.55E-003</td>
    <td>2.55E-003</td>
  </tr>
  <tr>
    <td>Ammonia (NH<sub>3</sub>)</td>
    <td>0<sup>d</sup></td>
    <td>0<sup>d</sup></td>
  </tr>
  <tr>
    <td>Volatile Organic Compounds (NMVOC)</td>
    <td>1.04E-003</td>
    <td>1.04E-003</td>
  </tr>
  <tr>
    <td>Mercury (Hg)</td>
    <td>3.47E-006</td>
    <td>3.47E-006</td>
  </tr>
  <tr>
    <td>Lead (Pb)</td>
    <td>4.64E-006</td>
    <td>4.64E-006</td>
  </tr>
  <tr>
    <td>a Based on data from Tables 1.3-1, 1.3-3, 1-3.8, 1.3-10 and 1.3-12 in EPA (1998b).</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>b Based on 100% conversion of fuel sulfur to SO<sub>2</sub>. Assumes 1% sulfur content. The SO<sub>2</sub> emission factor in this table can be converted to other natural gas sulfur contents by multiplying the SO<sub>2</sub> emission factor by percentage sulfur content.</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>c PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns, respectively</td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td>d No data.</td>
    <td></td>
    <td></td>
  </tr>
</table>


Table 97.  Emission Factors for Residential Oil Furnace

<table class="table table-striped">
<tr>
<th>Pollutant</th>
<th>Emission Factor<sup>a</sup>   (g/MJ)</th>
</tr>
<tr>
<td>Carbon Dioxide (CO<sub>2</sub>)</td>
<td>68.48237</td>
</tr>
<tr>
<td>Carbon Monoxide (CO)</td>
<td>1.53543E-02</td>
</tr>
<tr>
<td>Methane (CH<sub>4</sub>)</td>
<td>5.46612E-02</td>
</tr>
<tr>
<td>Nitrogen Oxides (NO<sub>X</sub>)</td>
<td>5.52753E-02</td>
</tr>
<tr>
<td>Nitrous Oxide (N<sub>2</sub>O)</td>
<td>1.53543E-04</td>
</tr>
<tr>
<td>Sulphur Dioxide (SO<sub>2</sub>)<sup>b</sup></td>
<td>4.36061E-01</td>
</tr>
<tr>
<td>Particulate Matter (PM)<sup>c</sup></td>
<td>2.14960E-02</td>
</tr>
<tr>
<td>Particulate Matter (PM10)<sup>c</sup></td>
<td>1.58763E-02</td>
</tr>
<tr>
<td>Particulate Matter (PM2.5)<sup>c</sup></td>
<td>5.89603E-03</td>
</tr>
<tr>
<td>Ammonia (NH<sub>3</sub>)</td>
<td>0<sup>d</sup></td>
</tr>
<tr>
<td>Volatile Organic Compounds (NMVOC)</td>
<td>2.18952E-03</td>
</tr>
<tr>
<td>Mercury (Hg)</td>
<td>3.47006E-06</td>
</tr>
<tr>
<td>Lead (Pb)</td>
<td>4.63699E-06</td>
</tr>
<tr>
 <td colspan="2">a Based on data from Tables 1.3-1, 1.3-3, 1.3-8, 1.3-10, and 1.3-12 in EPA (1998b).</td>
</tr>
<tr>
 <td colspan="2">b Based on 100% conversion of fuel sulfur to SO<sub>2</sub>. Assumes 1% sulfur content. The SO<sub>2</sub> emission factor in this table can be converted to other natural gas sulfur contents by multiplying the SO<sub>2</sub> emission factor by percentage sulfur content.</td>
</tr>
<tr>
 <td colspan="2">c PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns, respectively.</td>
</tr>
<tr>
 <td colspan="2">d No data.</td>
</tr>
</table>

Table 98.  Emission Factors for LPG (butane and propane)

<table class="table table-striped">
  <tr>
    <th>Pollutant</th>
    <th>LPG (butane) Emission Factor <sup>a</sup> (g/MJ)</th>
    <th>Propane Emission Factor <sup>a</sup> (g/MJ)</th>
  </tr>
  <tr>
    <td>Carbon Dioxide (CO<sub>2</sub>)</td>
    <td>66.0233</td>
    <td>68.47998</td>
  </tr>
  <tr>
    <td>Carbon Monoxide (CO)</td>
    <td>1.54E-002</td>
    <td>1.54E-002</td>
  </tr>
  <tr>
    <td>Methane (CH<sub>4</sub>)</td>
    <td>6.63E-004</td>
    <td>6.63E-004</td>
  </tr>
  <tr>
    <td>Nitrogen Oxides (NO<sub>X</sub>)</td>
    <td>6.14E-002</td>
    <td>7.37E-002</td>
  </tr>
  <tr>
    <td>Nitrous Oxide (N<sub>2</sub>O)</td>
    <td>3.38E-004</td>
    <td>3.38E-004</td>
  </tr>
  <tr>
    <td>Sulphur Dioxide (SO<sub>2</sub>)<sup>b</sup></td>
    <td>4.36E-001</td>
    <td>4.82E-001</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM)<sup>c</sup></td>
    <td>6.14E-003</td>
    <td>6.14E-003</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM10)<sup>c</sup></td>
    <td>3.32E-003</td>
    <td>3.32E-003</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM2.5)<sup>c</sup></td>
    <td>2.55E-003</td>
    <td>2.55E-003</td>
  </tr>
  <tr>
    <td>Ammonia (NH<sub>3</sub>)</td>
    <td>0<sup>d</sup></td>
    <td>0<sup>d</sup></td>
  </tr>
  <tr>
    <td>Volatile Organic Compounds (NMVOC)</td>
    <td>1.04E-003</td>
    <td>1.04E-003</td>
  </tr>
  <tr>
    <td>Mercury (Hg)</td>
    <td>3.47E-006</td>
    <td>3.47E-006</td>
  </tr>
  <tr>
    <td>Lead (Pb)</td>
    <td>4.64E-006</td>
    <td>4.64E-006</td>
  </tr>
  <tr>
    <td colspan="3">a Based on data from Table # 1.5-1 in EPA (1996); Higher Heating value of 1.02 MMBtu/gal for butane and 0.915 MMBtu/gal for propane based on data in EPA (1996).</td>
  </tr>
  <tr>
    <td colspan="3">b Based on 100% conversion of fuel sulfur to SO<sub>2</sub>. Assumes sulphur content is 0.18 gr/100 ft3.The SO<sub>2</sub> emission factor can be converted to other LPG sulphur contents by multiplying the SO<sub>2</sub> emission factor by the ratio of the site-specific sulphur content gr/100 ft3 to 0.18 gr/100 ft3.</td>
  </tr>
  <tr>
    <td colspan="3">c PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns; respectively.</td>
  </tr>
  <tr>
    <td colspan="3">d No data.</td>
  </tr>
</table>

Table 99.  Emission Factors for Gasoline and Diesel

<table class="table table-striped">
  <tr>
    <th>Pollutant</th>
    <th>Gasoline Emission Factor<sup>a</sup> (g/MJ)</th>
    <th>Diesel Emission Factor<sup>a</sup> (g/MJ)</th>
  </tr>
  <tr>
    <td>Carbon Dioxide (CO<sub>2</sub>)</td>
    <td>66.20808</td>
    <td>70.50731</td>
  </tr>
  <tr>
    <td>Carbon Monoxide (CO)</td>
    <td>2.70E+001</td>
    <td>4.08E-001</td>
  </tr>
  <tr>
    <td>Methane (CH<sub>4</sub>)</td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td>Nitrogen Oxides (NO<sub>X</sub>)</td>
    <td>7.01E-001</td>
    <td>1.90E+000</td>
  </tr>
  <tr>
    <td>Nitrous Oxide (N<sub>2</sub>O)</td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td>Sulphur Dioxide (SO<sub>2</sub>)</td>
    <td>3.61E-002</td>
    <td>1.25E-001</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM)<sup>b</sup></td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td>Particulate Matter (PM10)<sup>b</sup></td>
    <td>4.30E-002</td>
    <td>1.33E-001</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM2.5)<sup>b</sup></td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td>Ammonia (NH<sub>3</sub>)</td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td>Volatile Organic Compounds (NMVOC)</td>
    <td>9.03E-001</td>
    <td>1.50E-001</td>
  </tr>
  <tr>
    <td>Mercury (Hg)</td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td>Lead (Pb)</td>
    <td>0<sup>c</sup></td>
    <td>0<sup>c</sup></td>
  </tr>
  <tr>
    <td colspan="3">a Based on data from Table # 3.3-1 in EPA (1996); Diesel higher heating value of 19300 Btu/lb and gasoline higher heating value of 20300 Btu/lb based on data in EPA (1996).</td>
  </tr>
  <tr>
    <td colspan="3">b PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns; respectively.</td>
  </tr>
  <tr>
    <td colspan="3">c No data.</td>
  </tr>
</table>


Table 100.  Emission Factors for Coal

<table class="table table-striped">
  <tr>
    <th>Pollutant</th>
    <th>Bituminous Emission Factor<sup>a</sup> (g/MJ)</th>
    <th>Anthracite Emission Factor<sup>a</sup> (g/MJ)</th>
    <th>Lignite Emission Factor<sup>a</sup> (g/MJ)</th>
  </tr>
  <tr>
    <td>Carbon Dioxide (CO<sub>2</sub>)</td>
    <td>91.11052</td>
    <td>99.26669</td>
    <td>152.12646</td>
  </tr>
  <tr>
    <td>Carbon Monoxide (CO)</td>
    <td>8.27E-003</td>
    <td>1.05E-002</td>
    <td>8.27E-003</td>
  </tr>
  <tr>
    <td>Methane (CH<sub>4</sub>)</td>
    <td>6.61E-004</td>
    <td>0<sup>f</sup></td>
    <td>0<sup>f</sup></td>
  </tr>
  <tr>
    <td>Nitrogen Oxides (NO<sub>X</sub>)</td>
    <td>1.98E-001</td>
    <td>3.15E-001</td>
    <td>2.35E-001</td>
  </tr>
  <tr>
    <td>Nitrous Oxide (N<sub>2</sub>O)</td>
    <td>4.96E-004</td>
    <td>0<sup>f</sup></td>
    <td>0<sup>f</sup></td>
  </tr>
  <tr>
    <td>Sulphur Dioxide (SO<sub>2</sub>)<sup>d</sup></td>
    <td>6.28E-001</td>
    <td>6.82E-001</td>
    <td>9.92E-001</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM)<sup>e</sup></td>
    <td>1.65E-001</td>
    <td>1.75E-001</td>
    <td>2.18E-001</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM10)<sup>e</sup></td>
    <td>3.80E-002</td>
    <td>4.02E-002</td>
    <td>7.61E-002</td>
  </tr>
  <tr>
    <td>Particulate Matter (PM2.5)<sup>e</sup></td>
    <td>9.92E-003</td>
    <td>1.05E-002</td>
    <td>2.18E-002</td>
  </tr>
  <tr>
    <td>Ammonia (NH<sub>3</sub>)</td>
    <td>0<sup>f</sup></td>
    <td>0<sup>f</sup></td>
    <td>0<sup>f</sup></td>
  </tr>
  <tr>
    <td>Volatile Organic Compounds (NMVOC)</td>
    <td>9.92E-004</td>
    <td>2.15E-002</td>
    <td>1.32E-003</td>
  </tr>
  <tr>
    <td>Mercury (Hg)</td>
    <td>6.94E-006</td>
    <td>2.27E-006</td>
    <td>2.74E-006</td>
  </tr>
  <tr>
    <td>Lead (Pb)</td>
    <td>1.37E-006</td>
    <td>1.56E-004</td>
    <td>1.39E-005</td>
  </tr>
  <tr>
    <td colspan="4">a Based on data on pulverized coal from Tables 1.1-3, 1.1-6, 1.1-18, 1.1-19 in EPA (1998a), Coal average higher heating value of 26.0 MMBtu/ton based on EPA (1998a).</td>
  </tr>
  <tr>
    <td colspan="4">b Based on data on pulverized coal from Tables 1.2-1, 1.2-2, 1.2-3, 1.2-4, 1.2-7 in EPA (1996), Coal average higher heating value of 24.6 MMBtu/ton based on EPA (1996).</td>
  </tr>
  <tr>
    <td colspan="4">c Based on data on pulverized coal from Tables 1.7-1, 1.7-3, 1.7-7, 1.7-14 in EPA (1998b), Coal average higher heating value of 13.0 MMBtu/ton based on EPA (1998b).</td>
  </tr>
  <tr>
    <td colspan="4">d Based on 100% conversion of fuel sulfur to SO<sub>2</sub>. Assumes 1% sulfur content. The SO<sub>2</sub> emission factor in this table can be converted to other natural gas sulfur contents by multiplying the SO<sub>2</sub> emission factor by percentage sulfur content.</td>
  </tr>
  <tr>
    <td colspan="4">e PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 are particles smaller than 10 and 2.5 microns, respectively. Expressed in terms of coal ash content, assumes 1% ash content.  Multiply weight % ash content of coal (as fired) by the value.</td>
  </tr>
  <tr>
    <td colspan="4">f No data.</td>
  </tr>
</table>

### Off-Site Electricity Generation Emissions

While estimating emissions from on-site fossil fuel combustion can be fairly straight-forward, emissions from off-site electricity is more challenging.  How the electricity is generated, i.e., from gas, oil, coal, nuclear, renewable sources (wind, PV) or hydroelectric, and the mix of generation determines the resulting level of emissions.  While data are available at utility and even power plant level (from the sources cited), data are shown here for United States national- and state-level average emissions from electricity generation. Table 101 provides average greenhouse gas and precursors and criteria pollutant emissions factors for the entire United States from electricity generation. Table 102 provides average electricity emissions factors by state, for greenhouse gas and precursors, and Table 103 for criteria pollutant emission factors. These two tables also include a ratio of heat input to electric output (efficiency of electricity generation) including distribution and transmission losses to allow calculation of source energy.

As mentioned in the introduction to this section, EnergyPlus also calculates water consumed through evaporation in thermo-electric and hydro-electric generation. Torcellini, Long, and Judkoff (2004) provide data on average water consumption by generator type by state.  These data are summarized in units suitable for EnergyPlus in Table 101, for national and state average water consumption for thermal-electric, hydro-electric, and Table 102 for weighted total electricity generation.

Table 101.  United States National Average Emission Factors for Electricity Generation

<table class="table table-striped">
<tr>
<td> </td>
<th>Efficiency Ratio (J/J)</th>
</tr>
<tr>
<td>Ratio of Heat Input to Electricity Output<sup>a</sup></td>
<td>2.253</td>
</tr>
<tr>
<td> </td>
<td> </td>
</tr>
<tr>
<th>Pollutant</th>
<th>Emission Factor   (g/MJ)</th>
</tr>
<tr>
<td>Carbon Dioxide (CO<sub>2</sub>)<sup>b</sup></td>
<td>168.333168</td>
</tr>
<tr>
<td>Carbon Monoxide (CO)<sup>c</sup></td>
<td>4.20616E-02</td>
</tr>
<tr>
<td>Methane (CH<sub>4</sub>)<sup>b</sup></td>
<td>1.39858E-03</td>
</tr>
<tr>
<td>Nitrogen Oxides (NO<sub>X</sub>)<sup>a</sup></td>
<td>4.10753E-01</td>
</tr>
<tr>
<td>Nitrous Oxide (N<sub>2</sub>O)<sup>b</sup></td>
<td>2.41916E-03</td>
</tr>
<tr>
<td>Sulphur Dioxide (SO<sub>2</sub>)<sup>a</sup></td>
<td>8.65731E-01</td>
</tr>
<tr>
<td>Particulate Matter (PM)<sup>c,d</sup></td>
<td>2.95827E-02</td>
</tr>
<tr>
<td>Particulate Matter (PM10)<sup>c,d</sup></td>
<td>1.80450E-02</td>
</tr>
<tr>
<td>Particulate Matter (PM2.5)<sup>c,d</sup></td>
<td>1.15377E-02</td>
</tr>
<tr>
<td>Ammonia (NH<sub>3</sub>)<sup>c</sup></td>
<td>1.10837E-03</td>
</tr>
<tr>
<td>Volatile Organic Compounds (NMVOC)<sup>a</sup></td>
<td>3.72332E-03</td>
</tr>
<tr>
<td>Mercury (Hg)<sup>c</sup></td>
<td>3.36414E-06</td>
</tr>
<tr>
<td>Lead (Pb)</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
 <td colspan="2"><sup>a</sup> Data based on 1999 data from *eGRID* version 2.01 (EPA 2003a).</td>
</tr>
<tr>
 <td colspan="2"><sup>b</sup> Data based on 1998-2000 average data in DOE (2002).</td>
</tr>
<tr>
 <td colspan="2"><sup>c</sup> Data based on tier emissions report for criteria air pollutants in EPA (2003b).</td>
</tr>
<tr>
 <td colspan="2"><sup>d</sup> PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns, respectively.</td>
</tr>
<tr>
 <td colspan="2"><sup>e</sup> No data.</td>
</tr>
</table>

Table 102.  U. S. State Average Greenhouse Gas Emission Factors for Electricity Generation, in g/MJ

<table class="table table-striped">
  <tr>
    <th></th>
    <th>Ratio of Heat Input to Electric Output</th>
    <th>Carbon Dioxide (CO 2 ) b</th>
    <th>Carbon Monoxide (CO) c</th>
    <th>Methane (CH4) b</th>
    <th>Nitrogen Oxides (NO X ) a</th>
    <th>Nitrous Oxide (N 2 O) b</th>
    <th>Sulphur Dioxide (SO 2 ) a</th>
  </tr>
  <tr>
    <td>Alabama</td>
    <td>2.23</td>
    <td>165.30922</td>
    <td>1.45E+003</td>
    <td>1.73E-003</td>
    <td>4.02E-001</td>
    <td>2.81E-003</td>
    <td>1.14E+000</td>
  </tr>
  <tr>
    <td>Alaska</td>
    <td>2.734</td>
    <td>173.87708</td>
    <td>3.72E+002</td>
    <td>8.57E-004</td>
    <td>7.29E-001</td>
    <td>1.12E-003</td>
    <td>2.38E-001</td>
  </tr>
  <tr>
    <td>Arizona</td>
    <td>1.694</td>
    <td>132.29777</td>
    <td>8.27E+002</td>
    <td>8.57E-004</td>
    <td>2.74E-001</td>
    <td>1.94E-003</td>
    <td>2.28E-001</td>
  </tr>
  <tr>
    <td>Arkansas</td>
    <td>2.207</td>
    <td>162.03327</td>
    <td>6.42E+002</td>
    <td>1.57E-003</td>
    <td>2.87E-001</td>
    <td>2.56E-003</td>
    <td>4.25E-001</td>
  </tr>
  <tr>
    <td>California</td>
    <td>1.422</td>
    <td>76.35472</td>
    <td>2.91E+003</td>
    <td>8.44E-004</td>
    <td>6.56E-002</td>
    <td>4.66E-004</td>
    <td>3.05E-002</td>
  </tr>
  <tr>
    <td>Colorado</td>
    <td>3.101</td>
    <td>242.67192</td>
    <td>1.51E+003</td>
    <td>1.60E-003</td>
    <td>4.74E-001</td>
    <td>3.64E-003</td>
    <td>5.84E-001</td>
  </tr>
  <tr>
    <td>Connecticut</td>
    <td>1.72</td>
    <td>118.69</td>
    <td>3.21E+002</td>
    <td>2.19E-003</td>
    <td>1.82E-001</td>
    <td>1.51E-003</td>
    <td>3.79E-001</td>
  </tr>
  <tr>
    <td>Delaware</td>
    <td>2.736</td>
    <td>230.57612</td>
    <td>1.31E+002</td>
    <td>1.55E-003</td>
    <td>4.13E-001</td>
    <td>2.86E-003</td>
    <td>1.11E+000</td>
  </tr>
  <tr>
    <td>District of Columbia</td>
    <td>4.844</td>
    <td>172.1131</td>
    <td>8.95E+000</td>
    <td>1.49E-003</td>
    <td>7.30E-001</td>
    <td>2.60E-003</td>
    <td>1.62E+000</td>
  </tr>
  <tr>
    <td>Florida</td>
    <td>2.694</td>
    <td>175.64105</td>
    <td>6.13E+003</td>
    <td>1.89E-003</td>
    <td>4.73E-001</td>
    <td>2.27E-003</td>
    <td>1.01E+000</td>
  </tr>
  <tr>
    <td>Georgia</td>
    <td>2.119</td>
    <td>172.1131</td>
    <td>1.06E+003</td>
    <td>1.63E-003</td>
    <td>4.00E-001</td>
    <td>2.85E-003</td>
    <td>1.12E+000</td>
  </tr>
  <tr>
    <td>Hawaii</td>
    <td>2.95</td>
    <td>209.40848</td>
    <td>1.18E+002</td>
    <td>2.70E-003</td>
    <td>7.28E-001</td>
    <td>2.31E-003</td>
    <td>5.44E-001</td>
  </tr>
  <tr>
    <td>Idaho</td>
    <td>0.213</td>
    <td>3.52794</td>
    <td>0</td>
    <td>1.01E-003</td>
    <td>1.07E-002</td>
    <td>4.16E-004</td>
    <td>1.06E-002</td>
  </tr>
  <tr>
    <td>Illinois</td>
    <td>1.694</td>
    <td>146.66153</td>
    <td>1.85E+003</td>
    <td>1.03E-003</td>
    <td>4.42E-001</td>
    <td>2.27E-003</td>
    <td>1.12E+000</td>
  </tr>
  <tr>
    <td>Indiana</td>
    <td>3.281</td>
    <td>261.5716</td>
    <td>2.14E+003</td>
    <td>1.80E-003</td>
    <td>7.30E-001</td>
    <td>4.07E-003</td>
    <td>1.89E+000</td>
  </tr>
  <tr>
    <td>Iowa</td>
    <td>3.033</td>
    <td>237.12801</td>
    <td>7.58E+002</td>
    <td>1.74E-003</td>
    <td>5.61E-001</td>
    <td>3.75E-003</td>
    <td>1.05E+000</td>
  </tr>
  <tr>
    <td>Kansas</td>
    <td>2.826</td>
    <td>212.18043</td>
    <td>8.66E+002</td>
    <td>1.41E-003</td>
    <td>5.59E-001</td>
    <td>3.20E-003</td>
    <td>7.07E-001</td>
  </tr>
  <tr>
    <td>Kentucky</td>
    <td>3.234</td>
    <td>253.00374</td>
    <td>1.51E+003</td>
    <td>1.76E-003</td>
    <td>8.41E-001</td>
    <td>4.04E-003</td>
    <td>1.79E+000</td>
  </tr>
  <tr>
    <td>Lousiana</td>
    <td>2.624</td>
    <td>148.4255</td>
    <td>1.68E+004</td>
    <td>1.18E-003</td>
    <td>3.42E-001</td>
    <td>1.41E-003</td>
    <td>5.06E-001</td>
  </tr>
  <tr>
    <td>Maine</td>
    <td>2.191</td>
    <td>107.35019</td>
    <td>4.93E+002</td>
    <td>7.12E-003</td>
    <td>1.80E-001</td>
    <td>3.40E-003</td>
    <td>4.04E-001</td>
  </tr>
  <tr>
    <td>Maryland</td>
    <td>2.277</td>
    <td>172.1131</td>
    <td>4.90E+002</td>
    <td>1.49E-003</td>
    <td>5.38E-001</td>
    <td>2.60E-003</td>
    <td>1.39E+000</td>
  </tr>
  <tr>
    <td>Massachusetts</td>
    <td>2.729</td>
    <td>161.02529</td>
    <td>7.89E+002</td>
    <td>2.19E-003</td>
    <td>2.89E-001</td>
    <td>2.00E-003</td>
    <td>8.01E-001</td>
  </tr>
  <tr>
    <td>Michigan</td>
    <td>2.616</td>
    <td>199.07665</td>
    <td>1.69E+003</td>
    <td>1.84E-003</td>
    <td>4.92E-001</td>
    <td>3.15E-003</td>
    <td>9.77E-001</td>
  </tr>
  <tr>
    <td>Minnesota</td>
    <td>2.331</td>
    <td>163.04126</td>
    <td>6.96E+002</td>
    <td>1.66E-003</td>
    <td>5.02E-001</td>
    <td>2.08E-003</td>
    <td>5.07E-001</td>
  </tr>
  <tr>
    <td>Mississippi</td>
    <td>2.404</td>
    <td>231.8361</td>
    <td>2.18E+003</td>
    <td>1.59E-003</td>
    <td>4.67E-001</td>
    <td>3.63E-003</td>
    <td>8.98E-001</td>
  </tr>
  <tr>
    <td>Missouri</td>
    <td>2.857</td>
    <td>192.02077</td>
    <td>1.30E+003</td>
    <td>1.98E-003</td>
    <td>6.42E-001</td>
    <td>3.11E-003</td>
    <td>9.07E-001</td>
  </tr>
  <tr>
    <td>Montana</td>
    <td>1.936</td>
    <td>180.68096</td>
    <td>4.13E+002</td>
    <td>1.36E-003</td>
    <td>3.58E-001</td>
    <td>2.86E-003</td>
    <td>2.01E-001</td>
  </tr>
  <tr>
    <td>Nebraska</td>
    <td>2.195</td>
    <td>176.39703</td>
    <td>4.68E+002</td>
    <td>1.20E-003</td>
    <td>3.94E-001</td>
    <td>2.76E-003</td>
    <td>5.29E-001</td>
  </tr>
  <tr>
    <td>Nevada</td>
    <td>2.615</td>
    <td>191.26478</td>
    <td>3.82E+002</td>
    <td>1.13E-003</td>
    <td>4.02E-001</td>
    <td>2.46E-003</td>
    <td>4.03E-001</td>
  </tr>
  <tr>
    <td>New Hampshire</td>
    <td>1.394</td>
    <td>85.93055</td>
    <td>2.64E+002</td>
    <td>2.17E-003</td>
    <td>2.03E-001</td>
    <td>1.78E-003</td>
    <td>8.71E-001</td>
  </tr>
  <tr>
    <td>New Jersey</td>
    <td>1.451</td>
    <td>88.9545</td>
    <td>2.27E+003</td>
    <td>9.70E-004</td>
    <td>1.77E-001</td>
    <td>9.95E-004</td>
    <td>2.31E-001</td>
  </tr>
  <tr>
    <td>New Mexico</td>
    <td>3.307</td>
    <td>254.26372</td>
    <td>8.56E+002</td>
    <td>1.65E-003</td>
    <td>6.58E-001</td>
    <td>3.73E-003</td>
    <td>5.70E-001</td>
  </tr>
  <tr>
    <td>New York</td>
    <td>1.808</td>
    <td>108.10618</td>
    <td>1.94E+003</td>
    <td>1.02E-003</td>
    <td>1.69E-001</td>
    <td>1.12E-003</td>
    <td>4.68E-001</td>
  </tr>
  <tr>
    <td>North Carolina</td>
    <td>1.969</td>
    <td>156.48937</td>
    <td>1.10E+003</td>
    <td>1.32E-003</td>
    <td>4.69E-001</td>
    <td>2.56E-003</td>
    <td>1.00E+000</td>
  </tr>
  <tr>
    <td>North Dakota</td>
    <td>3.244</td>
    <td>282.48725</td>
    <td>9.01E+002</td>
    <td>1.85E-003</td>
    <td>6.45E-001</td>
    <td>4.27E-003</td>
    <td>1.53E+000</td>
  </tr>
  <tr>
    <td>Ohio</td>
    <td>2.736</td>
    <td>226.79619</td>
    <td>1.59E+003</td>
    <td>1.64E-003</td>
    <td>7.68E-001</td>
    <td>3.63E-003</td>
    <td>2.34E+000</td>
  </tr>
  <tr>
    <td>Oklahoma</td>
    <td>3.024</td>
    <td>216.96835</td>
    <td>1.67E+003</td>
    <td>1.39E-003</td>
    <td>5.11E-001</td>
    <td>2.81E-003</td>
    <td>5.11E-001</td>
  </tr>
  <tr>
    <td>Oregon</td>
    <td>0.526</td>
    <td>35.5314</td>
    <td>1.87E+002</td>
    <td>4.16E-004</td>
    <td>5.27E-002</td>
    <td>4.28E-004</td>
    <td>7.51E-002</td>
  </tr>
  <tr>
    <td>Pennsylvania</td>
    <td>1.827</td>
    <td>159.26132</td>
    <td>1.86E+003</td>
    <td>1.35E-003</td>
    <td>3.29E-001</td>
    <td>2.56E-003</td>
    <td>1.26E+000</td>
  </tr>
  <tr>
    <td>Rhode Island</td>
    <td>2.561</td>
    <td>132.54977</td>
    <td>1.68E+002</td>
    <td>8.57E-004</td>
    <td>6.21E-002</td>
    <td>5.92E-004</td>
    <td>4.54E-003</td>
  </tr>
  <tr>
    <td>South Carolina</td>
    <td>1.3</td>
    <td>105.08223</td>
    <td>8.39E+002</td>
    <td>1.15E-003</td>
    <td>2.54E-001</td>
    <td>1.83E-003</td>
    <td>6.05E-001</td>
  </tr>
  <tr>
    <td>South Dakota</td>
    <td>1.192</td>
    <td>100.54631</td>
    <td>9.79E+001</td>
    <td>6.68E-004</td>
    <td>5.45E-001</td>
    <td>1.52E-003</td>
    <td>5.81E-001</td>
  </tr>
  <tr>
    <td>Tennessee</td>
    <td>1.902</td>
    <td>163.29325</td>
    <td>9.10E+002</td>
    <td>1.32E-003</td>
    <td>5.10E-001</td>
    <td>2.67E-003</td>
    <td>1.18E+000</td>
  </tr>
  <tr>
    <td>Texas</td>
    <td>2.749</td>
    <td>184.4609</td>
    <td>9.63E+003</td>
    <td>9.70E-004</td>
    <td>3.28E-001</td>
    <td>1.84E-003</td>
    <td>4.91E-001</td>
  </tr>
  <tr>
    <td>Utah</td>
    <td>3.095</td>
    <td>243.6799</td>
    <td>5.13E+002</td>
    <td>1.69E-003</td>
    <td>5.27E-001</td>
    <td>3.88E-003</td>
    <td>2.13E-001</td>
  </tr>
  <tr>
    <td>Vermont</td>
    <td>0.306</td>
    <td>3.52794</td>
    <td>1.38E+002</td>
    <td>1.21E-003</td>
    <td>1.94E-002</td>
    <td>4.91E-004</td>
    <td>2.14E-003</td>
  </tr>
  <tr>
    <td>Virginia</td>
    <td>1.924</td>
    <td>146.66153</td>
    <td>9.13E+002</td>
    <td>1.73E-003</td>
    <td>3.65E-001</td>
    <td>2.42E-003</td>
    <td>7.87E-001</td>
  </tr>
  <tr>
    <td>Washington</td>
    <td>0.414</td>
    <td>30.99548</td>
    <td>4.30E+002</td>
    <td>4.66E-004</td>
    <td>5.30E-002</td>
    <td>5.04E-004</td>
    <td>1.90E-001</td>
  </tr>
  <tr>
    <td>West Virginia</td>
    <td>2.917</td>
    <td>248.97181</td>
    <td>1.28E+003</td>
    <td>1.73E-003</td>
    <td>7.78E-001</td>
    <td>3.98E-003</td>
    <td>1.87E+000</td>
  </tr>
  <tr>
    <td>Wisconsin</td>
    <td>2.68</td>
    <td>206.88852</td>
    <td>1.00E+003</td>
    <td>1.74E-003</td>
    <td>4.97E-001</td>
    <td>3.28E-003</td>
    <td>9.25E-001</td>
  </tr>
  <tr>
    <td>Wyoming</td>
    <td>3.534</td>
    <td>270.39145</td>
    <td>9.01E+002</td>
    <td>1.85E-003</td>
    <td>5.59E-001</td>
    <td>4.26E-003</td>
    <td>5.79E-001</td>
  </tr>
  <tr>
    <td colspan="8">a Data based on 1999 data from eGRID version 2.01 (EPA 2003a).</td>
  </tr>
  <tr>
    <td colspan="8">b Data based on 1998-2000 average data in DOE (2002).</td>
  </tr>
  <tr>
    <td colspan="8">c Data based on tier emissions report for criteria air pollutants in EPA (2003b).</td>
  </tr>
  <tr>
    <td colspan="8">d PM is the sum of all particulate matter including PM10 and PM2.5. PM10 and PM2.5 stand for particles smaller than 10 and 2.5 microns, respectively.</td>
  </tr>
  <tr>
    <td colspan="8">e No data.</td>
  </tr>
</table>

Table 103.  U. S. State Average Criteria Pollutant Emission Factors for Electricity Generation, in g/MJ

<table class="table table-striped">
<tr>
<th> </th>
<th>Particulate Matter (PM)<sup>cd</sup></th>
<th>Particulate Matter (PM10)<sup>cd</sup></th>
<th>Particulate Matter (PM2.5)<sup>cd</sup></th>
<th>Ammonia (NH<sub>3</sub>)<sup>c</sup></th>
<th>Volatile Organic Compounds (NMVOC)<sup>a</sup></th>
<th>Mercury (Hg)<sup>c</sup></th>
<th>Lead (Pb)<sup>e</sup></th>
</tr>
<tr>
<td>Alabama</td>
<td>7.91048E-03</td>
<td>7.86328E-03</td>
<td>4.72023E-05</td>
<td>3.55049E-05</td>
<td>4.66784E-03</td>
<td>5.14071E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Alaska</td>
<td>8.96502E-03</td>
<td>8.85977E-03</td>
<td>1.05247E-04</td>
<td>6.51454E-06</td>
<td>2.82297E-03</td>
<td>3.27594E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Arizona</td>
<td>1.70555E-02</td>
<td>1.69322E-02</td>
<td>1.23202E-04</td>
<td>1.80226E-04</td>
<td>2.27385E-03</td>
<td>1.88997E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Arkansas</td>
<td>9.27803E-03</td>
<td>9.19307E-03</td>
<td>8.49561E-05</td>
<td>4.59383E-04</td>
<td>3.46429E-03</td>
<td>2.73415E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>California</td>
<td>7.16813E-03</td>
<td>7.07819E-03</td>
<td>8.99402E-05</td>
<td>4.02651E-03</td>
<td>2.62453E-03</td>
<td>1.38598E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Colorado</td>
<td>7.29822E-03</td>
<td>7.23699E-03</td>
<td>6.12291E-05</td>
<td>9.56430E-05</td>
<td>4.36770E-03</td>
<td>1.62537E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Connecticut</td>
<td>1.22734E-02</td>
<td>1.21694E-02</td>
<td>1.04033E-04</td>
<td>2.22944E-03</td>
<td>3.93896E-03</td>
<td>1.18438E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Delaware</td>
<td>1.39283E-02</td>
<td>1.38287E-02</td>
<td>9.96131E-05</td>
<td>1.54469E-03</td>
<td>4.74441E-03</td>
<td>3.62874E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>District of Columbia</td>
<td>2.88269E-02</td>
<td>2.84861E-02</td>
<td>3.40760E-04</td>
<td>8.76496E-03</td>
<td>2.30080E-02</td>
<td>0</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Florida</td>
<td>4.33040E-02</td>
<td>4.29055E-02</td>
<td>3.98460E-04</td>
<td>1.58386E-03</td>
<td>3.39110E-03</td>
<td>1.71357E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Georgia</td>
<td>2.05237E-02</td>
<td>2.03865E-02</td>
<td>1.37175E-04</td>
<td>7.51637E-05</td>
<td>2.16686E-03</td>
<td>3.20035E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Hawaii</td>
<td>5.97339E-03</td>
<td>5.90409E-03</td>
<td>6.92999E-05</td>
<td>3.55697E-03</td>
<td>7.01715E-03</td>
<td>1.77657E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Idaho</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>Illinois</td>
<td>1.53276E-01</td>
<td>1.52156E-01</td>
<td>1.12047E-03</td>
<td>5.93583E-03</td>
<td>2.77818E-02</td>
<td>4.62412E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Indiana</td>
<td>2.18862E-02</td>
<td>2.17008E-02</td>
<td>1.85453E-04</td>
<td>5.75861E-04</td>
<td>4.87283E-03</td>
<td>4.86352E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Iowa</td>
<td>2.34564E-02</td>
<td>2.32698E-02</td>
<td>1.86674E-04</td>
<td>9.09228E-05</td>
<td>4.78644E-03</td>
<td>6.19910E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Kansas</td>
<td>2.41783E-02</td>
<td>2.39535E-02</td>
<td>2.24799E-04</td>
<td>4.19292E-04</td>
<td>5.39089E-03</td>
<td>4.93912E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Kentucky</td>
<td>1.69397E-02</td>
<td>1.68139E-02</td>
<td>1.25825E-04</td>
<td>4.35029E-05</td>
<td>3.80922E-03</td>
<td>4.71232E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Lousiana</td>
<td>1.79917E-02</td>
<td>1.77843E-02</td>
<td>2.07304E-04</td>
<td>1.66720E-03</td>
<td>1.02357E-02</td>
<td>1.41118E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Maine</td>
<td>3.36399E-03</td>
<td>3.34131E-03</td>
<td>2.26813E-05</td>
<td>1.55132E-03</td>
<td>9.62614E-03</td>
<td>4.53592E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Maryland</td>
<td>2.13382E-02</td>
<td>2.12038E-02</td>
<td>1.34391E-04</td>
<td>7.21581E-04</td>
<td>2.78881E-03</td>
<td>4.88872E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Mass-achusetts</td>
<td>8.85244E-03</td>
<td>8.76617E-03</td>
<td>8.62772E-05</td>
<td>1.70282E-03</td>
<td>3.49171E-03</td>
<td>1.88997E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Michigan</td>
<td>9.08755E-03</td>
<td>9.00520E-03</td>
<td>8.23449E-05</td>
<td>2.22140E-04</td>
<td>2.79017E-03</td>
<td>3.67914E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Minnesota</td>
<td>4.04781E-02</td>
<td>4.01455E-02</td>
<td>3.32617E-04</td>
<td>6.74889E-05</td>
<td>4.13240E-03</td>
<td>3.30114E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Mississippi</td>
<td>5.44446E-02</td>
<td>5.37910E-02</td>
<td>6.53601E-04</td>
<td>4.06289E-02</td>
<td>1.54329E-02</td>
<td>2.45696E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Missouri</td>
<td>1.25537E-02</td>
<td>1.24368E-02</td>
<td>1.16929E-04</td>
<td>6.48638E-05</td>
<td>4.98085E-03</td>
<td>4.67452E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Montana</td>
<td>3.67504E-03</td>
<td>3.64126E-03</td>
<td>3.37798E-05</td>
<td>4.01020E-05</td>
<td>3.14400E-03</td>
<td>3.77994E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Nebraska</td>
<td>1.33751E-02</td>
<td>1.32829E-02</td>
<td>9.21636E-05</td>
<td>6.90470E-05</td>
<td>5.23031E-03</td>
<td>3.59094E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Nevada</td>
<td>2.09146E-02</td>
<td>2.07657E-02</td>
<td>1.48886E-04</td>
<td>3.79659E-04</td>
<td>3.33440E-03</td>
<td>1.36078E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>New Hampshire</td>
<td>3.09503E-02</td>
<td>3.06487E-02</td>
<td>3.01568E-04</td>
<td>7.16019E-04</td>
<td>2.45937E-03</td>
<td>3.40194E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>New Jersey</td>
<td>3.45712E-02</td>
<td>3.41460E-02</td>
<td>4.25200E-04</td>
<td>1.24216E-04</td>
<td>1.52830E-02</td>
<td>1.28518E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>New Mexico</td>
<td>5.20754E-02</td>
<td>5.16748E-02</td>
<td>4.00653E-04</td>
<td>4.41665E-04</td>
<td>5.12951E-03</td>
<td>8.41666E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>New York</td>
<td>5.35802E-03</td>
<td>5.31301E-03</td>
<td>4.50068E-05</td>
<td>2.22325E-03</td>
<td>4.26008E-03</td>
<td>1.33558E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>North Carolina</td>
<td>3.40955E-02</td>
<td>3.38325E-02</td>
<td>2.62976E-04</td>
<td>3.00504E-05</td>
<td>1.73434E-03</td>
<td>3.33894E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>North Dakota</td>
<td>5.17162E-02</td>
<td>5.13979E-02</td>
<td>3.18277E-04</td>
<td>6.41672E-05</td>
<td>6.88995E-03</td>
<td>8.71905E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Ohio</td>
<td>1.38722E-02</td>
<td>1.37957E-02</td>
<td>7.64501E-05</td>
<td>1.11541E-04</td>
<td>2.59201E-03</td>
<td>6.24949E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Oklahoma</td>
<td>1.83971E-02</td>
<td>1.82479E-02</td>
<td>1.49160E-04</td>
<td>9.73713E-04</td>
<td>4.68484E-03</td>
<td>3.88073E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Oregon</td>
<td>3.47911E-03</td>
<td>3.46199E-03</td>
<td>1.71186E-05</td>
<td>4.43277E-06</td>
<td>5.31933E-04</td>
<td>3.77994E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Pennsylvania</td>
<td>2.21604E-02</td>
<td>2.20060E-02</td>
<td>1.54356E-04</td>
<td>1.47657E-04</td>
<td>1.51542E-03</td>
<td>6.56449E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Rhode Island</td>
<td>1.03973E-03</td>
<td>1.02744E-03</td>
<td>1.22906E-05</td>
<td>0</td>
<td>2.25247E-03</td>
<td>0</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>South Carolina</td>
<td>2.45530E-02</td>
<td>2.43803E-02</td>
<td>1.72632E-04</td>
<td>2.51344E-05</td>
<td>1.16735E-03</td>
<td>1.54977E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>South Dakota</td>
<td>4.67825E-03</td>
<td>4.63562E-03</td>
<td>4.26239E-05</td>
<td>8.82976E-05</td>
<td>4.63562E-03</td>
<td>1.22218E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Tennessee</td>
<td>2.51650E-02</td>
<td>2.48944E-02</td>
<td>2.70575E-04</td>
<td>2.70034E-05</td>
<td>2.88396E-03</td>
<td>2.98615E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Texas</td>
<td>1.73147E-02</td>
<td>1.71765E-02</td>
<td>1.38283E-04</td>
<td>1.26310E-03</td>
<td>4.32150E-03</td>
<td>3.52794E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Utah</td>
<td>1.47314E-02</td>
<td>1.46364E-02</td>
<td>9.50155E-05</td>
<td>9.59315E-05</td>
<td>2.48737E-03</td>
<td>9.70184E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Vermont</td>
<td>1.16247E-03</td>
<td>1.14873E-03</td>
<td>1.37415E-05</td>
<td>1.80704E-05</td>
<td>2.12073E-03</td>
<td>0</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Virginia</td>
<td>1.22315E-02</td>
<td>1.21362E-02</td>
<td>9.53635E-05</td>
<td>2.93259E-04</td>
<td>2.50975E-03</td>
<td>2.21756E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Washington</td>
<td>5.37627E-04</td>
<td>5.32210E-04</td>
<td>5.41708E-06</td>
<td>6.46409E-06</td>
<td>6.87348E-04</td>
<td>5.92190E-07</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>West Virginia</td>
<td>2.39677E-03</td>
<td>2.38177E-03</td>
<td>1.50018E-05</td>
<td>4.25792E-05</td>
<td>3.09497E-03</td>
<td>6.55189E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Wisconsin</td>
<td>7.34187E-03</td>
<td>7.28252E-03</td>
<td>5.93472E-05</td>
<td>6.45613E-05</td>
<td>4.61829E-03</td>
<td>4.83832E-06</td>
<td>0<sup>e</sup></td>
</tr>
<tr>
<td>Wyoming</td>
<td>5.08215E-02</td>
<td>5.06042E-02</td>
<td>2.17349E-04</td>
<td>5.19787E-05</td>
<td>4.78782E-03</td>
<td>5.27931E-06</td>
<td>0<sup>e</sup></td>
</tr>
</table>

Table 104.  United States National Average Water Consumption Factors<sup>a</sup>

<table class="table table-striped">
 <tr>
  <th></th>
  <th colspan="2">ThermoElectric Generation</th>
  <th colspan="2">HydroElectric Generation</th>
  <th>Weighted Total Water Consumption</th>
 </tr>
 <tr>
  <th></th>
  <th>L/MJ</th>
  <th>Percent of Total Generation</th>
  <th>L/MJ</th>
  <th>Percent of Total Generation</th>
  <th>L/MJ</th>
 </tr>
 <tr>
  <th>United States</th>
  <td>0.4960</td>
  <td>89.4%</td>
  <td>19.2095</td>
  <td>8.6%</td>
  <td>2.1007</td>
 </tr>
 <tr>
  <td colspan="6">a Based on data from Torcellini, Long, and Judkoff (2004).</td>
 </tr>
</table>

Table 105.   U.S. State Average Water Consumption Factors for Electricity Generation<sup>a</sup>

<table class="table table-striped">
  <tr>
    <th></th>
    <th colspan="2">ThermoElectric Generation</th>
    <th colspan="2">HydroElectric Generation</th>
    <th>Weighted Total Water Consumption</th>
  </tr>
  <tr>
    <th>State</th>
    <th>L/MJ</th>
    <th>Percent of Total Generation</th>
    <th>L/MJ</th>
    <th>Percent of Total Generation</th>
    <th>L/MJ</th>
  </tr>
  <tr>
    <td>Alabama</td>
    <td>0.1503</td>
    <td>89.80%</td>
    <td>38.9053</td>
    <td>6.4%</td>
    <td>2.6274</td>
  </tr>
  <tr>
    <td>Alaska</td>
    <td>0.3295</td>
    <td>86.20%</td>
    <td>--</td>
    <td>13.8%</td>
    <td>0.2839</td>
  </tr>
  <tr>
    <td>Arizona</td>
    <td>0.3313</td>
    <td>88.30%</td>
    <td>68.1928</td>
    <td>11.7%</td>
    <td>8.2533</td>
  </tr>
  <tr>
    <td>Arkansas</td>
    <td>0.3</td>
    <td>89.50%</td>
    <td>--</td>
    <td>5.7%</td>
    <td>0.2684</td>
  </tr>
  <tr>
    <td>California</td>
    <td>0.0511</td>
    <td>74.10%</td>
    <td>21.943</td>
    <td>22.0%</td>
    <td>4.8739</td>
  </tr>
  <tr>
    <td>Colorado</td>
    <td>0.5368</td>
    <td>96.00%</td>
    <td>18.8333</td>
    <td>4.0%</td>
    <td>1.26</td>
  </tr>
  <tr>
    <td>Connecticut</td>
    <td>0.086</td>
    <td>90.80%</td>
    <td>--</td>
    <td>1.5%</td>
    <td>0.0781</td>
  </tr>
  <tr>
    <td>Delaware</td>
    <td>0.0132</td>
    <td>99.90%</td>
    <td>--</td>
    <td>0.0%</td>
    <td>0.0132</td>
  </tr>
  <tr>
    <td>District of Columbia</td>
    <td>1.6959</td>
    <td>100.00%</td>
    <td>--</td>
    <td>0.0%</td>
    <td>1.6959</td>
  </tr>
  <tr>
    <td>Florida</td>
    <td>0.1506</td>
    <td>95.70%</td>
    <td>--</td>
    <td>0.1%</td>
    <td>0.1441</td>
  </tr>
  <tr>
    <td>Georgia</td>
    <td>0.6267</td>
    <td>93.60%</td>
    <td>49.8599</td>
    <td>2.3%</td>
    <td>1.7339</td>
  </tr>
  <tr>
    <td>Hawaii</td>
    <td>0.044</td>
    <td>92.40%</td>
    <td>--</td>
    <td>1.1%</td>
    <td>0.0407</td>
  </tr>
  <tr>
    <td>Idaho</td>
    <td>0</td>
    <td>2.70%</td>
    <td>8.9528</td>
    <td>92.2%</td>
    <td>8.2501</td>
  </tr>
  <tr>
    <td>Illinois</td>
    <td>1.1093</td>
    <td>99.40%</td>
    <td>--</td>
    <td>0.1%</td>
    <td>1.1032</td>
  </tr>
  <tr>
    <td>Indiana</td>
    <td>0.435</td>
    <td>99.60%</td>
    <td>--</td>
    <td>0.3%</td>
    <td>0.4331</td>
  </tr>
  <tr>
    <td>Iowa</td>
    <td>0.1229</td>
    <td>97.30%</td>
    <td>--</td>
    <td>2.5%</td>
    <td>0.1196</td>
  </tr>
  <tr>
    <td>Kansas</td>
    <td>0.6099</td>
    <td>100.00%</td>
    <td>--</td>
    <td>0.0%</td>
    <td>0.6098</td>
  </tr>
  <tr>
    <td>Kentucky</td>
    <td>1.1521</td>
    <td>97.20%</td>
    <td>162.2884</td>
    <td>2.8%</td>
    <td>5.599</td>
  </tr>
  <tr>
    <td>Louisiana</td>
    <td>1.6411</td>
    <td>94.20%</td>
    <td>--</td>
    <td>0.9%</td>
    <td>1.5461</td>
  </tr>
  <tr>
    <td>Maine</td>
    <td>0.3049</td>
    <td>40.40%</td>
    <td>--</td>
    <td>28.7%</td>
    <td>0.1231</td>
  </tr>
  <tr>
    <td>Maryland</td>
    <td>0.0343</td>
    <td>95.30%</td>
    <td>7.0617</td>
    <td>2.7%</td>
    <td>0.2259</td>
  </tr>
  <tr>
    <td>Massachusetts</td>
    <td>0</td>
    <td>92.40%</td>
    <td>--</td>
    <td>2.4%</td>
    <td>0</td>
  </tr>
  <tr>
    <td>Michigan</td>
    <td>0.5221</td>
    <td>95.80%</td>
    <td>--</td>
    <td>1.4%</td>
    <td>0.4999</td>
  </tr>
  <tr>
    <td>Minnesota</td>
    <td>0.4657</td>
    <td>93.40%</td>
    <td>--</td>
    <td>2.4%</td>
    <td>0.4351</td>
  </tr>
  <tr>
    <td>Mississippi</td>
    <td>0.4145</td>
    <td>94.40%</td>
    <td>--</td>
    <td>0.0%</td>
    <td>0.3912</td>
  </tr>
  <tr>
    <td>Missouri</td>
    <td>0.3213</td>
    <td>97.40%</td>
    <td>--</td>
    <td>2.5%</td>
    <td>0.313</td>
  </tr>
  <tr>
    <td>Montana</td>
    <td>1.0051</td>
    <td>55.80%</td>
    <td>38.6619</td>
    <td>44.1%</td>
    <td>17.5997</td>
  </tr>
  <tr>
    <td>Nebraska</td>
    <td>0.202</td>
    <td>94.50%</td>
    <td>2.2888</td>
    <td>5.5%</td>
    <td>0.3165</td>
  </tr>
  <tr>
    <td>Nevada</td>
    <td>0.5936</td>
    <td>90.60%</td>
    <td>77.1023</td>
    <td>9.2%</td>
    <td>7.626</td>
  </tr>
  <tr>
    <td>New Hampshire</td>
    <td>0.1231</td>
    <td>83.90%</td>
    <td>--</td>
    <td>8.6%</td>
    <td>0.1033</td>
  </tr>
  <tr>
    <td>New Jersey</td>
    <td>0.0747</td>
    <td>97.60%</td>
    <td>--</td>
    <td>0.0%</td>
    <td>0.0729</td>
  </tr>
  <tr>
    <td>New Mexico</td>
    <td>0.6609</td>
    <td>99.30%</td>
    <td>71.507</td>
    <td>0.7%</td>
    <td>1.1886</td>
  </tr>
  <tr>
    <td>New York</td>
    <td>0.8951</td>
    <td>81.30%</td>
    <td>5.8535</td>
    <td>16.7%</td>
    <td>1.704</td>
  </tr>
  <tr>
    <td>North Carolina</td>
    <td>0.2445</td>
    <td>95.50%</td>
    <td>10.9089</td>
    <td>3.1%</td>
    <td>0.5751</td>
  </tr>
  <tr>
    <td>North Dakota</td>
    <td>0.3809</td>
    <td>91.70%</td>
    <td>60.773</td>
    <td>8.3%</td>
    <td>5.3968</td>
  </tr>
  <tr>
    <td>Ohio</td>
    <td>0.9972</td>
    <td>99.10%</td>
    <td>--</td>
    <td>0.3%</td>
    <td>0.9884</td>
  </tr>
  <tr>
    <td>Oklahoma</td>
    <td>0.5378</td>
    <td>93.70%</td>
    <td>144.0133</td>
    <td>5.8%</td>
    <td>8.8254</td>
  </tr>
  <tr>
    <td>Oregon</td>
    <td>0.8633</td>
    <td>18.40%</td>
    <td>4.6351</td>
    <td>80.7%</td>
    <td>3.899</td>
  </tr>
  <tr>
    <td>Pennsylvania</td>
    <td>0.57</td>
    <td>97.60%</td>
    <td>--</td>
    <td>1.0%</td>
    <td>0.5563</td>
  </tr>
  <tr>
    <td>Rhode Island</td>
    <td>0</td>
    <td>98.20%</td>
    <td>--</td>
    <td>0.1%</td>
    <td>0</td>
  </tr>
  <tr>
    <td>South Carolina</td>
    <td>0.2754</td>
    <td>97.20%</td>
    <td>--</td>
    <td>1.9%</td>
    <td>0.2677</td>
  </tr>
  <tr>
    <td>South Dakota</td>
    <td>0.0143</td>
    <td>36.70%</td>
    <td>120.7558</td>
    <td>63.2%</td>
    <td>76.3811</td>
  </tr>
  <tr>
    <td>Tennessee</td>
    <td>0.0026</td>
    <td>90.80%</td>
    <td>45.5853</td>
    <td>8.3%</td>
    <td>3.7833</td>
  </tr>
  <tr>
    <td>Texas</td>
    <td>0.4595</td>
    <td>99.00%</td>
    <td>--</td>
    <td>0.3%</td>
    <td>0.455</td>
  </tr>
  <tr>
    <td>Utah</td>
    <td>0.5959</td>
    <td>96.60%</td>
    <td>77.115</td>
    <td>3.4%</td>
    <td>3.209</td>
  </tr>
  <tr>
    <td>Vermont</td>
    <td>0.3642</td>
    <td>71.50%</td>
    <td>--</td>
    <td>20.9%</td>
    <td>0.2605</td>
  </tr>
  <tr>
    <td>Virginia</td>
    <td>0.0693</td>
    <td>94.90%</td>
    <td>--</td>
    <td>0.9%</td>
    <td>0.0657</td>
  </tr>
  <tr>
    <td>Washington</td>
    <td>0.3013</td>
    <td>15.70%</td>
    <td>3.3506</td>
    <td>83.2%</td>
    <td>2.8344</td>
  </tr>
  <tr>
    <td>West Virginia</td>
    <td>0.618</td>
    <td>99.00%</td>
    <td>--</td>
    <td>1.0%</td>
    <td>0.6119</td>
  </tr>
  <tr>
    <td>Wisconsin</td>
    <td>0.5199</td>
    <td>93.60%</td>
    <td>--</td>
    <td>3.3%</td>
    <td>0.4867</td>
  </tr>
  <tr>
    <td>Wyoming</td>
    <td>0.519</td>
    <td>97.10%</td>
    <td>144.0177</td>
    <td>2.7%</td>
    <td>4.3654</td>
  </tr>
  <tr>
    <td colspan="6">a Based on data from Torcellini, Long, and Judkoff (2004).</td>
  </tr>
</table>


### Other Energy-Related Pollutants and Sources of Other Information

EnergyPlus (with user entered-data) will also calculate high- and low-level nuclear waste from electricity generation. Few utilities now provide data on nuclear waste resulting from electricity generation and no US national or state-level data are yet available (this will be added as data become available).  Two Illinois utilities regularly report nuclear waste in terms of pounds per kWh or MWh for high-level waste and cubic feet per kWh or MWh for low-level waste.  For these two utilities, high level nuclear waste values range from 0.0042 to 0.01 lb/MWh (7000 to 16000 g/MJ); low-level nuclear waste ranges from 0.0001 to 0.0002 ft<sup>3</sup>/MWh (0.01 to 0.02 m<sup>3</sup>/MJ) depending on relative proportion of nuclear as compared with other electricity generation sources.

IEA (2003) contains carbon dioxide (CO<sub>2</sub>) emissions factors for electricity generation by country and region. Carbon dioxide (CO<sub>2</sub>) is responsible for over 60% of the anthropogenic greenhouse effect (UNEP 2002). Because only limited greenhouse gas emissions factors and data (other than CO<sub>2</sub>) is available for other countries, an interim method for estimating emission factors would be to compare the CO<sub>2</sub> emission factor for the particular country from IEA (2003) and match it to the state with the closest CO<sub>2</sub> emission factor in Table 102—using the other emissions factors for that state. Since the Kyoto Protocol (UNFCCC 1997) requires each country to report emissions of the major greenhouse gases [carbon dioxide (CO<sub>2</sub>), methane (CH<sub>4</sub>), and nitrous oxide (N<sub>2</sub>O)] as well as ozone-depleting substances [hydrofluorocarbons (HFC), perfluorocarbons (PFC), and sulphur hexafluoride (SF<sub>6</sub>)] and all energy consumption in their annual ‘national communication’, more complete emission factors for a larger number of countries should become available over the next few years. More information and other resources for calculating emissions factors are available in IPCC (2000, 1997).

### References

Crawley, Drury B.  2003.  “Impact of Climate Change on Buildings,” in *Proceedings of the CIBSE/ASHRAE International Conference 2003*, September 2003, Edinburgh, Scotland.  London, England: CIBSE.

Intergovernmental Panel on Climate Change.  2001.  *Climate Change 2001: The Scientific Basis*.  Cambridge: Cambridge University Press.

Intergovernmental Panel on Climate Change. 2000. *Good Practice Guidance and Uncertainty Management in National Greenhouse Gas Inventories*, Paris, France: IPCC/OECD/IEA.

Intergovernmental Panel on Climate Change. 1997. *Revised 1996 IPCC Guidelines for National Greenhouse Gas Inventories*, J.T. Houghton, L.G. Meira Filho, B. Lim, K. Treanton, I. Mamaty, Y. Bonduki, D.J. Griggs and B.A. Callender (editors).  Paris, France: IPCC/OECD/IEA.

International Energy Agency.  2003. *CO<sub>2</sub> Emissions from Fuel Combustion 1971-2001 (2003) -- 2003 Edition*.  Paris, France: IEA.

Liesen, Richard J. 1997. *Atmospheric Pollution Prediction in a Building Energy Simulation Program*, April 1997, BLAST Support Office, Department of Mechanical Engineering. Champaign, Illinois: University of Illinois.

Stroot, Peter J., Robert J. Nemeth, & Donald F. Fournier.  1996.  *Pollution Reduction Through Energy Conservation, REEP Model*.  Champaign, Illinois: U S Army Construction Engineering Research Laboratory.

Torcellini Paul A, Nicholas Long, and Ronald D. Judkoff.  2004. “Consumptive Water Use for U.S. Power Production,” in *ASHRAE Transactions,* Volume 110, Part 1. Atlanta, Georgia: ASHRAE.

United Nations Environment Programme.  2002.  *Climate Change Information Kit*.  Châtelaine, Switzerland: UNEP.

United Nations Framework Convention on Climate Change.  1997. *Kyoto* *Protocol to the United Nations Framework Convention on Climate Change.*  Bonn, Germany: UNFCCC.

U.S. Department of Energy.  2004. *Monthly Energy Review*. Washington, DC:  Energy Information Administration, U S Department of Energy.

U.S. Department of Energy.  2002. *Updated State-level Greenhouse Gas Emission Coefficients for Electricity Generation 1998-2000*.  April 2002, Energy Information Administration, Office of Integrated Analysis and Forecasting, Energy Information Administration.  Washington, DC: U.S. Department of Energy.

U.S. Environmental Protection Agency.  2003a. *eGRID Emissions and Generation Resource Integrated Database*, May 2003, Washington, DC:  U.S. Environmental Protection Agency.

U.S. Environmental Protection Agency.  2003b. *AirData,* Tier Emissions Report - Criteria Air Pollutants, 1999 data, May 2003. Washington, DC:  U.S. Environmental Protection Agency.

U.S. Environmental Protection Agency.  1998a. *Compilation of Air Pollutant Emission Factors, AP-42, Fifth Edition, Volume I: Stationary Point and Area Sources*, Chapter 1 External Combustion Sources, Supplement D, July 1998. Research Triangle Park, North Carolina: U. S. Environmental Protection Agency.

U.S. Environmental Protection Agency.  1998b. *Compilation of Air Pollutant Emission Factors, AP-42, Fifth Edition, Volume I: Stationary Point and Area Sources,* Chapter 1 External Combustion Sources, Supplement E, September 1998. Research Triangle Park, North Carolina: U. S. Environmental Protection Agency.

U.S. Environmental Protection Agency.  1996. *Compilation of Air Pollutant Emission Factors, AP-42, Fifth Edition, Volume I: Stationary Point and Area Sources,* Chapter 1 External Combustion Sources, Supplement B, October 1996. Research Triangle Park, North Carolina: U. S. Environmental Protection Agency.

Zone Component Loads Summary
----------------------------

Many building energy simulation programs provide reports that breakdown the design load into component contributions from  walls, roofs, floors, underground walls, windows, interior walls, infiltration, ventilation, occupancy, lighting, refrigeration cases, and internal equipment. Some of these components have both sensible and latent subcomponents. It is important to understand the difference between gains and loads. ASHRAE Handbook of Fundamentals 2009 describes the space heat gain as “.. the rate at which heat enters into and/or is generated within a space” while the space cooling load is “the rate at which sensible and latent heat must be removed fro the space to maintain a constant space air temperature and humidity.”  The difference is that the radiant heat gains which is “absorbed by walls, floors, furniture, etc., contributed to the space cooling load only after a time lag.”

The heat balance algorithms used by  EnergyPlus result in a single combined design load for a given zone and some, but not all, of the zone instantaneous heat gains. This section describes the estimation procedure for the Zone Component Loads Summary report that shows an estimated breakdown of load components from each type of of heat gain for each zone.

The Estimated Cooling Peak Load Components and Estimated Heating Peak Load Components subtables of the Zone Component Loads Summary report contain values that are estimated and are not part of the normal heat balance algorithms used in the rest of EnergyPlus.  In particular, the column described as Sensible-Delayed represents an estimate of the sensible load contributed at the peak time based on radiant contributions from various load components that have radiant portions in previous timesteps. The focus of this section will be on the Sensible-Delayed column.

The columns labeled Sensible-Instant, Sensible-Return Air, and Latent are directly computed for people, lights, equipment, refrigeration, water use equipment,  HVAC equipment losses, power generation equipment, infiltration, zone ventilation and interzone mixing. For example, Lights objects have inputs for the fractions of the gains that are to return air, radiant, visible and the remainder is convected.  In this case, the fraction to return air is reported in the Sensible Return Air column and the fraction that is convected is reported in the Sensible-Instant column.

At the time of the peak load, each surface in the zone is contributing a convective heat loss or heat gain depending on the inside surface temperature.

The radiant portion of the internal heat gains from lighting, equipment, and incident solar are radiantly transmitted to the surfaces of the zone. The heat from these radiant gains is stored in the surfaces and retransmitted back into the zone over time as convective gains to the zone. By the time the heat is retransmitted, it is impossible to know the contribution of each possible radiant gain from past time steps on that surface into the convective gain for that timestep. The temperature change of the surface includes the impact of all of these radiant gains as well as any heat transfer through the surface.

To disaggregate the delayed affect of zone radiant (delayed) portions of the peak load, a pulse of radiant internal loads is used to determine custom radiant to convective decay curves for heating and cooling, essentially replicating part of the method used for Radiant Time Series (see Chapter 18 of ASHRAE Handbook of Fundamentals 2009) to isolate the delayed impacts of internal loads. This is performed during the zone sizing routines.

The response of each surface to a pulse of radiant heat is used to estimate the peak load components for solar gains and the radiant portion of internal gains. Subtracting these for each surface then leaves the peak load component from conduction through the surfaces. The approach is described in more detail below:

1) When zone sizing is performed for cooling or heating, the heat convected from each opaque surface for each timestep during sizing day is saved to an array.

2) For each type of internal gain, HVAC equipment gain, and solar energy entering the zone, the radiant and convective portions are saved for every timestep during sizing. In addition, for each type of radiant gain, the amount that lands on each surface in the zone is saved for evergy timestep during sizing.

3) An additional "pulse sizing" run is performed for cooling and heating during zone sizing that includes an additional small, single timestep, pulse of radiant-only heat for each zone but is otherwise the same as a normal zone sizing simulation. This is equivalent to adding an ElectricEquipment object that is scheduled for a single timestep and is 100% radiant heat. The heat convected from each opaque surface for each timestep during sizing is saved to an array. This run is not used for sizing, but just to gather the impact of the pulse of radiant heat.

4) For each surface, a "decay curve" is developed by subtracting the results from the normal sizing (1) from the "pulse" sizing run (3). This represents the delay in converting incoming radiant heat into convected heat for each surface in the zone. The graphs below show the decay curves for an exterior wall (RIGHT-1) and an interior wall (SB23) for a test file.

![](EngineeringReference/media/image7912.png)

Figure 343. Load Component - Decay Curve of Exterior Wall



![](EngineeringReference/media/image7913.png)

Figure 344. Load Component - Decay Curve of Interior Wall



5) Using the internal and solar gain results saved from the normal sizing period in step (2), for each timestep prior to and including the time of the peak load during the sizing day, the decay curve is applied to each radiant gain on each surface for each timestep to generate a predicted delayed load component for the internal and solar gains for each timestep that comprise the peak load (based on Timesteps in Averaging Window). Timesteps just before the peak have much larger impacts than those just a few timesteps before the peak.  These results will be the radiant portion of the load for each type of internal and solar gain.

6) The difference between the sum of the predicted convective loads from internal and solar gains from step (5) and the total convective loads for that surface for the timesteps that comprise the peak load from step (1) is assumed to be the load from heat transfer through that surface.  This is essentially subtracting out the radiant portions of the internal and solar gains on each surface for the sizing day.

### Estimated Component Load Details

In HeatBalanceInternalHeatGains, in the InitInternalHeatGains routine, the single timestep pulse is added to the thermal radiation absorbed on the inside surface. It is based on 0.01 W per square meter of the zone area. The time of the pulse and the amount received by each surface is also saved. A new routine GatherComponentLoadsIntGain was also added to that file that gathers the instantenous heat gains from people, lights, equipment, refrigeration equipment, water use, hvac losses, and power generation. Latent gains from people and refrigeration are also gathered along with the radiant portion of the gains from these same sources. EnergyPlus tracks internal gains by type, and these are grouped as follows for the rows of the report:

The gains from “People” contain:

* IntGainTypeOf\_People

The gains from “Lights” contain:

* IntGainTypeOf\_Lights

The gains from “Equipment” contain:

* IntGainTypeOf\_ElectricEquipment

* IntGainTypeOf\_GasEquipment

* IntGainTypeOf\_HotWaterEquipment

* IntGainTypeOf\_SteamEquipment

* IntGainTypeOf\_OtherEquipment

The gains from “Refrigeration” contain:

* IntGainTypeOf\_RefrigerationCase

* IntGainTypeOf\_RefrigerationCompressorRack

* IntGainTypeOf\_RefrigerationSystemAirCooledCondenser

* IntGainTypeOf\_RefrigerationSystemSuctionPipe

* IntGainTypeOf\_RefrigerationSecondaryReceiver

* IntGainTypeOf\_RefrigerationSecondaryPipe

* IntGainTypeOf\_RefrigerationWalkIn

The gains from “Water Use Equipment” contain:

* IntGainTypeOf\_WaterUseEquipment

* IntGainTypeOf\_WaterHeaterMixed

* IntGainTypeOf\_WaterHeaterStratified

The gains from “HVAC Equipment Losses” which are gains to the zone due to the location of the equipment within the zone include:

* IntGainTypeOf\_ZoneBaseboardOutdoorTemperatureControlled

* IntGainTypeOf\_ThermalStorageChilledWaterMixed

* IntGainTypeOf\_ThermalStorageChilledWaterStratified

* IntGainTypeOf\_PipeIndoor

* IntGainTypeOf\_Pump\_VarSpeed

* IntGainTypeOf\_Pump\_ConSpeed

* IntGainTypeOf\_Pump\_Cond

* IntGainTypeOf\_PumpBank\_VarSpeed

* IntGainTypeOf\_PumpBank\_ConSpeed

* IntGainTypeOf\_PlantComponentUserDefined

* IntGainTypeOf\_CoilUserDefined

* IntGainTypeOf\_ZoneHVACForcedAirUserDefined

* IntGainTypeOf\_AirTerminalUserDefined

The gains from “Power Generation Equipment” include:

* IntGainTypeOf\_GeneratorFuelCell

* IntGainTypeOf\_GeneratorMicroCHP

* IntGainTypeOf\_ElectricLoadCenterTransformer

* IntGainTypeOf\_ElectricLoadCenterInverterSimple

* IntGainTypeOf\_ElectricLoadCenterInverterFunctionOfPower

* IntGainTypeOf\_ElectricLoadCenterInverterLookUpTable

* IntGainTypeOf\_ElectricLoadCenterStorageBattery

The ReportSurfaceHeatBalance routine in the HeatBalanceSurfaceManger module gathers the shortwave radiant heat gain from lighting and fenestration solar gains on each surface. In the same module, the CalcHeatBalanceInsideSurf routine gathers the surface by surface convection for both the normal and pulse zone sizing times along with the net radiation on the surface during the normal zone sizing times. In addition, a routine called GatherComponentLoadSurfAbsFact gathers the factors used in distributing the radiant heat from a zone to each surface (TMULT and ITABSF).

The SizingManager module repeats the zone sizing portion of the procedure when this report is requested.  The pulse occurs at 10am during the zone sizing simulations. The 10am time was chosen after some testing that looked at pulses at different times of the day. It is  important that the pulse occurs while the system is running and stable not during start up hours. In addition, the plus timing needs to be early enough that the duration of the resulting decay curve can be appropriate applied to as many timesteps as possible during the peak day.

The following subroutines in the OutputReportTabular module produce the report:

* ComputeLoadComponentDecayCurve

* GatherComponentLoadsSurface

* GatherComonentLoadsHVAC

* ComputeDelayedComponents

* WriteZoneLoadComponentTable



The ComputeLoadComponentDecayCurve routine determines the heating and cooling decay curves using the following (for cooling but repeated also for heating):

```
  TimeOfPulse = radiantPulseTimestep(ZoneNum,CoolDesSelected)
  DO TimeStep = TimeOfPulse, NumOfTimeStepInHour* 24
    IF (radiantPulseReceived(surfNum,CoolDesSelected) .NE. 0.0) THEN
      diff = loadConvectedWithPulse(surfNum,TimeStep,CoolDesSelected)
           - loadConvectedNormal(surfNum,TimeStep,CoolDesSelected)
      decayCurveCool(surfNum, TimeStep - TimeOfPulse + 1) = -diff /
          radiantPulseReceived(surfNum,CoolDesSelected)
    ELSE
      decayCurveCool(surfNum, TimeStep - TimeOfPulse + 1) = 0.0
    END IF
  END DO
```

The ComputeDelayedComponents routine applies the decay curve to the load components. It does the following for the heating and cooling sizing period that was selected and for each zone and each surface in the zone

1. Determine the heat gain on the surface of people, equipment, hvac losses, power generation and long wave light radiation.

2. For each time step backwards from the current timestep, estimate the delayed convected heat from people, equipment, HVAC losses, power generation, lighting long wave radiation, lighting short wave radiation, and fenestration solar by multiplying the decay curve with the value determined from (a).

3. Accumulate the values on a zone basis

4. Determine the remaining convective heat from surfaces that are not from these gains and remove the net surface radiation (output variable Surface Inside Face Convection Heat Gain Rate)

5. Store the estimated values in a sequence to be later averaged over the averaging window.




Operational Faults
===============

### Introduction to Operational Faults Modeling

Most of the buildings, either new or old, have operational faults in the sensors, controllers, meters, equipment and systems. Being able to model and simulate these faults and their impact on energy performance of buildings is crucial to improve accuracy of building simulations and to support the retrofit of buildings. 
To date, the main practitioner use of EnergyPlus has been for new construction design. With the new high priority attached by USDOE to retrofit and improved operation of existing buildings, there is a need to extend the capabilities of EnergyPlus to model existing buildings, including faulty operation:

* Retrofit analysis: starts with calibrated simulation; the ability to estimate the severity of common faults is expected to improve the accuracy and transparency of the calibrated model and hence the increase accuracy of the analysis of different retrofit measures.  
* Commissioning providers can use the fault models to demonstrate the saving to be expected from fixing faults found in retro-commissioning
* Support for building operation by using the calibrated model, including unfixed faults, as a real-time reference model to detect, and verify the diagnosis of, newly occurring faults.

The users in these cases are practitioners, not power users, so it is needed to implement the fault models using conventional EnergyPlus objects rather than the EMS, which, in any case, could only be used to model limited types of faults.   

EnergyPlus contains a number of objects to model operational faults of sensors, meters, equipment and systems. The current implementation allows the modeling of the following fault types: (1) sensor faults with air economizers, (2) thermostat/humidistat offset faults, and (3) heating and cooling coil fouling faults. 

### Sensor Faults with Air Economizers

#### Symptom

The sensor readings deviate from the actual air conditions due to sensor offset, which leads to inappropriate operations of the air economizer and thus undesired resulting indoor conditions.

#### Modeling Approach

There are a number of sensors installed to support the air economizer operations. The sensors may be of different types. The objects used by EnergyPlus to model the sensor faults are as follows:

* FaultModel:TemperatureSensorOffset:OutdoorAir
* FaultModel:HumiditySensorOffset:OutdoorAir
* FaultModel:EnthalpySensorOffset:OutdoorAir
* FaultModel:TemperatureSensorOffset:ReturnAir
* FaultModel:EnthalpySensorOffset:ReturnAir

### Thermostat/Humidistat Offset 

#### Symptom

The zone air temperature/relative humidity readings deviate from the actual zone air conditions due to thermostat/humidistat offset, and thus leads to inappropriate operations of the HVAC system and undesired resulting indoor conditions.

#### Modeling Approach

The thermostat offset fault is described in the object FaultModel:ThermostatOffset, which refers to the object ZoneControl:Thermostat. The humidistat offset fault is described in the object FaultModel:HumidistatOffset, which refers to the object ZoneControl:Humidistat.
The effect of an offset in a thermostat/humidistat whose sole use is for the calculation of difference between the set-points and the design values can be modeled as an equal and opposite offset in the thermostat/humidistat: 

$$T_{s,f} = T_{s,ff}  - \Delta T$$

$$RH_{s,f} = RH_{s,ff}  - \Delta RH$$

Where, 

$T_{s,f}$ thermostat value in the faulty case, C

$T_{s,ff}$ thermostat value in the fault-free case (design value), C

$RH_{s,f}$ humidistat value in the faulty case,

$RH_{s,ff}$ humidistat value in the fault-free case (design value),

$\Delta T / \Delta RH$ difference between the thermostat/humidistat readings and the actual zone air conditions. Positive values mean that the readings is higher than the actual air conditions.

For the humidistat that is independent of the thermostat, $\Delta RH$ can be described by a pre-defined schedule. For the humidistat offset that is caused by the thermostat offset, $\Delta RH$ is related with both the thermostat offset level as well as the indoor air conditions which are dynamic, and therefore cannot be described with a pre-defined schedule. In this case, the humidistat offset level is calculated each time step. 

$$\Delta RH = RH_{s,ff} - f(T_{real}, W_{s,f})$$

Where,

$T_{real}$ real-time temperature of the indoor air (real value), C

$W_{s,f}$ humidistat ratio corresponding to $T_{real} - \Delta T and RH_{s,ff, kgWater/kgDryAir}$

Note that the thermostat/humidistat settings are related with two major processes within EnergyPlus: one is the design load calculations and HVAC system sizing, and the other is the HVAC system operations. Only the latter is affected by the thermostat/humidistat offset fault, while the former is not. Therefore, the size of the corresponding HVAC equipment in the faulty cases is the same as that in the fault-free cases.

When EMS is used to overwrite the ZoneControl:Thermostat/ZoneControl:Humidistat values, the offsets are applied to the EMS values rather than the original Thermostat/Humidistat values.

### Heating and Cooling Coil Fouling 

#### Symptom

Reduced overall heat transfer coefficient (UA) causes reduced coil capacity, resulting in unmet loads and/or increased water flow rate and decreased water side temperature difference (“low ΔT” syndrome). 

#### Modeling Approach

The coil fouling fault is described in the object FaultModel:Fouling:Coil. The fault model currently applies only to the ‘simple’ water coils: Coil:Heating:Water and Coil:Cooling:Water.
The FaultModel:Fouling:Coil object allows the user to describe the fouling information in either of the two methods: FouledUARated or FoulingFactor. Using FouledUARated method, user specifies the value of UAfouled directly. Using FoulingFactor method user specifies air/water side fouling factor, and the UAfouled value is further calculated via the equations shown below.

$$UA_{fouled} = [UA_{air} - 1  +  R_{foul}  + UA_{water} - 1]-1$$

Where, 

$U_{Aair}$ heat transfer coefficient of the coil on the air side, W/K

$UA_{fouled}$ overall heat transfer coefficient of the fouled coil, W/K

$UA_{water}$ heat transfer coefficient of the coil on the water side, W/K

$R_{foul}$ fouling factor, K/W

$R_{foul}$ is determined by:

$$R_{foul} = r_{air}/A_{air} + r_{water} / A_{water}$$

Where, 

$r_{air}$ Air side fouling factor, m2-K/W

$r_{water}$ Water side fouling factor, m2-K/W 

$A_{air}$ Air side coil surface area, m2

$A_{water}$  Water side coil surface area, m2

The pressure drop associated with the fouling is ignored in the current implementation.


Simulation Models – Encyclopedic Reference
==========================================

The following descriptions are grouped alphabetically (as much as possible) with some also having additional tags of “Heat Balance”, “HVAC”, and “Plant”.  With the integrated solution, these designations signify where the effects of these models have their first impacts.


Air System Distribution Terminals <a name="Terminals"></a>
---------------------------------

### Constant Volume Single Duct Uncontrolled Air Terminal

The input object AirTerminal:SingleDuct:Uncontrolled provides a method for directly connecting a central air system to a thermal zone.  Central system air is usually supplied to a zone through a terminal unit such as a single duct VAV reheat box.  Sometimes, however, it is desirable to supply central system air directly to a zone without any zone level control or tempering.  An example would be Furnace or Central DX equipment.  AirTerminal:SingleDuct:Uncontrolled is the input object for a component used to pass supply air directly into a zone without any thermostatic control.  This unit allows the program to know what zone this branch of the air system is attached to and a place to input the maximum air flow rate.  It is typically used with an AirLoopHVAC running as a constant-volume, variable-temperature system.

The AirTerminal:SingleDuct:Uncontrolled object creates the capability of supplying central system air directly to a zone and only contains the zone inlet node.  This node is both the zone inlet node and the outlet node of the AirLoopHVAC:ZoneSplitter.  It can be thought of as a balancing damper in the duct branch going to the zone.  This inlet flow can be controlled by an availability schedule.  This can be thought of as a seasonal shut off of the balancing damper.

For the AirTerminal:SingleDuct:Uncontrolled objects to work correctly, it is important in any systems including them for the sum of the maximum zone air flow rates to be equal to the maximum central system flow rate.  The zone maximum flow rates are specified in the direct air inputs.  The central air system flow rate is specified in the AirLoopHVAC input and also in the air loop branch and central fan inputs.

### Constant Volume Single Duct Reheat Air Terminal

The input object AirTerminal:SingleDuct:ConstantVolume:Reheat provides a model for single duct constant volume systems with reheat that satisfy the cooling load in a zone by changing the inlet air temperature with a reheat coil. The supply air temperature must be low enough to meet the cooling load in the zone having the greatest load. For zones with a smaller cooling load, a reheat coil is used to raise the temperature of the zone inlet air.

This object can be configured with a water, steam, electric or gas reheat coil. Operation is basically the same with all coil types. The coil is controlled to raise the zone supply air temperature (i.e., the Unit Air Outlet Node temperature) to match the zone load.  If the coil is undersized, the zone setpoint temperature will not be maintained.

![ConstVolumeReheat](EngineeringReference/media/image2788.png)

Figure 153. Schematic of AirTerminal:SingleDuct:ConstantVolume:Reheat Unit

### Variable Air Volume Single Duct Reheat and No Reheat Air Terminals

The VAV Single Duct Reheat and No Reheat terminal units (objects AirTerminal:SingleDuct:VAV:Reheat and AirTerminal:SingleDuct:VAV:NoReheat) provide models for single duct variable-air-volume (VAV) systems that control zone temperature primarily by varying the quantity of supply air rather than by varying the supply air temperature. The supply air temperature must be low enough to meet the cooling load in the zone having the greatest load when the zone terminal device is wide open. For zones with a smaller cooling load, the terminal device damper reduces the flow to match the zone setpoint.. If the lower flow limit on the terminal device is reached and the load is not matched, the inlet air temperature can be moderated if the terminal device has a reheat coil. In that case both the quantity of air and its temperature entering the zone are varied to meet the load. For air terminals using reheat coils, the maximum flow during reheat may be limited. Limiting the maximum flow during reheat occurs only when cooling is required (when any valid air loop cooling coil is active) and the terminal unit must reheat the air. Optional user inputs may also be used to control the amount of outdoor air entering the zone.



![Damper\_NoHeat](EngineeringReference/media/image2789.png)

Figure 154. Schematic of AirTerminal:SingleDuct:VAV:NoReheat Unit



![Damper](EngineeringReference/media/image2790.png)

Figure 155. Schematic of AirTerminal:SingleDuct:VAV:Reheat Unit

The operation of the dampers and the control are described in the section AirTerminal:SingleDuct:VAV:HeatAndCool:Reheat and AirTerminal:SingleDuct:VAV:HeatAndCool:NoReheat**,** which follows. The exception is that the section below describes how the air flow rate is varied for both cooling and heating. For the case of AirTerminal:SingleDuct:VAV:NoReheat and AirTerminal:SingleDuct:VAV:Reheat, air flow only varies during cooling operation and the air flow rate is set at the minimum value (minimum air flow fraction) when zone heating is required.

#### Minimum Outdoor Air Control

The single duct air terminals may also be used to provide a minimum outdoor air quantity. When the air flow rate required to meet the zone load does not provide sufficient outdoor air, the terminal device damper will open to allow sufficient outdoor air to enter the zone. In this case, the terminal damper is controlled based on the air loop’s outdoor air fraction. The outdoor air may be specified as a fixed value per person, per floor area, or per zone. The minimum outdoor air may also be specified as air changes per hour. In addition, these values may be added together to provide a combined minimum outdoor air flow rate or the maximum of each of these values may be used. An outdoor air fraction schedule may also be used to modify the calculation for the minimum amount of outdoor air throughout the simulation (Ref. DesignSpecification:OutdoorAir).

### Variable Air Volume Heating and Cooling Single Duct Reheat and NoReheat Air Terminal

#### Overview

The VAV Heating and Cooling Single Duct Reheat and No Reheat terminal units (objects AirTerminal:SingleDuct:VAV:HeatAndCool:Reheat and AirTerminal:SingleDuct:VAV:HeatAndCool:NoReheat provide models for variable-air-volume (VAV) terminal units are widely used in commercial and industrial applications. The VAV terminal units contain actuated dampers that vary the amount of central system air supplied to a zone. These terminal units may also contain a heating coil to trim the supply air temperature when overcooling is possible. The heating coil may also serve as the primary air heating source when the central system contains cooling-only equipment.

The VAV terminal units described here are used primarily with central air handling equipment with cooling and heating capability. The terminal unit dampers modulate in **both** cooling and heating mode to maintain the zone setpoint temperature(s). The central air handling equipment may be either variable air volume or constant volume where a bypass duct is used to shunt excess system air flow back to the inlet of the central air handler as terminal unit dampers modulate to satisfy the zone thermostat (i.e., AirLoopHVAC:UnitaryHeatCool:VAVChangeoverBypass).

#### Model Description

The no reheat version of the single duct VAV heat and cool terminal unit contains a single virtual damper assembly and requires minimal inputs. The reheat version contains both a virtual damper assembly and an air reheat coil. Multiple reheat coil types are available:

1)   Coil:Heating:Water

2)   Coil:Heating:Electric

3)   Coil:Heating:Gas

4)   Coil:Heating:Steam

Both units are simulated to provide an air flow rate sufficient to satisfy the thermostat request. The air flow rate is a function of the terminal unit’s inlet air temperature and the load sensed by the thermostat. The output of the models are simply the damper position required to satisfy the zone’s thermal load. Other information regarding terminal unit performance may be viewed using node report variables and heating coil report variables.

![Damper\_NoHeat](EngineeringReference/media/image2791.png)

Figure 156. Schematic of AirTerminal:SingleDuct:VAV:HeatAndCool:NoReheat Unit



![Damper](EngineeringReference/media/image2792.png)

Figure 157. Schematic of AirTerminal:SingleDuct:VAV:HeatAndCool:Reheat Unit

#### Terminal Unit Inputs

Both terminal unit types share several common input fields. A unique terminal unit name must be entered. A system availability schedule is also defined to allow operational control of the terminal unit. The user must then connect the unit to the air distribution system by defining the unit inlet and outlet node names. Design air flow rates are then specified: maximum total air flow rate (autosizable) and minimum air flow fraction.

The reheat version of this terminal unit requires additional information. The name and type of reheat coil and the damper air outlet node name (same as reheat coil inlet node name). Maximum and minimum water flow rates are entered when a water or steam heating coil is used, as well as a control node name for actuating water-side flow rates and a convergence tolerance for iteration control.

#### Simulation and Control

The simulation begins by determining the air mass flow rate required to satisfy the heating/cooling demand.

<div>$$C{p_{zone}} = PsyCpAirFnWTdb\left( {{\omega_{zone}},{T_{zone}}} \right)$$</div>

<div>$$C{p_{inlet}} = PsyCpAirFnWTdb\left( {{\omega_{inlet}},{T_{inlet}}} \right)$$</div>

<div>$$DeltaCpT = \left( {C{p_{inlet}}} \right)\left( {{T_{inlet}}} \right) - \left( {C{p_{zone}}} \right)\left( {{T_{zone}}} \right)$$</div>

<div>$$\dot m = MIN\left( {{{\dot m}_{max}},\,\,\,MAX\left( {{{\dot m}_{max}}*MinAirFlowFrac\,,\,\,\,{\raise0.7ex\hbox{${{{\dot Q}_{zone}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{zone}}} {DeltaCpT}}}\right.}\!\lower0.7ex\hbox{${DeltaCpT}$}}} \right)\,\,} \right)$$</div>

where

<span>$C{p_{zone}}$</span>  = Specific heat of zone air, J/kg-K

<span>$C{p_{inlet}}$</span>  = Specific heat of terminal unit inlet air, J/kg-K

<span>${\omega_{zone}}$</span>    = Zone air humidity ratio, kg/kg

<span>${T_{zone}}$</span>     = Zone air dry-bulb temperature, °C

<span>${\omega_{inlet}}$</span>    = Terminal unit inlet air humidity ratio, kg/kg

<span>${T_{inlet}}$</span>     = Terminal unit inlet air dry-bulb temperature, °C

<span>${\dot Q_{zone}}$</span>    = Zone load, W (positive values denote heating, negative values denote cooling)

<span>$\dot m$</span>        = Terminal unit air mass flow rate, kg/s

<span>$PsyCpAirFnWTdb$</span>  = Psychrometric function calculating air specific heat given air humidity ratio and dry-bulb temperature

<span>$MinAirFlowFrac$</span>    = User-specified zone minimum air flow fraction

<span>${\dot m_{max}}$</span>              = Terminal unit maximum air mass flow rate, kg/s

The outdoor air input fields, if entered, are then used to adjust the terminal unit air mass flow rate to ensure the correct amount of outdoor air enters the zone (within the constraints of the terminal unit maximum and minimum flow rate inputs). The amount of outdoor air is calculated per the outdoor air requirements and is adjusted by the fraction of outdoor air entering the air loop outdoor air system.

<div>$$
  \dot m = \max \left( \dot m, \frac{\dot m_{OA}}{OAFrac} \right)
$$</div>

where:

<span>${\mathop m\limits^\cdot_{OA}}$</span> = zone outdoor air flow rate, kg/s

<span>$OAFrac$</span> = fraction of outdoor air entering the air loop outside air system

If the terminal unit is in reheat mode (i.e., the central air loop cooling coil is active, the supply air was overcooled, and the zone thermostat is requesting heating) the maximum air flow rate allowed during reheat mode is adjusted as necessary.

<div>$$\mathop m\limits^\cdot  \, = \,MIN\left( {\mathop m\limits^\cdot  ,\,{{\mathop m\limits^\cdot  }_{reheat}}} \right)$$</div>

where:

<span>${\mathop m\limits^\cdot_{reheat}}$</span> = maximum air mass flow rate during reheat, kg/s

The damper position is then calculated as:

<div>$$FRAC_{damper} = \frac{\dot m}{\dot m_{max}} $$</div>

And the amount of outdoor air entering the zone is:

<div>$$\dot V_{OA} = \dot m (OAFrac)$$</div>

where

<span>$FRAC_{damper}$</span>  = Output variable ‘Zone Air Terminal VAV Damper Position’, fraction of maximum flow

<span>${\mathop V\limits^\cdot_{OA}}$</span> = Output variable “Zone Air Terminal Outdoor Air Volume Flow Rate” entering the zone, m3/s

Simulation of the reheat coil occurs next when applicable. The heating demand required to maintain the thermostat heating setpoint temperature and the heating capacity of air flowing through the terminal unit are used to determine the amount of reheat required.

<div>$${\dot Q_{reheat}} = {\dot Q_{heatSP}} + \dot m C_{p,zone}(T_{inlet}-T_{zone})$$</div>

 where

<span>${\dot Q_{reheat}}$</span>  = Reheat coil load, W (positive values denote heating)

<span>${\dot Q_{heatSP}}$</span> = Load to heating setpoint temperature, W (positive values denote heating)

#### References

No specific references.

### Constant Volume Single Duct Four Pipe Induction Air Terminal

The four pipe induction terminal unit (object name: AirTerminal:SingleDuct:ConstantVolume:FourPipeInduction) is a hybrid air-hydronic unit that supplies both centrally conditioned air and local hydronic heating/cooling to a zone. Centrally conditioned air is supplied to the terminal unit at high pressure and constant flow. The central (primary) air is discharged into the terminal unit through a nozzle, inducing a fixed flow of zone (secondary) through a hydronic heating/cooling coil. The primary and secondary air streams mix and are discharged to the zone. Hot or cold water flow through the coil is varied to meet the zone heating or cooling requirement.

#### Model

The four pipe induction terminal unit is modeled as a compound component consisting of three sub-components: a hot water coil, a chilled water coil and an air mixer. In terms of EnergyPlus objects these are *Coil:Heating:Water*, *Coil:Cooling:Water*, and *AirLoopHVAC:ZoneSplitter*.  The terminal unit is a forward model: its inputs are defined by the state of its inlets: namely its 2 air streams – primary and secondary; and its two water inlets – hot and cold. The outputs of the model are the conditions of the outlet air stream: flow rate, temperature and humidity ratio. The terminal unit data and simulation are encapsulated in the module *HVACSingleDuctInduc*.

#### Inputs and Data

The user describes the terminal unit by inputting the name and type of the heating and cooling coils and the name of the zone mixer. The user must also specify the connectivity of the component by naming the inlet air and water nodes and the air outlet node. Finally maximum and fixed flow rates need to be specified (although these can be autosized): maximum and minimum hot and cold water volumetric flow rates and the total air volumetric flow rate (sum of primary and secondary flow rates). The relative convergence tolerances for the hot and cold water flow rates also need to be input (or allowed to default). Finally the induction ratio needs to be specified: this  is defined as the ratio of the secondary air flow rate to the primary air flow rate. The relationship between the flow rates is:

<div>$${\dot m_{air,tot}} = {\dot m_{air,pri}} + {\dot m_{air,\sec }}$$</div>

<div>$${\dot m_{air,sec}} = {R_{induc}}\cdot {\dot m_{air,pri}}$$</div>

so

<div>$${\dot m_{air,pri}} = {\dot m_{air,tot}}/(1 + {R_{induc}})$$</div>

<div>$${\dot m_{air,sec}} = {\dot m_{air,tot}}\cdot {R_{induc}}/(1 + {R_{induc}})$$</div>

where *R<sub>induc</sub>* is the user-input induction ratio.

All input data for the four pipe induction terminal units is stored in the array *IndUnit*.

#### Calculation

Given the needed inputs, the output is calculated in subroutine *CalcFourPipeIndUnit*. The temperature, humidity ratio and flow rate of the primary and secondary air streams are taken from the inlet air nodes. The inlet hot and chilled water flow rates are passed in as parameters – temperatures are taken from the inlet water nodes. Then

The hot water coil is simulated (Call *SimulateWaterCoilComponents);*

The chilled water coil is simulated (Call *SimulateWaterCoilComponents*);

The two air streams are mixed (Call *SimAirMixer*).

Finally the load met by the terminal unit is calculated and passed back to the calling routine:

<div>$${\dot Q_{out}} = {\dot m_{tot}}\cdot {c_{p,air}}\cdot ({T_{air,out}} - {T_{air,zone}})$$</div>

Note that data is never explicitly passed between the sub-components. This is all handled automatically by the node connections and the data stored on the nodes.

#### Simulation and Control

From the result of the zone simulation we have the heating/cooling demand on the terminal unit 
<span>${\dot Q_{z,req}}$</span>
. For a given hot and cold water flow *CalcFourPipeIndUnit* will give us the terminal unit heating/cooling output. We need to vary the hot or cold water flow to make the unit output match the demand. To do this we need to numerically invert *CalcFourPipeIndUnit*: given the output, we want one of the inputs – the hot or cold water flow. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function (the *residual* function) of a single independent variable. In this case the residual function calculates 
<span>$({\dot Q_{z,req}} - {\dot Q_{out}})/{\dot Q_{z,req}}$</span>
. *SolveRegulaFalsi* varies either the hot water or cold water mass flow rate to zero the residual.

Decide whether the unit is on or off. The unit is off if: a) it is scheduled off; b) the inlet air mass flow rate is zero; c) the zone thermostat is in the deadband; d) or the zone heating/cooling demand is very small.

If the unit is off, call *CalcFourPipeIndUnit* with the hot and cold water flow rates set to their minimum flows and return.

If the unit is on, check whether active heating or cooling by the hydronic coils is needed. Call *CalcFourPipeIndUnit* with minimum water flows to see what how much cooling (or possibly heating) the unit is doing with primary air only. The output for this case is <span>${\dot Q_{pri}}$</span>.

If <span>${\dot Q_{z,req}} > {\dot Q_{pri}}$</span> we need active heating. Set the cold water flow rate to the minimum. Check that the terminal unit can meet the load by setting the hot water flow rate to the maximum and calling *CalcFourPipeIndUnit*. If the output is less than the zone demand we are done – all the outputs have been calculated. Otherwise call *SolveRegulaFalsi* to obtain the hot water flow rate that will make the unit output match the zone demand. This ends the unit simulation.

If <span>${\dot Q_{z,req}} < {\dot Q_{pri}}$</span>we need active cooling. We set the hot water flow rate to the minimum. We check whether the terminal unit can supply the needed output by setting the cold water flow rate to the maximum and calling *CalcFourPipeIndUnit.* If this maximum cooling output is not able to meet the zone cooling demand we are done. Otherwise call *SolveRegulaFalsi* to obtain the cold water flow rate that will make the unit output match the zone demand. This ends the unit simulation.

Note that the terminal unit output is never explicitly passed to another routine. Instead the output is saved as the outlet conditions on the terminal unit outlet air node. The node data is accessed when the terminal unit output is needed elsewhere in the program (in *SimZoneAirLoopEquipment* for instance).

#### References

No specific references.

### Fan Powered Induction Series and Parallel Single Duct  Reheat Air Terminal

#### Overview

The input objects AirTerminal:SingleDuct:SeriesPIU:Reheat and AirTerminal:SingleDuct:ParallelPIU:Reheat provide models for fan powered induction terminal units that occur in a variety of configurations. EnergyPlus models 2 types: *series* (sometimes called *constant*) and *parallel* (sometimes called *intermittent*). The series unit provides a constant flow of air to the zone (the fan is always on at a constant flow) with a variable proportion of primary and secondary air. The parallel unit has an intermittent fan: the fan is off at maximum cooling and does not switch on until primary air flow is significantly reduced from the maximum. Once on it provides a constant flow of secondary air. Both units induce air from the zone or plenum (secondary air) and mix it with centrally conditioned supply air (primary air). Both units are variable volume: the supply air flow rate is varied to match zone conditioning requirement.

#### Model

Both types of PIU are modeled as compound components. The series unit, in sequence from its inlet, consists of an air mixer, a constant volume fan, and a heating coil. In terms of EnergyPlus objects this is:

1.    AirLoopHVAC:ZoneMixer

2.    Fan:ConstantVolume

3.    Coil:Heating:Water, Coil:Heating:Electric, Coil:Heating:Gas or Coil:Heating:Steam

The parallel unit contains a fan (in the secondary air stream, an air mixer, and a heating coil. In terms of EnergyPlus objects this is:

1.    Fan:ConstantVolume

2.    AirLoopHVAC:ZoneMixer

3.    Coil:Heating:Water, Coil:Heating:Electric, Coil:Heating:Gas or Coil:Heating:Steam

Both units are forward models: their inputs are defined by the state of their inlets: namely the air inlet and the hot water  inlet. The outputs of the models are the conditions of the outlet air stream: flow rate, temperature and humidity ratio. The PIUs data and simulation are encapsulated in the module *PoweredInductionUnits*. The main simulation routine for the units within the module are *CalcSeriesPIU* and *CalcParallelPIU*.

#### Inputs and Data

The user describes the PIU by inputting the names of the mixer, fan and heating coil sub-components plus the type of the heating coil sub-component. The user must connect the unit to the overall HVAC systems by naming various inlet and outlet nodes: the primary air inlet node, the secondary air inlet node, the unit air outlet node, and the hot water inlet node. One internal node name is needed: the coil air inlet node (same as fan outlet mode for series, mixer outlet node for parallel). Design flow rates need to be specified (although these can be autosized): maximum total air flow rate (series), maximum primary air flow rate, minimum primary air flow fraction, maximum secondary air flow rate (parallel), fan-on flow fraction (parallel), and maximum and minimum hot water flow rates. A convergence tolerance needs to be specified for units with hot water coils. There is an on/off availability schedule that need to be set.

All input data for the powered induction terminal units is stored in the array *PIU*.

#### Calculation

The calculation is performed by simulating the sub-components in the order given above. Most of the code is involved with figuring out what the various flow rates should be before simulating the subcomponents. These calculations are described below.

#### Simulation and Control

*Series*

From the result of the zone simulation we have the heating/cooling demand on the terminal unit <span>${\dot Q_{tot}}$</span>. The subroutine *CalcSeriesPIU* needs to determine the flow rates that will allow the unit to meet this load. The first step is to determine the on/off state of the unit and determine the air flow rates.

·        If the unit is scheduled off, the primary and secondary flow rates are set to zero.

·        If there is no primary air flow (or less than .001 kg/s), the primary air flow is set to zero and the secondary air flow is set to the constant total air flow input by the user.

·        If the zone temperature is in the deadband or the zone load is less than 1 watt or the zone needs heating, the primary air flow rate is set to the minimum flow rate specified by the input and the secondary air flow rate is set to the difference between the fixed total air flow rate and the primary air flow rate.

·        Otherwise, the zone needs cooling and the unit is active.

§ We determine the fan temperature rise: the secondary air flow is set to the max total air flow, primary air flow to zero, and the mixer and fan are simulated. The fan delta T is the difference between the temperature at the fan’s outlet node and inlet node.

§ We calculate the unit air outlet temperature needed to meet the zone cooling load: <span>${T_{out}} = C{p_h} + {\dot Q_{z,req}}/({\dot m_{air,tot}}\cdot {c_{p,air,z}})$</span>

§ The temperature needed at the outlet of the mixer is then: <span>${T_{mix}} = {T_{out}} - \Delta {T_{fan}}$</span>

§ We can then set the primary air flow rate.

·        If 
         <span>${T_{mix}} \le {T_{in,pri}}$</span>
         then 
         <span>${\dot m_{pri}} = {\dot m_{pri,max}}$</span>

·        else if 
         <span>${T_{mix}} \ge {T_{in,pri}}$</span>
         and 
         <span>${T_{mix}} \ge {T_{in,sec}}$</span>
         then 
         <span>${\dot m_{pri}} = {\dot m_{pri,min}}$</span>

·        otherwise 
         <span>${\dot m_{pri}} = {\dot m_{air,tot}}\cdot ({T_{in,sec}} - {T_{mix}})/({T_{in,sec}} - {T_{in,pri}})$</span>
         , subject to the constraints that the flow rate can’t be bigger than the max and min allowed.

The air flow rates are now determined and we can fire the air mixer (Call *SimAir-Mixer*) and fan (Call *SimulateFanComponents*) component simulations. Finally we simulate the heating coil:

·        for a hot water coil, if the coil is off (no flow, deadband, no load) just fire the coil simulation once (Call *SimulateWaterCoilComponents*). Otherwise call *ControlCompOutput*; *ControlCompOutput* is a general component control routine. In this case it calls *SimulateWaterCoilComponents* repeatedly while varying the hot water flow rate and minimizing

<div>$$({c_{p,air}}\cdot {\dot m_{air,tot}}\cdot ({T_{out}} - {T_z}) - {\dot Q_{z,req}})/{\dot Q_{z,req}}$$</div>

to within the heating convergence tolerance.

·        For gas, electric or steam coils, the required coil output is set to <span>${\dot Q_{coil,req}} = {\dot Q_{z,req}} - {c_{p,air}}\cdot {\dot m_{air,coil}}({T_{air,coil,in}} - {T_z})$</span>. Then the coil simulation is fired (Call *SimulateHeatingCoilComponent* or *SimulateSteamCoilCompo-nents*).

Finally the unit sensible output is calculated:

<div>$${\dot Q_{sens,out}} = {\rm{PsyHFnTdbW}}({T_{air,out}},{W_z}) - {\rm{PsyHFnTdbW(}}{T_z},{W_z})$$</div>

where *PsyHFnTdb* is the EnergyPlus function giving enthalpy as a function of temperature and humidity ratio.

*Parallel*

From the result of the zone simulation we have the heating/cooling demand on the terminal unit <span>${\dot Q_{tot}}$</span>. The subroutine *CalcParallelPIU* needs to determine the flow rates that will allow the unit to meet this load. The first step is to determine the on/off state of the unit and determine the air flow rates.

·        If the unit is scheduled off, the primary and secondary flow rates are set to zero.

·        If there is no primary air flow (or less than .001 kg/s), the primary air flow is set to zero and the secondary air flow is set to the max secondary air flow input by the user.

·        If the zone temperature is in the deadband or the zone load is less than 1 watt or the zone needs heating, the primary air flow rate is set to the minimum flow rate specified by the input and the secondary air flow rate is set to max secondary air flow input by the user.

·        Otherwise, the zone needs cooling and the unit is active.

§ We determine the fan temperature rise: the secondary air flow is set to the max secondary air flow, primary air flow to zero, and the fan and mixer are simulated. The fan delta T is defined as the difference between the temperature at the mixer outlet node and the fan inlet node.

§ Assuming that the fan is off, we calculate the primary air flow needed to meet the cooling demand.

<div>$${\dot m_{pri}} = {\dot Q_{z,req}}/({c_{p,air}}\cdot ({T_{in,pri}} - {T_z}))$$</div>

The flow rate is constrained to be between the min and max primary air flow rates. If this calculated primary flow rate is greater than the fan-on flow rate, the secondary flow rate is set to zero and we are done. Otherwise, the fan is on and we need to recalculate the primary air flow rate.

<div>$${\dot m_{pri}} = ({\dot Q_{z,req}} - {c_{p,air}}\cdot {\dot m_{sec}}\cdot ({T_{in,sec}} + \Delta {T_{fan}} - {T_z}))/({c_{p,air}}\cdot ({T_{in,pri}} - {T_z}))$$</div>

The secondary flow rate is set to the user input fixed flow rate. The primary air flow rate is constrained to be between the min and max primary flow rated.

The air flow rates are now determined and we can fire the fan (Call *SimulateFanComponents*) and air mixer (Call *SimAirMixer*) component simulations. Finally we simulate the heating coil:

·        for a hot water coil, if the coil is off (no flow, deadband, no load) just fire the coil simulation once (Call *SimulateWaterCoilComponents*). Otherwise call *ControlCompOutput*; *ControlCompOutput* is a general component control routine. In this case it calls *SimulateWaterCoilComponents* repeatedly while varying the hot water flow rate and minimizing

<div>$$({c_{p,air}}\cdot {\dot m_{air,tot}}\cdot ({T_{out}} - {T_z}) - {\dot Q_{z,req}})/{\dot Q_{z,req}}$$</div>

to within the heating convergence tolerance.

·        For gas, electric or steam coils, the required coil output is set to <span>${\dot Q_{coil,req}} = {\dot Q_{z,req}} - {c_{p,air}}\cdot {\dot m_{air,coil}}({T_{air,coil,in}} - {T_z})$</span>. Then the coil simulation is fired (Call *SimulateHeatingCoilComponent* or *SimulateSteamCoilCompo-nents*).

Finally the unit sensible output is calculated:

<div>$${\dot Q_{sens,out}} = {\rm{PsyHFnTdbW}}({T_{air,out}},{W_z}) - {\rm{PsyHFnTdbW(}}{T_z},{W_z})$$</div>

where *PsyHFnTdb* is the EnergyPlus function giving enthalpy as a function of temperature and humidity ratio.

#### References

No specific references.

### Variable Air Volume Fan Powered Single Duct Air Terminal

#### Overview

The input object AirTerminal:SingleDuct:VAV:Reheat:VariableSpeedFan provides a model for variable speed (VS) fan VAV terminal unit that is a typical VAV reheat unit with the addition of a variable-speed blower fan to assist in moving supply air from the plenum to the conditioned zone. It is typically used with under-floor air distribution systems (UFAD) where the supply air is sent at low static pressure through an under-floor supply plenum. The fan has two maximum flow rate settings: one for cooling and one for heating. The cooling maximum is usually the actual fan maximum while the heating maximum is a lesser flow rate. The fan is upstream of the heating coil (this is a blow-through unit). The heating coil can be hot-water, electric or gas. Cooling control is obtained by varying the supply air flow rate from the cooling maximum to the minimum flow rate. Heating control is established by varying both the heating coil output (or hot water flow rate for hot water coils) and the supply air flow rate. Note that for this unit the minimum supply air flow rate is the flow rate when the fan is off.

#### Model

The VS fan VAV terminal unit is modeled as a compound component consisting of two sub-components: a fan and a heating coil. In terms of EnergyPlus objects the fan is a *Fan:VariableVolume* object and the heating coil is a *Coil:Heating:Water*, *Coil:Heating:Electric* or a *Coil:Heating:Gas*. The terminal unit is a forward model: its inputs are defined by the state of its inlets: namely its air inlet and its hot water  inlet, if it has a hot water coil. The outputs of the model are the conditions of the outlet air stream: flow rate, temperature and humidity ratio. The terminal unit data and simulation are encapsulated in the module *SingleDuct*. The main simulation routine for the unit within the module is *SimVAVVS*.

#### Inputs and Data

The user describes the terminal unit by inputting the name and type of the heating coil and the name and type of the fan. The user must also specify the connectivity of the component by naming the inlet air node; the air node connecting the fan and heating coil (fan outlet, coil inlet); the unit air outlet node (same as the zone inlet node); and hot water inlet node (if any). Maximum flow rates need to be specified (although these can be autosized): maximum cooling and heating air flow rates and the maximum hot water flow rate (if there is a hot water coil). Minimum flow rates are specified by giving by giving a minimum flow fraction for the air flow and a volumetric flow rate minimum for the hot water. For the units with hot water coils the relative convergence tolerance for the hot water flow rate also needs to be input (or allowed to default).

All input data for the VS fan VAV terminal units is stored in the array *Sys*.

#### Calculation

Given the needed inputs, the output is calculated in subroutine *CalcVAVVS*. The temperature and humidity of the supply air stream are taken from the inlet air node. The inlet air flow rate and the hot water flow rate are passed in as parameters. If the coil is electric or gas the coil heating power is passed instead of the hot water flow rate. Then

The fan is simulated (call *SimulateFanComponents*). If the fan is off the fan outlet conditions are set to the inlet conditions.

The heating coil is simulated (call *SimulateWaterCoilComponents* if the coil is a hot water coil; call *SimulateHeatingCoilComponents* if the coil is gas or electric).

Finally the sensible load met by the terminal unit is calculated and passed back to the calling routine:

<div>$${\dot Q_{out}} = {\dot m_{air}}\cdot {c_{p,air}}\cdot ({T_{air,out}} - {T_{air,zone}})$$</div>

Note that data is never explicitly passed between the sub-components. This is all handled automatically by the node connections and the data stored on the nodes.

#### Simulation and Control

From the result of the zone simulation we have the heating/cooling demand on the terminal unit 
<span>${\dot Q_{tot}}$</span>
. For the given inlet conditions *CalcVAVVS* will give us the terminal unit heating/cooling output. We need to vary the air or hot water flow rate or the heating coil power (for gas or electric coils) to make the unit output match the demand. To do this we need to numerically invert *CalcVAVVS*: given the output, we want one of the inputs – the air or hot water flow rate or the heating coil power. The numerical inversion is carried out by calling subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function (the *residual* function) of a single independent variable. In this case the residual function calculates 
<span>$({\dot Q_{tot}} - {\dot Q_{out}})/{\dot Q_{tot}}$</span>
. *SolveRegulaFalsi* varies either the air mass flow rate, the hot water mass flow rate or the heating coil power to zero the residual.

The unit is simulated in the following sequence.

Decide whether the unit is on or off. The unit is off if: a) it is scheduled off; b) the inlet air mass flow rate is zero; or c) the zone thermostat is in the deadband

If the unit is off, call *CalcVAVVS* with flow rates set to their minimum flows and return.

If the unit is on, we need to establish the boundaries of 4 conditioning regions: a) active cooling with fan on; b) active heating with fan on; c) active heating with fan off; d) passive cooling with fan off. The heating/cooling demand will fall into one of these regions. Once the correct region is determined, we will know which model input to vary for control and thus how to invert the calculation.

To establish the boundaries of region a) we call *CalcVAVVS* twice: once with the supply air flow rate set to the cooling maximum, once with the cooling air flow rate set to the minimum. In both cases the heating coil output is at the minimum and the fan is on. Call the 2 cooling outputs 
<span>${\dot Q_{cool,max,fanon}}$</span>
and 
<span>${\dot Q_{cool,min,fanon}}$</span>
. Remembering that EnergyPlus convention is that cooling loads are negative, then if 
<span>${\dot Q_{tot}} < {\dot Q_{cool,max,fanon}}$</span>
the terminal unit can not meet the demand. Set the air mass flow rate to the cooling maximum and call *CalcVAVV* again. This concludes the simulation. If  
<span>${\dot Q_{cool,max,fanon}} < {\dot Q_{tot}} < {\dot Q_{cool,min,fanon}}$</span>
the cooling demand is in the active cooling region. We hold the heating at the minimum, allow the supply air flow to vary between the cooling maximum and the minimum with the fan on, and call *SolveRegulaFalsi* to obtain the supply air flow rate that will produce the unit sensible cooling output that matches the demand. This concludes the simulation.

To establish the boundaries of region b) call *CalcVAVVS* twice: once with the supply air flow rate set to the heating maximum, once with the supply air flow rate set to the minimum. In both calls, if the heating coil is a hot water coil, the hot water flow rate is at the maximum. For electric and gas coils, the heating power is set to the maximum at maximum supply air flow and to zero at the minimum supply air flow. In both calls the fan is set to be on. Call the 2 heating outputs returned from the two calls to *CalcVAVVS* 
<span>${\dot Q_{heat,max,fanon}}$</span>
and 
<span>${\dot Q_{heat,min,fanon}}$</span>
. If 
<span>${\dot Q_{heat,max,fanon}} < {\dot Q_{tot}}$</span>
the terminal unit can not meet the load. Set the air flow rate to the heating maximum and the hot water flow rate or heating coil power to the maximum and call *CalcVAVVS* again. This concludes the simulation for this case. If 
<span>${\dot Q_{heat,min,fanon}} < {\dot Q_{tot}} < {\dot Q_{heat,max,fanon}}$</span>
the heating demand is in the active heating, fan on region. For a hot water coil we call *SolveRegulaFalsi* with the supply air flow rate as the input that is varied and the hot water flow rate set to the maximum. For electric and gas coils the coil power and the supply air flow rate are both varied together from their minimum to maximum in a call to *SolveRegulaFalsi*.  The call to *SolveRegulaFalsi* concludes the simulation for this case.

This region only applies to terminal units with a hot water coil. To establish the boundaries of region c) the fan is set to off, the supply air flow rate is set to minimum flow and *CalcVAVVS* is called twice: once with the hot water flow at maximum and once with the hot water flow at minimum. Call the two heating outputs 
<span>${\dot Q_{heat,max,fanoff}}$</span> 
and <span>${\dot Q_{tot}}$</span>
. If 
<span>${\dot Q_{tot}}$</span>
 is between these values, the supply air flow rate is set to its minimum, the fan is set to off, and in the call to *SolveRegulaFalsi* the hot water flow rate is varied to meet the load. This concludes the simulation for this case.

If the cooling demand does not fall into cases a) – c), the unit is assumed to be in the passive cooling state: heating is off or at the minimum, the fan is off, and the minimum supply air flow is delivered to the zone.

Note that the terminal unit output is never explicitly passed to another routine. Instead the output is saved as the outlet conditions on the terminal unit outlet air node. The node data is accessed when the terminal unit output is needed elsewhere in the program (in *SimZoneAirLoopEquipment* for instance).

#### References

No specific references.

### Cooled Beam Unit (AirTerminal:SingleDuct:ConstantVolume:CooledBeam)

Cooled beam (frequently called chilled beams) systems are usually hybrid water – air systems. Commonly there is a constant flow, fixed temperature central forced air system for meeting ventilation and latent load requirements.  Sometimes this forced air system’s flow rate is varied according to ventilation demand; and of course its supply air temperature could be reset in various ways. Sensible cooling load is met by the cooled beam units; these are ceiling suspended units with cool water circulating through them. Some types of units are “passive” – they cool by radiation and natural convection. Other types of units are “active” and act as supply air terminal units with the supply air inducing room air over the beam cooling elements. These units cool almost entirely by convection. The DOE-2 model (upon which this model is based) is a convection only model – even the “passive” units are assumed to operate 100% convectively. The cooled beam elements act as an alternative to normal ceiling radiant cooling: they are not coupled to the building mass and they operate more in a convective mode, but they can, like radiant cooling, use fairly warm cooling water.

Heating is accomplished separately from the cooled beam system – usually baseboards are used on the building perimeter to meet heating loads.

#### Model

The chilled beam system is modeled as an EnergyPlus terminal unit. In terms of configuration within the overall HVAC system it will resemble a 4 pipe induction terminal unit. The user describes the system as a typical single duct constant volume system (with outside air mixer, fan, heating and cooling coils) on the air loop side, and with cooled beam terminal units on the zone equipment side.

The model is an empirical model developed at the equipment manufacturer Halton Oy. It consists of the following relationships.

*P<sub>beam</sub>* = *A·K·DT       *                         beam cooling output per unit length W/m

*K=a·DT<sup>n1</sup>·vr<sup>n2</sup>·w<sup>n3</sup>*                            coil heat transfer coefficient W/(m<sup>2</sup>K)

*vr=(q<sub>in</sub>*/a*<sub>0</sub>)·r<sub>air</sub>*                                  room air mass flow rate across coil kg/(m<sup>2</sup>s)

*q<sub>in</sub>=K<sub>1</sub>·DT<sup>n</sup>+K<sub>in</sub>·q<sub>pr</sub>*                             room air volumetric flow rate across coil per

                                                      unit length m<sup>3</sup>/(s-m)

DT is the room air –water temperature difference (average water temperature is used) in degrees C.

w is the water velocity in m/s.

q<sub>pr</sub> is the supply air flow rate per unit length m<sup>3</sup>/(s-m)

The other symbols are the model parameters input by the user (see the IO Ref for descriptions).

#### Inputs and Data

The user describes the unit by inputting the name, referencing an availability schedule, and choosing a type (*active* or *passive*). The user must also specify the connectivity of the component by naming the inlet and outlet air and water nodes. The maximum water and fixed air flow rates need to be specified (although these can be autosized). The design inlet and outlet water temperatures are inputs. Generally the inlet water temperature is quite warm (15C is the default) and the temperature rise is small (design outlet water temperature defaults to 17C). Two key inputs are the number of beams (in the zone) and the beam length. It is generally wise to let these inputs autosize.

The remaining inputs are parameters specific to the product model. Good defaults are supplied and they should not be changed without information from the manufacturer.

#### Sizing

The Cooled Beam sizing calculations generally follow the procedures used for other terminal units (see *Loop Equipment Sizing*). One difference is that the Cooled Beams use the Cooled Beam inputs *Design Inlet Water Temperature* and *Design Outlet Water Temperature* for the chilled water DT rather than the DT from Plant Sizing. There are also two inputs unique to the Cooled Beam units that are autosized and will be described here.

The input *Number of individual beam units in the zone* is autosized by dividing the beam system zone design chilled water flow rate (either input by the user or autosized) by a nominal chilled water beam flow rate: 0.07 kg/s.

The input *Length of an individual beam unit* is autosized by using the model equations to calculate the length. The inputs to the equations are:

1)    the design load per beam. The design load is calculated from the design water mass flow rate and the design water inlet and outlet temperatures. The design load is divided by the number of beams to obtain the design load per beam.

2)    The design air supply air flow per beam – obtained by dividing the design supply air flow by the number of beams.

3)    The design water flow per beam (m<sup>3</sup>/s) – obtained by dividing the design water flow by the number of beams.

4)    The design water velocity – obtained by dividing the design water flow per beam by the cross sectional inside area of a water tube (pD<sup>2</sup>/4, where D is the input *Pipe inside diameter*.

5)    Average air to water *DT = T<sub>z,\\ cool\\ peak</sub>* - *0.5(T<sub>w,des\\ inlet</sub>* *+ T<sub>w,des\\ outlet</sub>)*; where        *T<sub>z,\\ cool\\ peak</sub>* is the zone air temperature at the cooling peak and the *T<sub>w,des</sub>* ‘s are the water design inlet and outlet temperatures.

With these inputs the model equations can be solve directly for beam length for passive cooled beams, and iteratively for active cooled beams.

#### Calculation

The subroutine *CalcCoolBeam*  uses the model equations to calculate the cooling power *P<sub>beams,out</sub>* delivered to the room air and the outlet water temperature given the water flow rate (and the room air temperature and water inlet temperature). Since the model equations are nonlinear they must be solved iteratively. The subroutine does this by varying the outlet water temperature *T<sub>w,out</sub>* and calculating the water-side cooling power

P<sub>w</sub> = q<sub>w,beam</sub>·c<sub>p,w</sub>·(T<sub>w,out</sub>-T<sub>w,in</sub>)

and comparing it to the air-side cooling power

P<sub>air</sub>=K·A·DT·L<sub>beam</sub>

where *q<sub>w,beam</sub>* is the water mass flow rate (kg/s) per beam and *L<sub>beam</sub>* is the length of a beam (m). When *P*<sub>w</sub>  and *P<sub>air</sub>* match to within 0.1 W the subroutine terminates the iteration.

#### Simulation and Control

From the result of the zone simulation we have the heating/cooling demand for the zone equipment. For the cooling demand, we use the load to cooling set point *P<sub>c</sub>*. Part of the demand may be satisfied by the zone supply air:

P<sub>sup</sub>=q<sub>air</sub>·(c<sub>p,air,sys</sub>·T<sub>sys</sub> - c<sub>p,air,z</sub>·T<sub>z</sub>)

The demand on the actual beams is then

P<sub>beams,dem</sub>=P<sub>c</sub> - P<sub>sup</sub>

We want to know the chilled water flow rate that will give a beam cooling output of *P<sub>beams</sub>*. To obtain this we need to numerically invert *CalcCoolBeam*: given its desired output, we want to know the chilled water flow rate. This numerical inversion is carried out by calling the subroutine *SolveRegulaFalsi*. This is a general utility routine for finding the zero of a function (the *residual* function) of a single independent variable. In this case the residual function is basically

(P<sub>beams,out</sub>-P<sub>beams,dem</sub>)/P<sub>beams,out,max</sub>

*SolveRegulaFalsi* varies the cold water mass flow rate to zero the residual. The water inlet and outlet node flow rates are set to the flow rate found by *SolveRegulaFalsi* and the water outlet node temperature is set to the outlet water temperature from *SolveRegulaFalsi*.

#### References

Documentation Package Update \#2 for DOE-2.1E, Version 107, page 3.152 describes the input and the model for the DOE-2 cooled beam model.

### Constant Volume Dual Duct Air Terminal

#### Overview

The input object AirTerminal:DualDuct:ConstantVolume provides a model for dual duct constant-air-volume (DDCAV) systems that are typically used in special applications where precise temperature and humidity control are required and energy efficiency is not of primary concern. Thermal control for each zone is achieved by mixing air from the hot deck with air from the cold deck to achieve a supply air temperature that will exactly meet the zone load and satisfy the zone thermostat demand. Each zone has its own mixing box which is connected directly to the hot and cold decks. The mixing box dampers change the relative amount of hot and cold air that will be delivered (at a constant volumetric flow rate) to the zone.

#### Model Description

The DDCAV model will attempt to meet all of the thermostatic loads of a particular zone by explicitly calculating the hot and cold deck mass flow rates. For the energy and mass balance equations shown below, the zone load, temperatures, specific heats and the design mass flow rate are all known. These equations can then be solved directly for the hot deck and cold deck mass flow rates.

<div>$$\dot Q_{zone} = \dot m_c C_{p,c} T_c + \dot m_h C_{p,h}T_h - \dot m_d C_{p,z} T_z$$</div>

<div>$$\dot m_d = \dot m_c + \dot m_h$$</div>

Where:

<span>$\dot Q_{zone}$</span>= Zone load, W (positive=heating, negative=cooling)

<span>$C{p_z}$</span>= Specific heat of zone air, J/kg-K

<span>$C{p_c}$</span>= Specific heat of cold deck air, J/kg-K

<span>$C{p_h}$</span>= Specific heat of hot deck air, J/kg-K

<span>${T_z}$</span>= Zone air dry-bulb temperature, °C

<span>${T_c}$</span>= Cold deck air dry-bulb temperature, °C

<span>${T_h}$</span>= Hot deck air dry-bulb temperature, °C

<span>${\dot m_d}$</span>= System design air mass flow rate through both heating or cooling duct, kg/s

<span>${\dot m_c}$</span>= Cold deck air mass flow rate, kg/s

<span>${\dot m_h}$</span>= Hot deck air mass flow rate, kg/s

#### Simulation and Control

The simulation first calculates the hot deck and cold deck air mass flow rates required to satisfy the heating/cooling demand on the zone. Once the individual flow rates have been calculated based on temperature control, the zone mixed air conditions are calculated assuming adiabatic mixing of the two air streams.

### Variable Air Volume Dual Duct Air Terminal

#### Overview

The input object AirTerminal:DualDuct:VAV provides a model for dual duct variable-air-volume (DDVAV) systems that are typically used in special applications where both temperature and humidity control as well as energy efficiency are of primary concern.  This system combines the advantages of the standard dual duct system for better thermal control with the possibility to reduce fan energy using a variable speed fan. The DDVAV terminal units contain actuated dampers that vary the amount of central system air supplied to a zone from both the hot and cold deck. Optional user inputs may also be used to control the amount of outdoor air entering the zone.

The DDVAV terminal units described here are used primarily with central air handling equipment with cooling and heating capability. The terminal unit dampers modulate the amount of cold air and hot air as well as the overall flow rate to maintain the zone setpoint temperature(s).

#### Model Description

The DDVAV model will attempt to meet all of the thermostatic loads of a particular zone by first sending air through either the heating duct or the cooling duct depending on whether there is a heating or cooling load (respectively).  Flow rate through the opposite duct is kept at zero and flow through the active duct is varied between the minimum air flow rate (minimum zone air fraction multiplied by the maximum flow rate) and the maximum air flow rate.  If the flow rate to meet the load through either the heating or cooling duct results in a flow outside these ranges, then air must be passed through the other duct as well to avoid over- or under-heating or –cooling. This is done using a conservation of energy and mass analysis of the terminal unit as well as the known inlet and necessary outlet condition to meet the thermal needs of the zone.

When there is no load on the zone, the system could either be scheduled off or be in a “no load” condition.  If the system is scheduled off, the model keeps the flow rate at zero for both the heating and cooling duct.  If in a no load condition, the system attempts to throttle back to the minimum possible flow and then find a balance between flow through the heating and cooling duct that will provide no net conditioning to the space.  This means that the enthalpy of air delivered to the space must be equal to the enthalpy of the (average) air in the zone.

#### DDVAV Terminal Unit Inputs

Like other terminal units, the DDVAV terminal unit requires an availability schedule and inlet and outlet node designations.  The DDVAV terminal unit, like the DD terminal unit, has two inlet nodes (one for the heating duct and one for the cooling duct) and one outlet node.

In addition, the DDVAV terminal unit also has a maximum flow rate and a minimum flow fraction like the VAV terminal unit.  This allows the flow to be throttled back when it is possible to provide the proper amount of conditioning with less flow.  The maximum flow rate can be auto-sized, if desired.

#### Minimum Outdoor Air Control

This dual duct air terminal may also be used to provide a minimum outdoor air quantity. When the air flow rate required to meet the zone load does not provide sufficient outdoor air, the terminal device damper will open to allow sufficient outdoor air to enter the zone. In this case, the terminal damper is controlled based on the air loop’s outdoor air fraction. The outdoor air may be specified as a fixed value per person, per floor area, or per zone or as the required minimum air changes per hour. In addition, these values may be added together to provide a combined minimum outdoor air flow rate or the maximum of each of these values may be used. An outdoor air fraction schedule may also be used to modify the calculation for the minimum amount of outdoor air throughout the simulation (Ref. DesignSpecification:OutdoorAir).

#### Simulation and Control

The simulation begins by determining the air mass flow rate required to satisfy the heating/cooling demand using either the heating duct or cooling duct.

<div>$$C{p_{zone}} = \dot m\left( {C{p_{inlet}},{T_{zone}}} \right)$$</div>

<div>$$C{p_{zone}} = PsyCpAirFnWTdb\left( {{T_{zone}},{T_{inlet}}} \right)$$</div>

<div>$$DeltaCpT = \left( {C{p_{inlet}}} \right)\left( {{T_{inlet}}} \right) - \left( {C{p_{zone}}} \right)\left( {{T_{zone}}} \right)$$</div>

<div>$$ \dot m = \min \left( \dot m_{max}, \max \left( \dot m_{max}\cdot MinAirFlowFrac,\frac{\dot Q_{zone}}{DeltaCpT} \right) \right) $$</div>

where

<span>$C{p_{zone}}$</span>  = Specific heat of zone air, J/kg-K

<span>$C{p_{inlet}}$</span>  = Specific heat of terminal unit inlet air, J/kg-K

<span>${\omega_{zone}}$</span>    = Zone air humidity ratio, kg/kg

<span>${T_{zone}}$</span>     = Zone air dry-bulb temperature, °C

<span>${\omega_{inlet}}$</span>    = Terminal unit inlet air humidity ratio, kg/kg

<span>${T_{inlet}}$</span>     = Terminal unit inlet air dry-bulb temperature, °C

<span>$\dot m$</span>    = Zone load, W (positive values denote heating, negative values denote cooling)

<span>$PsyCpAirFnWTdb$</span>        = Terminal unit air mass flow rate through either heating or cooling duct, kg/s

<span>$MinAirFlowFrac$</span>           = Psychrometric function calculating air specific heat given air humidity ratio and dry-bulb temperature

<span>$MinAirFlowFrac$</span>    = User-specified zone minimum air flow fraction

<span>${\dot m_{max}}$</span>              = Terminal unit maximum air mass flow rate, kg/s

The outdoor air input requirements, if entered, are then used to adjust the terminal unit air mass flow rate to ensure the correct amount of outdoor air enters the zone (within the constraints of the terminal unit maximum and minimum flow rate inputs). The amount of outdoor air is calculated per the outdoor air requirements and is adjusted by the fraction of outdoor air entering the air loop outdoor air system.

<div>$$\mathop m\limits^\cdot   = MAX\left( {\mathop m\limits^\cdot  ,\,{\raise0.7ex\hbox{${\mathop {{m_{OA}}}\limits^\cdot  }$} \!\mathord{\left/ {\vphantom {{\mathop {{m_{OA}}}\limits^\cdot  } {OAFrac}}}\right.}\!\lower0.7ex\hbox{${OAFrac}$}}} \right)$$</div>

where:

<span>${\mathop m\limits^\cdot_{OA}}$</span> = zone outdoor air flow rate, kg/s

<span>$OAFrac$</span> = fraction of outdoor air entering the air loop outside air system

The damper position is then calculated as:

<div>$$FRA{C_{damper}} = {\raise0.7ex\hbox{${\dot m}$} \!\mathord{\left/ {\vphantom {{\dot m} {{{\dot m}_{max}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{max}}}$}}$$</div>

where

<span>$FRA{C_{damper}}$</span>  = Output variable ‘Zone Air Terminal VAV Damper Position’, fraction of maximum flow

If the flow rate was between the maximum flow rate and the minimum flow rate for the terminal unit, then no other calculations are needed.  However, if the flow was reset to either the maximum or minimum flow rate, then flow through the active duct must be balanced by flow through the other duct to achieve the proper conditioning.

#### References

No specific references.  Refer to the ASHRAE Handbook series for general information on different system types as needed.

### Dual Duct Dedicated Outside Air Terminal with VAV Cooling

#### Overview

The input object AirTerminal:DualDuct:VAV:OutdoorAir provides a model for dedicated outside air combined with recirculated air for cooling.  This air terminal has two inlets and one outlet. The outdoor air inlet has one damper that is controlled to meet the air flow requirements for ventilation.  The second inlet is for cool recirculated air and has a second damper that is controlled to meet the zone’s cooling loads.  The two streams are then mixed and inlet to the zone.  This unit is for central air systems (using AirLoopHVAC object).  Because of the limitation in EnergyPlus of allowing only one air terminal per zone, the dual duct approach offers advantages in that it allows modeling dedicated outdoor air systems (DOAS) and central VAV cooling at the same time.  The original motivation for adding this terminal was to model twin-fan, twin-coil systems.

The recirculated cool air duct is actually optional. If no node name is input for the recirculated air inlet node, then only the outdoor air duct is operational and the air terminal behaves as a single duct.  This offers additional capabilities for single duct DOAS in that this terminal can request outdoor air flows that change over time but are not controlled to meet zone loads.

#### Model Description

The model attempts to meet the ventilation requirements and the cooling loads of a particular zone.  If the zone requires heating, ancilliary heating equipment is needed as this terminal cannot do any heating.  The model first determines the current required outdoor air flow rate for ventilation and then calculates the flow of cool air needed to reach the cooling setpoint.

The outdoor air rate is controlled by the schedule and specifications contained in a DesignSpecification:OutdoorAir object and can be based on flows per person, per zone, per area, or air changes per hour.  Using the key CurrentOccupancy, the per person rate can be set to operate based on the current occupancy level to model demand controlled ventilation. Using the key DesignOccupancy it can be set to operate based on the design, or maximum, level of occupancy.   The outdoor air inlet side of the terminal is assigned a design maximum flow rate based on the largest flow rates specified by the associated DesignSpecification:OutdoorAir object. This maximum for the outdoor air is used to calculate the damper position and contributes to the overall maximum if that is autosized.

The recirculated cool air flow rate is controlled to meet the zone cooling loads.  The first step is to calculate the impact that the outdoor air flow has on the loads starting with the specific heats.

<div>$${c_{p,zone}} = PsyCpAirFnWTdb\left( {{\omega_{zone}},{T_{zone}}} \right)$$</div>

<div>$${c_{p,OA}} = PsyCpAirFnWTdb\left( {{\omega_{OA}},{T_{OA}}} \right)$$</div>

<div>$${c_{p,RC}} = PsyCpAirFnWTdb\left( {{\omega_{RC}},{T_{RC}}} \right)$$</div>

where,

<span>${c_{p,zone}} = $</span> specific heat of zone air being served by the terminal unit, J/kg-K

<span>${c_{p,OA}} = $</span> specific heat of outdoor air entering the terminal unit, J/kg-K

<span>${c_{p,RC}} = $</span> specific heat of the recirculated (cool) air entering the terminal unit (if present), J/kg-K

<span>${\omega_{zone}} = $</span>humidity ratio of the zone air, kg/kg

<span>${\omega_{OA}} = $</span>humidity ratio of the outdoor air entering the terminal unit, kg/kg

<span>${\omega_{RC}} = $</span>humidity ratio of the recirculated air entering the terminal unit, kg/kg

<span>${T_{zone}} = $</span>air drybulb temperature of the zone, ºC

<span>${T_{OA}} = $</span>air drybulb temperature of the outdoor air entering the terminal unit, ºC

<span>${T_{RC}} = $</span>air drybulb temperature of the recirculated cool air entering the terminal unit, ºC

<span>$PsyCpAirFnWTdb$</span> is a psychrometric function for calculating the specific heat of moist air as a function of humidity ratio and drybulb temperature.

The contribution to zone load provided by the outdoor air toward meeting the cooling setpoint, <span>${\dot Q_{OA}}$</span> (W), is then calculated using:

<div>$${\dot Q_{OA}} = {\dot m_{OA}}\left( {{c_{p,OA}}{T_{OA}} - {c_{p,zone}}{T_{zonesetpoint}}} \right)$$</div>

where,

<span>${\dot m_{OA}} = $</span>is the mass flow rate of outdoor air determined by the outdoor air requirement, kg/s

<span>${T_{zonesetpoint}} = $</span>is the zone cooling setpoint drybulb temperature, ºC

This is then used to calculate the load that the recirculated cool air should deliver, <span>${Q_{RC}}$</span> (W):

<div>$${\dot Q_{RC}} = {\dot Q_{ToCoolSetpointRemain - }}{\dot Q_{OA}}$$</div>

where,

<span>${\dot Q_{ToCoolSetpointRemain = }}$</span> is the remaining load to cooling setpoint as determined by Predictor and including the impacts of any other zone equipment sequenced before this terminal. Then the recirculated cool air mass flow rate, <span>${\dot m_{RC}}$</span> (kg/s), is calculated using:

<div>$${\dot m_{RC}} = \frac{{{{\dot Q}_{RC}}}}{{\left( {{c_{p,RC}}{T_{RC}} - {c_{p,zone}}{T_{zone}}} \right)}}$$</div>

The model also includes a form of damping where the last three values for <span>${\dot m_{RC}}$</span> are stored and used to detect if the solution is oscillating from one iteration to the next and if it is then the new value is not used but rather the value from the previous iteration is used.  Once the two mass flows are known, the moist air properties of the outlet node are calculated using mass flow weighting.

#### References

Sekhar, S. C., K. W. Tham, et al. (2004). Development of energy-efficient single-coil twin-fan air-conditioning system with zonal ventilation control, Nashville, TX, United states, Amer. Soc. Heating, Ref. Air-Conditoning Eng. Inc.

Boilers <a name="Boilers"></a>
-------

### Simple Hot Water Boiler

The input object Boiler:HotWater provides a simple model for boilers that only requires the user to supply the nominal boiler capacity and thermal efficiency. An efficiency curve can also be used to more accurately represent the performance of non-electric boilers but is not considered a required input. The fuel type is input by the user for energy accounting purposes.

The model is based the following three equations

<div>$$OperatingPartLoadRatio = \frac{{BoilerLoad}}{{BoilerNomCapacity}}$$</div>

<div>$$TheoreticalFuelUse = \frac{{BoilerLoad}}{{NominalThermalEfficiency}}$$</div>

<div>$$FuelUsed = \frac{{TheoreticalFuelUse}}{{BoilerEfficiencyCurveOuput}}$$</div>

-or-

<div>$$FuelUsed = \frac{{BoilerLoad}}{{\left( {NominalThermalEfficiency} \right)\left( {BoilerEfficiencyCurveOutput} \right)}}$$</div>

The final equation above includes the impact of the optional boiler efficiency performance curve. To highlight the use of the normalized boiler efficiency curve, the fuel use equation is also shown in an expanded format. The normalized boiler efficiency curve represents the changes in the boiler’s nominal thermal efficiency due to loading and changes in operating temperature. If the optional boiler efficiency curve is not used, the boiler’s nominal thermal efficiency remains constant throughout the simulation (i.e., BoilerEfficiencyCurveOutput = 1).

When a boiler efficiency performance curve is used, any valid curve object with 1 or 2 independent variables may be used. The performance curves are accessed through EnergyPlus’ built-in performance curve equation manager (curve objects). The linear, quadratic, and cubic curve types may be used when boiler efficiency is solely a function of boiler loading, or part-load ratio (PLR). These curve types are used when the boiler operates at the specified setpoint temperature throughout the simulation. Other curve types may be used when the boiler efficiency can be represented by both PLR and boiler operating temperature. Examples of valid single and dual independent variable equations are shown below. For all curve types, PLR is always the x independent variable. When using curve types with 2 independent variables, the boiler water temperature (Twater) is always the y independent variable and can represent either the inlet or outlet temperature depending on user input.

#### Single independent variable:

* <span>$BoilerEfficiencyCurve = C1 + C2\left( {PLR} \right)$</span> (Linear)

* <span>$BoilerEfficiencyCurve = C1 + C2\left( {PLR} \right) + C3{\left( {PLR} \right)^2}$</span> (Quadratic)

* <span>$BoilerEfficiencyCurve = C1 + C2\left( {PLR} \right) + C3{\left( {PLR} \right)^2} + C4{(PLR)^3}$</span> (Cubic)

#### Dual independent variables:

* <span>$BoilerEfficiencyCurve = C1 + C2\left( {PLR} \right) + C3{\left( {PLR} \right)^2} + \left( {C4 + C5\left( {PLR} \right) + C6{{\left( {PLR} \right)}^2}} \right)\left( {Twater} \right)$</span> (QuadraticLinear)

* <span>$BoilerEfficiencyCurve = C1 + C2\left( {PLR} \right) + C3{\left( {PLR} \right)^2} + C4\left( {Twater} \right) + C5{(Twater)^2} + C6(PLR)(Twater)$</span> (Biquadratic)

* <span>$BoilerEfficiencyCurve = C1 + C2\left( {PLR} \right) + C3{\left( {PLR} \right)^2} + C4\left( {Twater} \right) + C5{(Twater)^2} + C6\left( {PLR} \right)\left( {Twater} \right) + C7{(PLR)^3} + C8{(Twater)^3} + C9{\left( {PLR} \right)^2}\left( {Twater} \right) + C10\left( {PLR} \right){(Twater)^2}$</span> (Bicubic)

When a boiler efficiency curve is used, a constant efficiency boiler may be specified by setting C1 = 1 and all other coefficients to 0. A boiler with an efficiency proportional to part-load ratio or which has a non-linear relationship of efficiency with part-load ratio will typically set the coefficients of a linear, quadratic, or cubic curve to non-zero values. Using other curve types allows a more accurate simulation when boiler efficiency varies as a function of part-load ratio and as the boiler outlet water temperature changes over time due to loading or as changes occur in the water temperature setpoint.

The parasitic electric power is calculated based on the user-defined parasitic electric load and the operating part load ratio calculated above. The model assumes that this parasitic power does not contribute to heating the water.

<div>$${P_{parasitic}} = {P_{load}}\left( {PLR} \right)$$</div>

where:

<span>${P_{parasitic}}$</span>= parasitic electric power (W), average for the simulation time step

<span>${P_{load}}$</span>    = parasitic electric load specified by the user (W)

### Steam Boiler

#### Description of Model

A steam boiler is the essential part of a building steam heating system and can be described as primary driver of the steam loop.  It is the component that maintains the desired loop temperature.

The emphasis in EnergyPlus was laid on developing a building simulation model for steam boiler with ability to model detailed boiler performance without the cost of exhaustive user inputs to the boiler model.  The Boiler:Steam input object is used on the plant loop supply side of EnergyPlus with the primary purpose of supplying steam to the heating coils, which constitute the demand side of the loop.

The steam boiler is a variable mass flow rate device.  The mass flow rate of steam through the boiler is determined by the heating demand on the loop which in turn is determined by the equipment that is hooked to the demand side of the loop, namely the steam coils and hot water heater.  In short, the steam coil determines the mass flow rate of steam required for heating the zone to its required setpoint, the mixer sums up the total steam demanded by each of the individual coils and reports it to the boiler via the pump.

![SteamBoilerInSteamLoop](EngineeringReference/media/image2932.png)

Figure 158.  Schematic of Steam Boiler in the Steam loop



Figure 158 describes the rudimentary loop structure with steam flowing from coils to boiler.  It is essential to mention that it is the coils that determine the mass of steam required and the boiler simply delivers the required mass flow at desired temperature provided it is adequately sized.  The algorithm for determining the mass flow rate is structured on the demand side and the variable flow boiler has no role to play in determining the steam mass flow.

Figure 159 outlines the simple steam boiler model.  Sub cooled water enters the variable flow boiler through the pump, the boiler inputs energy to water stream consuming fuel, boiler losses are accounted via boiler efficiency.  The boiler delivers steam at a quality equal to 1.0 at saturated condition.

The advantage of steam heating systems over hot water is the high latent heat carrying capacity of steam, which reduces the mass flow rate of the fluid required.  The amount of superheated and sub cooled heat transfer in Steam heating systems is negligible, latent heat transfer accounts for almost all of the heat exchange into the zones via steam to air heat exchangers.

![SteamBoilerOperation](EngineeringReference/media/image2933.png)

Figure 159.  Schematic of Steam Boiler Operation

Boiler Load is a summation of sensible and latent heat addition to the water stream as described with the following equation.  The mass flow rate through the boiler is known, while delta temp is the temperature difference between the boiler inlet and boiler outlet.  Latent heat of steam is calculated at loop operating temperature.

<div>$${Q_B} = \,\dot m\, \times \left[ {({c_{p,w}} \times \Delta T)\,\,\, + \,\,\,{h_{fg}}} \right]$$</div>

Theoretical fuel used is calculated with the following equation.  Boiler efficiency is a user input and accounts for all the losses in the steam boiler.

<div>$${F_t} = \frac{{{Q_B}}}{{{\eta_B}}}$$</div>

The operation part load ratio is calculated with the following equation.  This is later used to calculate the actual fuel consumption, its ratio of boiler load to boiler nominal capacity.

<div>$${O_{PLR}} = \frac{{{Q_B}}}{{{Q_{B,N}}}}$$</div>

The actual fuel consumption by the boiler is calculated as using the following equation, where C1, C2, and C3 are the Part Load Ratio coefficients.

<div>$${F_{}} = \frac{{{F_t}}}{{{C_1}\,\, + \,\,{C_2}\,\, \times \,\,{O_{PLR}}\,\, + \,\,{C_3} \times \,{O_{PLR}}^2\,}}$$</div>

Essentially the boiler model provides a first order approximation of performance for fuel oil, gas, and electric boilers.  Boiler performance is based on theoretical boiler efficiency and a single quadratic fuel use-part load ratio curve represented in the equation above.  This single curve accounts for all combustion inefficiencies and stack losses.

The control algorithm for a steam boiler is an important issue.  The user may want the boiler to be undersized and in such a case it will not be able to meet the demand side steam flow request.  Subsequently the boiler load exceeds the boiler nominal capacity.  The boiler operates at its nominal capacity but is unable to meet the plant heating demand.  Pseudo code from EnergyPlus has been used to describe the control logic used in the steam boiler simulation.



\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*PSEUDO CODE SECTION STARTS\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

At start of simulation an initial value of steam mass flow rate is calculated.  This is required to start the flow of steam around the loop.

<div>$$If\,\,\,\,(FirstTimeThrough)\,\,\,THEN$$</div>

Calculate the boiler supply steam mass flow rate at start of simulation.

<div>$$\,{\dot m_s}\,\, = \,\,\frac{{{Q_B}}}{{{h_{fg\,\,\, + }}\,\,{c_{p,w}}\,\, \times \Delta {T_{loop}}\,\,}}$$</div>

<div>$$ELSE$$</div>   ! Not first time through

Steam boiler calculations rely heavily on the variable <span>$\dot m$</span><sub>b</sub>, boiler mass flow rate.  This variable <span>$\dot m$</span><sub>b</sub> is the assigned equal to mass flow at boiler inlet node for preliminary calculations.

<div>$$\,{\dot m_b}\,\,\, = \,\,\,\mathop {\,{{\dot m}_{Inlet\_Node}}}\limits^{} $$</div>

Calculating the boiler delta temperature difference between the inlet and outlet nodes.  This calculation is used to determine various boiler control situation.

<div>$$\Delta {T_{in\_out}}\,\, = \,\,{T_{SP}}\,\, - \,\,{T_{in}}$$</div>

In case the temperature difference calculated with the previous equation equation  is zero then the boiler just needs to supply latent heat to steam, else the boiler performs its normal load calculations by providing both sensible and latent heat to the inlet stream.

<div>$$If\,\,(\Delta {T_{in\_out}}\,\, < \,\,\,\,0\,\,\,)\,\,\,THEN$$</div>

<div>$${Q_B}\,\, = \,\,\,{\dot m_b}\,\,\, \times \,\,{h_{fg}}$$</div>

<div>$$ELSE$$</div>

<div>$${Q_B}\,\, = \,\,\,{\dot m_b}\,\,\, \times \,\,(\,\,\,{h_{fg}} + \,\,{c_{p,w}} \times \Delta {T_{in\_out}}\,\,)$$</div>

<div>$$End\,\,If$$</div>

Sometimes the boiler load Q<sub>B</sub> is greater than the demand side requested load at the current time step, which may occur because the boiler inlet conditions is from previous time step.  There is sudden fall in request of steam mass flow from the demand side.  The boiler now recalculates its new mass flow and adjusts to these new conditions.

<div>$$If\,\,({Q_B}\,\, > \,\,{Q_{HeatingDemand}}\,\,\,)\,\,\,THEN$$</div>

Boiler load is set equal to the new boiler heating demand and steam mass flow rate is recalculated.

<div>$${Q_B}\,\, = \,\,{Q_{HeatingDemand}}$$</div>

<div>$$\,{\dot m_s}\,\,\, = \,\,\frac{{{Q_B}}}{{{h_{fg\,\,\, + }}\,\,{c_{p,w}}\,\, \times \Delta {T_{loop}}\,\,}}$$</div>

<div>$$End\,\,If$$</div>

In case the requested load exceeds the boiler nominal capacity, which is its maximum heating capacity.  In this case the requested steam mass flow is not met and the zone is not heated adequately.  This happens if the boiler is undersized.  The steam mass flow rate is recalculated at nominal capacity.

<div>$$If\,\,({Q_B}\,\, > \,\,{Q_{No\min al\_Capacity}}\,\,\,)\,\,\,THEN$$</div>

Boiler load is set equal to boiler nominal capacity and steam mass flow rate recalculated.

<div>$${Q_B}\,\, = \,\,{Q_{No\min al\_Capacity}}$$</div>

<div>$$\,{\dot m_s}\,\,\, = \,\,\frac{{{Q_B}}}{{{h_{fg\,\,\, + }}\,\,{c_{p,w}}\,\, \times \Delta {T_{loop}}\,\,}}$$</div>

<div>$$End\,\,If$$</div>

<div>$$End\,\,If$$</div>

End If statement for the boiler load control algorithm.  This algorithm determines all possible control conditions that might while simulating a system in EnergyPlus.



\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*PSEUDO CODE SECTION ENDS\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*

If the boiler operating pressure exceeds the maximum allowable boiler pressure, the simulation trips and outputs a warning regarding the same.  This notifies the user about potential system pressure sizing problems.

Integration of the steam boiler simulation model in EnergyPlus required developing number of subroutines, which operate in sequence.  These subroutines are designed to read inputs from the input file, initialize the variables used in the boiler simulation model, simulate the boiler performance, update the node connections, and report the required variables.  In case the user has difficulty with boiler inputs, provisions have been made to auto size the boiler nominal capacity and maximum steam flow rate.  These two values play an important role in sizing the boiler.

#### Model Assumptions

The EnergyPlus boiler model is “simple” in the sense that it requires the user to supply the theoretical boiler efficiency.  The combustion process is not considered in the model.  The model is independent of the fuel type, which is input by the user for energy accounting purposes only.  This is an ideal model for Building Simulation Program such that it utilizes the desired amount of resources in terms of simulation run time, but successfully provides fairly good sizing parameters for an actual boiler.

It is assumed that the steam boiler operates to maintain a desired temperature, the temperature being saturation temperature of steam and corresponding to this saturation temperature there exist a single value of saturation pressure at which the loop operates.  Hence the boiler could either be saturation pressure controlled or temperature controlled.  Since users would have better idea of steam temperatures rather than pressure the boiler inputs are designed for temperature control.

#### Nomenclature for Steam Loop

Table 50.  Steam Loop Nomenclature

<table class="table table-striped">





<tr>
<td><span>${Q_B}$</span></td>
<td>Boiler Heat Transfer.  W.</td>
</tr>
<tr>
<td><span>${Q_{B,N}}$</span></td>
<td>Boiler Nominal Capacity.  W.</td>
</tr>
<tr>
<td><span>$\,{O_{PLR}}$</span></td>
<td>Boiler Operating Part Load Ratio. </td>
</tr>
<tr>
<td><span>$\Delta {T_{sc}}$</span></td>
<td>Degree of subcooling in coil. </td>
</tr>
<tr>
<td><span>$\Delta {T_{in\_out}}$</span></td>
<td>Temperature difference across the steam boiler.  ºC.</td>
</tr>
<tr>
<td><span>${\rho_w}$</span></td>
<td>Density of condensate entering the pump.  Kg/m3. </td>
</tr>
<tr>
<td><span>${Q_{Des}}$</span></td>
<td>Design Load on the steam coil.  W.</td>
</tr>
<tr>
<td><span>${h_{f,\,n}}$</span></td>
<td>Enthalpy of fluid at point n on the Ts diagram.  J/kg.</td>
</tr>
<tr>
<td><span>${P_{Frac}}$</span></td>
<td>Fraction of Pump Full Load Power.  W.</td>
</tr>
<tr>
<td><span>${F_{m,f}}$</span></td>
<td>Fractional Motor Power Lost to Fluid.  W.</td>
</tr>
<tr>
<td><span>${Q_{a,l}}$</span></td>
<td>Heating load on the Air Loop Steam Coil.  W.</td>
</tr>
<tr>
<td><span>${Q_{z,c}}$</span></td>
<td>Heating load on the Zone Steam Coil.  W.</td>
</tr>
<tr>
<td><span>${h_{fg,{T_{Loop}}}}$</span> </td>
<td>Latent heat of steam at Loop operating Temperature.  J/kg.</td>
</tr>
<tr>
<td><span>${h_{fg}}$</span></td>
<td>Latent Heat of Steam.  J/kg.</td>
</tr>
<tr>
<td><span>${Q_{L,H}}$</span></td>
<td>Latent Heat Part of the Heating Coil Load.  W.</td>
</tr>
<tr>
<td><span>$\Delta {Q_{loss}}$</span></td>
<td>Loop losses in steam coil.  W.</td>
</tr>
<tr>
<td><span>$\Delta {T_{loop\,\,}}$</span></td>
<td>Loop Temperature Difference.</td>
</tr>
<tr>
<td><span>${\dot m_a}$</span></td>
<td>Mass flow rate for steam coil Kg/s.</td>
</tr>
<tr>
<td><span>${\dot m_{in}}$</span></td>
<td>Mass flow rate of steam entering the steam coil .Kg/s.</td>
</tr>
<tr>
<td><span>${\dot m_{a,l}}$</span></td>
<td>Mass flow rate of steam for Air loop steam coil Kg/s</td>
</tr>
<tr>
<td><span>${\dot m_{z,c}}$</span></td>
<td>Mass flow rate of steam for zone steam coil Kg/s.</td>
</tr>
<tr>
<td><span>${\dot m_s}$</span></td>
<td>Mass flow rate of steam.  Kg/s.</td>
</tr>
<tr>
<td><span>${\dot m_{loop}}$</span></td>
<td>Mass flow rate of steam for the steam loop.  Kg/s.</td>
</tr>
<tr>
<td><span>$\dot m$</span></td>
<td>Mass of condensate entering the pump.  Kg/s.</td>
</tr>
<tr>
<td><span>${\dot m_{a,\max }}$</span> </td>
<td>Maximum allowed mass flow rate of air.  Kg/s</td>
</tr>
<tr>
<td><span>${\dot m_{S,\max }}$</span></td>
<td>Maximum Mass flow rate of steam Kg/s</td>
</tr>
<tr>
<td><span>${\dot m_{B,Supply}}$</span></td>
<td>Maximum steam mass flow rate supplied by boiler.  Kg/s.</td>
</tr>
<tr>
<td><span>${\dot V_{w,\max }}\,\,$</span></td>
<td>Maximum Volume flow rate of condensate in pump.  m<sup>3</sup> /s.</td>
</tr>
<tr>
<td><span>${\dot V_{w,loop}}$</span></td>
<td>Maximum Volume flow rate of condensate in steam loop.  m<sup>3</sup> /s.</td>
</tr>
<tr>
<td><span>${T_{a,\,\,in,\,\,\min }}$</span></td>
<td>Minimum inlet air temperature possible.  ºC.</td>
</tr>
<tr>
<td><span>${P_n}\,\,$</span></td>
<td>Nominal Power Capacity for condensate pump.  W.</td>
</tr>
<tr>
<td><span>${P_{nom}}$</span></td>
<td>Nominal power of the pump.  W.</td>
</tr>
<tr>
<td><span>${H_n}$</span></td>
<td>Nominal Pump Head.  M.</td>
</tr>
<tr>
<td><span>${\dot V_{nom}}$</span></td>
<td>Nominal volume flow rate through the condensate pump.  m<sup>3</sup> /s.</td>
</tr>
<tr>
<td><span>$PLR$</span></td>
<td>Part Load Ratio for condensate pump.</td>
</tr>
<tr>
<td><span>${\eta_{\rm{p}}}$</span></td>
<td>Pump efficiency.</td>
</tr>
<tr>
<td><span>${\eta_m}$</span></td>
<td>Pump Motor Efficiency.</td>
</tr>
<tr>
<td><span>${P_{}}$</span></td>
<td>Pump Power.  W.</td>
</tr>
<tr>
<td><span>${Q_{S,H}}$</span></td>
<td>Sensible Heat Part of the Heating Coil Load.  W.</td>
</tr>
<tr>
<td><span>${T_{sp}}$</span></td>
<td>Setpoint Temperature of the zone.  ºC.</td>
</tr>
<tr>
<td><span>${T_{a,out,SP}}$</span></td>
<td>Setpoint air outlet temperature for the steam coil.  ºC.</td>
</tr>
<tr>
<td><span>${P_S}$</span></td>
<td>Shaft power of the pump.  W.</td>
</tr>
<tr>
<td><span>$\,\,{c_{p,\,a}}$</span></td>
<td>Specific Heat Capacity for Air.  J/Kg K.</td>
</tr>
<tr>
<td><span>$\,\,{c_{p,\,w}}$</span></td>
<td>Specific Heat Capacity for Water.  J/Kg K.</td>
</tr>
<tr>
<td><span>${\eta_B}$</span></td>
<td>Steam Boiler Efficiency.</td>
</tr>
<tr>
<td><span>$\,Ta,\,i{n_{}}\,$</span></td>
<td>Temperature of air entering the coil.  ºC.</td>
</tr>
<tr>
<td><span>${T_a}$</span></td>
<td>Temperature of air entering the steam coil.  ºC.</td>
</tr>
<tr>
<td><span>$Ta,out\,\,\,\,\,$</span></td>
<td>Temperature of air leaving the coil.  ºC.</td>
</tr>
<tr>
<td><span>$Ts,in$</span></td>
<td>Temperature of steam entering the coil.  ºC.</td>
</tr>
<tr>
<td><span>${F_t}$</span></td>
<td>Theoretical Fuel Consumption by the Steam Boiler.  W.</td>
</tr>
<tr>
<td><span>${\dot m_{coils,R}}$</span></td>
<td>Total Mass flow rate requested by all the steam coils.  Kg/s.</td>
</tr>
<tr>
<td><span>$\dot V$</span></td>
<td>Volume of condensate entering the pump.  m<sup>3</sup> /s.</td>
</tr>
<tr>
<td><span>$Tw,\,out$</span></td>
<td>Water outlet temperature from pump.  ºC.</td>
</tr>

</table>

#### References

ASHRAE Handbook. 1996. HVAC Systems and Equipment, Air Conditioning and Heating Systems.  Chapter 10, Steam Systems.  pp.* * 10.1-10.16. 1996.

*BLAST 3.0 Users Manual*. 1999. Building Systems Laboratory.  Urbana-Champaign: Building Systems Laboratory, Department of Mechanical and Industrial Engineering, University of Illinois.

Chillar, R.J. 2005. “Development and Implementation of a Steam Loop In The Building Energy Simulation Program EnergyPlus,” M.S. Thesis, Department of Mechanical and Industrial Engineering, University of Illinois at Urbana-Champaign.

*TRNSYS 16 User Manual*. 2004. A Transient System Simulation Program. Solar Energy Laboratory, Madison. University of Wisconsin-Madison.

El-Wakil, M. M. 1984. Power Plant Technology, McGraw Hill, New York, pp.   30-72.

Babcock & Wilcox. 1978. Steam-Its Generation and Use, The Babcock & Wilcox Company, New York ,Section I, II, IV, and VII.

S.A. Klein. 2004. Engineering Equation Solver EES. University of Wisconsin Madison.

Chillers <a name="Chillers"></a>
--------

### Absorption Chiller

The input object Chiller:Absorption provides a model for absorption chillers that is an empirical model of a standard absorption refrigeration cycle.  The condenser and evaporator are similar to that of a standard chiller, which are both water-to-water heat exchangers.  The assembly of a generator and absorber provides the compression operation.  Low-pressure vapor from the evaporator is absorbed by the liquid solution in the absorber.  A pump receives low-pressure liquid from the absorber, elevates the pressure of the liquid, and delivers the liquid to the generator.  In the generator, heat from a high temperature source (hot water or steam) drives off the vapor that has been absorbed by the solution.  The liquid solution returns to the absorber through a throttling valve whose purpose is to provide a pressure drop to maintain the pressure difference between the generator and absorber.  The heat supplied to the absorber can be waste heat from a diesel jacket, or the exhaust heat from diesel, gas, and steam turbines.  For more information on absorption chillers, see the Input/Output Reference Document (Object: Chiller:Absorption).

The part-load ratio of the absoprtion chiller’s evaporator is simply the actual cooling effect produced by the chiller divided by the maximum cooling effect available.

<div>$$PLR = {\raise0.7ex\hbox{${{{\dot Q}_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{evap}}} {{{\dot Q}_{evap,\,\,rated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot Q}_{evap,\,\,rated}}}$}}$$</div>

where

<span>$PLR$</span> = part-load ratio of chiller evaporator

<span>${\dot Q_{evap}}$</span> = chiller evaporator load [W]

<span>${\dot Q_{evap,\,rated}}$</span> = rated chiller evaporator capacity [W]

This absorption chiller model is based on a polynomial fit of absorber performance data.  The Generator Heat Input Part Load Ratio Curve is a quadratic equation that determines the ratio of the generator heat input to the *demand* on the chiller’s evaporator (Q<sub>evap</sub>).

<div>$$GeneratorHeatInputRatio = \frac{{C1}}{{PLR}} + C2 + C3\left( {PLR} \right)$$</div>

The Pump Electric Use Part Load Ratio Curve is a quadratic equation that determines the ratio of the actual absorber pumping power to the nominal pumping power.

<div>$$ElectricInputRatio = C1 + C2 * PLR + C3 * PL{R^2}$$</div>

Thus, the coefficient sets establish the ratio of heat power in-to-cooling effect produced as a function of part load ratio.  The ratio of heat-power-in to cooling-effect-produced is the inverse of the coefficient of performance.

If the operating part-load ratio is greater than the minimum part-load ratio, the chiller will run the entire time step and cycling will not occur (i.e. *CyclingFrac* = 1). If the operating part-load ratio is less than the minimum part-load ratio, the chiller will be on for a fraction of the time step equal to *CyclingFrac*. Steam (or hot water) and pump electrical energy use are also calculated using the chiller part-load cycling fraction.

<div>$$CyclingFrac = MIN\left( {1,\frac{{PLR}}{{PL{R_{min}}}}} \right)$$</div>

<div>$${\dot Q_{generator}} = GeneratorHeatInputRatio\left( {{{\dot Q}_{evap}}} \right)\left( {CyclingFrac} \right)$$</div>

<div>$${\dot Q_{pump}} = ElectricInputRatio\left( {{P_{pump}}} \right)\left( {CyclingFrac} \right)$$</div>

where

<span>$CyclingFrac$</span> = chiller part-load cycling fraction

<span>$PL{R_{min}}$</span> = chiller minimum part-load ratio

<span>${\dot Q_{generator}}$</span> = generator input power [W]

<span>${\dot Q_{pump}}$</span> = absorbtion chiller pumping power [W]

The evaporator water mass flow rate is calculated based on the Chiller Flow Mode as follows.

**Constant Flow Chillers:**

**<span>${\dot m_{evap}} = {\dot m_{evap,max}}$</span>**

**Variable Flow Chillers:**

<div>$$\Delta {T_{evap}} = {T_{evap,\,in}} - {T_{evap,\,SP}}$$</div>

<div>$${\dot m_{evap}} = {\raise0.7ex\hbox{${{{\dot Q}_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{evap}}} {{C_{p,\,evap}}\left( {\Delta {T_{evap}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,evap}}\left( {\Delta {T_{evap}}} \right)}$}}$$</div>

where

<span>${\dot m_{evap}}$</span>          = chiller evaporator water mass flow rate (kg/s)

<span>${\dot m_{evap,\,max}}$</span>     = chiller design evaporator water mass flow rate (kg/s)

<span>$\Delta {T_{evap}}$</span>        = chiller evaporator water temperature difference (ºC)

<span>${T_{evap,\,in}}$</span>        = chiller evaporator inlet water temperature (ºC)

<span>${T_{evap,\,SP}}$</span>       = chiller evaporator outlet water setpoint temperature (ºC)

<span>${C_p}$</span>              = specific heat of water entering evaporator (J/kg•ºC)

The evaporator outlet water temperature is then calculated based on the cooling effect produced and the evaporator entering water temperature.

<div>$${T_{evap,out}} = {T_{evap,in}} + {\raise0.7ex\hbox{${{{\dot Q}_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{evap}}} {{C_{p,\,evap}}\left( {{{\dot m}_{evap}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,evap}}\left( {{{\dot m}_{evap}}} \right)}$}}$$</div>

where

<span>${T_{evap,out}}$</span> = chiller evaporator outlet water temperature [ºC]

<span>${T_{evap,in}}$</span> = chiller evaporator inlet water temperature [ºC]

<span>${C_{p,\,evap}}$</span> = specific heat of chiller evaporator inlet water [J/kg/ºC]

<span>${\dot m_{evap}}$</span> = chiller evaporator water mass flow rate [kg/s]

The condenser heat transfer and condenser leaving water temperature are also calculated.

<div>$${\dot Q_{cond}} = {\dot Q_{evap}} + {\dot Q_{generator}} + {\dot Q_{pump}}$$</div>

<div>$${T_{cond,out}} = {T_{cond,in}} + {\raise0.7ex\hbox{${{{\dot Q}_{cond}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{cond}}} {{C_{p,\,cond}}\left( {{{\dot m}_{cond}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,cond}}\left( {{{\dot m}_{cond}}} \right)}$}}$$</div>

where

<span>${\dot Q_{cond}}$</span> = chiller condenser heat transfer rate [W]

<span>${T_{cond,out}}$</span> = chiller condenser outlet water temperature [ºC]

<span>${T_{cond,in}}$</span> = chiller condenser inlet water temperature [ºC]

<span>${C_{p,\,cond}}$</span> = specific heat of chiller condenser inlet water [J/kg/ºC]

<span>${\dot m_{cond}}$</span> = chiller condenser water mass flow rate [kg/s]

The absorption chiller can model the impact of steam or hot water entering the generator, although the connection of the steam (hot water) nodes to a plant is not actually required. The calculations specific to the generator depend on the type of fluid used and are described here in further detail.

#### Steam Loop Calculations

When a steam loop is used and the inlet and outlet node names are specified (i.e. the nodes are connected to a steam loop), the generator outlet node steam mass flow rate and temperature are calculated based on the generator input power, latent heat of steam, the specific heat of water, and the amount of subcooling in the steam generator. The model assumes dry saturated steam enters the absorption chiller’s generator and exits the generator as a subcooled liquid. The temperature leaving the generator is calculated based on the user entered amount of liquid subcooling in the generator. The effect of subcooling of the liquid (condensate) in the pipe returning to the boiler is not modeled.

<div>$${\dot m_{steam}}\,\,\,\, = \,\,\,\,\,\frac{{{{\dot Q}_{generator}}}}{{{h_{fg}} + {c_{p,\,water}} \times \Delta {T_{sc}}}}$$</div>

<div>$${T_{generator,out}} = {T_{generator,in}} - \Delta {T_{sc}}$$</div>

where

<span>${\dot m_{steam}}$</span> = chiller steam mass flow rate [kg/s]

<span>${h_{fg}}$</span> = latent heat of steam [J/kg]

<span>${c_{p,\,water}}$</span> = specific heat of saturated water in the generator [J/Kg ºK]

<span>$\Delta {T_{sc}}$</span> = amount of subcooling in steam generator [ºC]

<span>${T_{generator,out}}$</span> = generator steam outlet node temperature [ºC]

<span>${T_{generator,in}}$</span> = generator steam inlet node temperature [ºC]

#### Hot Water Loop Calculations

When a hot water loop is used and the inlet and outlet node names are specified (i.e. the nodes are connected to a hot water loop), the generator outlet node temperature is calculated based on the generator input power, mass flow rate of water, and the specific heat of water entering the hot water generator. The calculations are based on the Chiller Flow Mode as follows.

**Constant Flow Chillers:**

<div>$${\dot m_{generator}} = {\dot m_{generator,max}}$$</div>

**Variable Flow Chillers:**

<div>$${\dot m_{generator}} = {\raise0.7ex\hbox{${{{\dot Q}_{generator}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{generator}}} {{C_{p,\,water}}\left( {\Delta {T_{generator}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,water}}\left( {\Delta {T_{generator}}} \right)}$}}$$</div>

<div>$${T_{generator,out}} = {T_{generator,in}} - \frac{{{{\dot Q}_{generator}}}}{{{{\dot m}_{generator}}\left( {{C_{p\,,\,water}}} \right)}}$$</div>

where

<span>${\dot m_{generator}}$</span> = generator hot water mass flow rate [kg/s]

<span>${\dot m_{generator,\,max}}$</span>= generator design hot water mass flow rate (kg/s)

<span>$\Delta {T_{generator}}$</span>   = generator design hot water temperature difference (ºC)

### Indirect Absorption Chiller

The Chiller:Absorption:Indirect object is an enhanced version of the absorption chiller model found in the Building Loads and System Thermodynamics (BLAST) program. This enhanced model is nearly identical to the existing absorption chiller model (Ref. Chiller:Absorption) with the exceptions that: 1) the enhanced indirect absorption chiller model provides more flexible performance curves and 2) chiller performance now includes the impact of varying evaporator, condenser, and generator temperatures. Since these absorption chiller models are nearly identical (i.e., the performance curves of the enhanced model can be manipulated to produce similar results to the previous model), it is quite probable that the Chiller:Absorption model will be deprecated in a future release of EnergyPlus.

The indirect absorption chiller’s condenser and evaporator are similar to that of a standard chiller, which are both water-to-water heat exchangers. The assembly of a generator and absorber provides the compression operation. A schematic of a single-stage absorption chiller is shown in the figure below. Low-pressure vapor from the evaporator is absorbed by the liquid solution in the absorber. A pump receives low-pressure liquid from the absorber, elevates the pressure of the liquid, and delivers the liquid to the generator. In the generator, heat from a high temperature source (hot water or steam) drives off the vapor that has been absorbed by the solution. The liquid solution returns to the absorber through a throttling valve whose purpose is to provide a pressure drop to maintain the pressure difference between the generator and absorber. The heat supplied to the generator can be either hot water or steam, however, connection to an actual plant loop is not required. For more information on indirect absorption chillers, see the Input/Output Reference Document (Object: Chiller:Absorption:Indirect).

![Schematic\_AbsorptionChiller](EngineeringReference/media/image3060.png)

Figure 160. Schematic Diagram of a Single-Stage Absorption Chiller

The chiller cooling effect (capacity) will change with a change in condenser water temperature. Similarly, the chiller cooling effect will change as the temperature of the evaporator water changes. The chiller cooling effect will also change with a change in or generator inlet water temperature and only applies when Hot Water is used as the generator heat source. A quadratic or cubic equation is used to modify the rated chiller capacity as a function of both the condenser and generator inlet water temperatures and the evaporator outlet water temperature. If any or all of the capacity correction factor curves are not used, the correction factors are assumed to be 1.

<div>$$CAPF{T_{evaporator}} = a + b\left( {{T_{evaporator}}} \right) + c{\left( {{T_{evaporator}}} \right)^2} + d{\left( {{T_{evaporator}}} \right)^3}$$</div>

<div>$$CAPF{T_{condenser}} = e + f\left( {{T_{condenser}}} \right) + g{\left( {{T_{condenser}}} \right)^2} + h{\left( {{T_{condenser}}} \right)^3}$$</div>

<span>$CAPF{T_{generator}} = i + j\left( {{T_{generator}}} \right) + k{\left( {{T_{generator}}} \right)^2} + l{\left( {{T_{generator}}} \right)^3}$</span> (*Hot Water only*)

<div>$${\mathop Q\limits^\cdot_{evap,max}} = {\mathop Q\limits^\cdot_{evap,rated}}\left( {CAPF{T_{evaporator}}} \right)\left( {CAPF{T_{condenser}}} \right)\left( {CAPF{T_{generator}}} \right)$$</div>

where

<span>$CAPF{T_{evaporator}}$</span>= Capacity correction (function of evaporator temperature) factor

<span>$CAPF{T_{condenser}} = $</span>= Capacity correction (function of condenser temperature) factor

<span>$CAPF{T_{generator}}$</span>= Capacity correction (function of generator temperature) factor

<span>${T_{evaporator}}$</span> = evaporator outet water temperature [C]

<span>${T_{condenser}}$</span> = condenser inlet water temperature [C]

<span>${T_{generator}}$</span> = generator inlet water temperature [C]

<span>${\dot Q_{evap,\,\,max}}$</span> = maximum chiller capacity [W]

<span>${\dot Q_{evap,\,\,rated}}$</span> = rated chiller capacity [W]

The part-load ratio of the indirect absoprtion chiller’s evaporator is simply the actual cooling effect required (load) divided by the maximum cooling effect available.

<div>$$PLR = {\raise0.7ex\hbox{${{{\dot Q}_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{evap}}} {{{\dot Q}_{evap,\,\,max}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot Q}_{evap,\,\,max}}}$}}$$</div>

where

<span>$PLR$</span> = part-load ratio of chiller evaporator

<span>${\dot Q_{evap}}$</span> = chiller evaporator operating capacity [W]

The generator’s heat input is also a function of several parameters. The primary input for determining the heat input requirements is the Generator Heat Input function of Part-Load Ratio Curve. The curve is a quadratic or cubic equation that determines the ratio of the generator heat input to the chiller’s maximum capacity (Q<sub>evap,\\ max</sub>) and is solely a function of part-load ratio. Typical generator heat input ratios at full load (i.e., PLR=1) are between 1 and 2. Two additional curves are available to modifiy the heat input requirement based on the generator inlet water temperature and the evaporator outlet water temperature.

<div>$$GeneratorHIR = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2} + d{\left( {PLR} \right)^3}$$</div>

<div>$$GenfCondT = e + f\left( {{T_{generator}}} \right) + g{\left( {{T_{generator}}} \right)^2} + h{\left( {{T_{generator}}} \right)^3}$$</div>

<div>$$GenfEvapT = i + j\left( {{T_{evaporator}}} \right) + k{\left( {{T_{evaporator}}} \right)^2} + l{\left( {{T_{evaporator}}} \right)^3}$$</div>

where

*GeneratorHIR* = ratio of generator heat input to chiller operating capacity

*GenfCondT* = heat input modifier based on generator inlet water temperature

*GenfEvapT* = heat input modifier based on evaporator outlet water temperature

The Pump Electric Use function of Part-Load Ratio Curve is a quadratic or cubic equation that determines the ratio of the actual absorber pumping power to the nominal pumping power.

<div>$$ElectricInputRatio = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2} + d{\left( {PLR} \right)^3}$$</div>

If the chiller operating part-load ratio is greater than the minimum part-load ratio, the chiller will run the entire time step and cycling will not occur (i.e. *CyclingFrac* = 1). If the operating part-load ratio is less than the minimum part-load ratio, the chiller will be on for a fraction of the time step equal to *CyclingFrac*. Generator heat input and pump electrical energy use are also calculated using the chiller part-load cycling fraction.

<div>$$CyclingFrac = MIN\left( {1.\frac{{PLR}}{{PL{R_{min}}}}} \right)$$</div>

<div>$${\dot Q_{generator}} = GeneratorHIR\left( {{{\dot Q}_{evap,\,max}}} \right)\left( {GenfCondT} \right)\left( {GenfEvapT} \right)\left( {CyclingFrac} \right)$$</div>

<div>$${\dot Q_{generator}} = ElectricInputRatio({P_{pump}})(CyclingFrac)$$</div>

where

<span>$CyclingFrac$</span> = chiller part-load cycling fraction

<span>$PL{R_{min}}$</span> = chiller minimum part-load ratio

<span>${\dot Q_{generator}}$</span> = generator heat input [W]

<span>${\dot Q_{pump}}$</span> = chiller pumping power [W]

The evaporator water mass flow rate is calculated based on the Chiller Flow Mode as follows.

**Constant Flow Chillers:**

<div>$${\dot m_{evap}} = {\dot m_{evap,max}}$$</div>

**Variable Flow Chillers:**

<div>$$\Delta {T_{evap}} = {T_{evap,\,in}} - {T_{evap,\,SP}}$$</div>

<div>$${\dot m_{evap}} = {\raise0.7ex\hbox{${{{\dot Q}_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{evap}}} {{C_{p,\,evap}}\left( {\Delta {T_{evap}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,evap}}\left( {\Delta {T_{evap}}} \right)}$}}$$</div>

where

<span>${\dot m_{evap}}$</span>          = chiller evaporator water mass flow rate (kg/s)

<span>${\dot m_{evap,\,max}}$</span>     = chiller design evaporator water mass flow rate (kg/s)

<span>$\Delta {T_{evap}}$</span>        = chiller evaporator water temperature difference (ºC)

<span>${T_{evap,\,in}}$</span>        = chiller evaporator inlet water temperature (ºC)

<span>${T_{evap,\,SP}}$</span>       = chiller evaporator outlet water setpoint temperature (ºC)

<span>${C_{p,\,evap}}$</span>         = specific heat of water entering evaporator (J/kg ºC)

The evaporator outlet water temperature is then calculated based on the cooling effect produced and the evaporator entering water temperature.

<div>$${T_{evap,out}} = {T_{evap,in}} + {\raise0.7ex\hbox{${{{\dot Q}_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{evap}}} {{C_{p,\,evap}}\left( {{{\dot m}_{evap}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,evap}}\left( {{{\dot m}_{evap}}} \right)}$}}$$</div>

where

<span>${T_{evap,out}}$</span> = chiller evaporator outlet water temperature [ºC]

<span>${T_{evap,in}}$</span> = chiller evaporator inlet water temperature [ºC]

<span>${C_{p,\,evap}}$</span> = specific heat of chiller evaporator inlet water [J/kg/ºC]

<span>${\dot m_{evap}}$</span> = chiller evaporator water mass flow rate [kg/s]

The condenser heat transfer and condenser leaving water temperature are also calculated.

<div>$${\dot Q_{cond}} = {\dot Q_{evap}} + {\dot Q_{generator}} + {\dot Q_{pump}}$$</div>

<div>$${T_{cond,out}} = {T_{cond,in}} + {\raise0.7ex\hbox{${{{\dot Q}_{cond}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{cond}}} {{C_{p,\,cond}}\left( {{{\dot m}_{cond}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,cond}}\left( {{{\dot m}_{cond}}} \right)}$}}$$</div>

where

<span>${\dot Q_{cond}}$</span> = chiller condenser heat transfer rate [W]

<span>${T_{cond,out}}$</span> = chiller condenser outlet water temperature [ºC]

<span>${T_{cond,in}}$</span> = chiller condenser inlet water temperature [ºC]

<span>${C_{p,\,cond}}$</span> = specific heat of chiller condenser inlet water [J/kg/ºC]

<span>${\dot m_{cond}}$</span> = chiller condenser water mass flow rate [kg/s]

The absorption chiller can model the impact of steam or hot water entering the generator, although the connection of the steam (hot water) nodes to a plant is not actually required. The calculations specific to the generator depend on the type of fluid used and are described here in further detail.

#### Steam Loop Calculations

When a steam loop is used and the inlet and outlet node names are specified (i.e. the nodes are connected to a steam loop), the generator outlet node steam mass flow rate and temperature are calculated based on the generator heat input, latent heat of steam, the specific heat of water, and the amount of subcooling in the steam generator. The model assumes dry saturated steam enters the generator and exits the generator as a subcooled liquid. The temperature leaving the generator is calculated based on the user entered amount of liquid subcooling in the generator. The effect of subcooling of the liquid (condensate) in the pipe returning to the boiler is also modeled using the user entered abount of steam condensate loop subcooling.

<div>$${\dot m_{steam}}\,\,\,\, = \,\,\,\,\,\frac{{{{\dot Q}_{generator}}}}{{{h_{fg}} + {c_{p,water}} \times \Delta {T_{sc}}}}$$</div>

<div>$${T_{generator,out}} = {T_{generator,in}} - \Delta {T_{sc}}$$</div>

<div>$${T_{loop,out}} = {T_{generator,out}} - \Delta {T_{sc,\,\,loop}}$$</div>

where

<span>${\dot m_{steam}}$</span> = chiller steam mass flow rate [kg/s]

<span>${h_{fg}}$</span> = latent heat of steam [J/kg]

<span>${c_{p,water}}$</span> = specific heat of water [J/Kg ºC]

<span>$\Delta {T_{sc}}$</span> = amount of subcooling in steam generator [ºC]

<span>$\Delta {T_{sc,\,loop}}$</span> = amount of condensate subcooling in steam loop [ºC]

<span>${T_{generator,out}}$</span> = generator steam outlet node temperature [ºC]

<span>${T_{generator,in}}$</span> = generator steam inlet node temperature [ºC]

#### Hot Water Loop Calculations

When a hot water loop is used and the inlet and outlet node names are specified (i.e. the nodes are connected to a hot water loop), the generator outlet node temperature is calculated based on the generator heat input, mass flow rate of water, and the specific heat of water entering the hot water generator. The calculations are based on the Chiller Flow Mode as follows.

**Constant Flow Chillers:**

<div>$${\dot m_{generator}} = {\dot m_{generator,\,max}}$$</div>

**Variable Flow Chillers:**

<div>$${\dot m_{generator}} = {\raise0.7ex\hbox{${{{\dot Q}_{generator}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{generator}}} {{C_{p,\,water}}\left( {\Delta {T_{generator}}} \right)}}}\right.}\!\lower0.7ex\hbox{${{C_{p,\,water}}\left( {\Delta {T_{generator}}} \right)}$}}$$</div>

<div>$${T_{generator,out}} = {T_{generator,in}} - \frac{{{{\dot Q}_{generator}}}}{{{{\dot m}_{generator}}\left( {{C_{p\,,\,water}}} \right)}}$$</div>

where

<span>${\dot m_{generator}}$</span> = generator hot water mass flow rate [kg/s]

<span>${\dot m_{generator,\,max}}$</span>= generator design hot water mass flow rate (kg/s)

<span>$\Delta {T_{generator}}$</span>   = generator design hot water temperature difference (ºC)

### Combustion Turbine Chiller

The input object Chiller:CombustionTurbine provides a chiller model that is the empirical model from the Building Loads and System Thermodynamics (BLAST) program. Fitting catalog data to a third order polynomial equations generates the chiller performance curves.  Three sets of coefficients are required to model the open centrifugal chiller as discussed in the section, titled, ‘Electric Chiller Based on BLAST Centrifugal Chiller Model’.

The gas turbine-driven chiller is an open centrifugal chiller driven directly by a gas turbine.  The BLAST model of an open centrifugal chiller is modeled as standard vapor compression refrigeration cycle with a centrifugal compressor driven by a shaft power from an engine.  The centrifugal compressor has the incoming fluid entering at the eye of a spinning impeller that throws the fluid by centrifugal force to the periphery of the impeller.  After leaving the compressor, the refrigerant is condensed to liquid in a refrigerant to water condenser.  The heat from the condenser is rejected to a cooling tower, evaporative condenser, or well water condenser depending on which one is selected by the user based on the physical parameters of the plant.  The refrigerant pressure is then dropped through a throttling valve so that fluid can evaporate at a low pressure that provides cooling to the evaporator.  The evaporator can chill water that is pumped to chilled water coils in the building.  For more information, see the Input/Output Reference Document.

This chiller is modeled like the electric chiller with the same numerical curve fits and then some additional curve fits to model the turbine drive.  Shown below are the definitions of the curves that describe this model.

The chiller’s temperature rise coefficient which is defined as the ratio of the required change in condenser water temperature to a given change in chilled water temperature, which maintains the capacity at the nominal value.  This is calculated as the following ratio:

<div>$$\frac{{TCEn{t_{required}} - TCEn{t_{rated}}}}{{TEL{v_{required}} - TEL{v_{rated}}}}$$</div>

Where:

TCEnt<sub>required</sub> = Required entering condenser air or water temperature to maintain rated capacity.

TCEnt<sub>rated</sub> = Rated entering condenser air or water temperature at rated capacity.

TELv<sub>required</sub> = Required leaving evaporator water outlet temperature to maintain rated capacity.

TELv<sub>rated</sub> = Rated leaving evaporator water outlet temperature at rated capacity.

The Capacity Ratio Curve is a quadratic equation that determines the Ratio of Available Capacity to Nominal Capacity.  The defining equation is:

<div>$$AvailToNominalCapacityRatio = {C_1} + {C_2}{\Delta_{temp}} + {C_3}\Delta_{temp}^2$$</div>

Where the Delta Temperature is defined as:

<div>$${\Delta_{{\rm{Temp}}}} = \frac{{{\rm{TempCondIn  -  TempCondInDesign }}}}{{{\rm{TempRiseCoefficient}}}} - ({\rm{TempEvapOut  -  TempEvapOutDesign)}}$$</div>

TempCondIn = Temperature entering the condenser (water or air temperature depending on condenser type).

TempCondInDesign = Temp Design Condenser Inlet from User input above.

TempEvapOut = Temperature leaving the evaporator.

TempEvapOutDesign = Temp Design Evaporator Outlet from User input above.

TempRiseCoefficient = User Input from above.

The following three fields contain the coefficients for the quadratic equation.

The Power Ratio Curve is a quadratic equation that determines the Ratio of Full Load to Power.  The defining equation is:

<div>$$FullLoadtoPowerRatio = {C_1} + {C_2}AvailToNominalCapRatio + {C_3}AvailToNominalCapRati{o^2}$$</div>

The Full Load Ratio Curve is a quadratic equation that determines the fraction of full load power.  The defining equation is:

<div>$$FracFullLoadPower = {C_1} + {C_2}PartLoadRatio + {C_3}PartLoadRati{o^2}$$</div>

The Fuel Input Curve is a polynomial equation that determines the Ratio of Fuel Input to Energy Output.  The equation combines both the Fuel Input Curve Coefficients and the Temperature Based Fuel Input Curve Coefficients.  The defining equation is:

<div>$$FuelEnergyInput = PLoad * (FI{C_1} + FI{C_2}RLoad + FI{C_3}RLoa{d^2}) * (TBFI{C_1} + TBFI{C_2}A{T_{air}} + TBFI{C_3}AT_{air}^2)$$</div>

Where FIC represents the Fuel Input Curve Coefficients, TBFIC represents the Temperature Based Fuel Input Curve Coefficients, Rload is the Ratio of Load to Combustion Turbine Engine Capacity, and AT<sub>air</sub> is the difference between the current ambient and design ambient temperatures.

The Exhaust Flow Curve is a quadratic equation that determines the Ratio of Exhaust Gas Flow Rate to Engine Capacity.  The defining equation is:

*<span>$ExhaustFlowRate = GTCapacity * ({C_1} + {C_2}A{T_{air}} + {C_3}AT_{air}^2)$</span> *

Where GTCapacity is the Combustion Turbine Engine Capacity, and AT<sub>air</sub> is the difference between the current ambient and design ambient temperatures.

The Exhaust Gas Temperature Curve is a polynomial equation that determines the Exhaust Gas Temperature.  The equation combines both the Exhaust Gas Temperature Curve Coefficients (Based on the Part Load Ratio) and the (Ambient) Temperature Based Exhaust Gas Temperature Curve Coefficients.  The defining equation is:

 <span>$ExhaustTemperature = ({C_1} + {C_2}RLoad + {C_3}RLoa{d^2}) * (TB{C_1} + TB{C_2}A{T_{air}} + TB{C_3}AT_{air}^2) - 273.15$</span>

Where C represents the Exhaust Gas Temperature Curve Coefficients, TBC are the Temperature Based Exhaust Gas Temperature Curve Coefficients, RLoad is the Ratio of Load to Combustion Turbine Engine Capacity, and AT<sub>air</sub> is the difference between the actual ambient and design ambient temperatures.

The Recovery Lubricant Heat Curve is a quadratic equation that determines the recovery lube energy.  The defining equation is:

<div>$$RecoveryLubeEnergy = PLoad * ({C_1} + {C_2}RL + {C_3}R{L^2})$$</div>

Where Pload is the engine load and RL is the Ratio of Load to Combustion Turbine Engine Capacity

The UA is an equation that determines the overall heat transfer coefficient for the exhaust gasses with the stack.  The heat transfer coefficient ultimately helps determine the exhaust stack temperature.  The defining equation is:

<div>$$UAToCapacityRatio = {C_1}GasTurbineEngineCapacit{y^{{C_2}}}$$</div>

#### Chiller Basin Heater

This chiller’s basin heater (for evaporatively-cooled condenser type) operates in the same manner as the Engine driven chiller’s basin heater. The calculations for the chiller basin heater are described in detail at the end of the engine driven chiller description (Ref. Engine Driven Chiller).

### ChillerHeater:Absorption:DirectFired

#### Overview

This model (object name ChillerHeater:Absorption:DirectFired) simulates the performance of a direct fired two-stage absorption chiller with optional heating capability. The model is based on the direct fired absorption chiller model (ABSORG-CHLR) in the DOE-2.1 building energy simulation program. The EnergyPlus model contains all of the features of the DOE-2.1 chiller model, plus some additional capabilities.

This model simulates the thermal performance of the chiller and the fuel consumption of the burner(s). This model does not simulate the thermal performance or the power consumption of associated pumps or cooling towers. This auxiliary equipment must be modeled using other EnergyPlus models (e.g. Cooling Tower:Single Speed).

#### Model Description

The chiller model uses user-supplied performance information at design conditions along with five performance curves (curve objects) for cooling capacity and efficiency to determine chiller operation at off-design conditions. Two additional performance curves for heating capacity and efficiency are used when the chiller is operating in a heating only mode or simultaneous cooling and heating mode.

#### Cooling

The following nomenclature is used in the cooling equations:

*AvailCoolCap*         =   available full-load cooling capacity at current conditions [W]

*CEIR*                       =   user input “Electric Input to Cooling Output Ratio”

*CEIRfPLR*               =   electric input to cooling output factor, equal to 1 at full load, user input “Electric Input to Cooling Output Ratio Function of Part Load Ratio Curve Name”

*CEIRfT*                    =   electric input to cooling output factor, equal to 1 at design conditions, user input “Electric Input to Cooling Output Ratio Function of Temperature Curve Name”

*CFIR*                       =   user input “Fuel Input to Cooling Output Ratio”

*CFIRfPLR*               =   fuel input to cooling output factor, equal to 1 at full load, user input “Fuel Input to Cooling Output Ratio Function of Part Load Ratio Curve Name”

*CFIRfT*                    =   fuel input to cooling output factor, equal to 1 at design conditions, user input “Fuel Input to Cooling Output Ratio Function of Temperature Curve Name”

*CondenserLoad       *=   condenser heat rejection load [W]

*CoolCapfT*              =   cooling capacity factor, equal to 1 at design conditions, user input “Cooling Capacity Function of Temperature Curve Name”

*CoolElectricPower*  =   cooling electricity input [W]

*CoolFuelInput*         =   cooling fuel input [W]

*CoolingLoad*           =   current cooling load on the chiller [W]

*CPLR*                      =   cooling part-load ratio = *CoolingLoad* / *AvailCoolCap*

*HeatingLoad*           =   current heating load on the chiller heater [W]

*HFIR*                       =   user input “Fuel Input to Heating Output Ratio”

*HPLR*                      =   heating part-load ratio = *HeatingLoad* / *AvailHeatCap*

*MinPLR                   *=   user input “Minimum Part Load Ratio”

*NomCoolCap*          =   user input “Nominal Cooling Capacity” [W]

*RunFrac*                  =   fraction of time step which the chiller is running

*T<sub>cond</sub>*                         =   entering or leaving condenser fluid temperature [C]. For a water-cooled condenser this will be the water temperature returning from the condenser loop (e.g., leaving the cooling tower) if the entering condenser fluid temperature option is used. For air- or evap-cooled condensers this will be the entering outdoor air dry-bulb or wet-bulb temperature, respectively, if the entering condenser fluid temperature option is used.

*T<sub>cw,l</sub>*                          =   leaving chilled water temperature [C]

Five performance curves are used in the calculation of cooling capacity and efficiency:

1)    Cooling Capacity Function of Temperature Curve

2)    Fuel Input to Cooling Output Ratio Function of Temperature Curve

3)    Fuel Input to Cooling Output Ratio Function of Part Load Ratio Curve

4)    Electric Input to Cooling Output Ratio Function of Temperature Curve

5)    Electric Input to Cooling Output Ratio Function of Part Load Ratio Curve

The cooling capacity function of temperature (*CoolCapfT*) curve represents the fraction of the cooling capacity of the chiller as it varies by temperature. This a biquadratic curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser fluid temperature. The output of this curve is multiplied by the nominal cooling capacity to give the full-load cooling capacity at specific temperature operating conditions (i.e., at temperatures different from the design temperatures). The curve should have a value of 1.0 at the design temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation.

<div>$$CoolCapfT = a + b{T_{cw,l}} + cT_{cw,l}^2 + d{T_{cond}} + eT_{cond}^2 + f{T_{cw,l}}{T_{cond}}$$</div>

The available cooling capacity of the chiller is then computed as follows:

<div>$$AvailCoolCap = NomCoolCap \cdot CoolCapfT({T_{cw,l}},{T_{cond}})$$</div>

The fuel input to cooling output ratio function of temperature (*CFIRfT*) curve represents the fraction of the fuel input to the chiller at full load as it varies by temperature. This a biquadratic curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser fluid temperature. The output of this curve is multiplied by the nominal fuel input to cooling output ratio (*CFIR*) to give the full-load fuel input to cooling capacity ratio at specific temperature operating conditions (i.e., at temperatures different from the design temperatures). The curve should have a value of 1.0 at the design temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation.

<div>$$CFIRfT = a + b{T_{cw,l}} + cT_{cw,l}^2 + d{T_{cond}} + eT_{cond}^2 + f{T_{cw,l}}{T_{cond}}$$</div>

The fuel input to cooling output ratio function of part load ratio (*CFIRfPLR*) curve represents the fraction of the fuel input to the chiller as the load on the chiller varies at a given set of  operating temperatures. The curve is normalized so that at full load the value of the curve should be 1.0. The curve is usually linear or quadratic.

<div>$$CFIRfPLR = a + b \cdot CPLR + c \cdot CPL{R^2}$$</div>

The fraction of the time step during which the chiller heater is operating is computed as a function of the cooling and heating part-load ratios and the user-input minimum part-load ratio:

<div>$$RunFrac = {\mathop{\rm MIN}\nolimits} \left( {1.0,{\mathop{\rm MAX}\nolimits} \left( {HPLR,CPLR} \right)/MinPLR} \right)$$</div>

The cooling fuel input to the chiller is then computed as follows:

<div>$$\begin{array}{l}CoolFuelInput = \\AvailCoolCap \cdot RunFrac \cdot CFIR \cdot CFIRfT({T_{cw,l}},{T_{cond}}) \cdot CFIRfPLR(CPLR)\end{array}$$</div>

The electric input to cooling output ratio as function of temperature (*CEIRfT*) curve represents the fraction of electricity to the chiller at full load as it varies by temperature. This a biquadratic curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser fluid temperature.

<div>$$CEIRfT = a + b{T_{cw,l}} + cT_{cw,l}^2 + d{T_{cond}} + eT_{cond}^2 + f{T_{cw,l}}{T_{cond}}$$</div>

The electric input to cooling output ratio function of part load ratio (*CEIRfPLR*) curve represents the fraction of electricity to the chiller as the load on the chiller varies at a given set of operating temperatures. The curve is normalized so that at full load the value of the curve should be 1.0. The curve is usually linear or quadratic.

<div>$$CEIRfPLR = a + b \cdot CPLR + c \cdot CPL{R^2}$$</div>

The cooling electric input to the chiller is computed as follows:

<div>$$CoolElectricPower = NomCoolCap \cdot RunFrac \cdot CEIR \cdot CEIRfT({T_{cw,l}},{T_{cond}}) \cdot CEIRfPLR(CPLR)$$</div>

All five of these cooling performance curves are accessed through EnergyPlus’ built-in performance curve equation manager (objects Curve:Linear, Curve:Quadratic and Curve:Biquadratic). It is not imperative that the user utilize all coefficients in the performance curve equations if their performance equation has fewer terms (e.g., if the user’s *CFIRfPLR* performance curve is linear instead of quadratic, simply enter the values for a and b, and set coefficient c equal to zero).

The condenser load is computed as follows:

<div>$$CondenserLoad = CoolingLoad + {\raise0.7ex\hbox{${CoolFuelInput}$} \!\mathord{\left/ {\vphantom {{CoolFuelInput} {HFIR}}}\right.}\!\lower0.7ex\hbox{${HFIR}$}} + CoolElectricPower$$</div>

#### Heating

The following nomenclature is used in the heating equations:

*AvailHeatCap*         =   available full-load heating capacity at current conditions [W]

*CPLRh*                    =   cooling part-load ratio for heating curve =
 *CoolingLoad* / *NomCoolCap*

*HeatCapfCPLR*       =   heating capacity factor as a function of cooling part load ratio, equal to 1 at zero cooling load, user input “Heating Capacity Function of Cooling Capacity Curve Name”

*HeatCoolCapRatio *=   user input “Heating to Cooling Capacity Ratio”

*HeatElectricPower*  =   heating electricity input [W]

*HeatFuelInput*         =   heating fuel input [W]

*HeatingLoad*           =   current heating load on the chiller [W]

*HEIR*                       =   user input “Electric Input to Heating Output Ratio”

*HFIR*                       =   user input “Fuel Input to Heating Output Ratio”

*HFIRfHPLR*            =   fuel input to heating output factor, equal to 1 at full load, user input “Fuel Input to Heat Output Ratio During Heating Only Operation Curve Name”

*HPLR*                      =   heating part-load ratio = *HeatingLoad* / *AvailHeatCap*

*MinPLR                   *=   user input “Minimum Part Load Ratio”

*NomCoolCap*          =   user input “Nominal Cooling Capacity” [W]

*RunFrac*                  =   fraction of time step which the chiller is running

*TotalElectricPower *=   total electricity input [W]

*TotalFuelInput        *=   total fuel input [W]

Cooling is the primary purpose of the Direct Fired Absorption Chiller so that function is satisfied first and if energy is available for providing heating that is provided next.

The two performance curves for heating capacity and efficiency are:

1)    Heating Capacity Function of Cooling Capacity Curve

2)    Fuel-Input-to Heat Output Ratio Function

The heating capacity function of cooling capacity curve (*HeatCapfCool*) determines how the heating capacity of the chiller varies with cooling capacity when the chiller is simultaneously heating and cooling. The curve is normalized so an input of 1.0 represents the nominal cooling capacity and an output of 1.0 represents the full heating capacity.  An output of 1.0 should occur when the input is 0.0.

<div>$$HeatCapfCPLR = a + b \cdot CPLRh + c \cdot CPLR{h^2}$$</div>

The available heating capacity is then computed as follows:

<div>$$AvailHeatCap = NomCoolCap \cdot HeatCoolCapRatio \cdot HeatCapfCPLR(CPLRh)$$</div>

The fuel input to heat output ratio curve (*HFIRfHPLR*) function is used to represent the fraction of fuel used as the heating load varies as a function of heating part load ratio. It is normalized so that a value of 1.0 is the full available heating capacity. The curve is usually linear or quadratic and will probably be similar to a boiler curve for most chillers.

<div>$$HFIRfHPLR = a + b \cdot HPLR + c \cdot HPL{R^2}$$</div>

The fuel use rate when heating is computed as follows:

<div>$$HeatFuelInput = AvailHeatCap \cdot HFIR \cdot HFIRfHPLR(HPLR)$$</div>

The fraction of the time step during which the chiller is operating is computed as a function of the cooling and heating part-load ratios and the user-input minimum part-load ratio:

<div>$$RunFrac = {\mathop{\rm MIN}\nolimits} \left( {1.0,{\mathop{\rm MAX}\nolimits} \left( {HPLR,CPLRh} \right)/MinPLR} \right)$$</div>

The heating electric input to the chiller is computed as follows:

<div>$$HeatElectricPower = NomCoolCap \cdot HeatCoolCapRatio \cdot HEIR \cdot RunFrac$$</div>

If the chiller is delivering heating and cooling simultaneously, the parasitic electric load will be double-counted, so the following logic is applied:

```
IF ( HeatElectricPower <= CoolElectricPower ) THEN
  HeatElectricPower = 0.0
ELSE
  HeatElectricPower = HeatElectricPower - CoolElectricPower
ENDIF
```

The total fuel and electric power input to the chiller is computed as shown below:

<div>$$\begin{array}{l}TotalElectricPower = HeatElectricPower + CoolElectricPower\\TotalFuelInput = HeatFuelInput + CoolFuelInput\end{array}$$</div>

### ChillerHeater:Absorption:DoubleEffect

#### Overview

This model (object name ChillerHeater:Absorption:DoubleEffect) simulates the performance of an exhaust  fired two-stage (double effect) absorption chiller with optional heating capability. The model is based on the direct fired absorption chiller model (ABSORG-CHLR) in the DOE-2.1 building energy simulation program. The EnergyPlus model contains all of the features of the DOE-2.1 chiller model, plus some additional capabilities. The model uses the exhaust gas output from Microturbine.

This model simulates the thermal performance of the chiller and the thermal energy input to the chiller. This model does not simulate the thermal performance or the power consumption of associated pumps or cooling towers. This auxiliary equipment must be modeled using other EnergyPlus models (e.g. Cooling Tower:Single Speed).

#### Model Description

The chiller model uses user-supplied performance information at design conditions along with five performance curves (curve objects) for cooling capacity and efficiency to determine chiller operation at off-design conditions. Two additional performance curves for heating capacity and efficiency are used when the chiller is operating in a heating only mode or simultaneous cooling and heating mode.

#### Cooling

The following nomenclature is used in the cooling equations:

*AvailCoolCap*         =   available full-load cooling capacity at current conditions [W]

*CEIR*                       =   user input “Electric Input to Cooling Output Ratio”

*CEIRfPLR*               =   electric input to cooling output factor, equal to 1 at full load, user input “Electric Input to Cooling Output Ratio Function of Part Load Ratio Curve Name”

*CEIRfT*                    =   electric input to cooling output factor, equal to 1 at design conditions, user input “Electric Input to Cooling Output Ratio Function of Temperature Curve Name”

*TeFIR*                      =   user input “Thermal Energy Input to Cooling Output Ratio”

*TeFIRfPLR*              =   thermal energy input to cooling output factor, equal to 1 at full load, user input “Thermal Energy Input to Cooling Output Ratio Function of Part Load Ratio Curve Name”

*TeFIRfT*                   =   thermal energy input to cooling output factor, equal to 1 at design conditions, user input “Thermal Energy Input to Cooling Output Ratio Function of Temperature Curve Name”

*CondenserLoad       *=   condenser heat rejection load [W]

*CoolCapfT*              =   cooling capacity factor, equal to 1 at design conditions, user input “Cooling Capacity Function of Temperature Curve Name”

*CoolElectricPower*  =   cooling electricity input [W]

*CoolThermalEnergyInput*=          cooling thermal energy input [W]

*CoolingLoad*           =   current cooling load on the chiller [W]

*CPLR*                      =   cooling part-load ratio = *CoolingLoad* / *AvailCoolCap*

*HeatingLoad*           =   current heating load on the chiller heater [W]

*HFIR*                       =   user input “Thermal Energy Input to Heating Output Ratio”

*HPLR*                      =   heating part-load ratio = *HeatingLoad* / *AvailHeatCap*

<span>${\dot m_{ExhAir}}$</span>                     =  exhaust air mass flow rate from microturbine (kg/s)

*MinPLR                   *=   user input “Minimum Part Load Ratio”

*NomCoolCap*          =   user input “Nominal Cooling Capacity” [W]

*RunFrac*                  =   fraction of time step which the chiller is running

<span>${T_{a,o}}$</span>                            =  exhaust air outlet temperature from microturbine entering the chiller

(<sup>o</sup>C)

<span>${T_{abs,gen,o}}$</span>                 =  Temperature of exhaust leaving the chiller (the generator                    component  of the absorption chiller)

*T<sub>cond</sub>*                         =   entering condenser fluid temperature [°C]. For a water-cooled condenser this will be the water temperature returning from the condenser loop (e.g., leaving the cooling tower). For air- or evap-cooled condensers this will be the entering outdoor air dry-bulb or wet-bulb temperature, respectively.

*T<sub>cw,l</sub>*                          =   leaving chilled water temperature [°C]

The selection of entering or leaving condense fluid temperature can be made through the optional field-Temperature Curve Input Variable.

Five performance curves are used in the calculation of cooling capacity and efficiency:

6)    Cooling Capacity Function of Temperature Curve

7)    Thermal Energy Input to Cooling Output Ratio Function of Temperature Curve

8)    Thermal Energy Input to Cooling Output Ratio Function of Part Load Ratio Curve

9)    Electric Input to Cooling Output Ratio Function of Temperature Curve

10) Electric Input to Cooling Output Ratio Function of Part Load Ratio Curve

The cooling capacity function of temperature (*CoolCapfT*) curve represents the fraction of the cooling capacity of the chiller as it varies with temperature. This a biquadratic curve with the input variables being the leaving chilled water temperature and the entering condenser fluid temperature. The output of this curve is multiplied by the nominal cooling capacity to give the full-load cooling capacity at specific temperature operating conditions (i.e., at temperatures different from the design temperatures). The curve should have a value of 1.0 at the design temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation.

<div>$$CoolCapfT = a + b{T_{cw,l}} + cT_{cw,l}^2 + d{T_{cond}} + eT_{cond}^2 + f{T_{cw,l}}{T_{cond}}$$</div>

The available cooling capacity of the chiller is then computed as follows:

<div>$$AvailCoolCap = NomCoolCap \cdot CoolCapfT({T_{cw,l}} - {T_{cond}})$$</div>

The thermal energy input to cooling output ratio function of temperature (*TeFIRfT*) curve represents the fraction of the thermal energy input to the chiller at full load as it varies with temperature. This a biquadratic curve with the input variables being the leaving chilled water temperature and the entering condenser fluid temperature. The output of this curve is multiplied by the nominal thermal energy input to cooling output ratio (*TeFIR*) to give the full-load thermal energy input to cooling capacity ratio at specific temperature operating conditions (i.e., at temperatures different from the design temperatures). The curve should have a value of 1.0 at the design temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation.

<div>$$TeFIRfT = a + b{T_{cw,l}} + cT_{cw,l}^2 + d{T_{cond}} + eT_{cond}^2 + f{T_{cw,l}}{T_{cond}}$$</div>

The thermal energy input to cooling output ratio function of part load ratio (*TeFIRfPLR*) curve represents the fraction of the thermal energy input to the chiller as the load on the chiller varies at a given set of  operating temperatures. The curve is normalized so that at full load the value of the curve should be 1.0. The curve is usually linear or quadratic.

<div>$$TeFIRfPLR = a + b \cdot CPLR + c \cdot CPL{R^2}$$</div>

The fraction of the time step during which the chiller heater is operating is computed as a function of the cooling and heating part-load ratios and the user-input minimum part-load ratio:

<div>$$RunFrac = MIN(1.0,MAX\left( {HPLR,CPLR} \right)/MinPLR)$$</div>

The cooling thermal energy input to the chiller is then computed as follows:

<div>$$CoolThermalEnergyInput = AvailCoolCap \cdot RunFrac \cdot TeFIR \cdot TeFIRfT\left( {{T_{cw,l}},{T_{cond}}} \right) \cdot TeFIRfPLR(CPLR)$$</div>

To make sure that the exhaust mass flow rate and temperature from microturbine are sufficient to drive the chiller, the heat recovery potential is compared with the cooling thermal energy input to the chiller (CoolThermalEergyInput). The heat recovery potential should be greater than the CoolThermalEnergyInput. Heat recovery potential is calculated as:

<div>$${Q_{Recovery}} = {\dot m_{ExhAir}} \cdot {\rm{}}C{p_{Air}} \cdot {\rm{}}({T_{a,o}} - {T_{Abs,gen,o}})$$</div>

T<sub>abs,gen,o </sub> is the minimum temperature required for the proper operation of the double-effect chiller. It will be defaulted to 176°C.

The electric input to cooling output ratio as function of temperature (*CEIRfT*) curve represents the fraction of electricity to the chiller at full load as it varies with temperature. This a biquadratic curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser fluid temperature.

<div>$$CEIRfT = a + b{T_{cw,l}} + cT_{cw,l}^2 + d{T_{cond}} + eT_{cond}^2 + f{T_{cw,l}}{T_{cond}}$$</div>

The electric input to cooling output ratio function of part load ratio (*CEIRfPLR*) curve represents the fraction of electricity to the chiller as the load on the chiller varies at a given set of operating temperatures. The curve is normalized so that at full load the value of the curve should be 1.0. The curve is usually linear or quadratic.

<div>$$CEIRfPLR = a + b \cdot CPLR + c \cdot CPL{R^2}$$</div>

The cooling electric input to the chiller is computed as follows:

<div>$$CoolElectricPower = NomCoolCap \cdot RunFrac \cdot CEIR \cdot CEIRfT\left( {{T_{cw,l}},{T_{cond}}} \right) \cdot CEIRfPLR(CPLR)$$</div>

All five of these cooling performance curves are accessed through EnergyPlus’ built-in performance curve equation manager (objects Curve:Linear, Curve:Quadratic and Curve:Biquadratic). It is not imperative that the user utilize all coefficients in the performance curve equations if their performance equation has fewer terms (e.g., if the user’s *TeFIRfPLR* performance curve is linear instead of quadratic, simply enter the values for a and b, and set coefficient c equal to zero). A set of curves derived from manufacturer’s data are also provided in the dataset (ExhaustFiredChiller.idf) is provided with E+ installation.

The condenser load is computed as follows:

<div>$$CondenserLoad = CoolingLoad + CoolThermalEnergyInput/HFIR + CoolElectricPower$$</div>

#### Heating

The following nomenclature is used in the heating equations:



*AvailHeatCap*         =   available full-load heating capacity at current conditions [W]

*CPLRh*                    =   cooling part-load ratio for heating curve =
 *CoolingLoad* / *NomCoolCap*

*HeatCapfCPLR*       =   heating capacity factor as a function of cooling part load ratio, equal to 1 at zero cooling load, user input “Heating Capacity Function of Cooling Capacity Curve Name”

*HeatCoolCapRatio *=   user input “Heating to Cooling Capacity Ratio”

*HeatElectricPower*  =   heating electricity input [W]

*HeatThermalEnergyInput*= heating thermal energy input [W]

*HeatingLoad*           =   current heating load on the chiller [W]

*HEIR*                       =   user input “Electric Input to Heating Output Ratio”

*HFIR*                       =   user input “Thermal Energy Input to Heating Output Ratio”

*HFIRfHPLR*            =   thermal energy input to heating output factor, equal to 1 at full load, user input “Thermal Energy Input to Heat Output Ratio During Heating Only Operation Curve Name”

*HPLR*                      =   heating part-load ratio = *HeatingLoad* / *AvailHeatCap*

*MinPLR                   *=   user input “Minimum Part Load Ratio”

*NomCoolCap*          =   user input “Nominal Cooling Capacity” [W]

*RunFrac*                  =   fraction of time step which the chiller is running

*TotalElectricPower *=   total electricity input [W]

*TotalThermalEnergyInput*=          total thermal energy input [W]

Cooling is the primary purpose of the Exhaust Fired Absorption Chiller so that function is satisfied first and if energy is available for providing heating that is provided next.

The two performance curves for heating capacity and efficiency are:

1)    Heating Capacity Function of Cooling Capacity Curve

2)    Thermal-Energy-Input-to Heat Output Ratio Function

The heating capacity function of cooling capacity curve (*HeatCapfCPLR*) determines how the heating capacity of the chiller varies with cooling capacity when the chiller is simultaneously heating and cooling. The curve is normalized so an input of 1.0 represents the nominal cooling capacity and an output of 1.0 represents the full heating capacity.  An output of 1.0 should occur when the input is 0.0.

<div>$$HeatCapfCPLR = a + b \cdot CPLRh + c \cdot CPLR{h^2}$$</div>

The available heating capacity is then computed as follows:

<div>$$AvailHeatCap = NomCoolCap \cdot HeatCoolCapRatio \cdot HeatCapfCPLR(CPLRh)$$</div>

The thermal energy input to heat output ratio curve (*HFIRfHPLR*) function is used to represent the fraction of thermal energy used as the heating load varies as a function of heating part load ratio. It is normalized so that a value of 1.0 is the full available heating capacity. The curve is usually linear or quadratic and will probably be similar to a boiler curve for most chillers.

<div>$$HFIRfHPLR = a + b \cdot HPLR + c \cdot HPL{R^2}$$</div>

The thermal energy use rate when heating is computed as follows:

<div>$$HeatThermalEnergyInput = AvailHeatCap.HFIR.HFIRfHPLR(HPLR)$$</div>

The fraction of the time step during which the chiller is operating is computed as a function of the cooling and heating part-load ratios and the user-input minimum part-load ratio:

<div>$$RunFrac = MIN(1.0,MAX\left( {HPLR,CPLRh} \right)/MinPLR)$$</div>

The heating electric input to the chiller is computed as follows:

<div>$$HeatElectricPower = NomCoolCap \cdot HeatCoolCapRatio \cdot HEIR.RunFrac$$</div>

If the chiller is delivering heating and cooling simultaneously, the parasitic electric load would be double-counted, so the following logic is applied:

<div>$$\begin{array}{l}IF\left( {HeatElectricPower \le CoolElectricPower} \right)THEN\\\quad HeatElectricPower = 0.0\\ELSE\\\quad HeatElectricPower = HeatElectricPower - CoolElectricPower\\ENDIF\end{array}$$</div>

The total thermal energy and electric power input to the chiller is computed as shown below:

<div>$$TotalElectricPower = HeatElectricPower + CoolElectricPower$$</div>

<div>$$TotalThermalEnergyInput = HeatThermalEnergyInput + CoolThermalEnergyInput$$</div>

#### References

Personal communications with various absorption chiller manufacturers, March 2011.

Absorption Chillers and Heat Pumps, Keith Herold, Reinhard Radermacher and Sanford A. Klein (Mar 18, 1996).

Absorption systems for combined heat and power: The problem of part-load operation, ASHRAE Transactions, 2003, Vol 109, Part1.

### Constant COP Chiller

The input object Chiller:ConstantCOP provides a chiller model that is based on a simple, constant COP simulation of the chiller.  In this case, performance does not vary with chilled water temperature or condenser conditions.  The nominal capacity of the chiller and the COP are user specified along with the connections to the plant and condenser loop and mass flow rates.  *Such a model is useful when the user does not have access to detailed performance data.*

The chiller power is calculated from the load divided by the COP.  This chiller will meet the load as long as it does not exceed the nominal capacity specified by the user.

        QEvaporator = Load

        Power = Load / ConstCOPChiller(ChillNum)%COP

Then the evaporator temperatures are calculated from the load

        EvapDeltaTemp = QEvaporator/EvapMassFlowRate/CPwater

        EvapOutletTemp = Node(EvapInletNode)%Temp - EvapDeltaTemp

The condenser load and temperatures are calculated from the evaporator load and the power to the chiller.

     QCondenser = Power + QEvaporator



     IF (ConstCOPChiller(ChillNum)%CondenserType == WaterCooled) THEN

       IF (CondMassFlowRate &gt; WaterMassFlowTol) THEN

         CondOutletTemp = QCondenser/CondMassFlowRate/CPCW(CondInletTemp) + CondInletTemp

       ELSE

         CALL ShowSevereError('CalcConstCOPChillerModel: Condenser flow = 0, for CONST COP Chiller='//  &

                              TRIM(ConstCOPChiller(ChillNum)%Name))

         CALL ShowContinueErrorTimeStamp(' ')

         CALL ShowFatalError('Program Terminates due to previous error condition.')

       END IF

    ELSE ! Air Cooled or Evap Cooled

         !  Set condenser outlet temp to condenser inlet temp for Air Cooled or Evap Cooled

         !  since there is no CondMassFlowRate and would divide by zero

      CondOutletTemp = CondInletTemp

    END IF

See the InputOutput Reference for additional information.

#### Chiller Basin Heater

This chiller’s basin heater (for evaporatively-cooled condenser type) operates in the same manner as the Engine driven chiller’s basin heater. The calculations for the chiller basin heater are described in detail at the end of the engine driven chiller description (Ref. Engine Driven Chiller).

### Hot Water Heat Recovery from Chillers

The electric chillers (e.g., Chiller:Electric, Chiller:EngineDriven, Chiller:CombustionTurbine, Chiller:Electric:EIR, and Chiller:Electric:ReformulatedEIR) all have the option of connecting a third plant loop for heating hot water at the same time the chiller cools the chilled water.  The engine and combustion turbine chillers models include curves for heat recovery from oil and or jacket coolers.  The other three chillers can model heat recovery where part of its condenser section is connected to a heat recovery loop for what is commonly known as a double bundled chiller, or single condenser with split bundles.  The heat recovery chiller is simulated as a standard vapor compression refrigeration cycle with a double bundled condenser.  A double bundle condenser involves two separate flow paths through a split condenser.  One of these paths is condenser water typically connected to a standard cooling tower; the other path is hot water connected to a heat recovery loop.  After leaving the compressor, the refrigerant is condensed to liquid in a refrigerant to water condenser.  In a split bundle, the chiller’s internal controls will direct a part of the refrigerant to heat recovery condenser bundle and/or to the tower water condenser bundle depending on the chilled water load, the condenser inlet temperatures and internal chiller controls (and possibly a leaving hot water temperature setpoint).  The refrigerant pressure is then dropped through a throttling valve so that fluid can evaporate at a low pressure that provides cooling to the evaporator.

![](EngineeringReference/media/image3175.png)

Figure 161.  Diagram of Chiller:Electric with Heat Recovery

The algorithm for the heat recovery portion of the chiller needs to be determined from relatively simple inputs to estimate the amount of the heat that is recovered and then send the rest of the heat to the cooling tower. For the chiller models associated with the object Chiller:Electric,  air- or evaporatively-cooled condensers are allowed to be used with heat recovery and, when used, the condenser specific heat, mass flow rate, and temperatures shown below refer to outdoor air. A condenser air volume flow rate must be specified when using heat recovery with air- or evaporatively-cooled chillers.

The basic energy balance for the condenser section of a heat recovery chiller is

<div>$${\dot Q_{tot}} = {\dot Q_{Evap}} + {\dot Q_{Elec}} = {\dot Q_{Cond}} + {\dot Q_{HR}}$$</div>

In practice, if the entering temperature of the heat recovery hot fluid is too high, the chiller’s internal controls will redirect refrigerant away from the heat recovery bundle.  A user input is available for declaring the inlet high temperature limit, and if it is exceeded, the chiller will shut down heat recovery and request no flow and will not reject any condenser heat to that fluid.

The heat recovery condenser bundle is often physically smaller than the tower water condenser bundle and therefore may have limited heat transfer capacity.  User input for the relative capacity of the heat recovery bundle, <span>${F_{HR,Cap}}$</span>, is used to define a maximum rate of heat recovery heat transfer using

<div>$${\dot Q_{HR,Max}} = {F_{HR,Cap}}\left( {{{\dot Q}_{Evap,Ref}} + \frac{{{{\dot Q}_{Evap,Ref}}}}{{CO{P_{Ref}}}}} \right)$$</div>

This capacity factor is also used to autosize the heat recovery design fluid flow rate when it is set to autosize.  The design heat recover flow rate is calculated by multiplying <span>${F_{HR,Cap}}$</span> by the condenser tower water design flow rate.  If no capacity factor is input, it is assumed to be 1.0.

A heat recovery chiller may control the temperature of heat recovery fluid leaving the device by modulating the flow of refrigerant to the heat recovery condenser bundle.  There are two different algorithms used depending on if the input has declared a leaving setpoint node.

If no control setpoint node was named, then the model developed by Liesen and Chillar (2004) is used to approximate the relative distribution of refrigerant flow and condenser heat transfer between the bundles.  This model approximates the heat transfer situation by using average temperatures in and out of the condenser section.

<div>$${Q_{Tot}} = ({\dot m_{Heat{\mathop{\rm Re}\nolimits} c}}*C{p_{Heat{\mathop{\rm Re}\nolimits} c}} + {\dot m_{Cond}}*C{p_{Cond}})*({T_{AvgOut}} - {T_{AvgIn}})$$</div>

Then the inlet temperature is flow-weighted to determine lumped inlet and outlet conditions.

<div>$${T_{AvgIn}} = \frac{{({{\dot m}_{Heat{\mathop{\rm Re}\nolimits} c}}*C{p_{Heat{\mathop{\rm Re}\nolimits} c}}*{T_{Heat{\mathop{\rm Re}\nolimits} cIn}} + {{\dot m}_{Cond}}*C{p_{Cond}}*{T_{CondIn}})}}{{({{\dot m}_{Heat{\mathop{\rm Re}\nolimits} c}}*C{p_{Heat{\mathop{\rm Re}\nolimits} c}} + {{\dot m}_{Cond}}*C{p_{Cond}})}}$$</div>

<div>$${T_{AvgOut}} = \frac{{{Q_{Tot}}}}{{({{\dot m}_{Heat{\mathop{\rm Re}\nolimits} c}}*C{p_{Heat{\mathop{\rm Re}\nolimits} c}} + {{\dot m}_{Cond}}*C{p_{Cond}})}} + {T_{AvgIn}}$$</div>

The lumped outlet temperature is then used for an approximate method of determining the heat recovery rate

<div>$${\dot Q_{HR}} = {\dot m_{HR}}{c_p}_{HR}\left( {{T_{Avg,out}} - {T_{HR,in}}} \right)$$</div>

This rate is then limited by the physical size of the heat recovery bundle.

<div>$${\dot Q_{HR}} = Min\left( {{{\dot Q}_{HR}},{{\dot Q}_{HR,max}}} \right)$$</div>

If user input for the leaving temperature setpoint is available, then a second model is used to distribute refrigerant flow and condenser heat transfer between the bundles that attempts to meet the heat recovery load implied by the leaving setpoint.  When setpoint control is used, the desired rate of heat recovery heat transfer is:

<div>$${\dot Q_{HR,Setpoint}} = {\dot m_{HR}}{c_p}_{HR}\left( {{T_{HR,set}} - {T_{HR,in}}} \right)$$</div>

<div>$${\dot Q_{HR,Setpoint}} = Max\left( {{{\dot Q}_{HR,Setpoint}},0.0} \right)$$</div>

Then the heat recovery rate is simply modeled as the lower of the three different heat flow rates:  the desired capacity, the maximum capacity, and the current total heat rejection rate.

<div>$${\dot Q_{HR}} = Min\left( {{{\dot Q}_{HR,Setpoint}},{{\dot Q}_{HR,max}},{{\dot Q}_{Tot}}} \right)$$</div>

For both models, the condenser heat transfer rate is then

<div>$${\dot Q_{Cond}} = {\dot Q_{Tot}} - {\dot Q_{HR}}$$</div>

The outlet temperatures are then calculated using

<div>$${T_{HR,out}} = {T_{HR,in}} + {\raise0.7ex\hbox{${{{\dot Q}_{HR}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{HR}}} {{{\dot m}_{HR}}{c_p}_{HR}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{HR}}{c_p}_{HR}}$}}$$</div>

<div>$${T_{Cond,out}} = {T_{Cond,in}} + {\raise0.7ex\hbox{${{{\dot Q}_{Cond}}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_{Cond}}} {{{\dot m}_{Cond}}{c_p}_{cond}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{Cond}}{c_p}_{cond}}$}}$$</div>

A heat recovery chiller may need to work harder because the refrigeration system faces a higher lift owing to an elevated effective temperature for heat rejection.  With heat recovery, the condenser temperature used with the chiller’s performance curves is determined using one of the following heat-flow-weighted methods. The first is used for the chiller model for the objects Chiller:Electric, and Chiller:Electric:EIR which use the condensing entering temperature for performance.

<div>$${T_{Cond,in,Avg}} = \frac{{\left( {{{\dot Q}_{HR}}{T_{HR,in}} + {{\dot Q}_{Cond}}{T_{Cond,in}}} \right)}}{{\left( {{{\dot Q}_{HR}} + {{\dot Q}_{Cond}}} \right)}}$$</div>

The second is used for the chiller model for the object Chiller:Electric:ReformulatedEIR which uses the leaving condenser fluid temperature.

<div>$${T_{Cond,out,Avg}} = \frac{{\left( {{{\dot Q}_{HR}}{T_{HR,out}} + {{\dot Q}_{Cond}}{T_{Cond,out}}} \right)}}{{\left( {{{\dot Q}_{HR}} + {{\dot Q}_{Cond}}} \right)}}$$</div>

Both of these are available as an output variable called Chiller Effective Heat Rejection Tempeature, in C.

#### Chiller Basin Heater

This chiller’s basin heater (for evaporatively-cooled condenser type) operates in the same manner as the Engine driven chiller’s basin heater. The calculations for the chiller basin heater are described in detail at the end of the engine driven chiller description (Ref. Engine Driven Chiller).

**Reference**

Leisen and Chillar. 2004. Variable Heat Recovery In Double Bundle Electric Chillers. SimBuild 2004, IBPSA-USA National Conference Boulder, CO, August 4-6, 2004.

### Electric Chiller Model Based on Fluid Temperature Differences

The centrifugal chiller model (object name Chiller:Electric) was originally developed for the BLAST program.  The model is based on a ‘capacity ratio’ curve, which is a quadratic equation that determines the Ratio of Available Capacity to Nominal Capacity. The defining equation is:

<div>$$CapRatio = \frac{{Available Chiller Capacity}}{{Nominal Chiller Capacity}} = {A_1} + {A_2}\Delta {T_{chiller}} + {A_3}\Delta {T_{chiller}}^2$$</div>

Where the Delta Temperature is defined as:

<div>$$\Delta {T_{chiller}} = \frac{{{T_{cond, in}} - {T_{cond,in,design}}}}{{TempRiseRatio}} - \left( {{T_{evap,out}} - {T_{evap,out,design}}} \right)$$</div>

where the temperature rise coefficient is defined as the ratio of the required change in condenser water temperature to a given change in chilled water temperature, which maintains the capacity at the nominal value.  If the chiller is a heat recovery chiller,then the condenser inlet temperature is adjusted to account for both fluid streams as described in the section above on heat recovery chillers. This is calculated as the following ratio:

<div>$$TempRiseRatio = \frac{{{T_{cond, in,required}} - {T_{cond,in,rated}}}}{{{T_{evap, out,required}} - {T_{evap,out,rated}}}} - \left( {{T_{evap,out}} - {T_{evap,out,design}}} \right)$$</div>

Where:

*T<sub>cond,in,required</sub>* = Required entering condenser air or water temperature to maintain rated capacity (C)

*T<sub>cond,in,rated</sub>* = Rated entering condenser air or water temperature at rated capacity (C)

*T<sub>evap,out,required</sub>* = Required leaving evaporator water outlet temperature to maintain rated capacity (C)

*T<sub>evap,out,rated</sub>* = Rated leaving evaporator water outlet temperature at rated capacity (C)

The Power Ratio Curve is a quadratic equation that determines the Ratio of Full Load to Power.  The defining equation is:

<div>$$PowerRatio = {B_1} + {B_2}PLR + {B_3}PL{R^2}$$</div>

where the part load ratio, PLR is defined as:

<div>$$PLR = \frac{{chiller cooling load}}{{nominal chiller capacity}}$$</div>

The Load Ratio Curve is a quadratic equation that determines the Ratio of Actual Cooling Load to Full Cooling Load.  The defining equation is:

<div>$$LoadRatio = {C_1} + {C_2}CapRatio + {C_3}CapRati{o^2}$$</div>

The evaporator heat transfer rate and the power required by the chiller are then calculated as:

<div>$$Qevap = AvailableChillerCap*PLR$$</div>

<div>$$Power = PowerRatio*LoadRatio*\frac{{AvailableChillerCap}}{{RatedCOP}}$$</div>

### Electric Chiller Model Based on Condenser Entering Temperature

#### Overview

This model (object name Chiller:Electric:EIR) simulates the performance of an electric liquid chiller. The model is based on the compression chiller model (COMREF) in the DOE-2.1 building energy simulation program. The EnergyPlus model contains all of the features of the DOE-2.1 chiller model, plus additional abilities for modeling evaporatively-cooled condensers and heat recovery for water heating.

This model simulates the thermal performance of the chiller and the power consumption of the compressor(s). It also models the power consumption of condenser fans if modeling an air-cooled or evaporatively-cooled condenser. This model does not simulate the thermal performance or the power consumption of associated pumps or cooling towers. This auxiliary equipment must be modeled using other EnergyPlus models (e.g. CoolingTower:SingleSpeed).

#### Model Description

The chiller model uses user-supplied performance information at reference conditions along with three performance curves (curve objects) for cooling capacity and efficiency to determine chiller operation at off-reference conditions. The three performance curves are:

1)    Cooling Capacity Function of Temperature Curve

2)    Energy Input to Cooling Output Ratio Function of Temperature Curve

3)    Energy Input to Cooling Output Ratio Function of Part Load Ratio Curve

·        The cooling capacity function of temperature curve is a biquadratic performance curve with two independent variables: the leaving chilled water temperature and the entering condenser fluid temperature. The output of this curve is multiplied by the reference capacity to give the full-load cooling capacity at specific temperature operating conditions (i.e., at temperatures different from the reference temperatures). The curve should have a value of 1.0 at the reference temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation. If the chiller is a heat recovery chiller,then the condenser inlet temperature is adjusted to account for both fluid streams as described in the section above on heat recovery chillers.

<span>$ChillerCapFTemp = a + b\left( {{T_{cw,l}}} \right) + c{\left( {{T_{cw,l}}} \right)^2} + d\left( {{T_{cond,e}}} \right) + e{\left( {{T_{cond,e}}} \right)^2} + f\left( {{T_{cw,l}}} \right)\left( {{T_{cond,e}}} \right)$</span>where

*ChillerCapFTemp* = cooling capacity factor, equal to 1 at reference conditions

*T<sub>cw,l</sub>*            = leaving chilled water temperature, ˚C

*T<sub>cond,e</sub>*         = entering condenser fluid temperature, ˚C. For a water-cooled condenser this will be the water temperature returning from the condenser loop (e.g., leaving the cooling tower). For air- or evap-cooled condensers this will be the entering outdoor air dry-bulb or wet-bulb temperature, respectively.

·        The energy input to cooling output ratio function of temperature curve is a biquadratic performance curve that parameterizes the variation of the energy input to cooling output ratio (EIR) as a function of the leaving chilled water temperature and the entering condenser fluid temperature. The EIR is the inverse of the COP. The output of this curve is multiplied by the reference EIR (inverse of the reference COP) to give the full-load EIR at specific temperature operating conditions (i.e., at temperatures different from the reference temperatures). The curve should have a value of 1.0 at the reference temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation.

<div>$$ChillerEIRFTemp = a + b\left( {{T_{cw,l}}} \right) + c{\left( {{T_{cw,l}}} \right)^2} + d\left( {{T_{cond,e}}} \right) + e{\left( {{T_{cond,e}}} \right)^2} + f\left( {{T_{cw,l}}} \right)\left( {{T_{cond,e}}} \right)$$</div>

where

*ChillerEIRFTemp* = energy input to cooling output factor, equal to 1 at reference conditions

*T<sub>cw,l</sub>*      = leaving chilled water temperature, ˚C

*T<sub>cond,e</sub>*<sub>     </sub>= entering condenser fluid temperature, ˚C. For a water-cooled condenser this will be the water temperature returning from the condenser loop (e.g., leaving the cooling tower). For air- or evap-cooled condensers this will be the entering outdoor air dry-bulb or wet-bulb temperature, respectively. If the chiller is a heat recovery chiller,then the condenser inlet temperature is adjusted to account for both fluid streams as described in the section above on heat recovery chillers.

·        The energy input to cooling output ratio function of part-load ratio curve is a quadratic performance curve that parameterizes the variation of the chiller input power ratio as a function of the part-load ratio. The part-load ratio is the actual cooling load divided by the chiller’s available cooling capacity. The output of this curve is multiplied by the reference EIR (inverse of the reference COP) and the Energy Input to Cooling Output Ratio Function of Temperature Curve to give the EIR at the specific temperatures and part-load ratio at which the chiller is operating. This curve should have a value of 1.0 when the part-load ratio equals 1.0. The quadratic curve should be valid for the range of part-load ratios anticipated for the simulation.

<div>$$ChillerEIRFPLR = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2}\, = \,{\raise0.7ex\hbox{${{P_{chiller}}}$} \!\mathord{\left/ {\vphantom {{{P_{chiller}}} {{P_{ref}}\left( {ChillerCapFTemp} \right)\left( {ChillerEIRFTemp} \right)}}}\right.}\!\lower0.7ex\hbox{${{P_{ref}}\left( {ChillerCapFTemp} \right)\left( {ChillerEIRFTemp} \right)}$}}$$</div>

where

*ChillerEIRFPLR* = energy input to cooling output factor, equal to 1 at reference conditions

*PLR* =part-load ratio = (cooling load) / (chiller’s available cooling capacity)

*P<sub>chiller</sub> = chiller power at specific PLR*

*P<sub>ref</sub> = <span>${\mathop Q\limits^ \bullet_{ref}}$</span>/COP<sub>ref</sub>*

All three of the performance curves are accessed through EnergyPlus’ built-in performance curve equation manager (curve:quadratic and curve:biquadratic). It is not imperative that the user utilize all coefficients in the performance curve equations if their performance equation has fewer terms (e.g., if the user’s ChillerEIRFPLR performance curve is linear instead of quadratic, simply enter the values for a and b, and set coefficient c equal to zero). Performance curves for more than 160 chillers, including the default DOE-2.1E reciprocating and centrifugal chillers, are provided in the EnergyPlus Reference DataSets (Chillers.idf and AllDataSets.idf).

Note: Chiller:Electric:EIR objects and their associated performance curve objects are developed using performance information for a specific chiller and should normally be used together for an EnergyPlus simulation. Changing the object input values, or swapping performance curves between chillers, should be done with caution.

For any simulation time step, the chiller’s available cooling capacity is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{avail}}\,\, = \,\,{\mathop Q\limits^ \bullet_{ref}}\left( {ChillerCapFTemp} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{ref}}$</span>     = chiller capacity at reference conditions (reference temperatures and flow rates defined by the user), W

<span>$\mathop Q\limits^ \bullet  avail$</span> = available chiller capacity adjusted for current fluid temperatures, W

The model then calculates the evaporator heat transfer rate required to bring the entering chilled water temperature down to the leaving chilled water setpoint temperature (established using a SetpointManager object and referenced in the PlantLoop object). If this calculated heat transfer rate is greater than the heat transfer rate being requested by the plant equipment operation scheme, then the evaporator heat transfer rate is reset to the requested cooling rate.

The evaporator heat transfer rate is then compared to the available capacity. If the available chiller capacity is sufficient to meet the evaporator heat transfer rate, the leaving chilled water temperature is set equal to the chilled water setpoint temperature. If the requested evaporator heat transfer rate is larger than the available capacity the chilled water leaving the evaporator is allowed to float upward. For this case, the exiting chilled water temperature is calculated based on the water temperature entering the evaporator, the available cooling capacity, and the evaporator mass flow rate as follows:

<div>$${T_{cw,l}} = {T_{cw,e}} - \left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{avail}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{avail}}} {{{\mathop m\limits^ \bullet  }_{evap}}{C_{p,evap}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop m\limits^ \bullet  }_{evap}}{C_{p,evap}}}$}}} \right)$$</div>

where

*T<sub>cw,l</sub>*            = water temperature leaving the evaporator, ˚C

*T<sub>cw,e</sub>*           = water temperature entering the evaporator, ˚C

<span>${\mathop m\limits^ \bullet_{evap}}$</span>         = evaporator mass flow rate, kg/s

*C<sub>p,evap</sub>*         = specific heat of water entering evaporator at *T<sub>cw,e</sub>*, J/kg-˚C

The part-load ratio is then calculated as the ratio of the evaporator heat transfer rate to the available chiller capacity. The part-load ratio is not allowed to be greater than the maximum part-load ratio specified by the user or less than zero as follows:

<div>$$PLR = MAX\left( {0.0,MIN\left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{evap}}} {{{\mathop Q\limits^ \bullet  }_{avail}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{avail}}}$}},\,\,PL{R_{\max }}} \right)} \right)$$</div>

where

*PLR*           = part-load ratio

<span>${\mathop Q\limits^ \bullet_{evap}}$</span>         = load to be met by the chiller, W

*PLR<sub>max\\        </sub>*= maximum part-load ratio (specified by the user in the input data file)



The model assumes that the cooling load is met through chiller unloading down to the minimum unloading ratio. False loading (e.g. hot-gas bypass) is assumed to occur between the minimum unloading ratio and the minimum part load ratio yielding constant electrical power consumption under these conditions. Below the minimum part load ratio, the chiller cycles on and off to meet very small loads and the power consumption during the on cycle is the same as when the chiller is operating at the minimum part load ratio. When the chiller part load ratio is less than the minimum part load ratio, the on-off cycling ratio of the chiller is calculated as follows and is available as an output variable.

<div>$$ChillerCyclingRatio = MIN\left( {{\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PL{R_{\min }}}}}\right.}\!\lower0.7ex\hbox{${PL{R_{\min }}}$}},\,\,1.0} \right)$$</div>

To properly account for chiller electric power consumption when PLR is less than the minimum unloading ratio, the PLR is reset to the greater of the PLR calculated above and the PLR at the minimum unloading ratio. The result is available as the output variable Chiller Part Load Ratio.

<div>$$PLR = MAX(PLR,PL{R_{MinUnloadRatio}})$$</div>

This revised PLR accounts for the “false loading” (e.g., hot gas bypass) that is assumed to occur whenever the PLR (based on cooling load divided by available capacity) is less than the minimum unloading ratio specified. The amount of false loading on the chiller is calculated using this revised PLR and is reported as an output variable as follows:

<div>$${\mathop Q\limits^ \bullet_{falseloading}} = \left( {{{\mathop Q\limits^ \bullet  }_{avail}}} \right)\left( {PLR} \right)\left( {ChillerCyclingRatio} \right) - {\mathop Q\limits^ \bullet_{evap}}$$</div>

The electrical power consumption for the chiller compressor(s) for any simulation time step is then calculated using the following equation:

<span>${P_{chiller}}\, = \,\,\left( {{{\mathop Q\limits^ \bullet  }_{avail}}\,} \right)\,\left( {\frac{1}{{CO{P_{ref}}}}} \right)\,\left( {ChillerEIRFTemp} \right)\left( {ChillerEIRFPLR} \right)\left( {ChillerCyclingRatio} \right)$</span>where

*P<sub>chiller</sub>*         = chiller compressor power, W

*COP<sub>ref</sub>*       = reference coefficient of performance, W/W



Heat rejected by the chiller condenser includes the heat transferred in the evaporator plus a portion or all of the compressor electrical energy consumption. For electric chillers with hermetic compressors, all compressor energy consumption is rejected by the condenser (compressor motor efficiency = *eff<sub>motor</sub>* = 1.0). For chillers with semi-hermetic or open compressors, only a portion of the compressor energy use is rejected by the condenser. The heat transfer rate for the chiller condenser is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{cond}} = \left( {{P_{chiller}} * ef{f_{motor}}} \right) + {\mathop Q\limits^ \bullet_{evap}} + {\mathop Q\limits^ \bullet_{falseloading}}$$</div>

where

<span>${\mathop Q\limits^ \bullet_{cond}}$</span>         = condenser heat transfer rate, W

<span>$ef{f_{motor}}$</span>       = compressor motor efficiency = fraction of compressor electrical energy consumption rejected as condenser heat

For water-cooled chillers, the water temperature leaving the condenser is then calculated as shown below.

<div>$${T_{cond,l}} = {T_{cond,e}} + {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cond}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{cond}}} {\left( {{{\mathop m\limits^ \bullet  }_{cond}} * {C_{p,cond}}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {{{\mathop m\limits^ \bullet  }_{cond}} * {C_{p,cond}}} \right)}$}}$$</div>

where:

*T<sub>cond,l</sub>*          = water temperature leaving the condenser, ˚C

*T<sub>cond,e</sub>*         = water temperature entering the condenser, ˚C

<span>${\mathop m\limits^ \bullet_{cond}}$</span>         = mass flow rate through the condenser, kg/s

<span>${C_{p,cond}}$</span>       = specific heat of water entering the condenser at *T<sub>cond,e</sub>*, J/kg-˚C

For air- and evaporatively-cooled condensers, the exiting air temperature is not calculated and is set equal to the entering air or wet-bulb temperature, respectively.

The model then calculates the condenser fan energy for air- and evaporatively-cooled condensers. The amount of condenser fan energy is assumed to be proportional to the chiller cycling ratio and is calculated as follows:

<div>$${P_{cond}}\, = \,{\mathop Q\limits^ \bullet_{ref}}\,\left( {{P_{condfanratio}}} \right)\,\left( {ChillerCyclingRatio} \right)$$</div>

where

*P<sub>cond</sub>*           = chiller condenser fan electric power, W

*P<sub>condfanratio</sub>*   = condenser fan power ratio, W/W



The final calculations determine the total heat transfer energy for the condenser and evaporator, as well as the total electric energy consumed by the chiller compressor motor(s) and condenser fan(s). The results are available as output variables.

<div>$${Q_{cond}} = {\mathop Q\limits^ \bullet_{cond}}*TimeStepSys*3600$$</div>

<div>$${Q_{evap}} = {\mathop Q\limits^ \bullet_{evap}}\,\,*\,\,TimeStepSys\,\,*\,\,3600$$</div>

<div>$${E_{chiller}} = {P_{chiller}}*\,\,TimeStepSys\,\,*\,\,3600$$</div>

<div>$${E_{cond}} = {P_{cond}}\,\, * \,\,TimeStepSys\,\,*\,\,3600$$</div>

where

*Q<sub>cond</sub>*          = chiller condenser heat transfer energy, J

*Q<sub>evap</sub>*           = chiller evaporator cooling energy, J

*E<sub>chiller</sub>*         = chiller (compressor) electric energy, J

*E<sub>cond</sub>*           = chiller condenser fan electric energy, J

*TimeStepSys* = HVAC system simulation time step, hr

<span>$3600$</span>         = conversion factor, sec/hr

#### Electric EIR Chiller with Heat Recovery Option

Heat from the electric EIR chiller condenser may be recovered when a water-cooled condenser is selected for simulation. The heat recovery water flow rate is specified by the user along with the input and output nodes connected to the heat recovery loop. The algorithms are identical to those used for Chiller:Electric. Refer to the section entitled Chillers with Plant Heat Recovery for details.

#### Standard Rating (Integrated Part Load Value)

For the Chiller:Electric:EIR and Chiller:Electric:ReformulatedEIR objects in EnergyPlus, the industry standard rating of Integrated Part Load Value (IPLV) is calculated according to ANSI/AHRI Standard 550/590 (2011). This standard rating is not direct input to the model and is calculated using user-entered information for these objects. These standard rating values are provided in the eplusout.eio output file (Ref. Output Details document) and also in the predefined tabular output reports (Output:Table:SummaryReports object, Equipment Summary).

Note: The standard ratings described in this section require that the EIR/Reformulated EIR chiller models be evaluated at specific operating conditions (e.g., specific evaporator outlet temperature (6.67 C) and dry-bulb temperatures for air entering the air-cooled [outdoor] condenser). If the chiller  performance curves can not be evaluated at the required test conditions, then the standard rating value will be determined at user specified curve limit and warning error message is provided. For example, if the curve object (Curve:Biquadratic) for Cooling Capacity Function of Temperature Curve has a minimum value of 21C for dry-bulb temperature entering the air-cooled condenser coil, the IPLV calculation requires that EER<sub>D</sub> be calculated at 13 C – so, this would result in IPLV value calculated at 21C and reported in the output and a warning message in the eplusout.err file.

The IPLV is a single number part-load performance figure of merit for Water-Chilling Packages. The IPLV equations and procedures described below are taken from Appendix D of ANSI/AHRI Std. 550/590, 2011 and provide a consistent method for calculating IPLV. These equations provide representative average part-load efficiency for a single chiller.  For equipment covered by this standard, the *IPLV* is calculated using the following formula:

<div>$$IPLV = (0.01A) + (0.42B) + (0.45C) + (0.12D)$$</div>

where,

<span>$A$</span>  =   *EER* or *COP* at 100% capacity at AHRI standard rating conditions

<span>$B$</span>  =   *EER* or *COP* at 75% capacity and reduced ambient (see Table 51)

<span>$C$</span>  =   *EER* or *COP* at 50% capacity and reduced ambient (see Table 51)

<span>$D$</span>  =   *EER* or *COP* at 25% capacity and reduced ambient (see Table 51)

The Coefficient of Performance (*COP*) at the various load capacity points (100%, 75%, 50%, and 25% part-load ratios) are calculated using the procedure outlined below and applicable test conditions specified in Table 51.

EER at desired reduced capacity (75%, 50%, and 25%) is calculated as follows

<div>$$COP = \frac{{\rm{1}}}{{EIR}}$$</div>

<div>$$EIR = EnergyInputRatio = \left( {\frac{{{\rm{Power }}}}{{{\rm{PartLoadRatio * AvailChillerCap}}}}} \right)$$</div>

<div>$$Power = \left( {\frac{{{\rm{AvailChillerCap}}}}{{CO{P_{reference}}}}} \right)(EIRTempModFa{c_{ReducedTemp}})(EIRPLRModFa{c_{ReducedPLR}})$$</div>

<div>$$AvailChillerCap = Capacit{y_{reference}}(CAPTempModFa{c_{ReducedTemp}})$$</div>

<span>$Capacit{y_{reference}}$</span>= Reference chiller capacity specified by the user, (W).

<span>$CO{P_{reference}}$</span>= Reference coefficient of performance specified by the user, (W/W).

<span>$EIRTempModFa{c_{ReducedTemp}}$</span>= User-specified bi-quadratic curve for modifying EIR as a function of leaving chilled water temperature (6.7°C) and entering condenser temperature obtained from Table 51 for reduced capacities, (dimensionless).

<span>$EIRPLRModFa{c_{ReducedPLR}}$</span>= User-specified quadratic curve for modifying EIR as a function of part load ratio.

<span>$CapTempModFa{c_{ReducedTemp}}$</span>= Capacity (W) of the chiller determined per the ANSI/AHRI Standard 550/590 reduced ambient test conditions as shown in Table 51.

If the equipment cannot be unloaded to the desired reduced capacity (75%, 50%, and 25%) i.e. if the minimum unloading ratio of the chiller is greater than desired reduced capacity, then the model is run at the minimum unloading PLR of the equipment at the condenser entering conditions defined in Table 51 and the efficiency is adjusted for cyclic performance.

<div>$$COP = \frac{{\rm{1}}}{{{C_D} \cdot EIRatMinPLR}}$$</div>

 where,

<span>$EIRatMinPLR$</span>= EIR of chiller at minimum unloading ratio

<span>${C_D}$</span>= degradation coefficient to account for cycling of the compressor for capacity less than the minimum capacity.

Thedegradation coefficient *C<sub>D</sub>* for the desired reduced load points (75%, 50%, or 25%) is determined using the following equation:

<div>$${C_D} = 1.13 - 0.13LF$$</div>

The load factor (*LF*) for the desired reduced load points (75%, 50%, or 25%) calculated from the following equation:

<div>$$LF = \frac{{\left( {\frac{{\% Load}}{{100}}} \right) \cdot Full{\rm{ }}load{\rm{ }}unit{\rm{ }}capacity}}{{Part{\rm{ }}load{\rm{ }}unit{\rm{ }}capacity}}$$</div>

Where,

*<span>$\left( {\frac{{\% Load}}{{100}}} \right)$</span>*            =          standard rating part load ratio (*PLR*) points, 75%, 50%, 25%.

<span>$Full{\rm{ }}load{\rm{ }}unit{\rm{ }}capacity$</span> =            Full load heating capacity (W) of the air-source heat pump equipment determined from ANSI/AHRI Standard 550/590 and test conditions shown in Table 51 for 100% load.

<span>$Part{\rm{ }}load{\rm{ }}unit{\rm{ }}capacity$</span> =           Part load heating capacity (W) of the air-source heat pump units determined from ANSI/AHRI Standard 550/590 at the standard desired reduced ambient test conditions as shown in Table 51  and the minimum part load capacity of the unit.

<div>$$Full{\rm{ }}load{\rm{ }}unit{\rm{ }}capacity = {\dot Q_{total,Reference}}\left( {CapTempModFa{c_{Rated}}} \right)$$</div>

<div>$$Part{\rm{ }}load{\rm{ }}unit{\rm{ }}capacity = MinPLR \cdot {\dot Q_{total,Reference}}\left( {CapTempModFa{c_{ReducedTemp}}} \right)$$</div>

where,

<span>${\dot Q_{total,Reference}}$</span> = Reference capacity specified by the user, (W).

<span>$CapTempModFa{c_{Rated}}$</span>= User-specified bi-quadratic curve evaluated at full load (100%) test conditions shown in Table 51, (dimensionless).

<span>$CapTempModFa{c_{ReducedTemp}}$</span>= Part load capacity (W) of the chiller determined from ANSI/AHRI Standard 550/590 at the standard desired reduced ambient test conditions as shown in Table 51.

<span>$MinPLR$</span>= Minimum PLR up to which chiller can be unloaded



Table 51. Standard Rating (Integrated Part Load Value)

Standard Rating (Integrated Part Load Value)
 &lt;&lt;Source: Table 3, Page 10, ANSI/AHRI Standard 550/590 -2011&gt;&gt;



IPLV

NPLV

Evaporator (All types)

100 % Load LWT

0% Load LWT

Flow Rate (gpm)

F.F.A



<sup>2</sup>44.0°F

 44.0°F

<sup>3</sup>2.4 gpm/ton

0.0001

h· ft<sup>2</sup> ·°F/Btu



6.7°C

6.7°C

0.043 L/s per kW

0.000018

m<sup>2</sup>·°C/W



<sup>2</sup>Selected LWT

Same as 100% load

<sup>3</sup>Selected gpm/ton

As Specified



<sup>2</sup>Selected LWT

Same as 100% load

<sup>3</sup>[L/s per kW]

As Specified

<sup>1</sup>Condenser (Water Cooled)

100% load EWT

75% load EWT

50% load EWT

25% load EWT

0% load EWT

Flow rate (gpm) [L/s]

F.F.A.



<sup>2</sup>85.0°F

 75.0°F

 65.0°F

 65.0°F

 65.0°F

<sup>3</sup>3.0 gpm/ton

0.00025

 h· ft<sup>2</sup> ·°F/Btu



29.4°C

23.9°C

18.3°C

18.3°C

18.3°C

0.054 L/s per kW

0.000044

 m<sup>2</sup>·°C/W



<sup>2</sup>Selected EWT

<sup>4</sup>

<sup>4</sup>

<sup>4</sup>

65.0°F

<sup>3</sup>Selected gpm/ton

As Specified



<sup>2</sup>Selected EWT

<sup>4</sup>

<sup>4</sup>

<sup>4</sup>

18.3°C

<sup> 3</sup>L/s per kW

As Specified

<sup>1</sup>Condenser (Air Cooled)

100% load EDB

75% load EDB

50% load EDB

25% load EDB

0% load EDB

F.F.A.



 95.0°F

 80.0°F

 65.0°F

 55.0°F

 55.0°F

0.0 h· ft<sup>2</sup> ·°F/Btu



35°C

26.7°C

18.3°C

12.8°C

12.8°C

0.0 m<sup>2</sup>·°C/W

No Rating Requirements

<sup>1</sup>Condenser (Evaporatively Cooled)

100% load EWB

0% load EWB

F.F.A.





75.0°F

 50.0°F

0.0 h· ft<sup>2</sup> ·°F/Btu





23.9°C

10.0°C

0.0 m<sup>2</sup>·°C/W

No Rating Requirements

Air-Cooled Without

Condenser

100% load SDT

0% load SDT





125.0°F

 55.0°F





51.7°C

12.8°C

No Rating Requirements

Water and Evaporatively-

Cooled Without Condenser

100% load SDT

0% load SDT





105.0°F

 65.0°F





40.6°C

18.3°C

No Rating Requirements

<sup>1</sup>      If the unit Manufacturer’s recommended minimum temperatures are greater than those specified in Table 3, then those may be used in lieu of the specified temperatures.

<sup>2</sup>      Correction for Fouling Factor Allowance

<sup>3</sup>      The flow rates are to be held constant at full load values for all part-load conditions.

<sup>4</sup>      For part-load entering condenser water temperatures, the temperature should vary linearly from the selected



EWT at 100% load to 65.0 ºF at 50% loads, and fixed at 65.0°F for 50% to 0% loads.



SDT   - saturated discharge temperature

LWT  - leaving water (liquid) temperature

EWT  - entering water (liquid) temperature

EDB   - entering air dry-bulb temperature

EWB  - entering air wet-bulb temperature

F.F.A. - Fouling Factor Allowance

### Electric Chiller Model Based on Condenser Leaving Temperature

#### Overview

This model (object name Chiller:Electric:ReformulatedEIR) simulates the thermal performance of an electric liquid chiller and the power consumption of its compressor(s). The model, developed by Hydeman et al. (2002) as part of the CoolTools™ project sponsored by Pacific Gas and Electric Company (PG&E), is an empirical model similar to EnergyPlus’ Chiller:Electric:EIR model. The model uses performance information at reference conditions along with three curve fits for cooling capacity and efficiency to determine chiller operation at off-reference conditions. The model has the same capabilities as the Chiller:Electric:EIR model, but can potentially provide significant accuracy improvement over the Chiller:Electric:EIR model for chillers with variable-speed compressor motor drives and/or variable condenser water flow applications.

Chiller performance curves can be generated by fitting manufacturer’s catalog data or measured data. Performance curves developed primarily from manufacturer’s performance data are provided in the EnergyPlus Reference DataSets (Chillers.idf and AllDataSets.idf). This chiller model can be used to predict the performance of various chiller types (e.g., reciprocating, screw, scroll, and centrifugal) with water-cooled condensers. The model does not simulate the thermal performance or the power consumption of associated pumps or cooling towers. This auxiliary equipment must be modeled using other EnergyPlus models (e.g. CoolingTower:SingleSpeed).

The main difference between this model and the Chiller:Electric:EIR model is the condenser fluid temperature used in the associated performance curves: the Chiller:Electric:ReformulatedEIR model uses the LEAVING condenser water temperature while the Chiller:Electric:EIR model uses the ENTERING condenser water temperature. In addition, the Energy Input to Cooling Output Function of Part Load Ratio curve for this reformulated EIR chiller model includes the condenser leaving water temperature as an independent variable in addition to part-load ratio. Since the leaving condenser water temperature is a function of load, chiller performance, and condenser entering water temperature, EnergyPlus must iterate to converge on a solution for each simulation time step.

#### Model Description

The chiller model uses user-supplied performance information at reference conditions along with three performance curves (curve objects) for cooling capacity and efficiency to determine chiller operation at off-reference conditions. The three performance curves are:

1)    Cooling Capacity Function of Temperature Curve

2)    Energy Input to Cooling Output Ratio Function of Temperature Curve

3)    Energy Input to Cooling Output Ratio Function of Part Load Ratio Curve

·        The cooling capacity function of temperature curve is a biquadratic performance curve with two independent variables: the leaving chilled water temperature and the leaving condenser water temperature. The output of this curve is multiplied by the reference capacity to give the full-load cooling capacity at specific temperature operating conditions (i.e., at temperatures different from the reference temperatures). The curve should have a value of 1.0 at the reference temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation (otherwise the program issues warning messages).

<div>$$ChillerCapFTemp = a + b({T_{cw,l}}) + c{({T_{cw,l}})^2} + d({T_{cond,l}}) + e{({T_{cond,l}})^2} + f({T_{cw,l}})({T_{cond,l}})$$</div>

where

*ChillerCapFTemp* = Cooling capacity factor, equal to 1 at reference conditions

*T<sub>cw,l</sub>*            = leaving chilled water temperature, ˚C

*T<sub>cond,l</sub>*<sub>            </sub>= leaving condenser water temperature, ˚C. This will be the water temperature entering the condenser loop (e.g., entering the cooling tower). If the chiller is a heat recovery chiller,then the condenser leaving temperature is adjusted to account for both fluid streams as described in the section above on heat recovery chillers.

·        The energy input to cooling output ratio function of temperature curve is a biquadratic performance curve that parameterizes the variation of the energy input to cooling output ratio (EIR) as a function of the leaving chilled water temperature and the leaving condenser water temperature. The EIR is the inverse of the COP. The output of this curve is multiplied by the reference EIR (inverse of the reference COP) to give the full-load EIR at specific temperature operating conditions (i.e., at temperatures different from the reference temperatures). The curve should have a value of 1.0 at the reference temperatures and flow rates specified in the input data file by the user. The biquadratic curve should be valid for the range of water temperatures anticipated for the simulation (otherwise the program issues warning messages).

<span>$ChillerEIRFTemp = a + b({T_{cw,l}}) + c{({T_{cw,l}})^2} + d({T_{cond,l}}) + e{({T_{cond,l}})^2} + f({T_{cw,l}})({T_{cond,l}})$</span>where

*ChillerEIRFTemp* = Energy input to cooling output factor, equal to 1 at reference conditions

*T<sub>cw,l</sub>*      = leaving chilled water temperature, ˚C

*T<sub>cond,l</sub>*<sub>     </sub>= leaving condenser water temperature, ˚C. This will be the water temperature entering the condenser loop (e.g., entering the cooling tower). If the chiller is a heat recovery chiller,then the condenser leaving temperature is adjusted to account for both fluid streams as described in the section above on heat recovery chillers.

·        The energy input to cooling output ratio function of part-load ratio curve parameterizes the variation of the energy input ratio (EIR). The output of this curve is multiplied by the reference EIR (inverse of the reference COP) and the Energy Input to Cooling Output Ratio Function of Temperature Curve to give the EIR at the specific temperatures and part-load ratio at which the chiller is operating. This curve should have a value of 1.0 at the reference leaving condenser water temperature with part-load ratio equal to 1.0. It is recommended that this performance curve be developed using both full- and part-load performance data. The bicubic curve should be valid for the range of condenser water temperatures and part-load ratios anticipated for the simulation (otherwise the program issues warning messages). Either of the following two types of curves can be used.

The first type is a bicubic performance curve that parameterizes the variation of the chiller input power ratio as a function of the leaving condenser water temperature and the part-load ratio. The part-load ratio is the actual cooling load divided by the chiller’s available cooling capacity.

<div>$$ChillerEIRFPLR = a + b({T_{cond,l}}) + c{({T_{cond,l}})^2} + d(PLR) + e{(PLR)^2} + f({T_{cond,l}})(PLR) + g{(PLR)^3}$$</div>

<div>$$ChillerEIRFPLR = \,{\raise0.7ex\hbox{${{P_{chiller}}}$} \!\mathord{\left/ {\vphantom {{{P_{chiller}}} {{P_{ref}}\left( {ChillerCapFTemp} \right)\left( {ChillerEIRFTemp} \right)}}}\right.}\!\lower0.7ex\hbox{${{P_{ref}}\left( {ChillerCapFTemp} \right)\left( {ChillerEIRFTemp} \right)}$}}$$</div>

where

*ChillerEIRFPLR* = Energy input to cooling output factor, equal to 1 at the reference leaving condenser water temperature and PLR = 1.0

*T<sub>cond,l</sub>*<sub>     </sub>= leaving condenser water temperature, ˚C. This will be the water temperature entering the condenser loop (e.g., entering the cooling tower). If the chiller is a heat recovery chiller,then the condenser leaving temperature is adjusted to account for both fluid streams as described in the section above on heat recovery chillers.

*PLR*      =Part load ratio = (cooling load) / (chiller’s available cooling capacity)

*P<sub>chiller</sub> = chiller power at specific PLR*

*P<sub>ref</sub> = <span>${\mathop Q\limits^ \bullet_{ref}}$</span>/COP<sub>ref</sub>*

Note: Although a bicubic curve requires 10 coefficients (ref. Curve:Bicubic), coefficients 7, 9 and 10 are typically not used in the performance curve described here and should be entered as 0 unless sufficient performance data and regression accuracy exist to justify the use of these terms of the bicubic curve.

The second type is a Chiller Part Load Custom Curve that parameterizes the variation of EIR as a function of the normalized dT, normalized Tdev and the PLR.

<div>$$ChillerEIRFPLR = a + b(dT^*) + c(dT^*)^2 + d \cdot PLR + e \cdot PLR^2 + f \cdot (dT^*) \cdot PLR + g \cdot (dT^*)^3  + h \cdot PLR^3 + i \cdot (dT^*)^2 \cdot PLR + j \cdot (dT^*) \cdot PLR^2 + k \cdot (dT^*)^2 \cdot PLR^2 + l \cdot (T_{dev}^*) \cdot PLR^3$$</div>

<div>$$dT^* = dT / dT_{ref}$$</div>

<div>$$T_{dev}^* = T_{dev} / dT_{ref}$$</div>

where

$dT$ = the delta of temperature across the leaving condenser water temperature and leaving evaporator water temperature of a chiller (lift)

$dT^*$ = the normalized fractional lift

$dT_{ref}$ = the lift under the reference condition

PLR = the part load ratio

$T_{dev}$ = the deviation of leaving chilled water temperature from the reference condition

$T_{dev}^*$ = the normalized Tdev term

All three of the performance curves are accessed through EnergyPlus’ built-in performance curve equation manager (curve:biquadratic, curve:bicubic, and Curve:ChillerPartLoadWithLift). Note that the above three performance curves use the leaving condenser water temperature as an independent variable, instead of the entering condenser water temperature used in the performance curves for the Chiller:Electric:EIR model. Since the leaving condenser water temperature is calculated based on the condenser heat transfer rate, which is a function of the load to be met by the chiller, chiller compressor power, and the false loading (detailed calculations are given below), iterative calculations are required to determine the actual (converged) leaving condenser water temperature. The program uses the leaving condenser water temperature from the previous iteration to calculate values for each of the three performance curves described above. After obtaining the condenser heat transfer rate, the leaving condenser water temperature is recalculated. When the difference between the leaving condenser water temperature calculated on successive iterations is less than 0.0001<sup>°</sup>C, the solution is assumed to have converged. Warning messages are issued if the calculated solution for leaving condenser water temperature and/or part-load ratio falls outside the valid range specified for the chiller’s performance curves. If these warnings are issued, the user may choose to extend the range for the performance curves (only if a small extension is required since model extrapolation may produce significant errors) or a different chiller and associated performance curves with extended performance range can be located and used for the simulation.

Note: Chiller:Electric:ReformulatedEIR objects and their associated performance curve objects are developed using performance information for a specific chiller and should almost always be used together for an EnergyPlus simulation. Changing the object input values, or swapping performance curves between chillers, should be done with extreme caution. For example, if the user wishes to model a chiller size that is different from the reference capacity, it is highly recommended that the reference flow rates be scaled proportionately to the change in reference capacity. Although this model can provide more accurate prediction than the Chiller:Electric:EIR model, it requires more performance data to develop the associated performance curves (at least 12 points from full-load performance and 7 points from part-load performance).

Although performance curve data sets for 160 chillers are provided in the EnergyPlus Reference DataSets (Chillers.idf and AllDataSets.idf), they may not meet the requirements for specific applications. One can develop performance curves from performance data using two available techniques (Hydeman and Gillespie 2002). The first technique is called the Least-squares Linear Regression method and is used when sufficient performance data exist to employ standard least-square linear regression techniques. The second technique is called Reference Curve Method and is used when insufficient performance data exist to apply linear regression techniques. A detailed description of both techniques can be found in the reference mentioned above.

For any simulation time step, the chiller’s available cooling capacity is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{avail}}\,\, = \,\,{\mathop Q\limits^ \bullet_{ref}}\left( {ChillerCapFTemp} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{ref}}$</span>     = chiller capacity at reference conditions (reference temperatures and flow rates defined by the user), W

<span>${\mathop Q\limits^ \bullet_{avail}}$</span> = available chiller capacity adjusted for current water temperatures, W

The model then calculates the evaporator heat transfer rate required to bring the entering chilled water temperature down to the leaving chilled water setpoint temperature (established using a SetpointManager object and referenced in the PlantLoop object). If this calculated heat transfer rate is greater than the heat transfer rate being requested by the plant equipment operation scheme, then the evaporator heat transfer rate is reset to the requested cooling rate.

The evaporator heat transfer rate is then compared to the available capacity. If the available chiller capacity is sufficient to meet the evaporator heat transfer rate, the leaving chilled water temperature is set equal to the chilled water setpoint temperature. If the requested evaporator heat transfer rate is larger than the available capacity the chilled water leaving the evaporator is allowed to float upward. For this case, the exiting chilled water temperature is calculated based on the water temperature entering the evaporator, the available cooling capacity, and the evaporator mass flow rate as follows:

<div>$${T_{cw,l}} = {T_{cw,e}} - \left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{avail}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{avail}}} {{{\mathop m\limits^ \bullet  }_{evap}}{C_{p,evap}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop m\limits^ \bullet  }_{evap}}{C_{p,evap}}}$}}} \right)$$</div>

where

*T<sub>cw,l</sub>*            = water temperature leaving the evaporator, ˚C

*T<sub>cw,e</sub>*           = water temperature entering the evaporator, ˚C

<span>${\mathop m\limits^ \bullet_{evap}}$</span>         = evaporator mass flow rate, kg/s

*C<sub>p,evap</sub>*         = specific heat of water entering evaporator at *T<sub>cw,e</sub>*, J/kg-˚C

The part-load ratio is then calculated as the ratio of the evaporator heat transfer rate to the available chiller capacity. The part-load ratio is not allowed to be greater than the maximum part-load ratio specified by the user or less than zero as follows:

<div>$$PLR = MAX\left( {0.0,MIN\left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{evap}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{evap}}} {{{\mathop Q\limits^ \bullet  }_{avail}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{avail}}}$}},\,\,PL{R_{\max }}} \right)} \right)$$</div>

where

*PLR*           = part-load ratio

<span>${\mathop Q\limits^ \bullet_{evap}}$</span>         = load to be met by the chiller, W

*PLR<sub>max\\        </sub>*= maximum part-load ratio (specified by the user in the input data file)

Note that the maximum part-load ratio (PLR<sub>max</sub>, specified in the Chiller:Electric:ReformulatedEIR object) used in the equation should be less than or equal to the maximum part-load ratio specified in the “Energy Input to Cooling Output Ratio Function of Part-Load Ratio” performance curve object.

The model assumes that the cooling load is met through chiller unloading down to the minimum unloading ratio. False loading (e.g. hot-gas bypass) is assumed to occur between the minimum unloading ratio and the minimum part-load ratio yielding constant electrical power consumption under these conditions. Below the minimum part-load ratio, the chiller cycles on/off to meet very small loads and the power consumption during the on cycle is the same as when the chiller is operating at the minimum part load ratio. When the chiller part-load ratio is less than the minimum part-load ratio, the on-off cycling ratio of the chiller is calculated as follows and is available as an output variable.

<div>$$ChillerCyclingRatio = MIN\left( {{\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PL{R_{\min }}}}}\right.}\!\lower0.7ex\hbox{${PL{R_{\min }}}$}},\,\,1.0} \right)$$</div>

To properly account for chiller electric power consumption when PLR is less than the minimum unloading ratio, the PLR is reset to the greater of the PLR calculated above and the PLR at the minimum unloading ratio. The result is available as the output variable Chiller Part Load Ratio.

<div>$$PLR = MAX(PLR,PL{R_{MinUnloadRatio}})$$</div>

This revised PLR accounts for the “false loading” (e.g., hot-gas bypass) that is assumed to occur whenever the PLR (based on cooling load divided by available capacity) is less than the minimum unloading ratio specified. The amount of false loading on the chiller is calculated using this revised PLR and is reported as an output variable as follows:

<div>$${\mathop Q\limits^ \bullet_{falseloading}} = \left( {{{\mathop Q\limits^ \bullet  }_{avail}}} \right)\left( {PLR} \right)\left( {ChillerCyclingRatio} \right) - {\mathop Q\limits^ \bullet_{evap}}$$</div>

The electrical power consumption for the chiller compressor(s) for any simulation time step is then calculated using the following equation:

<span>${P_{chiller}}\, = \,\,\left( {{{\mathop Q\limits^ \bullet  }_{avail}}\,} \right)\,\left( {\frac{1}{{CO{P_{ref}}}}} \right)\,\left( {ChillerEIRFTemp} \right)\left( {ChillerEIRFPLR} \right)\left( {ChillerCyclingRatio} \right)$</span>where

*P<sub>chiller</sub>*         = Chiller compressor power, W

*COP<sub>ref</sub>*       = Reference coefficient of performance, W/W

Heat rejected by the chiller condenser includes the heat transferred in the evaporator plus a portion or all of the compressor electrical energy consumption. For electric chillers with hermetic compressors, all compressor energy consumption is rejected by the condenser (compressor motor efficiency = *eff<sub>motor</sub>* = 1.0). For chillers with semi-hermetic or open compressors, only a portion of the compressor energy use is rejected by the condenser. The heat transfer rate for the chiller condenser is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{cond}} = \left( {{P_{chiller}} * ef{f_{motor}}} \right) + {\mathop Q\limits^ \bullet_{evap}} + {\mathop Q\limits^ \bullet_{falseloading}}$$</div>

where

<span>${\mathop Q\limits^ \bullet_{cond}}$</span>         = condenser heat transfer rate, W

<span>$ef{f_{motor}}$</span>       = compressor motor efficiency = fraction of compressor electrical energy consumption rejected as condenser heat

The above curve values are calculated based on the leaving condenser water temperature found through iteration. After obtaining the condenser heat transfer rate, the final leaving condenser water temperature is then calculated as:

<div>$${T_{cond,l}} = {T_{cond,e}} + {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cond}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{cond}}} {\mathop {\left( {{{\mathop m\limits^ \bullet  }_{cond}}*{C_{p,cond}}} \right)}\limits^{} }}}\right.}\!\lower0.7ex\hbox{${\mathop {\left( {{{\mathop m\limits^ \bullet  }_{cond}}*{C_{p,cond}}} \right)}\limits^{} }$}}$$</div>

where:

*T<sub>cond,l</sub>*          = water temperature leaving the condenser, ˚C

*T<sub>cond,e</sub>*         = water temperature entering the condenser, ˚C

<span>${\mathop m\limits^ \bullet_{cond}}$</span>         = mass flow rate through the condenser, kg/s

<span>${C_{p,cond}}$</span>       = specific heat of water entering the condenser at *T<sub>cond,e</sub>*, J/kg-˚C

The final calculations determine the total heat transfer energy for the condenser and evaporator, as well as the total electric energy consumed by the chiller compressor motor(s) and condenser fan(s). The results are available as output variables.

<div>$${Q_{cond}} = {\mathop Q\limits^ \bullet_{cond}}*TimeStepSys*3600$$</div>

<div>$${Q_{evap}} = {\mathop Q\limits^ \bullet_{evap}}\,\,*\,\,TimeStepSys\,\,*\,\,3600$$</div>

<div>$${E_{chiller}} = {P_{chiller}}*\,\,TimeStepSys\,\,*\,\,3600$$</div>

<div>$${E_{cond}} = {P_{cond}}\,\, * \,\,TimeStepSys\,\,*\,\,3600$$</div>

where

*Q<sub>cond</sub>*          = chiller condenser heat transfer energy, J

*Q<sub>evap</sub>*           = chiller evaporator cooling energy, J

*E<sub>chiller</sub>*         = chiller (compressor) electric energy, J

*E<sub>cond</sub>*           = chiller condenser fan electric energy, J

*TimeStepSys* = HVAC system simulation time step, hr

<span>$3600$</span>         = conversion factor, sec/hr

#### Electric Reformulated EIR Chiller with Heat Recovery Option

Heat from the electric reformulated EIR chiller condenser may be recovered. The heat recovery water flow rate is specified by the user along with the input and output nodes connected to the heat recovery loop. The algorithms are identical to those used for Chiller:Electric and Chiller:Electric:EIR. Refer to the section entitled Chillers with Plant Heat Recovery for details.

#### Standard Rating (Integrated Part Load Value)

Integrated Part Laod Value (IPLV) calculations for Reformulated EIR chiller are similar to what are described above for EIR chillers. The only difference with Reformulated EIR chiller is that it calls an iterative subroutine (SolveRegulaFalsi) to obtain a condenser water outlet temperature which corresponds to condenser inlet temperature at reduced capacity conditions as outlined in Table 51 above. SolveRegulaFalsi is a general utility routine for finding the zero of a function. In this case it finds the condenser inlet temperature that will zero the residual function – the difference between calculated condenser inlet temperature and desired condenser inlet temperature per ANSI/AHRE 550/590, 2011 (table 42 above) divided by desired condenser inlet temperature.

#### References

Hydeman, M., N. Webb, P. Sreedharan, and S. Blanc. 2002. Development and Testing of a Reformulated Regression-Based Electric Chiller Model. ASHRAE Transactions HI-02-18-2.

Hydeman, M. and K.L. Gillespie. 2002. Tools and Techniques to Calibrate Electric Chiller Component Models. ASHRAE Transactions AC-02-9-1.

Hydeman, M., K. Gillespie, and R. Kammerud. 1997. PG&E’s CoolTools project: A toolkit to improve evaluation and operation of chilled water plants. Presented at the Cool$ense National Forum on Integrated Chilled Water Retrofits, Sep. 1997. Berkeley California: Lawrence Berkeley National Laboratory.

### Engine Driven Chiller

The engine driven chiller (Object name: Chiller:EngineDriven) is the empirical model from the Building Loads and System Thermodynamics (BLAST) program. Fitting catalog data to a third order polynomial equations generates the chiller performance curves.  Three sets of coefficients are required to model the open centrifugal chiller as discussed in the section, titled, ‘Electric Chiller Based on BLAST Centrifugal Chiller Model’. Additional curve fits are required to model the engine.  Because the model inherently involves the lower heating value of the fuel, a reference temperature is also involved in the calculations, which manufacturers present at 25°C.

The engine model was also developed for the BLAST program. It was adapted for use in EnergyPlus. This model is used for both the engine driven generator and the engine driven chiller.  It uses the following set of equations all of which are quadratic fits to the PLR (Part Load Ratio) of the generator.  The coefficients must be derived from manufacturers data.

<div>$$\frac{{chiller\,\,cooling\,\,load}}{{fuel\,\,energy\,\,input}} = \frac{{chiller\,\,cooling\,\,load}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {a_1} + {a_2}PLR + {a_3}PL{R^2}$$</div>

The exhaust gas temp and flow rate are used if a stack heat exchanger is used to recover waste heat from the exhaust.  This temperature is the inlet temperature to the heat exchanger which is modeled in a UA-effectiveness form:

<div>$$\frac{{Total\,Exhaust\,heat}}{{fuel\,energy\,input}} = \frac{{Total\,\,Exhaust\,\,heat}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {d_1} + {d_2}PLR + {d_3}PL{R^2}$$</div>

<div>$$\frac{{Exhaust\,\,Gas\,\,Temp\,\,\left\{ K \right\}}}{{fuel\,\,energy\,\,input}} = \frac{{Exhaust\,\,Gas\,\,Temp\,\,\left\{ K \right\}}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {e_1} + {e_2}PLR + {e_3}PL{R^2}$$</div>

The exhaust flow rate is then calculated as:

<div>$${\dot m_{exhaust}} = \frac{{Total\,\,Exhaust\,\,heat}}{{C{p_{exhaust}} \cdot \left( {{T_{exhaust}} - {T_{reference}}} \right)}}$$</div>

where T<sub>reference</sub> is the reference temperature for the fuel lower heating value, and is given as 25°C in manufacturer’s data, and

<div>$${T_{stack}} = {T_{DesignMinExhaust}} + {\frac{{\left( {{T_{exhaust}} - {T_{DesignMinExhaust}}} \right)}}{{{\rm{exp}}\left( {\frac{{{\rm{UA}}}}{{{{{\rm{\dot m}}}_{{\rm{exhaust}}}}C{p_{exhaust}}}}} \right)}}^2}$$</div>

Finally, heat recovered from the lube oil and the water jacket are accounted for as follows:

<div>$$\frac{{Recoverable\,\,jacket\,\,heat}}{{fuel\,\,energy\,\,input}} = \frac{{Recoverable\,\,jacket\,\,heat}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {b_1} + {b_2}PLR + {b_3}PL{R^2}$$</div>

<div>$$\frac{{Recoverable\,\,lube\,\,oil\,\,heat}}{{fuel\,\,energy\,\,input}} = \frac{{Recoverable\,\,lube\,\,oil\,\,heat}}{{\left( {{{\dot m}_{fuel}}\left\{ {kg/s} \right\} \cdot LHV\left\{ {J/kg} \right\}} \right)}} = {c_1} + {c_2}PLR + {c_3}PL{R^2}$$</div>

#### Chiller Basin Heater

Calculations are also made to estimate the electric power input to the basin heater for chillers with evaporatively-cooled condensers. The chillers which calculate basin heater power are Chiller:Electric:EIR, Chiller:Electric, Chiller:ConstantCOP, Chiller:EngineDriven and Chiller:CombustionTurbine.A schedule may be used to disable the basin heater during regular maintenance periods or other time periods (e.g., during summer). If a schedule is not provided, the basin heater is assumed to be available the entire simulation time period. The basin heater operates when it is scheduled on, the outdoor air dry-bulb temperature is below the basin heater setpoint temperature, and the chiller is not active (i.e., chiller is not operating for the simulation time step --- for example, when there is no cooling load to be met by the chiller, *or if there is no water flow through the chiller due to a chiller or pump availability schedule, etc.*). The user is required to enter a basin heater capacity (watts per degree Kelvin) and a heater setpoint temperature (<sup>o</sup>C) if they want to model basin heater electric power.

<div>$$\begin{array}{l}{P_{heater,basin}} = 0.0\\IF\left( {ChillerIsOFF} \right)THEN\\\,\,\,\,\,\,IF\left( {Schedul{e_{heater,basin}}\,is\,Defined} \right)THEN\\\,\,\,\,\,\,\,\,\,\,\,\,IF\left( {CA{P_{heater,basin}}\, > \,0\,.AND.\,Schedul{e_{heater,basin}}\, = \,ON} \right)THEN\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{P_{heater,basin}} = \,MAX\left( {0.0,CA{P_{heater,basin}}\left( {{T_{setpoint,basin}} - {T_{db,outdoor}}} \right)} \right)\,\,\,\,\,\,\\\,\,\,\,\,\,\,\,\,\,\,ENDIF\\\,\,\,\,\,ELSE\\\,\,\,\,\,\,\,\,\,\,\,IF\left( {CA{P_{heater,basin}}\, > \,0\,} \right)THEN\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,{P_{heater,basin}} = \,MAX\left( {0.0,CA{P_{heater,basin}}\left( {{T_{setpoint,basin}} - {T_{db,outdoor}}} \right)} \right)\,\,\,\,\,\,\\\,\,\,\,\,\,\,\,\,\,\,ENDIF\,\\\,\,\,\,\,ENDIF\\ENDIF\end{array}$$</div>

<div>$${E_{heater,basin}} = \left( {{P_{heater,basin}}} \right)\left( {TimeStepSys} \right)3600$$</div>

where:

<span>${P_{heater,basin}}$</span> = Chiller basin heater electric power (W)

<span>${E_{heater,basin}}$</span>= Chiller basin heater electric consumption (J)

*T<sub>setpoint,basin</sub>* = Basin heater setpoint temperature, user input (<sup>o</sup>C)

*T<sub>db,outdoor</sub>*    = Outdoor air dry-bulb temperature (<sup>o</sup>C)

*CAP<sub>heater,basin</sub>* = Basin heater capacity, user input (W/K)

*Schedule<sub>heater,basin</sub>* = Basin heater schedule, user input (schedule value &gt; 0 means ON)

*ChillerIsOFF =*Logical variable denoting that the chiller is not operating for the current simulation time step (e.g.,  there is no cooling load to be met by the chiller, or if there is no water flow through the chiller due to a chiller or pump availability schedule, etc.)



Ice Thermal Storage <a name="IceStorage"></a>
-------------------

### Simple Ice Storage Model

#### Overview

This model (object name ThermalStorage:Ice:Simple) simulates the performance of an ice storage tank. The model is based on an integrated chiller and storage tank model developed for a special optimization project (Henze and Krarti 2002). This implementation removed the integrated chiller and allows the tank to be charged by any chiller configuration in an EnergyPlus plant loop..

This thermal storage model is based on a simple simulation of an ice storage tank with a fixed capacity.  The tank is charged, or frozen, in an ice-on-coil configuration where ice builds up on the outside of the tubes carrying the brine or glycol solution from the chiller.  There are two discharge (melt) options, internal or external.  Internal melt uses the same fluid tubes for charging and discharging.  External melt uses a separate fluid path for discharge such that the outer layers of ice melt first.  The ice storage model includes an implied 3-way valve to control the amount if charge/discharge based on the incoming water temperature and the outlet node setpoint temperature.  The tank is controlled using the PlantEquipmentOperation:ComponentSetpoint plant operation scheme, and requires that a setpoint be placed by a setpoint manager on the ice storage Plant Outlet Node.  The model currently does not calculate any tank losses.

#### Model Description

##### Initialization

The storage tank is assumed to be fully charged (full of ice) at the beginning of each environment.  The tank is then allowed to charge and discharge during the warmup days of the environment.

##### Control

The ice storage module is a passive component and will accept any flow rate placed on the inlet node.  The load on the ice storage tank is determined by the inlet node flow rate, the inlet node temperature, and the outlet node setpoint temperature.  A positive load indicates a request for cooling and the tank discharges if possible.  A negative load indicates a request for charging the tank if possible.  A zero load indicates the tank is dormant in which case all flow bypasses the tank and the outlet node temperature is set to the inlet node temperature.  The model includes an implied 3-way valve which controls the leaving water temperature to the outlet node setpoint temperature if possible.

##### Charging

When charging is requested, the following limits are calculated to determine the actual charging rate:

1)    If the entering water temperature is greater than –1C, the charging rate is zero.

2)    If the entering water temperature is greater than or equal to the outlet setpoint temperature, the charging rate is zero.

3)    If the current fraction of ice stored is 1.0, the tank is fully charge, and the charging rate is zero.

4)    If the requested charging rate times the current system timestep is more than the remaining uncharged storage capacity, the charging rate is limited to that required to completely fill the tank.

5)    The maximum charging rate which the chilled water flow can provide is determined by the entering water temperature and flow rate and an outlet temperature which is the minimum of –1C or the outlet setpoint temperature.

6)    The maximum charging rate which the tank can accept is calculated by the following equations developed in the prior work (Henze and Krarti 2002):

*UAIceCh* = ( 1.3879 - 7.6333\**y* + 26.3423\**y*<sup>2</sup> - 47.6084\**y*<sup>3</sup> + 41.8498\**y*<sup>4</sup> - 14.2948\**y*<sup>5</sup> ) \* *ITSNomCap* / *TimeInterval* / 10.0

where:

*UAIceCh*   = UA rate for charging

*y*                = Current ice fraction stored

*ITSNomCap*          = Nominal storage capacity [GJ]

TimeInterval = 3600 [s]

The smallest charging rate determined by the above rules is selected and the corresponding leaving water temperature is calculated.

##### Discharging

When discharging is requested, the following limits are calculated to determine the actual charging rate:

1)    If the entering water temperature is less than 1C, the discharge rate is zero.

2)    If the entering water temperature is less than or equal to the outlet setpoint temperature, the discharge rate is zero.

3)    If the current fraction of ice stored is 0.0, the tank is fully discharged, and the discharge rate is zero.

4)    If the requested discharge rate times the current system timestep is more than the remaining charged storage capacity, the discharge rate is limited to that required to completely deplete the ice in the tank.

5)    The maximum discharge rate which the chilled water flow can accept is determined by the entering water temperature and flow rate and an outlet temperature which is the maximum of 1C or the outlet setpoint temperature.

6)    The maximum discharge rate which the tank can deliver is calculated by the following equations developed in the prior work (Henze and Krarti 2002):

For ice-on-coil internal melt:

*UAIceDisCh* = ( 1.3879 - 7.6333\**y* + 26.3423\**y*<sup>2</sup> - 47.6084\**y*<sup>3</sup> + 41.8498\**y*<sup>4</sup> - 14.2948\**y*<sup>5</sup> ) \* *ITSNomCap* / *TimeInterval* / 10.0

For ice-on-coil external melt:

*UAIceDisCh* = ( 1.1756 - 5.3689\**y* + 17.3602\**y*<sup>2</sup> - 30.1077\**y*<sup>3</sup> + 25.6387\**y*<sup>4</sup> - 8.5102\**y*<sup>5</sup> ) \* *ITSNomCap* / *TimeInterval* / 10.0

where:

UAIceDisCh            = UA rate for discharging

*y*                = 1 - Current ice fraction stored

*ITSNomCap*          = Nominal storage capacity [GJ]

TimeInterval = 3600 [s]

The smallest discharge rate determined by the above rules is selected and the corresponding leaving water temperature is calculated.

#### References

Henze, Gregor P. and Moncef Krarti. 2002. Predictive Optimal Control of Active and Passive Building Thermal Storage Inventory, Final Report for Phase I:  Analysis, Modeling, and Simulation.  U.S. Department of Energy National Energy Technology Laboratory Cooperative Agreement DE-FC-26-01NT41255, December 2002.

### Detailed Ice Storage Model

The following section describes how the detailed ice storage model works in EnergyPlus (object name ThermalStorage:Ice:Detailed).

#### Charging and Discharging Equation

The actual performance of the ice storage unit depends on the physical geometry, materials, and characteristics of the ice storage unit.  In analyzing performance data trends from ice storage manufacturers, it was determined that the following equation would work well for the discharging process:

<div>$${q^*} = \left[ {C1 + C2\left( {1 - {P_c}} \right) + C3{{\left( {1 - {P_c}} \right)}^2}} \right] + \left[ {C4 + C5\left( {1 - {P_c}} \right) + C6{{\left( {1 - {P_c}} \right)}^2}} \right]\Delta T_{lm}^*$$</div>

or

<div>$${q^*} = \left[ {C1 + C2\left( {{P_d}} \right) + C3{{\left( {{P_d}} \right)}^2}} \right] + \left[ {C4 + C5\left( {{P_d}} \right) + C6{{\left( {{P_d}} \right)}^2}} \right]\Delta T_{lm}^*$$</div>

where:

<div>$${q^*} \equiv \frac{{q\Delta t}}{{{Q_{stor}}}}$$</div>

<div>$$\Delta T_{lm}^* \equiv \frac{{\Delta {T_{lm}}}}{{\Delta {T_{no\min al}}}}$$</div>

<div>$$\Delta {T_{lm}} \equiv \frac{{{T_{brine,in}} - {T_{brine,out}}}}{{\ln \left( {\frac{{{T_{brine,in}} - {T_{brine,freeze}}}}{{{T_{brine,out}} - {T_{brine,freeze}}}}} \right)}}$$</div>

q is the instantaneous heat transfer rate,

Qstor is the total latent storage capacity,

Dt is a time step used in the curve fit (usually one hour),

DT<sub>nominal</sub> is a nominal temperature difference (18°F = 10°C),

T<sub>brine,in</sub> is the tank brine inlet temperature,

T<sub>brine,out</sub> is the tank brine outlet temperature,

T<sub>freeze</sub> is the freezing temperature of water or the latent energy storage material,

P<sub>c</sub> is the fraction charged, and

P<sub>d</sub> is the fraction discharged.

Likewise, the charging process of the ice storage device can be characterized by the following equation that is similar in form to the discharging equation:

<div>$${q^*} = \left[ {C1 + C2\left( {{P_c}} \right) + C3{{\left( {{P_c}} \right)}^2}} \right] + \left[ {C4 + C5\left( {{P_c}} \right) + C6{{\left( {{P_c}} \right)}^2}} \right]\Delta T_{lm}^*$$</div>

Note that the time step might differ from the time step used within the EnergyPlus simulation.  These are actually two separate time steps and are kept separate.

#### Charging Algorithm

During charging, manufacturers have stated that they attempt to charge the unit at the maximum rate until the unit is completely charged.  This, of course, occurs during off-peak electric hours.  Thus, once the setpoint has been scheduled for charging, the unit will charge at the maximum possible rate.  This means that the flow rate through the ice storage device equals the flow to the component (or no bypass).  The only time flow to the ice storage unit would be reduced is at the end of the charge cycle when more ice making capacity is available in a particular time step than is needed to fully charge the tank.  In this case, the flow to the tank would be reduced appropriately to top off the tank storage capacity.  We also have a setpoint goal for the outlet temperature of the ice storage device as defined by the setpoint schedule.

In solving the performance of the ice storage unit, we have effectively two equations (one of which is non-linear) and two unknowns.  The equations are:

<div>$${q^*} = \left[ {C1 + C2\left( {{P_c}} \right) + C3{{\left( {{P_c}} \right)}^2}} \right] + \left[ {C4 + C5\left( {{P_c}} \right) + C6{{\left( {{P_c}} \right)}^2}} \right]\Delta T_{lm}^*$$</div>

from which we can obtain the component load (q) and

<div>$$q = \dot m{C_p}\left( {{T_i} - {T_o}} \right)$$</div>

Both of these equations have q and T<sub>o</sub> as unknowns.  However, since the setpoint temperature is the goal for T<sub>o</sub>, we can use this as an initial guess for T<sub>o</sub>.  Below is an outline of the algorithm:

n Initialize T<sub>o</sub>= T<sub>set</sub>

n Calculate LMTD\*

n Calculate q\* from charging equation for the current percent charged (We will assume that the EnergyPlus time step is sufficiently small so that we do not need to find the average percent charged for the time step.  This was necessary when one hour time steps were used as in BLAST, but EnergyPlus generally uses relatively short time steps.  Since there is already some iteration involved in the solution, we would like to avoid another layer of iteration if at all possible.  One alternative that could be implemented would be to make a second pass with a closer average value based on what happens during the time step.  This would effectively double the execution time for the model and would need to be justified before implementation.)

n Calculate T<sub>o,new</sub> and compare it to T<sub>o</sub>

n Use T<sub>o,new</sub> to calculate a new LMTD\* and iterate until T<sub>o</sub> converges to some acceptable level

Charging would continue in subsequent time steps until the final state of the ice storage unit at the end of a particular time step is fully charged.  If running a chiller would “overcharge” the tank, then the flow to the tank would be reduced (greater than zero bypass flow) while maintaining the same setpoint temperature coming out of the tank (though not necessarily out of the component).

#### Discharging Algorithm

During discharging, we cannot assume that all of the flow is sent through the ice storage unit and thus some of it may be bypassed around it locally.  This ice storage model includes a built-in bypass leg to accommodate this without requiring the user to enter this additional information.  This also allows the bypass leg/valve to be controlled by the ice storage unit.

While we cannot assume that all of the flow is sent through the ice storage unit, we can use that as an initial guess in order to determine the current performance of the ice storage system.  Most of the discharging algorithm then becomes very similar to the charging process.

In solving the performance of the ice storage unit, we have effectively two equations (one of which is non-linear) and two unknowns.  The equations are:

<div>$${q^*} = \left[ {C1 + C2\left( {{P_d}} \right) + C3{{\left( {{P_d}} \right)}^2}} \right] + \left[ {C4 + C5\left( {{P_d}} \right) + C6{{\left( {{P_d}} \right)}^2}} \right]\Delta T_{lm}^*$$</div>

from which we can obtain the component load (q) and

<div>$$q = \dot m{C_p}\left( {{T_i} - {T_o}} \right)$$</div>

Both of these equations have q and T<sub>o</sub> as unknowns.  However, since the setpoint temperature is the goal for T<sub>o</sub>, we can use this as an initial guess for T<sub>o</sub>.  Below is an outline of the algorithm:

n Initialize T<sub>o</sub>= T<sub>set</sub>

n Calculate LMTD\*

n Calculate q\* from charging equation for the current percent charged (we will assume that the EnergyPlus time step is sufficiently small so that we do not need to find the average percent charged for the time step; this was necessary when one hour time steps were used as in BLAST, but EnergyPlus generally uses relatively short time steps)

n Calculate T<sub>o,new</sub> and compare it to T<sub>o</sub>

n Use T<sub>o,new</sub> to calculate a new LMTD\* and iterate until T<sub>o</sub> converges to some acceptable level

n Once T<sub>o</sub> has converged, we need to compare this value again to T<sub>set</sub>.  If T<sub>o</sub> is greater than or equal to T<sub>set</sub>, then we either just met the load (equal) or can’t quite meet it (greater than).  In this case, we simply leave T<sub>o</sub> as is because we cannot meet the setpoint temperature.

n If T<sub>o</sub> is less than T<sub>set</sub>, then we have more capacity available than we need.  In this case, we need to bypass some of the flow.  Since the load on the ice storage device and the outlet temperature are not changing (we are just reducing the flow), we only need to split the flow and do not need to recalculate the action of the ice storage device.  Some systems may be slightly dependent on the actual flow through the device itself.  However, in an actual application, this only means that a slightly different amount will bypass the device.  The overall energy impact will be the same and thus it is not necessary to be concerned about flow rate dependence.

Discharging would continue in subsequent time steps until the final state of the ice storage unit at the end of a particular time step is fully discharged.

#### References

Strand, R.K. 1992. "Indirect Ice Storage System Simulation," M.S. Thesis, Department of Mechanical and Industrial Engineering, University of Illinois at Urbana-Champaign.

Coils <a name="Coils"></a>
-----

### Chilled-Water-Based Air Cooling Coil

The input object Coil:Cooling:Water is simpler than the detailed geometry model.  The simple model provides a good prediction of the air and water outlet conditions without requiring the detailed geometric input required for the detailed model.  A greatly simplified schematic of enthalpy and temperature conditions in a counter flow cooling/dehumidifying coil is shown in the schematic Figure 162.  The input required to model the coil includes only a set of thermodynamic design inputs, which require no specific manufacturer's data.  The coil simulation model is essentially a modification of one presented by Elmahdy and Mitalas (1977), TRNSYS, 1990 and Threlkeld, J.L. 1970.  The model calculates the UA values required for a Dry, Wet and Part Wet & Part Dry Coil and iterates between the Dry and Wet Coil to output the fraction wet.  There are two modes of flow operation for this model: Cross Flow, which is widely applicable in HVAC systems and the second being Counter flow mode. The default value in program is set up for Counter Flow.  In addition the coil has two modes of analysis: Simple Analysis and Detailed Analysis. The Simple analysis mode operates the coil as either wet or dry while the detailed mode simulates the coil as part wet part-dry. While the detailed mode provides more accurate results, it is significantly slower than the simple model. The simple mode gives good results for an annual simulation but will not be adequate for a time step performance analysis.

![](EngineeringReference/media/image3304.svg.png)

Figure 162.  Simplified Schematic of Cooling/Dehumidifying Coil

#### Heat Transfer and Energy Balance

The cooling coil may be completely dry, completely wet with condensation, or it may have wet and dry sections.  The actual condition of the coil surface depends on the humidity and temperature of the air passing over the coil and the coil surface temperature.  The part-dry part-wet case represents the most general scenario for the coil surface conditions.  There are subroutines present in the model for both the dry and wet regions of the coil, and a subroutine that iterates between the dry and wet subroutines to calculate the fraction of the coil surface that is wet.  For each region the heat transfer rate from air to water may be defined by the rate of enthalpy change in the air and in the water.  The rates must balance between each medium for energy to be conserved.

#### Model Description

The Model has two blocks: 1<sup>st</sup> = Design Block with the Design Inputs. This block calculates the Design U-Factor Times Area Value (UA) values required by the model. Using these UA values the model simulates the operating conditions.  The operating block is the one containing the operating conditions, the conditions at which the coil operates. Following is the list of Design and Operating inputs and subsequently the Design and Operating variables used in the model.

Table 52.  Design Inputs (User Inputs)

<table class="table table-striped">





<tr>
<td>Input Field</td>
<td>Description</td>
</tr>
<tr>
<td>DesWaterVolFlowRate:</td>
<td>Maximum Water Volume Flow Rate</td>
</tr>
<tr>
<td>DesAirVolFlowRate:</td>
<td>Maximum Air Volume Flow Rate</td>
</tr>
<tr>
<td>DesInletWaterTemp:</td>
<td>Inlet Water Temperature at Design Condition</td>
</tr>
<tr>
<td>DesInletAirTemp:</td>
<td>Inlet Air Temperature at Design Condition</td>
</tr>
<tr>
<td>DesOutletAirTemp:</td>
<td>Outlet Air Temperature at Design Condition</td>
</tr>
<tr>
<td>DesInletAirHumRat:</td>
<td>Inlet Air Humidity Ratio at Design Conditions</td>
</tr>
<tr>
<td>DesOutletAirHumRat:</td>
<td>Outlet Air Humidity Ratio at Design Conditions.</td>
</tr>

</table>



Table 53.  Operating Conditions (From Nodes -- not user inputs)

<table class="table table-striped">





<tr>
<td>Condition Variable</td>
<td>Description</td>
</tr>
<tr>
<td>InletWaterMassFlowRate:</td>
<td>Entering Water Mass Flow Rate at operating condition</td>
</tr>
<tr>
<td>InletWaterTemp:</td>
<td>Inlet Water Temperature at operating condition</td>
</tr>
<tr>
<td>InletAirMassFlowRate:</td>
<td>Entering Air Mass Flow Rate at operating condition</td>
</tr>
<tr>
<td>InletAirTemp:</td>
<td>Inlet Air Temperature at operating condition</td>
</tr>
<tr>
<td>InletAirHumRat:</td>
<td>Entering air humidity ratio at operating conditions</td>
</tr>

</table>



#### Intermediate calculated U-Factor Times Area Values: The Crux of the Model

The various U-Factor Times Area values (UA) required by this model are calculated from the above inputs, which are explained later in the document.  The various UA are:

Table 54.  UA Descriptions of Model

<table class="table table-striped">





<tr>
<td>UA Variable Name</td>
<td>Description</td>
</tr>
<tr>
<td>CoilUATotal:</td>
<td>Overall heat transfer coefficient (W/C)</td>
</tr>
<tr>
<td>CoilUAInternal:</td>
<td>Overall internal UA (W/C)</td>
</tr>
<tr>
<td>CoilUAExternal:</td>
<td>Overall external UA (W/C)</td>
</tr>
<tr>
<td>CoilUInternal:</td>
<td>Internal overall heat transfer coefficient (W/m<sup>2</sup>∙C)</td>
</tr>
<tr>
<td>CoilUWetExternal:</td>
<td>Wet part external overall heat transfer coefficient (W/m<sup>2</sup>∙C)</td>
</tr>
<tr>
<td>CoilUDryExternal:</td>
<td>Dry part external overall heat transfer coefficient (W/m<sup>2</sup>∙C)</td>
</tr>

</table>

The UA values are calculated assuming a wet coil at the design conditions. Following are a few important calculations to understand the working of the model.  The model is basically divided into two blocks: the Design Block and the Operating Block.

The Design Block is a one time calculation. The aim of the Design Block is to calculate the Coil UA for use in the operating Block.

#### Design Block Calculations:

The design block has the code for calculating the six Coil UA values required by the operating block. Reasonable assumptions have been made in the calculations to maintain the simplicity of the model.

Heat transfer in a wet coil model is based on enthalpy rather than temperature to take into account latent effects. While heat transfer rates are commonly expressed as the product of an overall heat transfer coefficient, UA, and a temperature difference, the use of enthalpy-based heat transfer calculations requires an enthalpy-based heat transfer coefficient which we denote as DesUACoilTotalEnth and hence the equation.

Q = DesUACoilTotalEnth \* (H<sub>air,mean</sub> - H<sub>water,mean</sub>). The value of Q is calculated using product of air mass flow rate and difference in inlet and outlet air enthalpies at design conditions.

The relation between the enthalpy-based UA and the temperature-based UA is DesUACoilTotalEnth = CoilUA / C<sub>p</sub>. CoilUA is the conventional heat transfer coefficient and C<sub>p</sub> = specific heat of the air.

We need the following quantities for our design calculations. The *Psy* functions are the EnergyPlus built-in psychrometric functions.

<div>$${\dot m_{air}} = {\rho_{air}}{\dot V_{air}}$$</div>

<div>$${h_{air,in}} = {\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{air,in}},{w_{air,in}})$$</div>

<div>$${h_{air,out}} = {\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{air,out}},wout)$$</div>

<div>$${h_{w,sat,in}} = {\rm{PsyHFnTdbW}}({T_{w,in}},{\rm{PsyWFnTdpPb}}({T_{w,in}},{P_{atm}}))$$</div>

<div>$${\dot Q_{coil}} = {\dot m_{air}}({h_{air,in}} - {h_{air,out}})$$</div>

<div>$${T_{w,out}} = {T_{w,in}} + {\dot Q_{coil}}/({\dot m_{w,\max }}{C_{p,w}})$$</div>

<div>$${h_{w,sat,out}} = {\rm{PsyHFnTdbW}}({T_{w,out}},{\rm{PsyWFnTdpPb}}({T_{w,out}},{P_{atm}}))$$</div>

We now calculate the design coil bypass factor. The bypass factor is not used in subsequent calculations. It is calculated solely to use as check on the reasonableness of the user-input design inlet and outlet conditions. First we make an initial estimate of the apparatus dew point temperature:

<div>$${T_{air,dp,app}} = {\rm{PsyTdpFnWPb}}({w_{air,out}},{P_{atm}})$$</div>

we also need the "slope" of temperature versus humidity ratio on the psych chart between the inlet and outlet air conditions:

<div>$${S_{T,w}} = ({T_{air,in}} - {T_{air,out}})/({w_{air,in}} - {w_{air,out}})$$</div>

We now obtain the actual design apparatus dewpoint temperature by iterating over the following two equations:

<div>$${w_{air,dp,app}} = {\rm{PsyWFnTdpPb}}({T_{air,dp,app}},{P_{atm}})$$</div>

<div>$${T_{air,dp,app}} = {T_{air,in}} - {S_{T,w}}({w_{air,in}} - {w_{air,dp,app}})$$</div>

The apparatus dewpoint enthalpy is then:

<div>$${h_{air,dp,app}} = {\rm{PsyHFnTdbW}}({T_{air,dp,app}},{w_{air,dp,app}})$$</div>

and the coil bypass factor is:

<div>$${F_{coilbypass}} = ({h_{air,out}} - {h_{air,dp,app}})/({h_{air,in}} - {h_{air,dp,app}})$$</div>

If the iterative procedure doesn't converge, or the coil bypass factor is too large (greater than 0.5), or the apparatus dewpoint enthalpy is less than the saturated air enthalpy at the water inlet temperature, the design outlet air conditions are reset to 90% relative humidity at the same outlet enthalpy. The above design calculations are then repeated.

We are now ready to calculate the design coil UA. This will be accomplished by inverting the simple coil calculation routine *CoolingCoil* using the Regula Falsi method. First we make an initial estimate of the coil UA.

<div>$$\Delta {h_{lmd}} = (({h_{air,in}} - {h_{w,sat,out}}) - ({h_{air,out}} - {h_{w,sat,in}}))/log(({h_{air,in}} - {h_{w,sat,out}}) - ({h_{air,out}} - {h_{w,sat,in}}))$$</div>

<div>$$U{A_{coil,enthalpy - based}} = {\dot Q_{coil}}/\Delta {h_{lmd}}$$</div>

<div>$$U{A_{coil,ext}} = {C_{p,air}}U{A_{coil,enthalpy - based}}$$</div>

We set the internal UA to 3.3 times the external UA (as a typical value for a coil). Then the total UA is:

<div>$$U{A_{coil,tot}} = \frac{1}{{(1/U{A_{coil,int}} + 1/U{A_{coil,ext}})}}$$</div>

The next step is to estimate the coil external heat transfer surface area. This is done in the function *EstimateHEXSurfaceArea*:

<div>$$Are{a_{coil,ext}} = {\rm{EstimateHEXSurfaceArea}}$$</div>

using the following assumptions:

* Tube inside diameter = 0.0122 (m)

* Tube side water velocity = 2.0 (m/s)

* Inside to outside coil surface area ratio (Ai/Ao) = 0.07 (-)

* Fins overall efficiency = 0.92 (-)

* Aluminum fins, 12 fins per inch with fins to total outside surface area ratio of 90%.

* Airside combined heat and mass transfer coefficient = 140 (W/m2∙°C)

Interior and exterior U values (really UA's per unit exterior surface area) are calculated by dividing the above UA's by the area. The resulting U<sub>coil,ext</sub> is assumed to be U<sub>coil,ext,wet</sub>; U<sub>coil,ext,dry</sub> is set equal to U<sub>coil,ext,wet</sub>. We now have all the starting values needed for inverting the simple coil model using the chosen Regula Falsi iterative method. Once the iteration is completed, we have coil UA's and U's that yield the design outlet air and water enthalpies given the inlet design conditions and flow rates. Note that the simple coil model can not exactly match the specified design outlet air temperature and humidity ratio. It can only match the design air outlet enthalpy. Generally the simple coil model will yield outlet conditions near the saturation curve if any dehumidification is occuring. Typical outlet relative humidities are around 95%.

#### Variable UA

The above calculations yield coil UA's for the design inlet conditions and air and water flow rates. As the flow rates vary during the time step calculations, the UA's need to be adjusted, since coil UA's are a rather strong function of air and water side flow rates. Each time step the coil UA's are modified using the same formulas as are used in the hot water coil model. Refer to that model for the flow dependences.

#### Operating Block Calculations:

There are two modes of coil analysis in the operating block. They are the Simple analysis mode and the detailed analysis mode. The simple analysis mode assumes the coil to be either all wet or either all dry and execute the model , on the other hand the detailed mode checks for part wet part dry mode of operation and reports surface area wet fraction of coil, however the program execution time in detailed mode is noticeably higher.

The operating block for Detailed Mode Analysis of this coil model is divided into three modes of coil performance. The modes being

n Coil is completely dry: There is no moisture condensation on the coil surface and the coil is a dry coil. This is an extreme condition when the entering air has very low humidity ratio or is dry air.

n Coil is completely wet: The entire coil is wet due to complete condensation on the surface of the coil.

n Part Wet Part Dry Mode: This is the usual/frequent mode of operation of coil, as shown in figure 1, where part of the coil at entry of air is dry and as air cools condensation occurs and part of the coil becomes wet.

The Part Wet Part Dry Mode of operation is essentially a function the Coil Completely Dry and Coil Completely Wet mode. This subroutine iterates between the Dry Coil and the Wet Coil to give outputs, a detailed explanation is given later in the document. The operating block requires 5 inputs, which are mentioned earlier in the document. These inputs are automatically generated from the node connections in Energy Plus. The user does not have to input any information to run this coil model.

The option to identify which mode of operation the coil should perform ie, for a given set of inputs would the coil be Dry, Wet or Part Wet Part Dry, is decided by set of conditions described below.

n **IF** (**Temperature Dewpoint Air &lt; Water Inlet Temperature**) **THEN** the coil is Dry and we call the Subroutine Coil Completely Dry.  In this case outlet temperature of air would be higher than the air dewpoint and hence there would be no condensation.

n **IF** (**Temperature Dewpoint Air &gt; Water Inlet Temperature**) **THEN** the coil is completely wet, call subroutine Coil Completely Wet, it is assumed that moisture condensation occurs over completely surface of the coil. However we go ahead and check for the coil being partially wet with the following condition.

n **IF (AirDewPointTemp &lt; AirInletCoilSurfTemp) THEN,** the coil is Partially Wet because there is possibility that air temperature will go below its dewpoint and moisture will condense on latter part of the cooling coil.

The Operating Block for Simple Mode Analysis is divided into two modes of coil performance, the two modes being

n Coil is completely dry: There is no moisture condensation on the coil surface and the coil is a dry coil.

n Coil is completely wet: The entire coil is wet due to complete condensation on the surface of the coil.

The option to identify which mode of operation the Simple mode analysis should perform ie, for a given set of inputs would the coil be Dry or Wet is decided by set of conditions described below.

n **IF** (**Temperature Dewpoint Air &lt; Water Inlet Temperature**) **THEN** the coil is Dry and we call the Subroutine Coil Completely Dry.  In this case outlet temperature of air would be higher than the air dewpoint and hence there would be no condensation.

n **IF** (**Temperature Dewpoint Air &gt; Water Inlet Temperature**) **THEN** the coil is completely wet, call subroutine Coil Completely Wet, it is assumed that moisture condensation occurs over completely surface of the coil. However we go ahead and check for the coil being partially wet with the following condition.

The above is a simple mode of analysis and the results are very slightly different from the detailed mode of analysis. The algorithms used in Simple mode and the Detailed mode are identically similar. The surface area wet fraction in the coil is reported as 1.0 or 0.0 for wet or dry coil respectively. The program defaults to simple mode of analysis for enabling higher execution speed.

#### Effectiveness Equations:

There are two modes of flow for the coil, Counter Flow mode or the Cross Flow mode, default set up is as cross flow since most air condition applications have cross flow heat exchangers. According to the mode of flow the following NTU - Effectiveness relationships are used to calculate coil effectiveness, which is used later by all the three modes (Dry, Wet, Part Wet) for calculating air outlet conditions and heat transfer.

Following are the relations used for calculating effectiveness equation for the Heat exchangers.

Counter Flow Heat Exchanger: Effectiveness Equation:

<div>$${\eta_{CounterFlow}} = \frac{{(1 - Exp( - NTU \times (1 - Rati{o_{StreamCapacity}})))}}{{1 - Rati{o_{StreamCapacity}} \times Exp( - NTU \times (1 - Rati{o_{StreamCapacity}}))}}$$</div>

In Equation   the variable Ratio\_StreamCapacity is defined as below

<div>$$Rati{o_{StreamCapacity}} = \frac{{MinCapacit{y_{Stream}}}}{{MaxCapacit{y_{Stream}}}}$$</div>

In equation capacity of stream is defined as below in equation

<div>$$(Min,Max)\,\,Capacit{y_{Stream}} = {(MassFlowRate \times Cp)_{air,water}}$$</div>

NTU in equation , is defined as the Number of Transfer Units, it is a function of Coil UA and the Minimum Capacity of Stream. The Coil UA is a variable in this equation and depends on which mode of the coil operation (Dry, Wet, Part Wet) is calling upon equation , i.e., if it is Coil Completely Dry calling upon the effectiveness equation with the value of Dry UA total, which in our case is defined as CoilUA\_total. Equation gives definition for NTU.

<div>$$NTU = \frac{{CoilUA}}{{MinStrea{m_{Capacity}}}}$$</div>

Cross Flow Heat Exchanger: Effectiveness Equation:

<div>$${\eta_{CrossFlow}} = 1 - EXP\left\{ {\frac{{Exp( - NTU \times Rati{o_{StreamCapacity}} \times NT{U^{ - 0.22}}) - 1}}{{Rati{o_{StreamCapacity}} \times NT{U^{ - 0.22}}}}} \right\}$$</div>

The variables in the above equation have already been defined earlier. Depending on the mode of operation of the coil model the cross or the counter flow equations are used to calculate the effectiveness.

#### Coil Outlet Conditions:

Calculating the Outlet Stream Conditions using the effectiveness value from equation   or depending on the mode of flow. The energy difference between the outlet and inlet stream conditions gives the amount of heat transfer that has actually take place. Temperature of air and water at outlet to the coil is given as in following equations

<div>$$TempAi{r_{Out}} = TempAi{r_{inlet}} - {\eta_{cross,counter}} \times \frac{{MaxHeatTransfer}}{{StreamCapacit{y_{Air}}}}$$</div>

<div>$$TempWate{r_{Out}} = TempWate{r_{Inlet}} + {\eta_{Cross,counter}} \times \frac{{MaxHeatTransfer}}{{StreamCapacit{y_{Water}}}}$$</div>

In the above equations and the maximum heat transfer is calculated as shown in the following equation

<div>$$MaxHeatTransfer = MinStrea{m_{Capacity}} \times (TempAi{r_{Inlet}} - TempWate{r_{Inlet}})$$</div>

#### Coil Completely Dry Calculations: (operating block)

Since the coil is dry, the sensible load is equal to total load and the same with the humidity ratios at inlet and outlet, as in equations and .

<div>$$QSensibl{e_{DryCoil}} = QTota{l_{DryCoil}}$$</div>

<div>$$HumRati{o_{Inlet}} = HumRati{o_{Outlet}}$$</div>

Total Heat Transfer in dry coil is as follows:

<div>$${Q_{TotalDryCoil}} = CapacityAir \times (AirTem{p_{In}} - AirTem{p_{Outlet}})$$</div>

The variables in the above equation are calculated earlier in equations and to give the total cooling load on the coil.

#### Coil Completely Wet Calculations: (operating block)

In wet coil we need to account for latent heat transfer, hence calculations are done using enthalpy of air and water instead of stream temperatures Hence we need to define coil UA for the wet coil based on enthalpy of the operating streams and not design streams.

Similar to equations and we calculate the air outlet enthalpy and water outlet enthalpy ie by replacing temperature with enthalpy of the respective streams. The input variable for Coil UA in equation for calculating NTU, in this case it would be enthalpy based and is given as shown in equation

<div>$$CoilU{A_{\,Enthalpy\,Based}} = \frac{1}{{\left( {\frac{{CpSa{t_{Intermediate}}}}{{CoilU{A_{\,Internal}}}} + \frac{{C{p_{Air}}}}{{CoilU{A_{\,External}}}}} \right)}}$$</div>

Total Coil Load in case of Wet Coil is the product of mass flow rate of air and enthalpy difference between the inlet and outlet streams as given in the following equation

<div>$${Q_{Total}} = {\mathop M\limits^ *_{air}} \times (EnthAi{r_{Inlet}} - EnthAi{r_{Outlet}})$$</div>

Once the enthalpy is known the outlet temperatures and outlet humidity ratios of the wet coil are calculated as in equations below.

**IF (TempCondensation &lt; PsyTdpFnWPb(InletAirHumRat ,Patm)) THEN**

<div>$$AirTem{p_{Out}} = AirTem{p_{inlet}} - (AirTem{p_{inlet}} - Condensatio{n_{Temp}}) \times \eta $$</div>

and

**OutletAirHumdityRatio = PsyWFnTdbH(OutletAirTemp,EnthAirOutlet)**

**ELSE**

There is no condensation and hence the inlet and outlet Hum Ratios are equal , and outlet temperature is a function of outlet air enthalpy as below

**OutletAirTemp      =  PsyTdbFnHW (EnthalpyAirOutlet, OutletAirHumRat)**

**and**

**OutletAirHumRat  =  InletAirHumRat**

**ENDIF**

Effectiveness η used in equation is defined in equation and Condensation Temperature is calculated using psychrometric function as in equation .

<div>$$\eta  = 1 - Exp\left\{ { - \frac{{CoilU{A_{\,External}}}}{{Capacitanc{e_{Air}}}}} \right\}$$</div>

<span>$Condensatio{n_{Temp}} = {\rm{PsyTsatFnHPb(Ent}}{{\rm{h}}_{{\rm{AirCondensateTemp}}}}{\rm{,Patm) }}$</span>                <span>$Ent{h_{\,AirCondensateTemp}} = Ent{h_{\,AirInlet}} - \frac{{\left( {Ent{h_{\,AirInlet}} - Ent{h_{\,AirOutlet}}} \right)}}{\eta }$</span>

Once the air outlet temperature are known, then sensible load is calculated as a product of capacitance of air and temperature difference at inlet and outlet, as in equation

<div>$${Q_{Sensible}} = Capacitanc{e_{Air}} \times \left( {AirTem{p_{Inlet}} - AirTem{p_{Outlet}}} \right)$$</div>

#### Coil Part Wet Part Dry Calculations: (operating block)

The Coil would perform under part wet part dry conditions when Air Dewpoint Temperature is less than Coil surface temperature at inlet to air. In this case part of the coil used value of Dry UA for heat transfer and part the coil used Wet UA value for heat transfer.

This problem is solved utilizing the fact that the Exit conditions from the Dry Part of the Coil would become the inlet conditions to the wet part of the coil (see Figure 162) and the coil model determines by iteration what fraction of the coil is wet and based on that it calculates the areas and subsequently the UA values of that dry and wet part, based on the area of the dry and wet part respectively. Explained below are the steps followed to the estimating the wet dry behavior of the coil.

n Iterate between the Dry Coil and the Wet Coil. First calculate Coil Completely Dry performance by estimating the wet dry interface water temperature using equation and inputting this variable as the water inlet temperature to dry Coil.

<span>$WetDryInterfac{e_{WaterTemp}} = {\rm{WaterTem}}{{\rm{p}}_{{\rm{Inlet}}}}{\rm{ + Are}}{{\rm{a}}_{{\rm{WetFraction}}}}{\rm{*(WaterTem}}{{\rm{p}}_{{\rm{Outlet}}}}{\rm{ - WaterTem}}{{\rm{p}}_{{\rm{Inlet}}}}{\rm{)}}$</span>    

The value of Surface Area Wet fraction is estimated initially as follows

<div>$$Are{a_{\,WetFractionEstimate}} = \frac{{AirDewP{t_{\,Temp}} - InletWate{r_{\,Temp}}}}{{OutletWate{r_{\,Temp}} - InletWate{r_{\,Temp}}}}$$</div>

For the above mentioned iteration the value of Coil UA for Wet and Dry part need to be varied according to the new respective area of the wet and dry parts. This estimate of Wet and Dry area is a product of the estimated Surface Area Fraction and total coil external area, which keeps varying as will be explained further in the document.

UA value for Dry part of the Coil is estimated as below.

<div>$$CoilU{A_{Dry\,External}} = \frac{{SurfAre{a_{Dry}}}}{{\frac{1}{{Coil{U_{Dry\,External}}}} + \frac{1}{{Coil{U_{Internal}}}}}}$$</div>

Where Surface Area Dry =(Total Coil Area – Wet Part Area), where the Wet part area is the product of Surface fraction Wet and Total Coil Area.

UA value for the Wet part of the Coil requires Wet UA external and Wet UA Internal, which are calculated as below.

<div>$$WetPartUA{\,_{External}} = Coil{U_{Wet\,External}} \times SurfaceAreaWet$$</div>

<div>$$WetPartUA{\,_{Internal}} = Coil{U_{Internal}} \times SurfaceAreaWet$$</div>

It is essential to remember that the mode of calculation for the coils remains the same as in completely wet and completely dry mode, only the UA values and water, air outlet and inlet values change.

Now Iterate between the Dry Coil and wet Coil with the above respective UA, and usual operating inputs except the variable water inlet temperature for dry Coil is replaced with Wet Dry Interface Water temperature, and in the Wet Coil the Outlet Air Temperature from dry Coil is the inlet air temperature to Wet Coil. The iteration proceeds till the Outlet Water Temperature from Wet Coil equals the Wet Dry Interface Water Temp, which is the input to Dry Coil.

Dry Part Inputs: (changed operating inputs) :Iteration Case 1: Explained In Programming Fashion:

**CALL CoilCompletelyDry (WetDryInterfcWaterTemp, InletAirTemp, DryCoilUA,               &**

**                             OutletWaterTemp, WetDryInterfcAirTemp, WetDryInterfcHumRat,        &**

**DryCoilHeatTranfer).**

Input the calculated values calculated by Dry Coil above into Wet Coil below. The variables have been highlighted in color red and blue.

**CALL**CoilCompletelyWet (InletWaterTemp, **WetDryInterfcAirTemp**, **WetDryInterfcHumRat**

WetPartUAInternal,WetPartUAExternal,                                                  &

**EstimateWetDryInterfcWaterTemp**, OutletAirTemp, OutletAirHumRat,    &

WetCoilTotalHeatTransfer, WetCoilSensibleHeatTransfer,                       &

EstimateSurfAreaWetFraction, WetDryInterfcSurfTemp)

Iterate Between the above two Wet and Dry Coil calls until the two variables in blue ie **WetDryInterfcWaterTemp = EstimateWetDryInterfcWaterTemp.**The key is to have the difference between the variables (WetDryInterfcWaterTemp – OutletWaterTemp) in Dry Coil equal to (InletWaterTemp-EstimatedWetDryInterfcWaterTemp) in Wet Coil. This equality quantized the relative part of coil that is dry and part that is wet on the basis of heat transfer that has occurred.

After the above convergence check for the coil being dry otherwise iterate to calculate surface fraction area wet.

**IF**

<div>$$\left\{ {(AreaFractio{n_{Wet}} \le \,0.0)\,\,and(WetDryInterfac{e_{SurfTemp}} > AirDewPt)} \right\}$$</div>

**THEN CoilCompletelyDry**

If equation is satisfied then Coil is Dry and simply output the value for Dry Coil calculated else the coil is partially wet and then iterate to find the surface fraction area wet. Start with the initially guess value of surface area fraction (equation wet and iterate on the entire loop starting from until the Wet Dry Interface Temperature equals the Air Dewpoint Temperature. The value of Surface Area fraction wet at which the interface air temperature equals is dewpoint is the transition point from wet to dry and gives the % of coil that is dry and % that is wet.

Graphs Showing the Performance of the coil model at optimum operating conditions are shown below. All values of variable used have been normalized.

![](EngineeringReference/media/image3348.png)

Figure 163.  Air Outlet Temperature Vs Air Mass Flow Rate



![](EngineeringReference/media/image3349.png)

Figure 164.  Sensible Load variations Vs Air mass Flow Rate



![](EngineeringReference/media/image3350.png)

Figure 165.  Total and Sensible Load variations Vs Air Mass Flow Rate



![](EngineeringReference/media/image3351.png)

Figure 166.  Surface Area Fraction Wet Vs Air Mass Flow Rate

#### References

IBPSA BuildSim-2004. 2004. Colarado Boulder: An Improvement of Ashrae Secondary HVAC toolkit Simple Cooling Coil Model for Building Simulation, Rahul J Chillar, Richard J Liesen M&IE ,UIUC.

Stoecker, W.F. &lt;dates unspecified&gt; Design of Thermal Systems,: ME 423 Class Notes , M& IE Dept UIUC.

Brandemeuhl, M. J. 1993. HVAC2 Toolkit: Algorithms and Subroutines for Secondary HVAC Systems Energy Calculations, ASHRAE.

Elmahdy, A.H. and Mitalas, G.P.  1977. "A Simple Model for Cooling and Dehumidifying Coils for Use In Calculating Energy Requirements for Buildings ASHRAE Transactions, Vol.83 Part 2, pp. 103-117.

Threlkeld, J.L.  1970.  Thermal Environmental Engineering, 2nd Edition, Englewood Cliffs: Prentice-Hall,Inc. pp. 254-270.

ASHRAE Secondary HVAC Toolkit TRNSYS.  1990.  A Transient System Simulation Program: Reference Manual. Solar Energy Laboratory, Univ. Wisconsin-Madison, pp. 4.6.8-1 - 4.6.8-12.

Kays, W.M. and A.L. London. 1964. Compact Heat Exchangers, 2nd Edition, New York: McGraw-Hill.

Clark, D.R.. 1985. HVACSIM+ Building Systems and Equipment Simulation Program Reference Manual, Pub. No. NBSIR 84-2996, National Bureau of Standards, U.S. Department of Commerce, January, 1985

Elmahdy, A.H. 1975. Analytical and Experimental Multi-Row Finned-Tube Heat Exchanger Performance During Cooling and Dehumidifying Processes, Ph.D. Thesis, Carleton University, Ottawa, Canada, December, 1975.

Elmahdy, A.H., and Mitalas, G.P. 1977. "A Simple Model for Cooling and Dehumidifying Coils for Use in Calculating Energy Requirements for Buildings," ASHRAE Transactions, Vol.  83, Part 2, pp. 103-117.

### Chilled-Water-Based Detailed Geometry Air Cooling Coil

The input object Coil:Cooling:Water:DetailedGeometry provides a coil model that predicts changes in air and water flow variables across the coil based on the coil geometry. A greatly simplified schematic of enthalpy and temperature conditions in a counterflow cooling/dehumidifying coil is shown in the following schematic figure. In addition, the variables required to model a cooling/dehumidifying coils and their definitions are extensively listed in “Table 55. Coil Geometry and Flow Variables for Coils”. The input required to model the coil includes a complete geometric description that, in most cases, should be derivable from specific manufacturer's data.  The coil simulation model is essentially the one presented by Elmahdy and Mitalas (1977) and implemented in HVACSIM+ (Clark 1985), a modular program also designed for energy analysis of building systems. The model solves the equations for the dry and wet sections of the coil using log mean temperature and log mean enthalpy differences between the liquid and the air streams.  Elmahdy and Mitalas state that crossflow counterflow coils with at four rows or more are approximated well by this model.  This does not constitute a major limitation since cooling and dehumidifying coils typically have more than four rows.

![](EngineeringReference/media/image3352.svg.png)

Figure 167.  Simplified Schematic of Cooling/Dehumidifying Coil

#### Heat Transfer and Energy Balance

The cooling coil may be completely dry, completely wet with condensation, or it may have wet and dry sections.  The actual condition of the coil surface depends on the humidity and temperature of the air passing over the coil and the coil surface temperature.  The partly wet-partly dry case represents the most general scenario for the coil surface conditions.  The all dry and all wet cases can be considered as limiting solutions of the wet or dry areas respectively going to zero.  In the general case, equations are written for both the dry and wet regions of the coil.  For each region the heat transfer rate from air to water may be defined by the rate of enthalpy change in the air and in the water.  The rates must balance between each medium for energy to be conserved.  Equations through express the energy balance between the water and the air for the case of dry and wet coils respectively.  Equations and represent the heat transfer rate between water and air based on the actual performance of the coil.  The UA parameter can be calculated from the parameters in the following table.





Table 55. Coil Geometry and Flow Variables for Coils

<table class="table table-striped">







<tr>
<td>A</td>
<td>area</td>
<td>LMHD</td>
<td>log mean enthalpy difference</td>
</tr>
<tr>
<td>A</td>
<td>air, air side</td>
<td>LMTD</td>
<td>log mean temperature difference</td>
</tr>
<tr>
<td>aa, bb</td>
<td>coeff. in enthalpy approximation</td>
<td><span>$\dot m$</span></td>
<td>mass flow rate</td>
</tr>
<tr>
<td>C1, C2</td>
<td>coeff. in air side film coeff.</td>
<td>mf</td>
<td>metal and fouling</td>
</tr>
<tr>
<td>Cp</td>
<td>specific heat</td>
<td>m</td>
<td>viscosity</td>
</tr>
<tr>
<td>D</td>
<td>diameter, effective diameter</td>
<td>o</td>
<td>outside (air side)</td>
</tr>
<tr>
<td>Dhdr</td>
<td>hydraulic diameter on air side</td>
<td>Pr</td>
<td>Prandtl number</td>
</tr>
<tr>
<td>D</td>
<td>dry region</td>
<td><span>$\dot Q$</span></td>
<td>heat transfer rate</td>
</tr>
<tr>
<td>d</td>
<td>thickness</td>
<td>R</td>
<td>overall thermal resistance</td>
</tr>
<tr>
<td>D</td>
<td>spacing</td>
<td>Re</td>
<td>Reynolds number</td>
</tr>
<tr>
<td>F</td>
<td>heat transfer film coefficient</td>
<td>r</td>
<td>ratio of diameters</td>
</tr>
<tr>
<td>Fai</td>
<td>variable in fin eff. calculation</td>
<td>s</td>
<td>surface, outside of metal</td>
</tr>
<tr>
<td>fin, fins</td>
<td>air side fin geometry</td>
<td>St</td>
<td>Stanton number</td>
</tr>
<tr>
<td>H</td>
<td>enthalpy</td>
<td>T</td>
<td>temperature</td>
</tr>
<tr>
<td>h</td>
<td>efficiency</td>
<td>tube</td>
<td>water tube</td>
</tr>
<tr>
<td>I0()</td>
<td>mod Bessel fn, 1st kind, ord 0</td>
<td>UAdry</td>
<td>dry heat xfer coeff. * dry area</td>
</tr>
<tr>
<td>I1()</td>
<td>mod Bessel fn, 1st kind, ord 1</td>
<td>UcAw</td>
<td>wet heat xfer coeff. * wet area</td>
</tr>
<tr>
<td>K0()</td>
<td>mod Bessel fn, 2nd kind, ord 0</td>
<td>ub, ue</td>
<td>variables in fin eff. calculation</td>
</tr>
<tr>
<td>K1()</td>
<td>mod Bessel fn, 2nd kind, ord 1</td>
<td>V</td>
<td>average velocity</td>
</tr>
<tr>
<td>I</td>
<td>inside (water side)</td>
<td>w</td>
<td>water, water side, or wet region</td>
</tr>
<tr>
<td>K1</td>
<td>variable in sol'n form of eq.</td>
<td>wa</td>
<td>humidity ratio</td>
</tr>
<tr>
<td>K</td>
<td>thermal conductivity</td>
<td>Z</td>
<td>variables in sol'n form of eq.</td>
</tr>
<tr>
<td>L</td>
<td>length</td>
<td>1, 2, 3</td>
<td>positions (see diagram)</td>
</tr>

</table>

Equations through represent two sets of three equations with 7 unknowns: <span>${\dot Q_d}$</span>, Ta,1, Ta,2, Tw,2, Tw,3, <span>${\dot m_a}$</span>, <span>${\dot m_w}$</span>. However, normally at least four of these variables are specified, for example: inlet water temperature, outlet air temperature, water flow rate, air flow rate, so that the system of equations is effectively closed.

<div>$${\dot Q_d} = {m_a}C{p_a}\left( {{T_{a,1}} - {T_{a,2}}} \right)$$</div>

<div>$${\dot Q_d} = {m_w}C{p_w}\left( {{T_{w,3}} - {T_{w,2}}} \right)$$</div>

<div>$${\dot Q_d} = \left( {U{A_{dry}}} \right)\left( {LMTD} \right)$$</div>

<div>$${\dot Q_w} = {m_a}\left( {{H_{a,2}} - {H_{a,3}}} \right)$$</div>

<div>$${\dot Q_w} = {m_w}C{p_w}\left( {{T_{w,2}} - {T_{w,1}}} \right)$$</div>

<div>$${\dot Q_w} = \left( {{U_c}{A_w}} \right)\left( {LMHD} \right)$$</div>

In order to manipulate these equations, the log mean temperature and enthalpy differences are expanded as shown in Equations and .  Finally, a linear approximation of the enthalpy of saturated air over the range of surface temperature is made using Equation .  Note that in Equation Hw refers to the enthalpy of saturated air at the water temperature.

<div>$$LMTD = \frac{{\left( {{T_{a,1}} - {T_{w,3}}} \right) - \left( {{T_{a,2}} - {T_{w,2}}} \right)}}{{\ln \frac{{{T_{a,1}} - {T_{w,3}}}}{{{T_{a,2}} - {T_{w,2}}}}}}$$</div>

<div>$$LMHD = \frac{{\left( {{H_{a,2}} - {H_{w,2}}} \right) - \left( {{H_{a,3}} - {H_{w,1}}} \right)}}{{\ln \frac{{{H_{a,2}} - {H_{w,2}}}}{{{H_{a,3}} - {H_{w,1}}}}}}$$</div>

<div>$${H_w} = aa + bb {T_w}$$</div>

Equation is derived from the above equations and is used to solve for the coil conditions when all of the inlet conditions are given as input.  Operating in this manner, the coil does not have a controlled outlet air temperature.

<div>$${T_{w,2}} = \frac{{\left( {1 - Z} \right)\left( {{H_{a,1}} - aa - K1 C{p_a} {T_{a,1}}} \right) + Z {T_{w,1}}\left( {bb - \frac{{{m_w}C{p_w}}}{{{m_a}}}} \right)}}{{bb - Z\frac{{{m_w}C{p_w}}}{{{m_a}}} - \left( {1 - Z} \right) K1 C{p_a}}}$$</div>

An alternative solution method is to define the coil leaving air temperature as an input with a variable water flow rate.  In this case Equations and are more convenient.  Equations through define terms that are used to simplify Equations , and .

<div>$${T_{w,2}} = \frac{{\left( {1 - Z} \right)\left( {{H_{a,3}} - aa} \right) + {T_{w,1}}\left( {\frac{{{m_w}C{p_w}}}{{{m_a}}} - bb Z} \right)}}{{\frac{{{m_w}C{p_w}}}{{{m_a}}} - bb}}$$</div>

<div>$${T_{w,2}} = \frac{{\left( {{Z_d} - 1} \right){T_{a1}}C{p_a} + {T_{w,3}}\left( {C{p_a} - {Z_d}\frac{{{m_w}C{p_w}}}{{{m_a}}}} \right)}}{{{Z_d}\left( {C{p_a} - \frac{{{m_w}C{p_w}}}{{{m_a}}}} \right)}}$$</div>

<div>$$Z = exp\left( {{U_c}{A_w}\left( {\frac{1}{{{m_a}}} - \frac{{bb}}{{{m_w}C{p_w}}}} \right)} \right)$$</div>

<div>$$K1 = \frac{{{Z_d} - 1}}{{{Z_d} - \frac{{{m_a}C{p_a}}}{{{m_w}C{p_w}}}}}$$</div>

<div>$${Z_d} = exp\left( {{U_c}{A_{dry}}\left( {\frac{1}{{{m_a}C{p_a}}} - \frac{1}{{{m_w}C{p_w}}}} \right)} \right)$$</div>

#### Underlying Correlations, Properties, and Assumptions

Overall heat transfer coefficients are calculated from the specified coil geometry and by using empirical correlations from fluid mechanics and heat transfer.  For the water side, Equation gives the film heat transfer coefficient in SI units:

<div>$${f_i} = 1.429\left( {1 + 0.0146 {T_w}} \right)V_w^{0.8}D_i^{ - 0.2}$$</div>

This is valid for Reynolds numbers greater than 3100 based on water flow velocity and pipe inside diameter and is given in Elmahdy and Mitalas(1977) as recommended in the standard issued by the Air-Conditioning and Refrigeration Institute (1972) for air-cooling coils.  The definition of overall inside thermal resistance follows directly as shown in Equation.

<div>$${R_i} = \frac{1}{{{f_i}{A_i}}}$$</div>

Equation gives the film coefficient for the air side.  Another form of the same equation is Equation , which is familiar from the data presented in Kays and London (1984).  For coil sections that have a wet surface due to condensation, the air side film coefficient is modified according to Equation .  The correction term, a function of air Reynolds number, is valid for Reynolds numbers between 400 and 1500.  The coefficients in Equation and are calculated by Equations and that are functions of the coil geometry.  Elmahdy (1977)explains the modifier for the wet surface and coefficients for the film coefficient.  Equations through show definitions and values of common parameters and properties.

<div>$${f_o} = {C_1}Re_a^{{C_2}}\frac{{{m_a}}}{{{A_{a\_min\_flow}}}}C{p_a}Pr_a^{{\raise0.5ex\hbox{$\scriptstyle 2$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle 3$}}}$$</div>

<div>$${C_1}Re_a^{{C_2}} = S{t_a}Pr_a^{{\raise0.5ex\hbox{$\scriptstyle 2$}\kern-0.1em/\kern-0.15em\lower0.25ex\hbox{$\scriptstyle 3$}}}$$</div>

<div>$${f_{o,w}} = {f_o}\left( {1.425 - 5.1 \times {{10}^{ - 4}}R{e_a} + 2.63 \times {{10}^{ - 7}}Re_a^2} \right)$$</div>

<div>$${C_1} = 0.159{\left( {\frac{{{\delta_{fin}}}}{{{D_{hdr}}}}} \right)^{ - 0.065}}{\left( {\frac{{{\delta_{fin}}}}{{{L_{fin}}}}} \right)^{0.141}}$$</div>

<div>$${C_2} =  - 0.323{\left( {\frac{{{\Delta_{fins}}}}{{{L_{fin}}}}} \right)^{0.049}}{\left( {\frac{{{D_{fin}}}}{{{\Delta_{tube\_rows}}}}} \right)^{0.549}}{\left( {\frac{{{\delta_{fin}}}}{{{\Delta_{fins}}}}} \right)^{ - 0.028}}$$</div>

<div>$${D_{hdr}} = \frac{{4{A_{a\_min\_flow}}{\delta_{coil}}}}{{{A_{s\_total}}}}$$</div>

<div>$$R{e_a} = \frac{{4{\delta_{coil}}\left( {1 + {w_a}} \right){m_a}}}{{{A_{s\_total}}{\mu_a}}}$$</div>

<div>$$P{r_a} = 0.733$$</div>

<div>$${\mu_a} = 1.846 \times {10^{ - 5}}$$</div>

The film coefficients above act on the extended surface of the air side, that is the area of the fins and the tubes.  Therefore, the fin efficiency must also be considered in calculating the overall thermal resistance on the outside.  Gardner(1945) gives the derivation of Equation , used as a curve fit to find the fin efficiency as a function of film coefficient.  This equation is based on circular fins of constant thickness.  To model a coil with flat fins, an effective diameter -- that of circular fins with the same fin area -- is used.  Equations through define variables used in Equation .  The overall efficiency of the surface is shown by Equation .  Note that the efficiency is found by the same equations for the wet surface using the wet surface film coefficient.

<div>$${\eta_{fin}} = \frac{{ - 2\rho }}{{fai(1 + \rho )}}\left[ {\frac{{{I_1}({u_b}){K_1}({u_e}) - {K_1}({u_b}){I_1}({u_e})}}{{{I_0}({u_b}){K_1}({u_e}) + {K_0}({u_b}){I_1}({u_e})}}} \right]$$</div>

<div>$$fai = \frac{{({D_{fin}} - {D_{tube}})}}{2}\sqrt {\frac{{2{f_o}}}{{{k_{fin}}{\delta_{fin}}}}} $$</div>

<div>$$\rho  = \frac{{{D_{tube}}}}{{{D_{fin}}}}$$</div>

<div>$${u_e} = \frac{{fai}}{{1 - \rho }}$$</div>

<div>$${u_b} = {u_e}\rho $$</div>

<div>$${\eta_o} = 1 - (1 - {\eta_{fin}})\frac{{{A_{fins}}}}{{{A_{s\_total}}}}$$</div>

The definition of overall outside thermal resistance is given in Equation as a function of fin efficiency and film coefficient.  For a wet coil surface the resistance must be defined differently because the heat transfer equations are based on enthalpy rather than temperature differences, as shown in Equation .

<div>$${R_o} = \frac{1}{{{f_o}{\eta_o}{A_{s,total}}}}$$</div>

<div>$${R_{o,w}} = \frac{{{\raise0.7ex\hbox{${C{p_a}}$} \!\mathord{\left/ {\vphantom {{C{p_a}} {bb}}}\right.}\!\lower0.7ex\hbox{${bb}$}}}}{{{f_{o,w}}{\eta_{o,w}}{A_{s,total}}}}$$</div>

Equation gives the last two overall components of thermal resistance.  They represent the metal tube wall and internal fouling.  The fouling factor, due to deposits of dirt and corrosion of the tube inside surfaces, is assumed to be 5x10-5 m2·K/W.  All components of thermal resistance are added in series to produce the overall heat transfer coefficients shown in Equations and .

<div>$${R_{mf}} = \frac{{{\delta_{tube}}}}{{{k_{tube}}{A_i}}} + \frac{{Fl}}{{{A_i}}}$$</div>

<div>$$U{A_{dry}} = \frac{{{A_{dry}}}}{{{A_{s,total}}}}\left[ {\frac{1}{{{R_i} + {R_{mf}} + {R_o}}}} \right]$$</div>

<div>$${U_c}{A_w} = \frac{{{A_w}}}{{{A_{s,total}}}}\left[ {\frac{{{1 \mathord{\left/ {\vphantom {1 {bb}}} \right. } {bb}}}}{{{R_i} + {R_{mf}} + {R_{o,w}}}}} \right]$$</div>

#### Solution Method of Model

The complicated equations derived above were implemented in a successive substitution solution procedure to calculate the coil performance based on the input parameters.  The MODSIM implementation of a cooling coil, the TYPE12 subroutine, was the motivation for this approach; the method used there has been retained with modifications for the uncontrolled coil model.  Clark (1985) contains notes about the MODSIM routine.

In the general case, the cooling coil is only partially wet.  For an uncontrolled coil, Equation  is used to find the water temperature at the boundary.  Several simple equations in the loop adjust the boundary point until the dry surface temperature at the boundary is equal to the dewpoint of the inlet air.  For the controlled coil, Equations and give two calculations of the boundary temperature, and the water flow rate and boundary position are adjusted until the two equations agree.

Special cases occur when the coil is all wet or all dry.  The coil is solved as if it were all wet before the general case is attempted.  If the wet surface temperatures at the coil inlet and outlet are both below the dewpoint, no further solution is required.  However, to ensure a continuous solution as flow variables are changed, when the surface is all dry or when it is wet with only the dry surface equations yielding a surface temperature below the dewpoint at the water outlet, the general solution is used to calculate the unknowns.  In the solution of the controlled coil the outlet air enthalpy, given some resulting dehumidification, must correspond to the enthalpy at the specified outlet air temperature.

#### Application of Cooling Coil Model to Heating Coils

The implementation of detailed heating coil models in IBLAST was another important aspect of the system/plant integration.  The same kind of loops exist to provide hot water to the heating coils from the boilers as exist to supply the cooling coils with chilled water from the chillers.   Some simplifications can be made, however, since the enthalpy change of the air flowing over a heating coil is entirely sensible.  There is no condensation in a heating coil.  In order to allow heating and cooling coils to be specified using the same geometric parameters, a heating coil simulation was developed from the cooling coil model described above by eliminating the wet surface analysis.

In addition, it was concluded that, since much simpler and less computationally expensive heating coil simulations are possible, an option was provided in IBLAST for a heating coil design using only the UA value of the coil, the product of heat transfer coefficient and coil area.  This model was largely based on the TYPE10 subroutine implemented in MODSIM.  The equations used to model the performance of the TYPE10 heating coil are as follows:

<div>$$
  \begin{array}{rl} 
    T_{a,out} &= T_{a,in} + \left( T_{w,in} - T_{ain} \right) \varepsilon \left( \frac{\min \left( C_{p,a} \dot m_a,C_{p,w}\dot m_w \right)} {C_{p,a}\dot m_a} \right) \\
    T_{w,out} &= T_{w,in} - \left( T_{a,out} - T_{ain} \right) \left( \frac{C_{p,a}\dot m_a}{C_{p,w}\dot m_w} \right)
  \end{array}
$$</div>

where the coil effectiveness is given by:

<div>$$\varepsilon  = 1 - \exp \left( {\frac{{\left\{ {\exp \left[ { - \left( {\frac{{\min \left\{ {{C_{p,a}}{{\dot m}_a},{C_{p,w}}{{\dot m}_w}} \right\}}}{{\max \left\{ {{C_{p,a}}{{\dot m}_a},{C_{p,w}}{{\dot m}_w}} \right\}}}} \right){{\left\{ {NTU} \right\}}^{0.78}}} \right] - 1} \right\}}}{{\left( {\frac{{\min \left\{ {{C_{p,a}}{{\dot m}_a},{C_{p,w}}{{\dot m}_w}} \right\}}}{{\max \left\{ {{C_{p,a}}{{\dot m}_a},{C_{p,w}}{{\dot m}_w}} \right\}}}} \right){{\left\{ {NTU} \right\}}^{ - .22}}}}} \right)$$</div>

The parameter NTU is the number of transfer units and is defined as a function of the UA value of the coil as follows:

<div>$${\rm{NTU}} = \frac{{{\rm{UA}}}}{{{\rm{min}}\left( {{{\rm{C}}_{{\rm{p,a}}}}{{{\rm{\dot m}}}_{\rm{a}}}{\rm{,}}{{\rm{C}}_{{\rm{p,w}}}}{{{\rm{\dot m}}}_{\rm{w}}}} \right)}}$$</div>



### Hot-Water-Based Air Heating Coil

#### Overview

The input object Coil:Heating:Water provides a model that uses an NTU–effectiveness model of a static heat exchanger. The model is an inlet – outlet model: given the inlet conditions and flow rates and the UA, the effectiveness is calculated using the formula for the effectiveness of a cross-flow heat exchanger with both fluid streams unmixed. The effectiveness then allows the calculation of the outlet conditions from the inlet conditions.

The inputs to the model are: (1) the current inlet temperatures and flow rates of the air and water fluid streams and (2) the UA of the coil. Note that the UA is fixed in this model and is not a function of the flow rates.

There are 2 alternative user inputs for the component: the user may input the design water volumetric flow rate and the UA directly; or the user may choose to input the more familiar design heating capacity plus design inlet & outlet temperatures and let the program calculate the design UA. These alternative user inputs are fully described in the EnergyPlus Input Output Reference document.

#### Model Description

The air and water capacitance flows are defined as:

<div>$${\dot C_{air}} = {c_{p,air}}\cdot {\dot m_{air}}$$</div>

<div>$${\dot C_{water}} = {c_{p,water}}\cdot {\dot m_{water}}$$</div>

The minimum and maximum capacity flows are then:

<div>$${\dot C_{\min }} = \min ({\dot C_{air}},{\dot C_{water}})$$</div>

<div>$${\dot C_{\max }} = \max ({\dot C_{air}},{\dot C_{water}})$$</div>

The capacitance flow ratio is defined as:

<div>$$Z = {\dot C_{\min }}/{\dot C_{\max }}$$</div>

The number of transfer units (*NTU*) is:

<div>$$NTU = UA/{\dot C_{\min }}$$</div>

The effectiveness is:

<div>$$\varepsilon  = 1 - \exp (\frac{{{e^{ - NTU \cdot Z \cdot \eta }} - 1}}{{Z \cdot \eta }})$$</div>

Where <span>$\eta  = NT{U^{ - 0.22}}$</span>.

The outlet conditions are then:

<div>$${T_{air,out}} = {T_{air,in}} + \varepsilon \cdot {\dot C_{\min }}\cdot ({T_{water,in}} - {T_{air,in}})/{\dot C_{air}}$$</div>

<div>$${T_{water,out}} = {T_{water,in}} - {\dot C_{air}}\cdot ({T_{air,out}} - {T_{air,in}})/{\dot C_{water}}$$</div>

The output of the coil in watts is:

<div>$${\dot Q_{coil}} = {\dot C_{water}}\cdot ({T_{water,in}} - {T_{water,out}})$$</div>

The UA value is recalculated for each timestep.  A nominal UA, *UA<sub>0</sub>*, at the rating point is calculated by the program using the input for rated conditions and a search routine called regula falsi.

User input for the ratio of convective heat transfers at the nominal or rated operating point, “*r*,” is used in the model.  This ratio is defined as

<div>$$r = \frac{{{\eta_f}{{\left( {hA} \right)}_{air}}}}{{{{\left( {hA} \right)}_{water}}}}$$</div>

where,

      <span>${\eta_f}$</span> is the fin efficiency, (dimensionless)

      *h* is the surface convection heat transfer coefficient

*      A* is the surface area

The value calculated for *UA<sub>0</sub>* is used with the input for *r* to characterize the convective heat transfer on the water sides at the nominal rating operation point using

<div>$${\left( {{{\left( {hA} \right)}_w}} \right)_0} = U{A_0}\left( {\frac{{r + 1}}{r}} \right)$$</div>

and on the air side at the nominal rating point using

<div>$${\left( {{\eta_f}{{\left( {hA} \right)}_a}} \right)_0} = r{\left( {hA} \right)_{w,0}}$$</div>

Then the following equations are used to calculate a new UA as a function of the flow rates and inlet temperatures at each timestep.

<div>$${x_a} = 1 + 4.769\cdot {10^{ - 3}}\left( {{T_{air,in}} - {T_{air,in,0}}} \right)$$</div>

<div>$${\eta_f}{\left( {hA} \right)_a} = {x_a}{\left( {\frac{{{{\dot m}_a}}}{{{{\dot m}_{a,0}}}}} \right)^{0.8}}{\left( {{\eta_f}{{\left( {hA} \right)}_a}} \right)_0}$$</div>

<div>$${x_w} = 1 + \left( {\frac{{0.014}}{{1 + 0.014{T_{water,in,0}}}}} \right)\;\left( {{T_{water,in}} - {T_{water,in,0}}} \right)$$</div>

<div>$${\left( {hA} \right)_w} = {x_w}{\left( {\frac{{{{\dot m}_w}}}{{{{\dot m}_{w,0}}}}} \right)^{0.85}}{\left( {hA} \right)_{w,0}}$$</div>

<div>$$UA = {\left( {\frac{1}{{{{\left( {hA} \right)}_w}}} + \frac{1}{{{\eta_f}{{\left( {hA} \right)}_a}}}} \right)^{ - 1}}$$</div>

The above formulas are from the following reference, along with further references. The equation for x<sub>w</sub> was modified from that published in Wetter (1999) to correct a small error.

#### References

Wetter, M. 1999. Simulation Model: Finned Water-to-Air Coil Without Condensation. LBNL-42355. This document can be downloaded from .

### Single-Speed Electric DX Air Cooling Coil

#### Overview

This model (object names Coil:Cooling:DX:SingleSpeed and Coil:Cooling:DX:TwoStageWithHumidityControlMode, with CoilPerformance:DX:Cooling) simulates the performance of an air-cooled or evaporative-cooled direct expansion (DX) air conditioner. The model uses performance information at rated conditions along with curve fits for variations in total capacity, energy input ratio and part-load fraction to determine the performance of the unit at part-load conditions (Henderson et al. 1992, ASHRAE 1993). Sensible/latent capacity splits are determined by the rated sensible heat ratio (SHR) and the apparatus dewpoint (ADP)/bypass factor (BF) approach. This approach is analogous to the NTU-effectiveness calculations used for sensible-only heat exchanger calculations, extended to a cooling and dehumidifying coil.

This model simulates the thermal performance of the DX cooling coil and the power consumption of the outdoor condensing unit (compressor, fan, crankcase heater and evap condenser water pump). The total amount of heat rejected by the condenser is also calculated and stored for use by other waste heat recovery models (e.g., Coil:Heating:Desuperheater). The performance of the indoor supply air fan varies widely from system to system depending on control strategy (e.g., constant fan vs. AUTO fan, constant air volume vs. variable air volume, etc.), fan type, fan motor efficiency and pressure losses through the air distribution system. Therefore, this DX system model does not account for the thermal effects or electric power consumption of the indoor supply air fan. EnergyPlus contains separate models for simulating the performance of various indoor fan configurations, and these models can be easily linked with the DX system model described here to simulate the entire DX air conditioner being considered (e.g., see AirLoopHVAC:Unitary:Furnace:HeatCool, AirLoopHVAC:UnitaryHeatCool, ZoneHVAC:WindowAirConditioner or AirLoopHVAC:UnitaryHeatPump:AirToAir).

#### Model Description

The user must input the total cooling capacity, sensible heat ratio (SHR), coefficient of performance (COP) and the volumetric air flow rate across the cooling coil at rated conditions. The capacity, SHR and COP inputs should be “gross” values, excluding any thermal or energy impacts due to the indoor supply air fan. The rated conditions are considered to be air entering the cooling coil at 26.7°C drybulb/19.4°C wetbulb and air entering the outdoor condenser coil at 35°C drybulb/23.9°C wetbulb. The rated volumetric air flow should be between 0.00004027 m<sup>3</sup>/s and 0.00006041 m<sup>3</sup>/s per watt of rated total cooling capacity (300 – 450 cfm/ton). The rated volumetric air flow to total cooling capacity ratio for 100% dedicated outdoor air (DOAS) application DX cooling coils should be between 0.00001677 (m3/s)/W (125 cfm/ton) and 0.00003355 (m3/s)/W (250 cfm/ton).

The user must also input five performance curves or performance tables that describe the change in total cooling capacity and efficiency at part-load conditions:

1)    Total cooling capacity modifier curve or table (function of temperature)

2)    Total cooling capacity modifier curve or table (function of flow fraction)

3)    Energy input ratio (EIR) modifier curve or table (function of temperature)

4)    Energy input ratio (EIR) modifier curve or table (function of flow fraction)

5)    Part load fraction correlation curve or table (function of part load ratio)

* The total cooling capacity modifier curve (function of temperature) is a curve with two independent variables: wet-bulb temperature of the air entering the cooling coil, and dry-bulb temperature of the air entering the air-cooled condenser coil (wet-bulb temperature if modeling an evaporative-cooled condenser). The output of this curve is multiplied by the rated total cooling capacity to give the total cooling capacity at the specific entering air temperatures at which the DX coil unit is operating (i.e., at temperatures different from the rating point temperatures).  This curve is typically a biquadratic but any curve or table with two independent variables can be used.

Note: The data used to develop the total cooling capacity modifier curve (function of temperature) should represent performance when the cooling coil is ‘wet’ (i.e., coil providing sensible cooling and at least some dehumidification). Performance data when the cooling coil is ‘dry’ (i.e., not providing any dehumidification) should **not** be included when developing this modifier curve. This model automatically detects and adjusts for ‘dry coil’ conditions (see section “Dry Coil Conditions” below).

<div>$$ \text{TotCapTempModFac} = \text{Func}\left(T_{wb,i},T_c,i\right) $$</div>

where

<span>${T_{wb,i}}$</span> = x values = wet-bulb temperature of the air entering the cooling coil, °C

<span>${T_{c,i}}$</span> = y values = dry-bulb temperature of the air entering an air-cooled condenser or wet-bulb temperature of the air entering an evaporative-cooled condenser, °C

* The total cooling capacity modifier curve (function of flow fraction) is a curve with one independent variable being the ratio of the actual air flow rate across the cooling coil to the rated air flow rate (i.e., fraction of full load flow). The output of this curve is multiplied by the rated total cooling capacity and the total cooling capacity modifier curve (function of temperature) to give the total cooling capacity at the specific temperature and air flow conditions at which the DX unit is operating.  This curve is typically a quadratic but any curve or table with one independent variable can be used.

<div>$$\text{TotCapFlowModFac} = \text{Func}\left(ff\right)$$</div>

where

<div>$$ff = \text{flow fraction} = \left( \frac{\text{Actual air mass flow rate}}{\text{Rated air mass flow rate}} \right) = \text{x value}$$</div>

**Note:**  The actual volumetric air flow rate through the cooling coil for any simulation time step where the DX unit is operating must be between 0.00002684 m<sup>3</sup>/s and .00006713 m<sup>3</sup>/s per watt of rated total cooling capacity (200 - 500 cfm/ton). The simulation will issue a warning message if this air flow range is exceeded.

* The energy input ratio (EIR) modifier curve (function of temperature) is a curve with two independent variables: wet-bulb temperature of the air entering the cooling coil, and dry-bulb temperature of the air entering the air-cooled condenser coil (wet-bulb temperature if modeling an evaporative-cooled condenser). The output of this curve is multiplied by the rated EIR (inverse of the rated COP) to give the EIR at the specific entering air temperatures at which the DX coil unit is operating (i.e., at temperatures different from the rating point temperatures).  This curve is typically a biquadratic but any curve or table with two independent variables can be used.

Note: The data used to develop the energy input ratio (EIR) modifier curve (function of temperature) should represent performance when the cooling coil is ‘wet’ (i.e., coil providing sensible cooling and at least some dehumidification). Performance data when the cooling coil is ‘dry’ (i.e., not providing any dehumidification) should **not** be included when developing this modifier curve. This model automatically detects and adjusts for ‘dry coil’ conditions (see section “Dry Coil Conditions” below).

<div>$$\text{EIRTempModFac} = \text{Func}\left(T_{wb,i},T_c,i\right)$$</div>

where

<span>${T_{wb,i}}$</span> = x values = wet-bulb temperature of the air entering the cooling coil, °C

<span>${T_{c,i}}$</span> = y values = dry-bulb temperature of the air entering an air-cooled condenser or wet-bulb temperature of the air entering an evaporative-cooled condenser, °C

* The energy input ratio (EIR) modifier curve (function of flow fraction) is a curve with one independent variable being the ratio of the actual air flow rate across the cooling coil to the rated air flow rate (i.e., fraction of full load flow). The output of this curve is multiplied by the rated EIR (inverse of the rated COP) and the EIR modifier curve (function of temperature) to give the EIR at the specific temperature and air flow conditions at which the DX unit is operating.  This curve is typically a quadratic but any curve or table with one independent variable can be used.

<div>$$\text{EIRFlowModFrac} = \text{Func}\left(ff\right)$$</div>

where

<div>$$ff = \text{flow fraction} = \left( \frac{\text{Actual air mass flow rate}}{\text{Rated air mass flow rate}} \right) = \text{x value}$$</div>

* The part load fraction correlation (function of part load ratio) is a curve with one independent variable being part load ratio (sensible cooling load / steady-state sensible cooling capacity). The output of this curve is used in combination with the rated EIR and EIR modifier curves to give the “effective” EIR for a given simulation time step. The part load fraction (PLF) correlation accounts for efficiency losses due to compressor cycling.  This curve is typically a linear, quadratic, or cubic but any curve or table with one independent variable can be used.

<div>$$\text{PartLoadFrac} = \text{PLF} = \text{Func}\left(\text{PLR}\right)$$</div>

where

<div>$$\text{PLR} = \text{part load ratio} = \left(\frac{\text{actual sensible cooling load}}{\text{steady-state sensible cooling load}}\right) = \text{x values}$$</div>

The part-load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the compressor(s) run continuously for the simulation time step). For PLR values between 0 and 1 (0 &lt;= PLR &lt; 1), the following rules apply:

<div>$$ \begin{array}{rl} \text{PLF} &\geq 0.7 \\ \text{PLF} &\geq \text{PLR} \end{array}$$</div>

If PLF &lt; 0.7 a warning message is issued, the program resets the PLF value to 0.7, and the simulation proceeds. The runtime fraction of the coil is defined as PLR/PLF. If PLF &lt; PLR, then a warning message is issued and the runtime fraction of the coil is limited to 1.0.

A typical part load fraction correlation for a conventional, single-speed DX cooling coil (e.g., residential or small commercial unit) would be:

PLF = 0.85 + 0.15(PLR)

All five part-load curves are accessed through EnergyPlus’ built-in performance curve equation manager (curve: quadratic, curve:cubic and curve:biquadratic). It is not imperative that the user utilize all coefficients shown in equations (449) through (453) if their performance equation has fewer terms (e.g., if the user’s PartLoadFrac performance curve is linear instead of quadratic, simply enter the values for a and b, and set coefficient c equal to zero).

For any simulation time step, the total (gross) cooling capacity of the DX unit is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{total}} = {\mathop Q\limits^ \bullet_{total,rated}}\left( {TotCapTempModFac} \right)\left( {TotCapFlowModFac} \right)$$</div>

In a similar fashion, the electrical power consumed by the DX unit (compressors plus outdoor condenser fans) for any simulation time step is calculated using the following equation:

<div>$$Power = \left( {{{\mathop Q\limits^ \bullet  }_{total}}} \right)\left( {EIR} \right)\left( {RTF} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{total}}$</span>= Total cooling capacity, W -- ref. equation (455)

<div>$$EIR = \,Energy\,input\,ratio\, = \,\left( {\frac{1}{{CO{P_{rated}}}}} \right)\left( {EIRTempModFac} \right)\left( {EIRFlowModFac} \right)$$</div>

<span>$CO{P_{rated}}$</span> = Coefficient of performance at rated conditions (user input)

<div>$$RTF{\rm{ }} = {\rm{ }}\left( {{\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PartLoadFrac}}}\right.}\!\lower0.7ex\hbox{${PartLoadFrac}$}}} \right)\,\, = \,\,runtime fraction of the cooling coil$$</div>

The total amount of heat rejected by the condenser is then calculated and stored for use by other waste heat recovery models (e.g., Coil:Heating:Desuperheater).

<div>$${\mathop Q\limits^ \bullet_{cond}} = {\mathop Q\limits^ \bullet_{total}}\left( {1 + EIR} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{cond}}$</span> = total amount of heat rejected by the condenser (W)

The crankcase heater is assumed to operate when the cooling coil’s compressor is OFF and the outdoor dry-bulb temperature is below the maximum outdoor temperature for crankcase heater operation. The average crankcase heater power for the simulation time step is calculated as follows:

<div>$${P_{crankcase}} = {\mathop Q\limits^ \bullet_{cap,crankcase}}\left( {1 - RTF} \right)$$</div>

where

<span>${P_{crankcase}}$</span> = DX cooling coil crankcase heater power, W

<span>${\mathop Q\limits^ \bullet_{cap,crankcase}}$</span>= crankcase heater capacity, W

If this cooling coil is used as part of an air-to-air heat pump (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir), the crankcase heater defined for this DX cooling coil is disregarded and the associated output variable is omitted. Instead, the crankcase heater defined for the DX heating coil (Coil:Heating:DX:SingleSpeed) is enabled during the time that the compressor is not running for either heating or cooling. In this instance, RTF in the above equations would be the runtime fraction of the heat pump’s heating coil or cooling coil, whichever is greater.

In addition to calculating the total cooling capacity provided by the DX air conditioner, it is important to properly determine the break down of total cooling capacity into its sensible (temperature) and latent (dehumidification) components. The model computes the sensible/ latent split using the rated SHR and the ADP/BF approach (Carrier et al. 1959). When the DX coil model is initially called during an EnergyPlus simulation, the rated total capacity and rated SHR are used to calculate the coil bypass factor (BF) at rated conditions. The rated total capacity and rated SHR are first used to determine the ratio of change in air humidity ratio to air dry-bulb temperature:

<div>$$SlopeRated = \,\left( {\frac{{{\omega_{in}} - {\omega_{out}}}}{{{T_{db,in}}\, - {T_{db,out}}}}} \right)\mathop {}\limits_{rated} $$</div>

where

*ω<sub>in</sub>* = humidity ratio of the air entering the cooling coil at rated conditions, kg/kg

*ω<sub>out</sub>* = humidity ratio of the air leaving the cooling coil at rated conditions, kg/kg

*T<sub>db,in</sub>* = dry-bulb temperature of the air entering the cooling coil at rated conditions, °C

*T<sub>db,out</sub>* = dry-bulb temperature of the air leaving the cooling coil at rated conditions, °C

Along with the rated entering air conditions, the algorithm then searches along the saturation curve of the psychrometric chart until the slope of the line between the point on the saturation curve and the inlet air conditions matches *SlopeRated*. Once this point, the apparatus dewpoint, is found on the saturation curve the coil bypass factor at rated conditions is calculated as follows:

<div>$$B{F_{rated}} = \,\frac{{{h_{out,rated}}\,\, - \,{h_{ADP}}}}{{{h_{in,rated}}\,\, - \,{h_{ADP}}}}$$</div>

where

*h<sub>out,rated</sub>* <sub> </sub>= enthalpy of the air leaving the cooling coil at rated conditions, J/kg

*h<sub>in,rated</sub>* <sub> </sub>= enthalpy of the air entering the cooling coil at rated conditions, J/kg

*h<sub>ADP</sub>* <sub> </sub>= enthalpy of saturated air at the coil apparatus dewpoint, J/kg

The coil bypass factor is analogous to the “ineffectiveness” (1-ε) of a heat exchanger, and can be described in terms of the number of transfer of unit (NTU).

<div>$$BF = \,{e^{ - NTU}}\, = \,\,{e^{ - \,{{\left( {\frac{{UA}}{{cp}}} \right)} \mathord{\left/ {\vphantom {{\left( {\frac{{UA}}{{cp}}} \right)} {\dot m}}} \right. } {\dot m}}}}\, = \,{e^{ - \,\,{{Ao} \mathord{\left/ {\vphantom {{Ao} {\dot m}}} \right. } {\dot m}}}}$$</div>

For a given coil geometry, the bypass factor is only a function of air mass flow rate. The model calculates the parameter A<sub>o</sub> in equation (460) based on BF<sub>rated</sub> and the rated air mass flow rate. With A<sub>o</sub> known, the coil BF can be determined for non-rated air flow rates.

For each simulation time step when the DX air conditioner operates to meet a cooling load, the total cooling capacity at the actual operating conditions is calculated using equation (455) and the coil bypass factor is calculated based on equation (460). The coil bypass factor is used to calculate the operating sensible heat ratio (SHR) of the cooling coil using equations (461) and (462).

<div>$${h_{ADP}}\,\, = \,{h_{in}}\, - \,\frac{{({{\mathop Q\limits^ \bullet  }_{total}}\,/\dot m)}}{{1 - BF}}$$</div>

<div>$$SHR\,\, = \,Minimum\,\left( {\left( {\frac{{{h_{Tin,wADP}}\, - \,{h_{ADP}}}}{{{h_{in}} - {h_{ADP}}}}} \right),\,\,1} \right)$$</div>

where

<span>${h_{in}}$</span>          = enthalpy of the air entering the cooling coil, J/kg

<span>${h_{ADP}}$</span>       = enthalpy of air at the apparatus dewpoint condition, J/kg

<span>${h_{Tin,wADP}}$</span> = enthalpy of air at the entering coil dry-bulb temperature and humidity ratio at ADP, J/kg

<span>$\dot m$</span>            = air mass flow rate, kg/s

With the SHR for the coil at the current operating conditions, the properties of the air leaving the cooling coil are calculated using the following equations:

<div>$${h_{out}}\, = \,{h_{in}} - \,{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{total}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{total}}} {\dot m}}}\right.}\!\lower0.7ex\hbox{${\dot m}$}}$$</div>

<div>$${h_{Tin,\omega out}}\, = \,{h_{in}} - \,\left( {1 - SHR} \right)\left( {{h_{in}} - {h_{out}}} \right)$$</div>

<div>$${\omega_{out}}\, = \,PsyWFnTdbH({T_{in}},\,\,{h_{Tin,\omega out}})$$</div>

<div>$${T_{db,out}}\, = \,PsyTdbFnHW({h_{out}},\,\,\,{\omega_{out}})$$</div>

where

<span>${h_{out}}$</span>         = enthalpy of the air leaving the cooling coil, J/kg

<span>${h_{Tin,\,\omega out}}$</span>  = enthalpy of air at the entering coil dry-bulb temperature and leaving air humidity ratio, J/kg

<span>$\,{\omega_{out}}$</span>        = leaving air humidity ratio, kg/kg

<span>$\,{T_{db,out}}$</span>    = leaving air dry-bulb temperature, °C

*PsyWFnTdbH* = EnergyPlus psychrometric function, returns humidity ratio given dry-bulb temperature and enthalpy

*PsyTdbFnHW* = EnergyPlus psychrometric function, returns dry-bulb temperature given enthalpy and humidity ratio

#### Dry Coil Conditions

If the model determines that the cooling coil is dry (ω<sub>in</sub> &lt; ω<sub>ADP</sub>), then equations (455) and (456) are invalid since they are functions of entering wet-bulb temperature. Under dry-coil conditions, coil performance is a function of dry-bulb temperature rather than wet-bulb temperature. In this case, the model recalculates the performance of the DX cooling unit using the calculation procedure described above but with ω<sub>in\\ =</sub> ω<sub>dry,</sub> where ω<sub>dry</sub> is the inlet air humidity ratio at the coil dry-out point (SHR = 1.0).

#### SHR Calculation Using User Specified SHR Modifier Curves

This alternative SHR calculation method is based on user specified *SHR* modifying curves for temperature and flow fractions.  The modifying curves correct the rated *SHR* value for a given DX cooling coil entering air temperatures and air mass flow fraction.  These *SHR* modifying curves are optional additional curve inputs to the DX cooling coil objects.  These two curves are a biquadratic *SHR* modifier curve for temperature (*SHRFT*), and a quadratic *SHR* correction curve for flow fraction (*SHRFFF*).

·        Biquadratic *SHR* modifier normalized curve for DX cooling coil entering air (outdoor) wet-bulb and dry-bulb temperatures. The coil entering conditions can be outdoor air or pretreated outdoor air.

·        Quadratic SHR modifier curve for flow fraction.

The SHR is given by:

<div>$$SHR = SH{R_{rated}} \cdot SHRFT\left( {{T_{wb,i}},{T_{db,i}}} \right) \cdot SHRFFF\left( {FF} \right)$$</div>

The cooing coil outlet air enthalpy is given by:

<div>$${h_{out}} = {h_{in}} - \frac{{{{\dot Q}_{total}}}}{{\dot m}}$$</div>

The cooling coil outlet air enthalpy at the coil enlet air temperature and coil outlet humidity ratio is given by:

<div>$${h_{{T_{in}}{\omega_{out}}}} = {h_{in}} - \left( {1.0 - SHR} \right)\frac{{{{\dot Q}_{total}}}}{{\dot m}}$$</div>

The DX cooling coil outlet air humidity ratio is calculated from the psychometric function as follows:

<div>$${\omega_{out}} = PsyWFnTdbH\left( {{T_{db,\,i}},{h_{{T_{in}}{\omega_{out}}}}} \right)$$</div>

The DX cooling coils leaving humidity ratio cannot exceed the DX coil entering air humidity ratio. And for dry air condition entering the cooling coil, the above equation may yield unrealistic (in some cases negative values) coil outlet humidity ratio.  In this case the coil outlet air humidity is set a small value as follows:

<div>$${\omega_{out}} = MIN\left( {0.000010,{\omega_{in}}} \right)$$</div>

The DX cooling coil outlet air dry-bulb temperature is determined as follows:

<div>$${T_{db,out}} = PsyTdbFnHW\left( {{h_{out}},{\omega_{out}}} \right)$$</div>

where

<span>$SHRFT$</span>  = sensible heat ratio modifier normalized biquadratic curve as a function of coil entering air wet-bulb and dry-bulb temperatures, (-). The DX cooling coil entering air temperature can be the outdoor air condition or pretreated outdoor air when the DX cooling coil is placed after an exhaust heat recovery heat exchangers.

<span>$SHRFFF$</span>= sensible heat ratio modifier normalized quadratic curve as a function of air mass flow fraction.  Flow fraction is the ratio of actual to rated mass flow rate of air through the DX cooling coil, (-).

<span>$SH{R_{rated}}$</span>  = sensible heat ratio at rated condition, (-).

#### Condenser Options: AirCooled vs. EvaporativelyCooled

As described previously, this model can simulate the performance of air-cooled or evaporative-cooled DX air conditioners. The following paragraphs describe three modeling options.

If the user wants to model an air-cooled condenser, they should simply specify AirCooled in the field Condenser Type. In this case, the Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) (equations (449) and (451) above) will utilize the outdoor dry-bulb temperature.

If the user wishes to model an evaporatively-cooled condenser AND they have performance curves that are a function of the wet-bulb temperature of air entering the condenser coil, then the user should specify Condenser Type = EvaporativlyCooled and the evaporative condenser effectiveness value should be entered as 1.0. In this case, the Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) (equations (449) and (451) above) will utilize the outdoor wet-bulb temperature.

If the user wishes to model an air-cooled condenser that has evaporative media placed in front of it to cool the air entering the condenser coil, then the user should specify Condenser Type = EvaporativelyCooled. The user must also enter the appropriate evaporative effectiveness for the media. In this case, the Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) will utilize the condenser inlet air temperature as calculated below:

<div>$${T_{c,i}} = \,\left( {{T_{wb,o}}} \right)\,\, + \,\,\left( {1 - EvapCondEffectiveness} \right)\left( {{T_{db,o}}\,\, - {T_{wb,o}}} \right)$$</div>

where

*T<sub>c,i</sub>* = the temperature of the air entering the condenser coil, °C

*T<sub>wb,o</sub>* = the wet-bulb temperature of the outdoor air, °C

*T<sub>db,o</sub>* = the dry-bulb temperature of the outdoor air, °C

In this case, the Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) input fields for this object should reference performance curves that are a function of outdoor dry-bulb temperature. Be aware that the evaporative media will significantly reduce the dry-bulb temperature of the air entering the condenser coil, so the Total Cooling Capacity and EIR Modifier Curves must be valid for the expected range of dry-bulb temperatures that will be entering the condenser coil.

If an evaporatively-cooled condenser is modeled, the power requirements for the water pump are calculated as follows:

<div>$${P_{evapcondpump}} = {\mathop Q\limits^ \bullet_{cap,evapcondpump}}\left( {RTF} \right)$$</div>

where

<span>${P_{evapcondpump}}$</span> = DX cooling coil evap condenser pump electric power, W

<span>${\mathop Q\limits^ \bullet_{cap,evapcondpump}}$</span>= evaporative condenser pump rated power consumption, W

Water consumption for the evaporative-cooled condenser is calculated using the difference in air humidity level across the evaporative media and the condenser air mass flow rate:

<div>$${V_{water}} = \frac{{{{\mathop m\limits^ \bullet  }_{_{air}}}\left( {{\omega_{evapcond,out}} - {\omega_{evapcond,in}}} \right)}}{{{\rho_{water}}}}\left( {RTF} \right)\left( {TimeStepSys} \right)\left( {3600.} \right)\,$$</div>

where

<span>${V_{water}}$</span>         = DX cooling coil evap condenser water consumption, m<sup>3</sup>

<span>${\mathop m\limits^ \bullet_{_{air}}}$</span>          = evaporative condenser air mass flow rate, kg/s

 <span>${\omega_{evapcond,in}}$</span>  = humidity ratio of outdoor air entering the evap condenser, kg/kg

<span>${\omega_{evapcond,out}}$</span> = humidity ratio of air leaving the evap condenser, kg/kg

<span>${\rho_{water}}$</span>         = density of water at the outdoor dry-bulb temperature, kg/m<sup>3</sup>

*TimeStepSys* = HVAC system simulation time step, hr

#### Condenser Inlet Air Temperature

The air temperature entering the outdoor condenser is based on the weather data used during a simulation. This temperature is either taken directly from the weather data, or can be adjusted based on the height of the outdoor condenser. The input for Condenser Air Inlet Node Name can be used to control this optional feature. If this input is left blank, the air temperature entering the condenser is based solely on the weather data. If this input is not blank, then the node name specified must also be listed in an OutdoorAir:Node or OutdoorAir:NodeList object. When the node name is listed in an OutdoorAir:NodeList object, the air temperature entering the condenser is based solely on the weather data. When the node name is listed in an OutdoorAir:Node object, the height of the node determines the air temperature entering the outdoor condenser (see description of Local Outdoor Air Temperature Calculation in the Atmospheric Variation section of this document for further details).

#### Supply Air Fan Control: Cycling vs. Continuous

The DX cooling coil model simulates two specific supply air fan operation modes: cycling fan, cycling compressor or continuous fan, cycling compressor. The first operation mode is frequently referred to as “AUTO fan”, where the compressor(s) and supply air fan operate in unison to meet the zone cooling load, and cycle off together when the cooling load has been met. The second operation mode is often referred to as “fan ON”, where the compressor(s) cycle on and off to meet the zone cooling load but the supply air fan operates continuously regardless of compressor operation.

Since this DX heating coil can only be used in conjunction with a DX cooling coil (i.e. heat pumps), and these coils are used in AC equipment that specifies a fan operation mode schedule (e.g AirLoopHVAC:UnitaryHeatPump:AirToAir), the fan operation mode schedule value determines the fan operation mode for each time step throughout the simulation. A fan operation mode schedule value of 0 specifies AUTO fan mode operation while values other than 0 (a 1 is usually used) specify fan ON operation. The use of a schedule allows the fan operation mode to change based on time-of-day or with changes in season.

The EnergyPlus methodology for determining the impact that HVAC equipment has on an air stream is to calculate the mass flow rate and air properties (e.g., enthalpy, dry-bulb temperature, humidity ratio) exiting the equipment. These exiting conditions are passed along as inlet conditions to the next component model in the air stream. Eventually the flow rate and properties of the air being supplied to the conditioned zone are used in the zone energy balance to determine the resulting zone air temperature and humidity ratio. With this methodology, the determination of the air mass flow rate and air properties for the two different supply air fan operation modes is slightly different.

Cycling Fan Mode:

For the case of cycling fan/cycling compressor when humidity control is not specified, the conditions of the air leaving the cooling coil are the steady-state values calculated using equations (463), (465) and (466) above. However the air mass flow rate passed along to the next component (and eventually to the conditioned zone) is the average air mass flow rate for the system simulation time step (determined by the cooling system; see ZoneHVAC:WindowAirConditioner, AirLoopHVAC:Unitary:Furnace:HeatCool, AirLoopHVAC:UnitaryHeatCool, or AirLoopHVAC:UnitaryHeatPump:AirToAir).

For the case of cycling fan/cyling compressor when humidity control is specified, the conditions of the air leaving the cooling coil are calculated as the average conditions during the fan operating period. When the compressor operates in tandem with the fan (i.e., compressor part-load ratio [PLR] is equal to the fan PLR), the outlet conditions are identical to the calculations described above. When the compressor operates for a shorter duration than the fan (i.e., the compressor PLR is less than the heating/fan PLR), the air properties leaving the cooling coil are calculated as the average conditions during the fan operating period. In this case the calculation of exiting air conditions is analogous to the calculations for continuous fan mode described below except that PLR in the equations represents the ratio of the compressor to the fan operating period. For cycling fan systems, the fan will only operate longer than the compressor, and therefore latent degradation may be modeled (user input), when humidity control is specified, a moisture load exists (i.e., the zone air humidistat senses a moisture load), and a heating load exists where the heating PLR is greater than the cooling PLR.

Continuous Fan Mode:

For the case of continuous fan/cycling compressor, the air mass flow rate is constant. However, the air properties leaving the cooling coil are calculated as the average conditions during the system simulation time step. The model assumes that the exiting air conditions are the steady-state values calculated using equations (463), (465) and (466) above when the compressor(s) operate.  For the remainder of the system simulation time step, it is assumed that the air exiting the DX coil has the same properties as the air entering the coil. For this supply air fan operating strategy, the leaving air properties are calculated as follows:

<div>$${h_{out,ContFanCycComp}}\, = \,{h_{out}}\,\left( {PLR} \right) + \,{h_{in}}\,\,\left( {1 - PLR} \right)$$</div>

<div>$${\omega_{out,ContFanCycComp}}\, = \,{\omega_{out}}\,\left( {PLR} \right) + \,{\omega_{in}}\,\,\left( {1 - PLR} \right)$$</div>

<div>$${T_{db,out,ContFanCycComp}} = \,PsyTdbFnHW({h_{out,\,ContFanCycComp}}\,,\,\,\,\,\,{\omega_{out,ContFanCycComp}})$$</div>

#### Latent Capacity Degradation

The latent (dehumidification) capacity of a direct-expansion (DX) cooling coil is strongly affected by part-load, or cyclic, operation. This is especially true in applications where the supply air fan operates continuously while the cooling coil cycles on and off to meet the cooling load. During constant fan operation, moisture condenses on the cooling coil when the compressor operates, but part or all of the moisture that is held by the coil evaporates back into the airstream when the cooling coil is deactivated (Figure 168). The net effect is that the amount of moisture removed from the air is degraded at part-load conditions as compared to steady-state conditions when the compressor operates continuously (Figure 169).

EnergyPlus is able to model latent capacity degradation based on algorithms developed by Henderson and Rengarajan (1996). The model is applicable to single-stage cooling units, like residential and small commercial air conditioners or heat pumps with less than 19 kW of nominal cooling capacity. The model inputs are described in the EnergyPlus Input/Output Reference for the object Coil:Cooling:DX:SingleSpeed. The model is enabled only if the four numerical inputs are defined (values greater than zero, see IO Reference).

The following discussion applies to both cycling fan and continuous fan operation when the fan operates for a longer period of time than the compressor and air continues to flow over the moisture laden cooling coil after compressor operation has terminated.

![](EngineeringReference/media/image3484.png)

Figure 168.  Transient Sensible and Latent Capacity of a Cooling Coil Over an Operating Cycle



![](EngineeringReference/media/image3485.png)

Figure 169. Field Data Showing the Net Impact of Part-Load Operation on Sensible Heat Ratio



![](EngineeringReference/media/image3486.png)



Figure 170.  Concepts of Moisture Buildup and Evaporation

Figure 170 graphically depicts the latent degradation concepts and defines several key model parameters. After the cooling coil starts to operate, the coil temperature is eventually reduced below the dewpoint temperature of the entering air. Moisture from the air then builds on the surface of the coil until time t<sub>o</sub> has elapsed and the total moisture mass on the coil is M<sub>o</sub>. After this time (t<sub>o</sub>), moisture begins to fall from the coil and all of the latent capacity provided by the coil is “useful” since this condensate is collected and removed from the unit. When the coil cycles off and the supply air fan continues to operate, the initial moisture mass buildup on the coil (M<sub>o</sub>) evaporates back into the supply air stream. If the cooling coil cycles back on before all of the moisture has evaporated, then the time until the first condensate removal (t<sub>o</sub>) is shorter for this cooling cycle since the coil is already partially wetted.

Figure 170 also shows several parameters that are used in the latent degradation model. The ratio of the coil’s moisture holding capacity (M<sub>o</sub>) and the steady-state latent capacity (<span>${\mathop Q\limits^ \bullet_L}$</span>) is defined as *t<sub>wet</sub>* : the nominal time for moisture to fall from the coil (ignoring transient effects at startup and starting with a dry coil). The ratio of the initial moisture evaporation rate (<span>${\mathop Q\limits^ \bullet_e}$</span>) and the steady-state latent capacity (<span>${\mathop Q\limits^ \bullet_L}$</span>) is defined as <span>$\gamma $</span>. Both *t<sub>wet</sub>*and <span>$\gamma $</span> at the rated air volume flow rate and temperature conditions are required model inputs. Two other model inputs are the Maximum ON/OFF Cycling Rate (cycles per hour, *N<sub>max</sub>*) and the time constant (<span>$\tau $</span>, in seconds) for the cooling coil’s latent capacity to reach steady state after startup. The development of the latent degradation model is fully described by Henderson and Rengarajan (1996). The model implemented in EnergyPlus is for their “linear decay” evaporation model.

During the simulation, all of the steady-state calculations described previously in equations (449) through (462) are completed. The latent degradation model then modifies the steady-state sensible heat ratio for the coil as shown below. The value of *t<sub>wet</sub>* at the current air volume flow rate and entering air conditions is first calculated based on the rated value of *t<sub>wet</sub>* entered by the user:

<div>$${t_{wet}} = Minimum\left( {{t_{wet,rated}}\left( {\frac{{{{\mathop Q\limits^ \bullet  }_{latent,rated}}}}{{{{\mathop Q\limits^ \bullet  }_{latent}}}}} \right),\,\,{t_{wet,\max }}} \right)$$</div>

where

*t<sub>wet</sub>*  = nominal time for condensate removal to begin at the current airflow and entering air conditions, starting with a dry coil (sec)

*t<sub>wet,rated</sub>* = nominal time for condensate removal to begin at the coil’s rated airflow and entering air conditions, starting with a dry coil (sec)

<span>${\mathop Q\limits^ \bullet_{latent,rated}}$</span>= cooling coil latent capacity at the rated airflow and temperature conditions, W

<span>${\mathop Q\limits^ \bullet_{latent}}$</span>= cooling coil latent capacity at the current airflow and temperature conditions, W

*t<sub>wet,max</sub>* = maximum allowed value for *t<sub>wet</sub>* (9999.0 sec)



Likewise, the value of <span>$\gamma $</span>at the current air volume flow rate and entering air conditions is calculated based on the rated value of <span>$\gamma $</span>entered by the user:

<div>$$\gamma  = {\gamma_{rated}}\left( {\frac{{{{\mathop Q\limits^ \bullet  }_{latent,rated}}}}{{{{\mathop Q\limits^ \bullet  }_{latent}}}}} \right)\left( {\frac{{{T_{db,i}} - {T_{wb,i}}}}{{{T_{db,rated}} - {T_{wb,rated}}}}} \right)$$</div>

where:

<span>$\gamma $</span>         = ratio of the initial moisture evaporation rate from the cooling coil (when the compressor first turns off, in Watts) and the coil’s steady-state latent capacity (Watts) at the current air volume flow rate and entering air conditions

<span>${\gamma_{rated}}$</span>   = <span>$\gamma $</span> at rated air flow and entering air conditions

*T<sub>db,i</sub>*            = dry-bulb temperature of the air entering the cooling coil, °C

*T<sub>wb,i</sub>*           = wet-bulb temperature of the air entering the cooling coil, °C

*T<sub>db,rated</sub>* = dry-bulb temperature of air entering the cooling coil at rated conditions (26.7°C)

*T<sub>wb,rated </sub>*= wet-bulb temperature of air entering the cooing coil at rated conditions (19.4°C)

The cooling coil on and off times are then calculated based on the maximum number of cycles per hour and the calculated run-time fraction for the coil.

<div>$${t_{on}} = \frac{{3600}}{{4{N_{\max }}\left( {1 - X} \right)}}$$</div>

<div>$${t_{off}} = \frac{{3600}}{{4{N_{max}}X}}$$</div>

where

*t<sub>on</sub>*               = duration of cooling coil on-cycle (sec)

*N<sub>max</sub>*            = maximum on/off cycles per hour (cph)

*X*                = cooling coil runtime fraction (-)

*t<sub>off</sub>*              = duration of cooling coil off-cycle (sec)



For cycling fan systems, the duration of the heating coil on and off cycles are also calculated. When the heating coil operates for a longer duration of time than the cooling coil, latent degradation can also occur. For this case, the off-cycle time (i.e., the amount of time the fan operates longer than the cooling coil) is recalculated and based on the difference between the heating coil on-cycle time and the cooling coil on-cycle time. Ton and Toff for the heating coil are calculated in the same manner as shown above except that the heating run-time fraction is used for the calculations. This model assumes that the cycling rate of the cooling and heating coils are the same. In addition, since the heating coil cycling rate may be different than the cooling coil (based on run-time fractions), the heating coil may also turn on again before the next cooling coil on-cycle. The following equations are used when the heating coil operates for a longer time period than does the cooling coil.

<div>$$ton,heating = \frac{{3600}}{{4Nmax\left( {1 - Xheating} \right)}}$$</div>

<div>$$toff,heating = \frac{{3600}}{{4Nmax\left( {Xheating} \right)}}$$</div>

<div>$$ton,heating = ton,heating + MAX\left( {0,MIN\left( {ton,heating,\left( {\left( {ton + toff} \right) - \left( {ton,heating + toff,heating} \right)} \right)} \right)} \right)$$</div>

<div>$$toff = MIN\left( {toff,ton,heating - ton} \right)$$</div>

where

*t<sub>on,heating</sub>*      = duration of heating coil on-cycle (sec)

*X<sub>,heating</sub>*        = heating coil runtime fraction (-)

*t<sub>off,heating</sub>*      = duration of heating coil off-cycle (sec)



The equation for calculating the time *t<sub>o</sub>* when moisture first begins to fall from the cooling coil is shown below, and is solved iteratively by EnergyPlus:

<div>$$\mathop t\nolimits_o^{j + 1}  = \gamma {t_{off}} - \left( {\frac{{\mathop \gamma \nolimits^2 }}{{4{t_{wet}}}}} \right)\mathop t\nolimits_{off}^2  - \tau \left( {\mathop e\nolimits^{\frac{{\mathop t\nolimits_o^j }}{\tau }} \,\, - \,\,1} \right)\,\,,\,\,\,\mathop t\nolimits_{off}^{}  \le \,\left( {\frac{{2{t_{wet}}}}{\gamma }} \right)$$</div>

where

<span>${t_o}$</span>  = time where condensate removal begins (sec)

<span>$\tau $</span>   = latent capacity time constant at start-up (sec)

*j*     = iteration number

The part-load latent heat ratio of the cooling coil is then calculated with <span>$t_o^{}$</span>, *t<sub>on</sub>* and <span>$\tau $</span>, which is in turn used to calculate the “effective” sensible heat ratio of the cooling including part-load latent degradation effects.

<div>$$\frac{{LHR}}{{LH{R_{ss}}}} = Maximum\left( {\left( {\frac{{{t_{on}} - {t_o}}}{{{t_{on}} + \tau \left( {{e^{\left( {\frac{{ - {t_{on}}}}{\tau }} \right)}}\,\, - \,\,1} \right)}}} \right),0.0} \right)$$</div>

<div>$$SH{R_{eff}} = 1 - \left( {1 - SH{R_{ss}}} \right)\left( {\frac{{LHR}}{{LH{R_{ss}}}}} \right)$$</div>

where

<span>$LHR$</span> = part-load latent heat ratio

<span>$LH{R_{ss}}$</span> = latent heat ratio at steady-state conditions (<span>$1 - SH{R_{ss}}$</span> with <span>$SH{R_{ss}}$</span> from eqn. (462))

<span>$SH{R_{eff}}$</span> = part-load sensible heat ratio**(<span>$SH{R_{ss}}$</span>* ≤<span>$SH{R_{eff}}$</span> ≤* 1.0)

<span>$SH{R_{ss}}$</span> = steady-state sensible heat ratio (from eqn. (462))

With the “effective” SHR for the coil at the current operating conditions, including the impacts of latent degradation, equations (463) through (466) are then used to calculate the properties of the air leaving the cooling coil when it operates. Finally, equations (467) through (469) are used to calculate the average leaving air conditions (average when the coil is on and off) for the simulation time step.

#### Basin Heater For Single-Speed DX Coil

Calculations are also made to estimate the electric power input to the DX coil basin heater. A schedule may be used to disable the basin heater during regular maintenance periods or other time periods (e.g., during summer). If a schedule is not provided, the basin heater is assumed to be available the entire simulation time period. The basin heater operates when it is scheduled on, the outdoor air dry-bulb temperature is below the basin heater setpoint temperature, and the DX coil is not active. The user is required to enter a basin heater capacity (watts per degree Kelvin) and a heater setpoint temperature (<sup>o</sup>C) if they want to model basin heater electric power.

<div>$$
  \mathop P\nolimits_{basinheater}  = MAX(0.0,{\rm{ }}\mathop {CAP}\nolimits_{basinheater} (\mathop T\nolimits_{setpoint,basin}  - \mathop T\nolimits_{db,outdoor} )(1 - RTF)) \\ 
$$</div>

<div>$$
  \mathop E\nolimits_{basinheater}  = \mathop {(P}\nolimits_{basinheater} )(TimeStepSys)3600
$$</div>

where:

<span>$\mathop P\nolimits_{basinheater} $</span>             = DX coil basin heater electric power (W)

<span>$\mathop E\nolimits_{basinheater} $</span>            = DX coil basin heater electric consumption (J)

<span>$\mathop T\nolimits_{setpoint,basin} $</span>           = Basin heater setpoint temperature (<sup>o</sup>C)

<span>$\mathop T\nolimits_{db,outdoor} $</span>              = Outdoor air dry-bulb temperature (<sup>o</sup>C)

<span>$\mathop {CAP}\nolimits_{basinheater} $</span>         = Basin heater capacity (W/K)

<span>$RTF$</span>                        = Run time fraction of DX cooling coil

#### Special Calculations for Coil:Cooling:DX:TwoStageWithHumidityControlMode with CoilPerformance:DX:Cooling

The multimode DX coil uses 1 to 4 set of performance specifications which all feed into the main DX coil model as described above. The multimode DX coil may have 1 or 2 capacity stages and may have 1 enhanced dehumidification mode in addition to its "normal" or base mode performance. Any mode may specify that a portion of the total airflow is bypassed.

##### Bypass Operation

When a mode has coil bypass, the non-bypassed air flow fraction is used to model the DX coil performance as described above. Then the bypassed air stream is mixed with the conditioned air stream and these conditions are place on the coil outlet node.

##### Multi-Stage Operation

Multi-stage control is modeled with the DX coil. If 2-stage operation has been specified, stage 1 is assumed to operate first and continue to operate if stage 2 is required. If latent degradation is active, only one of the stages will be degraded. If stage 1 operates for less than the full time step, then latent degradation is applied. If stage 2 operates, then stage 1 is running for the full time step and latent degradation is applied only to the portion of the latent load which is attributed to stage 2 operation.

##### Enhanced Dehumidification Mode

If enhanced dehumidification mode is available, this is controlled by the parent object of the DX coil, such as DXSystem:AirLoop. A dehumidification mode flag is passed to the coil model which is used to select a different set of performance specifications from a CoilPerformance:DX:Cooling input object. Then the simulation of the DX coil proceeds as described above including any bypass or multi-stage operation.

#### Standard Rating of Single-Speed DX Cooling Coils

For small single-speed direct expansion (DX) cooling coils, the industry standard ratings of Standard Rating Cooling Capacity and Seasonal Energy Efficiency Ratio (SEER) are calculated according to ANSI/AHRI Standard 210/240 (AHRI 2008). These ratings apply to unitary air conditioners and air-source unitary heat pumps with air-cooled condensers with standard rating cooling capacities under 19 kW (&lt;65,000 Btu/hr). For larger DX cooling coils, the industry standard ratings of Standard Rating Cooling Capacity, Energy Efficiency Ratio (EER), and Integrated Energy Efficiency Ratio (IEER) are calculated according to ANSI/AHRI Standard 340/360 (AHRI 2007). These ratings apply to unitary air conditioners and air-source unitary heat pumps with standard rating cooling capacities from 19 kW to below 73.2 kW (65,000 Btu/hr to &lt;250,000 Btu/hr).

For the Coil:Cooling:DX:SingleSpeed object in EnergyPlus, these standard ratings are not direct inputs to the model. However, these standard ratings can be calculated using user-entered information for the Coil:Cooling:DX:SingleSpeed object. Since users sometimes lump the performance of several smaller DX cooling units into a single larger cooling coil object for simulation purposes, EnergyPlus outputs the Standard Rating Cooling Capacity, SEER, EER, and IEER regardless of the magnitude of the standard rating cooling capacity of the coil. It is up to the user to determine which standard ratings are applicable to the cooling coil(s) they are modeling. These standard rating values are provided in the eplusout.eio output file (Ref. OutputDetailsAndExamples.pdf) and also in the predefined tabular output reports (Output:Table:SummaryReports object, Equipment Summary). Currently, the standard ratings are only calculated and output for single-speed DX cooling coils with air-cooled condensers. If the single-speed DX coling coil is specified with an evaporatively-cooled condenser, then no standard ratings are output from EnergyPlus at this time.

Note: The standard ratings described in this section require that the DX cooling coil model be evaluated at specific operating conditions (i.e., specific wet-bulb temperatures for air entering the cooling coil and dry-bulb temperatures for air entering the air-cooled [outdoor] condenser). If the cooling coil performance curves can not be evaluated at the required test conditions, then a standard rating value calculated at the curves limit will be output and a warning message will written to eplusout.err. For example, if the curve object (Curve:Biquadratic) for Total Cooling Capacity Function of Temperature Curve has a minimum value of 21C for dry-bulb temperature entering the air-cooled condenser coil, the IEER calculation requires that EER<sub>D</sub> be calculated at 18.3C – so, this would result in IEER calculatd at user specified curve limit as an output and a warning message in the eplusout.err file.

The standard rating cooling capacity (AHRI 2007, AHRI 2008) is calculated as follows:

<div>$$\begin{array}{l}{{\dot Q}_{StandardRating}} = \,\,{{\dot Q}_{Total,Rated}}\left( {TotCapTempModFa{c_{Rated}}} \right)\left( {TotCapFlowModFa{c_{Rated}}} \right)\,\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, - \,\left( {FanPowerPerVolFlowRate \cdot {{\dot V}_{Rated}}} \right)\end{array}$$</div>

where,

<span>${\dot Q_{StandardRating}}$</span> = Standard Rating (Net) Cooling Capacity (W)

<span>${\dot Q_{Total,Rated}}$</span> = Rated Total (Gross) Cooling Capacity, user input (W)

<span>$TotCapTempModFa{c_{Rated}}$</span>= Total Cooling Capacity Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

<span>$TotCapFlowModFa{c_{Rated}}$</span>= Total Cooling Capacity Function of Flow Fraction Curve evaluated at a flow fraction of 1.0 (dimensionless)

<span>$FanPowerPerVolFlowRate$</span>= Rated Evaporator Fan Power Per Volume Flow Rate, user input ( W/(m<sup>3</sup>/s) )

<span>${\dot V_{Rated}}$</span>= Rated Air Volume Flow Rate, user input (m<sup>3</sup>/s)

The Rated Evaporator Fan Power Per Volume Flow rate is a user-entered value, with a default of 773.3 W/(m<sup>3</sup>/s)) if the user leaves this input field blank. The default value is taken from ANSI/AHRI Standards 210/240 and 340/360 where it is defined for systems which do not have a cooling coil fan furnished as part of the system (e.g., a DX cooling coil mounted in the ductwork downstream of a gas furnace where the furnace contains the fan used for air distribution across the gas heating coil and the downstream DX cooling coil). The test conditions in ANSI/AHRI Standards 210/240 and 340/360 vary the external static pressure (i.e., pressure drop associated with ductwork and other devices external to the indoor fan/coil section) seen by the supply air fan based on the standard rating cooling capacity. Note, however, that external static pressure in actual installations is typically much higher. Further details regarding indoor fan power per volume flow rate can be found in Walker and Lutz (2005) and Walker (2007), including differences between Permanent Split Capacitor (PSC) and Brushless Permanent Magnet (BPM) fan motors. Especially at the low external static pressures defined in the ANSI/AHRI Standards, BPM motors (e.g., Electronically Commutated Motors (ECMs)) can draw significantly less power (e.g., 50-75% less) than PSC motors.

The seasonal energy efficiency ratio (SEER) is calculated as follows:

<div>$$SEER = PL{F_{0.5}} \cdot EE{R_{TestB}}$$</div>

<div>$$EE{R_{TestB}} = \frac{{{{\dot Q}_{Total,Net,TestB}}}}{{Powe{r_{Total,TestB}}}}$$</div>

<div>$$\begin{array}{l}{{\dot Q}_{Total,Net,TestB}} = {{\dot Q}_{Total,Rated}}(TotCapTempModFa{c_{TestB}})(TotCapFlowModFa{c_{Rated}})\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, - \,\,\left( {FanPowerPerVolFlowRate \cdot {{\dot V}_{Rated}}} \right)\end{array}$$</div>

<span>$\begin{array}{l}Powe{r_{Total,TestB}} = \left( {{{\dot Q}_{Total,Rated}}(TotCapTempModFa{c_{TestB}})(TotCapFlowModFa{c_{Rated}})} \right)\, \cdot EI{R_{TestB}}\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + \,\,\left( {FanPowerPerVolFlowRate \cdot {{\dot V}_{Rated}}} \right)\end{array}$</span><span>$EI{R_{TestB}} = \left( {\frac{1}{{CO{P_{rated}}}}} \right)(EIRTempModFa{c_{TestB}})(EIRFlowModFa{c_{Rated}})$</span>

where,

*PLF<sub>0.5</sub>*  =    Part Load Fraction Correlation Curve evaluated at a part load ratio (PLR) of 0.5 (dimensionless)

*EER<sub>TestB</sub>*<sub></sub> = Energy efficiency ratio with 19.44°C wet-bulb temperature air entering the cooling coil, 27.78°C dry-bulb temperature air entering the air-cooled (outdoor) condenser, and rated air volume flow through the cooling coil (W/W)

<span>${\dot Q_{Total,Net,TestB}}$</span>= Net total cooling capacity with 19.44°C wet-bulb temperature air entering the cooling coil, 27.78°C dry-bulb temperature air entering the air-cooled (outdoor) condenser, and rated air volume flow through the cooling coil (W)

<span>$TotCapTempModFa{c_{TestB}}$</span> = Total Cooling Capacity Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 27.78°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

<span>$Powe{r_{Total,TestB}}$</span> = Total electric power (compressors, condenser fans and evaporator fan) with 19.44°C wet-bulb temperature air entering the cooling coil, 27.78°C dry-bulb temperature air entering the air-cooled (outdoor) condenser, and rated air volume flow through the cooling coil (W)

<span>$CO{P_{rated}}$</span> = Coefficient of Performance at Rated Conditions, user input (W/W)

<span>$EIRTempModFa{c_{TestB}}$</span> = Energy Input Ratio Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 27.78°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

<span>$EIRFlowModFa{c_{Rated}}$</span>= Energy Input Ratio Function of Flow Fraction Curve evaluated at a flow fraction of 1.0 (dimensionless).

Energy Efficiency Ratio (EER) is another standard rating (AHRI 2007), and it is defined as the ratio of the total cooling capacity to the total power input at any given set of rating conditions, expressed in W/W (or Btu/W-h). For this class of air-cooled DX cooling coils, EER is calculated at rated test conditions as follows:

<div>$$EE{R_{}} = \frac{{{{\dot Q}_{Standard\,Rating}}}}{{Powe{r_{Total,Rated}}}}$$</div>

<div>$$\begin{array}{l}Powe{r_{Total,Rated}} = \left( {{{\dot Q}_{Total,Rated}}(TotCapTempModFa{c_{Rated}})(TotCapFlowModFa{c_{Rated}})} \right)\, \cdot EI{R_{Rated}}\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + \,\,\left( {FanPowerPerVolFlowRate \cdot {{\dot V}_{Rated}}} \right)\end{array}$$</div>

<div>$$EI{R_{Rated}} = \left( {\frac{1}{{CO{P_{Rated}}}}} \right)(EIRTempModFa{c_{Rated}})(EIRFlowModFa{c_{Rated}})$$</div>

where,

*EER*  = Energy Efficiency Ratio (W/W)

<span>$Powe{r_{Total,Rated}}$</span>= Total electric power (compressors, condenser fans and evaporator fan) with 19.44°C wet-bulb temperature air entering the cooling coil, 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser, and air flow rate across the evaporator at the Rated Air Volume Flow Rate (W).

<span>$TotCapTempModFa{c_{Rated}}$</span> = Total Cooling Capacity Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

<span>$EIRTempModFa{c_{Rated}}$</span> = Energy Input Ratio Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

The Integrated Energy Efficiency Ratio (IEER) is intended to be a measure of merit for the cooling coil’s part-load efficiency. IEER replaced Integrated Part-Load Value (IPLV) as the part-load performance metric in Std. 340/360 as of January 1, 2010. Full details regarding the IEER calculation are available in ANSI/AHRI Std. 340/360 (AHRI 2007). A summary of the IEER calculations made by EnergyPlus for single-speed air-cooled DX cooling coils is provided below:

<div>$$IEER = \,(0.02 \cdot EE{R_A}) + (0.617 \cdot EE{R_B}) + (0.238 \cdot EE{R_C}) + (0.125 \cdot EE{R_D})$$</div>

where,

<span>$EE{R_A}$</span> =     *EER* at 100% net capacity at AHRI standard rating conditions (same as EER calculation shown above)

<span>$EE{R_B}$</span> =     *EER* at 75% net capacity and reduced outdoor air temperature

<span>$EE{R_C}$</span> =     *EER* at 50% net capacity and reduced outdoor air temperature

<span>$EE{R_D}$</span>=      *EER* at 25% net capacity and reduced outdoor air temperature

<div>$$EE{R_{B - D}} = \frac{{LF \cdot {{\dot Q}_{Total,Net,PartLoad}}}}{{Powe{r_{Total,{\kern 1pt} PartLoad}}}}$$</div>

<div>$$Powe{r_{Total,{\kern 1pt} PartLoad}} = LF\left( {{C_D} \cdot Powe{r_{CompCondFan,{\kern 1pt} PartLoad}}} \right) + \,\left( {FanPowerPerVolFlowRate \cdot {{\dot V}_{Rated}}} \right)$$</div>

<div>$$\begin{array}{l}Powe{r_{CompCondFan,{\kern 1pt} PartLoad}} = \left( {{{\dot Q}_{Total,Rated}}(TotCapTempModFa{c_{PartLoad}})(TotCapFlowModFa{c_{Rated}})} \right)\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, \cdot EI{R_{PartLoad}}\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\end{array}$$</div>

<div>$$EI{R_{PartLoad}} = \left( {\frac{1}{{CO{P_{Rated}}}}} \right)(EIRTempModFa{c_{PartLoad}})(EIRFlowModFa{c_{Rated}})$$</div>

where,

<span>${\dot Q_{Total,Net,PartLoad}}$</span> =     Net total cooling capacity with 19.44°C wet-bulb temperature air entering the cooling coil rated air volume flow through the cooling coil (W). The dry-bulb temperature of air entering the air-cooled condenser varies (B = 27.5°C, C = 20.0°C, D = 18.3°C).

<span>$Powe{r_{Total,PartLoad}}$</span> = Total electric power (compressors, condenser fans and evaporator fan) with 19.44°C wet-bulb temperature air entering the cooling coil and air flow rate across the evaporator at the Rated Air Volume Flow Rate (W). The dry-bulb temperature of air entering the air-cooled condenser varies (B = 27.5°C, C = 20.0°C, D = 18.3°C).<span>$Powe{r_{CompCondFan,{\kern 1pt} PartLoad}}$</span> = Electric power of the compressor and condenser fan at the various part-load ratios, with 19.44°C wet-bulb temperature air entering the cooling coil and rated supply air volume flow rate (W). The dry-bulb temperature of air entering the air-cooled condenser varies per the part-load ratio (B = 27.5°C, C = 20.0°C, D = 18.3°C).

<span>$EIRTempModFa{c_{PartLoad}}$</span> = Energy Input Ratio Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and dry-bulb temperature of air entering the air-cooled condenser corresponding to the reduced part-load ratio (B = 27.5°C, C = 20.0°C, D = 18.3°C) (dimensionless).

<span>${C_D}$</span>= degradation coefficient to account for cycling of the compressor = 1.13 – 0.13*LF*.

<span>$LF$</span> = fractional “on” time at the desired load point

The load factor (*LF*) is the fractional “on” time for the desired reduced load points (75%, 50%, or 25%) calculated from the following equation:

<div>$$LF = \frac{{\left( {{\raise0.7ex\hbox{${\% Load}$} \!\mathord{\left/ {\vphantom {{\% Load} {100}}}\right.}\!\lower0.7ex\hbox{${100}$}}} \right) \cdot {{\dot Q}_{StandardRating}}}}{{{{\dot Q}_{Total,Net,PartLoad}}}}$$</div>

where,

*<span>$\% Load$</span>* = Part-load operating points, i.e., 75% (B), 50% (C), 25% (D)

The calculations for *Q<sub>Total,Net,PartLoad</sub>* and *Power<sub>Total,PartLoad</sub>* are calculated in nearly the same way as *Q<sub>Total,Net,TestB</sub>* and *Power<sub>Total,TestB</sub>* are calculated for SEER (defined above). The only difference is that these cooling capacity and power values, used for calculating EER<sub>B</sub>/EER<sub>C</sub>/EER<sub>D</sub> for IEER, are calculated for a series of dry-bulb temperatures of air entering the air-cooled condenser (B = 27.5°C, C = 20.0°C, D = 18.3°C) and part-load performance degradiation correction is also applied to the condensing unit electric power calculation.

#### ANSI/ASHRAE 127 - Standard Ratings of Single-Speed DX Cooling Coils

For computer and data processing room unitary air conditioners single-speed direct expansion (DX) cooling coils, the standard ratings net total cooling capacity and total cooling electric power inputs are calculated according to ANSI/AHRI Standard 127 (ASHRAE 2012). These ratings apply to unitary air conditioners with air-cooled. If the single-speed DX cooling coil is specified with an evaporatively-cooled condenser, then no standard ratings are output from EnergyPlus at this time. These standard ratings are not direct inputs to the model. However, these standard ratings can be calculated using user-entered information for the Coil:Cooling:DX:SingleSpeed object.  These standard rating values are provided in the eplusout.eio output file and also in the predefined tabular output reports (Output:Table:SummaryReports object, Equipment Summary). 

**Note**: The standard ratings described in this section require that the DX cooling coil model be evaluated at sixteen different test conditions (i.e., specific wet-bulb temperatures for air entering the cooling coil and dry-bulb temperatures for air entering the air-cooled [outdoor] condenser) for each of the four standard tests and four application classes (ASHRAE – 2012).  The four test conditions: A, B, C and D are provided in the ANSI/ASHRAE Standard 127. And the test conditions are different for each application classes described in the standard.  In total sixteen performance data of net cooling capacity and total electric power inputs are reported.  The total cooling electric power includes the supply fan power.

<table class="table table-striped">
  <tr>
    <th colspan="6">Rated Cooling Tests</th>
  </tr>
  <tr>
    <th></th>
    <th>Application Class</th>
    <th>A</th>
    <th>B</th>
    <th>C</th>
    <th>D</th>
  </tr>
  <tr>
    <td rowspan="4">Tdb, Indoor</td>
    <td>Class 1</td>
    <td>23.9&deg;C(75.0&deg;F)</td>
    <td>23.9&deg;C(75.0&deg;F)</td>
    <td>23.9&deg;C(75.0&deg;F)</td>
    <td>23.9&deg;C(75.0&deg;F)</td>
  </tr>
  <tr>
    <td>Class 2</td>
    <td>29.4&deg;C(85.0&deg;F)</td>
    <td>29.4&deg;C(85.0&deg;F)</td>
    <td>29.4&deg;C(85.0&deg;F)</td>
    <td>29.4&deg;C(85.0&deg;F)</td>
  </tr>
  <tr>
    <td>Class 3</td>
    <td>35.0&deg;C(95.0&deg;F)</td>
    <td>35.0&deg;C(95.0&deg;F)</td>
    <td>35.0&deg;C(95.0&deg;F)</td>
    <td>35.0&deg;C(95.0&deg;F)</td>
  </tr>
  <tr>
    <td>Class 4</td>
    <td>40.5&deg;C(105&deg;F)</td>
    <td>40.5&deg;C(105&deg;F)</td>
    <td>40.5&deg;C(105&deg;F)</td>
    <td>40.5&deg;C(105&deg;F)</td>
  </tr>
  <tr>
    <td colspan="2">Tdp, Indoor</td>
    <td>35.0&deg;C(95.0&deg;F)</td>
    <td>26.7&deg;C(80.0&deg;F)</td>
    <td>18.3&deg;C(65.0&deg;F)</td>
    <td>4.4&deg;C(40.0&deg;F)</td>
  </tr>
  <tr>
    <td colspan="2">Tdb, Outdoor</td>
    <td>35.0&deg;C(95.0&deg;F)</td>
    <td>26.7&deg;C(80.0&deg;F)</td>
    <td>18.3&deg;C(65.0&deg;F)</td>
    <td>4.4&deg;C(40.0&deg;F)</td>
  </tr>
</table>

The standard rating net total cooling capacity is calculated as follows:

<div>$$ \dot{Q}_{StandardRating} = \dot{Q}_{TotalRated}\left(\text{TotCapTempModFac}_{Rated}\right)\left(\text{TotCapFlowModFac}_{Rated}\right)-\left(\text{FanPowerPerVolFlowRate} \cdot \dot{V}_{Rated}\right) $$</div>

where:

* <span>$ \dot{Q}_{StandardRating} $</span> = Standard Rating (Net) Cooling Capacity (W)

* <span>$ \dot{Q}_{Total,Rated} $</span> = Rated Total (Gross) Cooling Capacity, user input (W)

* <span>$ \text{TotCapTempModFac}_{Rated} $</span> = Total Cooling Capacity Function of Temperature Curve evaluated at wet-bulb temperature of air entering the cooling coil and dry-bulb temperature of air entering the air-cooled (outdoor) condenser (dimensionless)

* <span>$ \text{TotCapFlowModFac}_{Rated} $</span> = Total Cooling Capacity Function of Flow Fraction Curve evaluated at a flow fraction of 1.0 (dimensionless)

* <span>$ \text{FanPowerPerVolFlowRate} $</span> = Rated Evaporator Fan Power Per Volume Flow Rate, user input ( W/(m3/s) )

* <span>$ \dot{V}_{Rated} $</span> = Rated Air Volume Flow Rate, user input (m3/s)

The standard rating net total cooling electric power input is calculated as follows:

<div>$$ \text{Power}_{Total} = \left[\dot{Q}_{Total,Rated}\left(\text{TotCapTempModFac}\right)\left(\text{TotCapFlowModFac}_{Rated}\right)\right]\cdot\text{EIR}+\left(\text{FanPowerPerVolFlowRate}\cdot\dot{V}_{Rated}\right) $$</div>

<div>$$ \frac{\text{EIRTempModFac}\text{EIRFlowModFac_{Rated}}}{COP_{Rated}} $$</div>

where:

* <span>$ EER $</span> = Energy efficiency ratio at wet-bulb temperature of air entering the cooling coil, dry-bulb temperature of air entering the air-cooled (outdoor) condenser, and rated air volume flow through the cooling coil (W/W)

* <span>$ \text{TotCapTempModFac} $</span> = Total Cooling Capacity Function of Temperature Curve evaluated at the test condition of wet-bulb temperature of air entering the cooling coil and dry-bulb temperature of air entering the air-cooled (outdoor) condenser (dimensionless)

* <span>$ \text{Power}_{Total} $</span> = Total electric power (compressors, condenser fans and evaporator fan) at the test conditions of wet-bulb temperature of air entering the cooling coil, and dry-bulb temperature of air entering the air-cooled (outdoor) condenser, and rated air volume flow through the cooling coil (W)

* <span>$ COP_{Rated} $</span> = Coefficient of Performance at Rated Conditions, user input (W/W)

* <span>$ \text{EIRTempModFac} $</span> = Energy Input Ratio Function of Temperature Curve evaluated at the test condition of wet-bulb temperature of air entering the cooling coil and dry-bulb temperature of air entering the air-cooled (outdoor) condenser (dimensionless)

* <span>$ \text{EIRFlowModFac}_{Rated} $</span> = Energy Input Ratio Function of Flow Fraction Curve evaluated at a flow fraction of 1.0 (dimensionless).

Reference:

ASHRAE 2012. ANSI/ASHRAE Standard 127-2012 Method of Testing for Rating Computer and Data Processing Room Unitary Air Conditioners.

#### Basin Heater For Two-Stage DX Coil

Basin heater for the object Coil:Cooling:DX:TwoStageWithHumidityControlMode operates in the same manner as for Coil:Cooling:DX:SingleSpeed. Refer to the “Basin Heater For Single-Speed DX Coil” description above.

If the number of capacity stages is equal to 1 and the CondenserType for that stage is EvapCooled, then the basin heater power is calculated for (1 - RunTimeFractionStage1) of DX coil.

If the number of capacity stages is greater than 1, then

1)   If the CondenserType for stage 1 is EvapCooled, then the basin heater power is calculated for (1 - RunTimeFractionStage1) of DX coil

2)   Elseif the CondenserType for stage 2 is EvapCooled, then the basin heater power is calculated for (1 - RunTimeFractionStage2) of DX coil

#### References

AHRI 2008. ANSI/AHRI Standard 210/240: 2008 Standard for Performance Rating of Unitary Air-Conditioning & Air-Source Heat Pump Equipment.  Arlington, VA:  Air-Conditioning, Heating, and Refrigeration Institute.

AHRI 2007. ANSI/AHRI Standard 340/360: 2007 Standard for Performance Rating of Commercial and Industrial Unitary Air-Conditioning and Heat Pump Equipment.  Arlington, VA:  Air-Conditioning, Heating, and Refrigeration Institute.

ASHRAE. 1993. HVAC2 Toolkit: A Toolkit for Secondary HVAC System Energy Calculation. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Carrier, W.H., R.E. Cherne, W.A. Grant, and W.H. Roberts. 1959. *Modern air conditioning, heating and ventilating*, 3d ed. New York: Pitman Publishing Corporation.

Henderson, H.I. Jr., K. Rengarajan, and D.B. Shirey III. 1992. The impact of comfort control on air conditioner energy use in humid climates. *ASHRAE Transactions* 98(2): 104-113.

Henderson, H.I. Jr. and K. Rengarajan. 1996. A Model to Predict the Latent Capacity of Air Conditioners and Heat Pumps at Part-Load Conditions with Constant Fan Operation. *ASHRAE Transactions* 102(2): 266-274.

Henderson, H. 1998. The impact of part load air conditioner operation on dehumidification performance: Validating a latent capacity degradation model. Presented at ASHRAE’s IAQ & Energy ‘98 conference. New Orleans, LA.  October.

Henderson, H. and D. Shirey. 2003. Understanding the Dehumidification Performance of Air-Conditioning Equipment at Part-Load Conditions. Paper presented at Joint CIBSE/ASHRAE Conference, *Building Sustainability, Value and Profit.* September.  Edinburgh, Scotland.

Walker, I.S. and Lutz, J.D. 2005. Laboratory Evaluation of Residential Furnace Blower Performance. Berekely, CA:  Lawrence Berkeley National Laboratory, Report LBNL 58752.

Walker, I.S. 2007. Comparing Residential Furnace Blowers for Rating and Installed Performance. Berkeley, CA:  Lawrence Berkeley National Laboratory, Environmental Energy Technologies Division Report LBNL 62344.

### Multi-Speed Electric DX Air Cooling Coil

#### Overview

This model (object name Coil:Cooling:DX:MultiSpeed) simulates the performance of an air-to-air direct expansion (DX) cooling system. The main difference compared to the other cooling coil models, such as Coil:Cooling:DX:SingleSpeed, is that this cooling coil allows modeling of two to four discrete compressor speeds. Each speed has a set of corresponding performance information at rated conditions along with curve fits for variations in total capacity, SHR, energy input ratio and part-load fraction to determine the performance of the unit at part-load conditions (DOE 1982).  The full load supply airflow rate is dependent on the speed number and provided by its parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed). The part-load impact on coil energy use is automatically applied to the lowest speed. A choice is provided to determine whether part-load impacts on coil energy use are applied when the coil is operating at speeds greater than speed 1.

This model simulates the thermal performance of the indoor DX cooling coil, and the power consumption of the outdoor unit (multispeed compressor, fans, and crankcase heaters). The performance of the indoor supply air fan varies widely from system to system depending on control strategy (e.g., constant fan vs. AUTO fan), fan type, fan motor efficiency and pressure losses through the air distribution system. Therefore, this DX system model does not account for the thermal effects or electric power consumption of the indoor supply air fan. EnergyPlus contains separate models for simulating the performance of various indoor fan configurations, and these models can be easily linked with the DX system model described here to simulate the entire DX system being considered. For the time being, this coil model can only be called by the parent object AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed.

When the model determines performance at Speed 1 (the lowest speed) or cycling between OFF and Speed 1, its performance is almost the same as the performance for the Coil:Cooling:DX:SingleSpeed model. However, the outlet conditions are calculated slightly differently. Therefore, the Coil:Cooling:DX:SingleSpeed model may be considered as a subset of the model described here. When the multispeed coil model determines performance at higher speeds (above 1), the model linearly interpolates the performance at two consecutive speeds (n-1 and n) as needed to meet the cooling load, with the fraction of time at each speed established by the speed ratio.

#### Model Inputs

The model inputs are also very similar to the inputs of the Coil:Cooling:DX:SingleSpeed object. The main difference is that this multispeed model requires a set of fields at each speed, such as rated capacity, rated SHR, rated COP, two capacity modifiers, two energy input ratio modifiers, part-load correction, and latent degradation inputs. The inputs also include waste heat fraction at the rated conditions and modifier as a function of temperature to calculate recoverable waste heat for heat recovery, which are not available in the similar Coil:Cooling:DX:SingleSpeed object

#### Speed 1 Operation

The calculation procedures in this model, including defrost and crankcase heater, are indentical to the Coil:Heating:DX:SingleSpeed object (Ref: Coil:Heating:DX:SingleSpeed) with one exception: outlet node condition calculation when the supply air fan operates continuously (i.e., supply air fan operating mode schedule value is not equal to 0; Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed).

The following procedure provides the detailed description of the exception.

n Total delivered cooling capacity

The total delivered cooling capacity for speed 1 operating at the cycling ratio needed to meet the requested cooling load is:

<div>$${Q_{coil,cycling}} = {\mathop m\limits^\cdot_{Speed1}}*CycRatio*({h_{inlet}} - {h_{outlet,full}})$$</div>

where,

*Q<sub>coil,cyclingl</sub>*      = delivered total cooling capacity for Speed 1 operating at a specific cycling ratio [W]

<span>${\mathop m\limits^\cdot_{Speed\,\,1}}$</span>      = air mass flow rate through cooling coil at Speed 1 as set by the parent object [kg/s]

*h<sub>outlet,full</sub>*      = specific enthalpy of the coil outlet air during full-load operation at Speed 1 (no cycling) [J/kg]

*h<sub>inlet</sub>           *            = specific enthalpy of the coil inlet air [J/kg]

*CycRatio*    = cycling ratio at Speed 1, ratio of requested heating load to the full-load capacity of the coil at Speed 1 [dimensionless]

It is assumed that the coil provides no cooling capacity when the coil is OFF, even if the supply air fan continues to operate.

n Outlet air specific enthalpy

The average specific enthalpy of the coil outlet air is then calculated based on the total delivered cooling capacity and the average air mass flow rate entering the coil:

<div>$${h_{outlet,average}} = {h_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,cycling}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,cycling}}} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where

h<sub>outlet,average</sub>    = averaged specific enthalpy at the coil outlet [J/kg]

h<sub>inlet</sub>             = specific enthalpy at the coil inlet [J/kg]

Q<sub>coil,cycling</sub>      = total capacity at full load [W]

<span>${\mathop m\limits^\cdot_{inlet}}$</span>         = mass flow rate at the inlet to the coil as established by the parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed, Mass Flow Rate Calculation). This flow rate is the average value determined by the parent object, accounting for the specified flow rate when the cooling coil is ON and the specified flow rate when the cooling coil is OFF for the time step being simulated.

n Sensible capacity

The minimum humidity ratio (HR<sub>min</sub> ) is based on humidity ratios between inlet and full load outlet as:

HR<sub>min</sub> = Minimum(HR<sub>inlet</sub>, HR<sub>full</sub>)

where

HR<sub>inlet</sub>           = Humidity ratio at the inlet [kg/kg]

HR<sub>full</sub>            = Full load humidity ratio at the outlet [kg/kg]

The coil sensible capacity may be calculated as:

<div>$${Q_{coil,sens}} = {\mathop m\limits^\cdot_{Speed1}}*CycRatio*[{h_{inlet}}({T_{inlet}},H{R_{\min }}) - {h_{outlet,full}}({T_{outlet,full}},H{R_{\min }})]$$</div>

where

Q<sub>coil,sens</sub>        = delivered sensible cooling capacity [W]

h<sub>outlet,full</sub>         = full load specific enthalpy at the coil outlet as a function of outlet dry-bulb temperature at the full load, and the minimum humidity ratio [J/kg]

h<sub>inlet</sub>             = specific enthalpy at the coil inlet [J/kg]

n Latent capacity

The latent capacity is the difference between total and sensible capacities

<div>$${Q_{coil,latent}} = {Q_{coil,cycling}} - {Q_{coil,sens}}$$</div>

where

Q<sub>coil,latent</sub>        = delivered latent cooling capacity [W]

n Average outlet air humidity ratio

The averaged outlet HR can be calculated as:

<div>$$H{R_{outlet,average}} = H{R_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,latent}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,latent}}} {\mathop {\lambda m}\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop {\lambda m}\limits^\cdot  }$}}_{inlet}}$$</div>

where

λ     = heat of vaporization as a function of HR<sub>min</sub> and CycRatio\*T<sub>outlet,full</sub>+(1-CycRatio)\*T<sub>inlet</sub> [J/kg]

n Average outlet air temperature

Using the above averaged outlet humidity ratio and specific enthalpy, the averaged outlet temperature can be calculated using the psych function of PsyTdbFnHW.

The main reason using the above approach is that outlet conditions are calculated in the same way in low and high speed operation.

The crankcase heater defined for this DX cooling coil is enabled during the time that the compressor is not running for either heating or cooling. The crankcase heater power use from either heating or cooling is reported in the heating coil (Coil:Heating:DX:MultiSpeed).

#### Higher Speed Operation

This section describes how higher speed operation is simulated. When the required sensible load is less than the full load sensible capacity at Speed n (Speed Number &gt; 1), the following calculations are performed:

n Bypass factor at Speed n-1 and Speed n

<div>$$BypassFacto{r_n} = f(RatedBypassFacto{r_n},RatedFlowRat{e_n},ActualFowRat{e_n})$$</div>

<div>$$BypassFacto{r_{n - 1}} = f(RatedBypassFacto{r_{n - 1}},RatedFlowRat{e_{n - 1}},ActualFowRat{e_{n - 1}})$$</div>

where

BypassFactor<sub>i</sub>         = bypass factor at actual flow rate conditions at Speed i [dimensionless]

RatedBypassFactor<sub>i</sub>            = bypass factor at the rated conditions at Speed i [dimensionless]

RatedFowRate<sub>i</sub>        = air mass flow rate at the rated conditions at Speed i [kg/s]

ActualFowRate<sub>i</sub>       = actual air mass flow rate at Speed i [kg/s]

i     = Speed n or Speed n-1

The bypass factor at Speed n is a function of the bypass factor at the rated conditions, rated airflow rate, and actual flow rate at Speed n. The calculation is performed by a function, called AdjustCBF in the DXCoil module.

n Total capacity at Speed n-1 and Speed n

<span>$TotCa{p_{n - 1}} = f(RatedCa{p_{n - 1}},TotCapTempModFa{c_{n - 1}},TotCapFlowModFa{c_{n - 1}},BypassFacto{r_{n - 1}})$</span><span>$TotCa{p_n} = f(RatedCa{p_n},TotCapTempModFa{c_n},TotCapFlowModFa{c_n},BypassFacto{r_n})$</span>

where

TotCap<sub>i             </sub> = total cooling capacity at given temperatures and flow rates at Speed i [w]

RatedCap<sub>i     </sub> = cooling capacity at the rated conditions at Speed i [W]

TotCapTempModFac<sub>i                    </sub> = total cooling capacity modifier as a function of indoor web-bulb temperature and outdoor air dry-bulb temperature at Speed i

TotCapFlowModFac<sub>i                      </sub> = total cooling capacity modifier as a function of the ratio of the actual flow rate across the cooling coil to the rated airflow rate at Speed i

i     = Speed n or Speed n-1



The calculation is performed by a subroutine, called CalcTotCapSHR in the DXCoil module.

n EIR at Speed n-1 and Speed n

<div>$$EI{R_{n - 1}} = RatedEI{R_{n - 1}}*EIRTempModFa{c_{n - 1}}*EIRFlowModFa{c_{n - 1}}$$</div>

<div>$$EI{R_n} = RateEI{R_n}*EIRTempModFa{c_n}*EIRFlowModFa{c_n}$$</div>

where

EIR<sub>i                        </sub> = Energy input ratio at given temperatures and flow rates at Speed i [w]

RatedEIR<sub>i      </sub> = Energy input ratio at the rated conditions at Speed i [W]

EIRTempModFac<sub>i       </sub> = Energy input ratio modifier as a function of indoor and outdoor air dry-bulb temperature at Speed i

EIRFlowModFac<sub>i         </sub> = Energy input ratio modifier as a function of ratio of the actual flow rate across the heating coil to the rated airflow rate at Speed i

i     = n or n-1

n Full load outlet conditions at Speed n-1 and Speed n

The calculation procedure of full load outlet conditions at Speed n-1 and Speed n is the same as the calculation procedure used in the Coil:Cooling:DX:SingleSpeed model (Ref. Coil:Cooling:DX:SingleSpeed). The difference is that the outlet conditions at Speed n-1 are calculated based on the total cooling capacity and mass flow rate at Speed n-1, while the outlet conditions at Speed n are calculated based on the total cooling capacity and mass flow rate at Speed n.

n Effective total cooling capacity

<div>$$\begin{array}{l}{Q_{coil,SpeedRatio}} = (SpeedRatio){\mathop m\limits^\cdot_{Speed{\kern 1pt} n}}({h_{inlet}} - {h_{outlet,full\_Speed\;n}})\\\;\;\;\;\;\;\;\;\; + (1 - SpeedRatio){\mathop m\limits^\cdot_{Speed\;n - 1}}({h_{inlet}} - {h_{outlet,full\_Speed\;n - 1}})\end{array}$$</div>

where

<span>${Q_{coil,SpeedRatio}}$</span><sub>                       </sub> = delivered sensible cooling capacity at a given speed ratio between two consecutive speeds [W]

<span>${\mathop m\limits^\cdot_{Speed\,n}}$</span>      = air mass flow rate through cooling coil at Speed n as set by the parent object [kg/s]

<span>${\mathop m\limits^\cdot_{Speed\,\,n - 1}}$</span>    = air mass flow rate through cooling coil at Speed 1 as set by the parent object [kg/s]

h<sub>inlet</sub>             = specific enthalpy at the coil inlet [J/kg]

h<sub>outlet,full\_Speed\\ n</sub> = full load specific enthalpy at the coil outlet at Speed n [J/kg]

h<sub>outlet,full\_Speed\\ n-1</sub>           = full load specific enthalpy at the coil outlet at Speed n-1 [J/kg]

n Average outlet air specific enthalpy

<div>$${h_{outlet,average}} = {h_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,SpeedRatio}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,SpeedRatio}}} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where

h<sub>outlet,average</sub>    = averaged specific enthalpy at the coil outlet [J/kg]

h<sub>inlet</sub>             = specific enthalpy at the coil inlet [J/kg]

<span>${\mathop m\limits^\cdot_{inlet}}$</span>         = mass flow rate at the inlet to the coil as established by the parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed, Mass Flow Rate Calculation). This flow rate is the average value determined by the parent object, accounting for the specified flow rate when the heating coil is at Speed n and the specified flow rate when the heating coil is at Speed n-1 for the time step being simulated.

n Effective sensible cooling capacity

The minimum humidity ratio (HR<sub>min</sub> ) is calculated as

HR<sub>min</sub> = Minimum[HR<sub>inlet</sub>, (SpeedRatio)HR<sub>full,n</sub>+(1.0-SpeedRatio)HR<sub>full,n-1</sub>)

The effective sensible cooling capacity is expressed as:

<div>$$\begin{array}{l}{Q_{coil,sens}} = {\mathop m\limits^\cdot_{Speed\;n}}(SpeedRatio)[{h_{inlet}}({T_{inlet}},H{R_{\min }}) - {h_{outlet,full\_Speed\,n}}({T_{outlet,n}},H{R_{\min }})]\\\;\;\;\;\;\;\;\;\;\;\;\;\;\; + {\mathop m\limits^\cdot_{Speed\;n - 1}}(1 - SpeedRatio)[{h_{inlet}}({T_{inlet}},H{R_{\min }}) - {h_{outlet,full\_Speed\;n - 1}}({T_{outlet,n - 1}},H{R_{\min }})]\end{array}$$</div>

where

Q<sub>coil,sens</sub>        = effective sensible cooling capacity [W]

h<sub>outlet,full\_Speed\\ n</sub> = full load specific enthalpy at the coil outlet at Speed n as a function of outlet dry-bulb temperature at the full load, and the minimum humidity ratio [J/kg]

h<sub>outlet,full\_Speed\\ n-1</sub> = full load specific enthalpy at the coil outlet at Speed n-1 as a function of outlet dry-bulb temperature at the full load, and the minimum humidity ratio [J/kg]

h<sub>inlet</sub>             = specific enthalpy at the coil inlet [J/kg]

n Aaverage outlet air humidity ratio and temperature

The effective latent cooling capacity is the difference between the total and sensible capacity:

<div>$${Q_{coil,latent}} = {Q_{coil,SpeedRatio}} - {Q_{coil,sens}}$$</div>

Q<sub>coil,latent</sub>        = effective latent cooling capacity [W]

The average outlet air HR can be calculated as:

<div>$$H{R_{outlet,average}} = H{R_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,latent}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,latent}}} {\mathop {\lambda m}\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop {\lambda m}\limits^\cdot  }$}}_{inlet}}$$</div>

where

λ     = heat of vaporization as a function of HR<sub>min</sub> and SpeedRatio\*T<sub>outlet,n</sub>+(1-SpeedRatio)\*T<sub>outlet,n-1</sub> [J/kg]

At the given averaged outlet humidity ratio and specific enthalpy, the averaged outlet temperature can be calculated using the psych function of PsyTdbFnHW.

n Calculate combined energy input

When the input for the field ‘Apply Part Load Fraction to Speeds Greater than 1’ is No in the object (equivalent to a single compressor), the combined energy output is calculated as follows:

<span>$CoolingPower = (TotCa{p_n})(EI{R_n})(SpeedRatio) + (TotCa{p_{n - 1}})(EI{R_{n - 1}})(1.0 - SpeedRatio)$</span> When the input for the field ’Apply Part Load Fraction to Speeds Greater than 1’ is Yes in the object (equivalent to multiple compressors), the combined energy output is calculated as follows:

<div>$$CoolingPower = (TotCa{p_n})(EI{R_n})(RTF) + (TotCa{p_{n - 1}})(EI{R_{n - 1}})(1.0 - RTF)$$</div>

where

CoolingPower         = Power used in Watt

RTF            = Run time fraction at Speed n

n Latent degradation

When the supply fan operation mode is ContinuousFanWithCyclingCompressorand the input of the Apply Latent Degradation to Speeds Greater than 1 is Yes, the latent degradation is included at Speed n. The calculation procedure is the same as one in the Coil:Cooling:DX:SingleSpeed object. The difference is that the rated values and run time fraction at Speed n are used. The adjusted SHR is used to calculate full load outlet conditions at Speed n.

It is expected to have less latent degradation at Speed n than Speed 1. Therefore, smaller values of the latent degradation inputs at Speed n than those at Speed 1 are recommended.

n Crankcase heater

There is no power need at higher speed operation.

#### Waste heat calculation

The waste heat generated by this coil object is calculated as:

<div>$${Q_{WasteHeat}} = (Fraction)(TempModifier)(CoolingPowe)$$</div>

where

Fraction                  = rated waste heat fraction of the energy input

TempModifer<sub>                    </sub> = waste heat modifier as a function of indoor and outdoor air dry-bulb temperature

#### Basin Heater For Multi-Speed DX Coil

Basin heater for the object Coil:Cooling:DX:MultiSpeed operates in the same manner as for Coil:Cooling:DX:SingleSpeed. Refer to the Basin Heater For Single-Speed DX Coil description above.

#### Standard Rating of Multi-Speed DX Cooling Coils

For multi-speed direct expansion cooling coils, the industry standard ratings of Standard Rating Seasonal Energy Efficiency Ratio (SEER) are calculated according to ANSI/AHRI Standard 210/240 (AHRI 2008). These standard ratings can be calculated using the user-entered information for the Coil:Cooling:DX:MultiSpeed object.  According to Standard 210/240, the Standard Rating SEER applies to air-to-air unitary heat pumps and air conditions with rated cooling capacities under 19,000 Watts (&lt;65,000 Btu/h). The Cooling Mode Test Conditions for Units Having two-capacity Compressor standard tests A<sub>2</sub>, B<sub>2</sub>, B<sub>1</sub>, and F<sub>1</sub> are also provided in Table 56. Cooling Mode Test Conditions for Units Having a Two-Capacity Compressor. The equations required to calculate the net cooling capacity and SEER value are described next.

#### Standard Rating Cooling Capacity

The standard net cooling capacity of multi-speed DX cooling coil is reported at the maximum speed and full load A2 test condition only. The Standard Rating (Net) Cooling Capacity calculation is the same as single speed DX cooling coil procedure when calculated at maximum speed.The procedure for calculating the Standard Rating Cooling Capacity is given by:

<div>$${\dot Q_{StandardRating}} = \dot Q_{T,\,CRated}^{k = 2} \cdot CAPFT_{TestA2}^{k = 2} \cdot CAPFFF_{TestA2}^{k = 2}$$</div>

<div>$${\dot Q_{Standard\,Rating\,Net}} = {\dot Q_{StandardRating}} - Fa{n_{Power,\,CRated}}$$</div>

<div>$$Fa{n_{Power,\,CRated}} = FanPowerPerVolFlowRat{e^{k = 2}} \cdot \dot V_{CRated}^{k = 2}$$</div>

where,

<span>${\dot Q_{StandardRating\,Net}}$</span> =    total standard **(net)** cooling capacity (W) of the air-conditioning or heat pump equipment in cooling mode determined from ANSI/AHRI Standard 210/240 and A2 test conditions shown in Table 56. The standard cooling test conditions for air-cooled condenser are: indoor coil entering air dry-bulb and wet-bulb temperatures 26.7°C/19.4°C and outdoor coil entering air dry-bulb and wet-bulb temperatures 35.0°C/23.9°C.

<span>${\dot Q_{StandardRating}}$</span> =        total standard cooling capacity (W) of the air-conditioning or heat pump equipment determined from ANSI/AHRI Standard 210/240 and A2 test conditions shown in Table 56. The standard cooling test conditions for air-cooled are: indoor coil entering air dry-bulb and wet-bulb temperatures 26.7°C/19.4°C and outdoor coil entering air dry-bulb and wet-bulb temperatures 35.0°C/23.9°C.

<span>$\dot Q_{T,\,CRated}^{k = 2}$</span> = Rated total cooling capacity at maximum speed, user input (W)

<span>$CAPFT_{TestA2}^{k = 2}$</span>= User-specified bi-quadratic curve evaluated at the indoor coil entering air wet-bulb temperature (19.4°C) and outdoor coil entering air dry-bulb temperature (35.0°C) for air-cooled condenser per A2 test condition as specified in Table 56, (dimensionless).

<span>$CAPFFF_{TestA2}^{k = 2}$</span>= User-specified quadratic or cubic curve modifying the total cooling capacity as function of flow fraction, (dimensionless).  This curve is evaluated at a flow fraction of 1.0.

<span>$Fa{n_{Power,\,Rated}}$</span>= Supply air fan power at rated conditions at high (maximum) compressor speed, (W).

<span>$\dot V_{_{CRated}}^{k = 2}$</span>= Rated Air Volume Flow Rate at high (maximum) compressor speed, user input (m<sup>3</sup>/s)

<span>$FanPowerPerVolFlowRat{e^{k = 2}}$</span>= The Rated Indoor Coil Fan Power Per Volume Flow rate is a user-entered value, with a default of 773.3 W/(m<sup>3</sup>/s)) if the user leaves this input field blank. The default value is taken from ANSI/ASHRAE Standard 210/240 -2008 where it is defined for systems which do not have an indoor coil fan furnished as part of the system. See the description given below how this value is calculated. User input ( W/(m<sup>3</sup>/s)).

The Rated Evaporator (Indoor Coil) Fan Power Per Volume Flow rate is a user-entered value, with a default of 773.3 W/(m<sup>3</sup>/s)) if the user leaves this input field blank. The default value is taken from ANSI/ASHRAE Standard 210/240-2008 where it is defined for systems which do not have an Indoor Coil (Evaporator) fan furnished as part of the system. The test conditions in ANSI/AHRI Standard 210/240 vary the external static pressure (i.e., pressure drop associated with ductwork and other devices external to the indoor fan/coil section) seen by the supply air fan based on the standard rating cooling capacity.

#### Seasonal Energy Efficiency Ratio (SEER) for Multi-Speed DX Coil

The SEER value for multi-speed compressor air conditioner or air-to-air heat pumps per AHRI/ANSI Std. 210/240 – 2008 is calculated as follows:

<div>$$SEER = \frac{{\sum\limits_{j = 1}^8 {\frac{{{q_c}({T_j})}}{N}} }}{{\sum\limits_{j = 1}^8 {\frac{{{e_c}({T_j})}}{N}} }}$$</div>

For multi-speed compressor the SEER value is weighted average performance at different outdoor air temperature bins.  The eight outdoor air temperature bins and the corresponding weight are provided in Table 57. Distribution of Fractional Hours with in Cooling Season Temperature Bins.

Where,

*q<sub>c</sub>*(T<sub>j</sub>)/N =  = the ratio of space cooling capacity provided by the unit during periods of the space cooling season when the outdoor temperature fell within the range represented by bin temperature *T<sub>j</sub>* to the total number of hours in the cooling season (N), (W)

*e<sub>c</sub>*(T<sub>j</sub>)/N = the ratio of the electrical energy consumed by the unit during periods of the space cooling season when the outdoor temperature fell within the range represented by bin temperature Tj to the total number of hours in the cooling season (N), W.

*j*      = the bin number, dimensionless. For cooling season j ranges from 1 to 8.

*T<sub>j</sub>*    =          outdoor air bin temperature, °C. Outdoor temperatures are “binned” such that calculations are only performed based one temperature within the bin. Bins of 2.8 °C with 8 cooling season bin temperatures being 19.44°C, 22.22°C, 25.0°C, 27.78°C, 30.56°C, 33.33°C, 36.11°C, 38.89°C.

The steady-state cooling capacity delivered and the electric power inputs when the DX coil is operating at minimum compressor speed (*k=1*), and outdoor air temperature *T<sub>j</sub>*, are determined by linear interpolation using the values of B1 and F1 tests as follows:

<div>$$\dot Q_c^{k = 1}({T_j}) = \dot Q_c^{k = 1}(19.44) + \frac{{\dot Q_c^{k = 1}(27.78) - \dot Q_c^{k = 1}(19.44)}}{{27.78 - 19.44}}\left( {{T_j} - 19.44} \right)$$</div>

<div>$$\dot E_c^{k = 1}({T_j}) = \dot E_c^{k = 1}(19.44) + \frac{{\dot E_c^{k = 1}(27.78) - \dot E_c^{k = 1}(19.44)}}{{27.78 - 19.44}}\left( {{T_j} - 19.44} \right)$$</div>

The steady-state cooling capacities and electric power inputs at the minimum speed and test condition *B<sub>1</sub>* and *F<sub>1</sub>* are calculated from the minimum (low) speed performance curves as follows:

<div>$$\dot Q_c^{k = 1}(27.78) = \dot Q_{T,\,CRated}^{k = 1} \cdot CAPFT_{TestB1}^{k = 1} \cdot CAPFFF_{TestB1}^{k = 1} - FanPower_{CRated}^{k = 1}$$</div>

<div>$$\dot E_c^{k = 1}(27.78) = \left[ {\frac{{\dot Q_c^{k = 1}(27.78)}}{{COP_{CRated}^{k = 1}}}} \right] \cdot EIRFT_{TestB1}^{k = 1} \cdot EIRFFF_{TestB1}^{k = 1} + FanPower_{CRated}^{k = 1}$$</div>

<div>$$\dot Q_c^{k = 1}(19.44) = \dot Q_{T,\,CRated}^{k = 1} \cdot CAPFT_{TestF1}^{k = 1} \cdot CAPFFF_{TestF1}^{k = 1} - FanPower_{CRated}^{k = 1}$$</div>

<div>$$\dot E_c^{k = 1}(19.44) = \left[ {\frac{{\dot Q_c^{k = 1}(19.44)}}{{COP_{CRated}^{k = 1}}}} \right] \cdot EIRFT_{TestF1}^{k = 1} \cdot EIRFFF_{TestF1}^{k = 1} + FanPower_{CRated}^{k = 1}$$</div>

<div>$$FanPower_{CRated}^{k = 1} = FanPowerPerVolFlowRat{e^{k = 1}} \cdot {\rm{\dot V}}_{CRated}^{k = 1}$$</div>

Where,

<span>$\dot Q_{T,\,CRated}^{k = 1}$</span>=   rated total cooling capacity at minimum compressor speed specified by users, (W)

<span>$COP_{CRated}^{k = 1}$</span>=            rated gross COP at minimum compressor speed specified by users, (-)

<span>$CAPFT_{TestB1}^{k = 1}$</span>=cooling capacities modifier curve for temperature at minimum compressor speed and B1 test condition, (-)

<span>$CAPFFF_{TestB1}^{k = 1}$</span>=      cooling capacities modifier curve for flow fraction at minimum compressor speed and B1 test condition, (-)

<span>$EIRFT_{TestB1}^{k = 1}$</span>=EIR modifier curve for temperature at minimum compressor speed and B1 test condition, (-)

<span>$EIRFFF_{TestB1}^{k = 1}$</span>=EIR modifier curve for flow fraction at minimum compressor speed and B1 test condition, (-)

<span>$CAPFT_{TestF1}^{k = 1}$</span>=cooling capacities modifier curve for temperature at minimum compressor speed and F1 test condition, (-)

<span>$CAPFFF_{TestF1}^{k = 1}$</span>=cooling capacities modifier curve for flow fraction at minimum compressor speed and F1 test condition, (-)

<span>$EIRFT_{TestF1}^{k = 1}$</span>=EIR modifier curve for temperature at minimum compressor speed and F1 test condition, (-)

<span>$EIRFFF_{TestF1}^{k = 1}$</span>=EIR modifier curve for flow fraction at minimum compressor speed and F1 test condition, (-)

<span>$FanPower_{CRated}^{k = 1}$</span>=the rated supply air fan power when the unit is operating at minimum compressor speed, (W)

<span>$V_{CRated}^{k = 1}$</span>=rated cooling supply air volume flow rate at minimum compressor speed specified by users, (-)

<span>$FanPowerPerVolFlowRat{e^{k = 1}}$</span> =  the rated Indoor Coil fan power per volume flow rate at low (minimum) compressor speed specified value by the user, (W/(m3/s))

The steady-state cooling capacity delivered and the electric power inputs when the DX cooling coil is operating at maximum (high) compressor speed (*k=2*), and outdoor air temperature *T<sub>j</sub>*, are determined as follows:

<div>$$\dot Q_c^{k = 2}({T_j}) = \dot Q_c^{k = 2}(27.78) + \frac{{\dot Q_c^{k = 2}(35.0) - \dot Q_c^{k = 2}(27.78)}}{{35.0 - 27.78}}\left( {{T_j} - 27.78} \right)$$</div>

<div>$$\dot E_c^{k = 2}({T_j}) = \dot E_c^{k = 2}(27.78) + \frac{{\dot E_c^{k = 2}(35.0) - \dot E_c^{k = 2}(27.7)}}{{35.0 - 27.78}}\left( {{T_j} - 27.78} \right)$$</div>

The steady-state cooling capacities and electric power input at the maximum speed and test condition *A<sub>2</sub>* and *B<sub>2</sub>* are determined from the maximum (high) speed performance curves as follows:

<div>$$\dot Q_c^{k = 2}(35.0) = \dot Q_{T,\,CRated}^{k = 2} \cdot CAPFT_{TestA2}^{k = 2} \cdot CAPFFF_{TestA2}^{k = 2} - FanPower_{CRated}^{k = 2}$$</div>

<div>$$\dot E_c^{k = 2}(35.0) = \left[ {\frac{{\dot Q_c^{k = 2}(35.0)}}{{COP_{CRated}^{k = 2}}}} \right] \cdot EIRFT_{TestA2}^{k = 2} \cdot EIRFFF_{TestA2}^{k = 2} + FanPower_{CRated}^{k = 2}$$</div>

<span>$\dot Q_c^{k = 2}(27.78) = \dot Q_{T,\,CRated}^{k = 2} \cdot CAPFT_{TestB2}^{k = 2} \cdot CAPFFF_{TestB2}^{k = 2} - FanPower_{CRated}^{k = 2}$</span> <span>$\dot E_c^{k = 2}(27.78) = \left[ {\frac{{\dot Q_c^{k = 2}(19.44)}}{{COP_{CRated}^{k = 2}}}} \right] \cdot EIRFT_{TestB2}^{k = 2} \cdot EIRFFF_{TestB2}^{k = 2} + FanPower_{CRated}^{k = 2}$</span>

<div>$$FanPower_{CRated}^{k = 2} = FanPowerPerVolFlowRat{e^{k = 2}} \cdot {\rm{\dot V}}_{CRated}^{k = 2}$$</div>

Where,

<span>$\dot Q_{T,\,CRated}^{k = 2}$</span> = rated total cooling capacity at maximum (high) compressor speed specified by users, (W)

<span>$COP_{CRated}^{k = 2}$</span> = rated gross COP at maximum (high) compressor speed specified by users, (-)

<span>$CAPFT_{TestA2}^{k = 2}$</span> = cooling capacity modifier curve for temperature at maximum (high) compressor speed and *A*<sub>2</sub> test condition, (-)

<span>$CAPFFF_{TestA2}^{k = 2}$</span>        =cooling capacity modifier curve for flow fraction at maximum (high) compressor speed and *A*<sub>2</sub> test condition, (-)

<span>$EIRFT_{TestA2}^{k = 2}$</span> = EIR modifier curve for temperature at maximum (high) compressor speed and *A*<sub>2</sub> test condition, (-)

<span>$EIRFFF_{TestA2}^{k = 2}$</span> = EIR modifier curve for flow fraction at maximum (high)  compressor speed and *A*<sub>2</sub> test condition, (-)

<span>$CAPFT_{TestB2}^{k = 2}$</span> = cooling capacity modifier curve for temperature at maximum (high) compressor speed and *B*<sub>2</sub> test condition, (-)

<span>$CAPFFF_{TestB2}^{k = 2}$</span>        =cooling capacity modifier curve for flow fraction at maximum (high) compressor speed and *B*<sub>2</sub> test condition, (-)

<span>$EIRFT_{TestB2}^{k = 2}$</span> = EIR modifier curve for temperature at maximum (high) compressor speed and *B*<sub>2</sub> test condition, (-)

<span>$EIRFFF_{TestB2}^{k = 2}$</span> = EIR modifier curve for flow fraction at maximum (high) compressor speed and *B*<sub>2</sub> test condition, (-)

<span>$FanPower_{CRated}^{k = 2}$</span> = the rated supply air fan power when the unit is operating at maximum (high) compressor speed, (W)

<span>$V_{CRated}^{k = 2}$</span> = rated supply air volume flow rate at maximum (high) compressor speed specified by users, (-)

<span>$FanPowerPerVolFlowRate{k^{k = 2}}$</span> =the Rated Evaporator (Indoor Coil) Fan Power Per Volume Flow rate at maximum (high) compressor speed specified value by the user, (W/(m3/s))

The above steps show how the cooling capacity and electric power inputs are determined when the DX cooling coil is operating at minimum (low) and maximum (high) compressor speeds.  But the unit may operate at minimum (low) speed capacity, cycle on–off, cycle between successiave lower and higher compressor speed capacity, or operate at maximum (high) speed capacity depending on the building cooling load. The operating range of the DX cooling coil is determined based on the building cooling load for each binned outside air temperature. The building cooling load at an outdoor air temperature *T<sub>j</sub>*, is calculated as follows:

<div>$$BL({T_j}) = \left( {\frac{{{T_j} - 18.3}}{{35.0 - 18.3}}} \right)\left( {\frac{{\dot Q_c^{k = 2}(35.0)}}{{1.1}}} \right)$$</div>

Where,

*BL(T<sub>j</sub>)*          =the building space cooling load corresponding to outdoor temperature of *T<sub>j</sub>*, (W).

<span>$\dot Q_c^{k = 2}(35.0)$</span>=the cooling capacity determined from the standard A2 test, (W)

The temperatures 35.0 °C and 18.3 °C in the building load calculation equation represent the outdoor design air temperature, and zero-load base temperature, respectively (ANSI/ASHRAE, 2008).  1.1 is a sizing factor.

The cooling capacity delivered and the electric power inputs calculations when the DX cooling coil is cycling on-off, operating at minimum (low) compressor speed, cycling between successive minimum (low) and maximum (high) compressor speed, or operating at maximum (high) compressor speed are described next.

*Case 1*:  The steady state cooling capacity when the unit is operating at or below the minimum (low) speed compressor capacity, i.e., when the building cooling load is less or equal to the minimum (low) compressor speed capacity, is calculated as follows:

<div>$$\dot Q_c^{k = 1}({T_j}) \ge BL({T_j})$$</div>

<div>$$\frac{{{q_c}({T_j})}}{N} = \left[ {{X^{k = 1}}({T_j}) \cdot \dot Q_c^{k = 1}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$$</div>

<div>$$\frac{{{e_c}({T_j})}}{N} = \left[ {\frac{{{X^{k = 1}}({T_j})}}{{PL{F_j}}}\dot E_c^{k = 1}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$$</div>

<div>$${X^{k = 1}}({T_j}) = \frac{{BL({T_j})}}{{\dot Q_c^{k = 1}({T_j})}}$$</div>

<div>$$PL{F_j} = 1 - C_D^c\left[ {1 - {X^{k = 1}}({T_j})} \right]$$</div>

Where,

*X(T<sub>j</sub>)* = the cooling mode load factor or part-load ratio for temperature bin j, (-)

n<sub>i</sub>/N = fractional bin hours for the cooling season; the ratio of the number of hours during the cooling season when the outdoor temperature fell within the range represented by bin temperature *T<sub>j</sub>* to the total number of hours in the cooling season, (-). (see Table 57)

<span>$C_D^c$</span> = cooling coefficient of degradation, default value is 0.25.

*Case 2*:  The unit cycles between successive the minimum (low) and maximum (high) compressor speed capacity to meet the building cooling load at outdoor air temperature *T<sub>j</sub>*.  That is, the cooling building load is between the units successive minimum (low) and maximum (high) compressor speed capacities:

<div>$$\dot Q_c^{k = 1}({T_j}) < BL({T_j}) < \dot Q_c^{k = 2}({T_j})$$</div>

<span>$\frac{{{q_c}({T_j})}}{N} = \left[ {{X^{k = 1}}({T_j}) \cdot \dot Q_c^{k = 1}({T_j}) + \left( {1 - {X^{k = 1}}({T_j})} \right) \cdot \dot Q_c^{k = 2}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$</span><span>$\frac{{{e_c}({T_j})}}{N} = \left[ {{X^{k = 1}}({T_j}) \cdot \dot E_c^{k = 1}({T_j}) + \left( {1 - {X^{k = 1}}({T_j})} \right) \cdot \dot E_c^{k = 2}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$</span>

<div>$${X^{k = 1}}({T_j}) = \frac{{\dot Q_c^{k = 2}({T_j}) - BL({T_j})}}{{\dot Q_c^{k = 2}({T_j}) - \dot Q_c^{k = 1}({T_j})}}$$</div>

*Case 3*:  The steady-state cooling capacity when the unit is operating continuously at maximum (high) compressor speed capacity at outdoor air temperature *T<sub>j</sub>*. That is the building cooling load is greater or equal to the available capacity at maximum (high) compressor speed:

<div>$$BL({T_j}) \ge \dot Q_c^{k = 2}({T_j})$$</div>

For units when operating continuously at maximum (high) compressor speed (k=2) at temperature *T<sub>j</sub>*, the delivered cooling capacity and electric power inputs are calculated as follows:

<div>$$\frac{{{q_c}({T_j})}}{N} = \left[ {\dot Q_c^{k = 2}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$$</div>

<div>$$\frac{{{e_c}({T_j})}}{N} = \left[ {\dot E_c^{k = 2}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$$</div>

Table 56. Cooling Mode Test Conditions for Units Having a Two-Capacity Compressor

<table class="table table-striped">
  <tr>
    <th colspan="7">Source: AHRI Standard 210-240, 2008; Table 5, Page 65</th>
  </tr>
  <tr>
    <td>Test Description</td>
    <td>Air Entering Indoor Unit Temperature (F / C)</td>
    <td></td>
    <td>Air Entering Outdoor Unit Temperature (F / C)</td>
    <td></td>
    <td></td>
    <td></td>
  </tr>
  <tr>
    <td></td>
    <td>Dry Bulb</td>
    <td>Wet Bulb</td>
    <td>Dry Bulb</td>
    <td>Wet Bulb</td>
    <td>Compressor Capacity</td>
    <td>Cooling Air Volume Rate</td>
  </tr>
  <tr>
    <td>A2 Test-required (steady, wet coil)</td>
    <td>80.0/26.7</td>
    <td>67.0/19.4</td>
    <td>95.0/35.0</td>
    <td>75.0/23.9</td>
    <td>High</td>
    <td>Cooling Full-load</td>
  </tr>
  <tr>
    <td>B2 Test-required (steady, wet coil)</td>
    <td>80.0/26.7</td>
    <td>67.0/19.4</td>
    <td>82.0/27.8</td>
    <td>65.0/18.3</td>
    <td>High</td>
    <td>Cooling Full-load</td>
  </tr>
  <tr>
    <td>B1 Test-required (steady, wet coil)</td>
    <td>80.0/26.7</td>
    <td>67.0/19.4</td>
    <td>82.0/27.8</td>
    <td>65.0/18.3</td>
    <td>Low</td>
    <td>Cooling Minimum</td>
  </tr>
  <tr>
    <td>C2 Test-optional (steady, dry coil)</td>
    <td>80.0/26.7</td>
    <td></td>
    <td>82.0/27.8</td>
    <td></td>
    <td>High</td>
    <td>Cooling Full-load</td>
  </tr>
  <tr>
    <td>D2 Test-required (cyclic, dry coil)</td>
    <td>80.0/26.7</td>
    <td></td>
    <td>82.0/27.8</td>
    <td></td>
    <td>High</td>
    <td></td>
  </tr>
  <tr>
    <td>C1 Test-optional (steady, dry coil)</td>
    <td>80.0/26.7</td>
    <td></td>
    <td>82.0/27.8</td>
    <td></td>
    <td>Low</td>
    <td>Cooling Minimum</td>
  </tr>
  <tr>
    <td>D1 Test-optional (cyclic, dry coil)</td>
    <td>80.0/26.7</td>
    <td></td>
    <td>82.0/27.8</td>
    <td></td>
    <td>Low</td>
    <td></td>
  </tr>
  <tr>
    <td>F1 Test-optional (steady, dry coil)</td>
    <td>80.0/26.7</td>
    <td>67.0/19.4</td>
    <td>67.0/19.4</td>
    <td>53.5/11.9</td>
    <td>High</td>
    <td>Cooling Minimum</td>
  </tr>
</table>

Table 57. Distribution of Fractional Hours with in Cooling Season Temperature Bins

<table class="table table-striped">
  <tr>
    <th colspan="4">Source: AHRI Standard 210-240, 2008; Table 16, Page 94</th>
  </tr>
  <tr>
    <td>Bin Number j</td>
    <td>Bin Temperature Range (C)</td>
    <td>Representative Temperature for bin (C)</td>
    <td>Fraction of Total Temperature Bin Hours Nj/N</td>
  </tr>
  <tr>
    <td>1</td>
    <td>Dry Bulb</td>
    <td>Wet Bulb</td>
    <td>Dry Bulb</td>
  </tr>
  <tr>
    <td>2</td>
    <td>18.33 - 20.56</td>
    <td>19.44</td>
    <td>0.214</td>
  </tr>
  <tr>
    <td>3</td>
    <td>21.11 - 23.33</td>
    <td>22.22</td>
    <td>0.231</td>
  </tr>
  <tr>
    <td>4</td>
    <td>23.89 - 26.11</td>
    <td>25</td>
    <td>0.216</td>
  </tr>
  <tr>
    <td>5</td>
    <td>26.67 - 28.89</td>
    <td>27.78</td>
    <td>0.161</td>
  </tr>
  <tr>
    <td>6</td>
    <td>29.44 - 31.67</td>
    <td>30.56</td>
    <td>0.104</td>
  </tr>
  <tr>
    <td>7</td>
    <td>32.22 - 34.44</td>
    <td>33.33</td>
    <td>0.052</td>
  </tr>
  <tr>
    <td>8</td>
    <td>35.00 - 37.22</td>
    <td>36.11</td>
    <td>0.018</td>
  </tr>
</table>

#### References

See the references for the single speed DX cooling coil earlier in this document.

### Two-Speed Electric DX Air Cooling Coil

#### Overview

The input object Coil:Cooling:DX:TwoSpeed provides a model that is meant to represent either a 2 speed (fan and compressor) DX cooling unit (compressor, evaporator, condenser) or a variable speed DX cooling unit in which the variation of compressor speed and air flow rate is nearly linear as a function of cooling part load. In EnergyPlus Coil:Cooling:DX:TwoSpeed is used as the cooling coil in packaged variable volume systems (PVAV). The model is based upon the single speed DX unit Coil:Cooling:DX:SingleSpeed. Basically the model for Coil:Cooling:DX:TwoSpeed employs a separate single speed model at high speed (full load) and low speed (minimum load) and interpolates between these 2 states to obtain the needed cooling output. Below minimum load the unit cycles on/off, just like the single speed unit.

#### Inputs and Data

The input is similar to that for Coil:Cooling:DX:SingleSpeed except there needs to be two complete sets of performance data. The user inputs a rated total cooling capacity, rated SHR, rated COP, and rated air volumetric flow rate for the high speed and low speed states. Performance curves – cooling capacity as a function of entering air wet-bulb temperature and outside dry-bulb temperature (wet-bulb if there is an evaporatively cooled condenser), EIR as a function of the same two temperatures – must be defined and referenced for both high and low speed states. The performance characteristics of the evaporative condenser, if present, also need to be given at high and low speed states: effectiveness, air volumetric flow rate, and pump power consumption. The full list of inputs is given in the Input/Output Reference document.

The data for Coil:Cooling:DX:TwoSpeed is stored in the array structure *DXCoil* in the program module *DXCoils*

#### Calculation

Calculation is performed in routine *CalcMultiSpeedDXCoil* in module *DXCoils*. The inputs to the calculation are the coil index (denoting a specific coil with its particular performance parameters), the speed ratio, and the cycling ratio. The speed ratio is an artificial parameter between 0 and 1. If the speed ratio (*SR*) is greater than zero, the performance of the unit will be:

<div>$$SR\cdot HighSpeedPerformance + (1 - SR)\cdot LowSpeedPerformance$$</div>

Here *HighSpeedPerformance* means the electricity consumption, cooling output, and outlet conditions of the unit if the unit were operating at high speed (full load). Similarly *LowSpeed Performance* means the electricity consumption, cooling output, and outlet conditions if the unit were operating at low speed (minimum non-cycling load). The calculations for each state are the same as for the single speed, cycling DX unit Coil:Cooling:DX:SingleSpeed.

If the speed ratio is zero and the cycling ratio is &gt; 0, the unit will be in cycling mode. The unit will be on for *cycling ratio* fraction of the time step, off for the remainder of the time step. While on, the unit will perform according to the low speed performance parameters.

#### Simulation and Control

Coil:Cooling:DX:TwoSpeed is not used by itself; it is used as part of an encompassing component or system that provides control for the unit. In setting up a PVAV system, for instance, Coil:Cooling:DX:TwoSpeed is part of the component CoilSystem:Cooling:DX, which controls Coil:Cooling:DX:TwoSpeed. When used in the CoilSystem:Cooling:DX component, the simulation allows for either temperature *or* temperature and dehumidification control based on a dehumidification control selection in the CoilSystem:Cooling:DX component. If None is selected the simulation runs the DX unit to satisfy a supply air temperature setpoint. It typically varies the speed ratio in an iterative solution process to establish the operating point that will give the desired unit outlet air temperature. If CoolReheat is selected, the simulation first runs the DX unit to satisfy a supply air temperature setpoint. However, in this case if the DX unit outlet air humidity ratio is above the humidity ratio setpoint, the simulation will increase the speed and/or cycling ratio to meet the desired unit outlet air humidity ratio. The humidity ratio setpoint is specified through the use of a humidistat (ref. ZoneControl:Humidistat) and a setpoint manager (ref. SetpointManager:SingleZone:Humidity:Maximum, SetpointManager:MultiZone:MaximumHumidity:Average,  SetpointManager:MultiZone:Humidity:Maximum or SetpointManager:OudoorAirPretreat). When used with the CoilSystem:Cooling:DX component, the dehumidification control type Multimode is not allowed.

#### Basin Heater For Two-Speed DX Coil

Basin heater for the object Coil:Cooling:DX:TwoSpeed operates in the same manner as for Coil:Cooling:DX:SingleSpeed. Refer to the “Basin Heater For Single-Speed DX Coil” description above.

#### Standard Ratings

The Coil:Cooling:DX:TwoSpeed object includes industry standard ratings of Standard Rating Cooling Capacity, Energy Efficiency Ratio (EER), and Integrated Energy Efficiency Ratio (IEER) which are calculated according to ANSI/AHRI Standard 340/360-2007 with Addenda 1 and 2 (AHRI 2007). These ratings apply to unitary air conditioners with air-cooled condensers with standard rated cooling capacities from 19 kW (65,000 Btu/h) to below 220 kW (760,000 Btu/h).

For the Coil:Cooling:DX:TwoSpeed object in EnergyPlus, these standard ratings are not direct inputs to the model. However, these standard ratings can be calculated using user-entered information for the Coil:Cooling:DX:TwoSpeed object. These standard rating values are provided in the eplusout.eio output file (Ref. OutputDetailsAndExamples.pdf) and also in the predefined tabular output reports (Output:Table:SummaryReports object, Equipment Summary report, DX Cooling Coil table and VAV DX Cooling Standard Rating Details table). Currently, the standard ratings are only calculated and output for Packaged VAV cooling coils with air-cooled condensers and variable-air-volume fans. If the two-speed DX coling coil is specified with an evaporatively-cooled condenser or along with a constant volume fan, then no standard ratings are output from EnergyPlus at this time.

The standard rating cooling capacity is calculated as follows:

<div>$$\begin{array}{l}{{\dot Q}_{StandardRating}} = \,\,{{\dot Q}_{Total,Rated}}\left( {TotCapTempModFa{c_{Rated}}} \right)\left( {TotCapFlowModFa{c_{Rated}}} \right)\,\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, - \,\left( {FanHeatCorrection} \right)\end{array}$$</div>

where,

<span>${\dot Q_{StandardRating}}$</span> = Standard Rating (Net) Cooling Capacity (W)

<span>${\dot Q_{Total,Rated}}$</span> = Rated Total (Gross) Cooling Capacity, user input (W)

<span>$TotCapTempModFa{c_{Rated}}$</span>= Total Cooling Capacity Function of Temperature Curve evaluated with 19.4°C wet-bulb temperature air entering the cooling coil and 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

<span>$TotCapFlowModFa{c_{Rated}}$</span>= Total Cooling Capacity Function of Flow Fraction Curve evaluated at a flow fraction of 1.0 (dimensionless)

<span>$FanHeatCorrection$</span>= The rate that air is heated by the supply fan ( W )



<span>$FanHeatCorrection$</span> is calculated in one of two ways depending on the user’s input for the field called Unit Internal Static Air Pressure.  If this field was left blank then the fan heat is calculated using

<div>$$FanHeatCorrection = {\dot V_{RatedHighSpeed}}*773.3$$</div>

where

<span>${\dot V_{RatedHighSpeed}}$</span>= Rated Air Volume Flow Rate at high speed, user input (m<sup>3</sup>/s)

The value of 773.3 W/(m<sup>3</sup>/s) (365 W/1000cfm) is specified by ANSI/AHRI 340/360 for indoor-coil-only units that are not provided with a supply fan.

If an internal static pressure is provided, then the fan heat is modeled by evaluating the full model for Fan:VariableVolume.  This is different that the ratings calculated for single-speed DX equipment which does not use data from an associated fan object.  The program detects the VAV fan associated with the two-speed coil and uses the input data for that fan but with a different total air pressure rise.  The total pressure is the sum of the internal pressure and the external pressure (i.e., pressure drop associated with ductwork and other devices external to the indoor fan/coil section). The test conditions in ANSI/AHRI Standard 340/360 vary the (minimum) external static pressure seen by the supply air fan based on the standard rating cooling capacity (see Table # 5 in ANSI/AHRI Standard 340/360).  For the part load test points the supply air flow is reduced and the external pressure varies with the square of the flow ratio (see Note 1 in Table # 6 in ANSI/AHRI Standard 340/360-2007 with Addenda 1 and 2). The entire VAV fan model in EnergyPlus is evaluated at the specified air flow rate and the total static pressure for rating and the fan heat is calculated using

<div>$$FanHeatCorrection = Enthalp{y_{leavingFan}} - Enthalp{y_{enteringFan}}$$</div>

Energy Efficiency Ratio (EER) is another standard rating (AHRI 2007), and it is defined as the ratio of the total cooling capacity to the total power input at any given set of rating conditions, expressed in W/W (or Btu/W-h). For this class of air-cooled DX cooling coils, EER is calculated at rated test conditions as follows:

<div>$$EE{R_{}} = \frac{{{{\dot Q}_{Standard\,Rating}}}}{{Powe{r_{Total,Rated}}}}$$</div>

<div>$$\begin{array}{l}Powe{r_{Total,Rated}} = \left( {{{\dot Q}_{Total,Rated}}(TotCapTempModFa{c_{Rated}})(TotCapFlowModFa{c_{Rated}})} \right)\, \cdot EI{R_{Rated}}\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + \,\,\left( {FanPowerCorrection} \right)\end{array}$$</div>

<div>$$EI{R_{Rated}} = \left( {\frac{1}{{CO{P_{Rated}}}}} \right)(EIRTempModFa{c_{Rated}})(EIRFlowModFa{c_{Rated}})$$</div>

where,

*EER*  = Energy Efficiency Ratio (W/W)

<span>$Powe{r_{Total,Rated}}$</span>= Total electric power (compressors, condenser fans and evaporator fan) with 19.4°C wet-bulb temperature air entering the cooling coil, 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser, and air flow rate across the evaporator at the rated high speed air flow rate. Similar to the fan heat correction, the fan power correction is calculated in one of two ways depending on the input for internal static pressure.  If no internal static is provided, fan power is calculated using:

<div>$$FanPowerCorrection = {\dot V_{RatedHighSpeed}}*773.3$$</div>

If the internal static pressure is provided, then the entire VAV fan model in EnergyPlus is evaluated at the rated high speed air flow rate and the total static pressure for rating and the then the fan power calculated by the fan model is used for the fan power correction.

<span>$TotCapTempModFa{c_{Rated}}$</span> = Total Cooling Capacity Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

<span>$EIRTempModFa{c_{Rated}}$</span> = Energy Input Ratio Function of Temperature Curve evaluated with 19.44°C wet-bulb temperature air entering the cooling coil and 35.0°C dry-bulb temperature air entering the air-cooled (outdoor) condenser (dimensionless)

The Integrated Energy Efficiency Ratio (IEER) is intended to be a measure of merit for the cooling coil’s part-load efficiency. IEER replaced Integrated Part-Load Value (IPLV) as the part-load performance metric in Std. 340/360 as of January 1, 2010. Full details regarding the IEER calculation are available in ANSI/AHRI Std. 340/360 (AHRI 2007). A summary of the IEER calculations made by EnergyPlus for two-speed air-cooled DX cooling coils is provided below:

<div>$$IEER = \,(0.02 \cdot EE{R_A}) + (0.617 \cdot EE{R_B}) + (0.238 \cdot EE{R_C}) + (0.125 \cdot EE{R_D})$$</div>

where,

<span>$EE{R_A}$</span> =     *EER* at 100% net capacity at AHRI standard rating conditions (same as EER calculation shown above but in Btu/h)

<span>$EE{R_B}$</span> =     *EER* at 75% net capacity and reduced outdoor air temperature Btu/h

<span>$EE{R_C}$</span> =     *EER* at 50% net capacity and reduced outdoor air temperature Btu/h

<span>$EE{R_D}$</span>=      *EER* at 25% net capacity and reduced outdoor air temperature Btu/h

The following table summarizes the test points.

Table 58.  Test points for Two-Speed DX Coil Ratings

Point

Net Capacity

Coil inlet wetblub

Coil inlet dryblub

Condenser inlet dryblub

Supply air flow rate

A

100%

19.4C

26.7C

35.0C

Rated High speed flow rate

B

75%

19.4C

26.7C

27.5C

Regula falsi result where coil leaving dryblub matches Point A

C

50%

19.4C

26.7C

20.0C

D

25%

19.4C

26.7C

18.3C

The units are assumed to be VAV and Standard 340/360 is be applied as for VAV indoor supply fan.  Because the standard stipulates “the airflow rate at part load should be adjusted to maintain the full load measured leaving dry-bulb temperature,” the part load rating test points “B”, “C”, and “D” are evaluated by using the entire DX coil model calculations to obtain the supply air conditions leaving the coil and iterating on supply air flow rate to find the supply air flow rate.  The numerical method called Regula Falsi is used to find the supply flow rate at each of the part load test points.  Once the supply air flow rate is known, the two-speed DX coil model results are used to determine EER at the part load test points.

When evaluating the two-speed DX coil model, the speed ratio and cycling ratio are specified based on the desired or target net capacity.  When the low speed net capacity is lower than the target part load net capacity, the speed ratio is calculated using

<div>$$SpeedRatio = \frac{{DesiredNetCapacity - LowSpeedNetCapacity}}{{HighSpeedNetCapacity - LowSpeedNetCapacity}}$$</div>

When the low speed net capacity is higher than a target part load net capacity then the unit must cycle to meet the lower load.  The speed ratio is then set to 0.0 (minimum unloading) and the cycling ratio is calculated using

<div>$$CyclingRatio = \frac{{DesiredNetCapacity}}{{LowSpeedNetCapacity}}$$</div>

The results for EER, COP, and supply air mass flow rate at the part load test points are reported to the EIO file and a predefined table report called VAV DX Cooling Standard Rating Details.

#### References

See the references for the single speed DX cooling coil earlier in this document.

### Variable Speed DX Cooling Coil

#### Overview

The Coil:Cooling:DX:VariableSpeed object will simulate the performance of a DX cooling coil used in combination with a variable-speed unitary air conditioner and air-to-air heat pump. It fits into the parent objects of AirLoopHVAC:UnitaryHeatCool, ZoneHVAC:PackagedTerminalAirConditioner, AirLoopHVAC:UnitaryHeatPump:AirToAir and ZoneHVAC:PackagedTerminalHeatPump, etc.

The rated conditions for obtaining the capacities, COPs and SHR  are indoor dry-bulb temperature at 26.67 ˚C (80 ˚F), wet bulb temperature at 19.44 ˚C (67 ˚F),  and the source side entering air temperature at 35 ˚C (95 ˚F).

Variable-speed cooling coils lead to varied dehumidification behaviors, that the Bypass Factor (BF) is not only dependent on the indoor air flow rate, but also on the refrigerant mass flow rate, i.e. the compressor speed. The methods of calculating Bypass factor and Sensible Heat Transfer Ratio at each speed are the same as the water source variable-speed cooling coil (object name Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit).

#### Model Description

The Coil:Cooling:DX:VariableSpeed object is modeled in a manner similar to Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit. Of course, rather than referencing a water-cooled condenser, the new coil object references to outdoor air-cooled condenser, and has the air entering temperature in place of the condenser water entering temperature.

It shall be noted for the total cooling capacity and flow rate inputs, two fields are autosizable, which are Rated Total Cooling Capacity at Selected Nominal Speed Level and Rated Volumetric Air Flow Rate at Selected Nominal Speed Level. They are used to scale the performances of an actual unit and correlate with the actual loop flow. Except the two fields, all other total cooling capacity and flow rate inputs at individual speed levels should be directly obtained from Reference Unit catalog.

The Rated Total Cooling Capacity at Selected Nominal Speed Level contains the rated total cooling capacity to match the building sensible or latent cooling load.  The rated cooling capacity is used to determine a capacity scaling factor, as compared to the Reference Unit catalog capacity at the nominal speed level.

<div>$${\rm{CapacityScaleFactor}} = \frac{{{\rm{RatedTotalCoolingCapacity}}}}{{{\rm{ReferenceUnitTotalCoolingCapacity}}@{\rm{NominalSpeedLevel}}}}$$</div>

And then, this scaling factor is used to determine capacities at rated condition for other speed levels, as below,

<div>$${\rm{RatedTotalCoolingCapacity}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right) = {\rm{CapacityScaleFactor}} \times {\rm{ReferenceUnitTotalCoolingCapacity}}@{\rm{SpeedLevel}}({\rm{x}})$$</div>

The Rated Volumetric Air Flow Rate is used to determine an internal scaling factor, and calculate the air flow rates in the parent objects, as follows:

<div>$${\rm{AirFlowScaleFactor}} = \frac{{{\rm{RatedVolumetricAirFlowRate}}}}{{{\rm{ReferenceUnitVolAirFlowRate}}@{\rm{NominalSpeedLevel}} \times {\rm{CapacityScaleFactor}}}}$$</div>

And the loop volumetric air flow rates in the parent objects are calculated as below,

<div>$${\rm{LoopVolumetricAirFlowRate}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right) = {\rm{AirFlowScaleFactor}} \times {\rm{ReferenceUnitVolAirFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) \times {\rm{CapacityScaleFactor}}$$</div>

If the volumetric air flow rate at one speed level is higher than the flow rate allowed by the fan in the parent object, the flow rate will be set back to the fan flow rate.

If <span>${\rm{AirFlowScaleFactor}}$</span> equals to unity, the loop air flow rate become the design flow rates of the original unit (after scaled by the rated total cooling capacity). The Rated Volumetric Air Flow Rate is introduced here to correlate with the actual flow rate in the air loop, in case that these differ from the design specifications. Certainly, it is recommended that the Rated Volumetric Air Flow Rate is selected in the way that <span>${\rm{AirFlowScaleFactor}}$</span> is unity, so as to get more accurate results from the performance curves.

If the condenser is evaporatively cooled, it is necessary to know the condenser air flow rate, so as to calculate the water evaporation rate. We will have fields for specifying the Reference Unit condenser volumetric air flow rates at individual speed levels, and these inputs are optional. If the condenser air flow rates are not inputted by the user, default values of condenser volumetric air flow rate as a function of the rated total cooling capacity will be used. Condenser air flow rates of the simulated unit are calculated as below,

<div>$$\begin{array}{l}{\rm{CondenserVolumetricAirFlowRate}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right) = \\\quad \quad {\rm{ReferenceUnitCondenserVolAirFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) \times \\\quad \quad \quad {\rm{CapacityScaleFactor}}\end{array}$$</div>

#### Performance Curves:

This object includes 4 curve objects at each individual speed level.

1)  Total cooling capacity modifier curve (function of temperature)

2)  Total cooling capacity modifier curve (function of air flow fraction)

3)  Energy input ratio (EIR) modifier curve (function of temperature)

4)  Energy input ratio (EIR) modifier curve (function of air flow fraction)

The flow fraction modifier curves are used as a placeholder, to account for off-design flow rates if needed. If the manufacturer doesn’t provide the off-design performances, we can simply use a default modification multiplier of 1.0.

At the lowest speed, there will be one additional performance curve to correlate the part-load condition, i.e.

5) Part load fraction correlation (function of part load ratio)

1)     Total cooling capacity modifier curve (function of temperature)

The total cooling capacity modifier as a function of temperature curve (CAP-FT) is a biquadratic curve with two independent variables: wet-bulb temperature of the air entering the cooling coil and the condenser entering air temperature. The output of this curve is multiplied by the rated total cooling capacity at the speed, to give the total cooling capacity at the specific entering air WB and condenser inlet air DB at which the DX unit is operating (i.e., at temperatures different from the rating point temperatures).

Note: The data used to develop the total cooling capacity modifier curve (function of temperature) should represent performance when the cooling coil is ‘wet’ (i.e., coil providing sensible cooling and at least some dehumidification). Performance data when the cooling coil is ‘dry’ (i.e., not providing any dehumidification) should not be included when developing this modifier curve. This model automatically detects and adjusts for ‘dry coil’ conditions.

<div>$${\rm{TotCapTempModFac}} = {\rm{a}} + {\rm{b*W}}{{\rm{B}}_{\rm{i}}} + {\rm{c*WB}}_{\rm{i}}^2 + {\rm{d*D}}{{\rm{B}}_{\rm{o}}} + {\rm{e*D}}{{\rm{B}}_{\rm{o}}}^2 + {\rm{f*W}}{{\rm{B}}_{\rm{i}}}{\rm{*D}}{{\rm{B}}_{\rm{o}}}$$</div>

where

WB<sub>i</sub> = wet-bulb temperature of the air entering the indoor cooling coil, °C

DB<sub>o</sub> = dry-bulb temperature of the air entering the condenser coil, °C

a-f = regression curve-fit coefficients.

2)     Total cooling capacity modifier curve (function of air flow fraction)

The total cooling capacity modifier curve (function of air flow fraction) is a cubic curve with the independent variable being the ratio of the actual air flow rate across the cooling coil to the design air flow rate (i.e., fraction of design flow at the speed).

<div>$${\rm{TotCapAirFlowModFac}} = {\rm{a}} + {\rm{b*f}}{{\rm{f}}_{\rm{a}}} + {\rm{c*ff}}_{\rm{a}}^2 + {\rm{d*ff}}_{\rm{a}}^3$$</div>

where

ff<sub>a</sub> = actual air mass flow rate/design air mass flow rate, at one speed level.

          <span>$\begin{array}{l}{\rm{DesignAirMassFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) = {\rm{}}\\\quad \quad \quad {\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) \times {\rm{CapacityScaleFactor}}\end{array}$</span>

a-d = regression curve fit coefficients, if no data for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

3) Energy input ratio (EIR) modifier curve (function of temperature)

The energy input ratio modifier curve as a function of temperature (EIR-FT) is a biquadratic curve with two independent variables: wet-bulb temperature of the air entering the cooling coil and the condenser entering air temperature. The output of this curve is multiplied by the rated EIR (inverse of the rated COP) at the speed level, to give the EIR at the specific entering air temperatures at which the DX unit is operating (i.e., at temperatures different from the rating point temperatures).

<div>$${\rm{EIRTempModFac}} = {\rm{a}} + {\rm{b*W}}{{\rm{B}}_{\rm{i}}} + {\rm{c*WB}}_{\rm{i}}^2 + {\rm{d*D}}{{\rm{B}}_{\rm{o}}} + {\rm{e*D}}{{\rm{B}}_{\rm{o}}}^2 + {\rm{f*W}}{{\rm{B}}_{\rm{i}}}{\rm{*D}}{{\rm{B}}_{\rm{o}}}$$</div>

where

a-f = regression curve fit coefficients

4) Energy input ratio (EIR) modifier curve (function of air flow fraction)

<div>$${\rm{EIRAirFlowModFac}} = {\rm{a}} + {\rm{b*f}}{{\rm{f}}_{\rm{a}}} + {\rm{c*ff}}_{\rm{a}}^2 + {\rm{d*ff}}_{\rm{a}}^3$$</div>

where

a-d = regression curve fit coefficients, if no data available for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

5) Part load fraction correlation (function of part load ratio)

This field defines the name of a quadratic or cubic performance curve (Ref: Performance Curves) that parameterizes the variation of electrical power input to the unit as a function of the part load ratio (PLR, Sensible or Latent Load/Steady-State Sensible or Latent Capacity  for Speed 1). The description of the part load fraction correlation for the variable-speed DX cooling coil is similar to the variable-speed DX heating coil.

#### Lowest Speed Operation:

The lowest speed operation of the variable-speed DX cooling coil is similar to the single speed DX cooling coil. The total (gross) cooling capacity of the variable-speed DX coil is calculated as follows:

<div>$$\begin{array}{l}{{\rm{Q}}_{{\rm{total}},1}} = {\rm{RatedTotalCoolingCapacity}}@{\rm{SpeedLevel}}\left( 1 \right){\rm{*}}\\\quad \quad {\rm{TotCapTempModFa}}{{\rm{c}}_1}{\rm{*TotCapAirFlowModFa}}{{\rm{c}}_1}\end{array}$$</div>

And the EIR is calculated as:

<div>$${\rm{EI}}{{\rm{R}}_1} = \frac{{1.0}}{{{\rm{ReferenceUnitCOP}}@{\rm{Speed}}(1)}}{\rm{EIRTempModFa}}{{\rm{c}}_1}{\rm{*EIRAirFlowModFa}}{{\rm{c}}_1}$$</div>

And the power consumption excluding the indoor fan is,

<div>$${\rm{Powe}}{{\rm{r}}_1} = {{\rm{Q}}_{{\rm{total}},1}}{\rm{*EI}}{{\rm{R}}_1}{\rm{*RTF}}$$</div>

At the lowest speed, the dehumidification calculation is exactly the same as the single speed DX coil. That is to use the rated SHR and the design air flow rate at the lowest speed to calculate rated bypass factor of BF<sub>rated,1</sub>, and the corresponding effective surface area of A<sub>o,1</sub>. With A<sub>o,1</sub><sub></sub>known, the coil BF can be adjusted for non-rated air flow rates.

And the part load ratio for sensible cooling is,

<div>$${\rm{PLR}} = {\rm{SensibleCoolingLoad}}/({{\rm{Q}}_{{\rm{total}},1}}{\rm{*SH}}{{\rm{R}}_1})$$</div>

For latent cooling,

<div>$${\rm{PLR}} = {\rm{LatentCoolingLoad}}/[{{\rm{Q}}_{{\rm{total}},1}}{\rm{*}}(1.0 - {\rm{SH}}{{\rm{R}}_1})]$$</div>

#### Higher Speed Operation:

At the speed level between the lowest and the highest, there is no part-load loss. A parameter of speed ratio (SpeedRatio) is used to define the capacity partition between Speed x-1 and Speed x.

The design air flow rate at the speed ratio are given as following:

<div>$$\begin{array}{l}{\rm{DesignAirFlowRateSpeedRatio}} = {\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}\left( {{\rm{x}} - 1} \right){\rm{*}}\\\quad \quad \quad {\rm{CapacityScaleFactor*}}\left( {1{\rm{}}--{\rm{SpeedRatio}}} \right) + \\\quad \quad {\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right){\rm{*}}\\\quad \quad \quad {\rm{CapacityScaleFactor*SpeedRatio}}\end{array}$$</div>

And the fraction of air flow is given:

<span>${\rm{f}}{{\rm{f}}_{{\rm{a}},{\rm{x}} - 1}}$</span>=<span>${\rm{f}}{{\rm{f}}_{{\rm{a}},{\rm{x}}}}$</span>= actual air mass flow rate/DesignAirFlowRateSpeedRatio

The total cooling capacities and EIRs at Speed x-1 and Speed x are calculated:

<div>$$\begin{array}{l}{{\rm{Q}}_{{\rm{total}},{\rm{x}} - 1}} = {\rm{RatedTotalCoolingCapacity}}@{\rm{SpeedLevel}}\left( {{\rm{x}} - 1} \right){\rm{*}}\\\quad \quad \quad {\rm{TotCapTempModFa}}{{\rm{c}}_{{\rm{x}} - 1}}{\rm{*TotCapAirFlowModFa}}{{\rm{c}}_{{\rm{x}} - 1}}\end{array}$$</div>

<div>$$\begin{array}{l}{{\rm{Q}}_{{\rm{total}},{\rm{x}}}} = {\rm{RatedTotalCoolingCapacity}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right){\rm{*}}\\\quad \quad \quad {\rm{TotCapTempModFa}}{{\rm{c}}_{\rm{x}}}{\rm{*TotCapAirFlowModFa}}{{\rm{c}}_{\rm{x}}}\end{array}$$</div>

<div>$${\rm{EI}}{{\rm{R}}_{{\rm{x}} - 1}} = \frac{{1.0}}{{{\rm{ReferenceUnitCOP}}@{\rm{Speed}}({\rm{x}} - 1)}}{\rm{EIRTempModFa}}{{\rm{c}}_{{\rm{x}} - 1}}{\rm{*EIRAirFlowModFa}}{{\rm{c}}_{{\rm{x}} - 1}}$$</div>

<div>$${\rm{EI}}{{\rm{R}}_{\rm{x}}} = \frac{{1.0}}{{{\rm{ReferenceUnitCOP}}@{\rm{Speed}}\left( {\rm{x}} \right)}}{\rm{EIRTempModFa}}{{\rm{c}}_{\rm{x}}}{\rm{*EIRAirFlowModFa}}{{\rm{c}}_{\rm{x}}}$$</div>

The total cooling capacity at the corresponding speed ratio is:

<div>$${{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}} = \left( {1.0 - {\rm{SpeedRatio}}} \right){\rm{*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}} - 1}} + {\rm{SpeedRatio*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}}}}$$</div>

And the power consumption, excluding the indoor fan, is

<div>$${\rm{Powe}}{{\rm{r}}_{{\rm{SpeedRatio}}}} = \left( {1.0 - {\rm{SpeedRatio}}} \right){\rm{*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}} - 1}}{\rm{*EI}}{{\rm{R}}_{{\rm{x}} - 1}} + {\rm{SpeedRatio*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}}}}{\rm{*EI}}{{\rm{R}}_{\rm{x}}}$$</div>

And the net heat discharged from the condenser:

<div>$${{\rm{Q}}_{{\rm{cond}},{\rm{SpeedRatio}}}} = {\rm{Powe}}{{\rm{r}}_{{\rm{SpeedRatio}}}} + {{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}}$$</div>

And the effective surface area in the correlations of BF factor is calculated as below:

<div>$${{\rm{A}}_{{\rm{o}},{\rm{SpeedRatio}}}} = \left( {1 - {\rm{SpeedRatio}}} \right){\rm{*}}{{\rm{A}}_{{\rm{o}},{\rm{x}} - 1}} + {\rm{SpeedRatio*}}{{\rm{A}}_{{\rm{o}},{\rm{x}}}}$$</div>

Using A<sub>o,SpeedRatio</sub> in the same BF and SHR calculation procedure as the single speed DX cooling coil, we can get BF<sub>SpeedRatio</sub>, and SHR<sub>SpeedRatio</sub>. And the sensible cooling capacity is calculated:

<div>$${{\rm{Q}}_{{\rm{sensible}},{\rm{SpeedRatio}}}} = {{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}}{\rm{*SH}}{{\rm{R}}_{{\rm{SpeedRatio}}}}$$</div>

If the variable-speed DX cooling coil used to match the sensible cooling load,

<div>$${{\rm{Q}}_{{\rm{sensible}},{\rm{SpeedRatio}}}} = {\rm{SensibleLoad}}$$</div>

If it intends to match the latent cooling load,

<div>$${{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}}{\rm{*}}\left( {1.0 - {\rm{SH}}{{\rm{R}}_{{\rm{SpeedRatio}}}}} \right) = {\rm{LatentLoad}}$$</div>

If the speed reaches the highest level, the speed ratio becomes 1.0, and Speed n represents the highest speed.

#### Evaporatively Cooled Condenser:

If using evaporative pre-cooling pad upstream of the condenser, the user must also enter the appropriate evaporative effectiveness for the media at each compressor speed, so as to correlate variation of the effectiveness as a function of compressor speed, i.e. the variation of condenser air flow rate. The evaporative effectiveness is interpolated between speed levels, i.e.

<div>$${\rm{Effectivenes}}{{\rm{s}}_{{\rm{SpeedRatio}}}} = \left( {1.0 - {\rm{SpeedRatio}}} \right){\rm{*Effectivenes}}{{\rm{s}}_{{\rm{x}} - 1}} + {\rm{SpeedRatio*Effectivenes}}{{\rm{s}}_{\rm{x}}}$$</div>

The interpolated effectiveness at the speed ratio is used to calculate the air temperature reduction across the evaporative cooling pad, and the decreased air temperature entering the condenser coil is used in place of the ambient temperature, i.e.

<div>$${{\rm{T}}_{{\rm{c}},{\rm{i}}}} = {{\rm{T}}_{{\rm{wb}},{\rm{o}}}} + (1.0 - {\rm{Effectivenes}}{{\rm{s}}_{{\rm{SpeedRatio}}}}){\rm{*}}({{\rm{T}}_{{\rm{db}},{\rm{o}}}} - {{\rm{T}}_{{\rm{wb}},{\rm{o}}}})$$</div>

Where

<span>${{\rm{T}}_{{\rm{c}},{\rm{i}}}}$</span> is the condenser entering air temperature, °C.

<span>${{\rm{T}}_{{\rm{wb}},{\rm{o}}}}$</span> is the outdoor air wet bulb temperature, °C.

<span>${{\rm{T}}_{{\rm{db}},{\rm{o}}}}$</span> is the outdoor air dry bulb temperature, °C.

And the water consumption rate is calculated based on the interpolated condenser air flow rate at the speed ratio, i.e. the condenser flow rate at the speed ratio,

<div>$${\dot m_{condair,{\rm{}}SpeedRatio}} = \left( {1.0 - SpeedRatio} \right){\rm{*}}{\dot m_{condair,{\rm{}}x - 1}} + SpeedRatio{\rm{*}}{\dot m_{condair,{\rm{}}x}}$$</div>

### Electric Air Heating Coil

The electric air heating coil (object name: Coil:Heating:Electric) is a simple capacity model with a user-input efficiency.  In many cases, this efficiency for the electric coil will be 100%.  This coil only has air nodes to connect it in the system.  The coil can be used in the air loop simulation or in the zone equipment as a reheat coil.  Depending on where it is used determines if this coil is temperature or capacity controlled.  If used in the air loop simulation it will be controlled to a specified temperature on the setpoint node by the SetpointManager.  If it is used in zone equipment, it will be controlled from the zone thermostat by meeting the zone demand.  See Input Output Reference for additional information.

For a coil that is controlled to meet the zone demand and will meet the capacity necessary for that zone unless it exceeds the capacity of the coil specified by the user.

  ! Control output to meet load QCoilReq

  IF((AirMassFlow .GT. 0.0 .AND. HeatingCoil(CoilNum)%NominalCapacity &gt; 0.0) .and. &

     (GetCurrentScheduleValue(HeatingCoil(CoilNum)%SchedPtr) .gt. 0.0) .and. &

     (QCoilReq .gt. 0.0) .and. (TempSetPoint == 0.0)) THEN

      !check to see if the Required heating capacity is greater than the user! specified capacity.

      IF(QCoilReq &gt; HeatingCoil(CoilNum)%NominalCapacity) Then

        QCoilCap = HeatingCoil(CoilNum)%NominalCapacity

      Else

        QCoilCap = QCoilReq

      End IF



      TempAirOut=TempAirIn + QCoilCap/CapacitanceAir

      HeatingCoilLoad = QCoilCap



     !The HeatingCoilLoad is the change in the enthalpy of the Heating

      HeatingCoil(CoilNum)%ElecUseLoad = HeatingCoilLoad/Effic

For a temperature setpoint coil the delta temperature from the coil inlet temperature to the setpoint is determined and the capacity of the coil is calculated and is met if less than the user specified capacity.

   ! Control coil output to meet a setpoint temperature.

   Else IF((AirMassFlow .GT. 0.0 .AND. HeatingCoil(CoilNum)%NominalCapacity &gt; 0.0) .and. &

     (GetCurrentScheduleValue(HeatingCoil(CoilNum)%SchedPtr) .gt. 0.0) .and. &

     (QCoilReq == 0.0) .and. &

     (ABS(TempSetPoint-TempAirIn) .gt. TempControlTol) ) THEN

      QCoilCap = CapacitanceAir\*(TempSetPoint - TempAirIn)

      ! check to see if setpoint above enetering temperature. If not, set

      ! output to zero.

      IF(QCoilCap .LE. 0.0) THEN

        QCoilCap = 0.0

        TempAirOut = TempAirIn

      !check to see if the Required heating capacity is greater than the user

      ! specified capacity.

      Else IF(QCoilCap &gt; HeatingCoil(CoilNum)%NominalCapacity) Then

        QCoilCap = HeatingCoil(CoilNum)%NominalCapacity

        TempAirOut=TempAirIn + QCoilCap/CapacitanceAir

      Else

        TempAirOut = TempSetPoint

      End IF



      HeatingCoilLoad = QCoilCap



     !The HeatingCoilLoad is the change in the enthalpy of the Heating

      HeatingCoil(CoilNum)%ElecUseLoad = HeatingCoilLoad/Effic

### Gas Air Heating Coil

The gas-powered heating coil (object name: Coil:Heating:Gas) is a simple capacity model with user inputted gas burner efficiency.  The default for the gas burner efficiency is 80%.  This coil only has air nodes to connect it in the system.  The coil can be used in the air loop simulation or in the zone equipment as a reheat coil.  Depending on where it is used determines if this coil is temperature or capacity controlled.  If used in the air loop simulation it will be controlled to a specified temperature scheduled from the SetpointManager.  If it is used in zone equipment, it will be controlled from the zone thermostat by meeting the zone demand.  The gas coil has additional features that can add a part load correction and a parasitic gas or electric load.

The parasitic electric load associated with the gas coil operation, such as an inducer fan, etc.  This will be modified by the PLR (or coil runtime fraction if a part-load fraction correlation is provided in the next input field) to reflect the time of operation in a simulation time step.

The parasitic gas load associated with the gas coil’s operation (Watts), such as a standing pilot light.  The model assumes that this parasitic load is consumed only for the portion of the simulation time step where the gas heating coil is not operating.

#### Field: Part Load Fraction Correlation (function of part load ratio)

The part load correction defines the name of a quadratic or cubic performance curve (Ref: Performance Curves) that parameterizes the variation of gas consumption rate by the heating coil as a function of the part load ratio (PLR, sensible heating load/nominal capacity of the heating coil).  For any simulation time step, the nominal gas consumption rate (heating load/burner efficiency) is divided by the part-load fraction (PLF) if a part-load curve has been defined.  The part-load curve accounts for efficiency losses due to transient coil operation.

The part-load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the heating coil runs continuously for the simulation time step).  For PLR values between 0 and 1 ( 0 &lt;= PLR &lt; 1), the following rules apply:

**PLF &gt;= 0.7   and   PLF &gt;= PLR**

If PLF &lt; 0.7 a warning message is issued, the program resets the PLF value to 0.7, and the simulation proceeds.  The runtime fraction of the heating coil is defined a PLR/PLF. If PLF &lt; PLR, then a warning message is issues and the runtime fraction of the coil is limited to 1.0.

A typical part load fraction correlation for a conventional gas heating coil (e.g., residential furnace) would be:

<div>$$PLF = 0.8 + 0.2\cdot PLR$$</div>

For a better understanding of how the coil meets the temperature setpoint in the air loop or the zone demand as zone equipment, see Coil:Electric:Heating for additional information.  Also see Input Output Reference for additional input information.

### Multi-Stage Electric and Gas Air Heating Coil

#### Overview

These models (object names Coil:Heating:Electric:MultiStage and Coil:Heating:Gas:MultiStage) simulate the performance of multi stage electric and gas heating systems with two to four discrete air flow stages. Each stage has a set of user inputted gas burner efficiency, Nominal capacity, and Parasitic electric load (for gas coil only). The full load supply airflow rate is dependent on the stage number and is set by its parent object (Ref: AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed). The part-load impact on coil energy use is automatically applied to the lowest stage.

When the model determines performance at Stage 1 (the lowest stage) or cycling between OFF and Stage 1, its performance is almost the same as the performance for the Coil:Heating:Electric and  Coil:Heating:Gas models. However, the outlet conditions are calculated slightly differently. Therefore, the Coil:Heating:Electric and  Coil:Heating:Gas model may be considered as subsets of the multistage model described here. When the multistage coil model determines performance at higher stages (above 1), the model linearly interpolates the performance at two consecutive stages (n-1 and n) as needed to meet the heating load, with the fraction of time at each speed established by the speed ratio. For the time being, this coil model can only be called by the parent object AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed.

#### Model Inputs

The model inputs are also very similar to the inputs of the Coil:Heating:Electric and  Coil:Heating:Gas objects. The main difference is that this multistage model requires a set of fields at each speed, such as nominal capacity, and efficiency.

#### Stage 1 Operation

The following procedure provides the detailed description of the exception.

n Total delivered heating capacity

The total delivered heating capacity for Stage 1 operating at the cycling ratio needed to meet the requested heating load is:

<div>$${Q_{coil,cycling}} = {\mathop m\limits^\cdot_{Speed\,1}}\left( {CycRatio} \right)({h_{inlet}} - {h_{outlet,full}})$$</div>

where,

*Q<sub>coil,cycling</sub>*      = delivered sensible heating capacity for Stage 1 operating at a specific cycling ratio [W]

<span>${\mathop m\limits^\cdot_{Speed\,\,1}}$</span>      = air mass flow rate through heating coil at Speed 1 as set by the parent object [kg/s]

*h<sub>outlet,full</sub>*      = specific enthalpy of the coil outlet air during full-load operation at Stage 1 (no cycling) [J/kg]

*h<sub>inlet</sub>           *            = specific enthalpy of the coil inlet air [J/kg]

*CycRatio*    = cycling ratio at Stage 1, ratio of requested heating load to the full-load capacity of the coil at Stage 1 [dimensionless]

It is assumed that the coil provides no heating capacity when the coil is OFF, even if the supply air fan continues to operate.

n Outlet air specific enthalpy

The average specific enthalpy of the coil outlet air is then calculated based on the delivered sensible heating capacity and the average air mass flow rate entering the coil:

<div>$${h_{outlet,average}} = {h_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,cycling}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,cycling}}} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where,

*h<sub>outlet,average</sub>*  = average specific enthalpy at the coil outlet [J/kg]

<span>${\mathop m\limits^\cdot_{inlet}}$</span>         = mass flow rate at the inlet to the coil as established by the parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiStage, Mass Flow Rate Calculation). This flow rate is the average value determined by the parent object, accounting for the specified flow rate when the heating coil is ON and the specified flow rate when the heating coil is OFF for the time step being simulated.

n Outlet air temperature

The heating coil’s outlet air humidity ratio equals the inlet air humidity ratio since the coil does not change the moisture content of the air. So the average outlet air temperature is calculated based on the inlet air humidity ratio and the average outlet air enthalpy using the psychrometric function PsyTdbFnHW.

The main reason for using the above approach is that outlet air conditions are calculated in the same way for all operating Stages.

#### Higher Stage Operation

This section describes how higher Stage operation is simulated. When the required sensible load is less than the full load sensible capacity at Stage n (Stage Number &gt; 1), the following calculations are performed:

n Total delivered heating capacity at Stage n-1 and Stage n

<div>$$TotCa{p_{n - 1}} = MSNominalCa{p_{n - 1}}$$</div>

<div>$$TotCa{p_n} = MSNominalCa{p_n}$$</div>

where,

*TotCap<sub>i</sub>*<sub>           </sub> = total delivered heating capacity at given temperatures and flow rates at Stage i [W]

*MSNominalCap<sub>i</sub>*<sub>        </sub> = heating capacity at the rated conditions at Stage i [W]

i     = Stage n or Stage n-1

n Full load outlet air specific enthalpy at Stage n-1 and Stage n

<div>$${h_{outlet,full\_Speed\_n}} = {h_{inlet}} - (MSNominalCa{p_n}/{\mathop m\limits^._{inlet}})$$</div>

<div>$${h_{outlet,full\_Speede\_n - 1}} = {h_{inlet}} - (MSNominalCa{p_{n - 1}}/{\mathop m\limits^._{inlet}})$$</div>



where,

*h<sub>outlet,full\_Stage\_n</sub>*         = specific enthalpy of the coil outlet air during full-load operation at Stage n (no cycling) [J/kg]

*h<sub>outlet,full\_Stage\_n-1</sub>*       = specific enthalpy of the coil outlet air during full-load operation at Stage n-1 (no cycling) [J/kg]

n Effective total heating capacity

<div>$$\begin{array}{l}{Q_{coil,SpeedRatio}} = \left( {SpeedRatio} \right){\mathop m\limits^\cdot_{Speed\,n}}({h_{inlet}} - {h_{outlet,full\_Speed\,n}})\\\;\;\;\;\;\;\;\;\;\; + (1 - SpeedRatio){\mathop m\limits^\cdot_{Speed\,n - 1}}({h_{inlet}} - {h_{outlet,full\_Speed\,n - 1}})\end{array}$$</div>

where,

<span>${{Q_{coil,SpeedRatio}}}$</span><sub>                       </sub> = delivered sensible heating capacity at a given Stage ratio between two consecutive Stages [W]

<span>${\mathop {{\rm{ }}m}\limits_{Speed{\kern 1pt} n}^ \cdot  }$</span>      = air mass flow rate through heating coil at Stage n as set by the parent object [kg/s]

<span>${\mathop {{\rm{ }}m}\limits_{Speed{\kern 1pt} n - 1}^ \cdot  }$</span>    = air mass flow rate through heating coil at Stage 1 as set by the parent object [kg/s]



n Average outlet air enthalpy

<div>$${h_{outlet,average}} = {h_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,SpeedRatio}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,SpeedRatio}}} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where,

*h<sub>outlet,average</sub>*  = average specific enthalpy at the coil outlet [J/kg]

*h<sub>inlet</sub>           *            = specific enthalpy of the coil inlet air [J/kg]

<span>${\dot m_{inlet}}$</span>         = Mass flow rate at the inlet to the coil as established by the parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiStage, Mass Flow Rate Calculation). This flow rate is the average value determined by the parent object, accounting for the specified flow rate when the heating coil is at Stage n and the specified flow rate when the heating coil is at Stage n-1 for the time step being simulated.

n Average outlet air temperature

The heating coil’s outlet air humidity ratio equals the inlet air humidity ratio since the coil does not change the moisture content of the air. So the average outlet air temperature is calculated based on the inlet air humidity ratio and the average outlet air enthalpy using the psychrometric function PsyTdbFnHW.

n Full load energy inputs at Stage n-1 and Stage n

<div>$$HeatingPowe{r_n} = MSNominalCa{p_n}/MSEfficienc{y_n}$$</div>

<div>$$HeatingPowe{r_{n - 1}} = MSNominalCa{p_{n - 1}}/MSEfficienc{y_{n - 1}}$$</div>

where,

*MSEfficiency<sub>n</sub>*        = Efficiency at stage n

*MSEfficiency<sub>n-1</sub>*      = Efficiency at stage n-1

n Calculate combined energy input

<div>$$HeatingPower = HeatingPowe{r_n}\left( {SpeedRatio} \right) + HeatingPowe{r_{n - 1}}(1.0 - SpeedRatio)$$</div>

where,

HeatingPower          = Power used in Watt

### Single-Speed Electric Heat Pump DX Air Heating Coil

#### Overview

This model (object name Coil:Heating:DX:SingleSpeed) simulates the performance of an air-to-air direct expansion (DX) heating system. The model uses performance information at rated conditions along with curve fits for variations in total capacity, energy input ratio and part-load fraction to determine the performance of the unit at part-load conditions (DOE 1982).  Adjustment factors are applied to total capacity and input power to account for frost formation on the outdoor coil.

This model simulates the thermal performance of the indoor DX heating coil, and the power consumption of the outdoor unit (compressors, fans, crankcase heaters and defrost heaters). The performance of the indoor supply air fan varies widely from system to system depending on control strategy (e.g., constant fan vs. AUTO fan, constant air volume vs. variable air volume, etc.), fan type, fan motor efficiency and pressure losses through the air distribution system. Therefore, this DX system model does not account for the thermal effects or electric power consumption of the indoor supply air fan. EnergyPlus contains separate models for simulating the performance of various indoor fan configurations, and these models can be easily linked with the DX system model described here to simulate the entire DX system being considered (e.g., see AirLoopHVAC:UnitaryHeatPump:AirToAir).

#### Model Inputs

The user must input the total heating capacity, coefficient of performance (COP) and the volumetric airflow rate across the heating coil at rated conditions. The capacity and COP inputs should be “gross” values, excluding any thermal or energy impacts due to the indoor supply air fan. The rating condition is considered to be outdoor air at 8.33C dry-bulb and 6.11C wet-bulb temperatures (i.e., air entering the outdoor coil), with air entering the indoor DX heating coil at 21.11C dry-bulb and 15.55C wet-bulb temperatures. The rated volumetric air flow across the DX heating coil should be between 0.00004027 m<sup>3</sup>/s and 0.00006041 m<sup>3</sup>/s per watt of rated total heating capacity (300 – 450 cfm/ton).

Depending on the defrost strategy that is selected, the user must also input up to six performance curves that describe the change in total heating capacity and efficiency at part-load conditions, and efficiency during reverse-cycle defrosting:

n The total heating capacity modifier curve (function of temperature) can be a function of both the outdoor and indoor air dry-bulb temperature or only the outdoor air dry-bulb temperature. User has the choice of a bi-quadratic curve with two independent variables or a quadratic curve as well as a cubic curve with a single independent variable. The bi-quadratic curve is recommended if sufficient manufacturer data is available as it provides sensitivity to the indoor air dry-bulb temperature and a more realistic output. The output of this curve is multiplied by the rated total heating capacity to give the total heating capacity at specific temperature operating conditions (i.e., at an outdoor or indoor air temperature different from the rating point temperature).

<div>$$TotCapTempModFac = \,a + \,b\left( {{T_{db,o}}} \right)\,\, + \,\,c{\left( {{T_{db,o}}} \right)^2}$$</div>

or

<div>$$TotCapTempModFac = \,a + \,b\left( {{T_{db,o}}} \right)\,\, + \,\,c{\left( {{T_{db,o}}} \right)^2}\,\, + \,\,d{\left( {{T_{db,o}}} \right)^3}$$</div>

<div>$$TotCapTempModFac = \,a + \,b\left( {{T_{db,i}}} \right)\,\, + \,\,c{\left( {{T_{db,i}}} \right)^2}\,\, + \,\,d\left( {{T_{db,o}}} \right) + e{\left( {{T_{db,o}}} \right)^2} + f\left( {{T_{db,i}}} \right)\left( {{T_{db,o}}} \right)$$</div>

where

<span>${T_{db,i}}$</span>     = dry-bulb temperature of the air entering the indoor coil, °C

<span>${T_{db,o}}$</span>     = dry-bulb temperature of the air entering the outdoor coil, °C

n The total heating capacity modifier curve (function of flow fraction) is a quadratic or cubic curve with the independent variable being the ratio of the actual air flow rate across the heating coil to the rated air flow rate (i.e., fraction of full load flow). The output of this curve is multiplied by the rated total heating capacity and the total heating capacity modifier curve (function of temperature) to give the total heating capacity at the specific temperature and air flow conditions at which the coil is operating.

<div>$$TotCapFlowModFac = \,a + \,b\left( {ff} \right)\,\, + \,\,c{\left( {ff} \right)^2}$$</div>

or

<div>$$TotCapFlowModFac = \,a + \,b\left( {ff} \right)\,\, + \,\,c{\left( {ff} \right)^2}\,\, + \,\,d{\left( {ff} \right)^3}$$</div>

where

<div>$$ff = flow{\rm{ }}fraction = \left( {\frac{{Actual{\rm{ }}air{\rm{ }}mass{\rm{ }}flow{\rm{ }}rate}}{{Rated{\rm{ }}air{\rm{ }}mass{\rm{ }}flow{\rm{ }}rate}}} \right)$$</div>

**Note:**  The actual volumetric airflow rate through the heating coil for any simulation time step where the DX unit is operating should be between 0.00002684 m<sup>3</sup>/s and .00008056 m<sup>3</sup>/s per watt of rated total heating capacity (200 - 600 cfm/ton). The simulation will issue a warning message if this airflow range is exceeded.

n The energy input ratio (EIR) modifier curve (function of temperature) can be a function of both the outdoor and indoor air dry-bulb temperature or only the outdoor air dry-bulb temperature. User has the choice of a bi-quadratic curve with two independent variables or a quadratic curve as well as a cubic curve with a single independent variable. The bi-quadratic curve is recommended if sufficient manufacturer data is available as it provides sensitivity to the indoor air dry-bulb temperature and a more realistic output. The output of this curve is multiplied by the rated EIR (inverse of the rated COP) to give the EIR at specific temperature operating conditions (i.e., at an outdoor or indoor air temperature different from the rating point temperature).

<div>$$EIRTempModFac = \,a + \,b\left( {{T_{db,o}}} \right)\,\, + \,\,c{\left( {{T_{db,o}}} \right)^2}$$</div>

or

<div>$$EIRTempModFac = \,a + \,b\left( {{T_{db,o}}} \right)\,\, + \,\,c{\left( {{T_{db,o}}} \right)^2}\,\, + \,\,d{\left( {{T_{db,o}}} \right)^3}$$</div>

or

<div>$$EIRTempModFac = \,a + \,b\left( {{T_{db,i}}} \right)\,\, + \,\,c{\left( {{T_{db,i}}} \right)^2}\,\, + \,\,d\left( {{T_{db,o}}} \right) + e{\left( {{T_{db,o}}} \right)^2} + f\left( {{T_{db,i}}} \right)\left( {{T_{db,o}}} \right)$$</div>

n The energy input ratio (EIR) modifier curve (function of flow fraction) is a quadratic or cubic curve with the independent variable being the ratio of the actual air flow rate across the heating coil to the rated air flow rate (i.e., fraction of full load flow). The output of this curve is multiplied by the rated EIR (inverse of the rated COP) and the EIR modifier curve (function of temperature) to give the EIR at the specific temperature and air flow conditions at which the coil is operating.

<div>$$EIRFlowModFac = \,a + \,b\left( {ff} \right)\,\, + \,\,c{\left( {ff} \right)^2}$$</div>

or

<div>$$EIRFlowModFac = \,a + \,b\left( {ff} \right)\,\, + \,\,c{\left( {ff} \right)^2}\, + \,\,d{\left( {ff} \right)^3}$$</div>

n The part-load fraction correlation (function of part-load ratio) is a quadratic or cubic curve with the independent variable being part-load ratio (sensible heating load / steady-state heating capacity). The output of this curve is used in combination with the rated EIR and EIR modifier curves to give the “effective” EIR for a given simulation time step. The part-load fraction (PLF) correlation accounts for efficiency losses due to compressor cycling.

<div>$$PartLoadFrac = \,PLF\, = \,a + \,b\left( {PLR} \right)\,\, + \,\,c{\left( {PLR} \right)^2}$$</div>

or

<div>$$PartLoadFrac = \,a + \,b\left( {PLR} \right)\,\, + \,\,c{\left( {PLR} \right)^2}\,\, + \,\,d{\left( {PLR} \right)^3}$$</div>

where

<div>$$PLR = part - load\,ratio = \left( {\frac{{sensible\,heating\,load}}{{steady - state\,sensible\,heating\,capacity}}} \right)$$</div>

The part-load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the compressor(s) run continuously for the simulation time step). For PLR values between 0 and 1 ( 0 &lt;= PLR &lt; 1), the following rules apply:

PLF &gt;= 0.7   and   PLF &gt;= PLR

If PLF &lt; 0.7 a warning message is issued, the program resets the PLF value to 0.7, and the simulation proceeds. The runtime fraction of the coil is defined a PLR/PLF. If PLF &lt; PLR, then a warning message is issued and the runtime fraction of the coil is limited to 1.0.

A typical part load fraction correlation for a conventional, single-speed DX heating coil (e.g., residential heat pump) would be:

            PLF = 0.85 + 0.15(PLR)

n The defrost energy input ratio (EIR) modifier curve (function of temperature) is a bi-quadratic curve with two independent variables: outdoor air dry-bulb temperature and the heating coil entering air wet-bulb temperature. The output of this curve is multiplied by the heating coil capacity, the fractional defrost time period and the runtime fraction of the heating coil to give the defrost power at the specific temperatures at which the coil is operating. This curve is only required when a reverse-cycle defrost strategy is specified.

<div>$$DefrostEIRTempModFac = \,a + \,b\left( {{T_{wb,i}}} \right)\,\, + \,\,c{\left( {{T_{wb,i}}} \right)^2} + \,\,d\left( {{T_{db,o}}} \right)\,\, + \,\,e{\left( {{T_{db,o}}} \right)^2} + f\left( {{T_{wb,i}}} \right)\left( {{T_{db,o}}} \right)$$</div>

where

<span>${T_{wb,i}}$</span>      = wet-bulb temperature of the air entering the indoor heating coil, °C

<span>${T_{db,o}}$</span>     = dry-bulb temperature of the air entering the outdoor coil, °C

All six curves are accessed through EnergyPlus’ built-in performance curve equation manager (curve:quadratic, curve:cubic and curve:biquadratic). It is not imperative that the user utilize all coefficients shown in the preceding equations { through } in items (1) through (6) if their performance equation has fewer terms (e.g., if the user’s PartLoadFrac performance curve is linear instead of quadratic or cubic, simply enter the appropriate values for the coefficients a and b, and set the remaining coefficients to zero).

The next input item for the Heating DX single speed coil is the supply air fan operation mode. Either the supply air fan runs continuously while the DX coil cycles on/off, or the fan and coil cycle on/off together. The next two inputs define the minimum outdoor dry-bulb temperature that the heat pump compressor will operate and the maximum outdoor dry-bulb temperature for defrost operation. Crankcase heater capacity and crankcase heater cutout temperature are entered in the following two inputs. The final four inputs cover the type of defrost strategy (reverse-cycle or resistive), defrost control (timed or on-demand), the fractional defrost time period (timed defrost control only), and the resistive defrost heater capacity if a resistive defrost strategy is selected.

#### Model Description

The general flow of the model is as follows:

1)    If the outdoor air dry-bulb temperature is below the specified minimum temperature for compressor operation or the DX heating coil is not scheduled to operate, simply pass through the heating coil inlet air conditions as the coil outlet conditions, set power and heating rates equal to zero, and set crankcase heater power equal to the crankcase heater capacity value specified by the input file.

2)    If the outdoor air dry-bulb temperature is above the specified minimum temperature for compressor operation and the DX heating coil is scheduled to operate, then:

a.    If the outdoor dry-bulb temperature is below the specified maximum outdoor dry-bulb temperature for defrost operation, calculate a heating capacity multiplier, input power multiplier and fractional defrost time period depending on the defrost strategy and defrost control type specified for the heating coil.

b.   Using the rated heating capacity and COP, the part-load curves specified for the DX heating coil, the defrost multipliers calculated above (if applicable), and the part-load ratio that is being requested of the heating coil, determine the following: heating coil exiting air conditions (dry-bulb temperature, humidity ratio and enthalpy), total DX coil heating rate, electric power during heating (compressors and outdoor fans), electric power during defrost, and crankcase heater power.

The following paragraphs give a detailed description of the model calculations that are performed when the DX heating coil is operating (i.e., scenario \# 2 above).

#### Frost Adjustment Factors

Frost formation on the outdoor coil, and the need to periodically defrost this coil, has a significant impact on heating capacity and energy use by the DX heating system. If the outdoor air dry-bulb temperature is below the specified maximum temperature for defrost operation, then the model calculates adjustment factors for heating capacity and input power due to frost formation, and the fractional defrost time period, depending on the defrost strategy and defrost control type specified for the heating coil. This method of accounting for the impacts of frosting/defrost was taken from the model used in DOE-2.1E (ESTSC 2001, Miller and Jaster 1985).

The model first estimates the outdoor coil temperature according to a linear empirical relationship with outdoor air dry-bulb temperature as the independent variable.

<div>$${T_{coil,out}} = 0.82{T_{db,o}} - 8.589$$</div>

The difference between the outdoor air humidity ratio (from the weather file) and the saturated air humidity ratio at the estimated outdoor coil temperature is then calculated, and this value is used as an indication of frost formation on the outdoor coil.

<div>$$\Delta {\omega_{\,coil,out}}\, = \,MAX\left[ {1.0E - 6,\,\,\,{\omega_{outdoor}}\, - \,\,{\omega_{sat}}\left( {{T_{coil,out}}\,,{\rm{OutBaroPress}}} \right)} \right]$$</div>

Frost formation on the outdoor coil must be periodically removed. The fraction of compressor runtime when the coil is being defrosted is either entered by the user (for timed defrost) or is calculated by the model (for on-demand defrost) using an empirical equation and <span>$\Delta {\omega_{\,coil,out}}$</span>. Adjustment factors to total heating coil capacity and input power due to frost formation on the outdoor coil are also calculated by empirical models with <span>$\Delta {\omega_{\,coil,out}}$</span> or fractional defrost time period as the independent variable. The defrost time period fraction and adjustment factors due to frost formation on the outdoor coil vary depending on the defrost control type as shown below.

*Timed Defrost*:

<div>$$Fractional\,Defrost\,Time\, = \,time\,period\,specified\,by\,user = {t_{frac,defrost}}$$</div>

<div>$$Heating\,Capacity\,Multiplier\, = \,0.909 - \,107.33\left( {\Delta {\omega_{\,coil,out}}} \right)$$</div>

<div>$$Input\,Power\,Multiplier\, = \,0.9 - \,36.45\left( {\Delta {\omega_{\,coil,out}}} \right)$$</div>

*On-Demand Defrost*:

<div>$$Fractional\,Defrost\,Time\, = \,\frac{1}{{1 + \left( {\frac{{0.01446}}{{\Delta {\omega_{\,coil,out}}}}} \right)}} = {t_{frac,defrost}}$$</div>

<div>$$Heating\,Capacity\,Multiplier\, = \,0.875\left( {1 - {t_{frac,defrost}}} \right)$$</div>

<div>$$Input\,Power\,Multiplier\, = \,0.954\left( {1 - {t_{frac,defrost}}} \right)$$</div>

If the outdoor air dry-bulb temperature is above the specified maximum temperature for defrost operation, the fractional defrost time period is set to zero and the heating capacity/input power multipliers are set to unity.

#### Defrost Operation

If the fractional defrost time period is greater than zero for the simulation time step, then the model calculates the electrical power used during defrost. The method for calculating defrost power varies based on the defrost strategy specified (i.e., reverse-cycle or resistive). In the case of reverse-cycle defrost, the additional heating load due to defrost (indoor cooling during defrost) is also calculated so that it may be added to the existing heating load when calculating input power for the compressor(s) and outdoor coil fan(s).

*Reverse-Cycle*:

<div>$${Q_{defrost}}\, = \,0.01\left( {{t_{frac,defrost}}} \right)\left( {7.222 - {T_{db,o}}} \right)\left( {\frac{{{Q_{total,rated}}}}{{1.01667}}} \right)$$</div>

<div>$${P_{defrost}}\, = \,DefrostEIRTempModFac\left( {\frac{{{Q_{total,rated}}}}{{1.01667}}} \right)\left( {{t_{frac,defrost}}} \right)\left( {RTF} \right)$$</div>

*Resistive*:

<div>$${Q_{defrost}}\, = \,0.0$$</div>

<div>$${P_{defrost}}\, = \,\left( {{Q_{cap,defrost}}} \right)\left( {{t_{frac,defrost}}} \right)\left( {RTF} \right)$$</div>

where:

<span>${Q_{defrost}}$</span>        = additional indoor heating load due to reverse-cycle defrost (*W*)

<span>${Q_{total,rated}}$</span>    = total full-load heating capacity of the coil at rated conditions (W)

<span>${P_{defrost}}$</span>        = average defrost power for the simulation time step (W)

<span>${Q_{cap,defrost}}$</span>   = capacity of the resistive defrost heating element (W)

*DefrostEIRTempModFac* = energy input ratio modifier curve applicable during defrost

<div>$${\rm{RTF  =  }}\left( {{\raise0.7ex\hbox{${{\rm{PLR}}}$} \!\mathord{\left/ {\vphantom {{{\rm{PLR}}} {{\rm{PartLoadFrac}}}}}\right.}\!\lower0.7ex\hbox{${{\rm{PartLoadFrac}}}$}}} \right)\,\,{\rm{ = }}\,\,runtime fraction of the heating coil$$</div>

#### Heating Operation

For any simulation time step, the total heating capacity of the DX unit is calculated as follows:

<div>$$Qtotal = Qtotal,rated\left( {TotCapTempModFac} \right)\left( {TotCapFlowModFac} \right)$$</div>

If the outdoor air dry-bulb temperature is below the maximum temperature for defrost operation, then the total heating capacity is further adjusted due to outdoor coil frost formation based on the results of Equation and Equation or .

<div>$$Qtotal = Qtotal\left( {HeatingCapacityMultiplier} \right)$$</div>

In a similar fashion, the electrical power draw by the DX unit (compressors plus outdoor coil fans) for any simulation time step is calculated. For a reverse-cycle defrost strategy, the additional heating load (*Q<sub>defrost</sub>*) generated during defrost operation is added to the heating load being requested by adjusting the part-load ratio. If a resistive defrost strategy is selected, *Q<sub>defrost</sub>* = 0. The part-load fraction correlation for the heating coil (user input, Equation or ) is used in the calculation of electrical power draw to account for efficiency losses due to compressor cycling.



<div>$$PLR = \,MIN\left( {1.0\,,\,PLR + \left( {{\raise0.7ex\hbox{${{Q_{defrost}}}$} \!\mathord{\left/ {\vphantom {{{Q_{defrost}}} {{Q_{total}}}}}\right.}\!\lower0.7ex\hbox{${{Q_{total}}}$}}} \right)} \right)$$</div>

<div>$$PartLoadFrac = \,a + \,b\left( {PLR} \right)\,\, + \,\,c{\left( {PLR} \right)^2}\,\, + \,\,d{\left( {PLR} \right)^3}$$</div>

<div>$${P_{heating}} = \frac{{\left( {{Q_{total}}} \right)\left( {EIR} \right)\left( {PLR} \right)}}{{PartLoadFrac}} \times InputPowerMultiplier$$</div>

where

      <span>${P_{heating}}$</span>  = average compressor and outdoor fan power for the simulation time step(W)

<span>${Q_{total}}$</span>    = total heating capacity W, Eqn.

<div>$$EIR = \,Energy\,input\,ratio\, = \,\left( {\frac{1}{{CO{P_{rated}}}}} \right)\left( {EIRTempModFac} \right)\left( {EIRFlowModFac} \right)$$</div>

<span>$CO{P_{rated}}$</span> = coefficient of performance at rated conditions (user input)

*InputPowerMultiplier* = power adjustment due to frost if applicable -Eqn. or

The crankcase heater is assumed to operate when the heating coil’s compressor is OFF, and the average crankcase heater power for the simulation time step is calculated as follows:

<div>$${P_{crankcase}} = {Q_{cap,crankcase}}\left( {1 - RTF} \right)$$</div>

<span>${\rm{RTF  =  }}\left( {{\raise0.7ex\hbox{${{\rm{PLR}}}$} \!\mathord{\left/ {\vphantom {{{\rm{PLR}}} {{\rm{PartLoadFrac}}}}}\right.}\!\lower0.7ex\hbox{${{\rm{PartLoadFrac}}}$}}} \right)\,\,{\rm{ = }}\,\,runtime fraction of the heating coil$</span>   

where

<span>${P_{crankcase}}$</span> = average crankcase heater power for the simulation time step (W)

<span>${Q_{cap,crankcase}}$</span>= crankcase heater capacity (W)

If this heating coil is used as part of an air-to-air heat pump (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir), the crankcase heater defined for this DX heating coil is enabled during the time that the compressor is not running for either heating or cooling (and the crankcase heater power defined in the DX cooling coil object is disregarded in this case). In this instance, RTF in the above equations would be the runtime fraction of the heat pump’s heating coil or cooling coil, whichever is greater.

The properties of the air leaving the heating coil at full-load operation are calculated using the following equations:

<div>$${h_{outlet}} = {h_{inlet}} + {\raise0.7ex\hbox{${{Q_{total}}}$} \!\mathord{\left/ {\vphantom {{{Q_{total}}} {\mathop m\limits^ \bullet  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^ \bullet  }$}}$$</div>

<div>$${\omega_{outlet}}\, = \,{\omega_{inlet}}$$</div>

<div>$${T_{db,outlet}}\, = \,PsyTdbFnHW({h_{outlet}},\,\,\,{\omega_{outlet}})$$</div>

where

<span>${h_{outlet}}$</span>         = enthalpy of the air leaving the heating coil (J/kg)

<span>$\,{\omega_{outlet}}$</span>        = leaving air humidity ratio (kg/kg)

<span>$\,{T_{db,outlet}}$</span>    = leaving air dry-bulb temperature (°C)

*PsyTdbFnHW* = EnergyPlus psychrometric function, returns dry-bulb temp given enthalpy and humidity ratio

#### Condenser Inlet Air Temperature

The air temperature entering the outdoor condenser is based on the weather data used during a simulation. This temperature is either taken directly from the weather data, or can be adjusted based on the height of the outdoor condenser. Since this DX heating coil can only be used in conjunction with a DX cooling coil, the input for Condenser Air Inlet Node Name in the DX cooling coil object can be used to control this optional feature. If this input is left blank, the air temperature entering the condenser is based solely on the weather data. If this input is not blank, then the node name specified must also be listed in an OutdoorAir:Node or OutdoorAir:NodeList object. When the node name is listed in an OutdoorAir:NodeList object, the air temperature entering the condenser is based solely on the weather data. When the node name is listed in an OutdoorAir:Node object, the height of the node determines the air temperature entering the outdoor condenser (see description of Local Outdoor Air Temperature Calculation in the Atmospheric Variation section of this document for further details).

#### Supply Air Fan Control: Cycling vs. Continuous

One of the inputs to the DX coil model is the supply air fan operation mode: cycling fan, cycling compressor (CyclingFanAndCompressor) or continuous fan, cycling compressor (ContinuousFanWithCyclingCompressor). The first operation mode is frequently referred to as “AUTO fan”, where the compressor(s) and supply air fan operate in unison to meet the zone heating load, and cycle off together when the heating load has been met. The second operation mode is often referred to as “fan ON”, where the compressor(s) cycle on and off to meet the zone heating load but the supply air fan operates continuously regardless of compressor operation.

Since this DX heating coil can only be used in conjunction with a DX cooling coil (i.e. heat pumps), and these coils are used in AC equipment that specifies a fan operation mode schedule (e.g AirLoopHVAC:UnitaryHeatPump:AirToAir), the selection made in the DX heating coil is currently ignored and the fan operation mode schedule value determines the fan operation mode for each time step throughout the simulation. A fan operation mode schedule value of 0 specifies AUTO fan mode operation while values other than 0 specify fan ON operation. The use of a schedule allows the fan operation mode to change based on time-of-day or with changes in season.

The EnergyPlus methodology for determining the impact that HVAC equipment has on an air stream is to calculate the mass flow rate and air properties (e.g., enthalpy, dry-bulb temperature, humidity ratio) exiting the equipment. These exiting conditions are passed along as inlet conditions to the next component model in the air stream. Eventually the flow rate and properties of the air being supplied to the conditioned zone are used in the zone energy balance to determine the resulting zone air temperature and humidity ratio.

With this methodology, the determination of the air mass flow rate and air properties for the two different supply air fan operation modes is slightly different. For the case of cycling fan/cycling compressor, the conditions of the air leaving the heating coil are the steady-state values calculated using equations , and above. However the air mass flow rate passed along to the next component (and eventually to the conditioned zone) is the average air mass flow rate for the system simulation time step (determined by the heating system; see AirLoopHVAC:UnitaryHeatPump:AirToAir). For this fan control type, the heating coil part-load fraction (Equation or ) is also passed to Fan:OnOff (if used) to properly calculate the supply air fan power and associated fan heat.

For the case of continuous fan/cycling compressor, the air mass flow rate is constant. However, the air properties leaving the heating coil are calculated as the average conditions during the system simulation time step. The model assumes that the exiting air conditions are the steady-state values calculated using equations , and above when the compressor(s) operate. For the remainder of the system simulation time step, it is assumed that the air exiting the DX coil has the same properties as the air entering the coil. For this supply air fan operating strategy, the leaving air properties are calculated as follows:

<div>$${h_{outlet,ContFanCycComp}}\, = \,{h_{outlet}}\,\left( {PLR} \right) + \,{h_{inlet}}\,\,\left( {1 - PLR} \right)$$</div>

<div>$${\omega_{outlet,ContFanCycComp}}\, = \,{\omega_{outlet}}\,\left( {PLR} \right) + \,{\omega_{inlet}}\,\,\left( {1 - PLR} \right)$$</div>

<div>$${T_{db,outlet,ContFanCycComp}} = \,PsyTdbFnHW({h_{outlet,\,ContFanCycComp}}\,,\,\,\,\,\,\,\,{\omega_{outlet,ContFanCycComp}})$$</div>

#### References

DOE. 1982. *DOE-2 engineers manual*, version 2.1A. LBL-11353. Berkeley, CA: Lawrence Berkeley National Laboratory.

ESTSC. 2001. DOE-2.1E Version 110 (source code).Oak Ridge, TN: Energy Science and Technology Software Center.

Miller, R.L. and Jaster, H. 1985. Performance of Air-Source Heat Pumps. EM-4226. Palo Alto, CA: Electric Power Research Institute.

### Single-Speed DX Heating Coil Standard Ratings

For single-speed direct expansion (DX) heating coils, the industry standard ratings of High Temperature Heating Standard (Net) Rating Capacity, Low Temperature Heating Standard (Net) Rating Capacity and Heating Seasonal Performance Factor (HSPF) are calculated according to ANSI/AHRI Standard 210/240 (AHRI 2008). The rated Energy Efficiency Ratio (EER) is not calculated for any DX heatings coils at this time.

For the Coil:Heating:DX:SingleSpeed object in EnergyPlus, these standard ratings are not direct inputs to the model. However, these standard ratings can be calculated using user-entered information for the Coil:Heating:DX:SingleSpeed object. These standard rating values are provided in the eplusout.eio output file (Ref. OutputDetailsAndExamples.pdf) and also in the predefined tabular output reports (Output:Table:SummaryReports object, Equipment Summary). Currently, the standard ratings are only calculated and output for single-speed DX heating coils..

Note: The standard ratings described in this section require that the DX heating coil model be evaluated at specific operating conditions (i.e., specific temperatures for air entering the heating coil and for air entering the air-cooled [outdoor] condenser). If the heating coil performance curves can not be evaluated at the required test conditions, then a standard rating value will be calculated at user specified curve limit as an output and a warning message will written to eplusout.err. For example, if the curve object (Curve:Biquadratic) for Total Heating Capacity Function of Temperature Curve has a minimum value of -5C for dry-bulb temperature entering the condenser coil, the HSPF calculation requires that heating capacity and EIR be calculated at -8.33C, so this would result in HSPF value calculated at -5C as an output and a warning message in the eplusout.err file.

#### High Temperature Heating Standard (Net) Rating Capacity

The procedure for calculating the Standard Rating Heating Capacity is given by:

<div>$${\dot Q_{HighStandardRating}} = {\dot Q_{total,Rated}}\left( {TotCapTempModFa{c_{Rated}}} \right)$$</div>

<div>$${\dot Q_{HighStandard\,Rating\,Net}} = {\dot Q_{HighStandardRating}} + Fa{n_{Power,\,Rated}}$$</div>

where,

<span>${\dot Q_{HighStandardRating\,Net}}$</span> = Total standard (net) heating capacity (W) of the air-source heat pump equipment in heating mode determined from ANSI/AHRI Standard 210/240 and test conditions shown in Table 59. The standard heating test conditions for air-cooled condenser are: indoor coil entering air dry-bulb 21.1°C and outdoor coil entering air dry-bulb 8.33°C.

<span>${\dot Q_{HighStandardRating}}$</span> = Total standard heating capacity (W) of the air-source heat pump equipment in heating mode determined from ANSI/AHRI Standard 210/240 and test conditions shown in Table 60. The standard heating test conditions for air-cooled condenser are: indoor coil entering air dry-bulb 21.1°C and outdoor coil entering air dry-bulb 8.33°C.

<span>${\dot Q_{total,Rated}}$</span> = Rated total heating capacity, user input (W)

<span>$TotCapTempModFa{c_{Rated}}$</span>= User-specified bi-quadratic curve evaluated at the indoor coil entering air dry-bulb 21.1°C and outdoor coil entering air dry-bulb 8.33°C for air-cooled condenser as specified in Table 59, (dimensionless).

<span>$Fa{n_{Power,Rated}}$</span>= Supply air fan power at rated conditions, (W). The Rated Indoor Coil Fan Power Per Volume Flow rate is a user-entered value, with a default of 773.3 W/(m3/s)) if the user leaves this input field blank. The default value is taken from ANSI/ASHRAE Standard 210/240-2008 where it is defined for systems which do not have an Indoor Coil fan furnished as part of the system. See the description given at the end of this section for how this value is calculated.

#### Low Temperature Heating Standard (Net) Rating Capacity

The procedure for calculating the Low Temperature Standard Rating Heating Capacity is given by:

<div>$${\dot Q_{LowStandardRating}} = {\dot Q_{total,Rated}}\left( {TotCapTempModFa{c_{H3Test}}} \right)$$</div>

<div>$${\dot Q_{LowStandard\,Rating\,Net}} = {\dot Q_{LowStandardRating}} + Fa{n_{Power,\,Rated}}$$</div>

where,

<span>${\dot Q_{LowStandardRating\,Net}}$</span> = Total standard (net) heating capacity (W) of the air-source heat pump equipment in heating mode determined from ANSI/AHRI Standard 210/240 and test conditions shown in Table 60. The standard heating test conditions for air-cooled condenser are: indoor coil entering air dry-bulb 21.1°C and outdoor coil entering air dry-bulb (-8.33) °C.

<span>${\dot Q_{LowStandardRating}}$</span> =    Total standard heating capacity (W) of the air-source heat pump equipment in heating mode determined from ANSI/AHRI Standard 210/240 and test conditions shown in Table 59. The standard heating test conditions for air-cooled condenser are: indoor coil entering air dry-bulb 21.1°C and outdoor coil entering air dry-bulb (-8.33) °C.

<span>${\dot Q_{total,Rated}}$</span> = Rated total heating capacity, user input (W)

<span>$TotCapTempModFa{c_{H3Test}}$</span>= User-specified bi-quadratic curve evaluated at the indoor coil entering air dry-bulb 21.1°C and outdoor coil entering air dry-bulb (-8.33) °C for air-cooled condenser as specified in Table 60, (dimensionless).

<span>$Fa{n_{Power,Rated}}$</span>= Supply air fan power at rated conditions, (W). The Rated Indoor Coil Fan Power Per Volume Flow rate is a user-entered value, with a default of 773.3 W/(m3/s)) if the user leaves this input field blank. The default value is taken from ANSI/ASHRAE Standard 210/240-2008 where it is defined for systems which do not have an Indoor Coil fan furnished as part of the system. See the description given at the end of this section for how this value is calculated.

#### Heating Seasonal Performance Factor (HSPF)

Heating Seasonal Performance Factor (HSPF) is defined as the total space heating required during the space heating season, divided by the total electrical energy consumed by the heat pump system during the same season.

Calculations of HSPF of a heat pump having a single-speed compressor that was tested with a fixed speed indoor fan installed, a constant-air-volume-rate indoor fan installed, or with no indoor fan installed is given below.

<div>$$HSPF = \frac{{\sum\limits_j^J {\left[ {\frac{{{n_j}}}{N} \cdot BL({T_j})} \right]} }}{{\sum\limits_j^J {\left[ {\frac{{{e_h}({T_j})}}{N}} \right]}  + \sum\limits_j^J {\left[ {\frac{{RH({T_j})}}{N}} \right]} }} \cdot {F_{def}}$$</div>

Where,

<span>$\frac{{{e_h}({T_j})}}{N}$</span> = The ratio of the electrical energy consumed by the heat pump during periods of the  space heating season when the outdoor temperature fell within the range represented by bin temperature <span>${T_j}$</span> to the total number of hours in the heating season (N), W.

<span>$\frac{{RH({T_j})}}{N}$</span>= The ratio of the electrical energy used for resistive space heating during periods when the outdoor temperature fell within the range represented by bin temperature <span>${T_j}$</span> to the total number of hours in the heating season (N),W.

<span>${T_j}$</span>= The outdoor bin temperature, °C. Outdoor temperatures are “binned” such that calculations are only performed based one temperature within the bin. Bins of 2.78 °C are used.

<span>$\frac{{{n_j}}}{N}$</span>= Fractional bin hours for the heating season; the ratio of the number of hours during the heating season when the outdoor temperature fell within the range represented by bin temperature <span>${T_j}$</span> to the total number of hours in the heating season, dimensionless. Obtain <span>$\frac{{{n_j}}}{N}$</span> values from Table # 17 of AHRI Std. 210/240-2008 (Table 60 below).

<div>$$j$$</div>= The bin number, dimensionless.

<span>$J$</span>= For each generalized climatic region, the total number of temperature bins, dimensionless. Referring to Table # 17, <span>$J$</span> is the highest bin number (<div>$$j$$</div>) having a nonzero entry for the fractional bin hours for the generalized climatic region of interest.

<span>${F_{def}}$</span>= The demand defrost credit described in section 3.9.2 of AHRI Std. 210/240-2008, dimensionless.  For simplification, assigned a value of 1 for timed defrost control and a value of 1.03 for demand defrost control.

<span>$BL({T_j})$</span>= The building space conditioning load corresponding to an outdoor temperature of<span>${T_j}$</span>; the heating season building load also depends on the generalized climatic region's outdoor design temperature and the design heating requirement, W.

Building heating load can be evaluated by using the following equation

<div>$$BL({T_j}) = \frac{{\left( {18.33 - {T_j}} \right)}}{{\left( {18.33 - {T_{OD}}} \right)}} \cdot C \cdot DHR$$</div>

Where,

<span>${T_{OD}}$</span>= The outdoor design temperature, °C. An outdoor design temperature is specified for each generalized climatic region in Table # 17 of AHRI Std. 210/240-2008 (Table 60 below).



<span>$C$</span>= 0.77, a correction factor which tends to improve the agreement between calculated and measured building loads, dimensionless.

<span>$DHR$</span> = Design Heating Requirement, W. This is the amount of heating required to maintain a given indoor temperature at a particular outdoor design temperature.

For a single speed heat pump with a fixed speed indoor fan installed, a constant-air-volume-rate indoor fan installed, or with no indoor fan installed, the minimum and maximum design heating requirements for each generalized climatic region can be calculated as follows:

<div>$$
  DH{R_{\min }} = \left\{ 
    \begin{array}{l}
      {\mathop Q\limits^ \cdot_h}(8.33) \cdot (1.8) \cdot \left[ {\frac{{18.33 - {T_{OD}}}}{{60.0}}} \right] , {\rm{ for regions I,II,III,IV, and VI}} \\
      {\mathop Q\limits^ \cdot_h}(8.33),{\rm{                     for regions V}}
    \end{array}
  right\}
$$</div>

<div>$$DH{R_{\max }} = \left\{ \begin{array}{l}2 \cdot {\mathop Q\limits^ \cdot_h}(8.33) \cdot (1.8) \cdot \left[ {\frac{{18.33 - {T_{OD}}}}{{60}}} \right],{\rm{ for regions I,II,III,IV, and VI}}\\\\2.2 \cdot {\mathop Q\limits^ \cdot_h}(8.33),{\rm{                     for regions V}}\end{array} \right\}$$</div>

Both <span>$DH{R_{\min }}$</span>and <span>$DH{R_{\max }}$</span>above should be rounded to the nearest standardized DHR given in Table 61.

The intermediate term used in the calculations of HSPF can be calculated using the equations described below.

<div>$$\frac{{{e_h}({T_j})}}{N} = \frac{{X({T_j}) \cdot \mathop {{E_h}}\limits^ \cdot  ({T_j}) \cdot \delta ({T_j})}}{{PL{F_j}}} \cdot \frac{{{n_j}}}{N}$$</div>

<div>$$\frac{{RH({T_j})}}{N} = \left[ {BL({T_j}) - \left( {X({T_j}) \cdot \mathop {{Q_h}}\limits^ \cdot  ({T_j}) \cdot \delta ({T_j})} \right)} \right] \cdot \frac{{{n_j}}}{N}$$</div>

Where,

<div>$$
  X({T_j}) = \left\{ 
    \begin{array}{l}
      BL({T_J})/\mathop {{Q_h}}\limits^ \cdot  ({T_j}) \\
      {\rm{Or}} \\
      1
    \end{array}
  \right\}
$$</div>

whichever is less; the heating mode load factor for temperature bin <div>$$j$$</div>, dimensionless.

<span>$\mathop {{Q_h}}\limits^ \cdot  ({T_j})$</span>= the space heating capacity of the heat pump when operating at outdoor temperature <span>${T_j}$</span>,  W.

<span>$\mathop {{E_h}}\limits^ \cdot  ({T_j})$</span>= the electrical power consumption of the heat pump when operating at outdoor temperature <span>${T_j}$</span>, W.

<span>$\delta ({T_j})$</span>= the heat pump low temperature cut-out factor, dimensionless.

<span>$PL{F_j}$</span> = the part load factor, dimensionless.

Part load factor is determined as follows:

<div>$$PL{F_j} = 1 - {C_{{D^h}}}[1 - X({T_j})]$$</div>

Where,

<span>${C_{{D^h}}}$</span>= Degradation coefficient which is defaulted to the value of 0.25

Low temperature cut-out factor <span>$\delta ({T_j})$</span>is determined as follows:

<div>$$
  \delta ({T_j}) = \left\{ 
    \begin{array}{l}
      {\rm{0, if }}{T_j} \le {T_{off}}{\rm{ or }}\frac{{\mathop {{Q_h}}\limits^ \cdot  ({T_j})}}{{\mathop {{E_h}}\limits^ \cdot  ({T_j})}} < 1 \\
      {\rm{1/2, if }}{T_{off}} < {T_j} \le {T_{on}}{\rm{ and }}\frac{{\mathop {{Q_h}}\limits^ \cdot  ({T_j})}}{{\mathop {{E_h}}\limits^ \cdot  ({T_j})}} \ge 1 \\
      {\rm{1, if }}{T_j} > {T_{on}}{\rm{ and }}\frac{{\mathop {{Q_h}}\limits^ \cdot  ({T_j})}}{{\mathop {{E_h}}\limits^ \cdot  ({T_j})}} \ge 1
    \end{array}
  \right.
$$</div>

where,

<span>${T_{off}}$</span> = the outdoor temperature when the compressor is automatically shut off, °C. (If no such temperature exists, <span>${T_j}$</span>is always greater than <span>${T_{off}}$</span>and<span>${T_{on}}$</span>).

<span>${T_{on}}$</span>= the outdoor temperature when the compressor is automatically turned back on, if applicable, following an automatic shut-off, °C.

Calculate <span>$\mathop {{Q_h}}\limits^ \cdot  ({T_j})$</span>and <span>$\mathop {{E_h}}\limits^ \cdot  ({T_j})$</span> using,

<div>$$\mathop {{Q_h}}\limits^ \cdot  ({T_j}) = \left\{ \begin{array}{l}\mathop {{Q_h}}\limits^ \cdot  ( - 8.33) + \frac{{\left[ {\mathop {{Q_h}}\limits^ \cdot  (8.33) - \mathop {{Q_h}}\limits^ \cdot  ( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{16.67}}{\rm{, if }}{T_j} \ge 7.22^\circ {\rm{C or }}{T_j} \le  - 8.33^\circ {\rm{C}}\\\mathop {{Q_h}}\limits^ \cdot  ( - 8.33) + \frac{{\left[ {\mathop {{Q_h}}\limits^ \cdot  (1.67) - \mathop {{Q_h}}\limits^ \cdot  ( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{10}}{\rm{, if }} - 8.33^\circ {\rm{C}} < {T_j} < 7.22^\circ {\rm{C}}\end{array} \right.$$</div>

<div>$$\mathop {{E_h}}\limits^ \cdot  ({T_j}) = \left\{ \begin{array}{l}\mathop {{E_h}}\limits^ \cdot  ( - 8.33) + \frac{{\left[ {\mathop {{E_h}}\limits^ \cdot  (8.33) - \mathop {{E_h}}\limits^ \cdot  ( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{16.67}}{\rm{, if }}{T_j} \ge 7.22^\circ {\rm{C or }}{T_j} \le  - 8.33^\circ {\rm{C}}\\\mathop {{E_h}}\limits^ \cdot  ( - 8.33) + \frac{{\left[ {\mathop {{E_h}}\limits^ \cdot  (1.67) - \mathop {{E_h}}\limits^ \cdot  ( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{10}}{\rm{, if }} - 8.33^\circ {\rm{C}} < {T_j} < 7.22^\circ {\rm{C}}\end{array} \right.$$</div>

<span>$\mathop {{Q_h}}\limits^ \cdot  ( - 8.33),\mathop {{Q_h}}\limits^ \cdot  (1.67),\mathop {{Q_h}}\limits^ \cdot  (8.33),\mathop {{E_h}}\limits^ \cdot  ( - 8.33),\mathop {{E_h}}\limits^ \cdot  (1.67)$</span> and <span>$\mathop {{E_h}}\limits^ \cdot  (8.33)$</span> are the **(net)** values calculated using performance curves entered by the user and supply fan power per rated air flow rate.

Table 59. Heating Mode Test Conditions for Units Having a Single-Speed Compressor and a Fixed-Speed Indoor Fan, a Constant Air Volume Rate Indoor Fan, or No Indoor Fan

&lt;&lt;Source: Table 9, Page 74, ANSI/AHRI Standard 210/240 -2008&gt;&gt;

Test description

Air Entering Indoor Unit Temperature (°C)

Air Entering Outdoor Unit Temperature (°C)

Heating Air Volume Rate

Dry Bulb

Wet Bulb

Dry Bulb

Wet Bulb

H1 Test (Required, Steady)

21.11

15.56

8.33

6.11

Heating Full- load

H1C Test (Required, Steady)

21.11

15.56

8.33

6.11

(2)

H2 Test (Required, Steady)

21.11

15.56

1.67

0.56

Heating Full- load

H3 Test (Required, Steady)

21.11

15.56

-8.33

-9.44

Heating Full- load

Notes:

1)    Heating air volume arte are defined in section 3.1.4.4 of ANSI/AHRI 210/240-2008

2)    Maintain the airflow nozzles static pressure difference ro velocity pressure during the ON period at the same pressure difference or velocity pressure as measured during the H1 Test







Table 60. Generalized Climatic Region Information

&lt;&lt;Source: Table # 17, Page 99, ANSI/AHRI Standard 210/240 -2008&gt;&gt;

Region Number

I

II

III

IV

V

VI

Heating Load Hours, HLH

750

1250

1750

2250

2750

\*2750

Outdoor Design Temperature, <span>${T_{OD}}$</span>(°C)

2.78

-2.78

-8.33

-15

-23.33

-1.11

<div>$$j$$</div>

<span>${T_j}$</span>(°C)

Fractional Bin Hours <span>$\frac{{{n_j}}}{N}$</span>

1

16.67

.291

.215

.153

.132

.106

.113

2

13.89

.239

.189

.142

.111

.092

.206

3

11.11

.194

.163

.138

.103

.086

.215

4

8.33

.129

.143

.137

.093

.076

.204

5

5.56

.081

.112

.135

.100

.078

.141

6

2.78

.041

.088

.118

.109

.087

.076

7

0

.019

.056

.092

.126

.102

.034

8

-2.78

.005

.024

.042

.087

.094

.008

9

-5.56

.001

.008

.021

.055

.074

.003

10

-8.33

0

.002

.009

.036

.055

0

11

-11.11

0

0

.005

.026

.047

0

12

-13.89

0

0

.002

.013

.038

0

13

-16.67

0

0

.001

.006

.029

0

14

-19.44

0

0

0

.002

.018

0

15

-22.22

0

0

0

.001

.010

0

16

-25

0

0

0

0

.005

0

17

-27.78

0

0

0

0

.002

0

18

-30.56

0

0

0

0

.001

0

\* Pacific Coast Region



Table 61. Standardized Design Heating Requirements (W)

&lt;&lt;Source: Table 18, Page 100, ANSI/AHRI Standard 210/240 -2008&gt;&gt;

1465.356

7326.78

14653.56

26376.41

2930.712

8792.136

17584.27

29307.12

4396.068

10257.49

20514.98

32237.83

5861.424

11722.85

23445.7

38099.26

### Multi-Speed Electric Heat Pump DX Air Heating Coil

#### Overview

This model (object name Coil:Heating:DX:MultiSpeed:) simulates the performance of an air-to-air direct expansion (DX) heating system. The main difference compared to the other heating coil model (Coil:Heating:DX:SingleSpeed) is that this heating coil allows modeling of two to four discrete compressor speeds. Each speed has a set of corresponding performance information at rated conditions along with curve fits for variations in total capacity, energy input ratio and part-load fraction to determine the performance of the unit at part-load conditions (DOE 1982). The full load supply airflow rate is dependent on the speed number and is set by its parent object (Ref: AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed). The part-load impact on coil energy use is automatically applied to the lowest speed. A choice is provided to determine whether part-load impacts on coil energy use are applied when the coil is operating at speeds greater than Speed 1. Adjustment factors applied to total capacity and input power to account for frost formation on the outdoor coil are calculated at each speed.

This model simulates the thermal performance of the indoor DX heating coil, and the power consumption of the outdoor unit (multispeed compressor, fans, crankcase heaters and defrost heaters). The performance of the indoor supply air fan varies widely from system to system depending on control strategy (e.g., constant fan vs. AUTO fan), fan type, fan motor efficiency and pressure losses through the air distribution system. Therefore, this DX system model does not account for the thermal effects or electric power consumption of the indoor supply air fan. EnergyPlus contains separate models for simulating the performance of various indoor fan configurations, and these models can be easily linked with the DX system model described here to simulate the entire DX system being considered. For the time being, this coil model can only be called by the parent object AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed.

When the model determines performance at Speed 1 (the lowest speed) or cycling between OFF and Speed 1, its performance is almost the same as the performance for the Coil:Heating:DX:SingleSpeed model. However, the outlet conditions are calculated slightly differently. Therefore, the Coil:Heating:DX:SingleSpeed model may be considered as a subset of the model described here. When the multispeed coil model determines performance at higher speeds (above 1), the model linearly interpolates the performance at two consecutive speeds (n-1 and n) as needed to meet the heating load, with the fraction of time at each speed established by the speed ratio.

#### Model Inputs

The model inputs are also very similar to the inputs of the Coil:Heating:DX:SingleSpeed object. The main difference is that this multispeed model requires a set of fields at each speed, such as rated capacity, rated COP, two capacity modifiers, two energy input ratio modifiers, and part-load correction. The inputs also include waste heat fraction and modifier as a function of temperature to calculate recoverable waste heat for heat recovery, which are not available in the similar Coil:Heating:DX:SingleSpeed object.

#### Speed 1 Operation

The calculation procedures in this model, including defrost and crankcase heater, are indentical to the Coil:Heating:DX:SingleSpeed object (Ref: Coil:Heating:DX:SingleSpeed) with one exception: outlet node condition calculation when the supply air fan operation mode is ContinuousFanWithCyclingCompressor. The following procedure provides the detailed description of the exception.

n Total delivered heating capacity

The total delivered heating capacity for speed 1 operating at the cycling ratio needed to meet the requested heating load is:

<div>$${Q_{coil,cycling}} = {\mathop m\limits^\cdot_{Speed\,1}}\left( {CycRatio} \right)({h_{inlet}} - {h_{outlet,full}})$$</div>

where,

*Q<sub>coil,cycling</sub>*      = delivered sensible heating capacity for Speed 1 operating at a specific cycling ratio [W]

<span>$\mathop {{\rm{ }}m}\limits_{Speed{\kern 1pt} 1}^ \cdot  $</span>      = air mass flow rate through heating coil at Speed 1 as set by the parent object [kg/s]

*h<sub>outlet,full</sub>*      = specific enthalpy of the coil outlet air during full-load operation at Speed 1 (no cycling) [J/kg]

*h<sub>inlet</sub>           *            = specific enthalpy of the coil inlet air [J/kg]

*CycRatio*    = cycling ratio at Speed 1, ratio of requested heating load to the full-load capacity of the coil at Speed 1 [dimensionless]

It is assumed that the coil provides no heating capacity when the coil is OFF, even if the supply air fan continues to operate.

n Outlet air specific enthalpy

The average specific enthalpy of the coil outlet air is then calculated based on the delivered sensible heating capacity and the average air mass flow rate entering the coil:

<div>$${h_{outlet,average}} = {h_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,cycling}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,cycling}}} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where,

*h<sub>outlet,average</sub>*  = average specific enthalpy at the coil outlet [J/kg]

<span>${\dot m_{inlet}}$</span>         = mass flow rate at the inlet to the coil as established by the parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed, Mass Flow Rate Calculation). This flow rate is the average value determined by the parent object, accounting for the specified flow rate when the heating coil is ON and the specified flow rate when the heating coil is OFF for the time step being simulated.

n Outlet air temperature

The heating coil’s outlet air humidity ratio equals the inlet air humidity ratio since the coil does not change the moisture content of the air. So the average outlet air temperature is calculated based on the inlet air humidity ratio and the average outlet air enthalpy using the psychrometric function PsyTdbFnHW.

The main reason for using the above approach is that outlet air conditions are calculated in the same way for all operating speeds.

The crankcase heater defined for this DX heating coil is enabled during the time that the compressor is not running for either heating or cooling. The crankcase heater power use from either heating or cooling is reported in the heating coil.

#### Higher Speed Operation

This section describes how higher speed operation is simulated. When the required sensible load is less than the full load sensible capacity at Speed n (Speed Number &gt; 1), the following calculations are performed:

n Total delivered heating capacity at Speed n-1 and Speed n

<span>$TotCa{p_{n - 1}} = RatedCa{p_{n - 1}}\left( {TotCapTempModFa{c_{n - 1}}} \right)\left( {TotCapFlowModFa{c_{n - 1}}} \right)$</span><span>$TotCa{p_n} = RatedCa{p_n}\left( {TotCapTempModFa{c_n}} \right)\left( {TotCapFlowModFa{c_n}} \right)$</span>

where,

*TotCap<sub>i</sub>*<sub>           </sub> = total delivered heating capacity at given temperatures and flow rates at Speed i [W]

*RatedCap<sub>i</sub>*<sub>   </sub> = heating capacity at the rated conditions at Speed i [W]

*TotCapTempModFac<sub>i</sub>* = total heating capacity modifier as a function of indoor and outdoor air dry-bulb temperature at Speed i

*TotCapFlowModFac<sub>i</sub>* = total heating capacity modifier as a function of the ratio of the actual flow rate across the heating coil to the rated airflow rate at Speed i

i     = Speed n or Speed n-1

n EIR at Speed n-1 and Speed n

<div>$$EI{R_{n - 1}} = RatedEI{R_{n - 1}}\left( {EIRTempModFa{c_{n - 1}}} \right)\left( {EIRFlowModFa{c_{n - 1}}} \right)$$</div>

<div>$$EI{R_n} = RateEI{R_n}\left( {EIRTempModFa{c_n}} \right)\left( {EIRFlowModFa{c_n}} \right)$$</div>

where,

*EIR<sub>i</sub>*<sub>                      </sub> = energy input ratio at given temperatures and flow rates at Speed i [W]

*RatedEIR<sub>i</sub>*<sub>    </sub> = energy input ratio at the rated conditions at Speed i [W]

*EIRTempModFac<sub>i</sub>* = energy input ratio modifier as a function of indoor and outdoor air dry-bulb temperature at Speed i

*EIRFlowModFac<sub>i</sub>* = energy input ratio modifier as a function of the ratio of the actual flow rate across the heating coil to the rated airflow rate at Speed i

i     = Speed n or Speed n-1

n Full load outlet air specific enthalpy at Speed n-1 and Speed n

<div>$${h_{outlet,full\_Speed\,n}} = {h_{inlet}} - {{\raise0.7ex\hbox{${\left( {TotCa{p_n}*HeatingCapacityMultiplier} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {TotCa{p_n}*HeatingCapacityMultiplier} \right)} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

<div>$${h_{outlet,full\_Speed\,n - 1}} = {h_{inlet}} - {{\raise0.7ex\hbox{${\left( {TotCa{p_{n - 1}}*HeatingCapacityMultiplier} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {TotCa{p_{n - 1}}*HeatingCapacityMultiplier} \right)} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where,

*HeatingCapacityMultiplier*            = frost adjustment factor for heating capacity (See Ref. Coil:Heating:DX:SingleSpeed)

*h<sub>outlet,full\_Speed\\ n</sub>*         = specific enthalpy of the coil outlet air during full-load operation at Speed n (no cycling) [J/kg]

*h<sub>outlet,full\_Speed\\ n-1</sub>*       = specific enthalpy of the coil outlet air during full-load operation at Speed n-1 (no cycling) [J/kg]

n Effective total heating capacity

<div>$$\begin{array}{l}{Q_{coil,SpeedRatio}} = \left( {SpeedRatio} \right){\mathop m\limits^\cdot_{Speed\,n}}({h_{inlet}} - {h_{outlet,full\_Speed\,n}})\\\;\;\;\;\;\;\;\;\;\; + (1 - SpeedRatio){\mathop m\limits^\cdot_{Speed\,n - 1}}({h_{inlet}} - {h_{outlet,full\_Speed\,n - 1}})\end{array}$$</div>

where,

<span>${{Q_{coil,SpeedRatio}}}$</span><sub>                       </sub> = delivered sensible heating capacity at a given speed ratio between two consecutive speeds [W]

<span>${\mathop {{\rm{ }}m}\limits_{Speed{\kern 1pt} n}^ \cdot  }$</span>      = air mass flow rate through heating coil at Speed n as set by the parent object [kg/s]

<span>${\mathop {{\rm{ }}m}\limits_{Speed{\kern 1pt} n - 1}^ \cdot  }$</span>    = air mass flow rate through heating coil at Speed 1 as set by the parent object [kg/s]



n Average outlet air enthalpy

<div>$${h_{outlet,average}} = {h_{inlet}} - {{\raise0.7ex\hbox{${{Q_{coil,SpeedRatio}}}$} \!\mathord{\left/ {\vphantom {{{Q_{coil,SpeedRatio}}} {\mathop m\limits^\cdot  }}}\right.}\!\lower0.7ex\hbox{${\mathop m\limits^\cdot  }$}}_{inlet}}$$</div>

where,

*h<sub>outlet,average</sub>*  = average specific enthalpy at the coil outlet [J/kg]

*h<sub>inlet</sub>           *            = specific enthalpy of the coil inlet air [J/kg]

<span>${\dot m_{inlet}}$</span>         = Mass flow rate at the inlet to the coil as established by the parent object (Ref. AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed, Mass Flow Rate Calculation). This flow rate is the average value determined by the parent object, accounting for the specified flow rate when the heating coil is at Speed n and the specified flow rate when the heating coil is at Speed n-1 for the time step being simulated.

n Average outlet air temperature

The heating coil’s outlet air humidity ratio equals the inlet air humidity ratio since the coil does not change the moisture content of the air. So the average outlet air temperature is calculated based on the inlet air humidity ratio and the average outlet air enthalpy using the psychrometric function PsyTdbFnHW.

n Full load energy inputs at Speed n-1 and Speed n

<div>$$HeatingPowe{r_n} = TotCa{p_n}\left( {EI{R_n}} \right)\left( {HeatingCapacityMultiplier} \right)\left( {InputPowerMultiplier} \right)$$</div>

<div>$$HeatingPowe{r_{n - 1}} = TotCa{p_{n - 1}}\left( {EI{R_{n - 1}}} \right)\left( {HeatingCapacityMultiplier} \right)\left( {InputPowerMultiplier} \right)$$</div>

where,

*InputPowerMultiplier*        = Frost adjustment factor for heating power calculation (Ref. Coil:Heating:DX:SingleSpeed)

n Calculate combined energy input

When the input for the field ‘Apply Part Load Fraction to Speeds Greater than 1’ is No (equivalent to a single compressor), the combined energy output is calculated as follows:

<div>$$HeatingPower = HeatingPowe{r_n}\left( {SpeedRatio} \right) + HeatingPowe{r_{n - 1}}(1.0 - SpeedRatio)$$</div>

When the input for the field ’Apply Part Load Fraction to Speeds Greater than 1’ is Yes (equivalent to multiple compressors), the combined energy output is calculated as follows:

<div>$$HeatingPower = HeatingPowe{r_n}\left( {RTF} \right) + HeatingPowe{r_{n - 1}}(1.0 - RTF)$$</div>

where,

HeatingPower          = Power used in Watt

RTF                        = Run time fraction (SpeedRatio/Part-load Fraction) at Speed n

n Calculate defrost power

When the defrost strategy is resistive, the power calculation is the same as Speed 1 operation (Ref. Coil:Heating:DX:SingleSpeed). When the defrost strategy is reverse-cycle, the following calculations are performed:

<div>$${Q_{defrost,n}} = 0.01({t_{frac,defrost}})(7.222 - {T_{db,o}})\left( {\frac{{{Q_{total,rated,n}}}}{{1.01667}}} \right)$$</div>

<div>$${P_{defrost,n - 1}} = DefrostEIRTempModFac\left( {\frac{{{Q_{total,rated,n - 1}}}}{{1.01667}}} \right)({t_{frac,defrost}})$$</div>

<div>$${P_{defrost,n}} = DefrostEIRTempModFac\left( {\frac{{{Q_{total,rated,n}}}}{{1.01667}}} \right)({t_{frac,defrost}})$$</div>

where:

<span>${Q_{defrost,n}}$</span>     = additional indoor heating load due to reverse-cycle defrost at Speed n (*W*)

<span>${Q_{total,rated,n}}$</span>  = total full-load heating capacity of the coil at rated conditions at Speed n (W)

<span>${P_{defrost,n - 1}}$</span>    = full load defrost power for the simulation time step at Speed n-1 (W)

<span>${P_{defrost,n}}$</span>      = full load defrost power for the simulation time step at Speed n (W)

<span>${Q_{total,rated,n - 1}}$</span>= capacity of the resistive defrost heating element at Speed n-1 (W)

<span>${Q_{total,rated,n}}$</span>= capacity of the resistive defrost heating element at Speed n (W)

DefrostEIRTempModFac     = defrost energy input ratio (EIR) modifier curve (Ref. Coil:Heating:DX:SingleSpeed).

T<sub>frac,defrost</sub>       =  fractional defrost time (Ref. Coil:Heating:DX:SingleSpeed)

When the input for the field ‘Apply Part Load Fraction to Speeds Greater than 1’ is No (equivalent to a single compressor), the average defrost power is calculated as follows:

<div>$${P_{defrost}} = {P_{defrost,n}}(SpeedRatio) + {P_{defrost,n - 1}}(1.0 - SpeedRatio)$$</div>

When the input for the field ’Apply Part Load Fraction to Speeds Greater than 1’ is Yes (equivalent to multiple compressors), the combined defrost energy is calculated as follows:

<div>$${P_{defrost}} = {P_{defrost,n}}(RTF) + {P_{defrost,n - 1}}(1.0 - RTF)$$</div>

where,

<span>${P_{defrost}}$</span>        = average defrost power used in Watt

RTF            = Run time fraction (SpeedRatio/Part-load Fraction) at Speed n

n Crankcase heater

There is no power need at higher speed operation.

#### Waste heat calculation

The waste heat generated by this coil object is calculated as:

<div>$${Q_{WasteHeat}} = (Fraction)(TempModifier)(HeatingPowe)$$</div>

where

Fraction                  = rated waste heat fraction of the energy input

TempModifier<sub>                  </sub> = waste heat modifier as a function of indoor and outdoor air dry-bulb temperature

#### Standard Rating of Multi-Speed DX Heating Coils

For multi-speed direct expansion heating coils, the industry standard ratings of Standard Rating Heating Seasonal Performance Factor (HSPF) are calculated according to NSI/AHRI Standard 210/240 (AHRI 2008). These standard ratings can be calculated using the user-entered information for the Coil:Heating:DX:MultiSpeed object.  According to Standard 210/240, the Standard Rating HSPF applies to air-to-air unitary heat pumps with rated heating capacities under 19,000 watts (65,000 Btu/h). The Heating Mode Test Conditions for Units Having two-capacity Compressor standard tests H0<sub>1</sub>, H1<sub>1</sub>, H2<sub>1</sub>, H3<sub>1</sub>, H1<sub>2</sub>, H2<sub>2</sub>, and H3<sub>2</sub> are also provided in Table 62. The rated Energy Efficiency Ratio (EER) is not calculated for any DX Heating Coils as this time. The equations required to calculate the net heating capacity and HSPF values are described next.

#### Standard Ratings Heating Capacity

*The Standard Rating (Net) Heating Capacity calculation is calculated using the same procedure as the single speed DX heating coils except the capacities are evaluated at the maximum speed only.  Refer to the standard ratings calculation for Coil:DX:Heating:SingelSpeed for description of the procedure.*

The Rated Supply Fan Power Per Volume Flow Rate is a user-entered value, with a default of 773.3 W/(m<sup>3</sup>/s)) if the user leaves this input field blank. The default value is taken from ANSI/ASHRAE Standard 210/240-2008 where it is defined for systems which do not have an Indoor Coil (Evaporator) fan furnished as part of the system. The test conditions in ANSI/AHRI Standard 210/240 vary the external static pressure (i.e., pressure drop associated with ductwork and other devices external to the indoor fan/coil section) seen by the supply air fan based on the standard rating cooling capacity. New input field Rated Supply Fan Power Per Volume Flow Rate for each speed will be added to the IDD.

#### Heating seasonal performance factors (HSPF) for Multi-Speed DX Coil

The following section describes the test condition for heating mode tests for Air-Source Heat Pumps, including heating-only heat pumps, and the equations required to calculate the HSPF. The HSPF for multi-speed compressor heat pumps in Btu/W-h is given by:

<div>$$HSPF{\rm{ = }}\frac{{\sum\limits_{\rm{j}}^{\rm{M}} {\frac{{{n_j}}}{N} \cdot BL\left( {{T_j}} \right)} }}{{\sum\limits_{\rm{j}}^{\rm{M}} {\frac{{{e_h}\left( {{T_j}} \right)}}{N}{\rm{ + }}} \sum\limits_{\rm{j}}^{\rm{M}} {\frac{{RH\left( {{T_j}} \right)}}{N}} }} \cdot {F_{def}}$$</div>



Where,

BL(T<sub>j</sub>)          =          the building space conditioning load corresponding to an outdoor temperature of T<sub>j</sub>; the heating season building load also depends on the generalized climatic region's outdoor design temperature and the design heating requirement, Btu/h.

e<sub>h</sub>(T<sub>j</sub>)/N        =          the ratio of the electrical energy consumed by the heat pump during periods of the space heating season when the outdoor temperature fell within the range represented by bin temperature T<sub>j</sub> to the total number of hours in the heating season (N), W. For heat pumps having a heat comfort controller, this ratio may also include electrical energy used by resistive elements to maintain a minimum air delivery temperature.

RH(T<sub>j</sub>)/N      =          the ratio of the electrical energy used for resistive space heating during periods when the outdoor temperature fell within the range represented by bin temperature T<sub>j</sub> to the total number of hours in the heating season (N),W. Resistive space heating is modeled as being used to meet that portion of the building load that the heat pump does not meet because of insufficient capacity or because the heat pump automatically turns off at the lowest outdoor temperatures.

T<sub>j</sub>    =          the outdoor bin temperature, °C. Outdoor temperatures are “binned” such that calculations are only performed based one temperature within the bin. Bins of 2.78°C are used.

n<sub>j</sub>/N =          Fractional bin hours for the heating season; the ratio of the number of hours during the heating season when the outdoor temperature fell within the range represented by bin temperature T<sub>j</sub> to the total number of hours in the heating season, dimensionless, given in Table 60.

j     =          the bin number, dimensionless.

M   =          for each generalized climatic region, the total number of temperature bins, dimensionless. Referring to Table 60, M is the highest bin number (j) having a nonzero entry for the fractional bin hours for the generalized climatic region of interest.

<span>${F_{def}}$</span>= The demand defrost credit described in section 3.9.2 of AHRI Std. 210/240-2008, dimensionless.  For simplification, assigned a value of 1 for timed defrost control and a value of 1.03 for demand defrost control.

The building heating load is calculated as follows:

<div>$$BL\left( {{T_j}} \right){\rm{ = }}\frac{{{\rm{18}}{\rm{.33 - }}{T_j}}}{{{\rm{18}}{\rm{.33 - }}{T_{OD}}}} \cdot C \cdot DHR$$</div>

The minimum and maximum design heating requirements for each generalized climate regions are given by:

<div>$$
  {\rm{DH}}{{\rm{R}}_{\min }}{\rm{ = }}\left\{ 
    \begin{array}{l}
      {\rm{\dot Q}}_h^{k = 2}{\rm{(8}}{\rm{.33)}} \cdot \left[ {\frac{{{\rm{18}}{\rm{.33 - }}{{\rm{T}}_{{\rm{OD}}}}}}{{{\rm{33}}{\rm{.33}}}}} \right]{\rm{,}}\quad {\rm{for}}\,{\rm{regions}}\,{\rm{I,}}\,{\rm{II,}}\,{\rm{III,}}\,{\rm{IV,}}\,\,{\rm{VI}} \\
      {\rm{\dot Q}}_h^{k = 2}{\rm{(8}}{\rm{.33),}}\quad {\rm{for}}\,{\rm{region}}\,{\rm{V}}
    \end{array}
  \right\}
$$</div>

and

<div>$$
  \rm{DH}}{{\rm{R}}_{\max }}{\rm{ = }}\left\{
    \begin{array}{l}
      \rm{2} \cdot {\rm{\dot Q}}_h^{k = 2}{\rm{(8}}{\rm{.33)}} \cdot \left[ {\frac{{{\rm{18}}{\rm{.33 - }}{{\rm{T}}_{{\rm{OD}}}}}}{{{\rm{33}}{\rm{.33}}}}} \right]{\rm{,}}\quad {\rm{for}}\,{\rm{regions}}\,{\rm{I,}}\,{\rm{II,}}\,{\rm{III,}}\,{\rm{IV,}}\,\,{\rm{VI}} \\
      \rm{2}{\rm{.2}} \cdot {\rm{\dot Q}}_h^{k = 2}{\rm{(8}}{\rm{.33),}}\quad {\rm{for}}\,{\rm{region}}\,{\rm{V}}
    \end{array}
  \right\}
$$</div>

Where,

C    =          0.77, a correction factor which tends to improve the agreement between calculated and measured building loads dimensionless.

DHR           =          the design heating requirement for each generalized climate region, Btu/h.

<span>$\dot Q_h^{k = 2}(8.33)$</span>=          the heating capacity determined from H1<sub>2</sub> test, (W)

The heating capacity delivered and electric power input of the heat pump when operating at minimum (low) compressor capacity and outdoor air temperature of *T<sub>j</sub>* is given by:

<div>$$
  {\rm{\dot Q}}_h^{k = 1}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{) = }}\left\{ 
    \begin{array}{l}
      {\rm{\dot Q}}_h^{k = 1}(8.33) + \;\frac{{\left[ {{\rm{\dot Q}}_h^{k = 1}{\rm{(16}}{\rm{.67) - \dot Q}}_h^{k = 1}{\rm{(8}}{\rm{.33)}}} \right] \cdot \left( {{{\rm{T}}_{\rm{j}}} - 8.33} \right)}}{{\left( {16.67 - 8.33} \right)}}\,{\rm{if}}\,{{\rm{T}}_{\rm{j}}} \ge 4.44{\rm{^\circ C}} \\
      {\rm{\dot Q}}_h^{k = 1}( - 8.33) + \;\frac{{\left[ {{\rm{\dot Q}}_h^{k = 1}{\rm{(1}}{\rm{.67) - \dot Q}}_h^{k = 1}{\rm{( - 8}}{\rm{.33)}}} \right] \cdot \left( {{{\rm{T}}_{\rm{j}}} + 8.33} \right)}}{{\left( {1.67 + 8.33} \right)}}\,{\rm{if}}\, - 8.33{\rm{^\circ C}} \le {{\rm{T}}_{\rm{j}}} < 4.44{\rm{^\circ C}} \\
      {\rm{\dot Q}}_h^{k = 1}( - 8.33) + \;\frac{{\left[ {{\rm{\dot Q}}_h^{k = 1}{\rm{(8}}{\rm{.33) - \dot Q}}_h^{k = 1}{\rm{( - 8}}{\rm{.33)}}} \right] \cdot \left( {{{\rm{T}}_{\rm{j}}} + 8.33} \right)}}{{\left( {8.33 + 8.33} \right)}}\,{\rm{if }}{{\rm{T}}_{\rm{j}}} <  - 8.33{\rm{^\circ C}}\,
    \end{array}
  \right\}
$$</div>

<div>$$
  {\rm{\dot E}}_h^{k = 1}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{) = }}\left\{
    \begin{array}{l}
      {\rm{\dot E}}_h^{k = 1}(8.33) + \;\frac{{\left[ {{\rm{\dot E}}_h^{k = 1}{\rm{(16}}{\rm{.67) - \dot E}}_h^{k = 1}{\rm{(8}}{\rm{.33)}}} \right] \cdot \left( {{{\rm{T}}_{\rm{j}}} - 8.33} \right)}}{{\left( {16.67 - 8.33} \right)}}\,{\rm{if}}\,{{\rm{T}}_{\rm{j}}} \ge 4.44{\rm{^\circ C}} \\
      {\rm{\dot E}}_h^{k = 1}( - 8.33) + \;\frac{{\left[ {{\rm{\dot E}}_h^{k = 1}{\rm{(1}}{\rm{.67) - \dot E}}_h^{k = 1}{\rm{( - 8}}{\rm{.33)}}} \right] \cdot \left( {{{\rm{T}}_{\rm{j}}} + 8.33} \right)}}{{\left( {1.67 + 8.33} \right)}}\,{\rm{if}}\, - 8.33{\rm{^\circ C}} \le {{\rm{T}}_{\rm{j}}} < 4.44{\rm{^\circ C}} \\
      {\rm{\dot E}}_h^{k = 1}( - 8.33) + \;\frac{{\left[ {{\rm{\dot E}}_h^{k = 1}{\rm{(8}}{\rm{.33) - \dot E}}_h^{k = 1}{\rm{( - 8}}{\rm{.33)}}} \right] \cdot \left( {{{\rm{T}}_{\rm{j}}} + 8.33} \right)}}{{\left( {8.33 + 8.33} \right)}}\,{\rm{if }}{{\rm{T}}_{\rm{j}}} <  - 8.33{\rm{^\circ C}}\,
    \end{array}
  \right\}
$$</div>

Where,

<span>${\rm{\dot Q}}_h^{k = 1}\left( {{\rm{16}}{\rm{.67}}} \right),\,{\rm{and}}\,{\rm{\dot E}}_h^{k = 1}\left( {{\rm{16}}{\rm{.67}}} \right)$</span> are determined from H0<sub>1</sub> test and

<span>${\rm{\dot Q}}_h^{k = 1}\left( {{\rm{8}}{\rm{.33}}} \right),\,{\rm{and}}\,{\rm{\dot E}}_h^{k = 1}\left( {{\rm{8}}{\rm{.33}}} \right)$</span> are determined from H1<sub>1</sub> test and

<span>${\rm{\dot Q}}_h^{k = 1}\left( {{\rm{1}}{\rm{.67}}} \right),\,{\rm{and}}\,{\rm{\dot E}}_h^{k = 1}\left( {{\rm{1}}{\rm{.67}}} \right)$</span> are determined from H2<sub>1</sub> test, and

<span>${\rm{\dot Q}}_h^{k = 1}\left( {{\rm{ - 8}}{\rm{.33}}} \right),\,{\rm{and}}\,{\rm{\dot E}}_h^{k = 1}\left( {{\rm{ - 8}}{\rm{.33}}} \right)$</span> are determined from H3<sub>1</sub> test.

An alternative to conducting or evaluating the performance at H2<sub>1</sub> test is to approximate the capacity and electric power inputs as follows:

<div>$${\rm{\dot Q}}_h^{k = 1}\left( {{\rm{1}}{\rm{.67}}} \right) = 0.9 \cdot \left\{ {{\rm{\dot Q}}_h^{k = 1}\left( {{\rm{ - 8}}{\rm{.33}}} \right) + 0.6\left[ {{\rm{\dot Q}}_h^{k = 1}\left( {{\rm{8}}{\rm{.33}}} \right) - {\rm{\dot Q}}_h^{k = 1}\left( {{\rm{ - 8}}{\rm{.33}}} \right)} \right]} \right\}$$</div>

<div>$${\rm{\dot E}}_h^{k = 1}\left( {{\rm{1}}{\rm{.67}}} \right) = 0.985 \cdot \left\{ {{\rm{\dot E}}_h^{k = 1}\left( {{\rm{ - 8}}{\rm{.33}}} \right) + 0.6\left[ {{\rm{\dot E}}_h^{k = 1}\left( {{\rm{8}}{\rm{.33}}} \right) - {\rm{\dot E}}_h^{k = 1}\left( {{\rm{ - 8}}{\rm{.33}}} \right)} \right]} \right\}$$</div>

The heating capacity delivered and electric power input of the heat pump when operating at maximum (high) compressor speed and outdoor air temperature of *T<sub>j</sub>* is given by:

<div>$$\dot Q_h^{k = 2}({T_j}) = \left\{ \begin{array}{l}\dot Q_h^{k = 2}( - 8.33) + \frac{{\left[ {\dot Q_h^{k = 2}(8.33) - \dot Q_h^{k = 2}( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{8.33 + 8.33}},\quad IF\,{T_j} \ge 7.2^\circ C\,or\,{T_j} \le  - 8.33^\circ C\\\dot Q_h^{k = 2}( - 8.33) + \frac{{\left[ {\dot Q_h^{k = 2}(1.67) - \dot Q_h^{k = 2}( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{1.67 + 8.33}},\quad IF\, - 8.33^\circ C < {T_j} < 7.2^\circ C\end{array} \right.$$</div>

<div>$$\dot E_h^{k = 2}({T_j}) = \left\{ \begin{array}{l}\dot E_h^{k = 2}( - 8.33) + \frac{{\left[ {\dot E_h^{k = 2}(8.33) - \dot E_h^{k = 2}( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{8.33 + 8.33}},\quad IF\,{T_j} \ge 7.2^\circ C\,or\,{T_j} \le  - 8.33^\circ C\\\dot E_h^{k = 2}( - 8.33) + \frac{{\left[ {\dot E_h^{k = 2}(1.67) - \dot E_h^{k = 2}( - 8.33)} \right] \cdot \left( {{T_j} + 8.33} \right)}}{{1.67 + 8.33}},\quad IF\, - 8.33^\circ C < {T_j} < 7.2^\circ C\end{array} \right.$$</div>

Where,

<span>$\dot Q_h^{k = 2}\left( {{\rm{8}}{\rm{.33}}} \right),\,{\rm{and}}\,\dot E_h^{k = 2}\left( {{\rm{8}}{\rm{.33}}} \right)$</span>are determined from H1<sub>2</sub> test

<span>$\dot Q_h^{k = 2}\left( {{\rm{1}}{\rm{.67}}} \right),\,{\rm{and}}\,\dot E_h^{k = 2}\left( {{\rm{1}}{\rm{.67}}} \right)$</span>are determined from H2<sub>2</sub> test

<span>$\dot Q_h^{k = 2}\left( {{\rm{ - 8}}{\rm{.33}}} \right),\,{\rm{and}}\,\dot E_h^{k = 2}\left( {{\rm{ - 8}}{\rm{.33}}} \right)$</span>are determined from H3<sub>2</sub> test

The electric energy used by the heat pumps differs depending up on whether the heat pump would operate at low (minimum) capacity, cycle between successive lower and higher speed capacities, or operate at high speed capacity in responding to the building load.  The procedure for each operation cases is described next.

*Case 1*:  The steady state heating capacity when the unit is operating at minimum or low capacity, i.e., when the building heating load is less or equal to the low capacity:

<div>$$\dot Q_c^{k = 1}\left( {{T_j}} \right) \ge BL\left( {{T_j}} \right)$$</div>

<div>$$\frac{{{{\rm{e}}_h}\left( {{{\rm{T}}_{\rm{j}}}} \right)}}{{\rm{N}}}{\rm{ = }}\frac{{{{\rm{X}}^{k = 1}}\left( {{{\rm{T}}_{\rm{j}}}} \right) \cdot {\rm{\dot E}}_h^{k = 1}\left( {{{\rm{T}}_{\rm{j}}}} \right) \cdot {\rm{\delta }}\left( {{{\rm{T}}_{\rm{j}}}} \right)}}{{PL{F_j}}} \cdot \frac{{{{\rm{n}}_{\rm{j}}}}}{{\rm{N}}}$$</div>

<div>$$\frac{{RH\left( {{{\rm{T}}_{\rm{j}}}} \right)}}{{\rm{N}}}{\rm{ = }}BL\left( {{{\rm{T}}_{\rm{j}}}} \right) \cdot \left[ {{\rm{1 - }}{{\rm{\delta }}^\prime}\left( {{{\rm{T}}_{\rm{j}}}} \right)} \right] \cdot \frac{{{{\rm{n}}_{\rm{j}}}}}{{\rm{N}}}$$</div>

<div>$${{\rm{X}}^{k = 1}}\left( {{{\rm{T}}_{\rm{j}}}} \right){\rm{ = MIN}}\left\{ \begin{array}{l}BL\left( {{{\rm{T}}_{\rm{j}}}} \right){\rm{/\dot Q}}_h^{k = 1}\left( {{{\rm{T}}_{\rm{j}}}} \right)\\1.0\end{array} \right\}$$</div>

<div>$${\delta ^\prime}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{) = }}\left\{ \begin{array}{l}0,\quad {\rm{if}}\,{{\rm{T}}_{\rm{j}}}\, \le \,{{\rm{T}}_{{\rm{off}}}}\,\\1/2,\quad {\rm{if}}\,{{\rm{T}}_{{\rm{off}}}} < {{\rm{T}}_{\rm{j}}}\, \le \,{{\rm{T}}_{{\rm{on}}}}\\1,\quad {\rm{if}}\,{{\rm{T}}_{\rm{j}}}\, > \,{{\rm{T}}_{{\rm{on}}}}\end{array} \right\}$$</div>

<div>$$PL{F_{\rm{j}}}{\rm{ = 1 - }}C_D^h \cdot \left[ {{\rm{1 - }}{{\rm{X}}^{k = 1}}{\rm{(}}{T_j}{\rm{)}}} \right]$$</div>

<div>$$C_D^h{\rm{ = MIN}}\left\{ \begin{array}{l}{\rm{C}}_{\rm{D}}^{\rm{h}},\,{\rm{calculated}}\,{\rm{using}}\,{\rm{Equation}}\,{\rm{24}}\\0.25\end{array} \right\}$$</div>

*Case 2*:  The unit cycles between the low (minimum) and high (maximum) compressor capacity to meet the building heating load at outdoor air temperature *T<sub>j</sub>*.  That is, the heating building load is between the unit low and high compressor capacities:

<div>$$\dot Q_h^{k = 1}({T_j}) < BL({T_j}) < \dot Q_h^{k = 2}({T_j})$$</div>

<div>$$\frac{{{e_c}({T_j})}}{N} = \left[ {{X^{k = 1}}({T_j}) \cdot \dot E_h^{k = 1}({T_j}) + {X^{k = 2}}({T_j}) \cdot \dot E_h^{k = 2}({T_j})} \right] \cdot {\delta ^\prime}({T_j}) \cdot \frac{{{n_j}}}{N}$$</div>

<div>$$\frac{{RH\left( {{{\rm{T}}_{\rm{j}}}} \right)}}{{\rm{N}}}{\rm{ = BL}}\left( {{{\rm{T}}_{\rm{j}}}} \right) \cdot \left[ {{\rm{1 - }}{{\rm{\delta }}^\prime}\left( {{{\rm{T}}_{\rm{j}}}} \right)} \right] \cdot \frac{{{n_j}}}{N}$$</div>

<div>$${\delta ^\prime}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{) = }}\left\{ \begin{array}{l}0,\quad {\rm{if}}\,{{\rm{T}}_{\rm{j}}}\, \le \,{{\rm{T}}_{{\rm{off}}}}\,\\ {\textstyle{1 \over 2}},\quad {\rm{if}}\,{{\rm{T}}_{{\rm{off}}}} < {{\rm{T}}_{\rm{j}}}\, \le \,{{\rm{T}}_{{\rm{on}}}}\\ 1,\quad {\rm{if}}\,{{\rm{T}}_{\rm{j}}}\, > \,{{\rm{T}}_{{\rm{on}}}}\end{array} \right\}$$</div>

<div>$${X^{k = 1}}({T_j}) = \frac{{\dot Q_h^{k = 2}({T_j}) - BL({T_j})}}{{\dot Q_h^{k = 2}({T_j}) - \dot Q_h^{k = 1}({T_j})}}$$</div>

<div>$${X^{k = 2}}({T_j}) = 1 - {X^{k = 1}}({T_j})$$</div>

*Case 3*:  The steady-state heating capacity when the unit is operating continuously at high or maximum compressor capacity at outdoor air temperature *T<sub>j</sub>*. The building heating load is greater than the available capacity at maximum or high compressor capacity:

<div>$$BL\left( {{T_j}} \right) \ge \dot Q_c^{k = 2}\left( {{T_j}} \right)$$</div>

For units when operating continuously at maximum compressor speed (k=2) speed at temperature *T<sub>j</sub>*, the delivered heating capacity and electric power inputs are calculated as follows:

<div>$$\frac{{{e_c}({T_j})}}{N} = \left[ {\dot E_h^{k = 2}({T_j}) \cdot {\delta ^``}({T_j})} \right] \cdot \frac{{{n_j}}}{N}$$</div>

<div>$$\frac{{RH\left( {{T_j}} \right)}}{N}{\rm{ = }}\left\{ {BL\left( {{{\rm{T}}_{\rm{j}}}} \right) - \left[ {{\rm{\dot Q}}_h^{k = 2}\left( {{{\rm{T}}_{\rm{j}}}} \right) \cdot {{\rm{\delta }}^``}\left( {{{\rm{T}}_{\rm{j}}}} \right)} \right]} \right\} \cdot \frac{{{n_j}}}{N}$$</div>

<div>$${\delta ^``}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{) = }}\left\{ \begin{array}{l}0,\quad {\rm{if}}\,{{\rm{T}}_{\rm{j}}}\, \le \,{{\rm{T}}_{{\rm{off}}}}\,{\rm{or}}\,\frac{{{\rm{\dot Q}}_h^{k = 2}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{)}}}}{{\dot E_h^{k = 2}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{)}}}}\, < \,1\\ {\textstyle{1 \over 2}},\quad {\rm{if}}\,{{\rm{T}}_{{\rm{off}}}} < {{\rm{T}}_{\rm{j}}}\, \le \,{{\rm{T}}_{{\rm{on}}}}\,{\rm{and}}\,\frac{{{\rm{\dot Q}}_h^{k = 2}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{)}}}}{{\dot E_h^{k = 2}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{)}}}} \ge \,1\;\\1,\quad {\rm{if}}\,{{\rm{T}}_{\rm{j}}}\, > \,{{\rm{T}}_{{\rm{on}}}}\,{\rm{and}}\,\frac{{{\rm{\dot Q}}_h^{k = 2}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{)}}}}{{\dot E_h^{k = 2}{\rm{(}}{{\rm{T}}_{\rm{j}}}{\rm{)}}}} \ge \,1\;\end{array} \right\}$$</div>

X(T<sub>j</sub>)            =          the heating mode load factor for temperature bin j, (-)

<span>${{\rm{\dot Q}}_{\rm{h}}}\left( {{{\rm{T}}_{\rm{j}}}} \right)$</span>     =          space heating capacity of the heat pump when operating at outdoor temperature T<sub>j</sub>, W

<span>${{\rm{\dot E}}_{\rm{h}}}\left( {{{\rm{T}}_{\rm{j}}}} \right)$</span>      =          electrical power consumption of the heat pump when operating at outdoor temperature T<sub>j</sub>, W

<span>${\rm{\delta }}\left( {{{\rm{T}}_{\rm{j}}}} \right)$</span>        =          the heat pump low temperature cut-off factor, (-)

T<sub>off</sub>  =          the outdoor temperature when the compressor is automatically shut off, °C. (If no such temperature exists, Tj is always greater than T<sub>off</sub> and T<sub>on</sub>).

T<sub>on</sub>  =          the outdoor temperature when the compressor is automatically turned back on, if applicable, following an automatic shut-off, °C.

Table 62. Heating Mode Test Conditions for Units Having Two-Capacity Compressor
 &lt;&lt; Source: Table 11, AHRI Standard 210-240, 2008 &gt;&gt;

Test description

Air Entering Indoor Unit

Temperature (°F)

Air Entering Outdoor

Unit Temperature (°F)

Compressor

Speed

Heating Air Volume Rate

Dry Bulb

⁰C     ⁰F

Wet Bulb

⁰C      ⁰F

Dry Bulb

⁰C     ⁰F

Wet Bulb

⁰C      ⁰F

H01 Test

(required, steady)

21.1   (70)

15.6  (60)max

16.7   (62)

18.3  (56.5)

Low

Heating

Minimum(1)

H12 Test

(required, steady)

21.1   (70)

15.6  (60)max

8.33   (47)

6.11  (43)

High

Heating

Full-Load(2)

H1C2 Test

(required, cyclic)

21.1   (70)

15.6  (60)max

8.33   (47)

6.11  (43)

High



H11 Test

(required, steady)

21.1   (70)

15.6  (60)max

8.33   (47)

6.11  (43)

Low

Heating

Minimum(1)

H1C1 Test

(required, cyclic)

21.1   (70)

15.6  (60)<sup>max</sup>

8.33   (47)

6.11  (43)

Low



H22 Test

(required)

21.1   (70)

15.6  (60)<sup>max</sup>

1.67   (35)

0.56  (33)

High

Heating Full-

Load

H21 Test

(required)

21.1   (70)

15.6  (60)<sup>max</sup>

1.67   (35)

0.56  (33)

Low

Heating

Minimum

H32 Test

(required, steady)

21.1   (70)

15.6  (60)<sup>max</sup>

-8.33   (17)

-9.44  (15)

High

Heating Full-

Load

H31 Test

(required, steady)

21.1   (70)

15.6  (60)<sup>max</sup>

-8.33  (17)

-9.44  (15)

Low

Heating

Minimum

#### References:

AHRI 2008. ANSI/AHRI Standard 210/240: 2008 Standard for Performance Rating of Unitary Air-Conditioning & Air-Source Heat Pump Equipment.  Arlington, VA:  Air-Conditioning, Heating, and Refrigeration Institute.

See the references for the single speed DX heating coil earlier in this document.

### Variable Speed DX Heating Coil

#### Overview

The latest technology for commercial air conditioners and air-to-air heat pumps can utilize a variable speed compressor with a variable speed indoor blower and outdoor fan. The indoor and outdoor air flow rates are usually a function of the compressor speed. Refrigerant mass flow rate is a function of compressor speed as well as outdoor heat exchanger entering air temperature and indoor dry bulb or wet bulb. The control system adjusts the equipment capacity based on zone temperature measurements relative to the thermostat set point. The control logic determines what compressor speed is required to control to the zone temperature requirement in response to increased or decreased capacity (heating or cooling load). The compressor, fan and blower speeds are not discrete values and can be considered to vary infinitesimally between the minimum and maximum compressor speed. At the minimum compressor speed (which is different for heating and cooling), for a continuous fan, the supply airflow is fixed and the unit will have to cycle for reduced part loads below this point. For a cycling fan, the fan will cycle with the compressor.

Similar to variable-speed water source heat pump, we expand the number of speed levels and the corresponding curve sets up to ten. The number of speed levels is selectable by the user. The user can provide speed levels at any number from 1 to 10. In the case that the given speed levels are above 1, the model would do linear interpolation between neighboring speeds. The more curves, the more accurate. Furthermore, using linear interpolation and inputting air flow rates at individual speed levels facilitates arbitrary relationships of flow rate as a function of the compressor speed level.

The Coil:Heating:DX:VariableSpeed object will simulate the performance of a DX heating coil used in combination with a variable-speed air-to-air heat pump. It will fit into the parent objects of AirLoopHVAC:UnitaryHeatPump:AirToAir and

ZoneHVAC:PackagedTerminalHeatPump, etc.

The rated conditions for obtaining the capacities and COPs  are at indoor dry-bulb temperature of 21.1 ˚C (70 ˚F) and the source side entering air temperature of 8.3 ˚C (47 ˚F). Some equations are provided below to help explain the function of the various performance curves and data fields.

#### Model Description

The Coil:Heating:DX:VariableSpeed object is modeled similar to Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit. Of course, rather than referencing a water source evaporator, the new coil object references an air source and has defrosting operation. The evaporator entering air temperature is used in  lieu of the entering  water temperature.

It shall be noted for the capacity and flow rate inputs, two fields are autosizable, which are Rated Heating Capacity at the Selected Nominal Speed Level and the Rated Volumetric Air Flow Rate at the Selected Nominal Speed Level. They are used to scale the performances of a specific unit and correlate with the actual loop flow. Except these two fields, all other capacity and flow rate inputs at individual speed levels should be directly obtained from Reference Unit catalog data, specific to an actual unit.

The Rated Heating Capacity at Selected Nominal Speed Level contains the rated capacity to match the building heating load at the design day.  The rated heating capacity is used to determine a capacity scaling factor, as compared to the Reference Unit capacity at the nominal speed level.

<div>$${\rm{CapacityScaleFactor}} = \frac{{{\rm{RatedTotalHeatingCapacity}}}}{{{\rm{ReferenceUnitTotalHeatingCapacity}}@{\rm{NominalSpeedLevel}}}}$$</div>

And then, this scaling factor is used to determine capacities at rated conditions for other speed levels, as below:

<div>$$\begin{array}{l}{\rm{RatedTotalHeatingCapacity}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right) = {\rm{CapacityScaleFactor}} \times \\ \quad \quad \quad {\rm{ReferenceUnitTotalHeatingCapacity}}@{\rm{SpeedLevel}}({\rm{x}})\end{array}$$</div>

The Rated Volumetric Air Flow Rate is used to determine an internal scaling factor, and calculate the air flow rates in the parent objects, as follows:

<div>$${\rm{AirFlowScaleFactor}} = \frac{{{\rm{RatedVolumetricAirFlowRate}}}}{{{\rm{ReferenceUnitVolAirFlowRate}}@{\rm{NominalSpeedLevel}} \times {\rm{CapacityScaleFactor}}}}$$</div>

And the loop volumetric air flow rates at various speed levels in the parent objects are calculated as below:

<div>$$\begin{array}{l}{\rm{LoopVolumetricAirFlowRate}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right) = {\rm{AirFlowScaleFactor}} \times \\\quad \quad \quad {\rm{ReferenceUnitVolAirFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) \times {\rm{CapacityScaleFactor}}\end{array}$$</div>

If the volumetric air flow rate at one speed level is higher than the flow rate allowed by the fan in the parent object, the flow rate will be set back to the fan flow rate.

If <span>${\rm{AirFlowScaleFactor}}$</span> equals unity, the loop air flow rate becomes the design flow rate of the Reference Unit (after scaled by the rated heating capacity). The Rated Volumetric Air Flow Rate is introduced here to correlate with the actual flow rate in the air loop, in case that it differs from the design specification. Certainly, it is recommended that the Rated Volumetric Air Flow Rate is selected in the way that <span>${\rm{AirFlowScaleFactor}}$</span> is unity, so as to get more accurate results from the performance curves.

#### Performance curves:

This object includes 4 curve objects at each individual speed level.

1)  Total heating capacity modifier curve (function of temperature).

2)  Total heating capacity modifier curve (function of air flow fraction).

3)  Energy input ratio (EIR) modifier curve (function of temperature).

4)  Energy input ratio (EIR) modifier curve (function of air flow fraction).

The flow fraction modifier curves are used as a placeholder, to account for off-design flow rates if needed. If the manufacturer doesn’t provide off-design performances, we can simply use a default modification multiplier of 1.0.

At the lowest speed, there will be one additional performance curve to account for the part-load condition, i.e.

5)  Part load fraction correlation (function of part load ratio).

1) Total heating capacity modifier curve (function of temperature)

The total heating capacity modifier as a function of temperature curve (CAP-FT) is a biquadratic curve with two independent variables: dry-bulb temperature of the air entering the heating coil and the air DB temperature entering the evaporator coil. The output of this curve is multiplied by the rated total heating capacity at the speed, to give the total heating capacity at the specific entering air temperatures at which the ASHP unit is operating (i.e., at temperatures different from the rating point temperatures). 

<div>$${\rm{TotCapTempModFac}} = {\rm{a}} + {\rm{b*D}}{{\rm{B}}_{\rm{i}}} + {\rm{c*DB}}_{\rm{i}}^2 + {\rm{d*D}}{{\rm{B}}_{\rm{o}}} + {\rm{e*D}}{{\rm{B}}_{\rm{o}}}^2 + {\rm{f*D}}{{\rm{B}}_{\rm{i}}}{\rm{*D}}{{\rm{B}}_{\rm{o}}}$$</div>

where

DB<sub>i</sub> = dry-bulb temperature of the air entering the heating coil, °C

DB<sub>o</sub> = dry-bulb temperature of the air entering the outdoor coil, °C

a-f = regression curve-fit coefficients

2) Total heating capacity modifier curve (function of air flow fraction)

<div>$${\rm{TotCapAirFlowModFac}} = {\rm{a}} + {\rm{b*f}}{{\rm{f}}_{\rm{a}}} + {\rm{c*ff}}_{\rm{a}}^2 + {\rm{d*ff}}_{\rm{a}}^3$$</div>

where

ff<sub>a</sub> = actual air mass flow rate/design air mass flow rate, at one speed level;

<div>$$\begin{array}{l}{\rm{DesignAirMassFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) = {\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}({\rm{x}}) \times \\\quad \quad \quad {\rm{CapacityScaleFactor}}\end{array}$$</div>

a-d = regression curve-fit coefficients, if no data available for the correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

3) Energy input ratio (EIR) modifier curve (function of temperature)

The energy input ratio modifier curve as a function of temperature (EIR-FT) is a biquadratic curve with two independent variables DB<sub>i</sub>  and DB<sub>o</sub>. The output of this curve is multiplied by the rated EIR at the speed (inverse of the rated COP), to give the EIR at the specific entering air temperatures at which the ASHP coil unit is operating (i.e., at temperatures different from the rating point temperatures).

<div>$${\rm{EIRTempModFac}} = {\rm{a}} + {\rm{b*D}}{{\rm{B}}_{\rm{i}}} + {\rm{c*DB}}_{\rm{i}}^2 + {\rm{d*D}}{{\rm{B}}_{\rm{o}}} + {\rm{e*D}}{{\rm{B}}_{\rm{o}}}^2 + {\rm{f*D}}{{\rm{B}}_{\rm{i}}}{\rm{*D}}{{\rm{B}}_{\rm{o}}}$$</div>

where

a-f = regression curve fit coefficients.

4) Energy input ratio (EIR) modifier curve (function of air flow fraction)

<div>$${\rm{EIRAirFlowModFac}} = {\rm{a}} + {\rm{b*f}}{{\rm{f}}_{\rm{a}}} + {\rm{c*ff}}_{\rm{a}}^2 + {\rm{d*ff}}_{\rm{a}}^3$$</div>

where

a-d = regression curve-fit coefficients, if no data available for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

5) Part load fraction correlation (function of part load ratio)

This field defines the name of a quadratic or cubic performance curve (Ref: Performance Curves) that parameterizes the variation of electrical power input to the unit as a function of the part load ratio (PLR, heating load/steady-state heating capacity for Speed 1),

<div>$${\rm{PartLoadFrac}} = {\rm{a}} + {\rm{b*PLR}} + {\rm{c*PL}}{{\rm{R}}^2} + {\rm{d*PL}}{{\rm{R}}^3}$$</div>

And

RTF = (PLR/PartLoadFrac) = runtime fraction of the heating coil.

The part load fraction (PLF) correlation accounts for efficiency losses due to compressor cycling. The part load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the compressor runs continuously for the simulation timestep). For PLR values between 0 and 1 (0 &lt;= PLR &lt; 1), the following rules apply:

PLF &gt;= 0.7 and PLF &gt;= PLR

If PLF &lt; 0.7, the program resets the PLF value to 0.7, and the simulation proceeds. The runtime fraction of the coil is defined as PLR/PLF. If PLF &lt; PLR, the runtime fraction of the coil is limited to 1.0. A typical part load fraction correlation would be:

<div>$${\rm{PLF}} = 0.85 + 0.15 \times {\rm{PLR}}$$</div>

If the user wishes to model no efficiency degradation due to compressor cycling, the part load fraction correlation should be defined as follows:

<div>$${\rm{PLF}} = 0.85 + 0.0 \times {\rm{PLR}}$$</div>

#### Lowest Speed Operation:

The lowest speed operation of the variable-speed DX heating coil is similar to the single speed DX heating coil. The total (gross) heating capacity of the variable-speed DX coil is calculated as follows:

<div>$$\begin{array}{l}{{\rm{Q}}_{{\rm{total}},1}} = {\rm{RatedTotalHeatingCapacity}}@{\rm{SpeedLevel}}\left( 1 \right){\rm{*}}\\\quad \quad \quad {\rm{TotCapTemModFa}}{{\rm{c}}_1}{\rm{*TotCapAirFlowModFa}}{{\rm{c}}_1}\end{array}$$</div>

And the EIR is calculated as:

<div>$${\rm{EI}}{{\rm{R}}_1} = \frac{{1.0}}{{{\rm{ReferenceUnitCOP}}@{\rm{Speed}}(1)}}{\rm{*EIRTempModFa}}{{\rm{c}}_1}{\rm{*EIRAirFlowModFa}}{{\rm{c}}_1}$$</div>

And the power consumption including the compressor, outdoor fan and accessories (not including indoor fan power) is,

<div>$${\rm{Powe}}{{\rm{r}}_1} = {{\rm{Q}}_{{\rm{total}},1}}{\rm{*EI}}{{\rm{R}}_1}{\rm{*RTF}}$$</div>

The fraction of the actual air mass flow to the design air mass flow rate is calculated:

<div>$${\rm{f}}{{\rm{f}}_{{\rm{a}},1}} = \frac{{{\rm{actualairmassflowrate}}}}{{({\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}(1) \times {\rm{CapacityScaleFactor}})}}{\rm{}}$$</div>

#### Higher Speed Operation:

At the speed level between the lowest and the highest, there is no part-load loss. A parameter of speed ratio (SpeedRatio) is used to define the capacity partition between Speed x-1 and Speed x.

The design air flow rate at the speed ratio are given as following:

<div>$$\begin{array}{l}{\rm{DesignAirFlowRateSpeedRatio}} = {\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}\left( {{\rm{x}} - 1} \right){\rm{*}}\\\quad \quad \quad {\rm{CapacityScaleFactor*}}\left( {1{\rm{}}--{\rm{SpeedRatio}}} \right) + \\\quad \quad {\rm{ReferenceUnitAirMassFlowRate}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right){\rm{*}}\\\quad \quad \quad {\rm{CapacityScaleFactor*SpeedRatio}}\end{array}$$</div>

And the fractions of air flow is given:

<span>${\rm{f}}{{\rm{f}}_{{\rm{a}},{\rm{x}} - 1}}$</span>=<span>${\rm{f}}{{\rm{f}}_{{\rm{a}},{\rm{x}}}}$</span>= actual air mass flow rate/DesignAirFlowRateSpeedRatio

The total heating capacities and EIRs at Speed x-1 and Speed x are given:

<div>$${{\rm{Q}}_{{\rm{total}},{\rm{x}} - 1}} = {\rm{RatedTotalHeatingCapacity}}@{\rm{SpeedLevel}}\left( {{\rm{x}} - 1} \right){\rm{*TotCapTempModFa}}{{\rm{c}}_{{\rm{x}} - 1}}{\rm{*TotCapAirFlowModFa}}{{\rm{c}}_{{\rm{x}} - 1}}$$</div>

<div>$${{\rm{Q}}_{{\rm{total}},{\rm{x}}}} = {\rm{RatedTotalHeatingCapacity}}@{\rm{SpeedLevel}}\left( {\rm{x}} \right){\rm{*TotCapTempModFa}}{{\rm{c}}_{\rm{x}}}{\rm{*TotCapAirFlowModFa}}{{\rm{c}}_{\rm{x}}}$$</div>

<div>$${\rm{EI}}{{\rm{R}}_{{\rm{x}} - 1}} = \frac{{1.0}}{{{\rm{ReferenceUnitCOP}}@{\rm{Speed}}({\rm{x}} - 1)}}{\rm{EIRTempModFa}}{{\rm{c}}_{{\rm{x}} - 1}}{\rm{*EIRAirFlowModFa}}{{\rm{c}}_{{\rm{x}} - 1}}$$</div>

<div>$${\rm{EI}}{{\rm{R}}_{\rm{x}}} = \frac{{1.0}}{{{\rm{ReferenceUnitCOP}}@{\rm{Speed}}({\rm{x}})}}{\rm{EIRTempModFa}}{{\rm{c}}_{\rm{x}}}{\rm{*EIRAirFlowModFa}}{{\rm{c}}_{\rm{x}}}$$</div>

The total heating capacity at the corresponding speed ratio is:

<div>$${{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}} = \left( {1.0 - {\rm{SpeedRatio}}} \right){\rm{*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}} - 1}} + {\rm{SpeedRatio*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}}}}$$</div>

And the power consumption is

<div>$${\rm{Powe}}{{\rm{r}}_{{\rm{SpeedRatio}}}} = \left( {1.0 - {\rm{SpeedRatio}}} \right){\rm{*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}} - 1}}{\rm{*EI}}{{\rm{R}}_{{\rm{x}} - 1}} + {\rm{SpeedRatio*}}{{\rm{Q}}_{{\rm{total}},{\rm{x}}}}{\rm{*EI}}{{\rm{R}}_{\rm{x}}}$$</div>

The total amount of heat absorbed by the outdoor evaporator is calculated as:

<div>$${{\rm{Q}}_{{\rm{evap}},{\rm{SpeedRatio}}}} = {{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}} - {\rm{Powe}}{{\rm{r}}_{{\rm{SpeedRatio}}}}$$</div>

At last,

<div>$${{\rm{Q}}_{{\rm{total}},{\rm{SpeedRatio}}}} = {\rm{HeatingLoad}}$$</div>

If the speed reaches the highest level, the speed ratio becomes 1.0, and Speed x represents the highest speed.

#### Defrost Operation:

The defrost operation of a variable-speed DX heating coil is treated the same as the single-speed DX heating coil, except using the total heating capacity at the max speed level to replace the rated heating capacity of the single-speed DX coil, when a reverse-cycle defrost strategy is specified.

We keep the defrost energy input ratio (EIR) modifier curve (function of temperature) as the single speed DX heating coil. It is a biquadratic curve with two independent variables: outdoor air dry-bulb temperature and the heating coil entering air wet-bulb temperature. The output of this curve is multiplied by the heating coil capacity, the fractional defrost time period and the runtime fraction of the heating coil to give the defrost power at the specific temperatures at which the coil is operating. This curve is only required when a reverse-cycle defrost strategy is specified.

<div>$${\rm{DefrostEIRTempModFac}} = {\rm{a}} + {\rm{b*W}}{{\rm{B}}_{\rm{i}}} + {\rm{c*WB}}_{\rm{i}}^2 + {\rm{d*D}}{{\rm{B}}_{\rm{o}}} + {\rm{e*D}}{{\rm{B}}_{\rm{o}}}^2 + {\rm{f*W}}{{\rm{B}}_{\rm{i}}}{\rm{*D}}{{\rm{B}}_{\rm{o}}}$$</div>

where

WB<sub>i</sub> = wet-bulb temperature of the air entering the indoor coil, °C

DB<sub>o</sub> = dry-bulb temperature of the air entering the outdoor coil, °C

a-f = regression curve-fit coefficients

#### Crankcase Heater Operation:

It is the same as the single-speed DX heating coil.

### Desuperheater-Recovery-Based Air Heating Coil

#### Overview

The input object Coil:Heating:Desuperheater provides a model that simulates the thermal performance of a refrigerant-to-air heating coil and the parasitic electric consumption of its control valves or other auxiliary devices. The model assumes that the heating energy provided by this coil is reclaimed from the superheated refrigerant gas leaving a compressor and does not impact the performance of the compressor. The objects from which this coil can obtain its heating energy are:

Coil:Cooling:DX:SingleSpeed

Coil:Cooling:DX:TwoSpeed

Coil:Cooling:DX:TwoStageWithHumidityControlMode

Refrigeration:CompressorRack

Refrigeration:Condenser\* (multiple objects)

The heat reclaim recovery efficiency (specified by the user) defines the amount of heat available for use by this coil. Approximately 25-30% of the energy rejected by typical refrigeration system condensers is to reduce the superheated refrigerant vapor temperature to the condensing temperature. Recovery efficiencies higher than 30% may cause the refrigerant gas to condense which in turn impacts the performance of the refrigeration compressor rack. For this reason, the maximum heat reclaim recovery efficiency for this coil for all sources except the Refrigeration:Condenser:(Air, Water, or Evap)Cooled is 30%.For these refrigeration condensers, the amount of waste energy available in the superheat region is explicitly calculated, so for these condensers the maximum heat recovery efficiency is 90% of this superheat energy. Also, for these refrigeration condensers, an estimate of the temperature of the reclaimed heat source is made and compared to the inlet air temperature for the coil. If the reclaimed heat source is too cool, the amount of available reclaim energy is set to zero.

NOTE: When the heating source is a refrigeration compressor rack, the heat rejection location in the Refrigeration:CompressorRack object must be “Outdoors”. If the compressor rack heat rejection location is “Zone”, the total amount of heat rejection available for reclaim (e.g., by this desuperheater heating coil) is set to zero by the compressor rack object and the simulation proceeds.

The sources for the waste heat can also be used to supply other coils.  To avoid double-counting this waste heat, the amount available is corrected to reflect these other uses. For the three DX Cooling Coil sources, this correction is made within the same time step loop.  For the two refrigeration system sources, the correction is made using the value from the previous time step.

The desuperheater heating coil can be used in air loop simulations for various air heating applications. For example, it can be used as an air reheat coil for high humidity control in the compound objects AirLoopHVAC:Unitary:Furnace:HeatCool and AirLoopHVAC:UnitaryHeatCool (see High Humidity Control With HeatCool Configuration). For this application, the desuperheater coil is controlled based on the calculated heating load to maintain the zone temperature and humidity setpoints (load-based control). The source of reclaimed heat could be the direct expansion (DX) cooling coil itself (Coil:Cooling:DX:SingleSpeed) or a refrigerated case compressor rack (Refrigeration:CompressorRack).

The desuperheater heating coil can also be used with cooling/heating systems that maintain specific air loop (deck) temperatures. For example, Figure 171 shows a schematic diagram of the desuperheater heating coil used in conjunction with the CoilSystem:Cooling:DX object. The desuperheater heating coil must be placed downstream of the DX cooling coil when reclaiming heat from that cooling coil’s compressor(s). Desuperheating heating coil placement is unrestricted when reclaiming heat from a refrigeration compressor rack or refrigeration condenser. The configuration in Figure 171 shows the heating coil being controlled via a temperature-based strategy. In this example, the DX cooling coil could be used to the maintain its discharge air temperature at 11°C for zone dehumidification. The desuperheater heating coil could then raise the air dry-bulb temperature to 16°C providing a dry supply air stream at a temperature which does not require much additional heating by terminal units to meet the zone temperature setpoint.

![Schematic\_DesuperheaterHeatingCoil](EngineeringReference/media/image4016.png)

Figure 171. Desuperheater Heating Coil Used as a Reheat Coil with CoilSystem:Cooling:DX



Since the heating provided by the desuperheater coil is based on available waste heat from another system, the selection of fan control for the air loop equipment is essential for proper modeling. When the coil’s heating source is a direct expansion cooling coil (Coil:Cooling:DX:SingleSpeed, Coil:Cooling:DX:TwoSpeed, or Coil:Cooling:DX:TwoStageWithHumidityControlMode), the air loop’s fan control mode may be auto fan (cycling fan cycling coil), constant fan, or variable volume since the desuperheater heating coil cycles on/off with the DX cooling coil. When the heating source is a compressor rack or condenser for refrigerated cases, the supply air fan control should be either variable volume or constant fan since the desuperheater heating coil will typically be available the entire simulation time step.

NOTE: Use of the desuperheater heating coil in variable air volume systems should be done with caution since the model assumption of a fixed heat reclaim recovery efficiency may not be valid if the air flow rate over the coil varies significantly.

The following sections describe the calculations used for both the load-based and temperature-based strategies that can control the desuperheater heating coil.

#### Model Inputs

A minimum of seven inputs must be defined for the desuperheater heating coil. The user must input the coil’s name, an availability schedule name, and the heat reclaim recovery efficiency (default of 25%, with a range of 0% to 30% except for detailed refrigeration condensers which have a default of 80%, with a range of 0% to 90%). The next two inputs are the heating coil’s inlet and outlet air node names. The user must also enter the desuperheater heat source type and name which are validated when the model inputs are read into the program.

The final two fields are optional. The first of these is the coil temperature setpoint node name. This field is used when the desuperheater heating coil is controlled based on an air loop temperature and a setpoint manager (Ref. SetpointManager:\*) is used to place a temperature setpoint on this air node. The latter of these optional fields is the parasitic electric load. This field allows the user to define the electric energy use of parasitic equipment associated with the desuperheater heating coil (e.g. control valves).

#### Model Description

The model calculates the thermal performance of the heating coil based on the control strategy used. When a temperature setpoint node name is not entered, the control type is assumed to be load-based operation. This method should be used when this coil is specified as the air reheat coil for high humidity control with the compound object AirLoopHVAC:Unitary:Furnace:HeatCool or AirLoopHVAC:UnitaryHeatCool. If the temperature setpoint node name is entered, the control type is temperature-based operation. This method is used when the heating coil is controlled to maintain a dry-bulb temperature setpoint in an air loop.

#### Load-Based Operation

When load-based operation is selected, a load to be met by the heating coil is requested by the parent object (e.g., AirLoopHVAC:Unitary:Furnace:HeatCool). The model first calculates the heating coil capacity based on the total condenser waste heat rejected by the heating source.

<div>$${\dot Q_{coil}} = {\dot Q_{cond}} \times {\varepsilon_{reclaim}}$$</div>

where:

<span>${\dot Q_{coil}}$</span>          = heating capacity of the desuperheater coil (W)

<span>${\dot Q_{cond}}$</span>         = total amount of condenser waste heat rejected by the heating source (W)

<span>${\varepsilon_{reclaim}}$</span>       = heat reclaim recovery efficiency

The model then compares the coil’s heating capacity to the heating load being requested. If the heating capacity is greater than the heating load, then the amount of reclaimed heat (average heating rate over the simulation time step) is set equal to the requested load and the desuperheater heating coil will cycle off when the requested load is satisfied.

<div>$${\dot Q_{reclaim}} = {\dot Q_{load}}$$</div>

Otherwise the amount of reclaimed heat is set equal to the coil’s heating capacity and the desuperheater heating coil will operate the entire time that the waste heat source operates.

<div>$${\dot Q_{reclaim}} = {\dot Q_{coil}}$$</div>

In either case, the coil’s leaving air temperature is then calculated based on the amount of heat recovered and the air mass flow rate through the coil.

<div>$${T_{out}} = {T_{in}} + \frac{{{{\dot Q}_{reclaim}}}}{{\dot m{C_p}}}$$</div>

where:

<span>${T_{out}}$</span>= coil outlet air temperature (°C)

<span>${T_{in}}$</span>= coil inlet air temperature (°C)

                                                     <span>$$</span>

<span>$\dot m$</span>  = air mass flow rate through the heating coil (kg/s)

<span>${C_p}$</span> = specific heat of air entering the heating coil (J/kg-C)

A final calculation is made to determine the runtime fraction of the desuperheater heating coil. Since the maximum amount of reclaim heat available is dependent on the runtime fraction of the waste heat source, the runtime fraction of the desuperheater heating coil is the product of the waste heat source’s runtime fraction and the ratio of the amount of heat reclaimed to the desuperheater coil’s heating capacity.

<div>$$RT{F_{coil}} = RT{F_{source}}\left( {\frac{{{{\dot Q}_{reclaim}}}}{{{{\dot Q}_{coil}}}}} \right)$$</div>

where:

<span>$RT{F_{coil}}$</span>      = runtime fraction of the desuperheater heating coil

<span>$RT{F_{source}}$</span>    = runtime fraction of the desuperheater heating source

The heating coil’s outlet air humidity ratio and air mass flow rate are simply set equal to the coil inlet air values. The outlet air enthalpy is calculated based on the outlet air dry-bulb temperature and the outlet air humidity ratio.

<div>$${h_{out}}\, = \,PsyHFnTdbW({T_{out}},\,\,{\omega_{out}})$$</div>

where

<span>${h_{out}}$</span>         = enthalpy of the air leaving the heating coil, J/kg

<span>$\,{\omega_{out}}$</span>        = humidity ratio of the air leaving the heating coil, kg/kg

*PsyHFnTdbW* = EnergyPlus psychrometric function, returns enthalpy given dry-bulb temperature and humidity ratio

#### Temperature-Based Operation

When temperature-based operation is selected, the model first calculates the heating coil capacity based on the total condenser waste heat rejected by the heating source (same as for load-based operation).

<div>$${\dot Q_{coil}} = {\dot Q_{cond}} \times {\varepsilon_{reclaim}}$$</div>

The model then calculates the heating load required to reach the desired setpoint temperature.

<div>$${\dot Q_{load}} = \dot m{C_p}\left( {{T_{setpoint}} - {T_{in}}} \right)$$</div>

where:

<span>${\dot Q_{load}}$</span>          = heating load to meet the desired dry-bulb temperature setpoint (W)

<span>${T_{setpoint}}$</span>       = desired dry-bulb temperature setpoint (°C)

A comparison is then made to determine if the desuperheater heating coil should be energized. If the calculated load is less than or equal to 0, the coil’s inlet air dry-bulb temperature is at or above the setpoint. In this case the desuperheater heating coil is not active and the outlet air dry-bulb temperature is set equal to the inlet air dry-bulb temperature.

<div>$${\dot Q_{reclaim}} = 0$$</div>

<div>$${T_{out}}{\rm{ }} = {\rm{ }}{T_{in}}$$</div>

If the amount of heat required to meet the setpoint is larger than the desuperheater coil’s heating capacity, then the amount of reclaimed heat is set equal to the coil heating capacity and the outlet air dry-bulb temperature is calculated.

<div>$${\dot Q_{reclaim}} = {\dot Q_{coil}}$$</div>

<div>$${T_{out}} = {T_{in}} + \frac{{{{\dot Q}_{reclaim}}}}{{\dot m{C_p}}}$$</div>

If the amount of heat required to meet the setpoint is less than the desuperheater coil’s heating capacity, the amount of reclaimed heat is set equal to the calculated heating load and the outlet air dry-bulb temperature is set equal to the setpoint temperature. In this case the desuperheater heating coil will cycle off when the requested load is satisfied.

<div>$${\dot Q_{reclaim}} = {\dot Q_{load}}$$</div>

<div>$${T_{out}}\quad  = \;{T_{setpoint}}$$</div>

A final calculation is made to determine the runtime fraction of the desuperheater heating coil. Since the maximum amount of reclaim heat available is dependent on the runtime fraction of the waste heat source, the runtime fraction of the desuperheater heating coil is the product of the waste heat source’s runtime fraction and the ratio of the amount of heat reclaimed to the desuperheater coil’s heating capacity.

<div>$$RT{F_{coil}} = RT{F_{source}}\left( {\frac{{{{\dot Q}_{reclaim}}}}{{{{\dot Q}_{coil}}}}} \right)$$</div>

The heating coil’s outlet air humidity ratio and air mass flow rate are simply set equal to the coil inlet air values. The outlet air enthalpy is calculated based on the outlet air dry-bulb temperature and the outlet air humidity ratio.

<div>$${h_{out}}\, = \,PsyHFnTdbW({T_{out}},\,\,{\omega_{out}})$$</div>

#### Parasitic Electric Load

The parasitic electric load attributed to the desuperheater heating coil is calculated using the user-supplied input value (<span>${P_{parasitic}}$</span>) and the desuperheater heating coil runtime fraction calculated above.

<div>$${P_{elec}} = {P_{parasitic}} \times RT{F_{coil}}$$</div>

The model assumes that this electric load is small and does not contribute to heating the air stream.



#### References

Kosar, D. 2006. Dehumidification Enhancements, ASHRAE Journal, Vol. 48, No. 2, February 2006.

Kosar, D. et al. 2006. Dehumidification Enhancement of Direct Expansion Systems Through Component Augmentation of the Cooling Coil. 15<sup>th</sup> Symposium on Improving Building Systems in Hot and Humid Climates, July 24-26, 2006.

Nimmo, B.G. et al. 1993.DEAC: Desiccant Enhancement of Cooling-Based Dehumidification. ASHRAE Transactions, Vol.99, Part 1, Paper number CH-93-4-4, pp. 842-848.

### Desuperheater-Recovery-Based Water Heating Coil

#### Overview

The input object Coil:WaterHeating:Desuperheater provides a model that simulates the thermal performance of a refrigerant-to-water heating coil and the electric consumption of its water circulation pump, control valves, and other auxiliary devices. The model assumes that the heating energy provided by this coil is reclaimed from the superheated refrigerant gas leaving a compressor and does not impact the performance of the compressor. The objects from which this coil can obtain its heating energy are:

Coil:Cooling:DX:SingleSpeed

Coil:Cooling:DX:TwoSpeed

Coil:Cooling:DX:TwoStageWithHumidityControlMode

Refrigeration:CompressorRack

Refrigeration:Condenser\* (multiple objects)

The heat reclaim recovery efficiency (specified by the user) defines the amount of heat available for use by this coil. Approximately 25-30% of the energy rejected by typical refrigeration system condensers is to reduce the superheated refrigerant vapor temperature to the condensing temperature. Recovery efficiencies higher than 30% may cause the refrigerant gas to condense, which in turn impacts the performance of the refrigeration compressor rack. For this reason, the maximum heat reclaim recovery efficiency for this coil for all sources except the Refrigeration:Condenser:(Air, Water, or Evap)Cooled is 30%.For these refrigeration condensers, the amount of waste energy available in the superheat region is explicitly calculated, so for these condensers the maximum heat recovery efficiency is 90% of this superheat energy. Also, for these refrigeration condensers, an estimate of the temperature of the reclaimed heat source is made and compared to the inlet air temperature for the coil. If the reclaimed heat source is too cool, the amount of available reclaim energy is set to zero. For all heat sources, the model includes the ability to modify the heat reclaim recovery efficiency based on variations in inlet water temperature and outdoor air dry-bulb temperature.

NOTE: When the heating source is a refrigerated case compressor rack, the heat rejection location in the Refrigeration:CompressorRack object must be “Outdoors”. If the compressor rack heat rejection location is “Zone”, the total amount of heat rejection available for reclaim (e.g., by this desuperheater heating coil) is set to zero by the compressor rack object and the simulation proceeds.

To model a desuperheater water heating coil, the input data file must include the following objects:

·        Coil:WaterHeating:Desuperheater

·        WaterHeater:Mixed

·        Coil:Cooling:DX:\* or Refrigeration:CompressorRack, or Refrigeration:Condenser:\*

A schematic diagram showing the desuperheater water heating coil with its water heater and DX system condenser is shown below.

![DesuperheaterSchematic\_DS](EngineeringReference/media/image4049.png)

Figure 172.  Schematic of Desuperheater Water Heating Coil

#### Model Description

The desuperheater heating coil input requires a setpoint temperature schedule and dead band temperature difference, which are independent from the setpoint temperature schedule and dead band temperature difference for the heater (element or burner) associated with the water heater tank. The cut-in temperature for the desuperheater coil is defined as the desuperheater coil’s setpoint temperature minus its dead band temperature difference.

<div>$${T_{cut - in}}\,\, = \,\,{T_{set\,point}}\,\, - \,\,{T_{dead\,band}}$$</div>

where:

<span>${T_{cut - in}}$</span>         = Cut-in temperature (°C)

<span>${T_{set\,point}}$</span>       = Setpoint temperature (°C)

<span>${T_{dead\,band}}$</span>     = Dead band temperature difference (°C)

Desuperheater water heating coils are typically used to offset energy consumption by the water tank’s heater (element or burner). Therefore, the cut-in temperature of the desuperheater coil should always be higher than the water heater tank’s setpoint temperature. At times when the water heater tank’s setpoint temperature is greater than or equal to the cut-in temperature of the desuperheater coil, the desuperheater is disabled and the water heater tank heating element is used to heat the water. An additional input parameter sets the maximum inlet water temperature allowed for desuperheater heat reclaim. Any time the inlet water temperature to the desuperheater coil is above this maximum allowed temperature, heat reclaim is restricted so that the tank water does exceed this temperature.

When the desuperheater coil is scheduled off by its availability schedule, the water heater tank’s setpoint temperature is greater than or equal to the desuperheater coil cut-in temperature, or if the DX system’s compressor (source of heat reclaim) is off, the water heating capacity and water mass flow rate for the desuperheater coil are set to zero and the water heater tank is simulated with the desuperheater heating coil disabled. Otherwise, the simulation proceeds by first determining the maximum amount of heat available for heat reclaim. If a heat reclaim efficiency modifier curve object is specified by the user, this bi-quadratic curve is evaluated using the desuperheater coil inlet water temperature and the outdoor air dry-bulb temperature; otherwise, the output is assumed to be equal to 1.

<div>$$\begin{array}{l}IF\left( {HEffFTemp\,\,is\,\,specified} \right)THEN\\\,\,\,\,\,\,HEffFTemp = \,\,MAX\,\left( {0.0,\,\,f\left( {{T_{water,inlet}},{T_{DB,outdoor}}} \right)} \right)\\ELSE\\\,\,\,\,\,\,HEffFTemp = 1.0\\ENDIF\end{array}$$</div>

where:

<span>$HEffFTemp$</span>= Heat reclaim efficiency modifier

<span>${T_{water,inlet}}$</span>     = Desuperheater coil inlet water temperature (°C)

<span>${T_{DB,outdoor}}$</span>    = Outdoor air dry-bulb temperature (°C)

Except for the detailed condenser source, heat reclaim recovery efficiencies higher than 30% may cause the refrigerant gas to condense which in turn impacts the performance of the refrigeration system. The model is unable to account for this refrigeration system impact, so the product of the rated heat reclaim recovery efficiency and heat reclaim efficiency modifier is not allowed to exceed 0.3.  For the detailed refrigeration condenser, the limit for the heat reclaim efficiency has been set at 0.9 as follows:

<div>$${\rm{IF}}\left( {{\varepsilon_{{\rm{reclaim,rated}}}}} \right)\left( {HEfFTemp} \right) > Limit,{\rm{ then }}HeffFTemp = \frac{{Limit}}{{{\varepsilon_{{\rm{reclaim,rated}}}}}}$$</div>

where:

Limit           = 0.3 for most sources, =0.9 for detailed condensers

<span>${\varepsilon_{reclaim,rated}}$</span> = rated heat reclaim recovery efficiency

The heating capacity of the desuperheater coil is then calculated based on the product of total amount of condenser waste heat rejected by the heating source, the desuperheater coil’s rated heat reclaim recovery efficiency, and the heat reclaim efficiency modifier.

<div>$${\dot Q_{coil}} = {{\left( {{{\dot Q}_{cond}}} \right)\left( {{\varepsilon_{reclaim,rated}}} \right)HEffFTemp} \mathord{\left/ {\vphantom {{\left( {{{\dot Q}_{cond}}} \right)\left( {{\varepsilon_{reclaim,rated}}} \right)HEffFTemp} {DXSystemPLR}}} \right. } {DXSystemPLR}}$$</div>

where:

<span>${\dot Q_{coil}}$</span>          = water heating capacity of the desuperheater coil (W)

<span>${\dot Q_{cond}}$</span>         = average rate of condenser waste heat rejected by the heating source (W)

<span>$DXSystemPLR$</span> = part load ratio for the desuperheater coil heating source (1.0 for refrigerated case compressor rack and detailed refrigeration condenser)

The desuperheater is assumed to have a water circulation pump located downstream of the refrigerant-to-water coil. Pump heat is added to the desuperheater water heating capacity based on a user-defined fraction as follows:

<div>$${\dot Q_{coil}} = {\dot Q_{coil}} + {P_{pump}}\left( {Fra{c_{pumptowater}}} \right)$$</div>

where:

<span>${P_{pump}}$</span>                     = water pump power (W)

<span>$Fra{c_{pumptowater}}$</span>        = fraction of pump heat to water

The temperature of the water leaving the desuperheater is then calculated as

<span>${T_{water,outlet}} = {T_{water,inlet}} + \frac{{{Q_{coil}}}}{{{{\dot m}_{water}}\cdot {C_{p,water}}}}$</span> for <span>${\dot m_{water}}$</span> &gt; 0

<span>${T_{water,outlet}} = {T_{water,inlet}}$</span> for <span>${\dot m_{water}}$</span> = 0

Simulation of the desuperheater heating coil is based on its current mode of operation. This mode of operation is either floating (heating coil off and tank water temperature has not fallen below the heater cut-in temperature) or heating (tank water temperature dropped below the heater cut-in temperature on a previous time step but was unable to reach the heater setpoint temperature). Each mode is handled differently and they will be discussed separately.

#### Float Mode

When the water heater tank temperature is floating between the desuperheater coil’s cut-in and cut-out temperatures at the end of the previous simulation time step, both the desuperheater coil and the water heater tank’s heating element are disabled and a resulting tank temperature is calculated. If the resulting tank temperature is below the desuperheater coil cut-in temperature the desuperheater coil part-load ratio is estimated using a ratio of temperature differences as shown below. The part-load ratio can not be less than zero or greater than the part-load ratio of the DX system from which the desuperheater coil is reclaiming heat.

<div>$$PLR = \,MIN\left( {DXSystemPLR,MAX\left( {0.0,\,\,\left( {\frac{{{T_{cut - in}} - {T_{tank,float}}}}{{{T_{tank,initial}} - {T_{tank,float}}}}} \right)} \right)} \right)$$</div>

where:

<span>$PLR$</span>         = part load ratio of desuperheater heating coil

<span>${T_{tank,float}}$</span>     = tank temperature in float mode when heating capacity is set to zero (°C)

<span>${T_{tank,initial}}$</span>    = tank water temperature at the beginning of a simulation time step (°C)

Since the water pump is assumed to cycle on and off with the desuperheater coil, the average water mass flow rate through the desuperheater coil is then set proportional to the PLR calculated above:

<div>$$\dot mwater,avg = \dot mwater\left( {PLR} \right)$$</div>

where:

<span>$\dot mwater,avg$</span>       = average desuperheater water mass flow rate for the time step (kg/s)

The water tank temperature is then calculated based on desuperheater heating coil operation (outlet water temperature and average water mass flow rate as calculated above) and with the water tank’s heater element enabled. If the resulting water tank temperature is above the desuperheater coil’s setpoint temperature, then the part-load ratio is reduced in the same manner described in the heating mode section below.

#### Heating Mode

When the desuperheater heating coil is in heating mode at the end of the previous simulation time step (i.e., desuperheater coil operated during the previous simulation time step but was unable to achieve the setpoint temperature), both the desuperheater and the water heater tank’s heating element are enabled. The desuperheater coil outlet water temperature is calculated (as described above) and the water mass flow rate through the desuperheater coil is set to the maximum operating flow rate:

**<span>$\dot mwater,avg = \dot mwater\left( {DXSystemPLR} \right)$</span>**

If the resulting tank water temperature is above the desuperheater coil’s setpoint (cut-out) temperature, the part load ratio of the desuperheater coil is reduced and the water heater tank is simulated again. The process is performed iteratively until the part load ratio of the desuperheater coil achieves the desired setpoint temperature.



#### Model Outputs

After completing the float mode or heating mode calculations and the final desuperheater part load ratio has been determined, the output (report) variables are calculated as follows:

<div>$$Desuperheater\,Part\,Load\,Ratio = MIN\left( {\frac{{\dot mwater,avg}}{{\dot mwater}},DXSystemPLR} \right)\,\,$$</div>

<div>$$Desuperheater\,\,Water\,Heating\,Rate\,\,(W) = {\dot Q_{coil}}\left( {PLR} \right)$$</div>

<div>$$Desuperheater\,\,Water\,Heating\,Energy\,\,(J) = {\dot Q_{coil}}\left( {PLR} \right)(3600)\left( {{t_{sys}}} \right)$$</div>

<div>$$Desuperheater\,\,Pump\,\,Electric\,\,Power\,\,(W) = {P_{pump}}\left( {PLR} \right)$$</div>

<div>$$Desuperheater\,\,Pump\,\,Electric\,\,Consumption\,\,(J) = {P_{pump}}\left( {PLR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

<div>$$Desuperheater Heat Reclaim Efficiency Modifier Curve Output\,\, = \,\,HEffFTemp$$</div>

<div>$$Desuperheater\,\,On{\rm{ - }}Cycle\,Parasitic\,Electric\,Power\,(W)\,\, = \,\,{P_{parasiticload,on}}\left( {PLR} \right)$$</div>

<div>$$Desuperheater\,\,On{\rm{ - }}Cycle\,Parasitic\,Electric\,Consumption\,(J)\,\, = \,\,{P_{parasiticload,on}}\left( {PLR} \right)\left( {3600} \right){t_{sys}}$$</div>

<div>$$Desuperheater\,\,Off{\rm{ - }}Cycle\,Parasitic\,Electric\,Power\,(W)\,\, = \,\,{P_{parasiticload,off}}\left( {1 - PLR} \right)$$</div>

<div>$$Desuperheater\,\,Off{\rm{ - }}Cycle\,Parasitic\,Electric\,Consumption\,(J)\,\, = \,\,{P_{parasiticload,off}}\left( {1 - PLR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

where:

<span>${P_{parasiticload,on}}$</span>           = on-cycle parasitic electric load (W)

<span>${P_{parasiticload,off}}$</span>          = off-cycle parasitic electric load (W)

<span>${t_{sys}}$</span>                         = HVAC system simulation time step (hours)



Note: All output variables, including off cycle parasitic electrical power and energy, equal 0 when the desuperheater heating coil availability schedule equals 0.

### Heat Exchanger Assisted Air Cooling Coil Systems

An air-to-air heat exchanger can be used to enhance the dehumidification performance of a conventional cooling coil. EnergyPlus has two compound objects to model this scenario: CoilSystem:Cooling:DX:HeatExchangerAssisted and CoilSystem:Cooling:Water:HeatExchangerAssisted. The input syntax for these compound objects can be found in the EnergyPlus Input/Output Reference.

As shown in Figure 173, the air-to-air heat exchanger pre-conditions the air entering the cooling coil, and reuses this energy to post-condition the supply air leaving the cooling coil. This heat exchange process improves the latent removal performance of the cooling coil by allowing it to dedicate more of its cooling capacity toward dehumidification (lower sensible heat ratio).



![GenericHXAssisted](EngineeringReference/media/image4091.png)

Figure 173. Schematic of a Heat Exchanger Assisted Cooling Coil

NOTE: Node naming shown in Figure 173 is representative for HeatExchanger:AirToAir:SensibleAndLatent. For HeatExchanger:AirToAir:FlatPlate, the exhaust air nodes are referred to as ‘secondary air’ nodes. For HeatExchanger:Desiccant:BalancedFlow (heat exchanger assisted DX coil only), the supply air nodes are referred to as ‘regeneration air’ nodes and the exhaust air nodes as ‘process air’ nodes.

The dehumidification performance of cooling coils can be enhanced using a sensible-only heat exchanger (e.g., heat pipes, runaround coils, cross-flow heat exchangers). For example, a CoilSystem:Cooling:DX:HeatExchangerAssisted object could be used with a HeatExchanger:AirToAir:FlatPlate object or HeatExchanger:AirToAir:SensibleAndLatent object with only sensible effectiveness specified (see resulting psychrometric process in Figure 174). The dehumidification performance of cooling coils can also be enhanced using heat exchangers that transfer both sensible and latent energy (e.g., rotary desiccant heat exchanger). For example, a CoilSystem:Cooling:DX:HeatExchangerAssisted object could be used with a HeatExchanger:Desiccant:BalancedFlow object (see resulting psychrometric process in Figure 175).

Note that while the HeatExchanger:AirToAir:SensibleAndLatent and HeatExchanger:Desiccant:BalancedFlow objects can transfer both sensible and latent heat between two air streams, the HeatExchanger:Desiccant:BalancedFlow object with appropriate Performance Data Type object is the proper heat exchanger model to use for the heat exchanger assisted cooling coil described here. The HeatExchanger:AirToAir:SensibleAndLatent object should only be used to model the sensible-only heat exchange case (Figure 174).



![PsychChart\_SensibleHXAssisted](EngineeringReference/media/image4092.png)

Figure 174. Psychrometric Process for Heat Exchanger Assisted Cooling Coil (Sensible HX Only)



![PsychChart\_SensPlusLatHXAssisted](EngineeringReference/media/image4093.png)

Figure 175. Psychrometric Process for Heat Exchanger Assisted Cooling Coil (Sensible+Latent HX)

Modeling of the heat exchanger assisted cooling coil is performed by consecutively modeling the air-to-air heat exchanger and the cooling coil until convergence on a solution is achieved. The detailed modeling calculations for the individual components (air-to-air heat exchangers and cooling coils) are described elsewhere in this document.

Modeling of the heat exchanger assisted cooling coil begins by initializing the air mass flow rate (based on the air mass flow rate placed on the compound object’s inlet air node) and passing this value to the exhaust air inlet node of the air-to-air heat exchanger. The heat exchanger and cooling coil are then successively modeled using the calculation routines specific to the type of heat exchanger and cooling coil selected. The air temperature exiting the cooling coil is compared with the air temperature exiting the cooling coil on the previous modeling iteration for this simulation time step. Convergence is reached when the change in this air temperature for successive iterations is within a specified tolerance (0.0005°C). Consecutive modeling of the heat exchanger and cooling coil is terminated and a warning message is issued if the number of modeling iterations exceeds 50.

For the CoilSystem:Cooling:DX:HeatExchangerAssisted object, heat exchanger operation can be controlled based on high humidity levels in a zone. By default, the heat exchanger is assumed to always provide its heat transfer when the associated DX cooling coil is operating and no humidity control mechanism is specified. However, the heat exchanger’s energy transfer may be controlled (i.e., turned on and off) based on a zone air humidity level using either a humidistat alone (Figure 176) or a humidistat and a maximum humidity setpoint manager (Figure 177) depending on the HVAC system that is utilizing the heat exchanger assisted cooling coil.

The heat exchanger assisted DX cooling coil may be used with furnaces or unitary systems located in an air loop (ref. AirLoopHVAC:Unitary:Furnace:HeatCool or AirLoopHVAC:UnitaryHeatCool). These system objects have three options for dehumidification control (None, Multimode, and CoolReheat). When no dehumidification control is specified in the furnace or unitary system object (None), the heat exchanger is always active when the cooling coil is operating. When multimode or coolreheat dehumidification control is specified, a humidistat is required as shown in Figure 176. For the case of multimode dehumidification control, the heat exchanger is only active when the zone air humidity level is above the humidistat setpoint (i.e., the system’s cooling coil can’t meet the latent cooling load when operating without heat exchanger energy transfer) while the AC system operates to meet the sensible (dry-bulb cooling thermostat) load. For the case of coolreheat dehumidification control, the heat exchanger is always active when the cooling coil operates and this system tries to meet both the sensible (thermostat) and latent (humidistat) loads.

![GenericHXAssisted\_humidistat](EngineeringReference/media/image4094.png)

Figure 176. Schematic of a heat exchanger assisted DX cooling coil with optional humidistat

The heat exchanger assisted DX cooling coil may also be used with a DX system located in an air loop (ref. CoilSystem:Cooling:DX). This system object also has three options for dehumidification control (None, Multimode, and CoolReheat). When no dehumidification control is specified (None), the heat exchanger is always active when the cooling coil is operating. When multimode or coolreheat dehumidification control is specified, a humidistat and a maximum humidity setpoint manager are required as shown in Figure 177 (setpoint needs to be placed on the DX system’s control node). For multimode dehumidification control, the heat exchanger is only active when the zone humidity levels are above the humidistat setpoint (i.e., the system’s cooling coil can’t meet the maximum humidity ratio setpoint when operating without heat exchanger energy transfer) while the AC system operates to meet the sensible (dry-bulb cooling thermostat) load. For coolreheat dehumidification control, the heat exchanger is always active when the cooling coil operates and this system tries to meet both the sensible (thermostat) and latent (humidistat) loads.

When the heat exchanger assisted cooling coil is used with a furnace or unitary system (ref. AirLoopHVAC:Unitary:Furnace:HeatCool or AirLoopHVAC:UnitaryHeatCool) or DX system (ref. CoilSystem:Cooling:DX) located in an air loop (or DX system used in an outside air system), an ecomizier function may be customized as necessary. For economizer control, an outdoor air controller (ref. Controller:OutdoorAir) is used to define the economizer control inputs and determine when economizer mode is active. The heat exchanger (ref. HeatExchanger:\*) object provides an economizer lockout feature which disables heat recovery any time the economizer is active. This feature can be turned on and off using the heat exchanger lockout input. Heat exchanger assisted cooling coils used with the zone equipment described below disregard this economizer control feature.

![GenericHXAssisted\_humidistat\_Plus\_Setpointmanager](EngineeringReference/media/image4095.png)

Figure 177. Schematic of Heat Exchanger Assisted DX Coil with Humidistat and Setpoint Manager

The heat exchanger assisted DX cooling coil may also be used with the unitary changeover bypass system and the unitary air-to-air heat pump system (ref. AirLoopHVAC:UnitaryHeatCool:VAVChangeoverBypass and AirLoopHVAC:UnitaryHeatPump:AirToAir); however, the heat exchanger is assumed to always provide its heat transfer when the cooling coil operates and can not be turned on and off based on a zone air humidity setpoint (ref. Figure 173). Two zone air conditioners may also use this heat exchanger/coil assembly model for improved dehumidification. The first type is the packaged terminal heat pump (ref. ZoneHVAC:PackagedTerminalHeatPump) where the heat exchanger’s heat transfer is always active whenever the cooling coil operates (ref. Figure 173). The second type is the window air conditioner (ref. ZoneHVAC:WindowAirConditioner) where the heat exchanger’s heat transfer is always active when the cooling coil operates and no humidity control mechanism is specified (ref. Figure 173), or the heat exchanger’s heat transfer may be controlled based on zone air humidity level when a humidistat and high humidity setpoint manager are specified (maximum humidity ratio setpoint must be placed on the heat exchanger’s exhaust air outlet node). For this case, the heat exchanger is only active when the zone air humidity level is above the humidistat setpoint (i.e., the system’s cooling coil can’t meet the maximum humidity ratio setpoint when operating without heat exchanger energy transfer) while only the sensible (dry-bulb cooling thermostat) load is met by the AC system (ref. Figure 177).

For the CoilSystem:Cooling:Water:HeatExchangerAssisted object, there is currently no method to enable or disable heat exchange based on zone air humidity level. Heat exchange will occur whenever the heat exchanger is available to operate (via its availability schedule) and a temperature difference exists between the two air streams.

#### References

Kosar, D. 2006. Dehumidification Enhancements, ASHRAE Journal, Vol. 48, No. 2, February 2006.

Kosar, D. et al. 2006. Dehumidification Enhancement of Direct Expansion Systems Through Component Augmentation of the Cooling Coil. 15<sup>th</sup> Symposium on Improving Building Systems in Hot and Humid Climates, July 24-26, 2006.

Nimmo, B.G. et al. 1993.DEAC: Desiccant Enhancement of Cooling-Based Dehumidification. ASHRAE Transactions, Vol.99, Part 1, Paper number CH-93-4-4, pp. 842-848.

### Single-Speed Electric Heat Pump DX Water Heating Coil

#### Overview

The input object Coil:WaterHeating:AirToWaterHeatPump provides a model used in a heat pump water heater (HPWH) consisting of a water heater tank (e.g., WaterHeater:Mixed), a direct expansion (DX) “coil” (i.e., an air-to-water DX compression system which includes a water heating coil, air coil, compressor, and water pump), and a fan to provide air flow across the air coil associated with the DX compression system. These objects work together to model a system which heats water using zone air, outdoor air, or a combination of zone and outdoor air as the primary heat source. The heat pump water heater (Ref. WaterHeater:HeatPump), water heater tank (Ref. WaterHeater:Mixed), and fan (Ref. Fan:\*) objects are described elsewhere in this document.



![HPWHSchematic\_EAplusOA](EngineeringReference/media/image4096.png)

Figure 178. Schematic of a Heat Pump Water Heater using Optional Mixer/Splitter Nodes

The heat pump water heater DX coil model described here determines the thermal performance and energy consumption of the DX compression system, which includes a water heating coil (condenser), a coil used to extract heat from air (evaporator), and the compressor. This model also simulates the performance of a condenser water pump that is assumed to cycle on and off with the compressor.

![HeatPumpWaterHeater\_Schematic2](EngineeringReference/media/image4097.png)

Figure 179. Schematic of the Heat Pump Water Heater DX Coil

Virtually all of the inputs to this DX coil model relate to its water heating performance and energy consumption. The air-side cooling capacity of this DX system is derived from user inputs and some model assumptions. The sensible/latent cooling capacity split is defined by the user at rated conditions, and the model adjusts this split at off-rated conditions.

#### Model Description

The user must input the heating capacity, coefficient of performance (COP), and the sensible heat ratio (SHR) of the evaporator coil at rated inlet fluid temperatures and flow rates that are also specified by the user. The evaporator SHR should be a “gross” value, excluding any thermal impacts due to the indoor supply air fan. The user may also input up to seven performance curves that describe the change in total water heating capacity and efficiency at off-rated and part-load conditions.

1)    Heating capacity modifier curve (function of temperature)

2)    Heating capacity modifier curve (function of air flow fraction)

3)    Heating capacity modifier curve (function of water flow fraction)

4)    Heating COP modifier curve (function of temperature)

5)    Heating COP modifier curve (function of air flow fraction)

6)    Heating COP modifier curve  (function of water flow fraction)

7)    Part load fraction correlation (function of part load ratio)

Note: The air dry-bulb or wet-bulb temperature used in the following curve objects is the inlet air temperature to the HPWH evaporator coil/fan assembly. If the fan placement specified in the WaterHeater:HeatPump compound object is draw-through, then the inlet air temperature represents the temperature of the air entering the evaporator coil itself. If blow-through fan placement is specified, then the inlet air temperature represents air conditions entering the fan located immediately in front (upstream) of the evaporator coil.

·        The heating capacity as a function of temperature modifier curve defines the variation in DX coil heating capacity as a function of inlet fluid (air and water) temperatures. The curve object may use either a bi-quadratic or cubic form. The bi-quadratic curve uses inlet air temperature (dry-bulb or wet-bulb temperature based on the input field Evaporator Air Temperature Type for Curve Objects) and condenser inlet water temperature as the independent variables. The cubic curve uses inlet air (dry-bulb or wet-bulb) temperature as the independent variable. The curve should be normalized to have the value of 1.0 at the rating point temperatures specified by the user.

<div>$$HCapFTemp = a + b\left( {{T_{evap,in}}} \right) + c{\left( {{T_{evap,in}}} \right)^2} + d\left( {{T_{cond,in}}} \right) + e{\left( {{T_{cond,in}}} \right)^2} + f\left( {{T_{evap,in}}} \right)\left( {{T_{cond,in}}} \right)$$</div>

or

<div>$$HCapFTemp = a + b\left( {{T_{evap,in}}} \right) + c{\left( {{T_{evap,in}}} \right)^2} + d{\left( {{T_{evap,in}}} \right)^3}$$</div>

where:

<span>${T_{evap,in}}$</span>  = dry-bulb or wet-bulb temperature of the air entering the evaporator coil/fan assembly based on the Evaporator Air Temperature Type for Curve Objects specified by the user (°C)

<span>${T_{cond,in}}$</span>  = temperature of the water entering the DX coil condenser (°C)

·        The heating capacity as a function of air flow fraction modifier curve is a quadratic or cubic curve that defines the variation in DX coil heating capacity as a function of the ratio of actual air flow rate across the evaporator coil to the rated evaporator air flow rate (i.e., fraction of full load air flow rate). When used, the output of this curve should be normalized to have the value of 1.0  at an air flow fraction of 1.

<div>$$HCapFAirFlow = \,a + \,b\left( {f{f_{air}}} \right)\,\, + \,\,c{\left( {f{f_{air}}} \right)^2}$$</div>

or

<div>$$HCapFAirFlow = \,a + \,b\left( {f{f_{air}}} \right)\,\, + \,\,c{\left( {f{f_{air}}} \right)^2}\,\, + \,\,d{\left( {f{f_{air}}} \right)^3}$$</div>

where:

<div>$$f{f_{air}} = air\,flow\,fraction = \left( {\frac{{Actual\,air\,mass\,flow\,rate}}{{Rated\,air\,mass\,flow\,rate}}} \right)$$</div>

Note: The actual volumetric air flow rate through the evaporator coil/fan assembly for any simulation time step where the compressor is operating must be between 0.00002684 m<sup>3</sup>/s and .00008056 m<sup>3</sup>/s per watt of rated total heating capacity. The simulation will issue a warning message if this air flow range is exceeded, but the simulation will continue.

·        The heating capacity as a function of water flow fraction modifier curve is a quadratic or cubic curve that defines the variation in DX coil heating capacity as a function of the ratio of actual water flow rate through the condenser to the rated condenser water flow rate (i.e., fraction of full load water flow rate). When used, the output of this curve should be normalized to have the value of 1.0 at a water flow fraction of 1.

<div>$$HCapFWaterFlow = \,a + \,b\left( {f{f_{water}}} \right)\,\, + \,\,c{\left( {f{f_{water}}} \right)^2}$$</div>

or

<div>$$HCapFWaterFlow = \,a + \,b\left( {f{f_{water}}} \right)\,\, + \,\,c{\left( {f{f_{water}}} \right)^2}\,\, + \,\,d{\left( {f{f_{water}}} \right)^3}$$</div>

where:

<div>$$f{f_{water}} = water\,flow\,fraction = \left( {\frac{{Actual\,water\,mass\,flow\,rate}}{{Rated\,water\,mass\,flow\,rate}}} \right)$$</div>

·        The heating COP as a function of temperature modifier curve defines the variation in DX coil heating COP as a function of inlet fluid (air and water) temperatures. The curve object may use either a bi-quadratic or cubic form. The bi-quadratic curve uses inlet air temperature (dry-bulb or wet-bulb temperature based on the input field Evaporator Air Temperature Type for Curve Objects) and condenser inlet water temperature as the independent variables. The cubic curve uses inlet air (dry-bulb or wet-bulb) temperature as the independent variable. The curve should be normalized to have the value of 1.0 at the rating point temperatures specified by the user.

<div>$$HCOPFTemp = a + b\left( {{T_{evap,in}}} \right) + c{\left( {{T_{evap,in}}} \right)^2} + d\left( {{T_{cond,in}}} \right) + e{\left( {{T_{cond,in}}} \right)^2} + f\left( {{T_{evap,in}}} \right)\left( {{T_{cond,in}}} \right)$$</div>

or

<div>$$HCOPFTemp = a + b\left( {{T_{evap,in}}} \right) + c{\left( {{T_{evap,in}}} \right)^2} + d{\left( {{T_{evap,in}}} \right)^3}$$</div>

·        The heating COP as a function of air flow fraction modifier curve is a quadratic or cubic curve that defines the variation in DX coil heating COP as a function of the ratio of actual air flow rate across the evaporator coil to the rated evaporator air flow rate (i.e., fraction of full load air flow rate). When used, the output of this curve should be normalized to have the value of 1.0 at an air flow fraction of 1.

<div>$$HCOPFAirFlow = \,a + \,b\left( {f{f_{air}}} \right)\,\, + \,\,c{\left( {f{f_{air}}} \right)^2}$$</div>

or

<div>$$HCOPFAirFlow = \,a + \,b\left( {f{f_{air}}} \right)\,\, + \,\,c{\left( {f{f_{air}}} \right)^2}\,\, + \,\,d{\left( {f{f_{air}}} \right)^3}$$</div>

·        The heating COP as a function of water flow fraction modifier curve is a quadratic or cubic curve that defines the variation in DX coil heating COP as a function of the ratio of actual water flow rate through the condenser to the rated condenser water flow rate (i.e., fraction of full load water flow rate). When used, the output of this curve should be normalized to have the value of 1.0 at a water flow fraction of 1.

<div>$$HCOPFWaterFlow = \,a + \,b\left( {f{f_{water}}} \right)\,\, + \,\,c{\left( {f{f_{water}}} \right)^2}$$</div>

or

<div>$$HCOPFWaterFlow = \,a + \,b\left( {f{f_{water}}} \right)\,\, + \,\,c{\left( {f{f_{water}}} \right)^2}\,\, + \,\,d{\left( {f{f_{water}}} \right)^3}$$</div>

·        The part load fraction as a function of part load ratio correlation curve parameterizes the variation of electrical power input to the heat pump DX coil as a function of the part load ratio (PLR, heating delivered/steady-state heating capacity). The part load ratio divided by the part load fraction yields the runtime fraction of the DX heating coil for a given simulation time step. The part load fraction correlation accounts for efficiency losses due to compressor cycling.

<div>$$PartLoadFrac = PLF = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2}$$</div>

or

<div>$$PartLoadFrac = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2} + d{\left( {PLR} \right)^3}$$</div>

where:

<div>$$PLR = part\,load\,ratio = \left( {\frac{{water\,heating\,delivered}}{{steady{\rm{ - }}state\,water\,heating\,capacity}}} \right)$$</div>

The part load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the compressor runs continuously for the simulation time step). For PLR values between 0 and 1 (0 &lt;= PLR &lt; 1), the following rules apply:

PLF &gt;= 0.7   and   PLF &gt;= PLR

If PLF &lt; 0.7 a warning message is issued, the program resets the PLF value to 0.7, and the simulation proceeds. The runtime fraction of the coil is defined as PLR/PLF. If PLF &lt; PLR, then a warning message is issued and the runtime fraction of the coil is limited to 1.0.

When the part load fraction correlation for a heat pump water heater DX coil is unknown, the typical part load fraction correlation for a conventional, single-speed DX cooling coil (e.g., residential or small commercial unit) may be used:

            PLF = 0.85 + 0.15(PLR)

All seven curves are accessed through EnergyPlus’ built-in performance curve equation manager (curve:quadratic, curve:cubic and curve:biquadratic). It is not imperative that the user utilize all coefficients shown in the equations above if their performance equation has fewer terms (e.g., if the user’s part load fraction correlation curve is linear instead of quadratic, simply enter the values for a and b, and set coefficient c equal to zero).

Note: If any of the above performance curves are not specified by the user, the output of that curve is assumed to be 1 for the entire simulation.

For any simulation time step, the heating capacity of the heat pump water heater DX coil is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{heating}} = {\mathop Q\limits^ \bullet_{heating,rated}}\left( {HCapFTemp} \right)\left( {HCapFAirFlow} \right)\left( {HCapFWaterFlow} \right)$$</div>

In a similar fashion, the coefficient of performance for the DX coil for any simulation time step is calculated using the following equation:

<div>$$CO{P_{heating}} = CO{P_{heating,rated}}\left( {HCOPFTemp} \right)\left( {HCOPFAirFlow} \right)\left( {HCOPFWaterFlow} \right)$$</div>

The electric power for the heat pump water heater DX coil is then calculated using the water heating capacity and coefficient of performance calculated above.



<div>$${P_{heating}} = \left( {\frac{{{{\mathop Q\limits^ \bullet  }_{heating}}}}{{CO{P_{heating}}}}} \right)$$</div>

where:



<span>${\mathop Q\limits^ \bullet_{heating}}$</span>       = water heating capacity at the current operating conditions (W)

<span>${\mathop Q\limits^ \bullet_{heating,rated}}$</span> = water heating capacity at rated conditions, user input (W)

<span>$CO{P_{heating}}$</span>  = coefficient of performance at the current operating conditions (W/W)

<span>$CO{P_{heating,rated}}$</span>= coefficient of performance at rated conditions, user input (W/W)

<span>${P_{heating}}$</span>        = DX heating coil power (electricity consumption rate) at the current                                   operating conditions (W)

The heating capacity calculated above may or may not include the impact of pump heat. For this reason, the user input Condenser Pump Heat Included in Rated Heating Capacity and Rated COP is used to determine the total water heating capacity including pump heat.

<div>$$\begin{array}{l}IF\left( {Condenser\,Pump\,Heat\,Included\,In\,Rated\,Heating\,Capacity\,and\,Rated\,COP} \right)\\\,\,\,{\mathop Q\limits^ \bullet_{heating,total}} = {\mathop Q\limits^ \bullet_{heating}}\\ELSE\\\,\,\,{\mathop Q\limits^ \bullet_{heating,total}} = {\mathop Q\limits^ \bullet_{heating}} + {P_{pump}}\left( {Fra{c_{pumptowater}}} \right)\\END\,IF\end{array}$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{heating,total}}$</span>  = total water heating capacity including condenser pump heat (W)

<span>${P_{pump}}$</span>         = condenser water pump power, user input (W)

<span>$Fra{c_{pumptowater}}$</span>= fraction of condenser pump heat to water, user input

Compressor power (electricity consumption rate) is then calculated based on two additional inputs provided by the user. The first input specifies if the condenser pump heat is included in the rated heating capacity and rated COP. If the condenser pump heat is included in the rated heating capacity and COP, then condenser pump power must be subtracted from the DX heating coil power calculated above to determine the compressor power.

The second of these inputs specifies if the evaporator fan power is included in the rated heating COP. If evaporator fan power is included in the rated COP, then fan power must also be subtracted from the DX heating coil power to determine the compressor power as follows:

<div>$$\begin{array}{l}IF\left( {Evap\,Fan\,Power\,In\,COP} \right)\,\,THEN\\\,\,\,\,IF\left( {Cond\,Pump\,Power\,In\,COP} \right)\,\,THEN\\\,\,\,\,\,\,\,{P_{comp}} = {P_{heating}} - {P_{pump}} - {P_{fan}}\\\,\,\,\,ELSE\\\,\,\,\,\,\,\,{P_{comp}} = {P_{heating}} - {P_{fan}}\\\,\,\,\,END\;IF\end{array}$$</div>

where:

<span>${P_{comp}}$</span> = Compressor power (electric consumption rate) at the current operating conditions (W)

<span>${P_{fan}}$</span>  = Fan power, specified in Fan:OnOff object (W)

If fan power is not included in the rated heating COP, then the calculation of compressor power only includes condenser pump power and does not involve the fan:

<div>$$\begin{array}{l}IF\left( {.NOT.\,\,\,\,Evap\,Fan\,Power\,In\,COP} \right)\,\,THEN\\\,\,\,\,IF\left( {Cond\,Pump\,Power\,In\,COP} \right)\,\,THEN\\\,\,\,\,\,\,\,\,{P_{comp}} = {P_{heating}} - {P_{pump}}\\\,\,\,\,ELSE\\\,\,\,\,\,\,\,\,{P_{comp}} = {P_{heating}}\\\,\,\,\,END\;IF\end{array}$$</div>

The model assumes that all compressor power is rejected as heat via the DX heating coil. Therefore, the evaporator total cooling capacity at the current operating conditions is determined depending on the user input for pump heat:

<div>$$\begin{array}{l}IF\left( {Condenser\,Pump\,Heat\,Included\,In\,Rated\,Heating\,Capacity\,and\,Rated\,COP} \right)\\\,\,\,\,\,{\mathop Q\limits^ \bullet_{evap}} = {\mathop Q\limits^ \bullet_{heating}} - {P_{comp}} - \left( {{P_{pump}}Fra{c_{pumptowater}}} \right)\\ELSE\\\,\,\,\,\,{\mathop Q\limits^ \bullet_{evap}} = {\mathop Q\limits^ \bullet_{heating}} - {P_{comp}}\\END\;IF\end{array}$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{evap}}$</span> = Total evaporator cooling capacity at the current operating conditions (W)



This evaporator cooling capacity is used to calculate the air-side performance of the heat pump water heater DX coil. The sensible heat ratio of the cooling capacity at rated conditions is specified by the user in the input for this DX coil object. The calculation of sensible heat ratio at off-rated conditions uses the ADP/BF approach described for the DX cooling coil model (Ref. Coil Model – DX Cooling Coil Model). The exiting air conditions for the HPWH DX coil are calculated the same way as they are for the DX cooling coil model (cycling fan, cycling coil). The crankcase heater power and consumption are also calculated using the same equations used for the DX cooling coil model.

The runtime fraction of the DX coil compressor is calculated as the ratio of the compressor part load ratio to the part load fraction correlation entered by the user. The part load ratio of the DX coil is determined by the heat pump water heater compound object (Ref. WaterHeater:HeatPump) and is used by the DX coil to determine the run time fraction of the compressor.

<div>$$RTF = \left( {{\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PartLoadFrac}}}\right.}\!\lower0.7ex\hbox{${PartLoadFrac}$}}} \right) = runtime\,fraction\,of\,the\,compressor$$</div>

Finally, the condenser water outlet temperature is calculated based on the total water heating capacity of the DX coil and the actual condenser water mass flow rate.

<div>$${T_{cond,out}} = {T_{cond,in}} + \left( {\frac{{{{\mathop Q\limits^ \bullet  }_{heating,total}}}}{{\mathop m\limits^ \bullet  cond\,\,\,{C_p}}}} \right)$$</div>

where:

<span>${T_{cond,out}}$</span>      = condenser outlet water temperature when the DX coil is operating (˚C)

<span>${T_{cond,in}}$</span>        = condenser inlet water temperature (˚C)

<span>${C_p}$</span>             = specific heat of water entering the condenser coil (J/kg-C)

<span>$\mathop m\limits^ \bullet  cond$</span>         = actual condenser water mass flow rate when the coil is operating,                                 defined in the WaterHeater:HeatPump parent object (kg/s)



#### Model Outputs

After completing the calculations for heating capacity and power and the final compressor part load ratio has been determined, the output (report) variables are calculated as follows:

<div>$$DX\,Coil\,Total\,Water\,Heating\,Rate\,(W) = {\mathop Q\limits^ \bullet_{heating,total}}\left( {PLR} \right)$$</div>

<div>$$DX\,Coil\,Total\,Water\,Heating\,Energy\,(J) = {\mathop Q\limits^ \bullet_{heating,total}}\left( {PLR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

<div>$$DX\,Coil\,Water\,Heating\,Electric\,Power\,(W) = \left( {{P_{comp}} + {P_{pump}}} \right)\left( {RTF} \right)$$</div>

<div>$$DX\,Coil\,Water\,Heating\,Electric\,Consumption\,(J) = \left( {{P_{comp}} + {P_{pump}}} \right)\left( {RTF} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

<div>$$DX\,Coil\,Total\,Cooling\,Rate\,(W) = \,{\mathop Q\limits^ \bullet_{evap}}\left( {PLR} \right)$$</div>

<div>$$DX\,Coil\,Total\,Cooling\,Energy\,\,(J) = \,{\mathop Q\limits^ \bullet_{evap}}\left( {PLR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

<div>$$DX\,Coil\,Sensible\,Cooling\,Rate\,(W) = \,{\mathop Q\limits^ \bullet_{evap}}\left( {PLR} \right)\left( {SHR} \right)$$</div>

<div>$$DX\,Coil\,Sensible\,Cooling\,Energy\,(J) = \,{\mathop Q\limits^ \bullet_{evap}}\left( {PLR} \right)\left( {SHR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

<div>$$DX\,Coil\,Latent\,Cooling\,Rate\,(W) = \,{\mathop Q\limits^ \bullet_{evap}}\left( {PLR} \right)\left( {1.0 - SHR} \right)$$</div>

<div>$$DX\,Coil\,Latent\,Cooling\,Energy\,\,(J) = {\mathop Q\limits^ \bullet_{evap}}\left( {PLR} \right)\left( {1.0 - SHR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

<div>$$DX\,Coil\,Runtime\,Fraction = \left( {{\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PartLoadFrac}}}\right.}\!\lower0.7ex\hbox{${PartLoadFrac}$}}} \right)$$</div>

<div>$$DX\,Coil\,Crankcase\,Heater\,Power\,(W) = \,\left( {{P_{crankcase}}} \right)\left( {1.0 - RTF} \right)$$</div>

<div>$$DX\,Coil\,Crankcase\,Heater\,Consumption\,(J) = \,\left( {{P_{crankcase}}} \right)\left( {1.0 - RTF} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$$</div>

where:

*t<sub>sys</sub>             =* HVAC system simulation time step, hr

*SHR*           = sensible heat ratio at the current inlet air conditions and air flow rate                            (Ref. Coil Model – DX Cooling Coil Model, ADP/BF approach)

*P<sub>crankcase</sub>     *= Crankcase heater capacity, user input (W)

### Water Source Electric DX Air Cooling Coil

There are two objects for water-to-air heat pumps in cooling mode: Coil:Cooling:WaterToAirHeatPump:EquationFit and Coil:Cooling:WaterToAirHeatPump:ParameterEstimation.  These are described elsewhere.

### Water Source Electric Heat Pump DX Air Heating Coil

There are two objects for water-to-air heat pumps in heating mode:  Coil:Heating:WaterToAirHeatPump:EquationFit and Coil:Heating:WaterToAirHeatPump:ParameterEstimation.  These are described elsewhere.

### Steam-Based Air Heating Coil

The steam coils are included in the discussion on steam loops, see: Steam To Air Heat Exchanger.

### Variable Refrigerant Flow Cooling Coil

#### Overview

The variable refrigerant flow (VRF) DX cooling coil model is identical to the single-speed DX cooling coil model (Ref. Coil:Cooling:DX:SingleSpeed) when the compressor operates at it’s maximum speed. The calculations used when the VRF heat pump operates at part-load are slightly different than the single-speed DX cooling coil model. For this reason, an adaptation of the single-speed DX cooling coil model is used to model the variable-speed compression system used in the VRF model. The difference in model calculations occur when the VRF DX cooling coil’s electronic expansion device reduces refrigerant flow through the cooling coil. When the refrigerant flow is reduced, the coil’s apparatus dew point (ADP) temperature changes, as well as the coil’s sensible heat ratio (SHR). Since the single-speed DX cooling coil model is able to determine the ADP and SHR of a cooling coil at various operating conditions, this same model concept will be used to determine the ADP and SHR of the variable refrigerant flow DX cooling coil.

#### Model Description

The user must input the total cooling capacity and the volumetric air flow rate across the cooling coil at rated conditions. The capacity input should be “gross” values, excluding any thermal or energy impacts due to the indoor supply air fan. The rated volumetric air flow should be between 0.00004027 m<sup>3</sup>/s and 0.00006041 m<sup>3</sup>/s per watt of rated total cooling capacity (300 – 450 cfm/ton).

The user is required to input a performance curve in the heat pump object (ref: AirConditioner: VariableRefrigerantFlow) that describes the change in total cooling capacity at various operating conditions (i.e. at cooling coil inlet air wet-bulb and condenser entering air dry-bulb temperatures different than those used to define total capacity). Each DX cooling coil uses two Cooling Capacity Ratio Modifier curves to define the DX cooling coil performance. The first curve defines the full load performance solely as a function of indoor wet-bulb temperature or uses both indoor wet-bulb temperature and outdoor dry-bulb temperature as the independent variables. The specific performance curves are:

Total cooling capacity modifier curve (function of temperature)

Total cooling capacity modifier curve (function of flow fractionl)

·        The total cooling capacity modifier curve (function of temperature) defines the performance of the DX cooling coil as a function of operating conditions. These operating conditions may be specified as either a linear, quadratic or cubic equation using coil entering air wet-bulb temperature as the independent variable or as a biquadratic equation using both coil entering air wet-bulb temperature and outdoor dry-bulb temperuate as the independent variables. Since the variable refrigerant flow system modulates the compressor speed to serve the individual cooling coils, the single indpendent variable equation is likely to be sufficient to define the DX cooling coil performance. However, if other more accurate information is available, a biquadratic curve using two independent variables may be used. The output of this curve is multiplied by the rated total cooling capacity to give the total cooling capacity at the specific entering air temperatures at which the DX coil unit is operating (i.e., at temperatures different from the rating point temperatures).

<div>$$TotCapTempModFac = a + b\left( {{T_{wb,i}}} \right) + c{\left( {{T_{wb,i}}} \right)^2} + d{\left( {{T_{wb,i}}} \right)^3}$$</div>

- or -

<div>$$TotCapTempModFac = a + b\left( {{T_{wb,i}}} \right) + c{\left( {{T_{wb,i}}} \right)^2} + d\left( {{T_{c,i}}} \right) + e{\left( {{T_{c,i}}} \right)^2} + f\left( {{T_{wb,i}}} \right)\left( {{T_{c,i}}} \right)$$</div>

where

<span>${{T_{wb,i}}}$</span> = wet-bulb temperature of the air entering the cooling coil, °C

<span>${{T_{c,i}}}$</span> = dry-bulb temperature of the air entering an air-cooled condenser

or wet-bulb temperature of the air entering an evaporative-cooled condenser, °C

The total cooling capacity modifier curve (function of flow fraction) is a linear, quadratic, or cubic curve with the independent variable being the ratio of the actual air flow rate across the cooling coil to the rated air flow rate (i.e., fraction of full load flow). The output of this curve is multiplied by the operating (modulated) total cooling capacity and the total cooling capacity modifier curve (function of temperature) to give the total cooling capacity at the specific temperature and air flow conditions at which the DX unit is operating. The cubic form of the equation is:

<div>$$TotCapFlowModFac = \,a + \,b\left( {ff} \right)\,\, + \,\,c{\left( {ff} \right)^2}\,\, + \,\,d{\left( {ff} \right)^3}$$</div>

where

<div>$$ff = flow{\rm{ }}fraction = \left( {\frac{{Actual{\rm{ }}air{\rm{ }}mass{\rm{ }}flow{\rm{ }}rate}}{{Rated{\rm{ }}air{\rm{ }}mass{\rm{ }}flow{\rm{ }}rate}}} \right)$$</div>

**Note:**  The actual volumetric air flow rate through the cooling coil for any simulation time step where the DX unit is operating must be between 0.00002684 m<sup>3</sup>/s and .00006713 m<sup>3</sup>/s per watt of rated total cooling capacity (200 - 500 cfm/ton). The simulation will issue a warning message if this air flow range is exceeded.

For any simulation time step, the total (gross) cooling capacity of the DX unit is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{total}} = {\mathop Q\limits^ \bullet_{reference}}\left( {TotCapTempModFac} \right)\left( {TotCapFlowModFac} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{total}}$</span>= Total available cooling capacity, W

<span>${\mathop Q\limits^ \bullet_{reference}}$</span>= Total reference (rated) cooling capacity, W

In addition to calculating the total cooling capacity provided by the DX cooling coil, it is important to properly determine the break down of total cooling capacity into its sensible (temperature) and latent (dehumidification) components. The model computes the sensible/ latent split using the SHR and ADP/BF approach (Carrier et al. 1959). When the DX coil model is initially called during an EnergyPlus simulation, the rated total capacity and rated SHR are used to calculate the coil bypass factor (BF) at rated conditions. The rated total capacity and rated SHR are first used to determine the ratio of change in air humidity ratio to air dry-bulb temperature:

<div>$$SlopeRated = {\left( {\frac{{{\omega_{in}} - {\omega_{out}}}}{{{T_{db,in}} - {T_{db,out}}}}} \right)_{rated}}$$</div>

where

*ω<sub>in</sub>* = humidity ratio of the air entering the cooling coil at rated conditions, kg/kg

*ω<sub>out</sub>* = humidity ratio of the air leaving the cooling coil at rated conditions, kg/kg

*T<sub>db,in</sub>* = dry-bulb temperature of the air entering the cooling coil at rated conditions, °C

*T<sub>db,out</sub>* = dry-bulb temperature of the air leaving the cooling coil at rated conditions, °C

Along with the rated entering air conditions, the algorithm then searches along the saturation curve of the psychrometric chart until the slope of the line between the point on the saturation curve and the inlet air conditions matches *SlopeRated*. Once this point, the apparatus dew point, is found on the saturation curve the coil bypass factor at rated conditions is calculated as follows:

<div>$$B{F_{rated}} = \frac{{{h_{out,rated}} - {h_{ADP}}}}{{{h_{in,rated}} - {h_{ADP}}}}$$</div>

where

*h<sub>out,rated</sub>* <sub> </sub>= enthalpy of the air leaving the cooling coil at rated conditions, J/kg

*h<sub>in,rated</sub>* <sub> </sub>= enthalpy of the air entering the cooling coil at rated conditions, J/kg

*h<sub>ADP</sub>* <sub> </sub>= enthalpy of saturated air at the coil apparatus dew point, J/kg

The coil bypass factor is analogous to the “ineffectiveness” (1-ε) of a heat exchanger, and can be described in terms of the number of transfer of unit (NTU).

<div>$$BF = {e^{ - NTU}} = {e^{{{ - \left( {\frac{{UA}}{{{c_p}}}} \right)} \mathord{\left/ {\vphantom {{ - \left( {\frac{{UA}}{{{c_p}}}} \right)} {\dot m}}} \right. } {\dot m}}}} = {e^{ - Ao/\dot m}}$$</div>

For a given coil geometry, the bypass factor is only a function of air mass flow rate. The model calculates the parameter A<sub>o</sub> in the equation above based on BF<sub>rated</sub> and the rated air mass flow rate. With A<sub>o</sub> known, the coil BF can be determined for non-rated air flow rates.

For each simulation time step when the DX cooling coil operates, the total cooling capacity and coil bypass factor at the actual operating conditions are calculated. The coil bypass factor is used to calculate the operating sensible heat ratio (SHR) of the cooling coil using the following equations. Here is where the differnce in models occur for the VRF DX cooling coil and single-speed DX cooling coil. The original coil model (ref: Coil:Cooling:DX:SingleSpeed) calculates the full load outlet air enthalpy and, considering the bypass factor, finds the coil surface temperture (h<sub>ADP</sub>) at full load (i.e., PLR = 1). Conversely, the VRF coil model modulates refrigerant flow to the VRF DX cooling coil which is why this model uses the full load coil capacity multipled by the part-load ratio (the modulated refrigerant flow). The effectively finds the coil surface temperature for a variable refrigerant flow DX cooling coil and the operating sensible heat ratio (SHR) can be calculated.

<span>${h_{ADP}} = {h_{in}} - \frac{{\left( {{{\mathop Q\limits^ \bullet  }_{total}}\,\,/\,\mathop m\limits^ \bullet  } \right)}}{{1 - BF}}$</span>            ;  single-speed DX coil model (h<sub>ADP1</sub> in figure below),

<span>${h_{ADP}} = {h_{in}} - \frac{{\left( {{{\mathop Q\limits^ \bullet  }_{total}}\,x\,PLR} \right)\,/\,\mathop m\limits^ \bullet  }}{{1 - BF}}$</span>  ;  variable refrigerant flow DX coil model

<div>$$SHR = Minimum\left( {\left( {\frac{{{h_{Tin,wADP}} - {h_{ADP}}}}{{{h_{in}} - {h_{ADP}}}}} \right),1} \right)$$</div>

where

<span>${{h_{in}}}$</span>          = enthalpy of the air entering the cooling coil, J/kg

<span>${{h_{ADP}}}$</span>       = enthalpy of air at the apparatus dew point condition, J/kg

<span>${{h_{Tin,wADP}}}$</span> = enthalpy of air at the entering coil dry-bulb temperature and humidity ratio at ADP, J/kg

<span>$\dot m$</span>            = air mass flow rate, kg/s

With the SHR for the coil at the current operating conditions, the properties of the air leaving the cooling coil are calculated using the following equations:

<div>$${h_{out}} = {h_{in}} - \left( {\left( {{{\mathop Q\limits^ \bullet  }_{total}}\,xPLR} \right)\,\,/\,\mathop m\limits^ \bullet  } \right)$$</div>

<div>$${h_{Tin,\omega out}} = {h_{in}} - \left( {1 - SHR} \right)\left( {{h_{in}} - {h_{out}}} \right)$$</div>

<div>$${\omega_{out}} = PsyWFnTdbH\left( {{T_{in}},{h_{Tin,\omega out}}} \right)$$</div>

<div>$${T_{db,out}} = PsyTdbFnHW\left( {{h_{out}},{\omega_{out}}} \right)$$</div>

where

<span>${{h_{out}}}$</span>         = enthalpy of the air leaving the cooling coil, J/kg

<span>${{h_{Tin,\omega out}}}$</span>  = enthalpy of air at the entering coil dry-bulb temperature and leaving air humidity ratio, J/kg

<span>${{\omega_{out}}}$</span>        = leaving air humidity ratio, kg/kg

<span>${T_{db,out}}$</span>    = leaving air dry-bulb temperature, °C

*PsyWFnTdbH* = EnergyPlus psychrometric function, returns humidity ratio given dry-bulb temperature and enthalpy

*PsyTdbFnHW* = EnergyPlus psychrometric function, returns dry-bulb temperature given enthalpy and humidity ratio

The following figure shows this process on a psychrometric chart. This variable refrigerant flow DX cooling coil model follows the dotted process line from h<sub>in</sub> towards the outlet air enthalpy (the clear circles, ο) based on the modulated refrigerant flow (PLR). The coil surface temperature (ADP, apparatus dew point) is found by drawing a straight line through these points. The process line from h<sub>in</sub> to h<sub>ADP1</sub> represents the full load (PLR=1). This would be what the original DX cooling coil model calculates. At this point the sensible heat ratio is at the design point (assuming h<sub>in</sub> is the rating point and the coil operates at the rated air mass flow rate). As the coil load is reduced, the refrigerant flow rate is restricted and the outlet air condition rides up the dotted line. The outlet air condition and associated h<sub>ADP2</sub> is shown for a PLR of 0.7 (for example purposes only). Here the sensible heat ratio is higher than that found at full load operation. As the load continues to reduce, the refrigerant flow rate continues to throttle back and there comes a point where the coil’s ADP is equal to the inlet air dew point temperature (h<sub>ADP3</sub>). At this point, and for all other PLR’s less than this value, the coil surface becomes dry (at PLR=0.4 in this example) and the coil’s sensible heat ratio = 1. Between this PLR and PLR=0, the coil outlet air condition follows the dotted line back towards H<sub>in</sub>.

<span>$ \cdot $</span> ![](EngineeringReference/media/image4182.png)

Figure 180. Process on psychrometric chart

#### Dry Coil Conditions

If the model determines that the cooling coil is dry (ω<sub>in</sub> &lt; ω<sub>ADP</sub>), then the equation for total cooling capacity is invalid since it is a function of entering wet-bulb temperature. Under dry-coil conditions, coil performance is a function of dry-bulb temperature rather than wet-bulb temperature. In this case, the model recalculates the performance of the DX cooling unit using the calculation procedure described above but with ω<sub>in\\ =</sub> ω<sub>dry,</sub> where ω<sub>dry</sub> is the inlet air humidity ratio at the coil dry-out point (SHR = 1.0).

#### Condenser Options:  Air Cooled vs. Evaporative Cooled

As described previously, this model can simulate the performance of air-cooled or evaporative-cooled DX air conditioners. The choice of condenser type impacts the air dry-bulb temperature entering the heat pump’s condenser. Although the actual input for the selection is contained in the variable refrigerant flow air conditioner object, the calculations are repeated here to aid the user in understanding the condenser option choices. The following paragraphs describe three modeling options.

If the user wants to model an air-cooled condenser, they should simply specify AirCooled in the field Condenser Type. In this case, the Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) will utilize the outdoor dry-bulb temperature.

If the user wishes to model an evaporative-cooled condenser AND they have performance curves that are a function of the wet-bulb temperature of air entering the condenser coil, then the user should specify Condenser Type = EvapCooled and the evaporative condenser effectiveness value should be entered as 1.0. In this case, the Total Cooling Capacity Modifier Curve (function of temperature) will utilize the outdoor wet-bulb temperature.

If the user wishes to model an air-cooled condenser that has evaporative media placed in front of it to cool the air entering the condenser coil, then the user should specify Condenser Type = EvapCooled. The user must also enter the appropriate evaporative effectiveness for the media. In this case, the Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) will utilize the condenser inlet air temperature as calculated below:

<div>$${T_{c,i}} = \left( {{T_{wb,o}}} \right) + \left( {1 - EvapCondEffectiveness} \right)\left( {{T_{db,o}} - {T_{wb,o}}} \right)$$</div>

where

*T<sub>c,i</sub>* = the temperature of the air entering the condenser coil, °C

*T<sub>wb,o</sub>* = the wet-bulb temperature of the outdoor air, °C

*T<sub>db,o</sub>* = the dry-bulb temperature of the outdoor air, °C

The Total Cooling Capacity Modifier Curve (function of temperature) and the Energy Input Ratio Modifier Curve (function of temperature) input fields for the variable refrigerant flow air conditioner object should reference performance curves that are a function of outdoor dry-bulb temperature. Be aware that the evaporative media will significantly reduce the dry-bulb temperature of the air entering the condenser coil, so the Total Cooling Capacity and EIR Modifier Curves must be valid for the expected range of dry-bulb temperatures that will be entering the condenser coil.

#### Condenser Inlet Air Temperature

The air temperature entering the outdoor condenser is based on the weather data used during a simulation. This temperature is either taken directly from the weather data, or can be adjusted based on the height of the outdoor condenser. The input for Condenser Air Inlet Node Name can be used to control this optional feature. If this input is left blank, the air temperature entering the condenser is based solely on the weather data. If this input is not blank, then the node name specified must also be listed in an Outside Air Node or Outside Air Inlet Node List object. When the node name is listed in an Outside Air Inlet Node List object, the air temperature entering the condenser is based solely on the weather data. When the node name is listed in an Outside Air Node object, the height of the node determines the air temperature entering the outdoor condenser (see description of Local Outdoor Air Temperature Calculation in the Atmospheric Variation section of this document for further details).

#### Supply Air Fan Control: Cycling vs. Continuous

One of the inputs to the variable refrigerant flow terminal unit model is the supply air fan operation mode: cycling fan, cycling compressor or continuous fan, cycling compressor. The mode specified in the terminal unit object is passed to the DX cooling coil for use in the model calculations. The first operation mode is frequently referred to as “AUTO fan”, where the compressor(s) and supply air fan operate in unison to meet the zone cooling load, and cycle off together when the cooling load has been met. The second operation mode is often referred to as “fan ON”, where the compressor(s) cycle on and off to meet the zone cooling load but the supply air fan operates continuously regardless of compressor operation.

The fan operation mode schedule value determines the fan operation mode for each time step throughout the simulation. A fan operation mode schedule value of 0 specifies AUTO fan mode operation while values other than 0 specify fan ON operation. The use of a schedule allows the fan operation mode to change based on time-of-day or with changes in season.

The EnergyPlus methodology for determining the impact that HVAC equipment has on an air stream is to calculate the mass flow rate and air properties (e.g., enthalpy, dry-bulb temperature, humidity ratio) exiting the equipment. These exiting conditions are passed along as inlet conditions to the next component model in the air stream. Eventually the flow rate and properties of the air being supplied to the conditioned zone are used in the zone energy balance to determine the resulting zone air temperature and humidity ratio.

With this methodology, the determination of the air mass flow rate and air properties for the two different supply air fan operation modes is slightly different. For the case of cycling fan/cycling compressor, the conditions of the air leaving the cooling coil are the steady-state values calculated using the equations described above. However the air mass flow rate passed along to the next component (and eventually to the conditioned zone) is the average air mass flow rate for the system simulation time step.

For the case of continuous fan/cycling compressor, the air mass flow rate is constant. However, the air properties leaving the cooling coil are calculated as the average conditions during the system simulation time step. The model assumes that the exiting air conditions are the steady-state values calculated using the equations described above when the heat pump operates.  For the remainder of the system simulation time step, it is assumed that the air exiting the DX coil has the same properties as the air entering the coil. For this supply air fan operating strategy, the leaving air properties are calculated as follows:

<div>$${h_{out,\,ContFanCycComp}} = {h_{out}}\left( {CyclingRatio} \right) + {h_{in}}\left( {1 - CyclingRatio} \right)$$</div>

<div>$${\omega_{out,\,ContFanCycComp}} = {\omega_{out}}\left( {CyclingRatio} \right) + {\omega_{in}}\left( {1 - CyclingRatio} \right)$$</div>

<div>$${T_{db,out,ContFanCycComp}} = PsyTdbFnHW\left( {{h_{out,ContFanCycComp}},{\omega_{out,ContFanCycComp}}} \right)$$</div>

#### Average Air Flow Calculations

The variable refrigerant flow (VRF) terminal unit operates based on user-specified (or autosized) air flow rates. The VRF terminal unit’s supply air flow rate during cooling operation may be different than the supply air flow rate during heating operation. In addition, the supply air flow rate when no cooling or heating is required but the supply air fan remains ON can be different than the air flow rates when cooling or heating is required. The outside air flow rates can likewise be different for cooling and heating operating modes. The model takes these different flow rates into account when modeling the heat pump, and the average air flow rate for each simulation time step is reported on the inlet/outlet air nodes of the various terminal unit components in proportion to the calculated cycling ratio of the coil.

The average supply air and outdoor air mass flow rates through the heat pump for the HVAC simulation time step are calculated based on the cycling ratio of the DX cooling coil or heating coil (whichever coil is operating) as follows:

<div>$$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\, = \,\,\mathop m\limits^ \bullet  {\,_{SA,coil\,\,on}}\left( {CyclingRatio} \right) + \mathop m\limits^ \bullet  {\,_{SA,\,\,coil\,\,off}}\left( {1 - CyclingRatio} \right)$$</div>

<div>$$\mathop m\limits^ \bullet  {\,_{OA,\,\,avg\,\,}} = \,\,\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,on}}\left( {CyclingRatio} \right) + \mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,off}}\left( {1 - CyclingRatio} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}$</span>      = average supply air mass flow rate during the time step, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{SA,coil\,\,on}}$</span>   = supply air mass flow rate when the coil is ON, kg/s

*CyclingRatio*  = cycling ratio of the coil (heating or cooling)

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,coil\,\,off}}$</span>  = supply air mass flow rate when the coil is OFF, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,avg\,\,}}$</span>     = average outside air mass flow rate during the time step, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,on}}$</span>  = average outside air mass flow rate when the coil is ON, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,off}}$</span> = average outside air mass flow rate when the coil is OFF, kg/s

The supply air and outside air flow rates when the DX cooling or DX heating coil is ON are specified by the user (e.g., supply air volumetric flow rate during cooling operation, supply air volumetric flow rate during heating operation, outside air volumetric air flow rate during cooling operation, and outside air volumetric air flow rate during heating operation) and are converted from volumetric to mass flow rate. If the user has specified cycling fan operation, then the supply air and outside air mass flow rates when the coil is OFF are zero. If the user has specified constant fan operation, then the user-defined air flow rates when no cooling or heating is needed are used when the coil is OFF.

There is one special case. If the user has specified constant fan operation and they specify that the supply air volumetric flow rate when no cooling or heating is needed is zero (or field is left blank), then the model assumes that the supply air and outside air mass flow rates when the coil is OFF are equal to the corresponding air mass flow rates when the coil was last operating (ON).

### Variable Refrigerant Flow Heating Coil

The variable refrigerant flow (VRF) DX heating coil model uses performance information at rated conditions along with performance curves for variations in total capacity, energy input ratio and part load fraction to determine performance at part-load conditions. The impacts of defrost operation is modeled based a combination of user inputs and empirical models taken from the air-to-air heat pump algorithms in DOE-2.1E. The VRF DX heating coil model is very similar to the DX heating coil model used in the single-speed heat pump. The only difference being that the energy performance curves were moved to the parent object (Ref. AirConditioner:VariableRefrigerantFlow). See the DX Heating Coil model description for further details.

### Variable Speed Water to Air Heat Pump (Heating & Cooling)

#### Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit

#### Overview

A Variable Speed Water Source Heat Pump (let’s call it VS WSHP) has a system control which dictates the refrigerant flow rate, the design unit supply airflow and the required water flow rate at each compressor speed. The air and water flow rates are usually a function of the compressor speed. Refrigerant mass flow rate is a function of compressor speed as well as entering water temperature and indoor dry bulb or wet bulb. The control system adjusts the equipment capacity based on zone temperature measurements relative to the thermostat set point. The control logic determines what compressor speed is required to control to the zone temperature requirement in response to increased or decreased capacity (heating or cooling load). The compressor, fan and pump speeds are not discrete values and can be considered to vary infinitesimally between the minimum and maximum compressor speed. At the minimum compressor speed (which is different for heating and cooling), for a continuous fan, the supply airflow is fixed and the unit will have to cycle for reduced part loads below this point. For a cycling fan, the fan will cycle with the compressor.

Present EnergyPlus is capable of modeling multiple-speed DX air-to-air coils. The number of speed levels is up to four. In some cases, four sets of performance curves are not sufficient to include all the information for a variable speed equipment. There is a need to expand the space for containing more performance curves. Here, we expand the number of speed levels and the corresponding curve sets up to ten. The number of speed levels is selectable by the user. The user can provide speed levels at any number from 2 to 10. In any case, our model would just do linear interpolation between neighboring speeds. The more curves, the more accurate. Furthermore, using linear interpolation and inputting air and water flow rates at individual speed levels facilitates arbitrary relationships of flow rates as a function of the compressor speed level.

This model (object name Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit) simulates the performance of a variable-speed water-to-air heat pump with heating capability. It fits in the parent objects of *AirLoopHVAC:UnitaryHeatPump:WaterToAir* and *ZoneHVAC:WaterToAirHeatPump*. The rated conditions for obtaining the Reference Unit total heating capacities and COPs  are indoor dry-bulb temperature at 21.1 ˚C (70 ˚F) and the source side entering water temperature at 21.1 ˚C (70 ˚F).

#### Model Description

The Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit object is modeled in a manner similar to the multi-speed DX heating coil model (Ref. Coil:Heating:DX:MultiSpeed). Of course, rather than referencing an air source evaporator or defrost object, the new coil object references to the water loop, and has the entering water temperature in place of the indoor air entering dry bulb temperature.

It shall be noted for the capacity and flow rate inputs, three fields are autosizable, which are Rated Heating Capacity at the Selected Nominal Speed Level (Numeric Field 3), Rated Volumetric Air Flow Rate (Numeric Field 4) and Rated Volumetric Water Flow Rate (Numeric Field 5). They are used to scale the performances of a specific unit and correlate with the actual loop flows. Except these three fields, all other capacity and flow rate inputs at individual speed levels should be directly obtained from Reference Unit catalog data, specific to an actual unit.

The Rated Heating Capacity at Selected Nominal Speed Level contains the rated capacity to match the building heating load at the design day.  The rated heating capacity is used to determine a capacity scaling factor, as compared to the Reference Unit capacity at the nominal speed level.

<div>$$CapacityScaleFactor = \frac{{RatedTotalHeatingCapacity}}{{ReferenceUnitTotalHeatingCapacity@NominalSpeedLevel}}$$</div>

And then, this scaling factor is used to determine capacities at rated conditions for other speed levels, as below:

<div>$$\begin{array}{l}RatedTotalHeatingCapacity@SpeedLevel\left( x \right) = CapacityScaleFactor\\\quad \quad \quad  \times ReferenceUnitTotalHeatingCapacity@SpeedLevel(x)\end{array}$$</div>

The Rated Volumetric Air Flow Rate is used to determine an internal scaling factor, and calculate the air flow rates in the parent objects, as follows:

<div>$$AirFlowScaleFactor = \frac{{RatedVolumetricAirFlowRate}}{{ReferenceUnitVolAirFlowRate@NominalSpeedLevel \times CapacityScaleFactor}}$$</div>

And the loop volumetric air flow rates at various speed levels in the parent objects are calculated as below:

<div>$$\begin{array}{l}LoopVolumetricAirFlowRate@SpeedLevel\left( x \right) = AirFlowScaleFactor\\\quad \quad \quad \quad  \times ReferenceUnitVolAirFlowRate@SpeedLevel(x)\\\quad \quad \quad \quad  \times CapacityScaleFactor\end{array}$$</div>

If the volumetric air flow rate at one speed level is higher than the flow rate allowed by the fan in the parent object, the flow rate will be set back to the fan flow rate.

This Rated Volumetric Water Flow Rate is used to determine an internal scaling factor, and calculate the loop water flow rates.

<div>$$WaterFlowScaleFactor = \frac{{RatedVolumetricWaterFlowRate}}{{ReferenceUnitVolWaterFlowRate@NominalSpeedLevel \times CapacityScaleFactor}}$$</div>

And the required volumetric water flow rates in the parent objects are calculated as below,

<div>$$\begin{array}{l}LoopVolumetricWaterFlowRate@SpeedLevel\left( x \right) = WaterFlowScaleFactor\\\quad \quad \quad  \times ReferenceUnitWaterVolFlowRate@SpeedLevel(x)\\\quad \quad \quad  \times CapacityScaleFactor\end{array}$$</div>

The required volumetric water flow rate as above should be restricted by the pump in the water loop.

If <span>$AirFlowScaleFactor$</span> and <span>$WaterFlowScaleFactor$</span> equal unity, the loop flow rates become the design flow rates of the Reference Unit (after scaled by the rated heating capacity). The Rated Volumetric Air Flow Rate and Rated Volumetric Water Flow Rate are introduced here to correlate with the actual flow rates in the air and water loops, in case that these differ from the design specification. Certainly, it is recommended that the Rated Volumetric Air Flow Rate and Rated Volumetric Water Flow Rate are selected in the way that <span>$AirFlowScaleFactor$</span> and <span>$WaterFlowScaleFactor$</span> are unity, so as to get more accurate results from the performance curves.

Performance curves:

This object includes 7 curve objects at each individual speed level.

1)  Total heating capacity modifier curve (function of temperature).

2)  Total heating capacity modifier curve (function of air flow fraction).

3)  Total heating capacity modifier curve (function of water flow fraction).

4)  Energy input ratio (EIR) modifier curve (function of temperature).

5)  Energy input ratio (EIR) modifier curve (function of air flow fraction).

6)  Energy input ratio (EIR) modifier curve (function of water flow fraction).

7) Recoverable heat modifier as a function of indoor air dry-bulb and water entering temperatures.

Curves 3) and 6) are new curves as compared to those used for Multi-Speed Electric DX Air Heating Coil, as to correlate the change in water flow rate at the speed. The flow fraction modifier curves are used as a placeholder, to account for off-design flow rates if needed. If the manufacturer doesn’t provide off-design performances, we can simply use a default modification multiplier of 1.0.

At the lowest speed, there will be one additional performance curve to account for the part-load condition, i.e.

8)  Part load fraction correlation (function of part load ratio)



1) Total heating capacity modifier curve (function of temperature)

The total heating capacity modifier as a function of temperature curve (CAP-FT) is a biquadratic curve with two independent variables: dry-bulb temperature of the air entering the heating coil and the VS WSHP’s entering water temperature. The output of this curve is multiplied by the rated total heating capacity at the speed, to give the total heating capacity at the specific entering air and water temperatures at which the WSHP unit is operating (i.e., at temperatures different from the rating point temperatures). 

<div>$$TotCapTempModFac = a + b*D{B_i} + c*DB_i^2 + d*EWT + e*EW{T^2} + f*D{B_i}*EWT$$</div>

where

DB<sub>i</sub> = dry-bulb temperature of the air entering the heating coil, °C

EWT = entering water temperature, °C

a-f = regression curve-fit coefficients

2) Total heating capacity modifier curve (function of air flow fraction)

<div>$$TotCapAirFlowModFac = a + b*f{f_a} + c*ff_a^2 + d*ff_a^3$$</div>

where

ff<sub>a</sub> = actual air mass flow rate/design air mass flow rate, at one speed level;

<div>$$\begin{array}{l}DesignAirMassFlowRate@SpeedLevel(x) = \\\quad \quad \quad ReferenceUnitAirMassFlowRate@SpeedLevel(x)\\\quad \quad \quad \quad  \times CapacityScaleFactor\end{array}$$</div>

a-d = regression curve-fit coefficients, if no data available for the correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

3) Total heating capacity modifier curve (function of water flow fraction)

<div>$$TotCapWaterFlowModFac = a + b*f{f_w} + c*ff_w^2 + d*ff_w^3$$</div>

where

ff<sub>w</sub> = actual water mass flow rate/design water mass flow rate, at one speed level;

<div>$$\begin{array}{l}DesignWaterMassFlowRate@SpeedLevel(x) = \\\quad \quad \quad ReferenceUnitWaterMassFlowRate@SpeedLevel(x)\\\quad \quad \quad  \times CapacityScaleFactor\end{array}$$</div>

a-d = regression curve-fit coefficients, if no data available for the correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

4) Energy input ratio (EIR) modifier curve (function of temperature)

The energy input ratio modifier curve as a function of temperature (EIR-FT) is a biquadratic curve with two independent variables: dry-bulb temperature of the air entering the heating coil and the WSHP’s entering water temperature. The output of this curve is multiplied by the rated EIR at the speed (inverse of the rated COP), to give the EIR at the specific entering air and water temperatures at which the WSHP coil unit is operating (i.e., at temperatures different from the rating point temperatures).

<div>$$EIRTempModFac = a + b*D{B_i} + c*DB_i^2 + d*EWT + e*EW{T^2} + f*D{B_i}*EWT$$</div>

where

DB<sub>i</sub> = dry-bulb temperature of the air entering the heating coil, °C

EWT = entering water temperature, °C

a-f = regression curve fit coefficients.

5) Energy input ratio (EIR) modifier curve (function of air flow fraction)

<div>$$EIRAirFlowModFac = a + b*f{f_a} + c*ff_a^2 + d*ff_a^3$$</div>

where

a-d = regression curve-fit coefficients, if no data available for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

6) Energy input ratio (EIR) modifier curve (function of water flow fraction)

<div>$$EIRWaterFlowModFac = a + b*f{f_w} + c*ff_w^2 + d*ff_w^3$$</div>

where

a-d = regression curve fit coefficients, if no data available for the correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

7) Recoverable heat modifier as a function of indoor dry-bulb and water entering temperatures.

Recoverable heat modifier function accounts for the recoverable waste heat at the condensing side, as a fraction to the input power. This part of heat doesn’t added to the supply side.

<div>$$WasteHeatTempModFac = a + b*D{B_i} + c*DB_i^2 + d*EWT + e*EW{T^2} + f*D{B_i}*EWT$$</div>

where

a-f = regression curve-fit coefficients.

8) Part load fraction correlation (function of part load ratio)

This field defines the name of a quadratic or cubic performance curve (Ref: Performance Curves) that parameterizes the variation of electrical power input to the unit as a function of the part load ratio (PLR, heating load/steady-state heating capacity for Speed 1),

<div>$$PartLoadFrac = a + b*PLR + c*PL{R^2} + d*PL{R^3}$$</div>

And

RTF = (PLR/PartLoadFrac) = runtime fraction of the heating coil

The part load fraction (PLF) correlation accounts for efficiency losses due to compressor cycling. The part load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the compressor runs continuously for the simulation timestep). For PLR values between 0 and 1 (0 &lt;= PLR &lt; 1), the following rules apply:

PLF &gt;= 0.7 and PLF &gt;= PLR

If PLF &lt; 0.7, the program resets the PLF value to 0.7, and the simulation proceeds. The runtime fraction of the coil is defined as PLR/PLF. If PLF &lt; PLR, the runtime fraction of the coil is limited to 1.0. A typical part load fraction correlation would be:

<div>$${\rm{PLF}} = 0.85 + 0.15 \times {\rm{PLR}}$$</div>

If the user wishes to model no efficiency degradation due to compressor cycling, the part load fraction correlation should be defined as follows:

<div>$${\rm{PLF}} = 0.85 + 0.0 \times {\rm{PLR}}$$</div>

Lowest Speed Operation:

The lowest speed operation of the VS WSHP is similar to the single speed DX heating coil. The total (gross) heating capacity of the WSHP unit is calculated as follows:

<span>$\begin{array}{l}{Q_{total,1}} = RatedTotalHeatingCapacity@SpeedLevel\left( 1 \right)\\\quad \quad \quad *TotCapTemModFa{c_1}\\\quad \quad \quad *TotCapAirFlowModFa{c_1}\\\quad \quad \quad *TotCapWaterFlowModFa{c_1}\end{array}$</span>* *

And the EIR is calculated as:

<div>$$\begin{array}{l}EI{R_1} = \frac{{1.0}}{{ReferenceUnitCOP@Speed(1)}}EIRTempModFa{c_1}\\\quad \quad \quad *EIRAirFlowModFa{c_1}\\\quad \quad \quad *EIRWaterFlowModFa{c_1}\end{array}$$</div>

And the power consumption including the compressor and accessories (not including pump and indoor fan powers) is,

<div>$$Powe{r_1} = {Q_{total,1}}*EI{R_1}*RTF$$</div>

The waste heat generated by this coil object is calculated as:

<div>$$\begin{array}{l}{Q_{RecoverHeat,1}} = ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( 1 \right)\\\quad \quad \quad *Powe{r_1}\\\quad \quad \quad *WasteHeatTempModFa{c_1}\end{array}$$</div>

where

<span>$ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( 1 \right)$</span> = waste heat fraction of the energy input at Speed 1, from the Reference Unit data.

The total amount of heat absorbed by the evaporator is calculated as:

<div>$${\rm{Q}}{{\rm{}}_{evap,1}} = {Q_{total,1}} + {\rm{}}{Q_{RecoverHeat,1}} - Powe{r_1}$$</div>

The fraction of the actual air mass flow to the design air mass flow rate is calculated:

<div>$$\begin{array}{l}f{f_{a,1}} = actualairmassflowrate/\\\quad \quad \quad (ReferenceUnitAirMassFlowRate@SpeedLevel(1)\\\quad \quad \quad  \times CapacityScaleFactor)\end{array}$$</div>

The fraction of the actual water mass flow to the design water mass flow rate is calculated:

<span>$\begin{array}{l}f{f_{w,1}} = actualwatermassflowrate/\\\quad \quad \quad (ReferenceUnitWaterMassFlowRate@SpeedLevel(1)\\\quad \quad \quad  \times CapacityScaleFactor)\end{array}$</span>* *

Higher Speed Operation:

At the speed level between the lowest and the highest, there is no part-load loss. A parameter of speed ratio (SpeedRatio) is used to define the capacity partition between Speed x-1 and Speed x.

The design air and water flow rate at the speed ratio are given as following:

 <span>$\begin{array}{l}{\rm{DesignAirFlowRateSpeedRatio}} = ReferenceUnitAirMassFlowRate@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *CapacityScaleFactor\\\quad \quad \quad {\rm{*}}\left( {1{\rm{}}--{\rm{SpeedRatio}}} \right)\\\quad \quad \quad  + ReferenceUnitAirMassFlowRate@SpeedLevel\left( x \right)\\\quad \quad \quad *CapacityScaleFactor\\\quad \quad \quad *SpeedRatio{\rm{}}\end{array}$</span>

<div>$$\begin{array}{l}{\rm{DesignWaterFlowRateSpeedRatio}} = ReferenceUnitWaterMassFlowRate@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *CapacityScaleFactor\\\quad \quad \quad {\rm{*}}\left( {1{\rm{}}--{\rm{SpeedRatio}}} \right)\\\quad \quad \quad  + ReferenceUnitWaterMassFlowRate@SpeedLevel\left( x \right)\\\quad \quad \quad *CapacityScaleFactor\\\quad \quad \quad *SpeedRatio\end{array}$$</div>

And the fractions of air flow and water flow are given:

<span>$f{f_{a,x - 1}}$</span>= <span>$f{f_{a,x}}$</span>= actual air mass flow rate/DesignAirFlowRateSpeedRatio

<span>$f{f_{w,x - 1}}$</span>= <span>$f{f_{w,x}}$</span>= actual water mass flow rate/DesignWaterFlowRateSpeedRatio

The total heating capacities and EIRs at Speed x-1 and Speed x are given:

<div>$$\begin{array}{l}{Q_{total,x - 1}} = RatedTotalHeatingCapacity@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *TotCapTempModFa{c_{x - 1}}\\\quad \quad \quad *TotCapAirFlowModFa{c_{x - 1}}\\\quad \quad \quad *TotCapWaterFlowModFa{c_{x - 1}}\end{array}$$</div>

<div>$$\begin{array}{l}{Q_{total,x}} = RatedTotalHeatingCapacity@SpeedLevel\left( x \right)\\\quad \quad \quad *TotCapTempModFa{c_x}\\\quad \quad \quad *TotCapAirFlowModFa{c_x}\\\quad \quad \quad *TotCapWaterFlowModFa{c_x}\end{array}$$</div>

<span>$\begin{array}{l}EI{R_{x - 1}} = \frac{{1.0}}{{ReferenceUnitCOP@Speed(x - 1)}}EIRTempModFa{c_{x - 1}}\\\quad \quad \quad *EIRAirFlowModFa{c_{x - 1}}\\\quad \quad \quad *EIRWaterFlowModFa{c_{x - 1}}\end{array}$</span>* *

<div>$$\begin{array}{l}EI{R_x} = \frac{{1.0}}{{ReferenceUnitCOP@Speed(x)}}EIRTempModFa{c_x}\\\quad \quad \quad *EIRAirFlowModFa{c_x}\\\quad \quad \quad *EIRWaterFlowModFa{c_x}\end{array}$$</div>

The total heating capacity at the corresponding speed ratio is:

<div>$${Q_{total,SpeedRatio}} = \left( {1.0 - SpeedRatio} \right)*{Q_{total,x - 1}} + SpeedRatio*{Q_{total,x}}$$</div>

And the power consumption is

<div>$$Powe{r_{SpeedRatio}} = \left( {1.0 - SpeedRatio} \right)*{Q_{total,x - 1}}*EI{R_{x - 1}} + SpeedRatio*{Q_{total,x}}*EI{R_x}$$</div>

The waste heat generated by this coil object is calculated as:

<span>$\begin{array}{l}{Q_{RecoverHeat,SpeedRatio}} = \left( {1.0 - SpeedRatio} \right)\\\quad \quad \quad *ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *WasteHeatTempModFa{c_{x - 1}}*{Q_{total,x - 1}}*EI{R_{x - 1}}\\\quad \quad \quad  + SpeedRatio\\\quad \quad \quad *ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( x \right)\\\quad \quad \quad *WasteHeatTempModFa{c_x}\\\quad \quad \quad *{Q_{total,x}}*EI{R_x}\end{array}$</span>* *

The total amount of heat absorbed by the evaporator is calculated as:

<div>$${Q_{evap,SpeedRatio}} = {Q_{total,SpeedRatio}} + {\rm{}}{Q_{RecoverHeat,SpeedRatio}} - Powe{r_{SpeedRatio}}$$</div>

At last,

<div>$${Q_{total,SpeedRatio}} = HeatingLoad$$</div>

If the speed reaches the highest level, the speed ratio becomes 1.0, and Speed x represents the highest speed.

#### Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit

#### Overview

This model (object name Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit) simulates the performance of an variable-speed water-to-air heat pump with cooling capability. It fits in the parent objects of *AirLoopHVAC:UnitaryHeatPump:WaterToAir* and *ZoneHVAC:WaterToAirHeatPump*. It has the same logic for varying the compressor, indoor fan and pump speeds as the *Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit* object. The rated conditions for obtaining the capacities, COPs and SHR  are indoor dry-bulb temperature at 26.67 ˚C (80 ˚F), wet bulb temperature at 19.44 ˚C (67 ˚F),  and the source side entering water temperature at 29.4 ˚C (85 ˚F).

Variable-speed cooling coils lead to varied dehumidification behaviors, that the Bypass Factor (BF) is not only dependent on the indoor air flow rate, but also on the refrigerant mass flow rate, i.e. the compressor speed. It is necessary to assess the BF approach for single-speed DX coil, to be used for the variable-speed systems.

TheDOE/ORNL Heat Pump Design Model(HPDM) is a steady-state vapor compression equipment simulation model, which is able to simulate the performance of a VS WSHP system. We rana calibrated HPDM model to produce performance data of a 2.5-ton, VS WSHPunit in space cooling mode. We ran the model to get the total cooling capacities and SHRs, by specifying the EWT at 65˚F, indoor air DB at 80˚F and relative humidity at 0.5, and then varying the indoor air flow rate from 400 scfm to 1000 scfm, the compressor speed from 30 HZ to 90 HZ in a 7×7 matrix. Based on the performance results, we used EES (Engineering Equation Solver) to back-calculate the corresponding BF factors and the A<sub>o</sub> (effective coil surface area) parameters,using the BF equations for the single speed DX cooling coil in EnergyPlus Engineering Reference.

And then, we plotted the resultant A<sub>o</sub> as a function of indoor air flow rate and compressor speed, as below:

![](EngineeringReference/media/image4240.svg.png)

Figure 181. Effective Surface Area (Ao) Changing with Compressor Speed and Indoor SCFM

![](EngineeringReference/media/image4241.svg.png)

Figure 182. Bypass Factor (BF) Changing with Compressor Speed and Indoor SCFM

As indicated in the two figures above, the compressor speed is a significant factor impacting the A<sub>o</sub> parameter and the BF factor. So, the current BF factor approach should be upgraded to accommodate variable-speed cooling coils.

As shown in the A<sub>o</sub> figure, we can almost assume that the A<sub>o</sub> parameter mainly depends on the compressor speed. And thus, for enhancing the VS WSHP model, in the IDF file, we need to input SHRs at individual compressor speeds (this is similar to the current multi-speed DX cooling coil). And then, within the VS WSHP module, we calculate the A<sub>o</sub> parameter specific to each compressor speed at the design air flow rates, and then do linear interpolation of A<sub>o</sub> between neighboring compressor speeds. For calculating SHRs in energy simulations, we first calculate the A<sub>o</sub> parameter related to the actual compressor speed, and then use the simulated A<sub>o</sub> parameter in the original BF correlation to correlate effect of the varied indoor air flow rate.

#### Model Description

The Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit object is modeled in a manner similar to the multiple-speed DX cooling coil model (Ref. Coil:Cooling:DX:MultiSpeed). Of course, rather than referencing an air-cooled condenser, the new coil object references the water loop, and have the water entering temperature in place of the condenser air entering dry bulb temperature.

It shall be noted for the total cooling capacity and flow rate inputs, three fields are autosizable, which are Rated Total Cooling Capacity (Numeric Field 3) at Selected Nominal Speed Level, Rated Volumetric Air Flow Rate (Numeric Field 4)  and Rated Volumetric Water Flow Rate (Numeric Field 5). They are used to scale the performances of an actual unit and correlate with the actual loop flows. Except the three fields, all other total cooling capacity and flow rate inputs at individual speed levels should be directly obtained from Reference Unit catalog data, specific to an actual unit.

The Rated Total Cooling Capacity at Selected Nominal Speed Level contains the rated total cooling capacity to match the building sensible or latent cooling load.  The rated cooling capacity is used to determine a capacity scaling factor, as compared to the Reference Unit catalog capacity at the nominal speed level. 

<div>$$CapacityScaleFactor = \frac{{RatedTotalCoolingCapacity}}{{ReferenceUnitTotalCoolingCapacity@NominalSpeedLevel}}$$</div>

And then, this scaling factor is used to determine capacities at rated condition for other speed levels, as below,

<div>$$\begin{array}{l}RatedTotalCoolingCapacity@SpeedLevel\left( x \right) = CapacityScaleFactor\\\quad \quad \quad  \times ReferenceUnitTotalCoolingCapacity@SpeedLevel(x)\end{array}$$</div>

The Rated Volumetric Air Flow Rate is used to determine an internal scaling factor, and calculate the air flow rates in the parent objects, as follows:

<div>$$\begin{array}{l}AirFlowScaleFactor = \\\quad \quad \quad \frac{{RatedVolumetricAirFlowRate}}{{ReferenceUnitVolAirFlowRate@NominalSpeedLevel \times CapacityScaleFactor}}\end{array}$$</div>

And the loop volumetric air flow rates in the parent objects are calculated as below,

<div>$$\begin{array}{l}LoopVolumetricAirFlowRate@SpeedLevel\left( x \right) = \\\quad \quad \quad AirFlowScaleFactor \times ReferenceUnitVolAirFlowRate@SpeedLevel(x) \times CapacityScaleFactor\end{array}$$</div>

If the volumetric air flow rate at one speed level is higher than the flow rate allowed by the fan in the parent object, the flow rate will be set back to the fan flow rate.

This Rated Volumetric Water Flow Rate is used to determine an internal scaling factor, and calculate the loop water flow rates.

<div>$$\begin{array}{l}WaterFlowScaleFactor = \\\quad \quad \quad \frac{{RatedVolumetricWaterFlowRate}}{{ReferenceUnitVolWaterFlowRate@NominalSpeedLevel \times CapacityScaleFactor}}\end{array}$$</div>

And the required volumetric water flow rates in the parent objects are calculated as below,

<div>$$\begin{array}{l}LoopVolumetricWaterFlowRate@SpeedLevel\left( x \right) = \\\quad \quad \quad WaterFlowScaleFactor \times ReferenceUnitVolWaterFlowRate@SpeedLevel(x) \times CapacityScaleFactor\end{array}$$</div>

The required volumetric water flow rate as above is restricted by the pump in the parent object.

If <span>$AirFlowScaleFactor$</span> and <span>$WaterFlowScaleFactor$</span> are equal to unity, the loop flow rates become the design flow rates of the original unit (after scaled by the rated total cooling capacity). The Rated Volumetric Air Flow Rate and Rated Volumetric Water Flow Rate are introduced here to correlate with the actual flow rates in the air and water loops, in case that these differ from the design specifications. Certainly, it is recommended that the Rated Volumetric Air Flow Rate and Rated Volumetric Water Flow Rate are selected in the way that <span>$AirFlowScaleFactor$</span> and <span>$WaterFlowScaleFactor$</span> are unity, so as to get more accurate results from the performance curves.

Performance Curves:

This object includes 7 curve objects at each individual speed level.

1)  Total cooling capacity modifier curve (function of temperature)

2)  Total cooling capacity modifier curve (function of air flow fraction)

3)  Total cooling capacity modifier curve (function of water flow fraction)

4)  Energy input ratio (EIR) modifier curve (function of temperature)

5)  Energy input ratio (EIR) modifier curve (function of air flow fraction)

6)  Energy input ratio (EIR) modifier curve (function of water flow fraction)

7) Recoverable heat modifier as a function of indoor air wet-bulb and water entering temperatures.

Curves 3) and 6) are new curves as compared to those used for Multi-Speed Electric DX Air Cooling Coil, to correlate the change in water flow rate at the speed. The flow fraction modifier curves are used as a placeholder, to account for off-design flow rates if needed. If the manufacturer doesn’t provide the off-design performances, we can simply use a default modification multiplier of 1.0.

At the lowest speed, there will be one additional performance curve to correlate the part-load condition, i.e.

**8)** Part load fraction correlation (function of part load ratio)

1)     Total cooling capacity modifier curve (function of temperature)

The total cooling capacity modifier as a function of temperature curve (CAP-FT) is a biquadratic curve with two independent variables: wet-bulb temperature of the air entering the cooling coil and the WSHP’s entering water temperature. The output of this curve is multiplied by the rated total cooling capacity at the speed, to give the total cooling capacity at the specific entering air WB and water temperatures at which the WSHP unit is operating (i.e., at temperatures different from the rating point temperatures).

Note: The data used to develop the total cooling capacity modifier curve (function of temperature) should represent performance when the cooling coil is ‘wet’ (i.e., coil providing sensible cooling and at least some dehumidification). Performance data when the cooling coil is ‘dry’ (i.e., not providing any dehumidification) should not be included when developing this modifier curve. This model automatically detects and adjusts for ‘dry coil’ conditions.

<div>$$TotCapTempModFac = a + b*W{B_i} + c*WB_i^2 + d*EWT + e*EW{T^2} + f*W{B_i}*EWT$$</div>

where

WB<sub>i</sub> = wet-bulb temperature of the air entering the heating coil, °C

EWT = entering water temperature, °C

a-f = regression curve-fit coefficients.

2)     Total cooling capacity modifier curve (function of air flow fraction)

The total cooling capacity modifier curve (function of air flow fraction) is a cubic curve with the independent variable being the ratio of the actual air flow rate across the cooling coil to the design air flow rate (i.e., fraction of design flow at the speed).

<div>$$TotCapAirFlowModFac = a + b*f{f_a} + c*ff_a^2 + d*ff_a^3$$</div>

where

ff<sub>a</sub> = actual air mass flow rate/design air mass flow rate, at one speed level;

<div>$$\begin{array}{l}DesignAirMassFlowRate@SpeedLevel(x) = \\\quad \quad \quad ReferenceUnitAirMassFlowRate@SpeedLevel(x) \times CapacityScaleFactor\end{array}$$</div>

a-d = regression curve fit coefficients, if no data for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

3)     Total cooling capacity modifier curve (function of water flow fraction)

The total cooling capacity modifier curve (function of water flow fraction) is a cubic curve with the independent variable being the ratio of the actual water flow rate across the water-to-refrigerant heat exchanger to the design water flow rate (i.e., fraction of design flow at the speed).

<div>$$TotCapWaterFlowModFac = a + b*f{f_w} + c*ff_w^2 + d*ff_w^3$$</div>

where

ff<sub>w</sub> = actual water mass flow rate/design water mass flow rate, at one speed level;

<div>$$\begin{array}{l}DesignWaterMassFlowRate@SpeedLevel(x) = \\\quad \quad \quad ReferenceUnitWaterMassFlowRate@SpeedLevel(x) \times CapacityScaleFactor\end{array}$$</div>

a-d = regression curve-fit coefficients, if no data available for the correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

4) Energy input ratio (EIR) modifier curve (function of temperature)

The energy input ratio modifier curve as a function of temperature (EIR-FT) is a biquadratic curve with two independent variables: wet-bulb temperature of the air entering the cooling coil and the WSHP’s entering water temperature. The output of this curve is multiplied by the rated EIR (inverse of the rated COP) at the speed level, to give the EIR at the specific entering air and water temperatures at which the WSHP unit is operating (i.e., at temperatures different from the rating point temperatures).

<div>$$EIRTempModFac = a + b*W{B_i} + c*WB_i^2 + d*EWT + e*EW{T^2} + f*W{B_i}*EWT$$</div>

where

WB<sub>i</sub> = wet-bulb temperature of the air entering the cooling coil, °C

EWT = entering water temperature, °C

a-f = regression curve fit coefficients

5) Energy input ratio (EIR) modifier curve (function of air flow fraction)

<div>$$EIRAirFlowModFac = a + b*f{f_a} + c*ff_a^2 + d*ff_a^3$$</div>

where

a-d = regression curve fit coefficients, if no data available for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

6) Energy input ratio (EIR) modifier curve (function of water flow fraction)

<div>$$EIRWaterFlowModFac = a + b*f{f_w} + c*ff_w^2 + d*ff_w^3$$</div>

where

a-d = regression curve fit coefficients, if no data available for correction, the user can simply put a = 1.0, and the other coefficients as 0.0.

7) Recoverable heat modifier as a function of indoor wet-bulb and water entering temperatures.

Recoverable heat modifier function is to account for the recoverable heat at the condensing side, as a fraction to the power input, which doesn’t discharged to the water side.

<div>$$WasteHeatTempModFac = a + b*W{B_i} + c*WB_i^2 + d*EWT + e*EW{T^2} + f*W{B_i}*EWT$$</div>

where

a-f = regression curve fit coefficients

8) Part load fraction correlation (function of part load ratio)

This field defines the name of a quadratic or cubic performance curve (Ref: Performance Curves) that parameterizes the variation of electrical power input to the unit as a function of the part load ratio (PLR, Sensible or Latent Load/Steady-State Sensible or Latent Capacity  for Speed 1). The description of the part load fraction correlation for the VS WSHP cooling coil is similar to the VS WSHP heating coil.



Lowest Speed Operation:

The lowest speed operation of the VS WSHP is similar to the single speed DX cooling coil. The total (gross) cooling capacity of the WSHP unit is calculated as follows:

<div>$$\begin{array}{l}{Q_{total,1}} = RatedTotalCoolingCapacity@SpeedLevel\left( 1 \right)\\\quad \quad \quad *TotCapTempModFa{c_1}\\\quad \quad \quad {\rm{*}}TotCapAirFlowModFa{c_1}\\\quad \quad \quad *TotCapWaterFlowModFa{c_1}\end{array}$$</div>

And the EIR is calculated as:

<span>$\begin{array}{l}EI{R_1} = \frac{{1.0}}{{ReferenceUnitCOP@Speed(1)}}EIRTempModFa{c_1}\\\quad \quad \quad *EIRAirFlowModFa{c_1}\\\quad \quad \quad *EIRWaterFlowModWaterFa{c_1}\end{array}$</span>* *

And the power consumption excluding the indoor fan and the water pump is,

<div>$$Powe{r_1} = {Q_{total,1}}*EI{R_1}*RTF$$</div>

Where RTF is the run-time fraction.

The recoverable waste heat is:

<div>$$\begin{array}{l}{Q_{RecoverHeat,1}} = ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( 1 \right)\\\quad \quad \quad *Powe{r_1}\\\quad \quad \quad *WasteHeatTempModFa{c_1}\end{array}$$</div>

And the net heat discharged to the water loop is calculated as following:

<span>${Q_{cond,1}} = Powe{r_1} + {Q_{total,1}} - {Q_{RecoverHeat,1}}$</span>.

At the lowest speed, the dehumidification calculation is exactly the same as the single speed DX coil. That is to use the rated SHR and the design air flow rate at the lowest speed to calculate rated bypass factor of BF<sub>rated,1</sub>, and the corresponding effective surface area of A<sub>o,1</sub>. Wh A<sub>o,1</sub> known, the coil BF can be adjusted for non-rated air flow rates. It shall be noted if choosing to add hot gas reheating to the supply side,  <span>${Q_{RecoverHeat,1}}$</span> should be subtracted from bh the total cooling capacity and the sensible cooling capacity.

And the part load ratio for sensible cooling is,

<div>$$PLR = SensibleCoolingLoad/({Q_{total,1}}*SH{R_1})$$</div>

For latent cooling,

<span>$PLR = LatentCoolingLoad/[{Q_{total,1}}*(1.0 - SH{R_1})]$</span>*.*

Higher Speed Operation:

At the speed level between the lowest and the highest, there is no part-load loss. A parameter of speed ratio (SpeedRatio) is used to define the capacity partition between Speed x-1 and Speed x.



the design air and water flow rate at the speed ratio are given as following:

<div>$$\begin{array}{l}{\rm{DesignAirFlowRateSpeedRatio}} = ReferenceUnitAirMassFlowRate@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *CapacityScaleFactor{\rm{*}}\left( {1{\rm{}}--{\rm{SpeedRatio}}} \right)\\\quad \quad \quad  + ReferenceUnitAirMassFlowRate@SpeedLevel\left( x \right)\\\quad \quad \quad *CapacityScaleFactor*SpeedRatio\end{array}$$</div>

<span>$\begin{array}{l}{\rm{DesignWaterFlowRateSpeedRatio}} = ReferenceUnitWaterMassFlowRate@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *CapacityScaleFactor{\rm{*}}\left( {1{\rm{}}--{\rm{SpeedRatio}}} \right)\\\quad \quad \quad  + ReferenceUnitWaterMassFlowRate@SpeedLevel\left( x \right)\\\quad \quad \quad *CapacityScaleFactor*SpeedRatio\end{array}$</span>.

And the fractions of air flow and water flow are given:

<span>$f{f_{a,x - 1}}$</span>. = <span>$f{f_{a,x}}$</span>= actual air mass flow rate/DesignAirFlowRateSpeedRatio

<span>$f{f_{w,x - 1}}$</span><span>$f{f_{w,x}}$</span>= actual water mass flow rate/DesignWaterFlowRateSpeedRatio

The total cooling capacities and EIRs at Speed x-1 and Speed x are calculated:

<span>$\begin{array}{l}{Q_{total,x - 1}} = RatedTotalCoolingCapacity@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *TotCapTempModFa{c_{x - 1}}\\\quad \quad \quad *TotCapAirFlowModFa{c_{x - 1}}\\\quad \quad \quad *TotCapWaterFlowModFa{c_{x - 1}}\end{array}$</span>* *

<span>$\begin{array}{l}{Q_{total,x}} = RatedTotalCoolingCapacity@SpeedLevel\left( x \right)\\\quad \quad \quad *TotCapTempModFa{c_x}\\\quad \quad \quad *TotCapAirFlowModFa{c_x}\\\quad \quad \quad *TotCapWaterFlowModFa{c_x}\end{array}$</span>* *

<span>$\begin{array}{l}EI{R_{x - 1}} = \frac{{1.0}}{{ReferenceUnitCOP@Speed(x - 1)}}EIRTempModFa{c_{x - 1}}\\\quad \quad \quad *EIRAirFlowModFa{c_{x - 1}}\\\quad \quad \quad *EIRWaterFlowModFa{c_{x - 1}}\end{array}$</span>* *

The total heating capacity at the corresponding speed ratio is:

<div>$${Q_{total,SpeedRatio}} = \left( {1.0 - SpeedRatio} \right)*{Q_{total,x - 1}} + SpeedRatio*{Q_{total,x}}$$</div>

And the power consumption, excluding the fan and pump power consumptions, is

<div>$$Powe{r_{SpeedRatio}} = \left( {1.0 - SpeedRatio} \right)*{Q_{total,x - 1}}*EI{R_{x - 1}} + SpeedRatio*{Q_{total,x}}*EI{R_x}$$</div>

*The recoverable waste heat is:*

<div>$$\begin{array}{l}{Q_{RecoverHeat,SpeedRatio}} = \left( {1.0 - SpeedRatio} \right)\\\quad \quad \quad *ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( {x - 1} \right)\\\quad \quad \quad *{\rm{WasteHeatTempModFa}}{{\rm{c}}_{x - 1}}*{Q_{total,x - 1}}*EI{R_{x - 1}}\\\quad \quad \quad  + SpeedRatio\\\quad \quad \quad *ReferenceUnitWasteHeatFractionofEnergyInput@SpeedLevel\left( x \right)\\\quad \quad \quad *{\rm{WasteHeatTempModFa}}{{\rm{c}}_x}\\\quad \quad \quad *{Q_{total,x}}*EI{R_x}\end{array}$$</div>

And the net heat discharged to the water loop is calculated as following:

<div>$${Q_{cond,SpeedRatio}} = Powe{r_{SpeedRatio}} + {Q_{total,SpeedRatio}} - {Q_{RecoverHeat,SpeedRatio}}$$</div>

And the effective surface area in the correlations of BF factor  is calculated as below:

<div>$${A_{o,SpeedRatio}} = \left( {1 - SpeedRatio} \right)*{A_{o,x - 1}} + SpeedRatio*{A_{o,x}}$$</div>

Using A<sub>o,SpeedRatio</sub> in the same BF and SHR calculation procedure as the single speed DX cooling coil, we can get BF<sub>SpeedRatio</sub>, and SHR<sub>SpeedRatio.</sub> And the sensible cooling capacity is calculated:

<div>$${Q_{sensible,SpeedRatio}} = {Q_{total,SpeedRatio}}*SH{R_{SpeedRatio}}$$</div>

It should be noted if choosing to add hot gas reheating to the supply side, <span>${Q_{RecoverHeat,SpeedRatio}}$</span> should be subtracted from both the total cooling capacity and the sensible cooling capacity.

At last, if the VS WSHP is used to match the sensible cooling load,

<div>$${Q_{sensible,SpeedRatio}} = SensibleLoad$$</div>

If it intends to match the latent cooling load,

<div>$${Q_{total,SpeedRatio}}*\left( {1.0 - SH{R_{SpeedRatio}}} \right) = LatentLoad$$</div>

If the speed reaches the highest level, the speed ratio becomes 1.0, and Speed n represents the highest speed.

#### References

Keith C. Rice, 2011, DOE/ORNL Heat Pump Design Model:

S.A. Klein 2011, User Manual of Engineering Equation Solver V8

#### Secondary Coils of DX Systems and Heat Pumps

#### Overview

Secondary coils reject to or remove heat from a secondary zone. Secondary coil refers to a condenser of a DX system or a heat pump in cooling operating mode or an evaporator of a heat pump in heating mode. The secondary coil (e.g. condenser) of DX system or heat pumps is commonly installed outdoor but when installed indoor either heat is dumped to or extracted from the secondary zone. A secondary zone is a conditioned or unconditioned zone where the secondary coil is installed. Secondary coils are not standalone DX coil objects but they are add-on features on existing DX coil objects. A secondary DX coil is modelled by specifying additional inputs in single speed and multi speed DX coil objects: The additional inputs allow us to model the heat rejected or extracted by the secondary coil while the primary coil serves another controlled zone as shown in [Figure](#SchematicDXCoil).  A secondary coil is not controlled directly but responds to the requirements of the primary DX coil. The operating mode of a secondary DX coil is determined by the primary DX coil serving the conditioned zone. If the primary DX coil is in cooling mode, then the secondary coil is rejecting heat (heating mode) to the secondary zone, or else if the  primary DX coil is in heating mode, then the secondary coil is extracting heat (cooling mode) from the secondary zone. Heat rejected to a secondary zone by a condenser of a DX system or a heat pump is considered as sensible only. Whereas energy extracted from a secondary zone may contain sensible and latent components. The condenser type of the primary DX coils should be AirCooled. There is no need to specify the condenser air inlet node. The model uses zone air node as the secondary coil air inlet node. Air drawn by the secondary coil fan passes through the secondary coil and dumped back into the secondary zone. The previous time step zone condition is used as an inlet condition to the current time for the secondary DX coil model.

![SchematicDXCoil](EngineeringReference/media/image8002.png)<a name="SchematicDXCoil"></a>

Figure: Schematic of DX System in cooling operating mode

The heat rejected or extracted by the secondary DX coil is estimated from the delivered capacity and electric power input of the primary DX coils. And the rejected or extracted heat is treated as internal gain of the secondary zone. Currently secondary DX coil are allowed in single speed, two speed and multi speed DX coil objects: _Coil:Cooling:DX:SingleSpeed_, _Coil:Heating:DX:SingleSpeed_, _Coil:Cooling:DX:TwoSpeed_, _Coil:Cooling:DX:MultiSpeed_, and _Coil:Heating:DX:MultiSpeed_.

#### Model Description:
The secondary coil performance calculation is invoked using inputs in the DX coil objects.  The input required for cooling and heating operation of the primary DX coils are different. In the DX cooling coils the only required input is the zone name where the secondary coil is installed. In heating DX coils six inputs are required for single speed coils and a minimum of 11 input fields are required for multispeed DX heating coils.  And five more inputs are required for every additional compressor speed. The extensible five input fields are used for splitting the total heat extraction rate into sensible and latent components. These five input fields are: rated sensible heat ratio, secondary air flow rates, scaling factor for auto-sizing secondary air flow rates, sensible heat ratio modifier curves as a function of temperature and sensible heat ratio modifier curves as a function of secondary air flow fraction. The secondary coil model assumes that liquid water from defrosting operation is drained to the outdoor and has no impact on the zone air heat balance. 

**Cooling Operating Mode:** the primary DX cooling coil of a DX system serving a primary zone is on and heat is rejected by the secondary coil (condenser) into a secondary zone. The secondary zone name is specified in DX cooling coil objects.  This operating mode applies to a DX cooling system and cooling operating mode of air-to-air single and multi-speed heat pumps. The heat rejected by the secondary coil (condenser) of a DX system or heat pump operating in cooling mode is given by:

<div>$$Q_\rm{cond}=Q_\rm{Evap}+P_\rm{CompCondFan}$$</div>

where

* \(Q_\rm{Evap}\) is the cooling load delivered by the primary DX cooling coil system, W 
* \(P_\rm{CompCondFan}\) is the compressor and evaporator fan electric power input of a heat pump in heating mode, W
* \(Q_\rm{cond}\) is the heat rejected by the secondary coil (condenser) of a DX system or heat pump, W

Heat rejected by a secondary coil (condenser) calculated at each time step becomes internal gain of the secondary zone as shown in [Figure](#SchematicDXAndSecondary). Whenever a secondary zone name is specified in DX cooling coil objects, the secondary DX coil model calculation is invoked.  New input field required as add-on to the DX cooling coil objects is "_Zone Name for Secondary Coil (condenser) Placement_".

![SchematicDXAndSecondary](EngineeringReference/media/image8003.png)<a name="SchematicDXCoil"></a>

Figure: Schematic of DX system and secondary coil (condenser)

**Heating Operating Mode:** When a heat pump operates in heating mode then energy is extracted from the secondary zone.  The total energy extracted is estimated by rearranging the equation above as follows:

<div>$$Q_\text{Evap} = Q_\text{cond} - P_\text{CompCondFan}$$</div>

where

* \(Q_\text{cond}\) is the heat delivered by the primary heating DX coil to the primary zone, W
* \(P_\text{CompCondFan}\) is the compressor and condenser fan electric power input of a DX system or heat pump in cooling mode, W
* \(Q_\text{Evap}\) is the energy extracted by secondary coil (evaporator) from the secondary zone, W

The total energy extracted from a secondary zone may contain sensible and latent components.  The secondary coil model checks for the coil inlet and full load outlet air condition to determine whether dehumidification will occur. The sensible and latent split of the energy extracted is done using a user specified rated sensible heat ratio (SHR) and SHR modifier curves for temperature and the secondary air flow fraction.  If the secondary coil operation is dry, then the SHR is set to 1.0.  In addition, the model assumes that defrosting operation is on, then the defrosting melts the frost and the liquid water from the collecting pan is drained to outside. Thus defrosting energy is not included in the zone energy balance. The heat extracted from the secondary zone may contain sensible and latent components and the secondary coil model does the sensible/latent heat split calculation.

#### Sensible Heat Ratio Calculation

The SHR calculation method uses user specified SHR modifying curves for temperature and flow fraction.  The modifying curves correct the rated SHR value for a given secondary DX coil (evaporator) entering air temperatures and air mass flow fraction for a given speed. If these SHR modifying curves are not specified a constant SHR will be assumed.  These two curves are a biquadratic SHR modifier curve for temperature (SHRFT), and a quadratic SHR correction curve for flow fraction (SHRFFF). The SHR is given by:

<div>$$SHR = SHR_\text{rated}\cdot SHRFT\left(T_\text{wb,secondaryZone},T_\text{db,primaryCoil}\right)\cdot SHRFFF(FF)$$</div>
 
where

* \(SHRFT\) is the sensible heat ratio modifier normalized biquadratic curve as a function of secondary DX coil entering air wet-bulb and primary DX coil entering air dry-bulb temperatures, (-). The secondary DX coil (evaporator) entering air wet-bulb temperature is the secondary zone air wet-bulb temperature.
* \(SHRFFF\) is the sensible heat ratio modifier normalized quadratic curve as a function of air mass flow fraction.  Flow fraction is the ratio of actual to rated mass flow rate of air through the secondary DX coil, (-).
* \(SHR_\text{rated}\) is the sensible heat ratio at rated condition, (-).

For multispeed secondary DX coils when the system is cycling between two speeds of _n_ and _n_-1 the operating SHR is weighted using _SpeedRatio_ as follows:

<div>$$SHR = SHR_n \cdot SpeedRatio +  SHR_{n-1} (1 - SpeedRatio)$$</div>
 
where

* \(SHR_n\) is the sensible heat ratio at speed n determined from user specified rated SHR, and SHR modifier curves at speed _n_, (-)
* \(SHR_{n-1}\) is the sensible heat ratio at speed _n_-1 determined from user specified rated SHR, and _SHR_ modifier curves at speed _n_-1, (-).
* _SpeedRatio_ is a parameter that relates performance between successive compressor speeds, (-).

#### Sensible and Latent Split
The air enthalpy difference across the secondary DX coil (evaporator) at full load is given by:

<div>$$h_\text{Delta} = \frac{\left(Q_\text{Evap}/PLR\right)}{\dot{m}_\text{cond}}$$</div>

The coil outlet enthalpy is calculated as follows:

<div>$$h_\text{Outlet}=h_\text{Inlet}-h_\text{Delta}$$</div>

Using the SHR calculated above and secondary DX coil outlet temperature is given by:

<div>$$T_\text{OutletNode} = T_\text{ZoneAirNode} -  \frac{\left(Q_\text{Evap}/PLR\right)\cdot SHR}{\dot{m}_\text{cond}c_p}$$</div>

Calculate the saturated outlet temperature at the outlet enthalpy and check the secondary outlet air condition if super-saturation has occurred:

<div>$$T_\text{OutletNode, Sat} = T_\text{SAT}\left(h_\text{Outlet}, P_\text{Tot}\right)$$</div>

    IF(\(T_\text{OutletNode} > T_\text{OutletNode, Sat}\)) Then
        \(\omega_\text{OutletNode} > \omega_\text{InletNode}\)
    ELSE
        (\(T_\text{OutletNode} = T_\text{OutletNode, Sat}\)
        The coil outlet humidity ratio is determined using psychrometric functions as follows.
        \(\omega_\text{OutletNode} = \omega\left(T_\text{OutletNode,Sat},h_\text{Outlet}\right)\)
    ENDIF

where

*\(h_\text{Inlet}\) is the enthalpy of air entering the passive coil, (J/kg)
*\(h_\text{Outlet}\) is the enthalpy of air leaving the passive coil, (J/kg)
*\(\dot{m}_\text{sec}\) is the secondary DX coil mass flow rate, (kg/s)
*\(PLR\) is the primary DX cooling coil compressor part-load ratio, (-)
*\(P_\text{Tot}\) is the total pressure at the inlet of secondary DX coil, (Pa)
*\(T_\text{OutletNode}\) is the secondary coil outlet air temperature, (degC)
*\(T_\text{OutletNode,Sat}\) is the secondary coil saturated air temperature at the outlet enthalpy, (degC)
*\(\omega_\text{InletNode}\) is the secondary coil inlet node air humidity ratio, (kgH2O/kgDryair)
*\(\omega_\text{OutletNode}\) is the secondary coil outlet node air humidity ratio, (kgH2O/kgDryair)


### Packaged Thermal Storage Cooling Coil

The DX cooling coil model for Coil:Cooling:DX:SingleSpeed:ThermalStorage is described in this section. The following diagram shows the main aspects of the model for packaged thermal energy storage cooling coil.  This model allows charging and discharging to shift cooling energy use. The dashed line shows the boundary of the empirical "black box" model.  The main parts are the Condenser, Evaporator, Compressor, and Thermal Energy Storage (TES) tank.  The model interacts with the surroundings via a condenser inlet and outlet nodes, evaporator inlet and outlet nodes, heat transfer between TES tank and surrounding ambient environment, and optional added plant connection to the TES tank.

![](EngineeringReference/media/image4287.png)

Figure 183. Highlights of Packaged Thermal Storage Cooling Coil

Depending on the operating mode, different parts are active.  There are six modes to consider.

**Off Mode** is when the unit is not running but the TES tank still interacts with ambient and the model needs to track the state of charge in the tank.

![](EngineeringReference/media/image4288.png)

Figure 184. Thermal Storage Cooling Coil Off Mode

Governing equations for Off Mode include:

<span>$ - M{c_p}\frac{{DT}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} = 0$</span>      (water tank)

<span>$ - M{h_{fs}}\frac{{DF}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} = 0$</span>     (ice tank)

<div>$${\dot Q_{Amb}} = {\left( {UA} \right)_{Tank}}\left( {{T_{TES}} - {T_{Amb}}} \right)$$</div>

<div>$${\dot Q_{Plant}} = \dot m\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$$</div>



**Cooling Only Mode** is when the unit is running but since it is neither charging nor discharging the TES tank, the model is essentially the same as a normal single speed DX cooling coil.  The latent degradation model is not available.  The model uses SHR curves  from user input.

![](EngineeringReference/media/image4293.png)

Figure 185. Thermal Storage Coil Cooling Only Modee



The governing equations for Cooling Only Mode include:

<span>$ - M{c_p}\frac{{DT}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} = 0$</span>      (water tank)

<span>$ - M{h_{fs}}\frac{{DF}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} = 0$</span>    (ice tank)

<div>$$\dot W + {\dot Q_{Evap}} + {\dot Q_{Cond}} = 0$$</div>

<div>$${\dot Q_{Amb}} = {\left( {UA} \right)_{Tank}}\left( {{T_{TES}} - {T_{Amb}}} \right)$$</div>

<div>$${\dot Q_{Plant}} = \dot m{c_p}\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$$</div>



The input correlations are used in the following manner to determine cooling capacity and energy consumption for a given set of operationg conditions.

One total evaporator cooling capacity modifier curve is a function of evaporator inlet wetbulb temperature and condenser inlet drybulb temperature.

<div>$$EvapCapTempModFac = {f_{}}\left( {{T_{evap,wb}},{\rm{}}{T_{cond,db}}} \right)$$</div>

Another total evaporator cooling capacity modifier curve is a function of air flow fraction through the evaporator section where air flow fraction is the ratio of current air mass flow rate to the rated air mass flow rate.

<div>$$EvapCapFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,{\rm{}}air}}} {{{\dot m}_{evap,{\rm{}}airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}airRated}}}$}}} \right)$$</div>

One energy input ratio modifier curve is a function of evaporator inlet wetbulb temperature and condenser inlet drybulb temperature.

<div>$$EIRTempModFac = f\left( {{T_{evap,wb}},{\rm{}}{T_{cond,db}}} \right)$$</div>

Another energy input ratio modifier curve is a function of flow fraction.

<div>$$EIRFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,{\rm{}}air}}} {{{\dot m}_{evap,{\rm{}}airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}airRated}}}$}}} \right)$$</div>

Part load degradation curve is a function of part load ratio.

<div>$$EvapPartLoadFac = f\left( {PLR} \right)$$</div>

The results of the performance curves are applied as follows to determine cooling capacity and energy performance:

<div>$${\dot Q_{Evap}} = {\dot Q_{Evap,RatedCoolOnly}}\left( {EvapCapTempModFac} \right)\left( {EvapCapFlowModFac} \right)$$</div>

<div>$${\dot W_{elec}} = \frac{{{{\dot Q}_{evap}}\left( {EIRTempModFac} \right)\left( {EIRFlowModFac} \right)\left( {PLR} \right)}}{{\left( {CO{P_{Rated,{\rm{}}CoolOnly}}} \right)\left( {EvapPartLoadFac} \right)}}$$</div>

The sensible heat ratio (SHR) is determined by a rated SHR and two performance curves. The SHR temperature modifying factor is a function of evaporator entering wetbulb and evaporator entering drybulb temperature.

<div>$$SHRTempModFac = f\left( {{T_{evap,wb}},{T_{evap,db}}} \right)$$</div>

The SHR flow fraction modifying factor is a function of air flow fraction through the evaporator section where air flow fraction is the ratio of current air mass flow rate to the rated air mass flow rate.

<div>$$SHRFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,{\rm{}}air}}} {{{\dot m}_{evap,{\rm{}}airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}airRated}}}$}}} \right)$$</div>

The results of the performance curves are applied as follows to determine SHR:

<div>$$SHR = SH{R_{rated}}*SHRTempModFac*SHRFlowModFac$$</div>

Cool and Charge Mode is when the unit is both cooling and charging the TES, then all the parts are active. The electric power into the compressor is split into two terms to accommodate devices that actually have dual compressors.

![](EngineeringReference/media/image4309.png)

Figure 186. Thermal Storage Coil Cool and Charge Modes

Governing Equations for “Cool and Charge Mode”

<span>$ - M{c_p}\frac{{DT}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>      (water tank)

<span>$ - M{h_{fs}}\frac{{DF}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>    (ice tank)

<div>$${\dot W_{Evap}} + {\dot W_{TES}} + {\dot Q_{Evap}} + {\dot Q_{Cond}} + {\dot Q_{TES}} = 0$$</div>

<div>$${\dot Q_{Amb}} = {\left( {UA} \right)_{Tank}}\left( {{T_{TES}} - {T_{Amb}}} \right)$$</div>

<span>${\dot Q_{Plant}} = \dot m{c_p}\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$</span><div>$${\dot Q_{Plant}} = \dot m\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$$</div>

The input correlations are used in the following manner to determine cooling capacity, chargine capacity, and energy consumption for a given set of operationg conditions.

One total evaporator cooling capacity modifier curve is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES, <span>${S_{TES}}$</span> (temperature of water or fraction of ice).

<div>$$EvapCapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another total evaporator cooling capacity modifier curve is a function of flow fraction.

<div>$$EvapCapFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

One evaporator energy input ratio modifier curve, function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$EIREvapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another energy input ratio modifier curve is a function of flow fraction.

<div>$$EIREvapFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

Part load degradation curve is a function of evaporator part load ratio.

<div>$$EvapPartLoadFac = f\left( {PLR} \right)$$</div>

One storage charge capacity modifier curve is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$TESCapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another storage charge capacity modifier curve is a function of evaporator part load ratio.

<div>$$TESCapPartLoadFac = f\left( {PLR} \right)$$</div>

The results of the performance curves are applied as follows to determine cooling capacity and energy performance:

<div>$${\dot Q_{Evap}} = {\dot Q_{Evap,RatedCoolAndCharge}}\left( {EvapCapTempModFac} \right)\left( {EvapCapFlowModFac} \right)$$</div>

<div>$${\dot Q_{TES}} = {\dot Q_{Charge,Rated}}\left( {TESCapTempModFac} \right)\left( {TESCapPartLoadFac} \right)$$</div>

<div>$${\dot W_{Evap,elec}} = \frac{{\left( {{{\dot Q}_{Evap}}} \right)\left( {EIRTempModFac} \right)\left( {EIRFlowModFac} \right)\left( {EvapPLR} \right)}}{{\left( {CO{P_{Rated,Cooling}}} \right)\left( {EvapPartLoadFac} \right)}}$$</div>

<span>${\dot W_{TES,elec}} = \frac{{\left( {{{\dot Q}_{TES}}} \right)\left( {EIRStorTempModFac} \right)\left( {EIRStorFlowModFac} \right)\left( {StorPLR} \right)}}{{\left( {CO{P_{Rated,Charging}}} \right)\left( {StorPartLoadFac} \right)}}$</span>.

The sensible heat ratio (SHR) is determined by a rated SHR and two performance curves. There are two options for the SHR temperature modifying factor, it can either be a function of evaporator entering wetbulb and evaporator entering drybulb temperature or it can add a third independent variable for the state of charge of TES.

<div>$$\begin{array}{l}SHRTempModFac = \left\{ \begin{array}{l}f\left( {{T_{evap,wb}},{T_{evap,db}}} \right)\\f\left( {{T_{evap,wb}},{T_{evap,db}},{S_{TES}}} \right)\end{array} \right.\\\end{array}$$</div>

The SHR flow fraction modifying factor is a function of air flow fraction through the evaporator section where air flow fraction is the ratio of current air mass flow rate to the rated air mass flow rate.

<div>$$SHRFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,{\rm{}}air}}} {{{\dot m}_{evap,{\rm{}}airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}airRated}}}$}}} \right)$$</div>

The results of the performance curves are applied as follows to determine SHR:

<div>$$SHR = SH{R_{rated}}*SHRTempModFac*SHRFlowModFac$$</div>



**Cool and Discharge Mode** is when the unit is both cooling and discharging the TES, then all the parts are active. The electric power into the compressor is split into two terms to accommodate devices that actually have dual compressors.





![](EngineeringReference/media/image4331.png)

Figure 187. Thermal Storage Coil Cool and Discharge Modes



Governing Equations for “Cool and Discharge Mode”

<span>$ - M{c_p}\frac{{DT}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>      (water tank)

<span>$ - M{h_{fs}}\frac{{DF}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>    (ice tank)

<div>$${\dot W_{Evap}} + {\dot W_{TES}} + {\dot Q_{Evap}} + {\dot Q_{Cond}} + {\dot Q_{TES}} = 0$$</div>

<div>$${\dot Q_{Amb}} = {\left( {UA} \right)_{Tank}}\left( {{T_{TES}} - {T_{Amb}}} \right)$$</div>

<span>${\dot Q_{Plant}} = \dot m{c_p}\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$</span><div>$${\dot Q_{Plant}} = \dot m\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$$</div>

The input correlations are used in the following manner.

One total evaporator cooling capacity modifier curve is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$EvapCapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another Total evaporator cooling capacity modifier curve is a function of flow fraction.

<div>$$EvapCapFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

One evaporator energy input ratio modifier curve is a function of of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$EIREvapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another evaporator energy input ratio modifier curve is a function of flow fraction.

<div>$$EIREvapFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

Evaporator part load degradation curve is a function of evaporator part load ratio.

<div>$$EvapPartLoadFac = f\left( {EvapPLR} \right)$$</div>

One storage discharge capacity modifier curve is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$TESCapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another storage discharge capacity modifier curve is a function of evaporator part load ratio.

<div>$$TESCapPartLoadFac = f\left( {EvapPLR} \right)$$</div>

One storage energy input ratio modifier curve is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$EIRStorTempModFac = {f_{triquadratic}}\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Another storage energy input ratio modifier curve is a function of flow fraction.

<div>$$EIRStorFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

Storage part load degradation curve is a function of storage discharge part load ratio.

<div>$$StorPartLoadFac = f\left( {StorPLR} \right)$$</div>

The results of the performance curves are applied as follows to determine cooling capacity and energy performance:

<div>$${\dot Q_{Evap}} = {\dot Q_{Evap,RatedCoolAndDischarge}}\left( {EvapCapTempModFac} \right)\left( {EvapCapFlowModFac} \right)$$</div>

<div>$${\dot Q_{TES}} =  - {\dot Q_{Discharge,Rated}}\left( {TESCapTempModFac} \right)\left( {TESCapPartLoadFac} \right)$$</div>

<div>$${\dot W_{Evap,elec}} = \frac{{\left( {{{\dot Q}_{Evap}}} \right)\left( {EIREvapTempModFac} \right)\left( {EIREvapFlowModFac} \right)\left( {EvapPLR} \right)}}{{\left( {CO{P_{Rated,Cooling}}} \right)\left( {EvapPartLoadFac} \right)}}$$</div>

<div>$${\dot W_{TES,elec}} = \frac{{\left( {{{\dot Q}_{TES}}} \right)\left( {EIRStorTempModFac} \right)\left( {EIRStorFlowModFac} \right)\left( {StorPLR} \right)}}{{\left( {CO{P_{Rated,Discharging}}} \right)\left( {StorPartLoadFac} \right)}}$$</div>

The sensible heat ratio (SHR) is determined by a rated SHR and two performance curves. There are two options for the SHR temperature modifying factor, it can either be a function of evaporator entering wetbulb and evaporator entering drybulb temperature or it can add a third independent variable for the state of charge of TES.

<div>$$\begin{array}{l}SHRTempModFac = \left\{ \begin{array}{l}f\left( {{T_{evap,wb}},{T_{evap,db}}} \right)\\f\left( {{T_{evap,wb}},{T_{evap,db}},{S_{TES}}} \right)\end{array} \right.\\\end{array}$$</div>

The SHR flow fraction modifying factor is a function of air flow fraction through the evaporator section where air flow fraction is the ratio of current air mass flow rate to the rated air mass flow rate.

<div>$$SHRFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,{\rm{}}air}}} {{{\dot m}_{evap,{\rm{}}airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}airRated}}}$}}} \right)$$</div>

The results of the performance curves are applied as follows to determine SHR:

<div>$$SHR = SH{R_{rated}}*SHRTempModFac*SHRFlowModFac$$</div>



**Charge Only Mode** is when the unit is only charging, there is no heat flow at the evaporator.  There is no modulation or part loading, when charging the unit charges at its nominal design rate (adjusted for conditions).





![](EngineeringReference/media/image4355.png)

Figure 188. Thermal Storage Coil Charge Only Mode



The governing equations for “Charge Only Mode”

<span>$ - M{c_p}\frac{{DT}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>      (water tank)

<span>$ - M{h_{fs}}\frac{{DF}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>    (ice tank)

<div>$$\dot W + {\dot Q_{Cond}} + {\dot Q_{TES}} = 0$$</div>

<div>$${\dot Q_{Amb}} = {\left( {UA} \right)_{Tank}}\left( {{T_{TES}} - {T_{Amb}}} \right)$$</div>

<span>${\dot Q_{Plant}} = \dot m{c_p}\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$</span><div>$${\dot Q_{Plant}} = \dot m\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$$</div>

The input correlations are used in the following manner.



Storage charge capacity modifier factor is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$TESCapTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

Energy input ratio modifier factor is a function of evaporator inlet wetbulb and condenser inlet drybulb temperatures and state of TES.

<div>$$EIRTempModFac = f\left( {{T_{evap,wb}},{T_{cond,db}},{S_{TES}}} \right)$$</div>

<div>$${\dot Q_{TES}} = \left( {{{\dot Q}_{Charge,Rated}}} \right)\left( {TESCapTempModFac} \right)$$</div>

<div>$${\dot W_{elec}} = \left( {{{\dot Q}_{TES}}} \right)\left( {\frac{1}{{CO{P_{Rated,ChargeOnly}}}}} \right)\left( {EIRTempModFac} \right)$$</div>





**Discharge Only Mode** is when the unit is only discharging, there is no heat flow at the condenser. The rate of discharge will modulate to meet part loading at the evaporator.

![](EngineeringReference/media/image4366.png)

Figure 189. Thermal Storage Coil Discharge Only Mode

The governing equations for “Discharge Only Mode”

<span>$ - M{c_p}\frac{{DT}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>      (water tank)

<span>$ - M{h_{fs}}\frac{{DF}}{{Dt}} + {\dot Q_{Amb}} + {\dot Q_{Plant}} + {\dot Q_{TES}} = 0$</span>    (ice tank)

<div>$$\dot W + {\dot Q_{Evap}} + {\dot Q_{TES}} = 0$$</div>

<div>$${\dot Q_{Amb}} = {\left( {UA} \right)_{Tank}}\left( {{T_{TES}} - {T_{Amb}}} \right)$$</div>

<span>${\dot Q_{Plant}} = \dot m{c_p}\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$</span><span>${\dot Q_{Plant}} = \dot m\varepsilon \left( {{T_{TES}} - {T_{w,in}}} \right)$</span>

The input correlations are used in the following manner.



One total evaporator cooling capacity modifier factor is a function of evaporator inlet wetbulb temperature and state of TES.

<div>$$EvapCapTempModFac = f\left( {{T_{evap,wb}},{S_{TES}}} \right)$$</div>

Another total evaporator cooling capacity modifier factor is a function of flow fraction.

<div>$$EvapCapFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

One energy input ratio modifier factor is a function of evaporator inlet wetbulb temperature and state of TES.

<div>$$EIRTempModFac = f\left( {{T_{evap,wb}},{S_{TES}}} \right)$$</div>

Another energy input ratio modifier factor is a function of flow fraction.

<div>$$EIRFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,air}}} {{{\dot m}_{evap,airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,airRated}}}$}}} \right)$$</div>

Part load degradation curve is a function of evaporator part load ratio.

<div>$$EvapPartLoadFac = f\left( {EvapPLR} \right)$$</div>

<span>${\dot Q_{Evap}} = \left( {{{\dot Q}_{Evap,RatedDischargeOnly}}} \right)\left( {EvapCapTempModFac} \right)\left( {EvapCapFlowModFac} \right)$</span>. <span>${\dot W_{elec}} = \frac{{\left( {{{\dot Q}_{evap}}} \right)\left( {EIRStorTempModFac} \right)\left( {EIRStorFlowModFac} \right)\left( {EvapPLR} \right)}}{{\left( {CO{P_{Rated,DischargeOnly}}} \right)\left( {EvapPartLoadFac} \right)}}$</span>

<div>$${\dot Q_{TES}} = {\dot Q_{Evap}} + {\dot W_{elec}}$$</div>

The sensible heat ratio (SHR) is determined by a rated SHR and two performance curves. There are two options for the SHR temperature modifying factor, it can either be a function of evaporator entering wetbulb and evaporator entering drybulb temperature or it can add a third independent variable for the state of charge of TES.

<div>$$\begin{array}{l}SHRTempModFac = \left\{ \begin{array}{l}f\left( {{T_{evap,wb}},{T_{evap,db}}} \right)\\f\left( {{T_{evap,wb}},{T_{evap,db}},{S_{TES}}} \right)\end{array} \right.\\\end{array}$$</div>

The SHR flow fraction modifying factor is a function of air flow fraction through the evaporator section where air flow fraction is the ratio of current air mass flow rate to the rated air mass flow rate.

<div>$$SHRFlowModFac = f\left( {{\raise0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}air}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{evap,{\rm{}}air}}} {{{\dot m}_{evap,{\rm{}}airRated}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{evap,{\rm{}}airRated}}}$}}} \right)$$</div>

The results of the performance curves are applied as follows to determine SHR:

<div>$$SHR = SH{R_{rated}}*SHRTempModFac*SHRFlowModFac$$</div>



HVAC Controllers <a name="Controllers"></a>
----------------

### Control Valve for Water-Based Air System Coils

The input object Controller:WaterCoil provides a simple controller model for adjusting water flow rates to meet the desired air side conditions. It is really a solution inverter. For a water coil the simulation cannot be inverted where the mass flow rate of the water through the coil can be solved directly given an air temperature. Thus, this “controller” will numerically step through all of the water flow possibilities by a root finding technique until the mass flow rate is determined to meet the specified outlet air temperature within a specified user tolerance.

#### Model Description

The figure below illustrates the use of a simple controller used with a central chilled water coil (control variable Temperature). The controller reads the desired temperature setpoint from the control node (established by a SetpointManager) and modulates the chilled water flow rate at the actuator node in order to meet the desired supply (coil outlet) air temperature.

![TemperatureControlledWaterCoil](EngineeringReference/media/image4384.png)

Figure 190. Controller:WaterCoil used with Central Chilled Water Coil

In this case, the controller simply senses the temperature at the control node and compares this value with the desired temperature setpoint. If the sensed temperature is above the desired setpoint temperature, the chilled water flow rate is increased. This controller may be used for both chilled water and hot water coils. The action parameter input is set to REVERSE for chilled water cooling coils and NORMAL for hot water heating coils.

The simple controller may also be used to control both high temperature and high humidity levels by controlling the water flow rate through a chilled water coil. Setting the controller’s control variable to TemperatureAndHumidityRatio enables this feature. In this case, the controller monitors two setpoint values, one for temperature control and the other for high humidity control. Note that two setpoint managers must be used to establish these setpoints as shown in the figure below. The limiting case for either temperature or high humidity control (i.e., the minimum supply air temperature required to meet both setpoints) is used for controlling the water flow rate through the chilled water coil. If high humidity control is the limiting case then colder supply air will be delivered by the cooling coil to achieve proper dehumidification and some form of air reheat may be required to avoid overcooling of the zones being served by this air loop.

![TempHumRatControlledWaterCoil](EngineeringReference/media/image4385.png)

Figure 191. Two Setpoint managers used in Controller:WaterCoil

When the control variable TemperatureAndHumidityRatio is used, the controller modulates water flow through a chilled water coil to meet both a temperature and a humidity ratio setpoint. These two setpoints are placed on the control node by setpoint managers.

The model first calculates the approach temperature using the dry-bulb temperature and dewpoint temperature of the air leaving the water coil:

<div>$${T_{dp}} = {\rm{PsyTdpFnWPb}}\left( {{\omega_{SA}},P} \right)$$</div>

<div>$${T_{approach}} = {T_{SA}} - {T_{dp}}$$</div>

where:

<span>${T_{approach}}$</span>= approach temperature, ˚C

<span>${\omega_{SA}}$</span> = supply (outlet) air humidity ratio, kg/kg

<span>$P$</span>   = outdoor barometric pressure, Pa

<span>${T_{dp}}$</span>  = supply (outlet) air dewpoint temperature, ˚C

<span>${T_{SA}}$</span> = supply (outlet) air dry-bulb temperature, ˚C

<span>${\rm{PsyTdpFnWPb}}$</span>= EnergyPlus psychrometric function, returns dewpoint temperature given humidity ratio and barometric pressure

The supply air dewpoint temperature required to meet the humidity ratio setpoint (placed on the control node by SetpointManager:SingleZone:Humidity:Maximum, SetpointManager:MultiZone:MaximumHumidity:Average  or SetpointManager:MultiZone:Humidity:Maximum) is then calculated as a function of the humidity ratio setpoint and barometric pressure as follows:

<div>$${T_{dp,SP}} = {\rm{PsyTdpFnWPb}}\left( {{\omega_{SP}},P} \right)$$</div>

where:

<span>${T_{dp,SP}}$</span>= dewpoint temperature corresponding to *w<sub>SP</sub>*, ˚C

<span>${\omega_{SP}}$</span>= humidity ratio setpoint, kg/kg

In order for the dewpoint temperature of the coil’s supply (outlet) air to reach <span>${T_{dp,SP}}$</span> the dry-bulb temperature of air leaving the cooling coil must be at <span>${T_{dp,SP}} + {T_{approach}}$</span>:

<div>$${T_{HR,SP}} = {T_{dp,SP}} + {T_{approach}}$$</div>

where:

<span>${T_{HR,SP}}$</span>= supply air dry-bulb temperature setpoint required to achieve the specified humidity ratio setpoint, ˚C

The supply air temperature setpoint required to achieve the specified humidity ratio setpoint is then compared to the setpoint temperature required for zone temperature control, and the minimum of these two setpoint values is used as the setpoint temperature for controlling the chilled water coil.

<div>$${T_{SP}} = MIN\left( {{T_{Temp,SP}},{T_{HR,SP}}} \right)$$</div>

where:

<span>${T_{SP}}$</span>= chilled water coil supply air temperature setpoint, ˚C

<span>${T_{Temp,SP}}$</span>= supply air temperature setpoint required for zone temperature control, ˚C

As described previously, the controller varies the chilled water flow rate through the coil using a root finding technique until the actual supply air temperature reaches *T<sub>sp</sub>*within the specified tolerance:

<div>$${T_{Actual}} - {T_{SP}}\,\, \le \,\,\,Controller\,Convergence\,Tolerance$$</div>

where:

<span>${T_{Actual}}$</span>= actual air temperature leaving the cooling coil, ˚C

### Outdoor Air Damper Controller for Air Systems

When the heat exchanger assisted cooling coil is used with a furnace or unitary system (ref. AirLoopHVAC:Unitary:Furnace:HeatCool or AirLoopHVAC:UnitaryHeatCool) or DX system (ref. CoilSystem:Cooling:DX) located in an air loop (or DX system used in an outside air system), an ecomizier function may be customized as necessary. For economizer control, an outdoor air controller (ref. Controller:OutdoorAir) is used to define the economizer control inputs and determine when economizer mode is active. The heat exchanger (ref. HeatExchanger:\*) object provides an economizer lockout feature which disables heat recovery any time the economizer is active. This feature can be turned on and off using the heat exchanger lockout input. Heat exchanger assisted cooling coils used with the zone equipment described below disregard this economizer control feature. The heat recovery bypass control input may also be used to selectively control heat recovery.

#### Inputs

§ Controller Name

§ Relief air node

§ Return air node

§ Control node (the mixed air node)

§ Actuated node (the outside air inlet node)

§ Minimum outside air flow rate (at design) [m<sup>3</sup>/s]

§ Maximum outside air flow rate  (<span>${\dot V_{oa,\max }}$</span>) [m<sup>3</sup>/s]

§ EconomizerChoice: *FixedDryBulbr* | *FixedEnthalpy* | * DifferentialDryBulb * | * DifferentialEnthalpy* | *  ElectronicEnthalpy* | *  FixedDewPointAndDryBulb   * | *DifferentialDryBulbAndEnthalpy * | *NoEconomizer*

§ Bypasschoice: *MinimumFlowWithBypass* | *ModulateFlow*

§ High temperature limit (<span>${T_{high}}$</span>) [C]

§ High specific enthalpy limit (<span>${h_{high}}$</span> ) [J/kg]

§ High dewpoint temperature limit (<span>${T_{DP,high}}$</span>) [C]

§ Electronic Enthalpy limit (quadratic or cubic curve object)

§ Low temperature limit (<span>${T_{low}}$</span>) [C]

§ Lockout: *LockoutWithHeating* | *LockoutWithCompressor*

§ MinimumLimit: *FixedMinimum* | *ProportionalMinimum*

§ Minimum outside air schedule (schedule values multiply the minimum outside air flow rate)

§ Minimum Outside air flow Schedule(schedule values sets the limit on minimum outside air)

§ Maximum Outside air flow Schedule(schedule values sets the maximum amount of outside air possible in the system)

§ Name of Controller:MechanicalVentilation object

§ Time-of-day economizer control schedule (economizer active when schedule values are greater than 0)

§ High humidity control flag: *Yes* | *No*

§ Humidstat control zone name (zone name where humidistat is located)

§ Control high indoor humidity based on outdoor humidity ratio: *Yes* | *No*

§ High humidity outside air flow ratio (this flow ratio is multiplied by the maximum outside air flow rate during periods of high indoor relative humidity)

§ Heat Recovery Bypass Control Type: BypassWhenWithinEconomizerLimits | BypassWhenOAFlowGreaterThanMinimum

#### Economizer Limits

Economizer limits may be used to create single-point or multi-point controllers. The figure below shows several examples of each type of controller. Single-point economizer controllers use a single independent variable to specify the operation of the economizer. In all cases, the economizer is disabled (OFF) when the outdoor weather condition exceeds the limit. However, when a low temperature limit is used the economizer is disabled when the outdoor temperature is *below* the low dry-bulb temperature limit.

Economizer limits may also be used to create multi-point controllers where two or more limits specify the economizer operating region. The economizer is disabled (OFF) if any single multi-point economizer limit is exceeded.

![EconomizerLimitContrrol](EngineeringReference/media/image4411.png)

Figure 192. Economizer Limit Controls

#### Simulation

The simulation contains 4 steps.

#### Step 1: calculate the minimum outside air flow rate

The user inputs the minimum outside air flow rate (or it is automatically calculated by the program from the user’s design inputs). This is converted to a mass flow rate <span>${\dot m_{oa,\min ,des}}$</span>using the density of dry air at 20 degrees C. If the economizer is on an air loop then the minimum outside air flow fraction is initialized to:

<div>$${f_{oa,\min }} = {\dot m_{oa,\min ,des}}/{\dot m_{s,des}}$$</div>

Where <span>${\dot m_{s,des}}$</span>is the design supply air mass flow rate. If the economizer is not on an air loop the minimum outside air flow fraction is initialized to:

<div>$${f_{oa,\min }} = {\dot m_{oa,\min ,des}}/{\dot m_{oa,\max ,des}}$$</div>

where <span>${\dot m_{oa,\max ,des}}$</span>is the user input maximum outside air volumetric flow rate converted to mass flow rate in the same manner as for the minimum outside air flow rate. If a minimum outside air schedule has been input, <span>${f_{oa,\min }}$</span>is multiplied by the current schedule value.

#### Step 2: calculate an initial outside air signal

We now define an initial outside air signal <span>${S_{oa,init}}$</span>.

If <span>$\left| {{T_{_r}} - {T_{in}}} \right| > \Delta {T_{small}}$</span>then:

<span>${S_{oa,init}} = ({T_r} - {T_{mix,set}})/({T_r} - {T_i})$</span>.

Otherwise:

if <span>${T_r} < {T_{mix,set}}$</span>and <span>${T_r} \ge {T_i}$</span> , <span>${S_{oa,init}}$</span>is set to -1;

if <span>${T_r} < {T_{mix,set}}$</span> and <span>${T_r} < {T_i}$</span>, <span>${S_{oa,init}}$</span>  is set to 1;

if <span>${T_r} \ge {T_{mix,set}}$</span>and <span>${T_r} \ge {T_i}$</span>, <span>${S_{oa,init}}$</span> is set to 1;

if <span>${T_r} \ge {T_{mix,set}}$</span> and <span>${T_r} < {T_i}$</span>, <span>${S_{oa,init}}$</span> is set to -1.

Finally, <span>${S_{oa,init}}$</span>is constrained to be: <span>${f_{oa,\min }} \le {S_{oa,init}} \le 1$</span>. Basically, if the outside air can not accomplish cooling, <span>${S_{oa,init}}$</span> is set to <span>${f_{oa,\min }}$</span>. If it can do cooling, <span>${S_{oa,init}}$</span> is greater than the minimum outside air flow fraction but not greater than1. Here

      *T<sub>r</sub>*  is the return air temperature [C];

*      T<sub>i</sub>* is the outside air inlet temperature [C];

*      T<sub>mix,set</sub>* is the mixed air setpoint [C];

*      <span>$\Delta {T_{small}}$</span>*is a small temperature difference [delta C], equal to .00001.

#### Step 3: do the on/off and limit checks

·        If *EconomizerChoice* = *No Economizer*, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>.

·        If <span>${\dot V_{oa,\max }} < {\dot V_{small}}$</span>, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>; <span>${\dot V_{small}}$</span>is.001 m<sup>3</sup>/s.

·        If the economizer is locked out, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>.

Note: the above three checks also set the *EconomizerOperationFlag* and *HighHumidityControlFlag* to *false* (economizer and high humidity control not operating).

·        If <span>${T_i} > {T_{mix,set}}$</span> , <span>${S_{oa,init}} = 1$</span>.

·        If Differential dry-bulb was input as Economizer choiceand <span>${T_i} > {T_r}$</span>, then <span>${S_{oa,init}} = {f_{oa,\min }}$</span>.

·        If Differential Enthalpy was input as Economizer choiceand <span>${h_i} > {h_r}$</span>, then <span>${S_{oa,init}} = {f_{oa,\min }}$</span>, where *h<sub>i</sub>* and *h<sub>r</sub>* are the outside air inlet and return air enthalpies.

Setpoints are checked after this which include check for Fixed dry-bulb temperature  limit, Enthalpy Limit, Dewpoint Limit and Humidity ratio limit if specified.

·        If Differential Enthalpy was input as Economizer choiceand <span>${h_i} > {h_r}$</span>, then <span>${S_{oa,init}} = {f_{oa,\min }}$</span>, where *h<sub>i</sub>* and *h<sub>r</sub>* are the outside air inlet and return air enthalpies.

Setpoints are checked after this which include check for Fixed dry-bulb temperature limit, Enthalpy Limit, Dewpoint Limit and Humidity ratio limit if specified.

·        If a FixedDryBulb / FixedEnthalpy / FixedDewPointAndDryBulb / ElectronicEnthalpy was input as the economizer choice then the limits are checked as before.

·        Limits are checked as follows

o   If a high temperature limit was input and <span>${T_{oa}} > {T_{high}}$</span>, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>; where *T<sub>oa</sub>* is the outside air temperature.

o   If an enthalpy limit was input and <span>${h_{oa}} > {h_{high}}$</span>, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>; where *h<sub>oa</sub>* is the outside air specific enthalpy.

o   If a dewpoint temperature limit was input and <span>${T_{DP,OA}} > {T_{DP,high}}$</span>, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>; where T<sub>DP,OA</sub> is the outside air dewpoint temperature and T<sub>DP,high</sub> is dewpoint temperature limit.

o   If an electronic enthalpy curve was input and <span>${w_{OA}} > {w_{CurveOutput}}$</span>, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>; where *w*<sub>OA</sub> is the outside air humidity ratio and *w*<sub>CurveOutput</sub> is the curve’s humidity ratio output as a function of outdoor air dry-bulb temperature.

·        Another Economizer choice called DifferentialDryBulbAndEnthalpy checks the outside air temperature against return temperature and outside air enthalpy against return air enthalpy and also checks the setpoints.

·        If a low temperature limit was input and <span>${T_{oa}} < {T_{low}}$</span>, <span>${S_{oa,init}} = {f_{oa,\min }}$</span>.

Note: the above nine cases set the *EconomizerOperationFlag* to *false*       (economizer not operating), otherwise the economizer is active.

·        If high humidity control is specified and the zone humidistat indicates a moisture load (i.e. zone relative humidity greater than the relative humidity setpoint), the *HighHumidityOperationFlag* is set to *true.* If high humidity control is based on the outdoor humidity ratio then the *HighHumidityOperationFlag* is set to *true* only when the outdoor air humidity ratio is less than the humidstat’s zone humidity ratio. A *true* HIghHumidityOperationFlag also enables economizer operation in the heat exchangers as if the economizer flag used here was also set to *true* (Ref. HeatExchanger:\* - field Economizer Lockout).

The economizer schedule is then checked to determine if a “push-button” type economizer control is used. When schedule values are greater than 0, the economizer is active (*EconomizerOperationFlag* = *true)*. This test overrides the economizer limit checks described above in Step 3.

#### Step 4: calculate the final outside air signal

If *S<sub>oa,init</sub>* is greater than <span>${f_{oa,\min }}$</span>and less than 1 and the mixed air mass flow rate is greater than <span>${\dot m_{verysmall}}$</span>(<span>${10^{ - 30}}$</span>) and night venting is not occuring and *HighHumidityOperationFlag* is false then

·        we calculate a final outside air signal *S<sub>oa</sub>* by using the regula falsi method routine *SolveRegulaFalsi* to zero the residual <span>${T_{mix,set}} - {T_{mix}}$</span>by varying the outside air mass flow rate <span>${S_{oa}}\cdot {\dot m_{mix}}$</span>. Mass and energy balance are used to obtain the mixed air humidity ratio and enthalpy from the recirculated air and outside air inlet conditions. The psychrometric function *PsyTdbFnHW* is used to obtain *T<sub>mix</sub>* from the mixed air enthalpy and humidity ratio.

Otherwise

·        <span>${S_{oa}} = {S_{oa,init}}$</span>.

#### Step 5: calculate the outside air flow rate and apply final constraints

·        If *BypassChoice* =*True and HighHumidityOperationFlag = false*, <span>${S_{oa}} = {f_{oa,\min }}$</span>.

1)   If the *HighHumidityOperationFlag* is *true* then

<div>$${S_{oa}} = MAX\left[ {{f_{oa,\min }},OAFlowRati{o_{HighRH}}\left( {{\raise0.7ex\hbox{${{{\dot m}_{oa,\max ,des}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{oa,\max ,des}}} {{{\dot m}_{mix}}}}}\right.}\!\lower0.7ex\hbox{${{{\dot m}_{mix}}}$}}} \right)} \right]$$</div>

·        If night ventilation is occuring, <span>${S_{oa}} = 1$</span>.(Night Ventilation has priority over the above constraints)

·        If the Minimum Outside air flow Schedule and the Maximum outside air flow schedule is available , Out Air signal *S oa*,*init*  is checked against those fractions from the schedule.

      S<sub>oa</sub>  = Maximum( Minimum OA fraction, S<sub>oa</sub>)

      S<sub>oa</sub>    = Minimum(Maximum OA fraction, S<sub>oa</sub>)

Now the outside air flow rate is calculated:

<div>$${m_{oa}} = {S_{oa}}*{m_{mix}}$$</div>

Calculate the outside air mass flow rate:

If EconomizerOperationFlag is true and HighHumidityOperationFlag is false  then

<div>$${\dot m_{oa}} = {S_{oa}}\cdot {\dot m_{oa,\max ,des}}$$</div>

Otherwise

<div>$${\dot m_{oa}} = {S_{oa}}\cdot {\dot m_{mix}}$$</div>

Then the following constraints are applied.

·        <span>${\dot m_{oa}}$</span> must be greater than or equal to the air primary loop total exhaust air mass flow rate (<span>${\dot m_{exhaust}}$</span>).

·        If *MinimumLimit* = *Fixed Minimum*, <span>${\dot m_{oa}}$</span> must be greater than or equal to the minimum outside air mass flow rate.

·        <span>${\dot m_{oa}}$</span> must be <span>$ \le {\dot m_{mix}}$</span>.

·        <span>${\dot m_{oa}}$</span> must be <span>$ \le $</span> the maximum outside air mass flow rate.

If heat recovery bypass control is selected, the type of control determines how heat recovery is simulated. If BypassWhenWithinEconomizerLimits is selected, heat recovery is only active when the EconomizerOperationFlag is false. If BypassWhenOAFlowGreaterThanMinimum is selected *and* the EconomizerOperationFlag is true *and* the outside air mass flow rate is greater than the minimum flow rate, heat recovery is disabled, otherwise heat recovery is active. The heat recovery bypass control option is used to optimize heat recovery in heating mode. Heat recovery is commonly used to reduce the cooling load when outdoor conditions are higher than indoor conditions, however, when outdoor conditions are favorable the heat exchanger can be turned off and the economizer may be used to also reduce the cooling load. Economizer mode is typically involves increasing the outdoor air flow rate. At some point the outdoor air flow rate must be reduced and the heat exchanger should be turned back on to reduce or avoid an indoor heating requirement. This option will typically be used with some form of supply air temperature control used with the heat recovery equipment (Ref. HeatExchanger).

#### Step 6: set the relief air mass flow rate

<div>$${\dot m_{relief}} = \max (0,{\dot m_{oa}} - {\dot m_{exhaust}})$$</div>



### Outdoor Air Damper Controller for Zone Energy Recovery Ventilator

The stand alone energy recovery ventilator (ERV) controller is used solely in conjunction with a stand alone energy recovery ventilator (see figure below).

![Schematic\_StandAloneERV](EngineeringReference/media/image4482.png)

Figure 193. Schematic of the ZoneHVAC:EnergyRecoveryVentilator Compound Object

This controller object mimics virtually all of the control logic available for a conventional air-side economizer as embodied in the object Controller:OutdoorAir. However, this controller is only used with the stand alone energy recovery ventilator object (dedicated to serving a single zone, without a traditional air distribution system) while the Controller:OutdoorAir is used with systems that utilize an air loop to provide conditioned air to one or more zones. The purpose of this controller is to signal the object HeatExchanger:AirToAir:SensibleAndLatent that favorable conditions are available for free cooling and heat exchange should be suspended (i.e., air flow is fully bypassed around a fixed-plate heat exchanger or the rotation of a rotary heat exchanger is stopped). A time-of-day schedule may also be used to simulate a “push-button” type economizer. The air flow rate through the stand alone ERV remains the same regardless of whether the controller is signaling for economizer (free cooling) operation or not. In this way, this controller is very similar to Controller:OutdoorAir with the field Economizer Control Action Type set to “MinimumFlowWithBypass”. However, the supply and exhaust air flow rates may be modified in response to a high indoor humidity condition (i.e., when the zone relative humidity is “predicted” to exceed the setpoint, at times the actual zone relative humidity may be slightly below the setpoint. Ref. Zone/Sys Moisture Load Rate Predicted.) and works in a similar fashion to the outside air controller where the air flow rates are adjusted based on a user specified air flow *ratio*.

#### Controller Logic

In many ways, the logic for this controller follows that established for the object Controller:OutdoorAir. Nearly the same computations (source code) are used for this controller as for Controller:OutdoorAir, except the addition of a few calculations that are unique for this stand alone ERV controller. Refer to the *Simulation* discussion for the outdoor air controller to review the calculation procedure. In some instances local variables used in the Controller:OutdoorAir computations are set to specific values for ZoneHVAC:EnergyRecoveryVentilator:Controller to allow the same computations and logic to be used for both controllers. The logic that is being applied for ZoneHVAC:EnergyRecoveryVentilator:Controller is presented below.

As explained above the controller senses when air conditions are such that heat exchange by the air-to-air heat exchanger should be suspended to provide free cooling to the zone, thereby reducing the amount of mechanical cooling that needs to be provided by other equipment. The inputs for this controller specify temperature and/or enthalpy conditions that are used to trigger economizer operation. An economizer lockout input is provided in the heat exchanger object and is used for customizing heat exchanger performance during economizer operation. Heat exchange is suspended only if the heat exchanger’s economizer lockout input is set to Yes.

The user can enter a high and low temperature limit for economizer operation. When the supply inlet (outdoor) air is between these two values, heat exchange is suspended while air flow rates remain unchanged. This logic represents a conventional single-point temperature economizer control. If the user wishes to model differential temperature control, EXHAUST AIR TEMP LIMIT should be specified in the proper input field. In this case, heat exchange is suspended whenever the temperature of the exhaust air is greater than the temperature of the outdoor air. The user still needs to set the low temperature limit to restart the heat exchange process when the outdoor temperature falls too low.

A high dewpoint temperature limit may also be specified. When the supply inlet (outdoor) air is below this limit, heat exchange is suspended while air flow rates remains unchanged. The user still needs to set the low temperature limit to restart the heat exchange process when the outdoor temperature falls too low.

Similar logic can be used with air enthalpy. The user can enter a high enthalpy limit, and heat exchange between the supply and exhaust air streams will be suspended when the outdoor air enthalpy falls below this value. This logic represents single-point enthalpy economizer control. If the user wishes to model differential enthalpy control, EXHAUST AIR ENTHALPY LIMIT should be specified in the proper input field. Regardless of modeling single-point enthalpy or differential enthalpy control, the user still needs to set the low temperature limit to restart the heat exchange process when the outdoor temperature falls too low.

The user may also specify an electronic enthalpy curve object to represent a variable enthalpy controller. A quadratic or cubic curve is used in this case. The output of this curve would represent the maximum outdoor humidity ratio allowed as a function of outdoor dry-bulb temperature.

The air flow rates through the stand alone ERV may also be modified based on a high indoor relative humidity condition. The change in air flow rates may occur at any time the indoor relative humidity is high or when the indoor relative humidity is high *and* the outdoor humidity ratio is lower than the indoor humidity ratio. This control mode modifies the air flow rates according to the user specified high humidity outside air flow ratio. When high humidity control is active, heat exchange is suspended in the same manner as if an economizer were used and, as with economizer operation, heat exchange is suspended only if the heat exchanger’s economizer lockout input is set to Yes.

The model is flexible, and checks all limits established by the user in the object’s input data. The model initially assumes that heat exchange should be suspended, and then checks each one of the limits that the user has set (single-point temperature, differential temperature, single-point enthalpy and differential point enthalpy, single-point dewpoint or electronic (variable) enthalpy). If any of the limits entered by the user is exceeded, then economizer operation is terminated and heat exchange between the supply and exhaust air streams is modeled.

Baseboard Heaters <a name="Baseboards"></a>
-----------------

### Hot Water Baseboard Heater with Only Convection

#### Overview

The convective water baseboard heater (Ref. ZoneHVAC:Baseboard:Convective:Water) is a simple model for establishing a convective-only heat addition to a space through a baseboard heater.  In most situations, the baseboard heater does give a significant amount of heat off via natural convection, but some heat is given off via radiation.  In this model, the radiant component is ignored and all heat is assumed to be delivered to the space via convection.  The baseboard heater is supplied with hot water from the primary system which is circulated through the inside of a finned tube within the space.  Heat is transferred from the water inside the pipe, through the tube and fins, and eventually convected to the surrounding air within the space.  EnergyPlus then assumes that this heat is evenly spread throughout the space thus having an immediate impact on the zone air heat balance which is used to calculate the mean air temperature (MAT) within the space.

The model requests an effective UA value to handle the heat exchange between the water loop and the zone air.  From there, it employs an effectiveness-NTU heat exchanger model to determine the heat transfer between the water and the zone air.  This is necessary because during the simulation only the inlet water and “inlet air” (assumed to be zone air) is known.  As a result, the effectiveness-NTU heat exchanger methodology is better suited to determine the performance of the system.

#### Model Description

#### Convective Water Baseboard Heater Inputs

Like many other HVAC components, the convective-only water baseboard model requires a unique identifying name, an availability schedule, and water side inlet and outlet nodes.  These define the availability of the unit for providing condition to the space and the node connections that relate to the primary system.  In addition, a convergence tolerance is requested of the user to help define the ability of the local controls to tightly control the system output.  In almost all cases, the user should simply accept the default value for the convergence tolerance unless engaged in an expert study of controls logic in EnergyPlus.

The input also requires a UA value and a maximum design flow rate for the unit.  Both of these parameters can be chosen to be auto-sized by EnergyPlus.  The UA value corresponds to the convective heat transfer from the water to the tube, the conduction through the tube and fin material, and the natural convection from the tube/fins to the zone air.  The maximum flow rate and UA value define the performance and maximum output of the baseboard unit.

#### Simulation and Control

The simulation of the convective water baseboard unit follows standard effectiveness-NTU methodology.  It begins by calculating the product of the specific heat and mass flow rate for both the air and water sides of the unit (heat exchanger).  In the initialization of the model, it is assumed that the air mass flow rate is equal to 2.0 times the water mass flow rate.  The purpose of this calculation is to provide some reasonable estimate of the air mass flow rate so that the model can calculate system performance correctly.  This calculation is kept constant throughout the rest of the simulation.

Each system time step, the baseboard attempts to meet any remaining heating requirement of the zone through the following calculations:

<div>$${C_{water}} = {c_{p,water}}{\dot m_{water}}$$</div>

<div>$${C_{air}} = {c_{p,air}}{\dot m_{air}}$$</div>

<div>$${C_{\max }} = MAX\left( {{C_{air}},{C_{water}}} \right)$$</div>

<div>$${C_{\min }} = MIN\left( {{C_{air}},{C_{water}}} \right)$$</div>

<div>$${C_{ratio}} = {{{C_{\min }}} \mathord{\left/ {\vphantom {{{C_{\min }}} {{C_{\max }}}}} \right. } {{C_{\max }}}}$$</div>

<div>$$\varepsilon  = 1 - {e^{\left( {\frac{{NT{U^{0.22}}}}{{{C_{ratio}}}}{e^{\left( { - {C_{ratio}}NT{U^{0.78}}} \right)}} - 1} \right)}}$$</div>

Once the effectiveness is determined, the outlet conditions for and output from the unit are determined using the following equations:

<div>$${T_{air,outlet}} = {T_{air,inlet}} + \varepsilon {{\left( {{T_{water,inlet}} - {T_{air,inlet}}} \right){C_{\min }}} \mathord{\left/ {\vphantom {{\left( {{T_{water,inlet}} - {T_{air,inlet}}} \right){C_{\min }}} {{C_{air}}}}} \right. } {{C_{air}}}}$$</div>

<div>$${T_{water,outlet}} = {T_{water,inlet}} - \left( {{T_{air,outlet}} - {T_{air,inlet}}} \right){{{C_{air}}} \mathord{\left/ {\vphantom {{{C_{air}}} {{C_{water}}}}} \right. } {{C_{water}}}}$$</div>

<div>$$Output\left( {Convective} \right) = {C_{water}}\left( {{T_{water,inlet}} - {T_{water,outlet}}} \right)$$</div>

If the unit was scheduled off or there is no water flow rate through the baseboard unit, then there will be no convection from the unit.  The model assumes no heat storage in the baseboard unit itself and thus no residual heat transfer in future system time steps due to heat storage in the water or metal of the baseboard unit.

#### References

The effectiveness-NTU method is taken from Incropera and DeWitt, Fundamentals of Heat and Mass Transfer, Chapter 11.4, p. 523, eq. 11.33.  The user can always refer to the ASHRAE Handbook series for general information on different system types as needed.

### Electric Baseboard Heater with Only Convection

#### Overview

The input object ZoneHVAC:Baseboard:Convective:Electric provides a model for electric baseboard heaters that assumes only convective heat addition to a space from a baseboard heater.  In most situations, the baseboard heater does give a significant amount of heat off via natural convection, but some heat is given off via radiation.  In this model, the radiant component is ignored and all heat is assumed to be delivered to the space via convection.  The baseboard heater is transferred to the unit via electric resistance heating.  EnergyPlus then assumes that this heat is evenly spread throughout the space thus having an immediate impact on the zone air heat balance which is used to calculate the mean air temperature (MAT) within the space.

#### Model Description

#### Convective Electric Baseboard Heater Inputs

Like many other HVAC components, the convective-only electric baseboard model requires a unique identifying name and an availability schedule.  The availability schedule defines the availability of the unit for providing condition to the space.

The input also requires a capacity and efficiency for the unit.  While the efficiency is a required input that defaults to unity, the capacity can be chosen to be auto-sized by EnergyPlus.

#### Simulation and Control

When the unit is available and there is a heating load within a space, the electric baseboard unit will meet the entire remaining provided that it has enough capacity to do so.  The energy consumption of the baseboard heat is calculated using the user-supplied efficiency and the current load on the baseboard unit as follows:

<div>$$Energ{y_{electric}} = {{Heatin{g_{baseboard}}} \mathord{\left/ {\vphantom {{Heatin{g_{baseboard}}} {Efficiency}}} \right. } {Efficiency}}$$</div>

If the unit was scheduled off or there is no heating load for the zone, then there will be no convection from the unit.  The model assumes no heat storage in the baseboard unit itself and thus no residual heat transfer in future system time steps due to heat storage in the metal of the baseboard unit.

#### References

No specific reference.  Refer to the ASHRAE Handbook series for general information on different system types as needed.

### Hot Water Baseboard Heater with Radiation and Convection

#### Overview

The water baseboard heater model is intended to calculate the mass flow rate of the water by determining the actual system impact not only to the surrounding air via convection but also to the surfaces and people via radiation. The actual system impact by the heater in the zone is the sum of the additional convective heat transfer from the surfaces to the zone air after they have been heated as well as radiant heat transferred to people and the convective heat transfer to the zone. This actual convective power tries to meet any remaining heating requirement in the zone. The model thus improves the accuracy of thermal comfort predictions and system responses.

The radiant components are calculated to interact with the surfaces in the zone through the radiant distribution fractions. Heat is also delivered to the space via convection. The baseboard heater is supplied with hot water from the primary system which is circulated through the inside of a finned tube within the space. This could also be used to model a hot water radiator (convector in the UK). Heat is transferred from the water inside the pipe, through the tube and fins. It is also not only convected to the surrounding air but also radiated to the surfaces within the space. The user is allowed to specify the percentage of radiant heat from the heater to the surfaces. In addition, the user is allowed the ability to define what fraction of radiation leaving the heater is incident directly on a person within the zone for thermal comfort purposes. This amount of heat is then used in the thermal comfort models as the high temperature radiant heater model.

This model calculates the UA values using the log mean temperature difference (LMTD) method. The calculation is based on standard conditions of both fluids obtained in a rating document or manufacturer’s literature. Overall energy balances to the hot water and air handle the heat exchange between the water loop and the zone air. Once the UA for the baseboard heater has been determined, the model employs an effectiveness-NTU heat exchanger method to determine the heat transfer between the water and zone air. This is necessary because during the simulation only the inlet water and “inlet air” (assumed to be zone air) temperatures are known. As a result, the effectiveness-NTU heat exchanger methodology is suited to determine the performance of the system during the simulation.

#### Model Description

#### Water Baseboard Heater Inputs

Like many other HVAC components, the water baseboard model requires a unique identifying name, an available schedule, and water inlet and outlet nodes. These define the availability of the unit for providing conditions to the space and the node connections that relate to the primary system. For the calculation of the UA value of the unit, standard conditions of both fluids are necessary. The user can specifies such standard conditions from manufacturers’ information such as I=B=R rating document. The user provides the rated capacity, average water temperature, water mass flow rate, and standard inlet air temperature. However, the model also has the ability to autosize the rated capacity, which allows the user simulate and design any baseboard units when manufacturer’s data is unavailable.

The UA value corresponds to the convective heat transfer from the water to the tube, the conduction through the tube and fin material, the natural convection from the tube/fins to the zone air, and radiation to the surfaces. In addition, a convergence tolerance is requested of the user to help define the ability of the local controls to tightly control the system output. In almost all cases, the user should simply accept the default value for the convergence tolerance unless engaged in an expert study of controls logic in EnergyPlus.

Many of the inputs for the radiant heat calculation are the same as the high temperature radiant heater model. User inputs of the fraction radiant and of the fraction of radiant energy incident both on people and on surfaces are required to calculate radiant energy distribution from the heater to the people and surfaces. The sum of radiant energy of these distribution fractions must sum to unity, and each water baseboard heater is allowed to distribute energy to up to 20 surfaces.

#### Simulation and Control

The simulation of the main algorithm of this water baseboard model with radiation and convection is similar to the convection-only baseboard model. However, this model determines the UA value of the unit based on rated heating capacities available in the manufacturer’s literature. Almost all baseboards or radiators are rated under standard conditions such as water flow rate, inlet air temperature and average water temperature. Those standard conditions should thus be obtained from manufacturers’ information. The model then determines the UA value of the unit, employing the log mean temperature difference (LMTD) method so that the heating output from the heater can be determined more correctly than other models.

This model initializes all the conditions at the inlet node such as mass flow rates, temperatures, and specific heat capacities. It calculates the UA value once from standard conditions of the air and water during initialization and it is kept throughout the simulation of the unit.

In case that the user has manufacturer’s information regarding the rated capacity, the rated water flow rate, and the rated average water temperature, standard conditions such as the rated heating capacity, *q<sub>std</sub>*, average water temperature, <span>${T_{w,avg}}$</span>, and water mass flow rate, <span>$\dot m{}_w$</span>, are known from the user inputs. The standard water inlet temperature, <span>${T_{w,in}}$</span>, and outlet temperature, <span>${T_{w,out}}$</span>, are thus obtained from expressions

<div>$${T_{w,in}} = \frac{{{q_{std}}}}{{2\dot m{}_w{c_{p,w}}}} + {T_{w,avg}}$$</div>

<div>$${T_{w,out}} = 2{T_{w,avg}} - {T_{w,in}}$$</div>

where <span>${c_{p,w}}$</span> is the specific heat capacity of the water.

The model then assumes the air mass flow rate is twice the rated water mass flow rate. Since the inlet air temperature, <span>${T_{a,in}}$</span>, of 18°C and the heating capacity of the unit, i.e. rated capacity, are known, the outlet air temperature, <span>${T_{a,out}}$</span>, can be obtained from expression

<div>$${T_{a,out}} = \frac{{{q_{std}}}}{{2\dot m{}_w{c_{p,a}}}} + {T_{a,in}}$$</div>

where <span>${c_{p,a}}$</span> is the specific heat capacity of the air.

All temperatures at each node are now known. The mean temperature difference, <span>$\Delta {T_{lm}}$</span>, is thus obtained from the following expressions:

<div>$$\Delta {T_1} = {T_{w,in}} - {T_{a,out}}$$</div>

<div>$$\Delta {T_2} = {T_{w,out}} - {T_{a,in}}$$</div>

<div>$$\Delta {T_{lm}} = \frac{{\Delta {T_1} - \Delta {T_2}}}{{\log \left( {\frac{{\Delta {T_1}}}{{\Delta {T_2}}}} \right)}}$$</div>

The UA value of the unit is thus

<div>$$UA = \frac{{{q_{std}}}}{{\Delta {T_{lm}}}}$$</div>

The model allows the user requests to autosize the rated capacity when the user does not know a particular baseboard unit. It also has the ability to perform parametric study to design the unit based on the design heating load in the zone. The user is also able to modify both rated average water temperature and rated water mass flow rate when manufactures’ information is available while the model assumes the default values for both fields if unavailable.

In case that the user requests autosizing the rated capacity, the model employs the design heating load and design water mass flow rate in the zone, so that the standard water inlet and outlet temperatures are estimated as

<div>$${T_{w,in}} = \frac{{{q_{design}}}}{{2\dot m{}_{w,design}{c_{p,w}}}} + {T_{w,avg}}$$</div>

<div>$${T_{w,out}} = 2{T_{w,avg}} - {T_{w,in}}$$</div>

where <span>${q_{design}}$</span> is the design heating load estimated by EnergyPlus in the zone.

Similarly, the model estimates the air outlet temperature assuming the air mass flow rate is twice the rated water mass flow rate as

<div>$${T_{a,out}} = \frac{{{q_{design}}}}{{2\dot m{}_w{c_{p,a}}}} + {T_{a,in}}$$</div>

Temperatures at the nodes are now known and the UA value is determined in the same fashion as the previous case.

Once the UA value is determined, the model employs an effectiveness-NTU heat exchanger method to determine the heat transfer between the water and the zone air as convection-only model does (see “Hot Water Baseboard Heater with Only Convection” model). Note that the model also assumes that the air mass flow rate is twice the water mass flow rate in the main heat exchanger algorithm.

The model then determines the radiant heat addition by

<div>$${q_{rad}} = q \cdot Fra{c_{rad}}$$</div>

where *q* is the total heating capacity of the heater and *Frac<sub>rad</sub>* is the user-defined fraction.

The model now distributes the radiant heat additions to the appropriate surfaces, people for thermal comfort purpose, and the air in the zone. The surface heat balances are then recalculated to determine all heat sources or sinks for radiant systems in the zone. It is assumed that the radiant heat incident on people in the zone is converted to convection to the zone so that the zone heat balance includes this amount of heat which will be lost (see High Temperature Radiant Heater Model). The load met, the actual convective system impact, for the baseboard heater, *q<sub>req</sub>*, is therefore determined as

<div>$${q_{req}} = ({q_{surf,c}} - {q_{surf,z}}) + {q_{conv}} + {q_{people}}$$</div>

where *q<sub>surf,c</sub>*  is convection from the surfaces to the air in the zone with radiant systems; *q<sub>surf,z</sub>* is zero source convection from the surfaces when radiant systems are unavailable; *q<sub>conv</sub>* is the convective heat transfer from the heater to the zone air; and *q<sub>people</sub>* is radiant heat to the people.

The radiant heat simulation in the water baseboard heater is very similar to the high temperature radiant system model. The controls are the same as shown in Figure 271.  Variable Flow Low Temperature Radiant System Controls.  After all system time steps have been simulated, an “average” zone heat balance calculation is done (similar to the radiant systems). If the unit was scheduled off or there is no water flow rate through the baseboard unit, then, there will be no heat transfer from the unit. The model assumes no heat storage in the unit itself and thus no residual heat transfer in future system time steps due to heat storage in the water or metal of the unit.

#### References

I=B=R Ratings for Boilers. 2009. Baseboard Radiation, Finned Tube (Commercial) Radiation, and Indirect Fired Water Heaters, January 2009 Edition

Incropera and DeWitt. Fundamentals of Heat and Mass Transfer, Chapter 11.3 and 11.4, eq. 11.15, 11.17, and 11.33.

Li Lianzhong and M. Zaheeruddin. 2006. Dynamic modeling and simulation of a room with hot water baseboard heater, International Journal of Energy Research; 30, pp. 427–445

Electric Baseboard Heater with Radiation and Convection
-------------------------------------------------------

### Overview

The input object ZoneHVAC:Baseboard:RadiantConvective:Electric provides a model for electric baseboard heaters that include both convective and radiant heat addition to a space from a baseboard heater. The radiant heat transfer to people as well as surfaces within a space is determined in the same fashion as both hot water and steam baseboard heater with radiation and convection models. The electric baseboard heater transfers energy via electric resistance heating. Radiant heat calculated by the user-defined fraction from the heating capacity of a baseboard unit impacts the surface heat balances and thermal comfort of occupants in a space. EnergyPlus then assumes that the remaining convective gains from the unit are evenly spread throughout the space thus having an immediate impact on the zone air heat balance which is used to calculate the mean air temperature (MAT) within the space.

### Model Description

#### Convective Electric Baseboard Heater Inputs

Like many other HVAC components, the electric baseboard model requires a unique identifying name and an availability schedule. The availability schedule defines the availability of the unit for providing condition to the space. The input also requires a capacity and efficiency for the unit. While the efficiency is a required input that defaults to unity, the capacity can be chosen to be autosized by EnergyPlus.

All inputs for the radiant heat calculation are the same as the water and steam baseboard heater with radiation and convection models in EnergyPlus. Users are required to input fractions that specify total radiant heat directly delivered to surfaces as well as people in a space. The sum of radiant energy of these distribution fractions must sum to unity, and each baseboard heater is allowed to distribute energy to up to 20 surfaces.

#### Simulation and Control

When the unit is available and there is a heating load within a space, the electric baseboard unit will meet the entire remaining provided that it has enough capacity to do so. The model sets the heating capacity of a baseboard unit to the remaining heating load in the space, which any primary heating system does not meet. Note that it is set to the maximum nominal capacity of the unit, if a heating load in a space is greater than the maximum. The model then determines the radiant heat source through the simulation as

<div>$${q_{rad}} = q \cdot Fra{c_{rad}}$$</div>

where *q<sub>rad</sub>* is the total radiant heating capacity, *q* is the heating capacity of the unit, and *Frac<sub>rad</sub>* is the user-defined fraction for the radiation. The radiant heat additions to people and surfaces are thus

<div>$${q_{people}} = {q_{rad}} \cdot Fra{c_{people}}$$</div>

<div>$${q_{surface}} = \sum {{q_{rad}} \cdot Fra{c_{surface,i}}} $$</div>

where *q<sub>people</sub>* is the radiant heat transfer to people, *q<sub>surface</sub>* is the heat radiated to surfaces, *Frac<sub>people</sub>* is the fraction of the heat radiated to people, and *Frac<sub>surface,i</sub>* is the fraction of the heat radiated to surface i.

Once the radiant heat sources are determined, the model distributes the radiant heat sources to the appropriate surfaces and people for thermal comfort purposes, and EnergyPlus recalculates the surface heat balances. The model then determines differences in convection from the surfaces to the air before and after the surface heat balances are impacted due to radiant heat additions from the unit. Note that the model converts the radiant heat transfer to people to convective energy so that the heat balance includes this amount of energy, which will be lost (see High Temperature Radiant Heater Model). The model calculates the actual convective system impact of an electric baseboard heater unit as

<div>$${q_{req}} = ({q_{surf,c}} - {q_{surf,z}}) + {q_{conv}} + {q_{people}}$$</div>

where *q<sub>req</sub>* is the actual heating load that the unit should meet, *q<sub>surf,c</sub>* is the convection from the surfaces to the air after the radiant heat distribution, *q<sub>surf,z</sub>* is the convection from the surfaces to the air before the radiant heat distribution, and *q<sub>conv</sub>* is the convective heat transfer to the air.

The energy consumption of the baseboard heater is calculated using the user-supplied efficiency and the actual convective system impact calculated as

<div>$${Q_{elec}} = \frac{q}{\eta }$$</div>

where *Q<sub>elec</sub>* is the energy consumption and ***η*** is the efficiency of the unit.

If the unit was scheduled off or there is no heating load for the zone, then there will be no heat transfer from the unit. The model assumes no heat storage in the baseboard unit itself and thus no residual heat transfer in future system time steps due to heat storage in the metal of the baseboard unit.

#### References

No specific reference. Refer to the ASHRAE Handbook series for general information on different system types as needed.

### Steam Baseboard Heater with Radiation and Convection

#### Overview

The steam baseboard heater model is intended to calculate the mass flow rate of the steam to meet remaining heating demand by determining the actual system impact not only to the surrounding air via convection but also to the surfaces and people via radiation. The actual system impact by the heater is the sum of the additional convective heat transfer from the surfaces to the zone air after they have been heated as well as radiant heat transferred to people and the convective heat transfer to the zone. This actual convective power tries to meet any remaining heating requirement in the zone. The model thus improves the accuracy of thermal comfort predictions and system responses. The calculation of radiant heat addition is the same as that of water baseboard heater model in EnergyPlus.

This model determines the heating capacity from the sum of the latent heat transfer and sensible cooling of water as current steam coil model in EnergyPlus does. Overall energy balances to the steam and air handle the heat exchange between the steam loop and the zone air. The mass flow rate of steam is determined based on the heating demand in the zone. The model requests the user input the desired degree of subcooling so that it determines the heating rate from the heater due to the cooling of the condensate. The user input is also used to determine the condensate outlet conditions.

#### Model Description

#### Steam Baseboard Heater Inputs

The steam baseboard model requires a unique identifying name, an available schedule, and steam inlet and outlet nodes. These define the availability of the unit for providing conditions to the space and the node connections that relate to the primary system. It also requires the desired degree of subcooling to calculate the heating capacity and temperature of the condensate. A maximum design flow rate is required, and the user can request this parameter to be auto-sized by EnergyPlus. In addition, a convergence tolerance is requested of the user to help define the ability of the local controls to tightly control the system output. In almost all cases, the user should simply accept the default value for the convergence tolerance unless engaged in an expert study of controls logic in EnergyPlus.

All of the inputs for the radiant heat calculation are the same as the water baseboard heater model in EnergyPlus. User inputs of the radiant fraction and of the fraction of radiant energy incident both on people and on surfaces are required to calculate radiant energy distribution from the heater to the people and surfaces. The sum of radiant energy of these distribution fractions must sum to unity, and each steam baseboard heater is allowed to distribute energy to up to 20 surfaces.

#### Simulation and Control

The simulation of the main algorithm of this steam baseboard model with radiation and convection is similar to steam coil model in EnergyPlus while the simulation of radiant component is the same as the water baseboard models. This model initializes all conditions at the inlet node such as mass flow rate, temperature, enthalpy, and humidity ratio. The model then determines the heating capacity of steam baseboard, *q*, as

<div>$$q = {\dot m_5}({h_{fg}} + {c_{pw}}\Delta t)$$</div>

where <span>${\dot m_s}$</span>is the mass flow rate of steam in kg/s, <span>${h_{fg}}$</span>is the heat of vaporization of steam in J/kg, <span>${c_{pw}}$</span>is the specific heat of water in J/kg.K, and <span>$\Delta t$</span> is the degree of subcooling in degree C.

The outlet steam temperature is thus

<div>$${T_{s,out}} = {T_{s,in}} - \Delta t$$</div>

Once the heating capacity of the unit is determined, the model determines the radiant heat addition by

<div>$${q_{rad}} = q \cdot Fra{c_{rad}}$$</div>

where *q* is the total heating capacity of the heater and *Frac<sub>rad</sub>* is the user-defined fraction.

The model now distributes the radiant heat additions to the appropriate surfaces, people for thermal comfort purpose, and the air in the zone. The surface heat balances are then recalculated to determine all heat sources or sinks for radiant systems in the zone. It is assumed that the radiant heat incident on people in the zone is converted to convection to the zone so that the zone heat balance includes this amount of heat which will be lost (see High Temperature Radiant Heater Model). The load met, the actual convective system impact, for the baseboard heater, *q<sub>req</sub>*, is therefore determined as

<div>$${q_{req}} = ({q_{surf,c}} - {q_{surf,z}}) + {q_{conv}} + {q_{people}}$$</div>

where *q<sub>surf,c </sub>* is convection from the surfaces to the air in the zone with radiant systems; *q<sub>surf,z</sub>* is zero source convection from the surfaces when radiant systems are unavailable; *q<sub>conv</sub>* is the convective heat transfer from the heater to the zone air; and *q<sub>people</sub>* is radiant heat to the people.

The simulation of radiant heat addition is the same as the water baseboard heater model. The controls are the same as shown in Figure 271.  Variable Flow Low Temperature Radiant System Controls. After all system time steps have been simulated, an “average” zone heat balance calculation is done (similar to the high temperature radiant system). If the unit was scheduled off or there is no steam flow rate through the baseboard unit, then, there will be no heat transfer from the unit. The model assumes no heat storage in the unit itself and thus no residual heat transfer in future system time steps due to heat storage in the steam or metal of the unit.

#### References

No specific reference.  Refer to the ASHRAE Handbook series for general information on different system types as needed.


Cooling Towers and Evaporative Fluid Coolers <a name="TowersAndCoolers"></a>
--------------------------------------------

### One, Two, and Variable Speed Cooling Towers and Evaporative Fluid Coolers

#### Overview

The input objects CoolingTower:SingleSpeed, CoolingTower:TwoSpeed, and CoolingTower:VariableSpeed:Merkel provide models for single-speed, two-speed, and variable-speed cooling towers that are based on Merkel’s theory (Merkel 1925), which is also the basis for the tower model included in ASHRAE’s HVAC1 Toolkit for primary HVAC system energy calculations (ASHRAE 1999, Bourdouxhe et al. 1994). Cooling tower performance is modeled using effectiveness-NTU relationships for counterflow heat exchangers. The model can be used to simulate the performance of both single speed, two speed, and variable speed mechanical-draft cooling towers. The model will also account for tower performance in the “free convection” regime, when the tower fan is off but the water pump remains on. For part-load operation, the model assumes a simple linear interpolation between two steady-state regimes without accounting for any cycling losses.

For single speed cooling towers, the capacity control can be fan cycling or fluid bypass. In fluid bypass mode, portion of the water goes through the tower media and gets cooled while the remaining water flow gets bypassed, two water flows then mix together trying to meet the tower exiting water setpoint temperature. In both the free convection cooling when fan is off and normal cooling when fan is on for the entire time step, if the tower exiting water temperature is lower than the setpoint, the tower operates in fluid bypass mode. The model determines the fluid bypass fraction by iterations until the mixed water meets the tower exiting water temperature setpoint. In the fluid bypass mode, except the free convection, the tower fan runs at full speed for the entire time step. The maximum amount of tower water that can be bypassed is bounded by the freezing point of the tower water – the tower exiting water temperature cannot be lower than the freezing setpoint.

Evaporative fluid coolers are modeled very similar to cooling towers. The main difference between the two is in the “Performance input method” input field. Cooling tower has two choices for this field namely “UFactorTimesAreaAndDesignWaterFlowRate” and “Nominal capacity”. The nominal capacity is specified for the standard conditions i.e. entering water at 35C (95F), leaving water at 29.44C (85F), entering air at 25.56C (78F) wet-bulb temperature and 35C (95F) dry-bulb temperature. On the other hand evaporative fluid cooler has three choices for “Performance input method” which are “UFactorTimesAreaAndDesignWaterFlowRate”, “StandardDesignCapacity” and “UserSpecifiedDesignCapacity”. First method is same for both tower and fluid cooler. Standard design capacity is specified for the same conditions which are used to specify nominal capacity for tower as described above. If the capacity of fluid cooler for conditions other than the standard ones is known then UserSpecifiedDesignCapacity method should be used. In this case, the conditions for which the fluid cooler capacity is known i.e. entering water temperature, entering air temperature and entering air wet bulb temperature must be specified in the input. To calculate evaporation loss for fluid cooler, spray water flow rate which is different than the process fluid flow rate must be specified for all the performance input methods. This is not required for cooling tower because cooled fluid i.e. water is in direct contact with the air so the water loss is calculated by using cooled fluid flow rate only. Unlike cooling tower, evaporative fluid cooler model does not account for free convection.

Cooling tower model is described below which holds equally good for evaporative fluid cooler. The differences are mentioned whenever required.

#### Model Description

Based on Merkel’s theory, the steady-state total heat transfer between the air and water entering the tower can be defined by the following equation:

<div>$$d{\dot Q_{total}} = \frac{{UdA}}{{cp}}\left( {{h_s} - {h_a}} \right)$$</div>

where

*h<sub>s</sub>* = enthalpy of saturated air at the wetted-surface temperature, J/kg

*h<sub>a</sub>* = enthalpy of air in the free stream, J/kg

*c<sub>p</sub>* = specific heat of moist air, J/kg-<sup>o</sup>C

*U* = cooling tower overall heat transfer coefficient, W/m<sup>2</sup>- <sup>o</sup>C

*A* = heat transfer surface area, m<sup>2</sup>

Equation is based on several assumptions:

n air and water vapor behave as ideal gases

n the effect of water evaporation is neglected

n fan heat is neglected

n the interfacial air film is assumed to be saturated

n the Lewis number is equal to 1

In this model, it is also assumed that the moist air enthalpy is solely a function of the wet-bulb temperature and that the moist air can be treated as an equivalent ideal gas with its mean specific heat defined by the following equation:

<div>$$\bar cpe = \frac{{\Delta h}}{{\Delta {T_{wb}}}}$$</div>

where

Δ*h* = enthalpy difference between the air entering and leaving the tower, J/kg

Δ*T<sub>wb</sub>*= wet-bulb temperature difference between the air entering and leaving the tower, <sup>o</sup>C

Since the liquid side conductance is much greater than the gas side conductance, the wetted-surface temperature is assumed to be equal to the water temperature. Based on this assumption and equations and , the expression for total heat transfer becomes:

<div>$$d{\dot Q_{total}} = UedA\left( {{T_w} - {T_{wb}}} \right)$$</div>

where

<div>$$Ue = \frac{{U\,\bar cpe}}{{cp}}$$</div>

*T<sub>wb</sub>* = wet-bulb temperature of the air, <sup>o</sup>C

*T<sub>w</sub>* = temperature of the water, <sup>o</sup>C

An energy balance on the water and air sides of the air/water interface yields the following equations:

<div>$$d{\dot Q_{total}} = {\dot m_w}cpw\,\,\,dTw$$</div>

<div>$$d{\dot Q_{total}} = {\dot m_a}\bar cpe\,\,\,dTwb$$</div>

where

<span>${\dot m_w}$</span> = mass flow rate of water, kg/s

<span>${\dot m_a}$</span> = mass flow rate of air, kg/s

Assuming that the heat capacity rate (<span>$\dot mcp$</span>) for the cooling tower water is less than that for the air,the effectiveness of the cooling tower can be defined by analogy to the effectiveness of a simple heat exchanger:

<div>$$\varepsilon  = \frac{{{T_{win}} - {T_{wout}}}}{{{T_{win}} - {T_{wbin}}}}$$</div>

where

*ε* = heat exchanger effectiveness

*T<sub>win</sub>* = inlet water temperature, <sup>o</sup>C

*T<sub>wout</sub>* = outlet water temperature, <sup>o</sup>C

*T<sub>wbin</sub>* = wet-bulb temperature of the inlet air, <sup>o</sup>C

Combining equations , , and and integrating over the entire heat transfer surface area, and combining the result with equation provides the following expression for cooling tower effectiveness:

<div>$$\varepsilon \,\, = \,\frac{{1 - \exp \left\{ { - NTU\left[ {1 - \left( {\frac{{{{\dot C}_w}}}{{{{\dot C}_a}}}} \right)} \right]} \right\}}}{{1 - \left( {\frac{{{{\dot C}_w}}}{{{{\dot C}_a}}}} \right)\exp \left\{ { - NTU\left[ {1 - \left( {\frac{{{{\dot C}_w}}}{{{{\dot C}_a}}}} \right)} \right]} \right\}}}$$</div>

where

<span>${\dot C_w} = {\dot m_w}c{p_w}$</span> and <span>${\dot C_a} = {\dot m_a}\bar c{p_e}$</span>

<div>$$NTU = Number\,of\,Transfer\,Units = \frac{{UAe}}{{{{\dot C}_w}}}$$</div>

This equation is identical to the expression for effectiveness of an indirect contact (i.e., fluids separated by a solid wall) counterflow heat exchanger (Incropera and DeWitt 1981). Therefore, the cooling tower can be modeled, in the steady-state regime, by an equivalent counterflow heat exchanger as shown in the following figure.

![](EngineeringReference/media/image4542.png)

Figure 194. Cooling Tower Schematic

The first fluid is water and the second fluid is an equivalent fluid entering the heat exchanger at temperature T<sub>wbin</sub> and specific heat <span>$\bar cpe$</span>. The heat exchanger is characterized by a single parameter, its overall heat transfer coefficient-area product UA<sub>e</sub>. The actual cooling tower heat transfer coefficient-area product is related to UA<sub>e</sub> by the following expression:

<div>$$UA = UAe\frac{{cp}}{{\bar cpe}}$$</div>

This heat transfer coefficient-area product is assumed to be a function of the air mass flow rate only and can be estimated from laboratory test results or manufacturers’ catalog data.

The model for the variable speed Merkel tower also includes Scheier’s modifications.  Scheier has extended the Merkel model to also include terms that adjust UA with three factors that model how UA values change when the tower is operating away from its rated conditions.  The first factor, <span>${f_{UA,wetbulb}}$</span>, adjusts UA for the current outdoor wetbulb temperature.  The user enters a performance curve or lookup table that is a function of one independent variable.  The independent variable is the difference between the design wetbulb temperature and the current wetbulb temperature, in degrees Celsius.

<div>$${f_{UA,wetbulb}} = func\left( {\left( {{T_{des,wetbulb}} - {T_{current,wetbulb}}} \right)} \right)$$</div>

The second factor, <span>${f_{UA,airflow}}$</span>, adjusts UA for the current air flow rate.  The user enters a performance curve or lookup table that is a function of one independent variable.  The independent variable is the ratio of the current air flow rate to the design air flow rate at full speed.

<div>$${f_{UA,airflow}} = func\left( {AirFlowRatio} \right)$$</div>

The third factor, <span>${f_{UA,waterflow}}$</span>, adjusts UA for the current water flow rate.  The user enters a performance curve or lookup table that is a function of one independent variable.  The independent variable is the ratio of the current water flow rate to the design water flow rate.

<div>$${f_{UA,waterflow}} = func\left( {WaterFlowRatio} \right)$$</div>

Then the UA value at any given time is calculated using

<div>$$U{A_e} = U{A_{design}} \bullet {f_{UA,wetbulb}} \bullet {f_{UA,airflow}} \bullet {f_{UA,waterflow}}$$</div>

#### Method for Calculating Steady-State Exiting Water Temperature

The objective of the cooling tower model is to predict the exiting water temperature and the fan power required to meet the exiting water setpoint temperature. Since only the inlet air and inlet water temperatures are known at any simulation time step, an iterative procedure is required to determine the exiting fluid temperatures using the equations defined in the previous section. In the case of the EnergyPlus model, the iterations are performed to determine the exiting wet-bulb temperature of the air. The exiting water temperature is then calculated based on an energy balance that assumes that the energy absorbed by the air is equivalent to the energy removed from the water. The procedure for calculating the steady-state, exiting air wet-bulb temperature is outlined below.

As explained previously, it is assumed that the moist air enthalpy can be defined by the wet-bulb temperature alone. Therefore, the first step in the procedure is to calculate the enthalpy of moist air entering the cooling tower based on the ambient wet-bulb temperature from the weather file. Since an iterative solution is required, a first guess of the outlet air wet-bulb temperature is then made and the enthalpy of this estimated outlet air wet-bulb temperature is calculated. Based on these inlet and outlet air conditions, the mean specific heat of the air is calculated based on equation , repeated here:

<div>$$\bar cpe = \frac{{\Delta h}}{{\Delta Twb}}$$</div>

With the overall heat transfer coefficient-area product for the cooling tower entered by the user, the effective heat transfer coefficient-area product is calculated by rearranging equation :

<div>$$UAe = UA\frac{{\bar cpe}}{{cp}}$$</div>

With <span>$\bar cpe$</span> and <span>$UAe$</span> known, the effectiveness of the heat exchanger is then calculated:

<div>$$\varepsilon \,\, = \,\frac{{1 - \exp \left\{ { - NTU\left[ {1 - \left( {\frac{{{{\dot C}_{\min }}}}{{{{\dot C}_{\max }}}}} \right)} \right]} \right\}}}{{1 - \left( {\frac{{{{\dot C}_{\min }}}}{{{{\dot C}_{\max }}}}} \right)\exp \left\{ { - NTU\left[ {1 - \left( {\frac{{{{\dot C}_{\min }}}}{{{{\dot C}_{\max }}}}} \right)} \right]} \right\}}}$$</div>

where

<span>${\dot C_{\min }} = \,Minimum\,({\dot C_w},\,{\dot C_a})$</span> and <span>${\dot C_{\max }} = \,Maximum\,({\dot C_w},\,{\dot C_a})$</span>

<span>${\dot C_w} = {\dot m_w}c{p_w}$</span> and <span>${\dot C_a} = {\dot m_a}\bar cpe$</span>

<div>$$NTU = Number\,of\,Transfer\,Units = \frac{{UAe}}{{{{\dot C}_{\min }}}}$$</div>

The heat transfer rate is then calculated as follows:

<div>$$\dot Qtotal = \,\varepsilon \,{\dot C_{\min }}\left( {Twin\, - \,Twbin} \right)$$</div>

The outlet air wet-bulb temperature is then recalculated:

<div>$${T_{wbout}} = {T_{wbin}} + \frac{{{{\dot Q}_{total}}}}{{{{\dot C}_a}}}$$</div>

The iterative process of calculating <span>${T_{wbout}}$</span> continues until convergence is reached.

Finally, the outlet water temperature is calculated as follows:

<div>$${T_{wout}} = {T_{win}} + \frac{{{{\dot Q}_{total}}}}{{{{\dot C}_w}}}$$</div>

#### Calculating the Actual Exiting Water Temperature and Fan Power

The previous section describes the methodology used for calculating the steady-state temperature of the water leaving the cooling tower. This methodology is used to calculate the exiting water temperature in the free convection regime (water pump on, tower fan off) and with the tower fan operating (including low and high fan speed for the two-speed tower). The exiting water temperature calculations use the fluid flow rates (water and air) and the UA-values entered by the user for each regime.

The cooling tower model seeks to maintain the temperature of the water exiting the cooling tower at (or below) a setpoint. The model obtains the target temperature setpoint from the setpoints placed on either the tower outlet node or the loop’s overall setpoint node (typically set to the supply side outlet node). The model checks to see if the outlet node has a setpoint placed on it and uses that if it does.  If the outlet node does not have a temperature setpoint then the model uses the loop-level outlet node specified in the input field called Loop Temperature Setpoint Node Name in the PlantLoop or CondenserLoop object. The model first checks to determine the impact of “free convection”, if specified by the user, on the tower exiting water temperature. If free convection is not specified by the user, then the exiting water temperature is initially set equal to the entering tower water temperature. If the user specifies “free convection” and the steady-state exiting water temperature based on “free convection” is at or below the setpoint, then the tower fan is not turned on.

If the exiting water temperature remains above the setpoint after “free convection” is modeled, then the tower fan is turned on to reduce the exiting water temperature to the setpoint. The model assumes that part-load operation is represented by a simple linear interpolation between two steady-state regimes (e.g., tower fan on for the entire simulation time step and tower fan off for the entire simulation time step). Cyclic losses are not taken into account.

The fraction of time that the tower fan must operate is calculated based on the following equation:

<div>$$\omega \,\, = \frac{{{T_{set}} - {T_{wout,off}}}}{{{T_{wout,on}} - {T_{wout,off}}}}$$</div>

where

<span>${T_{set}}$</span> = exiting water setpoint temperature, <sup>o</sup>C

<span>${T_{wout,off}}$</span> = exiting water temperature with tower fan off, <sup>o</sup>C

<span>${T_{wout,on}}$</span> = exiting water temperature with tower fan on, <sup>o</sup>C

The average fan power for the simulation time step is calculated by multiplying <span>$\omega \,$</span>by the steady-state fan power specified by the user.

The calculation method for the two-speed tower is similar to that for the single-speed tower example described above. The model first checks to see if “free convection” is specified and if the resulting exiting water temperature is below the setpoint temperature. If not, then the model calculates the steady-state exiting water temperature with the tower fan at low speed. If the exiting water temperature at low fan speed is below the setpoint temperature, then the average fan power is calculated based on the result of equation and the steady-state, low speed fan power specified by the user. If low-speed fan operation is unable to reduce the exiting water temperature below the setpoint, then the tower fan is increased to its high speed and the steady-state exiting water temperature is calculated. If this temperature is below the setpoint, then a modified version of equation is used to calculate runtime at high fan speed:

<div>$$\omega \,\, = \frac{{{T_{set}} - {T_{wout,low}}}}{{{T_{wout,high}} - {T_{wout,low}}}}$$</div>

where

<span>${T_{set}}$</span> = exiting water setpoint temperature, <sup>o</sup>C

<span>${T_{wout,low}}$</span> = exiting water temperature with tower fan at low speed, <sup>o</sup>C

<span>${T_{wout,high}}$</span> = exiting water temperature with tower fan at high speed, <sup>o</sup>C

The average fan power for the simulation time step is calculated for the two-speed cooling tower as follows:

<div>$${P_{fan,avg}}\, = \,\omega \,({P_{fan,high}})\, + \,\left( {1 - \omega } \right)\left( {{P_{fan,low}}} \right)$$</div>

The calculation method for the variable-speed Merkel/Scheier model is different from the one- and two-speed models.  Whereas the other towers are setpoint driven, the variable speed Merkel/Scheier model is driven by the load dispatched from the plant operation scheme, such as PlantEquipmentOperation:CoolingLoad.  The plant operation scheme provides the cooling tower model with a target load to meet and the tower is controlled to meet that load (as opposed to meeting a leaving setpoint).  This allows complex configurations with more than one cooling tower to be properly dispatched using all the features available in the various plant operation schemes.  The model first evaluates the load provided with the fans off using only free convection.  If the free convection mode meets or exceeds the target load then the tower runs in free convection mode.  The model then evaluates the load provided by running the fans at full speed.  If the full fan speed load provided is less than or equal to the target load then the tower runs at full speed.  The model then evaluates the load provided with the variable speed fan running at the minimum air speed ratio, which is a user input (default is 0.2).  If the minimum fan speed load provided meets or exceeds the target load, then tower runs at the minimum fan speed.  If the target load is between the load provided by minimum and maximum fans speeds, then the model solves for an airflow rate ratio that just meets the target load using Regula Falsi numerical method.  The variable speed Merkel/Scheier model does not model bypass and may provided excess cooling at times when running in free convection or at the minimum fan speed.  Fan power for the variable speed Merkel/Scheier model is then calculated from the airflow rate ratio using a design fan power and a performance curve or lookup table with one independent variable for the airflow ratio.

<div>$${P_{fan}} = {P_{fan,des}} \bullet func\left( {AirFlowRatio} \right)$$</div>

#### Tower Basin Heater

The tower basin heater operates in the same manner as the variable speed cooling tower basin heater. Refer to the variable speed cooling tower basin heater description in the following section.

#### Cooling Tower Makeup Water Usage

The cooling tower makeup water usage is the same as the variable speed cooling tower makeup water usage. Refer to the variable speed cooling tower makeup water usage description in the following section.

#### References

Rosaler, Robert C. 1995. Standard Handbook of Plant Engineering, 2<sup>nd</sup> Ed. New York, NY: McGraw-Hill, pp. 6-36-37.

### Variable Speed Cooling Towers Empirical Models

#### Overview

The input object CoolingTower:VariableSpeed provides models for variable speed towers that are based on empirical curve fits of manufacturer’s performance data or field measurements. The user specifies tower performance at design conditions, and empirical curves are used to determine the approach temperature and fan power at off-design conditions. The user defines tower performance by entering the inlet air wet-bulb temperature, tower range, and tower approach temperature at the design conditions. The corresponding water flow rate, air flow rate, and fan power must also be specified. The model will account for tower performance in the “free convection” regime, when the tower fan is off but the water pump remains on and heat transfer still occurs (albeit at a low level). Basin heater operation and makeup water usage (due to evaporation, drift, and blowdown) are also modeled.

The cooling tower seeks to maintain the temperature of the water exiting the cooling tower at (or below) a setpoint. The setpoint temperature is defined by the setpoints placed on either the tower outlet node or the loop’s overall setpoint node (typically set to the supply side outlet node). The model checks to see if the outlet node has a setpoint placed on it and uses that if it does.  If the outlet node does not have a temperature setpoint then the model uses the loop-level outlet node specified in the input field called Loop Temperature Setpoint Node Name in the PlantLoop or CondenserLoop object. The model simulates the outlet water temperature in four successive steps:

·        The model first determines the tower outlet water temperature with the tower fan operating at maximum speed. If the outlet water temperature is above the setpoint temperature, the fan runs at maximum speed.

·        If the outlet water temperature with maximum fan speed is below the setpoint temperature, then the model next determines the impact of “free convection” (water flowing through tower with fan off). If the exiting water temperature based on “free convection” is at or below the setpoint, then the tower fan is not turned on.

·        If the outlet water temperature remains above the setpoint after “free convection” is modeled, then the tower fan is turned on at the minimum fan speed (minimum air flow rate ratio) to reduce the leaving water temperature. If the outlet water temperature is below the setpoint at minimum fan speed, the tower fan is cycled on and off to maintain the outlet water setpoint temperature.

·        If the outlet water temperature remains above the setpoint after minimum fan speed is modeled, then the tower fan is turned on and the model determines the required air flow rate and corresponding fan speed to meet the desired setpoint temperature.

#### Model Description

The variable speed tower model utilizes user-defined tower performance at design conditions along with empirical curves to determine tower heat rejection and fan power at off-design conditions. Basin heater operation and makeup water usage are also modeled based on user inputs, tower entering air conditions, and tower operation. The following sections describe how each of these tower performance areas is modeled.

#### Tower Heat Rejection

Heat rejection by the variable speed cooling tower is modeled based on the CoolTools correlation, YorkCalc correlation, or user-defined coefficients for either the CoolTools or YorkCalc correlations. These purely-empirical correlations model the tower approach temperature using a polynomial curve fit with a large number of terms and either three or four independent variables.

The CoolTools correlation has 35 terms with four independent variables:

    Approach =   Coeff(1)  +  Coeff(2)•FRair  +  Coeff(3)•(FRair)<sup>2</sup>  +

Coeff(4)•(FRair)<sup>3</sup>  +  Coeff(5)•FRwater  +

Coeff(6)•FRair•FRwater  +  Coeff(7)•(FRair)<sup>2</sup>•FRwater  +

Coeff(8)•(FRwater)<sup>2</sup>  +  Coeff(9)•FRair•(FRwater)<sup>2</sup>  +

Coeff(10)•(FRwater)<sup>3</sup>  +  Coeff(11)•Twb  +  Coeff(12)•FRair•Twb  +

Coeff(13)•(FRair)<sup>2</sup>•Twb  +  Coeff(14)•FRwater•Twb  +

Coeff(15)•FRair•FRwater•Twb  +  Coeff(16)•(FRwater)<sup>2</sup>•Twb  +

Coeff(17)•(Twb)<sup>2</sup>  +  Coeff(18)•FRair•(Twb)<sup>2</sup>  +

Coeff(19)•FRwater•(Twb)<sup>2</sup>  +  Coeff(20)•(Twb)<sup>3</sup>  +  Coeff(21)•Tr  +

Coeff(22)•FRair•Tr  +  Coeff(23)•(FRair)<sup>2</sup>•Tr  +

Coeff(24)•FRwater•Tr  +  Coeff(25)•FRair•FRwater•Tr  +

Coeff(26)•(FRwater)<sup>2</sup>•Tr  +  Coeff(27)•Twb•Tr  +

Coeff(28)•FRair•Twb•Tr  +  Coeff(29)•FRwater•Twb•Tr  +

Coeff(30)•(Twb)<sup>2</sup>•Tr  +  Coeff(31)•(Tr)<sup>2</sup> + Coeff(32)•FRair•(Tr)<sup>2 </sup> +

Coeff(33)•FRwater•(Tr)<sup>2 </sup> +  Coeff(34)•Twb•(Tr)<sup>2 </sup> +  Coeff(35)•(Tr)<sup>3</sup>

where:

Approach = approach temperature (<sup>o</sup>C) = outlet water temperature minus inlet air wet-bulb temperature

FRair = air flow rate ratio (actual air flow rate divided by design air flow rate)

FRwater = water flow rate ratio (actual water flow rate divided by design water flow rate)

Tr = range temperature (<sup>o</sup>C) = inlet water temperature minus outlet water temperature

Twb = inlet air wet-bulb temperature (<sup>o</sup>C)

Coeff(\#) = correlation coefficients

If the user selects Tower Model Type = CoolToolsCrossFlow, then the 35 coefficients derived for the CoolTools simulation model (Benton et al. 2002) are used and these coefficients are already defined within EnergyPlus as shown in Table 63. If the user specifies Tower Model Type = CoolToolsUserDefined, then the user must enter a CoolingTowerPerformance:CoolTools object to define the 35 coefficients that will be used by the CoolTools approach temperature correlation.

Table 63. Approach Temperature Correlation Coefficients

**Coefficient Number**

**Coefficient Value**

**CoolTools**

**YorkCalc**

Coeff(1)

0.52049709836241

-0.359741205

Coeff(2)

-10.617046395344

-0.055053608

Coeff(3)

10.7292974722538

0.0023850432

Coeff(4)

-2.74988377158227

0.173926877

Coeff(5)

4.73629943913743

-0.0248473764

Coeff(6)

-8.25759700874711

0.00048430224

Coeff(7)

1.57640938114136

-0.005589849456

Coeff(8)

6.51119643791324

0.0005770079712

Coeff(9)

1.50433525206692

-0.00001342427256

Coeff(10)

-3.2888529287801

2.84765801111111

Coeff(11)

0.0257786145353773

-0.121765149

Coeff(12)

0.182464289315254

0.0014599242

Coeff(13)

-0.0818947291400898

1.680428651

Coeff(14)

-0.215010003996285

-0.0166920786

Coeff(15)

0.0186741309635284

-0.0007190532

Coeff(16)

0.0536824177590012

-0.025485194448

Coeff(17)

-0.00270968955115031

0.0000487491696

Coeff(18)

0.00112277498589279

0.00002719234152

Coeff(19)

-0.00127758497497718

-0.0653766255555556

Coeff(20)

0.0000760420796601607

-0.002278167

Coeff(21)

1.43600088336017

0.0002500254

Coeff(22)

-0.5198695909109

-0.0910565458

Coeff(23)

0.117339576910507

0.00318176316

Coeff(24)

1.50492810819924

0.000038621772

Coeff(25)

-0.135898905926974

-0.0034285382352

Coeff(26)

-0.152577581866506

0.00000856589904

Coeff(27)

-0.0533843828114562

-0.000001516821552

Coeff(28)

0.00493294869565511

N/A

Coeff(29)

-0.00796260394174197

N/A

Coeff(30)

0.000222619828621544

N/A

Coeff(31)

-0.0543952001568055

N/A

Coeff(32)

0.00474266879161693

N/A

Coeff(33)

-0.0185854671815598

N/A

Coeff(34)

0.00115667701293848

N/A

Coeff(35)

0.000807370664460284

N/A

Similarly, the YorkCalc correlation has 27 terms with three independent variables:

    Approach =   Coeff(1)  +  Coeff(2)•Twb +  Coeff(3)•Twb<sup>2</sup>  +  Coeff(4)•Tr  +

Coeff(5)•Twb•Tr  +  Coeff(6)•Twb<sup>2</sup>•Tr  +  Coeff(7)•Tr<sup>2</sup>  +

Coeff(8)•Twb•Tr<sup>2 </sup> +  Coeff(9)•Twb<sup>2</sup>•Tr<sup>2 </sup> +  Coeff(10)•LGRatio  +

Coeff(11)•Twb•LGRatio  + Coeff(12)•Twb<sup>2</sup>•LGRatio  +

Coeff(13)•Tr•LGRatio  +  Coeff(14)•Twb•Tr•LGRatio  +

Coeff(15)•Twb<sup>2</sup>•Tr•LGRatio  +  Coeff(16)•Tr<sup>2</sup>•LGRatio  +

Coeff(17)•Twb•Tr<sup>2</sup>•LGRatio  + Coeff(18)•Twb<sup>2</sup>•Tr<sup>2</sup>•LGRatio +

Coeff(19)•LGRatio<sup>2 </sup> +  Coeff(20)•Twb•LGRatio<sup>2</sup>  +

Coeff(21)• Twb<sup>2</sup>•LGRatio<sup>2 </sup> +  Coeff(22)•Tr•LGRatio<sup>2 </sup> +

Coeff(23)•Twb•Tr•LGRatio<sup>2 </sup> +  Coeff(24)•Twb<sup>2</sup>•Tr•LGRatio<sup>2 </sup> +

Coeff(25)•Tr<sup>2</sup>•LGRatio<sup>2 </sup> +  Coeff(26)•Twb•Tr<sup>2</sup>•LGRatio<sup>2 </sup> +

Coeff(27)•Twb<sup>2</sup>•Tr<sup>2</sup>•LGRatio<sup>2</sup>

where:

            Approach = approach temperature (<sup>o</sup>C) = outlet water temperature minus inlet air wet-bulb temperature

            Tr = range temperature (<sup>o</sup>C) = inlet water temperature minus outlet water temperature

            Twb = inlet air wet-bulb temperature (<sup>o</sup>C)

            LGratio = liquid-to-gas ratio = ratio of water flow rate ratio (FRwater) to air flow rate ratio (FRair)

      Coeff(\#) = correlation coefficients



If the user selects Tower Model Type = YorkCalc, then the 27 coefficients derived for the YorkCalc simulation model (York International Corp. 2002) are used and these coefficients are already defined within EnergyPlus as shown in Table 63. If the user specifies Tower Model Type = YorkCalcUserDefined, then the user must enter a CoolingTowerPerformance:YorkCalc object to define the 27 coefficients that will be used by the YorkCalc approach temperature correlation.

The approach temperature correlations for the CoolTools and YorkCalc simulation models are valid for a range of conditions defined in Table 64. If the user defines their own model coefficients (CoolingTowerPerformance:CoolTools or CoolingTowerPerformance:YorkCalc), then they must also define in that same object the range of conditions for which the model is valid. For all of these correlation variables, the program issues warnings if the actual values are beyond the minimum/maximum values specified for the correlation being used. For inlet air wet-bulb temperature and water mass flow rate ratio, the values of these variables used in the calculation of approach temperature are limited to be within the valid minimum/maximum range. For approach, range, and liquid-to-gas ratio the warnings are issued if the values are beyond the specified minimum/maximum range but the actual values are still used. The warnings issued do not necessarily indicate a poor estimate of tower performance at the condition(s) which caused the warning, but are provided to identify conditions outside the defined correlation limits. Exceeding the defined limits by a small amount may not introduce significant errors, but large deviations may be problematic. It is for this reason that we recommend using a very broad range of cooling tower performance data (i.e., data covering the entire range expected during the simulation) when generating user-defined coefficients for the variable speed tower model.





Table 64. Minimum and Maximum Limits for Approach Temperature Correlation Variables

<table class="table table-striped">






<tr>
<td>Independent Variable Limit</td>
<td>CoolTools</td>
<td>YorkCalc</td>
</tr>
<tr>
<td>Minimum Inlet Air Wet-Bulb Temperature</td>
<td>-1.0°C</td>
<td>-34.4°C</td>
</tr>
<tr>
<td>Maximum Inlet Air Wet-Bulb Temperature</td>
<td>26.7°C</td>
<td>26.7°C</td>
</tr>
<tr>
<td>Minimum Tower Range Temperature</td>
<td>1.1°C</td>
<td>1.1°C</td>
</tr>
<tr>
<td>Maximum Tower Range Temperature</td>
<td>11.1°C</td>
<td>22.2°C</td>
</tr>
<tr>
<td>Minimum Tower Approach Temperature</td>
<td>1.1°C</td>
<td>1.1°C</td>
</tr>
<tr>
<td>Maximum Tower Approach Temperature</td>
<td>11.1°C</td>
<td>40°C</td>
</tr>
<tr>
<td>Minimum Water Flow Rate Ratio</td>
<td>0.75</td>
<td>0.75</td>
</tr>
<tr>
<td>Maximum Water Flow Rate Ratio</td>
<td>1.25</td>
<td>1.25</td>
</tr>
<tr>
<td>Maximum Liquid-to-Gas Ratio</td>
<td>N/A</td>
<td>8.0</td>
</tr>

</table>

** **

The approach temperature correlation(s) used to simulate cooling tower heat rejection are based on water and air flow rate “ratios” and are not directly dependent on the size of the tower or the actual air and water flow rates through the tower. However, the model correlations are developed based on a reference condition. For Model Types “CoolToolsCrossFlow” and “YorkCalc”, the reference condition is a water flow rate of 0.000043 m<sup>3</sup>/s per kW of heat rejected (2.4 gal/min per ton of heat rejected) with 25.6<sup>o</sup>C (78<sup>o</sup>F) enter air wet-bulb temperature, 35<sup>o</sup>C (95<sup>o</sup>F) hot water inlet temperature, and 29.4<sup>o</sup>C (85<sup>o</sup>F) cold water outlet temperature. The reference condition may be different if the user defines tower model coefficients using CoolingTowerPerformance:CoolTools or CoolingTowerPerformance:YorkCalc.

Due to the inherent reference condition used to generate the tower performance curves, the water flow rate at the reference condition must be determined using the design performance information specified by the user and the tower model’s approach temperature correlation. This is done by using the model’s approach temperature correlation (described earlier in this section) to calculate the water flow rate ratio which yields the user-defined design approach temperature based on an air flow rate ratio of 1.0 (*FR<sub>air</sub>* = 1.0), the design inlet air wet-bulb temperature, and the design range temperature. The calculated approach temperature (using the model correlation) must satisfy the following two equations:

<span>${T_{water,outlet,design}} = {T_{wb,air,design}} + {T_{approach,design}}\quad \{ F{R_{air}} = 1.0\} $</span><span>${T_{water,inlet,design}} = {T_{wb,air,design}} + {T_{approach,design}} + {T_{range,design}}\quad \{ F{R_{air}} = 1.0\} $</span>

where:

<span>${T_{water,outlet,design}}$</span>= design outlet water temperature (<sup>o</sup>C)

<span>${T_{water,inlet,design}}$</span>= design inlet water temperature (<sup>o</sup>C)

<span>${T_{wb,air,design}}$</span>= design inlet air wet-bulb temperature (<sup>o</sup>C)

<span>${T_{approach,design}}$</span>= design approach temperature (<sup>o</sup>C)

<span>${T_{range,design}}$</span>= design range temperature (<sup>o</sup>C)

<span>$F{R_{air}}$</span>= air flow rate ratio (actual air flow rate divided by design air flow rate)

The water flow rate ratio used in the approach temperature correlation which satisfies these two equations is the ratio of the design water flow rate (specified by the user) to the water flow rate at the reference condition. This ratio is used to calculate the reference water volumetric flow rate, which is then used throughout the simulation to determine the actual water flow rate ratio used in the approach temperature correlation for each simulation time step.

<div>$${\dot V_{reference}} = \frac{{{{\dot V}_{design}}}}{{F{R_{water\;reference}}}}$$</div>

where:

<span>${\dot V_{reference}}$</span>= water volumetric flow rate at the reference condition (m<sup>3</sup>/s)

<span>${\dot V_{design}}$</span>= design water volumetric flow rate specified by the user (m<sup>3</sup>/s)

<span>$F{R_{water,reference}}$</span>= design water flow rate divided by the reference water flow rate

The cooling tower seeks to maintain the temperature of the water exiting the cooling tower at (or below) a setpoint. The setpoint temperature is defined by the field “Condenser Loop Temperature Setpoint schedule or reference” for the CondenserLoop object. The model simulates the outlet water temperature in four successive steps:

·        The model first determines the tower outlet water temperature with the tower fan operating at maximum speed. If the outlet water temperature is above the setpoint temperature, the fan runs at maximum speed.

·        If the outlet water temperature with maximum fan speed is below the setpoint temperature, then the model next determines the impact of “free convection” (water flowing through tower with fan off). If the exiting water temperature based on “free convection” is at or below the setpoint, then the tower fan is not turned on.

·        If the outlet water temperature remains above the setpoint after “free convection” is modeled, then the tower fan is turned on at the minimum fan speed (minimum air flow rate ratio) to reduce the leaving water temperature. If the outlet water temperature is below the setpoint at minimum fan speed, the tower fan is cycled on and off to maintain the outlet water setpoint temperature.

·        If the outlet water temperature remains above the setpoint after minimum fan speed is modeled, then the tower fan is turned on and the model determines the required air flow rate and corresponding fan speed to meet the desired setpoint temperature.

For each simulation time step, the model first calculates the outlet water temperature with the tower fan operating at maximum speed (FRair = 1.0). The calculated approach temperature (using the correlations described above), inlet air wet-bulb temperature (weather data), and range temperature are used to determine the tower outlet water temperature as follows:

<div>$$\begin{array}{l}{T_{water,outlet,fanMAX}} = {T_{wb,air}} + \,\,{T_{approach}}\,\,\,\,\,\{ F{R_{air}} = 1.0\} \\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\quad \,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, = \,{T_{water,inlet}}\, + \,\,{T_{range}}\end{array}$$</div>

where:

<span>${T_{water,outlet,fanMAX}}$</span> = tower outlet water temperature at maximum fan speed (<sup>o</sup>C)

<span>${T_{wb,air}}$</span> = tower inlet air wet-bulb temperature (<sup>o</sup>C)

<span>${T_{approach}}$</span>= approach temperature at current operating conditions (<sup>o</sup>C)

<span>${T_{range}}$</span>= range temperature at current operating conditions (<sup>o</sup>C)

Note that the approach temperature correlation as described previously is a function of range temperature, so the equations above must be solved iteratively to converge on a solution. If the resulting outlet water temperature is above the desired setpoint temperature, then the fan runs at maximum speed and does not cycle on/off (fan part-load ratio = FanPLR = 1.0 and *FR<sub>air</sub>* = 1.0).

If the outlet water temperature with maximum fan speed is below the setpoint temperature, then the model next determines the impact of “free convection” (water flowing through tower with fan off). In the free convection regime, the outlet water temperature is calculated using a fraction of the water temperature difference through the tower when the fan is at its maximum speed. This fraction is defined by the user (Fraction of Tower Capacity in Free Convection Regime).

<div>$${T_{water,outlet,fanOFF}} = {T_{water,inlet}}\,\,\,\, - \,\,\left[ {Fra{c_{freeconv}}\left( {{T_{water,inlet}}\,{\rm{ - }}\,\,{T_{water,outlet,fanMAX}}} \right)} \right]$$</div>

where:

<span>${T_{water,outlet,fanOFF}}$</span> = tower outlet water temperature in free convection regime (<sup>o</sup>C)

<span>${T_{water,inlet}}$</span> = tower inlet water temperature (<sup>o</sup>C)

<span>$Fra{c_{freeconv}}$</span>= fraction of tower capacity in free convection regime (user specified)

If the outlet water temperature in the free convection regime is below the setpoint temperature, the tower fan is not turned on and the fan part-load ratio is set equal to 0. In addition, the air flow rate ratio through the tower is assumed to be equal to the fraction of tower capacity in the free convection regime.

<div>$$FanPLR\,\, = \,\,FanPL{R_{freeconv}} = 0.0$$</div>

<div>$$F{R_{air}}\, = F{R_{air,freeconv}} = Fra{c_{freeconv}}$$</div>

where:

<span>$FanPLR$</span>= fan part-load ratio

<span>$FanPL{R_{freeconv}}$</span>= fan part-load ratio in free convection regime

<span>$F{R_{air,freeconv}}$</span> = air flow rate ratio in free convection regime

If the outlet water temperature in the free convection regime is above the setpoint temperature, then the fan is turned on at the minimum fan speed (minimum air flow rate ratio, FR<sub>air,min</sub> , entered by the user) and the outlet water temperature is calculated as the inlet air wet-bulb temperature plus the calculated approach temperature:

<div>$$F{R_{air}} = F{R_{air,\min }}$$</div>

<div>$${T_{water,outlet,fanMIN}} = {T_{wb,air}}{\rm{ + }}\,{T_{approach}}\,\,\,\,\{ F{R_{air}}\, = \,F{R_{air,\min }}\} $$</div>

where:

<span>${T_{water,outlet,FanMIN}}$</span> = outlet water temperature at minimum fan speed (<sup>o</sup>C)

<span>$F{R_{air,\min }}$</span> = air flow rate ratio at the minimum fan speed

If the outlet water temperature at minimum fan speed is below the setpoint temperature, the cooling tower fan cycles on and off at the minimum air flow rate ratio in order to meet the setpoint temperature.

<div>$$FanPLR = \left( {\frac{{{T_{water,outlet,fanOFF}} - {T_{{\rm{setpoint}}}}}}{{{T_{water,outlet,fanOFF}} - {T_{water,outlet,fanMIN}}}}} \right)$$</div>

where:

<span>${T_{{\rm{setpoint}}}}$</span> = outlet water setpoint temperature (<sup>o</sup>C)

If the outlet water temperature at minimum fan speed is above the outlet water temperature setpoint, then the cooling tower fan speed (*FR<sub>air</sub>*) is increased until the calculated approach temperature produces the required outlet water temperature to meet the setpoint.

<div>$${T_{approach}} = f\left( {F{R_{air}}} \right)$$</div>

<div>$${T_{water,outlet}} = {T_{{\rm{setpoint}}}}\, = {T_{wb,air}}{\rm{ + }}\,{T_{approach}}$$</div>

<span>$FanPLR = 1.0$</span> *(i.e., fan does not cycle on/off)*

#### Fan Power

When the cooling tower fan is operating, fan electric power is calculated based on the air flow rate ratio required to meet the above conditions. If the user has entered a fan power curve object (cubic curve), the output of that curve is multiplied by the design fan power. Otherwise, tower fan power is assumed to be directly proportional to the cube of the air flow rate ratio. In either case, the fan part-load ratio is applied to account for times when the tower fan cycles on/off to meet the setpoint temperature. Fan energy consumption is calculated each simulation time step.

<div>$$\begin{array}{l}IF\left( {FanPowerCurveObject\,\,\,is\,Defined} \right)THEN\\\quad {P_{fan}} = \left( {CurveOutput} \right)\left( {FanPLR} \right){P_{fan,design}}\\ELSE\\\quad {P_{fan}} = \left( {{P_{fan,design}}} \right)\left( {FanPLR} \right){\left( {F{R_{air}}} \right)^{\rm{3}}}\\ENDIF\end{array}$$</div>

<div>$${E_{fan}} = \left( {{P_{fan}}} \right)\left( {TimeStepSys} \right)3600.$$</div>

where:

<span>$FanPowerCurveObject$</span> = name of fan power ratio as a function of air flow rate ratio curve

<span>${P_{fan}}$</span> = tower fan electric power (W)

<span>${E_{fan}}$</span> = tower fan electric consumption (J)

<span>$CurveOutput$</span> = output of FanPowerCurveObject evaluated at the operating air flow rate ratio (*FR<sub>air</sub>*)

<span>${P_{fan,design}}$</span> = design fan power at design (maximum) air flow through the tower (W)

*TimeStepSys* = HVAC system simulation time step (hr)

#### Tower Basin Heater

Calculations are also made to estimate the electric power input to the tower basin heater. A schedule may be used to disable the basin heater during regular maintenance periods or other time periods (e.g., during summer). If a schedule is not provided, the basin heater is assumed to be available the entire simulation time period. The basin heater operates when it is scheduled on, the outdoor air dry-bulb temperature is below the basin heater setpoint temperature, and the cooling tower is not active (i.e., water is not flowing through the tower). The user is required to enter a basin heater capacity (watts per degree Kelvin) and a heater setpoint temperature (<sup>o</sup>C) if they want to model basin heater electric power.

<div>$$\begin{array}{l}{P_{{\rm{heater,basin}}}}{\rm{ = }}0.0\\IF\,(WaterNotFlowingThroughTower)\,THEN\\\,\,\,\,\,\,IF\left( {Schedul{e_{{\rm{heater,basin}}}}\,is\,Defined} \right)THEN\\\quad \,\,\,\,\,\,IF({\rm{CA}}{{\rm{P}}_{{\rm{heater,basin}}}}\,{\rm{ >  }}0\,\,.AND.\,\,\,Schedul{e_{{\rm{heater,basin}}}} = ON)\,\,THEN\\\quad \quad \,\,\,\,\,{P_{{\rm{heater,basin}}}}\,{\rm{ = }}\,\,{\rm{MAX}}\left( {{\rm{0}}{\rm{.0,CA}}{{\rm{P}}_{{\rm{heater,basin}}}}\left( {{{\rm{T}}_{{\rm{setpoint,basin}}}}{\rm{ - }}{{\rm{T}}_{{\rm{db,outdoor}}}}} \right)} \right)\,\,\,\\\,\,\,\quad \,\,ENDIF\\\,\,\,\,\,\,ELSE\\\quad \,\,\,\,\,\,IF(\,{\rm{CA}}{{\rm{P}}_{{\rm{heater,basin}}}}\,{\rm{ >  }}0)\,\,THEN\\\,\,\,\quad \,\,\,\,\,\,\,\,{P_{{\rm{heater,basin}}}}\,{\rm{ = }}\,{\rm{MAX}}\left( {{\rm{0}}{\rm{.0,CA}}{{\rm{P}}_{{\rm{heater,basin}}}}\left( {{{\rm{T}}_{{\rm{setpoint,basin}}}}{\rm{ - }}{{\rm{T}}_{{\rm{db,outdoor}}}}} \right)} \right)\\\,\,\,\,\,\,\,\,\,\,\,ENDIF\\\,\,\,\,\,\,ENDIF\\ENDIF\end{array}$$</div>

<div>$${E_{{\rm{heater,basin}}}} = \left( {{P_{{\rm{heater,basin}}}}} \right)\left( {TimeStepSys} \right){\rm{3600}}{\rm{.}}$$</div>

where:

<span>${P_{{\rm{heater,basin}}}}$</span> = tower basin heater electric power (W)

<span>${E_{{\rm{heater,basin}}}}$</span> = tower basin heater electric consumption (J)

*T<sub>setpoint,basin</sub>* = basin heater setpoint temperature (<sup>o</sup>C)

*T<sub>db,outdoor</sub>*    = outdoor air dry-bulb temperature (<sup>o</sup>C)

CAP*<sub>heater,basin</sub>* = basin heater capacity (W/K)

*Schedule<sub>heater,basin</sub>* = basin heater schedule (schedule value &gt; 0 means ON)

#### References

ASHRAE 1999. HVAC1 Toolkit: A Toolkit for Primary HVAC System Energy Calculations. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Benton, D.J., Bowman, C.F., Hydeman, M., Miller, P. 2002. An Improved Cooling Tower Algorithm for the CoolTools<sup>TM</sup> Simulation Model. *ASHRAE Transactions,* Vol. 108, Part 1, pp.760-768.

Bourdouxhe, J.P., M. Grodent, J. Lebrun and C. Silva. 1994. Cooling tower model developed in a toolkit for primary HVAC system energy calculation: part 1. Proceedings of the fourth international conference on system simulation in buildings, Liege (Belgium), December 5-7, 1994.

Incropera, F.P. and D.P. DeWitt. 1981. Fundamentals of Heat Transfer. New York: John Wiley & Sons.

Merkel, F.  1925. Verduftungskuhlung. VDI Forschungarbeiten, No 275, Berlin.

Rosaler, Robert C. 1995. Standard Handbook of Plant Engineering, 2<sup>nd</sup> Ed. New York, NY: McGraw-Hill, pp. 6-36-37.

Scheier, L. 2013. Personal communication.

York International Corporation, 2002. “YORKcalc<sup>TM</sup> Software, Chiller-Plant Energy-Estimating Program”, Form 160.00-SG2 (0502).

### Cooling Towers with Multiple Cells

Many towers are constructed to be capable of being grouped together to achieve the desired capacity. Thus, many cooling towers are assemblies of two or more individual cooling towers or “cells.” The number of cells they have, e.g., an eight-cell tower, often refers to such towers.

For the operation of multi-cell towers, the first step is to determine the number of cells *n,* which will be operating during the timestep using the calculation logic from DOE-2.1E.

The maximum and minimum flow rates per cell are determined according to the input fractions (*Minimum  Water Flow Rate Fraction:*<span>${k_{min}}$</span>* * and *Maximum  Water Flow Rate Fraction:* <span>${k_{max}}$</span>) as follows:

<div>$$
  \left\{
    \begin{array}{rl}
      {{\dot m}_{w,min}} =  & \frac{{{{\dot m}_{w,des}}}}{{{n_{tot}}}} \times {k_{min}} \\
      {{\dot m}_{w,max}} =  & \frac{{{{\dot m}_{w,des}}}}{{{n_{tot}}}} \times {k_{max}}
    \end{array}
  \right.
$$</div>

where <span>${{{\dot m}_{w,des}}}$</span> is the design water flow rate through the entire cooling tower.

Then, we determine the minimum and maximum number of cells that can operate with this water flow rate:

<div>$$
  \left\{
    {\begin{array}{c}
      {{n_{min}} &= MIN\left( {\frac{{{{\dot m}_{w,tot}}}}{{{{\dot m}_{w,max}}}},{n_{tot}}} \right)} \\
      {{n_{max}} &= MIN\left( {\frac{{{{\dot m}_{w,tot}}}}{{{{\dot m}_{w,min}}}},{n_{tot}}} \right)}
    \end{array}}
  \right.
$$</div>

where *n<sub>tot</sub>* is the total number of cells of the tower, and<span>${{{\dot m}_{w,tot}}}$</span> is the water flow rate to the tower.

The number of cells operating*n* is set accordingly:

If the *Cell Control* method is *MinimalCell,*

*n =* <span>${{n_{min}}}$</span>

If the *Cell Control* method is *MaximalCell,*

*n =* <span>${{n_{max}}}$</span>

Finally, the water mass flow rate per cell (<span>${{\dot m}_w})$</span> will be:

<div>$${{\dot m}_w} = \frac{{{{\dot m}_{w,tot}}}}{n}$$</div>

Then we simulate the performance of one cell with this flow rate per cell (calling the SimSimpleTower subroutine for single and two speed cooling tower objects). As we assume that each cell is identical, the UA of one cell is calculated dividing the UA of the whole tower (obtained from the input or from the auto sizing calculations). The air flow rate per cell is also equal to the one of the whole tower divided by the number of cells operating:

<div>$$U{A_{cell}} = \frac{{U{A_{cell}}}}{{{n_{tot}}}}$$</div>

<div>$${\dot m_{air,cell}} = \frac{{{{\dot m}_{air,tot}}}}{n}$$</div>

At the end, the total fan power of the tower operating with a certain number of cells is given by:

<div>$$FanPower = FanPowe{r_{tot}} \times \frac{n}{{{n_{tot}}}}$$</div>

If the cells operating do not meet the loads, we increase the number of cells if spare cells are available and the water flow through each cell is within the user specified minimum and maximum water flow rate fractions range. This is an iteration process.

### Cooling Tower Makeup Water Usage

Makeup water use for all types of cooling towers is made up of three components: evaporation, drift, and blowdown.  The first is the amount of water evaporated to reduce the water’s temperature as it passes through the cooling tower. There are two methods that evaporation makeup water can be modeled in EnergyPlus.  The first method assumes that the tower outlet air conditions are saturated (which may not always be the case for certain operating conditions).  For this “Saturated Exit” mode, the enthalpy of the tower’s outlet air is calculated as the inlet air enthalpy plus the water side heat transfer divided by the air mass flow rate through the tower.

<div>$${\dot Q_{water}} = {\dot m_{_{water}}}{C_p}\left( {{T_{{\rm{water,inlet}}}} - {T_{{\rm{water,outlet}}}}} \right)$$</div>

<div>$${h_{sat\,air,outlet}} = {h_{air,inlet}} + \left( {\frac{{{{\dot Q}_{water}}}}{{{{\dot m}_{air}}}}} \right)$$</div>

where:

<span>${\dot Q_{water}}$</span> = water-side heat transfer (W)

<span>${\dot m_{_{water}}}$</span> = mass flow rate of water through the tower (kg/s)

<span>${C_p}$</span> = specific heat of water (W/kg-K)

<span>${h_{sat\,air,outlet}}$</span> = saturated outlet air enthalpy (J/kg)

<span>${h_{air,inlet}}$</span> = inlet air enthalpy (J/kg)

<span>${\dot m_{air}}$</span> = mass flow rate of air through the tower (kg/s)

The saturation temperature and humidity ratio are then calculated for the tower’s outlet air.

<div>$${T_{sat\,air,outlet}} = PsyTsatFnHPb\left( {{h_{sat\,air,outlet}},{\rm{OutBaroPress}}} \right)$$</div>

<div>$${\omega_{sat\,air,outlet}} = PsyWFnTdbH\left( {{T_{sat\,air,outlet}},{h_{sat\,air,outlet}}} \right)$$</div>

where:

<span>${T_{sat\,air,outlet}}$</span> = saturated outlet air temperature (<sup>o</sup>C)

<span>$PsyTsatFnHPb$</span> = EnergyPlus psychrometric function, returns saturation temperature given enthalpy and barometric pressure

<span>${\rm{OutBaroPress}}$</span> = outdoor barometric pressure (Pa)

<span>${\omega_{sat\,air,outlet}}$</span> = saturated outlet air humidity ratio (kg<sub>water</sub>/kg<sub>dry\\ air</sub>)

<span>$PsyWFnTdbH$</span> = EnergyPlus psychrometric function, returns humidity ratio given dry-bulb temperature and enthalpy

The makeup water quantity required to replenish the water lost due to evaporation is then calculated as the product of the air mass flow rate and the difference between the entering and leaving air humidity ratio divided by the density of water.

<div>$${\dot V_{evaporation,makeup}} = \frac{{{{\dot m}_{air}}\left( {{\omega_{sat\,air,outlet}} - {\omega_{air,inlet}}} \right)}}{{{\rho_{water}}}}$$</div>

where:

<span>${\dot V_{evaporation,makeup}}$</span> = makeup water usage due to evaporation (m<sup>3</sup>/s)

<span>${\dot m_{air}}$</span> = mass flow rate of air through tower (kg/s)

<span>${\omega_{air,inlet}}$</span> = humidity ratio of tower inlet air (kg<sub>water</sub>/kg<sub>dry\\ air</sub>)

<span>${\rho_{water}}$</span> = density of water evaluated at the tower inlet air temperature (kg/m<sup>3</sup>)

The second method available for calculating water makeup for evaporation is for the user to provide a value for a loss factor.  The evaporation loss is then calculated as a fraction of the circulating condenser water flow and varies with the temperature change in the condenser water.  The value provided by the user is in units of percent-per-degree Kelvin.  The evaporation rate will equal this value times each degree Kelvin of temperature drop in the condenser water.  Typical values are from 0.15 to 0.27 [percent/K]. The default is 0.2.  The rate of water makeup for evaporation is then calculated by multiplying this factor times the condenser water flow rate and the temperature decrease in the condenser water flow rate. For evaporative fluid coolers, a numerical value of loss factor can be entered in the same manner as for cooling towers. If this field is blank, an empirical correlation will be used to calculate the value based on current outdoor dry bulb temperature and relative humidity. The following correlation from Qureshi and Zubair (2007) is used to calculate the loss factor:

<div>$$Loss\;Factor = (113 - 8.417\phi  + 1.6147{t_{db}})*{10^{ - 5}}$$</div>

where:

<span>$\phi $</span> = relative humidity of inlet air

<span>${t_{db}}$</span> = Dry-bulb temperature of inlet air

Additional makeup water usage is modeled as a percentage of design water flow rate through the tower to account for drift, and as a scheduled flow rate to model blowdown. Drift is water loss due to the entrainment of small water droplets in the air stream passing through the tower. Drift is defined by the model user as a percentage of the tower’s design water flow rate, and is assumed to vary with tower air flow rate ratio as follows:

<div>$${\dot V_{drift,makeup}} = {\dot m_{water,design}}\left( {\frac{{PercentWatertoDrift}}{{100.0}}} \right)F{R_{air}}$$</div>

where:

<span>${\dot V_{drift,makeup}}$</span> = makeup water usage due to drift (m<sup>3</sup>/s)

<span>${\dot m_{water,design}}$</span> = design (volumetric) water flow rate (m<sup>3</sup>/s)

<span>$PercentWatertoDrift$</span> = percent of design water flow rate lost to drift at the tower design air flow rate

<span>$F{R_{air}}$</span>= ratio of actual air flow rate to tower design air flow rate

Blowdown is water flushed from the basin on a periodic basis to purge the concentration of mineral scale or other contaminants. There are two ways that blowdown is calculated in EnergyPlus.  Blowdown water rates can be scheduled so that we have:.

<div>$$\begin{array}{l}IF\left( {Schedul{e_{blowdown}}\,is\,defined} \right)THEN\\\quad {{\dot V}_{blowdown,makeup}} = ScheduleValu{e_{blowdown}}\\ELSE\\\quad {{\dot V}_{blowdown,makeup}} = 0.0\\ENDIF\end{array}$$</div>

where:

<span>${\dot V_{blowdown,makeup}}$</span> = makeup water usage due to blowdown (m<sup>3</sup>/s)

*ScheduleValue<sub>blowdown</sub>* = blowdown schedule value for the time step being simulated (m<sup>3</sup>/s)

The second (and default) way that blowdown can be calculated is to assume that blowdown water is continually introduced at a rate that will provide a constant concentration ratio.  As water evaporates it leaves behind minerals and the like causing the concentration of water impurities to be higher in the tower than in the makeup water.  Acceptable concentration ratios are in the range of 3 to 5 depending on the purity of the make up water.  Water lost as drift does not evaporate and decrease the water needed for blowdown.  Using the “Concentration Ratio” method, the rate of blowdown can be calculated using:

<div>$${\dot V_{blowdown,makeup}} = \frac{{{{\dot V}_{evaporation,makeup}}}}{{{R_{concentration}} - 1}} - {\dot V_{drift,makeup}}$$</div>

where,

<span>${R_{concentration}}$</span> is the concentration ratio or the ratio of solids in the blowdown water to solids in the makeup water.

The tower makeup water consumption (m<sup>3</sup>) for each simulation time step is calculated as the sum of the individual components of makeup water usage multiplied by the simulation time step in hours and the conversion for hours to seconds (3600 sec/hr). Makeup water usage is only calculated when the cooling tower is active and water is flowing through the cooling tower.

<div>$${V_{water,\;makeup}} = \left( {{{\dot V}_{evaporation,makeup}} + {{\dot V}_{drift,makeup}} + {{\dot V}_{blowdown,makeup}}} \right)\cdot TimeStepSys\cdot 3600.$$</div>

where:

<span>${V_{water,makeup}}$</span> = tower makeup water consumption (m<sup>3</sup>)

#### References

Robert C. Rosaler. 1995. Standard Handbook of Plant Engineering, 2<sup>nd</sup> Ed. McGraw-Hill, New York, NY, pp 6-36-37.

Quereshi, B.A. and S.M.Zubair. 2007. Prediction of evaporation losses in evaporative fluid coolers, Applied Thermal Engineering 27 pp. 520-527



### One and Two Speed Fluid Coolers

#### Overview

The input objects FluidCooler:SingleSpeed and FluidCooler:TwoSpeed provide models for dry fluid coolers. Fluid cooler’s performance is modeled using effectiveness-NTU relationships for cross flow heat exchanger with both streams unmixed. The model can be used to simulate the performance of both single speed and two speed mechanical-draft fluid coolers. For part-load operation, the model assumes a simple linear interpolation between two steady-state regimes without accounting for any cycling losses.

#### Model Description

The expression for fluid cooler effectiveness is as follows:

<div>$$\varepsilon  = 1 - {\mathop{\rm e}\nolimits} \left[ {{\raise0.7ex\hbox{${\{ {{\mathop{\rm e}\nolimits} ^{( - NTU{C_r}\eta )}} - 1\} }$} \!\mathord{\left/ {\vphantom {{\{ {{\mathop{\rm e}\nolimits} ^{( - NTU{C_r}\eta )}} - 1\} } {{C_r}\eta }}}\right.}\!\lower0.7ex\hbox{${{C_r}\eta }$}}} \right]$$</div>

Where

<span>$\varepsilon $</span><span>$\varepsilon $</span>* *= heat exchanger effectiveness

<div>$${C_r} = \frac{{{{\dot C}_{\min }}}}{{{{\dot C}_{\max }}}}$$</div>

<span>${\dot C_a} = {\dot m_a}{c_{pa}}$</span><span>${\dot C_a} = {\dot m_a}{c_{pa}}$</span> and<span>${\dot C_w} = {\dot m_w}{c_{pw}}$</span>

<span>${\dot C_{\max }} = Max({\dot C_a},{\dot C_w})$</span><span>${\dot C_{\max }} = Max({\dot C_a},{\dot C_w})$</span>;<span>${\dot C_{\min }} = Min({\dot C_a},{\dot C_w})$</span>

<div>$$NTU = \frac{{UA}}{{{{\dot C}_{\min }}}}$$</div>

<span>$\eta  = NT{U^{( - 0.22)}}$</span><span>$\eta  = NT{U^{( - 0.22)}}$</span>

The first fluid is water and the second fluid is air entering the heat exchanger at temperature <span>${T_{db,in}}$</span><span>${T_{db,in}}$</span> and specific heat <span>${c_{pa}}$</span><span>${c_{pa}}$</span>. The heat exchanger is characterized by a single parameter, its overall heat transfer coefficient-area product UA.

When the user selects the nominal capacity method, the UA is calculated as follows:

The model inputs (other than the UA) and the fluid cooler load that it must meet are specified at design conditions. Then the fluid cooler model converges to a UA value, using the regulafalsi method that will enable it to meet the design fluid cooler load given at the specified inputs.

#### Method for Calculating Steady-State Exiting Water Temperature

The objective of the fluid cooler model is to predict the exiting water temperature and the fan power required to meet the exiting water setpoint temperature. The exiting water temperature is calculated based on an energy balance that assumes that the energy absorbed by the air is equivalent to the energy removed from the water. The procedure for calculating the steady-state, exiting air dry-bulb temperature is outlined below.

With the overall heat transfer coefficient-area product for the fluid cooler calculated by the nominal capacity information entered by the user, the effectiveness of the heat exchanger is then calculated as:

<div>$$\varepsilon  = 1 - {\mathop{\rm e}\nolimits} \left[ {{\raise0.7ex\hbox{${\{ {{\mathop{\rm e}\nolimits} ^{( - NTU{C_r}\eta )}} - 1\} }$} \!\mathord{\left/ {\vphantom {{\{ {{\mathop{\rm e}\nolimits} ^{( - NTU{C_r}\eta )}} - 1\} } {{C_r}\eta }}}\right.}\!\lower0.7ex\hbox{${{C_r}\eta }$}}} \right]$$</div>

The heat transfer rate is then calculated as follows:

<span>$\dot Q = \varepsilon {\dot C_{\min }}({T_{w,in}} - {T_{db,in}})$</span><span>$\dot Q = \varepsilon {\dot C_{\min }}({T_{w,in}} - {T_{db,in}})$</span>

Then the outlet air dry-bulb and outlet water temperature are calculated:

<div>$${T_{db,out}} = {T_{db,in}} + \frac{{\mathop Q\limits^. }}{{{{\mathop C\limits^. }_a}}}$$</div>

<div>$${T_{w,out}} = {T_{w,in}} - \frac{{\mathop Q\limits^. }}{{{{\mathop C\limits^. }_w}}}$$</div>

<span>${T_{w,in}}$</span>= inlet water temperature, <sup>o</sup>C

<span>${T_{w,out}}$</span>= outlet water temperature, <sup>o</sup>C

<span>${T_{db,in}}$</span> = dry-bulb temperature of the inlet air, <sup>o</sup>C

<span>${T_{db,out}}$</span>= dry-bulb temperature of the outlet air, <sup>o</sup>C

#### Calculating the Actual Exiting Water Temperature and Fan Power

The previous section describes the methodology used for calculating the steady-state temperature of the water leaving the fluid cooler. This methodology is used to calculate the exiting water temperature with the fluid cooler fans operating (including low and high fan speed for the two-speed fluid cooler). The exiting water temperature calculations use the fluid flow rates (water and air) and the Nominal capacity information entered by the user for each regime.

The fluid cooler model seeks to maintain the temperature of the water exiting the fluid cooler at (or below) a setpoint. The setpoint schedule is defined by the field “Loop Temperature Setpoint  Node or reference” for the CondenserLoop object.

The fluid cooler fans are turned on to reduce the exiting water temperature to the setpoint. The model assumes that part-load operation is represented by a simple linear interpolation between two steady-state regimes (e.g., Fluid cooler fans on for the entire simulation time step and fluid cooler fans off for the entire simulation time step). Cyclic losses are not taken into account. If the outlet water temperature is less than the set-point then the fraction of time for which the fluid cooler must operate to meet the set-point is calculated by using the following equation:

<div>$$\omega \,\, = \frac{{{T_{set}} - {T_{wout,off}}}}{{{T_{wout,on}} - {T_{wout,off}}}}$$</div>

Where

<span>${T_{set}}$</span> = exiting water setpoint temperature, <sup>o</sup>C

<span>${T_{wout,off}}$</span> = exiting water temperature with all fluid cooler fans off, <sup>o</sup>C

<span>${T_{wout,on}}$</span> = exiting water temperature with all fluid cooler fans on, <sup>o</sup>C

The average fan power for the simulation time step is calculated by multiplying <span>$\omega \,$</span>by the steady-state fan power specified by the user.

The calculation method for the two-speed fluid cooler is similar to that for the single-speed fluid cooler example described above. The model first calculates the steady-state exiting water temperature with the fluid cooler fans at low speed. If the exiting water temperature at low fan speed is below the setpoint temperature, then the average fan power is calculated based on the result of previous equation and the steady-state, low speed fan power specified by the user.  If low-speed fan operation is unable to reduce the exiting water temperature below the setpoint, then the fluid cooler fans’ speed is increased to high speed and the steady-state exiting water temperature is calculated. If this temperature is below the setpoint, then a modified version of previous equation is used to calculate runtime at high fan speed:

<div>$$\omega \,\, = \frac{{{T_{set}} - {T_{wout,low}}}}{{{T_{wout,high}} - {T_{wout,low}}}}$$</div>

where

<span>${T_{set}}$</span> = exiting water setpoint temperature, <sup>o</sup>C

<span>${T_{wout,low}}$</span> = exiting water temperature with fluid cooler fans at low speed, <sup>o</sup>C

<span>${T_{wout,high}}$</span> = exiting water temperature with fluid cooler fans at high speed, <sup>o</sup>C

The average fan power for the simulation time step is calculated for the two-speed fluid cooler as follows

<div>$${P_{fan,avg}}\, = \,\omega \,({P_{fan,high}})\, + \,\left( {1 - \omega } \right)\left( {{P_{fan,low}}} \right)$$</div>

Demand Controlled Ventilation <a name="DCV"></a>
-----------------------------

ASHRAE Standard 62.1, Ventilation for Acceptable Indoor Air Quality, contains provisions that allow building ventilation systems to vary the amount of outdoor ventilation air delivered to occupied zones based on feedback from sensors that monitor various indoor air contaminants (ASHRAE 2007). Although not a contaminant of concern in most buildings, carbon dioxide (CO<sub>2</sub>) levels can be monitored as an indicator of building occupancy and the associated human bioeffluent concentration. Demand controlled ventilation (DCV) is being increasingly used to modulate outdoor ventilation air based on real-time occupancy (Emmerich and Persily 1997, Schell et al. 1998, Schell and Int-Hout 2001). Modulating the outdoor ventilation air while maintaining proper indoor air quality has the potential for large energy savings compared to constant rate ventilation systems that are typically designed to provide outdoor ventilation air based on maximum anticipated occupancy.

EnergyPlus can model DCV by the ventilation rate procedure (VRP) defined in ASHRAE Standard 62.1-2007/2010 for single and multiple path systems, and the indoor air quality procedure (IAQP) defined in Standard 62. The VRP first calculates the breathing-zone outdoor air flow rate based on two components – the zone occupant component and the zone floor area component, then it calculates the zone supply outdoor air flow rate considering the zone air distribution effectiveness and secondary recirculation (for mult-path systems only), and finally calculates the system outdoor air flow rate considering the zone diversity and system ventilation efficiency. The user must include the following five objects in their input data file in order to model DCV (using VRP or IAQP):

n **AirLoopHVAC:OutdoorAirSystem** to simulate the mixed air box of the air loop

n **Controller:MechanicalVentilation** with the DCV flag set to 'Yes' to determine the minimum outdoor air flow rate to be provided by the mixed air box

n **Controller:OutdoorAir** to control the outside air flow rate introduced via the mixed air box

n **DesignSpecification:OutdoorAir** to describe the outdoor air requirements for each zone

n **DesignSpecification:ZoneAirDistribution** to describe air distribution effectiveness and secondary recirculation (for multi-path ventilation systems) for each zone

The outdoor air system (AirLoopHVAC:OutdoorAirSystem) is a subsystem of an AirLoopHVAC which handles the mixed air portion of the primary air system: the system relief air, the outside air inlet, and any components and controllers associated with the system relief air and outside air streams. The inputs for this object are fully described in the EnergyPlus Input Output Reference. Determining the outdoor air ventilation rate and introducing this ventilation via the mixed air box are accomplished by the mechanical ventilation and outdoor air controller objects.

The VRP currently requires outdoor air ventilation rates to be determined based on the floor area of each occupied zone plus the number of people in each zone. The number of people varies based on the setting of the DCV flag in the Controller:MechanicalVentilation object. For using occupancy at every time step, the DCV flag must be set to 'Yes'. The outdoor air ventilation rate can then be reset dynamically as operating conditions change (e.g., variations in occupancy). The Controller:MechanicalVentilation object simplifies the procedure for calculating these outdoor air ventilation requirements and resetting them based on varying occupancy levels. This is particularly useful for large air distribution systems that serve a number of different zone types with varying occupancy levels.

The IAQP (ASHRAE 2007) is a design procedure in which outdoor air intake and other system design parameters are based on an analysis of contaminant sources, and contaminant concentration targets. Although carbon dioxide is not considered as an indoor contaminant but is considered as an indicator of indoor air quality in buildings, EnergyPlus uses IAQP to control carbon dioxide. In addition, a generic contaminant may be introduced. The current IAQP in EnergyPlus allows credit to be taken for controls that can be reliably demonstrated to result in indoor carbon dioxide and generic contaminant concentrations equal to or lower that those achieved using the VRP. The IAQP may also be used where the design is intended to attain specific target carbon dioxide and generic contaminant levels.

### Ventilation Rate Procedure

#### Calculation of zone minimum outdoor air flow

For the i-th zone, first the breathing-zone outdoor air flow is calculated:

<div>$${V_{bz,i}} = {R_{p,i}} \times {P_i} + {R_{a,i}} \times {A_i}$$</div>

Where:

<span>${V_{bz,i}}$</span>= the breathing-zone outdoor air flow, m³/s

<span>${R_{p,i}}$</span>= the ventilation rate per person, m³/s-person

<span>${P_i}$</span>  = the number of occupants for the zone

<span>${R_{a,i}}$</span>= the ventilation rate per floor area, m³/s-m²

<span>${A_i}$</span>  = the floor area of the zone, m²

<span>$i$</span>    = the index of the zone or zone list

Next, the i-th zone outdoor air flow is calculated:

<div>$${V_{oz,i}} = {V_{bz,i}}/{E_i}$$</div>

Where:

<span>${V_{oz,i}}$</span>= the zone outdoor air flow, m³/s

<span>${E_i}$</span>= the zone air distribution effectiveness, see following figure for ASHRAE recommended values.

![](EngineeringReference/media/image4716.png)

Figure 195. Zone Air Distribution Effectiveness Typical Values (Source: ASHRAE Standard 62.1-2010)

#### Calculation of system minimum outdoor air flow

For single zone systems, the system outdoor air flow,

<div>$${V_{ot}} = {V_{oz}}$$</div>

For 100% outdoor air multi-zone systems, the system outdoor air flow,

<div>$${V_{ot}} = \mathop \sum \limits_{i = 1}^{allzones} {V_{oz,i}}$$</div>

For non 100% outdoor air multi-zone systems, the system outdoor air flow,

<div>$${V_{ot}} = {V_{ou}}/{E_v}$$</div>

Where:

<span>${V_{ou}}$</span> the uncorrected system outdoor air flow, m³/s

<div>$${V_{ou}} = \mathop \sum \limits_{i = 1}^{allzones} ({R_{p,i}} \times {P_i}) + \mathop \sum \limits_{i = 1}^{allzones} ({R_{a,i}} \times {A_i})$$</div>

<span>${X_s}$</span> = the uncorrected system outdoor air fraction

<div>$${X_s} = {V_{ou}}/{V_{ps}}$$</div>

<span>${V_{ps}}$</span>= the system supply air flow, m³/s

<span>${Z_{d,i}}$</span> = the zone outdoor air fraction

<div>$${Z_{d,i}} = {V_{oz,i}}/{V_{dz,i}}$$</div>

<span>${V_{dz,i}}$</span> = the zone supply air flow, m³/s

<span>${E_v}$</span> = the system ventilation efficiency, determined as the minimum of the zone ventilation efficiency among all ventilation zones served by the air handler.

*Ev*= minimum (*Evz*)

*Evz*  = the zone ventilation efficiency, determined differently for single-path and multi-path systems.

***For single-path systems,***

Evz= 1+ Xs– Z<sub>d,i</sub>

***For multi-path systems,***

*Evz =* *(Fa+ Xs·Fb– Z<sub>d,i</sub>·Ep·Fc)/Fa*

where system air fractions *Fa*, *Fb*, and *Fc*are determined as follows

*Fa= Ep+* *(1 – Ep) ·Er*

*Fb= Ep*

*Fc= 1 –* *(1 – Ez) · (1 – Er) · (1 – Ep)*

*Ep   =* the zone primary air fraction. For dual-fan dual-duct systems, the zone primary air is the air from the cold duct.

*Ep= Vpz/Vdz,i*

*Er*   = the zone secondary recirculation fraction

Single-path systems are special cases of multi-path systems where *Er* = 0, *Ep* = 1, *Fa* = *Fb =* *Fc* = 1.0

The zone secondary recirculation fraction Er is determined by the designer based on system configuration. For plenum return systems with secondary recirculation (e.g., fan-powered VAV with plenum return) Er is usually less than 1.0, although values may range from 0.1 to 1.2 depending upon the location of the ventilation zone relative to other zones and the air handler. For ducted return systems with secondary recirculation (e.g., fan-powered VAV with ducted return), Er is typically 0.0, while for those with system-level recirculation (e.g, dual-fan dual-duct systems with ducted return) Er is typically 1.0. For other system types, Er is typically 0.75.

The program then calculates the minimum outdoor air flow fraction based on the information provided in the object Controller:MechanicalVentilation and the maximum branch air flow rate as follows:

MechVentOutsideAirMinFrac = <span>${V_{ot}}$</span> RhoStd / <span>$\dot m{_{maxbranch}}$</span>here:

MechVentOutsideAirMinFrac = outdoor air minimum fraction based on all zones specified in the Controller:MechanicalVentilation object

Controller:OutdoorAir controls the amount of outdoor ventilation air introduced via the mixed air box based on several user inputs. The user can define the minimum outdoor air flow rate as a percentage of the system’s supply air flow rate (e.g., for a variable-air volume system) or a fixed minimum outdoor air flow rate (not as a percentage but a fixed value) (field MinimumLimit). DCV, using the Controller:MechanicalVentilation object in conjunction with the Controller:OutdoorAir object, allows a third option for setting the minimum outdoor air flow. Economizer operation can also be specified to increase the outdoor air flow above the minimum flow rate to provide free cooling when conditions permit (Controller:OutdoorAir, field Economizer Control Type).

EnergyPlus uses the largest outdoor air flow rate calculated by the various methods described above when modeling system performance (as long this rate doesn’t exceed the maximum flow rate specified for the main air loop branch or for the outdoor air controller itself).

The method used to calculate the outdoor ventilation air flow rate for each system simulation time step is described in more detail below. The figure below schematically illustrates air flow paths used in the calculation of outdoor air flow rate.



![](EngineeringReference/media/image4731.png)

Figure 196.  Demand Control Ventilation -- Air Flow Paths

The minimum outdoor air flow rate is first calculated based on the minimum outdoor air flow rate and the minimum outdoor air schedule value as defined by the user inputs for the object Controller:OutdoorAir:

<div>$${\mathop m\limits^ \bullet_{\min OA}} = \,{\mathop V\limits^ \bullet_{\min OA}} * \,\,MinOAScheduleValue * \,RhoStd\,$$</div>

where:

<span>${\mathop m\limits^ \bullet_{_{\min OA}}}$</span>       = minimum outdoor air flow rate for this time step, kg/s

<span>${\mathop V\limits^ \bullet_{_{\min OA}}}$</span>        = minimum outdoor air flow rate defined in Controller:OutdoorAir, m<sup>3</sup>/s

*MinOAScheduleValue* = minimum outdoor air schedule value defined by the schedule identified in Controller:OutdoorAir

*RhoStd*      = standard air density (1.204 kg/m<sup>3</sup>) adjusted for the local barometric pressure (standard barometric pressure corrected for altitude, ASHRAE 1997 HOF pg. 6.1).

The outdoor air minimum fraction is then calculated as the ratio of the minimum outdoor air flow rate calculated above to the maximum air flow rate defined in the Branch statement for the main air loop (converted to mass flow rate).

<div>$$OutAirMinFrac = \left( {{\raise0.7ex\hbox{${{{\mathop m\limits^ \bullet  }_{_{\min OA}}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop m\limits^ \bullet  }_{_{\min OA}}}} {{{\mathop m\limits^ \bullet  }_{_{\max branch}}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop m\limits^ \bullet  }_{_{\max branch}}}}$}}} \right)$$</div>

where:

<span>${\mathop m\limits^ \bullet_{\max branch}}$</span>    = Max branch air volume flow rate times *RhoStd,* kg/s

The program then calculates the minimum outdoor air flow fraction (*MechVentOutsideAirMinFrac*) according to the VRP based on the information provided in the object Controller:MechanicalVentilation and the maximum branch air flow rate.

The algorithm then uses the larger of these outdoor air minimum fractions in subsequent calculations, and also makes sure that the resulting fraction is between 0 and 1.

<div>$$OutAirMinFrac = \,\,MAX\left( {OutAirMinFrac,MechVentOutsideAirMinFrac} \right)$$</div>

<div>$$OutAirMinFrac = \,\,MIN\left( {MAX\left( {OutAirMinFrac,0.0} \right),\,1.0} \right)$$</div>

The algorithm goes on to determine if economizer operation is possible based on the user inputs and the current conditions of the outdoor air and return air. If conditions permit economizer operation, the outdoor air flow fraction is increased beyond the minimum fraction to meet the mixed air setpoint temperature (setpoint temperature assigned to the node defined in field “Control\_Node” of Controller:OutdoorAir).

<div>$$OAFrac = \,MAX\,(OutAirMinFrac,\,EconomizerOAFrac)$$</div>

The mass flow rate of outdoor air is then calculated based on the outdoor air fraction determined above and the mixed (supply) air mass flow rate:

<div>$${\dot m_{OA}} = OAFrac * {\dot m_{MixedAir}}$$</div>

where:

<span>${\dot m_{OA}}$</span>           = mass flow rate of outdoor air, kg/s

<span>$OAFrac$</span>    = fraction of outdoor air in the mixed (supply) air stream

<span>${\mathop m\limits^ \bullet_{MixedAir}}$</span>     = mass flow rate of the mixture of return air and outdoor ventilation air, kg/s

The algorithm checks to make sure the calculated outdoor air mass flow rate is greater than or equal to the air flow rate being exhausted.

<div>$${\dot m_{OA}} = MAX\left( {{{\dot m}_{OA}},{{\dot m}_{ExhaustAir}}} \right)$$</div>

If a fixed minimum outdoor air flow rate is specified (field Minimum Limit Type in Controller:OutdoorAir) for a continuous air flow system, the program makes sure that the outdoor air mass flow rate is greater than or equal to the minimum outdoor air flow rate specified by the user.

<div>$${\dot m_{OA}} = MAX\left( {{{\dot m}_{OA}},{{\dot m}_{\min OA}}} \right)$$</div>

The outdoor air mass flow rate should be less than or equal to the mixed (supply) air flow rate, and the outdoor air flow rate is reset if necessary.

<div>$${\dot m_{OA}} = MIN\left( {{{\dot m}_{OA}},{{\dot m}_{MixedAir}}} \right)$$</div>

The outdoor air mass flow rate should also be less than or equal to the maximum outdoor air flow rate specified by the user, and the outdoor air flow rate is reset if necessary.

<div>$${\dot m_{OA}} = MIN\left( {{{\dot m}_{OA}},{{\dot m}_{MaxOA}}} \right)$$</div>

where:

<span>${\dot m_{MaxOA}}$</span>= maximum outdoor air mass flow rate, kg/s = maximum outdoor air volume flow rate from Controller:OutdoorAir times *RhoStd*

Finally, the relief air flow rate is calculated as the difference between the outside and exhaust air mass flow rates.

<div>$${\dot m_{ReliefAir}} = MAX\left( {{{\dot m}_{OA}} - \,{{\dot m}_{ExhaustAir}}\,,0.0} \right)$$</div>

### Indoor Air Quality Procedure

Like VRP, the user must include the following three objects in their input data file in order to model CO<sub>2</sub>-based DCV with IAQP:

n AirLoopHVAC:OutdoorAirSystem to simulate the mixed air box of the air loop

n Controller:MechanicalVentilation to determine the minimum outside air flow rate to be provided by the mixed air box

n Controller:OutdoorAir to control the outside air flow rate introduced via the mixed air box

The outdoor air mass flow rate provided by the air loop is calculated as below:

<div>$${\dot m_{OA}} = \sum\limits_i^N {{{\dot m}_{OA,z,i}}} $$</div>

where:

<span>${\dot m_{OA,z,i}}$</span>= outdoor air mass flow rate for the ith zone as calculated according to section Carbon Dioxide Prediction located elsewhere in this document.

N = number of zones served by the air loop, which is provided in the input for a Controller:MechanicalVentilation object

### Proportional Control

Like Ventilation Rate Procedure and the Indoor Air Quality Procedure, the following three objects must be included in the input data file in order to model CO<sub>2</sub>-based DCV with Proportional Control:

n **AirLoopHVAC:OutdoorAirSystem** to simulate the mixed air box of the air loop

n **Controller:MechanicalVentilation** to determine the minimum outside air flow rate to be provided by the mixed air box

n **Controller:OutdoorAir** to control the outside air flow rate introduced via the mixed air box

For the i-th zone, the outdoor air mass flow rate provided by the air loop is calculated as below:

1)   The required intake flow of outdoor air for the design zone population, *P<sub>z,i</sub>*

<div>$${V_{ot - design,i}} = \frac{{\left( {{R_{p,i}}.{P_{z,i}}} \right) + ({R_{a,i}}.{A_{z,i}})}}{{{E_i}}}$$</div>

2)   The required intake flow of outdoor air when the zone is unoccupied i.e.  *P<sub>z,i</sub>* = 0

<div>$${V_{ot - min,i}} = \frac{{({R_{a,i}}.{A_{z,i}})}}{{{E_i}}}$$</div>

3)   The target indoor CO<sub>2</sub> concentration at <span>${V_{ot - design,i}}$</span>

<div>$${C_{s - design,i}} = {C_o} + \frac{N}{{\left( {{V_{ot - design,i}}/{P_{z,i}}} \right)}}$$</div>

4)   The target indoor CO<sub>2</sub> concentration at <span>${V_{ot - min}}$</span> is either a user input in the object ZoneControl:ContaminantController or equal to the outdoor CO<sub>2</sub> concentration. The default is outdoor CO<sub>2</sub> concentration.

<div>$${C_{s - min,i}} = {C_o}$$</div>

When the indoor CO<sub>2</sub> concentration equals <span>${C_{s - design,i}}$</span>, <span>${V_{ot}}$</span> should equal <span>${V_{ot - design,i}}$</span>. When the indoor CO<sub>2</sub> concentration equals <span>${C_{s - min,i}}$</span>, <span>${V_{ot}}$</span> should equal <span>${V_{ot - min,i}}$</span>. When the indoor CO<sub>2</sub> concentration is between <span>${C_{s - min,i}}$</span> and <span>${C_{s - design,i}}$</span>, a controller should adjust outdoor air intake flow <span>${V_{ot}}$</span> proportionally between <span>${V_{ot - min,i}}$</span> and <span>${V_{ot - design,i}}$</span>:

<div>$${V_{ot,i}} = {V_{ot - min,i}} + ({V_{ot - design,i}} - {V_{ot - min,i}})\frac{{({C_{s - actual,i}} - {C_{s - min,i}})}}{{({C_{s - design,i}} - {C_{s - min,i}})}}$$</div>

Where,

<span>${R_{p,i}}$</span> = Required outdoor air flow rate per person, (m<sup>3</sup>/s)/person

<span>${R_{a,i}}$</span> = Required outdoor air flow rate per unit area, (m<sup>3</sup>/s)/m<sup>2</sup>

<span>${P_{z,i}}$</span> = Design zone population, number of people

<span>${A_{z,i}}$</span> = Zone floor area, m<sup>2</sup>

<span>${E_i}$</span> = The zone air distribution effectiveness

<span>$N$</span> = CO<sub>2</sub> generation rate, (m<sup>3</sup>/s)/person (Specified in the People object)

<span>${C_o}$</span> = CO<sub>2</sub> concentration in the outdoor air, ppm

<span>${C_{s - design,i}}$</span> = CO<sub>2</sub> concentration in the space for the design conditions, ppm

<span>${C_{s - min,i}}$</span> = Minimum CO<sub>2</sub> concentration in the space, ppm

<span>${C_{s - actual,i}}$</span> = Actual CO<sub>2</sub> concentration in the space, ppm

<span>${V_{ot - design,i}}$</span> = Required intake of outdoor air flow rate at <span>${C_{s - design}}$</span>, (m<sup>3</sup>/s)

<span>${V_{ot - min,i}}$</span> = Required intake of outdoor air flow rate at <span>${C_{s - min}}$</span>, (m<sup>3</sup>/s)

<span>${V_{ot,i}}$</span> = Required intake of outdoor air flow rate at <span>${C_{s - actual}}$</span>, (m<sup>3</sup>/s)

Except <span>${C_{s - min,i}}$</span> above, all other variables are already available in EnergyPlus (See Eng. Reference for “Ventilation Rate Procedure” above for further details). <span>${C_{s - min}}$</span> can be specified in the ZoneControl:ContaminantController object as a schedule. If  <span>${C_{s - min}}$</span> is not specified in the ZoneControl:ContaminantController object, then outdoor air CO2 concentration will be used as the minimum. In order for “ProportionalControl” to be active, the following conditions must be met, otherwise default “VentilationProcedure” will be modeled and a warning will be issued during runtime:

1)   “Carbon Dioxide Control Availability Schedule Name” input field in the ZoneControl:ContaminantController object must be greater than zero.

2)   CO2 gain from people in the zone must be greater than zero.

3)   “Outdoor air flow per person” and “Outdoor air flow per zone floor area” in the corresponding “DesignSpecification:OutdoorAir” object must be greater than zero.

### References

ASHRAE. 2007. *ANSI/ASHRAE Standard 62.1-2007, Ventilation for acceptable indoor air quality*. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2010. *ANSI/ASHRAE Standard 62.1-2010, Ventilation for acceptable indoor air quality*. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Emmerich, S.J. and A.K. Persily. 1997. Literature review on CO<sub>2</sub>-based demand-controlled ventilation. *ASHRAE Transactions* 103(2):229-243.

Schell, M.B., S.C. Turner, R.O. Shim. 1998. Application of CO<sub>2</sub>-based demand controlled ventilation using ASHRAE Standard 62-1989. *ASHRAE Transactions* 104(2):1213-1225.

Schell, M. and D. Int-Hout. 2001. Demand control ventilation using CO<sub>2</sub>. *ASHRAE Journal*, February.

Evaporative Coolers <a name="EvapCoolers"></a>
-------------------

This section describes the evaporative coolers models for HVAC in EnergyPlus.

### Direct Evaporative Cooler

The input object EvaporativeCooler:Direct:CelDekPad provides a model of a direct stage evaporative cooler, shown in the figure below, that consists of a rigid media evaporative pad, with water recirculated from a reservoir.  The water is pumped from the reservoir to a water distribution header, for water feed by gravity from above the media.  The evaporative pad provides the area for the adiabatic saturation of the air.  While the process provides a lower dry-bulb temperature, the moisture content of the leaving air is higher than the entering condition.  The direct stage is used for comfort cooling in a building where adding humidity to the air can be tolerated.

![](EngineeringReference/media/image4789.png)

Figure 197.  Direct Stage Evaporative Cooler

The thermodynamic process is a simultaneous heat and mass transfer, or adiabatic cooling, and follows a constant enthalpy line on the psychrometric chart; it is shown in the figure below as a process from A to B.  Since the deviation of the constant wet-bulb line and the constant enthalpy line is small, it is assumed that the wet-bulb temperature is constant across the direct evaporative stage.

![](EngineeringReference/media/image4790.png)

Figure 198.  Psychrometric Chart -- Constant Enthalpy

If the direct evaporative process were 100% efficient, the leaving dry-bulb temperature would equal the entering wet-bulb temperature.  The efficiency of the direct evaporative process is less than 100% and by defining saturation efficiency (ese) for the direct stage or evaporative pad, the leaving dry-bulb temperature can be expressed by the following equation.

<div>$${T_{dbsupout}} - {T_{dbsupin}} = {\varepsilon_{se}} \cdot \left( {{T_{odb}} - {T_{owb}}} \right)$$</div>

#### Saturation Efficiency

Since the evaporative process is not 100% efficient the saturation efficiency is defined by.

<div>$${\varepsilon_{se}} = \frac{{{T_{dbsupin}} - {T_{dbsupout}}}}{{{T_{odb}} - {T_{owb}}}}$$</div>

The saturation efficiency is determined from manufacturer's data, and the least squares curve fit is discussed in Curve Fitting Evaporative Media section.

Using the saturation efficiency (ese) for the direct stage evaporative pad, the leaving dry-bulb temperature can be determined directly.  The evaporative process approximately follows a constant wet-bulb line.  Therefore, with the leaving dry-bulb temperature and assuming adiabatic heat transfer across the direct stage, the outlet conditions for the direct stage are known.

The saturation efficiency of the direct evaporative cooler is a function of the pad geometry and airflow rate.  The pad geometry is constant throughout the simulation, but the airflow rate can change from hour to hour when the evaporative cooler is used with an air economizer.  The saturation efficiency would then be determined from the flow for that hour with the geometry of the direct evaporative cooler.  This gives the dry-bulb temperature leaving the evaporative cooler.  Assuming adiabatic heat transfer across the direct stage, the evaporative process follows the constant wet-bulb line or the constant enthalpy line on the psychrometric chart, therefore the wet-bulb temperature is constant from inlet to outlet.

Some things that can cause departure from the ideal adiabatic saturation process in the direct evaporative cooler are:

·        makeup water entering the sump,

·        friction from water re-circulation,

·        heat transfer from surroundings,

·        solar radiation (sun upon a cooler).

Thus, adiabatic saturation in evaporative cooling is only an approximation, however the adiabatic saturation assumption in the rigid-media cooler is good, since the water recirculates rapidly and approximates the wet-bulb temperature at steady state operation.

#### Curve Fitting Evaporative Media

The saturation efficiency is usually reported as a function of airflow, pad face velocity, and pad thickness.  The Figure below shows a typical graph of manufacturer's data for the saturation efficiency.  A multi-variate least squares curve fit of the data was used to generate saturation efficiency functions for the evaporative models that use the CelDek rigid media pad.

![](EngineeringReference/media/image4793.png)

Figure 199.  Graph of Saturation Efficiency

The curve fit for saturation efficiency was obtained using the functions listed below.  The model uses the air velocity (Airvel) through the pad and the depth of the media (Depth).  The least squares routine produced the following model that is used for the evaporative cooling rigid media pad.  The least squares routine produced an eleven-term multi-variate fit using a third order quadratic.

ese = 0.792714 + 0.958569 (Depth) - 0.25193 (Airvel) - 1.03215 (Depth<sup>2</sup>) + 0.0262659 (Airvel<sup>2</sup>) + 0.914869 (Depth \* Airvel) - 1.48241 (Airvel \* Depth<sup>2</sup>) - 0.018992 (Airvel<sup>3</sup> \* Depth) + 1.13137 (Depth<sup>3</sup> \* Airvel) + 0.0327622 (Airvel<sup>3</sup> \* Depth<sup>2</sup>) - 0.145384 (Depth<sup>3</sup> \* Airvel<sup>2</sup>)

Where Airvel is in meters per second and Depth is in meters.  This curve fit is used for the rigid media in the EvapCooler:Direct:CelDekPad and EvapCooler:InDirect:CelDekPad.

### Dry Coil Indirect Evaporative Cooler

The input object EvaporativeCooler:Indirect:CelDekPad provides a model of a dry coil indirect evaporative cooler, shown in the figure below, that has a rigid media pad, similar to the direct evaporative stage, where the adiabatic cooling takes place.  The secondary air leaves the rigid media pad and enters an air-to-air heat exchanger where it cools the supply air flowing through the heat exchanger tubes.  The moist secondary air is then exhausted to the environment.  The secondary air stream has its own fan and includes consists of a rigid media evaporative pad, with water recirculated from a reservoir.  The water is pumped from the reservoir to a water distribution header, for water feed by gravity from above the media.  The evaporative pad provides the area for the adiabatic saturation of the air.

![](EngineeringReference/media/image4794.png)

Figure 200.  Evaporative Cooler -- Indirect Dry Coil

The process that the secondary air goes through, A to C to D, is shown by the dashed lines in  the following figure.  Process A to C is adiabatic cooling in the rigid media pad.  Then the air enters the shell side of the heat exchanger and is sensibly heated from C to D by the warm supply air passing through the tube side.

![](EngineeringReference/media/image4795.png)

Figure 201.  Secondary Air Process -- Indirect Dry Coil Evap Cooler

The advantage of the dry coil heat exchanger is that the heat exchanger does not have the evaporation taking place on the outside of the tubes, thus no mineral deposits are left on the heat exchange surface to reduce the efficiency of the heat exchanger.  The rigid media pads are designed to flush the mineral deposits to the sump, so the saturation efficiency of the pad stays relatively constant.

The following equations are used to determine the dry-bulb temperature leaving the evaporative media, given pad geometry and secondary airflow information.  The heat transfer in the heat exchanger can be determined with the effectiveness of the heat exchanger according.

Tdb sup out = Tdb sup in - ese\*(Todb - Towb )

QHx = eHx \* Min( CFMsec , CFMsupply) \* rair \* cp air \* ( Todb - Tdb sec out)

After the heat transfer for the heat exchanger has been determined, an energy balance is done on the supply airside to determine the dry-bulb temperature leaving the indirect evaporative cooler.  This assumes all the energy for is provided by the primary air stream so the effectiveness value includes the air-to-air effectiveness of the heat exchanger.

Tdb sup out =  Tdb sup in   -  <span>$\frac{{{Q_{Hx}}}}{{{r_{air}}*{c_{pair}}*CF{M_{\sup ply}}}}$</span>

The wet-bulb temperature is determined from psychrometric routines using the leaving dry-bulb temperature, humidity ratio, and barometric pressure, since humidity ratio is constant for the supply air across the indirect stage.  The effectiveness of the heat exchanger is determined from a parameter estimation using manufacturer's performance data.  For the indirect evaporative cooler it was found that a value of 0.67 represented reasonable default effectiveness.

### Wet Coil Indirect Evaporative Cooler

The input object EvaporativeCooler:Indirect:WetCoil provides a model for a wetted coil evaporative cooler, shown in the figure below, that has water sprayed directly on the tubes of the heat exchanger where latent cooling takes place.  The vaporization of the water on the outside of the heat exchanger tubes allows the simultaneous heat and mass transfer which removes heat from the supply air on the tube side.  Then the moist secondary air is exhausted.  The secondary air stream has its own fan.



![](EngineeringReference/media/image4797.png)

Figure 202.  Wet Coil Indirect Evaporative Cooler

The process that the secondary air goes through, A to C on the following figure, is a path of simultaneous heat and mass transfer, but it does not follow a line of constant enthalpy as in the direct stage.  The process is not adiabatic due to the heat gain from the supply air flowing through the tubes of the heat exchanger.

![](EngineeringReference/media/image4798.png)

Figure 203.  Secondary Air Process – Indirect Wet Coil Evaporative Cooler

The wet coil heat exchanger can have a higher stage efficiency than the dry coil due to a higher heat transfer rate on the outside of the heat exchanger tubes.  Over the operating lifetime of the heat exchanger, the vaporization taking place on the heat exchange surface can leave mineral deposits that will decrease the effectiveness of the heat exchanger.

#### Efficiencies of the Indirect Stage

In an indirect stage of an evaporative cooler, the secondary or wet side air stream acts as a heat sink for the supply air.  The efficiency of the indirect stage is given as the effectiveness of the sensible heat exchange, eHx, and the saturation efficiency on the wet streamside, ese.  These are expressed as:

eHx = <span>$\frac{q}{{{q_{max}}}}$</span>=  <span>$\frac{{{C_{sup}}({T_{supin}} - {T_{supout}})}}{{{C_{min}}({T_{secin}} - {T_{secout}})}}$</span>,

ese =  <span>$\frac{{{T_{dbsecin}} - {T_{dbsecout}}}}{{{T_{odb}} - {T_{owb}}}}$</span>,

where Tdb sup in = Tdb sec in  for the indirect cooler.  The maximum heat transfer possible would be obtained if the supply stream was cooled all the way to the wet-bulb temperature.  So the efficiency of the indirect evaporative cooler is defined by:

eind =  <span>$\frac{{({T_{dbsupin}} - {T_{dbsupout}})}}{{({T_{odb}} - {T_{owb}})}}$</span>.

Using the combination of the effectiveness and saturation efficiency, the total efficiency of the indirect stage can be expressed by:

eind = eHx  ese  <span>$\frac{{{C_{sup}}}}{{{C_{min}}}}$</span>.

In many cases Csup = Cmin and the efficiency of the indirect stage reduces to:

eind = eHx  ese.

An intuitive model determining the performance of the wet coil indirect model was developed.  This model can be used for all indirect models by curve fitting data from the evaporative cooler of interest.  The model development starts with the total efficiency of the indirect evaporative cooler:

eind =  <span>$\frac{{({T_{dbsupin}} - {T_{dbsupout}})}}{{({T_{odb}} - {T_{owb}})}}$</span>

Solving for T db sup out gives the leaving conditions of the supply air at a constant humidity ratio:

T db sup out = Tdb sup in - eind \* (Todb - Towb)

A form for the efficiency of the indirect stage was devised using a maximum efficiency with a coefficient to reduce the efficiency depending on the ratio of the airflows.

eind = emax - C1 \* (<span>$\frac{{CF{M_{sup}}}}{{CF{M_{sec}}}}$</span>)

C1 is the "Flow Efficiency Ratio" and is determined from performance data.

A check of limits will verify that it makes physical sense.  As the magnitude of the secondary flow increases, the second term of equation above becomes smaller.  This would make the efficiency tend to go to the maximum efficiency.  Physically this would be true since the convective terms for heat and mass transfer would increase on the outside of the tube with the additional mass flow rate.  Similarly, if the supply air flow goes to zero with a constant secondary air flow, the second term of the equation above again becomes small, and the overall efficiency of the stage would approach the maximum.  The constant C1 tells how quickly the efficiency of the stage would decrease with a mismatch of the supply and secondary flows.

The maximum efficiency of the stage is a combination of the efficiency due to the simultaneous heat and mass transfer on the outside of the tube and the efficiency of the heat exchanger.  This value can be higher than the dry coil overall efficiency since the convective coefficients on the outside of the tube are larger.  For example, a least squares fit for the maximum efficiency showed this value was approximately 0.8 compared to the dry coil indirect value of approximately 0.65 (0.67 \* 0.97).  (The maximum efficiency for the dry coil indirect was determined at the condition where flow through the evaporative pad in the secondary air stream approached zero, for a 12-inch thick pad.)  It should be noted again that over the operating life of the wet coil heat exchanger, the mineral deposits that are left can decrease the effectiveness of the heat exchanger unless appropriate maintenance has taken place.  Therefore, if modeling an older system, the manufacturer’s data may no longer describe the equipment effectiveness.

### Two Stage Direct/Indirect Evaporative Cooler

A two stage cooler can be modeled by combining either a wet coil or the dry coil indirect evaporative cooler staged with a direct evaporative cooler.  The figure below shows a dry coil indirect evaporative cooler with a direct evaporative cooler.  This configuration is mainly used for total comfort cooling for a building and would not normally be used as a pre-cooler for a refrigeration coil, since the direct stage would increase the latent load on a refrigeration coil.

![](EngineeringReference/media/image4806.png)

Figure 204.  Two Stage Evaporative Cooler

The thermodynamic process for the supply air is shown below, going from A to B to C.  The process from A to B is sensible cooling in the indirect stage.  The process from B to C is simultaneous heat and mass transfer following a constant enthalpy line.  The air leaving the final stage has a lower dry-bulb and wet-bulb temperature, and an increase in moisture from the direct stage.

![](EngineeringReference/media/image4807.png)

Figure 205.  Thermodynamic Process for Supply Air Through Two Stage Evaporative Cooler

Two stage evaporative coolers can be accomplished by putting the EvaporativeCooler:Direct:CelDekPad, EvaporativeCooler:Indirect:CelDekPad, EvaporativeCooler:Indirect:WetCoil in series in any combination the user desires in the supply air loop.

### Indirect Evaporative Cooler Special Research Model

This section summarizes the model implemented in the component EvaporativeCooler:Indirect:ResearchSpecial.  Examples of this evaporative cooler are shown in the following figures, without and with a relief valve. This model differs from the other indirect evaporative coolers in that, under part load conditions, it can modulate so that the air leaving the cooler just meets a drybulb temperature setpoint.

The indirect research special evaporative cooler (IEC) machine provides improved modeling features needed for data center and other hybrid cooling applications.  The new model includes performance curves for variable effectiveness, fan power, and pump power.  It is intended to be able to model IEC machines that have 1) variable speed secondary fans, 2) variable speed pumps for water recirculation and spraying, and 3) ability to operate in a dry mode.  Such IEC machines can modulate the cooling power during operation by varying either the secondary side fan speed or the intensity of water spray or both.  To simplify the model it is assumed that the device’s internal controls are such that, when it is operating as a “Wet” evaporative cooler, secondary fan and spray pump operation are linked together so that there is a one-to-one mapping between them at any given part load situation.  This allows formulating the fan and pump power performance curves to be based on the same independent variable, secondary air flow fraction.

![figure 166 renamed](EngineeringReference/media/image4808.png)

Figure 206. Research Special Indirect Evaporative Cooler

#### Model Formulation

Each time the model is called it takes the inputs on the left and produces the outputs on the right as shown in [Figure](#IndEvapCoolerFig2). “sys” is primary air stream and typically sits on an AirLoop HVAC branch. “sec” is secondary purge air stream and is typically outdoor air.  The model will set node flow rates and “out_sec” state variables on the secondary outlet. 

![](EngineeringReference/media/image8005.png)

Figure: Illustration of Inputs-Outputs of Indirect Evaporative Cooler Research Special <a name="IndEvapCoolerFig2"></a>

The model runs either in dry mode or wet mode depending entering air conditions of the primary and secondary air sides. Different effectiveness values are used depending on the operating modes.

#### Wet Mode Operation

If running “wet,” use wet bulb effectiveness and wet bulb temperature depression for delta T:

<div>$$  \begin{array}{rl}
  \epsilon_{wb,op} &= \epsilon_{wb,design}\cdot f_{wb,mod}\left(\text{flowRatio}\right) \\
  \text{flowRatio} &= \frac{\dot{m}_{sec}}{\dot{m}_{sys}}
\end{array}$$</div>

Where:

* <span>$\epsilon_{wb,op}$</span> = current operation effectiveness with respect to wet bulb temperature depression.

* <span>$\epsilon_{wb,design}$</span> = user input for effectiveness at design air flow rates and full spray power

* <span>$f_{wb,mod}$</span> = normalized wet mode operation effectiveness modifier performance curve as a function of flow fraction. The curve value describes how effectiveness varies at different flow rates.  When conditions are appropriate, this curve is numerically inverted to find a FlowRatio that just meets a setpoint. 

* <span>$\dot{m}_{sys}$</span> = primary air current time step mass flow rate in kg/s

* <span>$\dot{m}_{sec}$</span> = secondary air current time step mass flow rate in kg/s

The leaving primary air dry bulb temperature in wet operating mode is calculated as follows:

<div>$$ T_{db,out,sys} = T_{db,in,sys} - \epsilon_{wb,op} \left( T_{db,in,sys} - T_{wb,in,sec} \right) $$ </div>

Then check that there is sufficient heat capacitance flux (mcT) in the secondary air stream to provide the conditioning.  The following steps are for checking and adjusting for non-physical outcomes that could happen with low secondary flow rates.

1. Calculate heat transfer rate

The secondary air entering wet-bulb temperature would be the loswest limit allowed, although this temperature cannot be attained in most practical situations.  This is checked as a limiting case.

<div>$$
  \begin{array}{rl}
    T_{db,out,sys} &= \max\left(T_{db,out,sys},T_{db,out,setpoint}\right) \\
    \dot{Q}_{HX} &= \left(\dot{m}c_p\right)_{sys,in} \cdot \left(T_{db,in,sys}-T_{db,out,sys}\right)
  \end{array}
$$</div>

2. Calculate outlet enthalpy of the secondary air

<div>$$
  \text{enahalpy}_{out,sec} = \text{enthalpy}_{in,sec} + \frac{\dot{Q}_{HX}}{\dot{m}_{sec}}
$$</div>

One approximation that can be made is the outlet condition of the temperature and humidity ratio combination that produces the outlet enthalpy of the secondary air calculated above.  A conservative approach is that the secondary air leaves with water added at such a rate that it results in the secondary air to leave at the same dry bulb temperature and all the total heat transfer results in humidity ratio increases, i.e., latent heat transfer. Following this assumption the secondary air outlet humidity ratio can be calculated in step 3. 

3. Calculate outlet humidity ratio of the secondary air

<div>$$
  \begin{array}{rl}
    T_{db,out,sec} &= T_{db,in,sec} \\
    \text{HumRat}_{out,sec} &= \text{PsyWFnTbH}\left(T_{db,out,sec},\text{enthalpy}_{out,sec}\right) \\
    \dot{V}_{water} &= \frac{QHX / \left[ \left(\text{HumRat}_{out,sec}-\text{HumRat}_{in,sec}\right) \cdot h_{fg,in,sec}\right]}{\rho_{water,Tdb,in,sec}} \\
    or &= \\
    \dot{V}_{water} &= \frac{QHX / \left[ \left(\text{enthalpy}_{out,sec}-\text{enthalpy}_{in,sec}\right) \right]}{\rho_{water,Tdb,in,sec}}
  \end{array}
$$</div>

Dry Operation Mode

Similarly, if running “dry” use dry bulb effectiveness and dry bulb based delta T

<div>$$ \epsilon_{db,op} = \epsilon_{db,design} \cdot f_{db,mod}\left(\text{flowRatio}\right) $$</div>

Where:

* <span>$ \epsilon_{db,op} $</span> = current operation effectiveness with respect to dry bulb temperature depression.

* <span>$ \epsilon_{db,design} $</span> = user input for effectiveness at design air flow rates and dry operation mode (no water spray on the secondary air side)

* <span>$ f_{db,mod} $</span> = normalized dry mode operation effectiveness modifier performance curve as a function of flow fraction.  The curve value describes how the dry mode effectiveness varies with different flow rates.  When conditions are appropriate, this curve is numerically inverted to find a FlowRatio that just meets a setpoint 

The leaving primary air dry bulb temperature in dry operating mode is calculated as follows:

<div>$$T_{db,out,sys} = T_{db,in,sys} - \epsilon{db,op}\left(T_{db,in,sys}-T_{db,in,sec}\right)$$</div>

Then check that there is sufficient heat capacitance flux (mcT) in the secondary air stream to provide the conditioning.  For dry operation, it should be sufficient to simply use inlet moist air properties for density and specific heat.  The following steps are for checking and adjusting for non-physical outcomes that could happen with low secondary flow rates.

1. Calculate heat transfer

<div>$$ \dot{Q}_{HX} = \left(\dot{m}c_{p}\right)_{sys,in} \left(T_{db,in,sys}-T_{db,out,sys}c\right) $$</div>

2. Calculate secondary/scavenger leaving dry-bulb

<div>$$ T_{db,out,sec} = T_{db,in,sec} + \frac{\dot{Q}_{HX}}{ \left(\dot{m}c_{p}\right)_{sys,in}} $$</div>

3. Check for energy imbalance and adjust if need

<div>$$ \text{IF} \left(T_{db,out,sec}>T_{db,in,sys}\right) \text{THEN} T_{db,out,sec} = T_{db,in,sys}-0.2 C $$</div>

4. Recalculate heat transfer limit if imbalance found in step 3 using new secondary outlet drybulb

<div>$$ \dot{Q}_{HX,lim} = \left(\dot{m}c_{p}\right)_{sec,in}\cdot \left( T_{db,out,sec}-T_{db,in,sec} \right) $$</div>

5. Recalculate leaving supply air dryblub using new heat transfer rate from step 4

<div>$$ T_{db,out,sys} = T_{db,in,sec} + \frac{\dot{Q}_{HX}}{ \left(\dot{m}c_{p}\right)_{sys,in}} $$</div>

The IEC in dry and wet operating mode transfers no moisture to the primary system air, so the humidity ratio remains the same:

<div>$$\text{HumRat}_{out,sys} = \text{HumRat}_{in,sys}$$</div>

#### Secondary Air Flow Fraction

The secondary air mass flow rate will either be set to <span>$\dot{m}_{sec}$</span> or solved for numerically as described below. The secondary side flow fraction, <span>$ff_{sec}$</span>, is defined as.  (Note this is another flow ratio that differs from the one used above which combined both streams into one ratio in effectiveness modifier curves.)  

<div>$$ff_{sec} = \frac{\dot{m}_{sec}}{\dot{m}_{sec,design}}$$</div>

The secondary air mass flow rate will either be set to  or solved for numerically as described below. The secondary side flow fraction, , is defined as.  (Note this is another flow ratio that differs from the one used above which combined both streams into one ratio in effectiveness modifier curves.)  

<div>$$P_{sec,fan} = P_{sec,fan,design}\cdot f_{sec,fan,mod}\left(ff_{sec}\right) $$</div>

Where:

<span>$ P_{sec,fan} $</span> = secondary air fan electric power value at current secondary air flow rate in W.

<span>$ P_{sec,fan,design} $</span> = secondary air fan electric power value at design air flow rate in W.

<span>$ f_{sec,fan,mod} $</span> = secondary air fan power modifier normalized performance curve as a function of secondary air flow fraction.

<span>$ \dot{m}_{sec,design} $</span> = secondary air design mass flow rate in kg/s

Recirculation and spray pump electric power is calculated using design pump electric power and a normalized pump power modifier performance curve that describes how power varies as a function of the secondary air flow fraction is given by:

<div>$$P_{pump} = P_{pump,design}\cdot f_{pump,mod}\left(ff_{sec}\right) $$</div>

Where:

<span>$ P_{pump} $</span> = recirculation and spray pump power value at current operation in W.

<span>$ P_{pump,design} $</span> = recirculation and spray pump power value at design air flow rate in W.

<span>$ f_{pump,mod} $</span> = recirculation and spray pump power modifier normalized performance curve as a function of secondary air flow fraction.

User specified three operating temperature limits are included in the model.  These allow controlling when operation should shift from wet to dry and when the cooler should just be shut down because the outdoor conditions are too warm or too wet to do anything beneficial. 

<span>$ T_{db,evapMinLimit} $</span> = Evaporative Operation Minimum Limit Outdoor Drybulb Temperature, user input.  Shut down wet mode with outdoor temperature is lower than this limit, typically shifting to dry mode.  

<span>$ T_{wb,evapMaxLimit} $</span> = Evaporative Operation Maximum Limit Outdoor Wetbulb Temperature, user input.  Shut down fan and pump and don’t operate when outdoor Wetbulb is higher than this limit.  The wet bulb is maybe warmer than the return air and attempting evaporative cooling is wasteful. 

<span>$ T_{db,evapMaxLimit} $</span> = Dry Operation Maximum Limit Outdoor Drybulb Temperature, user input.  Shut down dry operation attempts and don’t operate secondary fan when outdoor dry bulb is higher than this limit.  The dry bulb is maybe warmer than the return air and attempting to do heat exchange is wasteful. 

Algorithm to determine cooler operation proceeds as follows

1. Retrieve leaving setpoint, <span>$T_{db,out,setpoint}$</span>

2. Calculate leaving dry bulb for max cooling power available at full secondary air flow rate for dry operation, <span>$T_{db,out,sys,dry,min}$</span>

3. Check if dry operation limit (input field called Evaporative Operation Minimum Limit Outdoor Dry-Bulb Temperature) reached, <span>$T_{db,in,sec}<T_{db,evapMinLimit}$</span>

4. If dry limit not exceeded, then leaving dry bulb for max cooling power available at full secondary air flow rate for wet operation, <span>$T_{db,out,sys,wet,min}$</span>

5. Compare setpoint temperature needed to temperatures available, evaluate limits and choose which case for operation is called for. The following table outlines the five cases in order of increasing cooling power.

INSERT TABLE

“Modulated” cases solve for a secondary flow rate using numerical method, such as regula falsi.  Residual is formulated by a difference between the dry bulb temperature leaving the cooler and the setpoint.  As the solver progress it varies flow rate on the secondary side until the setpoint is met.  For each iteration, a new effectiveness is calculated as a function of Flow Ratio.  The new flow is used for the <span>$\left(\dot{m}c_{p}\right)_{min}$</span> term and the new effectiveness is used to calculate a result for leaving drybulb.  The numerical method is the same for dry and wet operation, only the functions will use different curves and state variables to describe performance. The regula falsi solver can vary secondary flow rate, <span>$\dot{V}_{sec}$</span>, to drive the following residual to zero:

<div>$$\text{residual} = T_{db,out,sys} - T_{db,out,setpoint}$$</div> 

“Dry or Wet Op Modulated” is the most complex situation.  There is an overlap and the cooler could deliver the setpoint air using either dry operation or wet operation.  The model proceeds separately to calculate both wet and dry operation, with separate numerical solvers for modulation in each mode.  Then the fan and pump power is calculated for each mode.  Select the lowest power mode as the preferred choice.  (This doesn’t really count the value of water, could bring in a source factor but …). Discard results for the unused mode. 

The purge air, or secondary airside, is the stream that evaporates water and indirectly cools the primary, or system air.  The result from Equation is then compared to a lower bound, <span>${T_{db,out,bound}}$</span>, determined from the dewpoint of the incoming purge air using Equation .

<div>$${T_{db,out,bound}} = {T_{db,in,sys}} - \beta ({T_{db,in,sys}} - {T_{dew,in,purge}})$$</div>

where,

<span>${T_{dew,in,purge}}$</span>  is the dewpoint of purge air entering the wet side of cooler [ºC]

<span>$\beta $</span>              is a factor for how close to dewpoint is possible (eg. 0.9)

The final result (for PLF = 1) is the larger of the results from Equations and .

The indirect cooler has the ability to overcool the air and therefore needs some form of modulation.  A Part Load Fraction, PLF, is used to model the implications of controlling the amount of cooling.  It is assumed that through on/off cycling that the cooling power can be varied to exactly meet the desired temperature when PLF is less than unity.

<div>$${\dot Q_{Full}} = \dot m\left( {{h_{out,sys}} - {h_{in,sys}}} \right)$$</div>

<div>$${\dot Q_{{\mathop{\rm Re}\nolimits} quired}} = \dot m\left( {{h_{out,desired}} - {h_{in,sys}}} \right)$$</div>

<div>$$PLF = \frac{{{{\dot Q}_{{\mathop{\rm Re}\nolimits} quired}}}}{{{{\dot Q}_{Full}}}}$$</div>

where,

<span>$PLF$</span>                     is the Part Load Fraction

When PLF is less than 1.0 it is assumed that the cooler will deliver the desired temperature air (as long as it is less than the inlet; it doesn’t need heating).  The PLF is used to modify the auxiliary fan power when the fan power modifier curve is not specified and find when the unit will overcool.

<div>$${P_{fan}} = \Delta P\cdot \dot V\cdot e\cdot PLF$$</div>

Water pump power is also derated using the PLF.

A third air stream input to the cooler was implemented in order to allow mixing building exhaust air with outdoor air on the purge/secondary side of the cooler. The assumption when relief/tertiary air is used is that all of the available relief zone air is used and the remainder made up with outdoor air.  Moisture and energy balances are drawn to compute humidity ratio and enthalpy of mixed secondary air.  The volume is determined by the design volume flow rate (from secondary fan size).

#### Water Consumption

Water consumption is an important consideration when evaluating evaporative coolers.  Water consumption of the evaporative cooler is modeled using Equation .

<div>$${\dot V_{water}} = {\dot V_{evap}} + {\dot V_{drift}} + {\dot V_{blowdown}}$$</div>

The three components of water consumption are evaporation, drift, and blowdown.  Evaporation is the water evaporated as the normal part of the evaporative cooler thermodynamic process and is calculated using:

<div>$${\dot V_{evap}} = \frac{{{{\dot Q}_{IEC}}}}{{{\rho_{water}}{h_{fg}}}}$$</div>

where,

<span>${\dot V_{evap}}$</span> is the volume flow rate of useful water evaporation [m<sup>3</sup>/s]

<span>${h_{fg}}$</span> is the heat of vaporization of water (taken as 2,500,000 J/kg)

<span>${\dot Q_{IEC}}$</span> is the rate of heat transfer calculated as by Equation or Equation [W]

<span>${\rho_{water}}$</span> is the density of water [kg/m3]

Drift is water that leaves the secondary side as droplets and does not contribute to the evaporative cooling process in a useful manner.  It is calculated using a user input factor that describes drift as a fraction of <span>${\dot V_{evap}}$</span>.

<div>$${\dot V_{drift}} = {\dot V_{evap}} * {f_{drift}}$$</div>

Blowdown is water drained from the sump to counter the build up of solids in the water that would otherwise occur because of evaporation.  It is calculated using a user input factor for the blowdown concentration ratio ,<span>${R_{concentration}}$</span> , which is the ratio of solids in in the blowdown water compared to the solids in the fresh makeup water and is limited to values of 2 or higher.  The make up water needed for blowdown is calculated using:

<div>$${\dot V_{blowdown}} = \frac{{{{\dot V}_{evap}}}}{{\left( {{R_{concentration}} - 1.0} \right)}} - {\dot V_{drift}}$$</div>

![figure 167 renamed](EngineeringReference/media/image4833.png)

Figure 207. Research Special Indirect Evaporative Cooler Using Relief Air

#### Indirect Evaporative Cooler Sizing

The model for the object called EvaporativeCooler:Indirect:ResearchSpecial has a field for the secondary fan flow rate that can be autosized.  

##### Secondary Air DesignFan Flow Rate

The secondary air design flow rate fan is not part of an airstream that is directly modeled in EnergyPlus.  Because the primary side air flows can be autosized as part of the air system, it is convenentconvenient to also scale the size of the secondary flow.   If the cooler is part of the main loop of a central air system, then the secondary fan flow rate is sized to equal to the main design flow rate. 

User inputs for autosizing scaling factors are included so that when modeling an autosized IEC, all the design values can be scaled off of Primary Design Air Flow Rate.  User input for Secondary Air Flow Sizing Factor is multiplied by DesMainVolFlow<sub>sys</sub> as follows:

<div>$$ \dot{V}_{sec,design} = \text{DesMainVolFlow}_{sys}\cdot\text{SecAirFlowScalingFactor} $$</div>

If the cooler is part of the outdoor air path of a central air system, then the secondary air design flow rate is sized to be the maximum of either the design minimum outdoor air flow rate or one-half of the main design flow rate. 

<div>$$ \dot{V}_{sec,design} = \max\left(\text{DesOutAirVolFlow},0.5\cdot\text{DesMainVolFlow}_{sys}\right)\cdot\text{SecAirFlowScalingFactor} $$</div>
 
##### Secondary Fan Design Power

The Secondary Fan Design Power is outosized from secondary air design flow rate and user input for Secondary Fan Sizing Specific Power in units of W/(m3/s) as follows:

<div>$$ P_{sec,fan,design} = \dot{V}_{sec,design}\cdot\text{FanPowerScalingFactor} $$</div>

##### Recirculating Water Design Pump Power

The Recirculating Water Design Pump Power is sized from secondary air design flow rate and user input for recirculating and spraying Water Pump Power Sizing Factor in units of W/(m3/s) or W-s/m3 and is given by:

<div>$$P_{pump,design} = \dot{V}_{sec,design}\cdot\text{PumpPowerScalingFactor}$$</div>

Where,

<span>$ \dot{V}_{sys,design} $</span> = primary air design volume flow rate in m3/s

<span>$ \dot{V}_{sec,design} $</span> = secondary air design volume flow rate in m3/s

<span>$ \text{SecAirFlowScalingFactor} $</span> = user specified Secondary air flow sizing factor in units of W/(m3/s) for secondary design air flow rate calculation.

<span>$ \text{FanPowerScalingFactor} $</span> = user specified secondary air fan sizing specific power in units of W/(m3/s) for design fan power calculation.

<span>$ \text{PumpPowerScalingFactor} $</span> = user specified recirculating and spraying water pump power sizing factor in units of W/(m3/s) for design pump power calculation.

### Direct Evaporative Cooler Special Research Model

This section summarizes the model implemented in the component EvaporativeCooler:Direct:ResearchSpecial.  This model can use a simple constant effectiveness or a variable effectiveness model that, under part load conditions, can modulate so that the air leaving the cooler just meets a drybulb temperature setpoint.  The algorithm used to determine the changes to the system air proceeds in four steps:

1) Calculate the current operation effectiveness using effectiveness modifying curve

2) Calculate full load performance using a part load fraction (PLF)=1 and Equation .

3) Calculate PLF using Equations , , and .

4) Recalculate cooler performance using the PLF.

<div>$$\begin{array}{rl}
  \epsilon_{op} &= \epsilon_{design}\cdot f_{mod}\left(flowRatio\right) \\
  T_{db,out,sys} &= T_{db,in,sys} - \epsilon_{op}\cdot\left(T_{db,in,sys}-T_{wb,in,sys}\right) \\
  T_{db,out} &= T_{db,in}-\epsilon\left(T_{db,in}-T_{wb,in}\right)
\end{array}$$</div>

where,

* <span>${T_{db,out,sys}}$</span> is the drybub temperature of the air leaving the cooler [ºC],

* <span>${T_{db,in,sys}}$</span> is the drybulb temperature of the air entering the cooler [ºC],

* <span>${T_{wb,in,sys}}$</span> is the wetbulb temperature of the air entering the cooler [ºC], and

* <span>$\epsilon_{design} $</span> is the cooler design effectiveness.

* <span>$\epsilon_{op} $</span> is the cooler current operation effectiveness.

* <span>$f_{mod} $</span> is the effectiveness modifier curve as a function of system air flow fraction

The wetbulb temperature of air leaving a direct cooler is the same as the wetbulb temperature entering the cooler.  The leaving humidity ratio of the air is calculated using psychrometric functions with leaving drybulb and wetbulb temperatures and outdoor air pressure as inputs.  The leaving enthalpy of air is calculated using psychrometric functions with leaving drybulb temperature, leaving humidity ratio, and outdoor air pressure as inputs.

The direct cooler sometimes has the ability to overcool the air and therefore some form of modulation is useful for analysis.  The special research model includes a Part Load Fraction, PLF, used to model the implications of controlling the amount of cooling.  It is assumed that through some sort of on/off cycling or wetness control that the cooling electric power can be varied to exactly meet the desired temperature when PLF is less than unity.  The auxiliary water pump power is then varied using pump power modifier curve or linearly using a Part Load Fraction when the pump power modifier curve is not specified.

<div>$${\rm{FullOutput}} = {T_{db,out}} - {T_{db,in}}$$</div>

<div>$${\rm{RequiredOutput}} = {T_{db,desired}} - {T_{db,in}}$$</div>

<div>$$PLF = \frac{{{\rm{RequiredOutput}}}}{{{\rm{FullOutput}}}}$$</div>

When PLF is less than 1.0 it is assumed that the cooler will deliver the desired temperature air (as long as it is less than the inlet; it doesn’t need heating).  Water pump power is also derated using the user specified pump modifier curve or using PLF when the pump modifier curve is not specified.

#### Water Consumption

Water consumption is an important consideration when evaluating evaporative coolers.  Water consumption of the evaporative cooler is modeled using Equation .

<div>$${\dot V_{water}} = {\dot V_{evap}} + {\dot V_{drift}} + {\dot V_{blowdown}}$$</div>

The three components of water consumption are evaporation, drift, and blowdown.  Evaporation is the water evaporated as the normal part of the evaporative cooler thermodynamic process and is calculated using:

<div>$${\dot V_{evap}} = \frac{{\dot m\left( {{w_{out}} - {w_{in}}} \right)}}{{{\rho_{water}}}}$$</div>

where,

<span>${\dot V_{evap}}$</span> is the volume flow rate of useful water evaporation [m<sup>3</sup>/s]

<span>${w_{out}}$</span> is the humidity ratio of the air leaving the cooler [kg/kg]

<span>${w_{in}}$</span> is the humidity ratio of air entering the cooler [kg/kg]

<span>$\dot m$</span> is the mass flow rate of air moving through the cooler [kg/s]

<span>${\rho_{water}}$</span> is the density of water [kg/m3]

Drift is water that leaves the cooler (and supply air duct) as droplets and does not contribute to the evaporative cooling process in a useful manner.  It is calculated using a user input factor that describes drift as a fraction of <span>${\dot V_{evap}}$</span>.

<div>$${\dot V_{drift}} = {\dot V_{evap}} * {f_{drift}}$$</div>

Blowdown is water drained from the sump to counter the build up of solids in the water that would otherwise occur because of evaporation.  It is calculated using a user input factor for the blowdown concentration ratio ,<span>${R_{concentration}}$</span>, which is the ratio of solids in the blowdown water compared to the solids in the fresh makeup water and is limited to values of 2 or higher.  The make up water needed for blowdown is calculated using:

<div>$${\dot V_{blowdown}} = \frac{{{{\dot V}_{evap}}}}{{\left( {{R_{concentration}} - 1.0} \right)}} - {\dot V_{drift}}$$</div>

Air System Fans <a name="Fans"></a>
---------------

### Overview

Three input objects (Fan:ConstantVolume, Fan:VariableVolume, and Fan:OnOff) provide models for fans -- the prime movers in most of the air loop and zonal air conditioning systems in EnergyPlus. For these input objects, EnergyPlus uses a simple polynomial-based curve-fit model to describe the relation between the volumetric flow rate and the fan electric power, with no explicit modeling of fan pressure rise. Consequently, duct-static-pressure reset strategies cannot be modeled using this approach. For CAV and VAV central air-handling systems, a fourth input object (Fan:ComponentModel) provides a simple physics-based model for flow-dependent fan pressure rise and detailed models for fan, belt, motor, and variable-frequency-drive efficiencies and energy use. This latter input object provides the capability to analyze the effects of duct-static-pressure reset strategies, as well as changes in fan system element performance. All of these fan models calculate the fan energy usage, which is often a large fraction of HVAC energy use and a significant portion of the building energy consumption. They also calculate the temperature rise in the air stream caused by the static pressure increase as the air goes through the fan. If the motor and belt are in the air stream, waste heat from the motor and belt also acts to raise the air stream temperature.

### Model

Each of the four fan models is a forward type: the model inputs describe the fan characteristics and the conditions of the air at the fan inlet; the outputs are the fan electrical power consumption and the conditions of the air at the fan outlet. The model algorithms and data are contained in the *Fans* module in EnergyPlus.

#### Inputs and Data

For the Fan:ConstantVolume, Fan:VariableVolume, and Fan:OnOff models, the user describes the fan by entering values for the design pressure rise across the fan, the design volumetric flow rate, the fan total efficiency, and the fan motor efficiency. The user also needs to specify the fraction of the fan waste heat that will enter the air stream (usually 0 or 1). For the Fan:VariableVolume model, the user must also enter the coefficients of a 4<sup>th</sup> order polynomial that relates the fan mass flow rate to the fan power consumption.The independent variable is the volumetric flow fraction; the dependent variable is the fan power part load ratio. For multi-speed fans, the user must enter a fan power ratio as a function of speed ratio performance curve name. Multi-speed fans can only be simulated in a parent object which allows multiple fan speeds (e.g., AirLoopHVAC:Unitary:Furnace:HeatCool, ZoneHVAC:PackagedTerminalAirConditioner, etc.). An optional efficiency curve may also be used when simulating multi-speed fans to adjust the fan total efficiency as the fan speed changes.

For the Fan:ComponentModel object, the user describes the fan in more detail, and also describes the duct system characteristics as seen by the fan. In particular, the user specifies a pressure rise curve with four coefficients that relates the fan total pressure rise to the volumetric flow through the fan, the duct-static-pressure set-point, and the static pressure of the spaces surrounding the ducts. If duct-static-pressure reset is used, the user enters a linear curve with two coefficients that relates the pressure set-point to the volumetric flow through the fan. For the fan itself, the user specifies the fan geometry (wheel diameter and outlet area), maximum efficiency, the Euler number corresponding to the maximum efficiency, the maximum dimensionless flow, the names of four curves with several coefficients that describe the variation of fan efficiency and dimensionless flow with the Euler number in the normal and stall operation regions of the fan, and a sizing factor (applied to the maximum flow through the fan). For the belt, the user specifies the maximum efficiency (or a curve with five coefficients that defines the maximum efficiency as a function of maximum fan shaft input power), three curves with three coefficients each that relate the belt part-load efficiency to belt fractional output torque, the motor/fan pulley diameter ratio, the belt output torque capacity, and a sizing factor (applied to the maximum output torque of the belt). For the motor, the user specifies the maximum efficiency (or a curve with three coefficients that define the maximum efficiency as a function of maximum belt input power), a curve with three coefficients that relate the motor part-load efficiency to motor fractional output power, and a sizing factor (applied to the maximum output power of the motor). For the variable-frequency-drive (VFD), the user specifies a curve with three coefficients that relate the VFD part-load efficiency to motor fractional input power or to motor fractional speed, and a sizing factor (applied to the maximum output power of the VFD).

#### Control

The models must decide whether the fan is on or off. The primary on/off trigger is the fan schedule. This is an on/off schedule associated with each fan: a value of 1 indicates the fan is on; a value of 0 indicates the fan is off. The fan schedule can be overruled by flags set by system availability managers. If the flag *TurnFansOn* is true, a zero fan schedule value will be overridden and the fan will be turned on. If the flag *TurnFansOff* is true the fan will be forced off. The inlet air mass flow rate must be greater than zero for the fan to be on.

Generally the fan is a passive component: it accepts the mass flow on its inlet node, uses it in its calculations of energy consumption and temperature rise, and passes it to the outlet node. However the fan maximum and minimum airflow rates act as absolute limits on the airflow rate.

For multi-speed fans, the parent object determines the fan speed ratio (i.e., the selected speed of the fan motor) and uses this value in conjunction with the fan power ratio performance curve to calculate the full load fan power. This full load fan power is then used to determine the part-load performance of the fan and motor assembly.

#### Simulation

Simple (Single Speed) Fan Model

The following equations define the model for this fan:

<div>$${\dot Q_{tot}} = \dot m\cdot \Delta P/({e_{tot}}\cdot {\rho_{air}})$$</div>

<div>$${\dot Q_{shaft}} = {e_{motor}}\cdot {\dot Q_{tot}}$$</div>

<div>$${\dot Q_{toair}} = {\dot Q_{shaft}} + ({\dot Q_{tot}} - {\dot Q_{shaft}})\cdot {f_{motortoair}}$$</div>

<div>$${h_{out}} = {h_{in}} + {\dot Q_{toair}}/\dot m$$</div>

<div>$${w_{out}} = {w_{in}}$$</div>

<div>$${T_{out}} = PsyTdbFnHW({h_{out}},{w_{out}})$$</div>

On/Off Fan Model

The on/off fan model is similar to the simple fan model with the exception that the on/off fan may cycle on and off during a simulation time step. The cycling rate of the fan is known as the run time fraction. The calculation of run time fraction accounts for the part-load losses of other equipment used in the HVAC system. A part-load factor (a.k.a. part-load ratio) is first calculated for the fan as the ratio of the actual operating mass flow rate to the maximum fan mass flow rate. The run time fraction is then calculated as the part-load factor divided by the part-load fraction. The part-load fraction is determined by other HVAC equipment in the simulation (Ref. DX coil) for use by this specific fan model.

<div>$${f_{flow}} = {\raise0.7ex\hbox{${\mathop m\limits^ \bullet  }$} \!\mathord{\left/ {\vphantom {{\mathop m\limits^ \bullet  } {{{\mathop m\limits^ \bullet  }_{\max }}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop m\limits^ \bullet  }_{\max }}}$}}$$</div>

<div>$$RTF = {\raise0.7ex\hbox{${{f_{flow}}}$} \!\mathord{\left/ {\vphantom {{{f_{flow}}} {PLF}}}\right.}\!\lower0.7ex\hbox{${PLF}$}}$$</div>

The total fan power is then calculated as the maximum fan power multipled by the run time fraction.

<div>$${\mathop Q\limits^\cdot_{tot}} = RTF\left[ {\mathop m\limits^\cdot  \cdot \Delta P/\left( {{e_{tot}}\cdot {\rho_{air}}} \right)} \right]$$</div>

The remaining calculations are the same as those described in the simple single-speed fan mode.

Multi-Speed Fan Model

The model used to simulate a multi-speed fan relies on the general fan laws to correct for speed changes in the fan’s motor and the corresponding change in fan power and fan total efficiency. Two performance curves are used to define the change in power and efficiency as shown below. The power ratio curve must be used to simulate a multi-speed fan. The power ratio curve modifies the fan power based on a change in fan speed according to the cubic fan law. Exponents other than 3 are allowed. The efficiency ratio curve is used to correct for changes in nominal efficiency at alternate fan speeds. If either or both of these curves are not provided, the ratio is assumed to be 1.

The power ratio term is evaluated using an exponent performance curve. The form of the exponent curve equation is shown below.

<div>$$ExponentCurveOutput = C1 + C2*{x^{C3}}$$</div>

The exponent performance curve is used to evaluate the power ratio as a function of speed ratio (x in the equation above). For typical fan performance, coefficient C1 = 0 and coefficient C2 = 1. The exponent (C3) is typically equal to 3 (cubed fan law) but other values are allowed.

<div>$$PowerRatio = f{\left( {{N_{ratio}}} \right)^n} = ExponentCurveOutput$$</div>

The efficiency ratio curve is a quadratic or cubic curve used to evaluate the efficiency ratio as a function of speed ratio (x in the following equation). The cubic equation form is shown below.

<div>$$EfficiencyCurveOutput = C1 + C2{\left( x \right)^2} + C3{\left( x \right)^3}$$</div>

The curve coefficients are determine by correlating the normalized fan total efficiency (i.e., the actual fan total efficiency divided by the nominal fan total efficiency at a speed ratio of 1) to the speed ratio (i.e., the ratio of actual air flow rate through the fan to the maximum fan air flow rate).

<div>$$EfficiencyRatio = f\left( {{N_{ratio}}} \right) = EfficiencyCurveOutput$$</div>

To account for the change in fan speed and to ensure that the run time fraction is accurately calculated, an adjustment to the previous calculation for run time fraction is made. This adjusts the calculated run time fraction to account for times when the fan speed has been reduced and the new speed is now considered the fan’s maximum speed. The speed adjusted run time fraction is then used in the fan power calculation.

<div>$$RTF = {\raise0.7ex\hbox{${RTF}$} \!\mathord{\left/ {\vphantom {{RTF} {{N_{ratio}}}}}\right.}\!\lower0.7ex\hbox{${{N_{ratio}}}$}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{tot}} = RTF\left[ {\frac{{\mathop m\limits^ \bullet  \Delta P}}{{{e_{tot}}{\rho_{air}}}}} \right]\left( {\frac{{PowerRatio}}{{EfficiencyRatio}}} \right)$$</div>

Each of the performance curves described above may be used to model the performance of a multi-speed fan motor, however, the power ratio curve must be used to envoke the multi-speed simulation. These curves are used when the fan is used in an HVAC system having multiple flow rates (i.e., different flow rates in cooling and heating mode). If an HVAC system operates at the same speed in either cooling or heating mode, these curves are not required. When these curves are not used, the associated ratio term in the equation above is assumed to be 1. The remaining calculations are identical to the simple single-speed fan model described above.

Variable Speed Fan Model

The model for the variable speed fan is similar to the simple single-speed fan model except for a part load factor that multiplies the fan power consumption.

<div>$${f_{flow}} = \dot m/{\dot m_{design}}$$</div>

<div>$${f_{pl}} = {c_1} + {c_2} \cdot {f_{flow}} + {c_3} \cdot f_{flow}^2 + {c_4} \cdot f_{flow}^3 + {c_5} \cdot f_{flow}^4$$</div>

<div>$${\dot Q_{tot}} = {f_{pl}}\cdot {\dot m_{design}}\cdot \Delta P/\left( {{e_{tot}}\cdot {\rho_{air}}} \right)$$</div>

The rest of the calculation is the same as for the simple fan.

#### Nomenclature for Simple Models

<span>${\dot Q_{tot}}$</span> is the fan power in watts;

<span>$\dot m$</span>is the air mass flow in kg/s;

<span>${\dot m_{design}}$</span>is the design (maximum) air flow in kg/s;

<span>$\Delta P$</span>is the fan design pressure increase in Pascals;

<span>${e_{tot}}$</span> is the fan total efficiency;

<span>${\rho_{air}}$</span>is the air density at standard conditions in kg/m<sup>3</sup>;

<span>${e_{motor}}$</span> is the motor efficiency;

<span>${\dot Q_{shaft}}$</span>is the fan shaft power in watts;

<span>${\dot Q_{toair}}$</span>is the power entering the air in watts;

<span>${N_{ratio}}$</span>is the ratio of actual fan flow rate (or speed) to maximum fan flow rate (or speed)

<span>${h_{in}},{h_{out}}$</span> are the inlet and outlet air stream specific enthalpies in J/kg;

<span>${w_{in}},{w_{out}}$</span> are the inlet and outlet air stream humidity ratios;

<span>${T_{out}}$</span> is the outlet air temperature in degrees C;

<span>$PsyTdbFnHW$</span>is the EnergyPlus psychrometric routine relating enthalpy and humidity ratio to temperature;

<span>${f_{flow}}$</span>is the flow fraction or part-load ratio;

<span>${f_{pl}}$</span> is the part load factor.

Component Fan Model

The Fan:ComponentModel object is based upon combining: modified forms of fan, belt, motor, and variable-frequency-drive (VFD) element models (Stein and Hydeman 2004); a simplified fan pressure rise model with distribution system leakage, duct static pressure, and conditioned space pressure control effects included (Sherman and Wray 2010); and a diagnostic-based simplified duct static-pressure reset (SPR) scheme for air-handling systems (Federspiel 2004, 2005).

Fan *electric* power depends on fan *air* power (product of the airflow through and pressure rise across the fan), mechanical efficiencies (fan and belt), and electrical efficiencies (motor and drive). For systems with variable flows, none of these parameters is constant and all are interrelated. For example, Figure 208 shows that fan efficiency strongly depends on fan flow *as well as* pressure rise, although this is not obvious from the manufacturer’s power and speed performance map (top left). Fan efficiency maps can be derived from the manufacturer’s performance map using a commercially-available software-based data extraction tool such as DigitizeIt and by applying the following equation to the extracted data:

<span>${\eta_{fan}} = \frac{{\Delta {P_{fan}} \cdot {Q_{fan}}}}{{{H_{fan}}}}$</span>                                                                                     ()

where **Δ***P<sub>fan</sub>*is the fan pressure rise (Pa); *Q<sub>fan</sub>* is the fan flow at standard conditions (m<sup>3</sup>/s); and *H<sub>fan</sub>* is the fan shaft power (W). Fan speed values also can be derived from the manufacturer’s performance map using a similar software-based data extraction tool.

Fan pressure rise must be sufficient to overcome the air-handling system pressure drop, which depends on duct static pressure, on duct and equipment leakage, and on pressure drops across duct and duct-like elements (e.g., dampers, fittings), coils, and filters that are connected to the fan. Duct and duct-like pressure drops increase approximately as the square of the flow through them. However, pressure drops across coils and filters behave differently: they are proportional to the flow raised to a power n, which can approach one for high-efficiency filters and wet coils (Liu et al. 2003, Trane 1999).

The relation between system pressure drop and flow defines what is commonly called a “system curve”. When system characteristics change, such as when the duct static pressure set point is varied, a family of system curves results. The intersections of these curves with fan curves (e.g., power as a function of pressure rise and flow) on a pressure versus flow plot define one or more loci of unique fan operating points. Each of these points has an associated fan efficiency, power, and speed.

![Fancomp1](EngineeringReference/media/image4888.png)

Figure 208. Example Fan Performance Maps - Manufacturer’s Data from Loren Cook Company, plus Derived Static Efficiency (Three-Dimensional and Contours)
 (Dashed Parabolic Curve is “Do Not Select Line”)

*Fan Pressure Rise Model*: To calculate fan pressure rise based on flow through the fan, Sherman and Wray (2010) have developed a simple physics-based data-driven four parameter duct system model for the purpose of simulating its system curve. The embodiment of the model for a fixed outdoor air fraction that can be applied to constant- or variable-volume central air-handling systems is:

<span>$\Delta {P_{fan,tot}} = {A_{fpr}}Q_{fan}^2 + {B_{fpr}}Q_{fan}^{} + {C_{fpr}}Q_{fan}^{}\sqrt {{P_{sm}} - {P_o}}  + {D_{fpr}}\left( {{P_{sm}} - {P_o}} \right)$</span>                            ()

where **Δ***P<sub>fan,tot</sub>* is the fan total pressure rise (Pa); *Q<sub>fan</sub>* is the fan flow at standard conditions (m<sup>3</sup>/s); *P<sub>sm</sub>* is the duct static pressure set point (Pa); *P<sub>o</sub>* is the static pressure of the spaces surrounding the ducts (Pa); and *A<sub>fpr</sub>*, *B<sub>fpr</sub>*, *C<sub>fpr</sub>*, and *D<sub>fpr</sub>* are constant coefficients that represent different aspects of the fan pressure rise model as described below.

Fan static pressure rise is determined from the total pressure rise by subtracting the outlet velocity pressure:

<span>$\Delta {P_{fan}} = \Delta {P_{fan,tot}} - \frac{\rho }{2}{\left( {\frac{{{Q_{fan}}}}{{{A_{fan,out}}}}} \right)^2}$</span>                                                                         ()

where *A<sub>fan,out</sub>* is the fan outlet area (m<sup>2</sup>) and *ρ* is the air density at the fan inlet (kg/m<sup>3</sup>).

The first term in Equation looks like the common system curve in which the fan pressure rise is proportional to the square of the fan flow, but here it also depends implicitly on supply and return pressure losses, and in part on the fraction of the fan flow that is outdoor air (essentially “leaks” into and out of the return side of the system). Very often it is the only term considered, but that would only be correct with fixed-position dampers, no distribution system leakage, no linear resistance components, and no duct static pressure control.

The second term accounts for significant flow resistances in the system where the pressure difference is linearly proportional to the flow. Some filters and coils in the return may need this term to be adequately described. This term could be ignored if there are no linear components or if their pressure drops are very small compared to the other terms.

The third term, which depends on the fan flow and square root of the supply duct pressure *P<sub>sm</sub>*, accounts in part for air leakage from the supply system when damper positions are fixed or are changed independently of static pressure or fan flow. In this case, reducing or eliminating supply leakage results in a different system curve. This, however, might be only a minor “correction” to the simple system curves generally used. The third term is zero when VAV box dampers are modulated to control flow. Consequently, with variable-position supply dampers, reducing or eliminating supply leakage does not change the system curve.

The last term also accounts in part for leakage from the supply system when damper positions are fixed or are changed independently of static pressure or fan flow. This term indicates that the same fan pressure rise can be achieved by raising the duct pressure and closing dampers. The only change in the system in such a case is that the leakage flow may increase. The coefficient for this term is equal to one when the VAV box dampers are modulated to control flow. In both cases, this term may be the most important “correction” to the simple system curves generally used, especially at low flows.

In principle, especially for research applications of Energy Plus, the four individual fan pressure rise coefficients can be determined using duct design calculation tools for the entire system (e.g., Right-CommDuct, UNI-DUCT, Ductsize, Varitrane Duct Designer, T-Duct). In practice, however, especially for existing buildings, the necessary details may not be known sufficiently. In that case, one can make active measurements at different combinations of fan flows, outside air fractions, damper positions (if they are variable), and duct static pressures and then use non-linear system identification techniques to fit the data and determine the coefficients. If passive measurements can be made over a sufficiently long time so that a wide range of outside air settings, damper positions, and fan flows is obtained, one could instead regress the data to find all of the parameters in the equation. Unfortunately, there are no standardized test procedures available to draw upon, even though some standards appear to be related (e.g., ASHRAE 1999, 2008). Consequently, field test protocols need to be developed to determine the parameters for the new duct system model. These protocols then need to be integrated into standardized data collection and analysis tools such as Pacific Gas and Electric’s “Universal Translator” tool. The California Energy Commission is funding such a project; data, procedures, and tools from this project will support the EnergyPlus implementation of the fan and duct system models described here.

*SPR Model*: The model for duct-static-pressure reset (SPR) is based on a simple diagnostic procedure and a linear correlation between duct static pressure and supply fan airflow (Federspiel 2004, 2005). The diagnostic method involves measuring the static pressure at the duct static pressure sensor and the velocity pressure at the fan inlet (represents the fan flow) at multiple points over the fan’s operating range, while the VAV box dampers attempt to control flow in response to a constant thermostat setpoint. The goal of the test is to define the lowest duct static pressure where all VAV boxes are still in control (dampers modulating). In the model, the correlation between *P<sub>sm</sub>* and *Q<sub>fan</sub>* is as follows for *Q<sub>fan,min</sub>* ≤ *Q<sub>fan</sub>* ≤ *Q<sub>fan,max</sub>*:

<span>${P_{sm}} = {P_{sm,\min }} + \left( {{P_{sm,\max }} - {P_{sm,\min }}} \right)*\frac{{\left( {{Q_{fan}} - {Q_{fan,\min }}} \right)}}{{\left( {{Q_{fan,\max }} - {Q_{fan,\min }}} \right)}} = {C_1} + {C_2}*{Q_{fan}}$</span>                         ()

Where

 <span>${C_1} = {P_{sm,\min }} - {C_2}*{Q_{fan,\min }}$</span> and <span>${C_2} = \frac{{\left( {{P_{sm,\max }} - {P_{sm,\min }}} \right)}}{{\left( {{Q_{fan,\max }} - {Q_{fan,\min }}} \right)}}$</span>                                ()

For *Q<sub>fan</sub>* &lt; *Q<sub>fan,min</sub>*, *P<sub>sm</sub>* = *P<sub>sm,min</sub>*;for*Q<sub>fan</sub>* &gt; *Q<sub>fan,max</sub>*, *P<sub>sm</sub>* = *P<sub>sm,max</sub>*

*Fan Efficiency and Shaft Input Power Model*: A dimensionless parameter in the form of an Euler number can be used to simplify the description of fan static efficiency variations:

<span>$Eu = \frac{{\left( {\Delta {P_{fan}} * D_{fan}^4} \right)}}{{\left( {\rho  * Q_{fan}^2} \right)}}$</span>                                                                                      ()

where **Δ***P<sub>fan</sub>* is the fan static pressure rise (Pa), *D<sub>fan</sub>* is the fan wheel outer diameter (m), *ρ* is the air density at the fan inlet (kg/m<sup>3</sup>), and *Q<sub>fan</sub>* is the fan flow at standard conditions (m<sup>3</sup>/s). *Eu* is nominally the ratio of pressure forces across the fan to inertial forces at the fan wheel exit.

By plotting the normalized fan static efficiency (*static efficiency / maximum static efficiency*) versus the logarithm base 10 of the normalized Euler number (*Eu* */* *Eu* *at maximum static efficiency*), the dimensionless performance of various fan sizes is very similar (as one might expect from the “fan laws”), but so also is the dimensionless performance of different *types* of fans (e.g., single-inlet plenum fans, double-inlet housed centrifugal fans, mixed flow fans, vane axial fans, fans with backward or forward curved blades). An example of this correlation for the “normal operation” (non-stall) and stall regions of eight fans is shown in Figure 209.

![Fancomp2](EngineeringReference/media/image4895.png)

Figure 209. Normalized Efficiency Curves for Eight Fans in Dimensionless Space
 *(BC=backward curved, FC=forward curved; SI=single inlet, DI=double inlet)*

This model uses a continuous function to represent the normalized fan efficiency (*η<sub>fan</sub>*) variation. The normalized exponential-conditioned skew-normal functional relationship is:

<span>$\frac{{{\eta_{fan}}({x_{fan}})}}{{{\eta_{fan,\max }}}} = \frac{{{e^{( - 0.5*Z_1^2)}}[1 + \frac{{{Z_2}}}{{\left| {{Z_2}} \right|}} \bullet erf\left( {\frac{{\left| {{Z_2}} \right|}}{{\sqrt 2 }}} \right)}}{{{e^{( - 0.5*Z_3^2)}}[1 + \frac{{{Z_3}}}{{\left| {{Z_3}} \right|}} \bullet erf\left( {\frac{{\left| {{Z_3}} \right|}}{{\sqrt 2 }}} \right)}}$</span>                                                   ()

where

x<sub>fan</sub> = log<sub>10</sub>(Eu / Eu<sub>max</sub>)

Z<sub>1</sub> = (x<sub>fan</sub> - a<sub>fan</sub>) / b<sub>fan</sub>;  Z<sub>2</sub> = ((e<sup>(c</sup>fan<sup>\*x</sup>fan<sup>)</sup>\*d<sub>fan</sub>\*x<sub>fan</sub>) - a<sub>fan</sub>) / b<sub>fan</sub>;  Z<sub>3</sub> = -a<sub>fan</sub> / b<sub>fan</sub>

For conceptual design when only rough estimates are needed, a generic curve (also shown in Figure 209) can be used and then one only needs to know the maximum efficiency (*η<sub>fan,max</sub>*) and *Eu* at that maximum (*Eu<sub>max</sub>*) to entirely model the fan efficiency and hence fan power. The dimensionless coefficients for the generic normalized fan efficiency curve are as follows:

*a<sub>fan</sub>*= -2.732094, *b<sub>fan</sub>* = 2.273014,*c<sub>fan</sub>* = 0.196344, *d<sub>fan</sub>* = 5.267518

In this case, the coefficient of determination R<sup>2</sup> is 0.994. Also, the average and RMS differences between the efficiency values based on extracted data and the fitted generic curve are, respectively, about 0.5% and 1.4%; maximum differences are about ±9%.

If more accuracy is needed for a specific fan, a similarly shaped curve can be developed for that fan (using extracted data, Equation , and least-squares regression techniques), segmented into normal operation and stall regions with specific coefficients fitted for each region. Figure 210 shows an example, using the data from Figure 208.

![](EngineeringReference/media/image4897.svg.png)

Figure 210. Example Normalized Efficiency Data for One Fan

For this specific fan, the coefficients are:

Table 65. Normalized Fan Efficiency Coefficients for Specific Backward-Curved Plenum Fan

<table class="table table-striped">








<tr>
<td>Operating Region</td>
<td>a<sub>fan</sub></td>
<td>b<sub>fan</sub></td>
<td>c<sub>fan</sub></td>
<td>d<sub>fan</sub></td>
</tr>
<tr>
<td>Normal (Non-Stall)</td>
<td>0.072613</td>
<td>0.833213</td>
<td>0</td>
<td>0.013911</td>
</tr>
<tr>
<td>Stall</td>
<td>-2.354091</td>
<td>2.117493</td>
<td>0</td>
<td>2.753264</td>
</tr>

</table>



In this case, the average and RMS differences between the efficiency values based on extracted data and fitted specific curve (R<sup>2</sup> is 0.999) are, respectively, about -0.1% and 0.3%; maximum differences are about ±0.7%. Field tests are especially needed to determine the coefficients for installed fans because fans are susceptible to “system effects” (e.g., inlet obstructions) that are not included in the manufacturer test data (AMCA 1990a).

To determine fan efficiency and fan shaft power at a particular time step, first calculate the fan pressure rise (**Δ***P<sub>fan</sub>*) using the time step fan flow (*Q<sub>fan</sub>*) and Equation (and also using Equations and if there is SPR). Next, calculate *Eu* using Equation and then *x<sub>fan</sub>* (log<sub>10</sub> normalized *Eu*), which is based on *Eu* and the specified *Eu<sub>max</sub>* (*Eu* at maximum efficiency) for the fan. The corresponding normalized efficiency (*η<sub>fan</sub>*(*x<sub>fan</sub>*) */ η<sub>fan,max</sub>*) is obtained using Equation . The fan efficiency (*η<sub>fan</sub>*(*x<sub>fan</sub>*)) therefore is:

<span>${\eta_{fan}}\left( {{x_{fan}}} \right) = {\eta_{fan,\max }}\left[ {\frac{{{\eta_{fan}}\left( {{x_{fan}}} \right)}}{{{\eta_{fan,\max }}}}} \right]$</span>                                                                  ()

The fan shaft input power (mechanical, W) is:

<span>${H_{fan}} = \frac{{\Delta {P_{fan}} \cdot {Q_{fan}}}}{{{\eta_{fan}}\left( {{x_{fan}}} \right)}}$</span>                                                                                      ()

*Fan Shaft Speed and Torque Modeling*: For rotating elements, power (*H*) is the product of torque (*τ*) and rotational speed (ω), or conversely, torque is power divided by rotational speed (*τ =H / ω*).

The Stein and Hydeman variable-frequency-drive (VFD) component model correlates VFD efficiency as a linear function of VFD fractional output power (i.e., motor input power). Available data for about 50 drives from Saftronics were apparently used to develop their model, but those data represent VFD efficiency as a function of motor fractional speed
 (*ω<sub>motor</sub> / ω<sub>motor,max</sub>*, or nominally, drive output frequency divided by maximum output frequency, if motor slip is ignored).

To make use of the available data, the Stein and Hydeman linear correlation must intrinsically make an assumption that motor speed and torque have some fixed relationship. Although not documented, their assumption might be the common belief that fractional torque (τ/ τ<sub>max</sub>) for a motor is simply the square of its fractional speed. For fans serving duct systems with components such as filters and coils, with relatively low pressure drops elsewhere in the system, and for systems that have a non-zero controlled duct static pressure, this assumption may be inappropriate. Consequently, to make use of the available data and to avoid such assumptions, one needs to know the fraction of full speed at which fan components operate.

For the fan, dimensionless flow (*φ*) can be defined as (ASHRAE 1993):

<span>$\varphi  = \frac{{{Q_{fan}}}}{{{\omega_{fan}} \cdot D_{fan}^3}}$</span>                                                                                           ()

where *ω<sub>fan</sub>* is the fan speed (rad/s). This parameter can be calculated for each operating point on the fan manufacturer’s performance map that represents fan speed as a function of flow and fan pressure rise. To simplify the data representation to a single curve (as we have done for fan efficiency), one can plot normalized dimensionless flow (dimensionless flow divided by maximum dimensionless flow, (*φ*(*x<sub>fan</sub>*) */* *φ<sub>max</sub>*) as a function of the log base 10 of the normalized Euler (*Eu*) parameter (*x<sub>fan</sub>*). Figure 211 shows an example plot derived from the manufacturer’s data in Figure 208.

![](EngineeringReference/media/image4901.svg.png)

Figure 211. Example Normalized Dimensionless Flow Data for One Fan

Equation describes the sigmoidal functional form for normalized *φ*:

<span>$\frac{{\varphi \left( {{x_{fan}}} \right)}}{{{\varphi_{\max }}}} = ({A_{spd}} + {B_{spd}}/({(1 + {e^{\left[ {{{({C_{spd}} - {x_{spd}})} \mathord{\left/ {\vphantom {{({C_{spd}} - {x_{spd}})} {{D_{spd}}}}} \right. } {{D_{spd}}}}} \right]}})^{{E_{spd}}}})$</span>                                             ()

where *A<sub>spd</sub>*, *B<sub>spd</sub>*, *C<sub>spd</sub>*, *D<sub>spd</sub>*, and *E<sub>spd</sub>* are coefficients for the fan. Separate sets of coefficients for the normal operation and stall regions can be specified. For the curve shown in Figure 211, these coefficients are:

Table 66. Dimensionless Flow Coefficients – Specific Backward-Curved Fan

<table class="table table-striped">









<tr>
<td>Operating Region</td>
<td>A<sub>spd</sub></td>
<td>B<sub>spd</sub></td>
<td>C<sub>spd</sub></td>
<td>D<sub>spd</sub></td>
<td>E<sub>spd</sub></td>
</tr>
<tr>
<td>Normal (Non-Stall)</td>
<td>0</td>
<td>1.001423</td>
<td>0.123935</td>
<td>-0.476026</td>
<td>1</td>
</tr>
<tr>
<td>Stall</td>
<td>0</td>
<td>5.924993</td>
<td>-1.916316</td>
<td>-0.851779</td>
<td>1</td>
</tr>

</table>



For a generic centrifugal fan with backward-curved blades, the coefficients are:

Table 67. Dimensionless Flow Coefficients – Generic Backward-Curved Fan

<table class="table table-striped">









<tr>
<td>Operating Region</td>
<td>A<sub>spd</sub></td>
<td>B<sub>spd</sub></td>
<td>C<sub>spd</sub></td>
<td>D<sub>spd</sub></td>
<td>E<sub>spd</sub></td>
</tr>
<tr>
<td>Normal (Non-Stall)</td>
<td>-0.551396</td>
<td>1.551467</td>
<td>-0.442200</td>
<td>-0.414006</td>
<td>0.234867</td>
</tr>
<tr>
<td>Stall</td>
<td>0.000608</td>
<td>0.586366</td>
<td>0.021775</td>
<td>-0.063218</td>
<td>0.072827</td>
</tr>

</table>

For any operating point of flow (*Q<sub>fan</sub>*) and fan pressure rise (**Δ***P<sub>fan</sub>*), one can calculate the corresponding Euler number (*Eu*) for the given fan, and then determine the corresponding normalized dimensionless flow (*φ*(*x<sub>fan</sub>*) */* *φ<sub>max</sub>*) from the sigmoidal dimensionless flow function (Equation ). With *φ*(*x<sub>fan</sub>*) */* *φ<sub>max</sub>* determined and knowing *φ<sub>max</sub>* for the fan, the dimensionless flow is:

<span>$\varphi \left( {{x_{fan}}} \right) = {\varphi_{\max }}\left[ {\frac{{\varphi \left( {{x_{fan}}} \right)}}{{{\varphi_{\max }}}}} \right]$</span>                                                                              ()

With *φ*(*x<sub>fan</sub>*) determined, the fan rotational speed (rad/s) is:

<span>${\omega_{fan}} = \frac{{{Q_{fan}}}}{{\left( {\varphi ({x_{fan}}) * D_{fan}^3} \right)}}$</span>                                                                                ()

Fan shaft torque (N∙m), which the belt drive must supply to the fan shaft, is then:

<span>${\tau_{fan}} = \frac{{{H_{fan}}}}{{{\omega_{fan}}}}$</span>                                                                                                ()

The fraction of full-load driven torque for the belt (*τ<sub>fan</sub> / τ<sub>belt,max</sub>*), which is typically called “belt load”, is thus *τ<sub>fan</sub>* divided by the belt torque capacity (*τ<sub>belt,max</sub>*). For a particular belt type and cross-section, belt torque capacity can be determined from manufacturer’s information such as a shaft speed versus power chart.

Ignoring belt slip, motor shaft speed (*ω<sub>motor</sub>*, rad/s) can then be determined using the fan speed (*ω<sub>fan</sub>*) and the motor/fan pulley diameter ratio (*D<sub>pulley,motor</sub> / D<sub>pulley,fan</sub>*), which is typically called the “drive” ratio:

<span>${\omega_{motor}} = \frac{{{\omega_{fan}}}}{{\left( {\frac{{{D_{pulley,motor}}}}{{{D_{pulley,fan}}}}} \right)}}$</span>                                                                                 ()

*Belt, Motor, and Variable-Frequency-Drive Efficiency and Input Power Models – Overview*: The models for belt drives, motors, and VFDs that Stein and Hydeman included in their air-handling system model represent maximum efficiency as a function of power input to the adjacent downstream component (e.g., the power input to a fan shaft by a belt drive), but they do not include part-load models. The part-load models are needed, because part-load efficiency for these components can fall off rapidly at low load (e.g., to zero at zero load) and many systems operate occasionally (and some much of the time) at low loads, in part because of current practices that result in substantial oversizing of components.

*Belt Efficiency and Input Power Model:* Figure 212 shows three maximum efficiency (*η<sub>belt,max</sub>*) curves for belts (low, medium, and high) as a function of maximum fan shaft torque. This set of efficiency curves is based on belt drive loss data from AMCA Publication 203 (1990b), which reportedly is an aggregation of data from over 400 tests.

To determine *η<sub>belt,max</sub>* if data for a specific belt are not available, first use the maximum fan shaft input power (*H<sub>fan,max</sub>*) for the load spectrum to calculate the natural logarithm of belt power capacity:

*x<sub>belt,max</sub> =*ln(*H<sub>fan,max</sub>*) with *H<sub>fan,max</sub>* expressed in terms of hp                        ()

Then, use Equations and , along with a choice of low, medium, or high efficiency coefficients from Table 68, to calculate *η<sub>belt,max</sub>*.

![](EngineeringReference/media/image4907.svg.png)

Figure 212. Belt Maximum Efficiency vs. Fan Shaft Power Input

The quartic polynomial curves in Figure 212 and their coefficients are as follows:

<span>${\eta_{belt,\max ,\ln }} = {c_1} + {c_2} \cdot {x_{belt,\max }} + {c_3} \cdot x_{_{belt,\max }}^2 + {c_4} \cdot x_{_{belt,\max }}^3 + {c_5} \cdot x_{_{belt,\max }}^4$</span>                    ()

Table 68. Belt Maximum Efficiency Curve Coefficients

<table class="table table-striped">









<tr>
<td>Efficiency Class (Loss)</td>
<td>c<sub>1</sub></td>
<td>c<sub>2</sub></td>
<td>c<sub>3</sub></td>
<td>c<sub>4</sub></td>
<td>c<sub>5</sub></td>
</tr>
<tr>
<td>High (Low Loss)</td>
<td>-6.502E-2</td>
<td>2.475E-2</td>
<td>-6.841E-3</td>
<td>9.383E-4</td>
<td>-5.168E-5</td>
</tr>
<tr>
<td>Medium (Medium Loss)</td>
<td>-9.504E-2</td>
<td>3.415E-2</td>
<td>-8.897E-3</td>
<td>1.159E-3</td>
<td>-6.132E-5</td>
</tr>
<tr>
<td>Low (High Loss)</td>
<td>-1.422E-1</td>
<td>5.112E-2</td>
<td>-1.353E-2</td>
<td>1.814E-3</td>
<td>-9.909E-5</td>
</tr>

</table>



The belt maximum efficiency is therefore:

<span>${\eta_{belt,\max }} = {e^{{\eta_{belt,\max ,\ln }}}}$</span>                                                                                   ()

The normalized *part-load* belt efficiency model is provided to modify the maximum efficiency of the belt. This model is based on part-load data for belts in ACEEE’s handbook on motor systems (Nadel et al. 2002). To determine the normalized belt efficiency at part-load (*η<sub>belt</sub>*(*x<sub>belt</sub>*)/* η<sub>belt,max</sub>*), use the fan shaft (belt output) fractional torque (*x<sub>belt</sub>* = *τ<sub>belt</sub>* / *τ<sub>belt,max;</sub> τ<sub>belt</sub> = τ<sub>fan</sub>*) as the belt fractional load in Equation or (select the equation for the region that contains *x<sub>belt</sub>*) and use coefficients from Table 69 that correspond to that region and the belt type: V-Belt or synchronous (toothed). Figure 213 shows a graphical representation of the curves defined by these equations and coefficients.

![](EngineeringReference/media/image4910.svg.png)

Figure 213. Belt Normalized Efficiency vs. Belt Fractional Load)

The belt normalized (part-load) efficiency curves in Figure 213 for Regions 1 and 3 (single rectangular hyperbola type 2) and Region 2 (exponential decay), respectively, and their coefficients are as follows:

Region 1 (0 &lt;= *x<sub>belt</sub>* &lt; *x<sub>belt,trans</sub>*) and Region 3 (*x<sub>belt</sub>* &gt; 1):

<span>$\frac{{{\eta_{belt}}({x_{belt}})}}{{{\eta_{belt,\max }}}} = \left[ {\frac{{{a_{belt}} \cdot {x_{belt}}}}{{{b_{belt}} + {x_{belt}}}}} \right] + {c_{belt}} \cdot {x_{belt}}$</span>                                                             ()

Region 2 (*x<sub>belt,trans</sub>* &lt;= *x<sub>belt</sub>* &lt;= 1):

<span>$\frac{{{\eta_{belt}}({x_{belt}})}}{{{\eta_{belt,\max }}}} = {a_{belt}} + {b_{belt}} \cdot {e^{\left( {{c_{belt}} \cdot {x_{belt}}} \right)}}$</span>                                                               ()

where x<sub>belt</sub> = <span>$\tau $</span><sub>belt</sub> / <span>$\tau $</span><sub>belt,max</sub>



Belt efficiency therefore is:

<span>${\eta_{belt}}({x_{belt}}) = {\eta_{belt,\max }}\left[ {\frac{{{\eta_{belt}}({x_{belt}})}}{{{\eta_{belt,\max }}}}} \right]$</span>                                                                   ()

Belt input power (mechanical, W) at the motor shaft is:

<span>${H_{belt}} = \frac{{{H_{fan}}}}{{{\eta_{belt}}({x_{belt}})}}$</span>                                                                                       ()

Table 69. Belt Normalized Efficiency Curve Coefficients

Belt Type

*x<sub>belt,trans</sub>*

*Region*

*a<sub>belt</sub>*

*b<sub>belt</sub>*

*c<sub>belt</sub>*

V-Belt

0.167

1

0.920797

0.026269

0.151594

2

1.011965

-0.339038

-3.436260

3

1.037778

0.010307

-0.026815

Synchronous

0.137

1

0.982167

0.049135

0.158164

2

1.002134

-0.531885

-5.295707

3

1

0

0

*Motor Efficiency and Input Power Model:* Figure 214 shows three maximum efficiency (*η<sub>motor,max</sub>*) curves for motors (low, medium, and high) as a function of rated motor output power (belt input power). This set of efficiency curves is based on maximum efficiency data in DOE’s MotorMaster+ database (2003) from about 800 tests. It is provided for use in the absence of manufacturer’s data.

![](EngineeringReference/media/image4917.svg.png)

Figure 214. Maximum Motor Efficiency vs. Belt Power Input (Motor Output)

To determine *η<sub>motor,max</sub>* if data for a specific motor are not available (e.g., as listed in Table 71), first use the maximum belt input power (*H<sub>belt,max</sub>*) for the load spectrum (multiplied by whatever oversizing factor may be desired) to calculate the natural logarithm of belt power capacity:

*x<sub>motor,max</sub> =*ln(*H<sub>belt,max</sub>*) with *H<sub>belt,max</sub>* expressed in terms of hp                     ()

Then, use Equation , along with a choice of low, medium, or high efficiency coefficients from Table 70, to calculate *η<sub>motor,max</sub>*.

The maximum motor efficiency curves in Figure 214 (single rectangular hyperbola type 1) and their coefficients are as follows:

<span>${\eta_{motor,\max }} = \left[ {\frac{{{a_{motor,\max }} \cdot {x_{motor,\max }}}}{{{b_{motor,\max }} + {x_{motor,\max }}}}} \right] + {c_{motor,\max }}$</span>                                              ()

Table 70. Motor Maximum Efficiency Curve Coefficients

<table class="table table-striped">







<tr>
<td>Case</td>
<td>a<sub>motor,max</sub></td>
<td>b<sub>motor,max</sub></td>
<td>c<sub>motor,max</sub></td>
</tr>
<tr>
<td>High-Efficiency</td>
<td>0.196205</td>
<td>3.653654</td>
<td>0.839926</td>
</tr>
<tr>
<td>Mid-Efficiency</td>
<td>0.292280</td>
<td>3.368739</td>
<td>0.762471</td>
</tr>
<tr>
<td>Low-Efficiency</td>
<td>0.395895</td>
<td>3.065240</td>
<td>0.674321</td>
</tr>

</table>



The normalized *part-load* motor efficiency model is provided to modify the maximum efficiency of the motor. This model is based on part-load data for motors from DOE’s MotorMaster+ database (2003). To determine the normalized motor efficiency at part-load (*η<sub>motor</sub>*(*x<sub>motor</sub>*)/* η<sub>motor,max</sub>*), use the motor fractional power output (*x<sub>motor</sub> =H<sub>belt</sub>* / *H<sub>belt,max</sub>*) as the fraction of motor output power in Equation and use coefficients from Table 71, or for a specific motor, determined from DOE MotorMaster+ data or from manufacturer’s data. Figure 215 shows a graphical representation of eight example curves defined by these equations and coefficients.

![](EngineeringReference/media/image4919.svg.png)

Figure 215. Motor Normalized Efficiency vs. Motor Load Fraction

The example motor normalized efficiency curves (single rectangular hyperbola type 2) and their coefficients as a function of motor load fraction in Figure 215 are determined from DOE MotorMaster+ data and are as follows:

<span>$\frac{{{\eta_{motor}}({x_{motor}})}}{{{\eta_{motor,\max }}}} = \left[ {\frac{{{a_{PLmotor}} \cdot {x_{motor}}}}{{{b_{PLmotor}} + {x_{motor}}}}} \right] + {c_{PLmotor}} \cdot {x_{motor}}$</span>                                             ()

Table 71. Example Motor Normalized Efficiency Curve Coefficients

Poles

Motor Rated
 Output (hp)

Maximum
 Efficiency

*a<sub>PLmotor</sub>*

*b<sub>PLmotor</sub>*

*c<sub>PLmotor</sub>*

8

1

0.6675

1.096694

0.097126

0.002011

4

1

0.7787

1.092165

0.082060

-0.007200

5

0.8400

1.223684

0.084670

-0.135186

10

0.8745

1.146258

0.045766

-0.110367

25

0.8991

1.137209

0.050236

-0.089150

50

0.9129

1.088803

0.029753

-0.064058

75

0.9259

1.077140

0.029005

-0.049350

100

0.9499

1.035294

0.012948

-0.024708

125

0.9527

1.030968

0.010696

-0.023514



Motor efficiency therefore is:

<span>${\eta_{motor}}({x_{motor}}) = {\eta_{motor,\max }}\left[ {\frac{{{\eta_{motor}}({x_{motor}})}}{{{\eta_{motor,\max }}}}} \right]$</span>                                                          ()

Motor input power (electrical, W) is:

<span>${H_{motor}} = \frac{{{H_{belt}}}}{{{\eta_{motor}}({x_{motor}})}}$</span>                                                                                  ()

*VFD Efficiency and Input Power Model:* For VFDs, published performance data are limited. Data from DOE (2008) suggest using a functional relation similar to that used for motors to represent VFD efficiency (*η<sub>VFD</sub>*) as a function of the fraction of full-load motor input power (*x<sub>VFD</sub> =H<sub>motor</sub>* / *H<sub>motor,max</sub>*), as shown in Figure 216, or as a function of the fraction of full-load speed (*x<sub>VFD</sub> =ω<sub>motor</sub> / ω<sub>motor,max</sub>*), as shown in Figure 217.

![](EngineeringReference/media/image4923.svg.png)

Figure 216. VFD Efficiency vs. Fraction of Motor Full-Load Input Power
 (*Source: DOE 2008*)

![](EngineeringReference/media/image4924.svg.png)

Figure 217. VFD Efficiency vs. Fraction of Full-Load Motor Speed
 (*Courtesy of Saftronics*)

The performance curve (single rectangular hyperbola type 2) used here for VFD efficiency is:

<span>${\eta_{VFD}} = \left[ {\frac{{{a_{VFD}} \cdot {x_{VFD}}}}{{{b_{VFD}} + {x_{VFD}}}}} \right] + {c_{VFD}} \cdot {x_{VFD}}$</span>                                                              ()

Example coefficients derived from the DOE data as a function of the fraction of full-load motor input power are listed in Table 72.

Table 72. Example VFD Efficiency Curve Coefficients

<table class="table table-striped">







<tr>
<td>VFD Rated Output Power (hp)</td>
<td>a<sub>vfd</sub></td>
<td>b<sub>vfd</sub></td>
<td>c<sub>vfd</sub></td>
</tr>
<tr>
<td>3</td>
<td>0.978856</td>
<td>0.034247</td>
<td>-0.007862</td>
</tr>
<tr>
<td>5</td>
<td>0.977485</td>
<td>0.028413</td>
<td>-0.002733</td>
</tr>
<tr>
<td>10</td>
<td>0.978715</td>
<td>0.022227</td>
<td>0.001941</td>
</tr>
<tr>
<td>20</td>
<td>0.984973</td>
<td>0.017545</td>
<td>-0.000475</td>
</tr>
<tr>
<td>30</td>
<td>0.987405</td>
<td>0.015536</td>
<td>-0.005937</td>
</tr>
<tr>
<td>50</td>
<td>0.987910</td>
<td>0.018376</td>
<td>-0.001692</td>
</tr>
<tr>
<td>60</td>
<td>0.971904</td>
<td>0.014537</td>
<td>0.011849</td>
</tr>
<tr>
<td>75</td>
<td>0.991874</td>
<td>0.017897</td>
<td>-0.001301</td>
</tr>
<tr>
<td>100</td>
<td>0.982384</td>
<td>0.012598</td>
<td>0.001405</td>
</tr>
<tr>
<td>&gt;= 200</td>
<td>0.984476</td>
<td>0.009828</td>
<td>-0.004560</td>
</tr>

</table>



VFD input power (electrical, W) is:

<span>${H_{VFD}} = \frac{{{H_{motor}}}}{{{\eta_{VFD}}}}$</span>                                                                                          ()

*System Total Efficiency: T*he combined efficiency of the fan system components (i.e., fan, belt, motor, and VFD) is:

<span>${\eta_{TOTAL}} = {\eta_{fan}} \cdot {\eta_{belt}} \cdot {\eta_{motor}} \cdot {\eta_{VFD}}$</span>    <span>$\left( { = \frac{{{Q_{fan}} \cdot \Delta {P_{fan}}}}{{{H_{VFD}}}}} \right)$</span>                                     ()

*Heat Loss to Air*: To calculate the temperature rise from waste heat entering the air stream from the fan, belt, and motor, it is assumed that the user-specified “motor in air fraction” applies to the belt and motor but not to the VFD. The power “lost” to the air (W) is:

<span>${\dot Q_{toair}} = {H_{fan}} + \left( {{H_{motor}} - {H_{fan}}} \right) \cdot {f_{motortoair}}$</span>                                                    ()

### References

AMCA. 1990a. “Fans and Systems”. Publication 201-90. Arlington Heights, IL: Air Movement and Control Association International.

AMCA. 1990b. “Field Performance Measurement of Fan Systems”. Publication 203-90. Arlington Heights, IL: Air Movement and Control Association International.

ASHRAE. 1993. HVAC 2 Toolkit: Algorithms and Subroutines for Secondary HVAC System Energy Calculations. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 1999. “ANSI/ASHRAE Standard 120 Method of Testing to Determine Flow Resistance of HVAC Ducts and Fittings”. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2008. “ANSI/ASHRAE Standard 126 Method of Testing HVAC Air Ducts and Fittings”. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

DOE. 2003. “MotorMaster 4.0 User Guide”. U.S. Department of Energy, Industrial Technologies Program.



DOE. 2008. “Energy Tips – Motor: Motor Tip Sheet \#11”. U.S. Department of Energy, Industrial Technologies Program. June.



Federspiel, C. 2004. “Detecting Optimal Fan Pressure”. Final Report of Federspiel Controls to the CEC Energy Innovations Small Grant Program. Grant \#: 02-03.

Federspiel, C. 2005. “Detecting Critical Supply Duct Pressure”. ASHRAE Transactions, Vol. 111, Part 1. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Heredos, Francis P. 1987. Selection and Application of Multispeed Motors, IEEE Transactions on Industry Applications, Vol. 1A-23, No. 2, March/April.

Liu, M., D.E. Claridge, and S. Deng. 2003. “An Air Filter Pressure Loss Model for Fan Energy Calculation in Air-Handling Units”. International Journal of Energy Research. Vol. 27, pp. 589-600.

Nadel, S., R.N. Elliot, M. Shepard, S. Greenberg, G. Katz, and A.T. de Almeida. 2002. “Energy-Efficient Motor Systems: A Handbook on Technology, Program, and Policy Opportunities” 2nd Edition. Washington, DC: American Council for an Energy Efficient Economy. p.188.

Sherman, M.H. and C.P. Wray. 2010. “Parametric System Curves: Correlations Between Fan Pressure Rise and Flow for Large Commercial Buildings”. Lawrence Berkeley National Laboratory Report, LBNL-3542E.

Stein, J. and M.M. Hydeman. 2004. “Development and Testing of the Characteristic Curve Fan Model”. ASHRAE Transactions, Vol. 110, Part 1. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Trane. 1999. “Delta-Flo Coils: Data Catalog PL-AH-COIL-000-D-2-799”. LaCrosse, WI: The Trane Company. July.

Air System Compound Component Groups <a name="AirComponentGroups"></a>
------------------------------------

### Unitary Systems

#### Overview

The input object AirLoopHVAC:UnitarySystem provide a “virtual” component that collect and control a set of components: fan, heating coil, cooling coil, and/or reheat coil. Reheat coil is modeled for controlling high zone humidity levels. The unit may be configured to have either a blow through or draw through fan. In a blow through configuration, fan is generally the fist component upstream of heating ro cooling coil. In a draw through fan configuration, fan is placed directly after the heating coil and before reheat coil.

![](EngineeringReference/media/image4930.png)

Figure 218. Schematic of the EnergyPlus Unitary System (Blow Through Configuration)

#### Model Description

As described previously, the unitary system is a “virtual” component consisting of a fan, heating coil, cooling coil and reheat coil. The sole purpose of the unitary system model is to properly coordinate the operation of the various system components. The following sections describe the flow of information within the model, as well as the differences between cycling and continuous supply air fan operation.

#### Controls

There are two types of control types allowed to be specified in the unitary system which are setpoint based and load based. Each control type is described in detail below.



Setpoint based control:

The unitary system calculates the current sensible load using the temperature of the inlet node and the System Node Setpoint Temp on the control node. If the control node is not the outlet node, the desired outlet node temperature is adjusted for the current temperature difference between the outlet node and the control node. Likewise, the current latent load is calculated using the humidity ratio of the inlet node and the System Node Humidity Ratio Max on the control node. The controls determine the required coil run-time fraction and dehumidification mode (if applicable) using the steps outlined below.

##### Step 1 – Meet Sensible Load Requirement

The controls first attempt to meet the sensible requirement. The specified coil model is called with a part-load ratio (PLR) of 1.0 to determine the full-load output of the coil. This is compared with the desired outlet node temperature and a sensible PLR is calculated. If the PLR is &lt;1.0, a Regula-Falsi iteration routine is called to determine the coil run-time fraction which results in the desired outlet node temperature. For a variable-speed DX cooling coil, if the load is smaller than the sensible capacity at the lowest speed, the coil run-time fraction is determined in the same way as a single-speed DX cooling coil. Otherwise, its speed number and speed ratio between two neighboring speeds are selected to match the load.

##### Step 2 – Meet Latent Load Requirement (if activated)

If dehumidification controls are active, the leaving humidity ratio resulting from operation to meet the sensible load (Step 1 above) is compared with the desired outlet node humidity ratio. If the humidity requirement is already met, then no further control action is taken. If the humidity requirement has not been met, then the coil is re-simulated depending on the type of humidity control.

##### Step 2a – Humidity Control = MultiMode

If the humidity control type is MultiMode, then the coil's enhanced dehumidification mode is activated when the coil type is Coil:Cooling:DX:TwoStageWithHumidityControlMode and Step 1 above is repeated to meet the sensible load using the coil performance resulting from the enhanced dehumidificaiton mode. This is a semi-passive approach to dehumidification which may fall short or may exceed the dehumidification requirement.

##### Step 2b – Humidity Control = CoolReheat

If the humidity control type is CoolReheat, the coil is re-simulated to achieve the desired outlet node humidity ratio. This option is valid for all cooling coil types. When the coil type is Coil:Cooling:DX:TwoStageWithHumidityControlMode, only the cooling performance mode is used for this step and enhanced dehumidification mode is not activated.



Load based control:

While the unitary system may be configured to serve multiple zones, system operation is controlled by a thermostat located in a single “control” zone. One of the key parameters for the unitary system component is the fraction of the total system air flow that goes through the control zone. This fraction is calculated as the ratio of the maximum air mass flow rate for the air loop’s supply inlet node for the control zone (e.g., AirTerminal:SingleDuct:Uncontrolled, field = Maximum Air Flow Rate, converted to mass flow) to the sum of the maximum air mass flow rates for the air loop’s supply inlet nodes for all zones served by this air loop. The unitary system module scales the calculated load for the control zone upward based on this fraction to determine the total load to be met by the unitary system. The module then proceeds to calculate the required part-load ratio for the system coil and the supply air fan to meet this total load. The heating or cooling capacity delivered by the unitary system is distributed to all of the zones served by this system via the terminal units that supply air to each zone. The supply air fraction that goes though the control zone is calculated as follows:

<div>$$Control Zone Air Flow\,Fraction = \frac{{{{\dot m}_{TUMax\,ControlZone}}}}{{\sum\limits_{j = 1}^{NumOfZones} {{{\dot m}_{TUMax\,Zone\,j}}} }}$$</div>

where:

<span>${\dot m_{TUMax\,ControlledZone}}$</span>    =    maximum air mass flow rate for the air loop’s supply inlet node (terminal unit) for the control zone (kg/s)

<span>${\dot m_{TUMax\,Zone\,j}}$</span>            =    maximum air mass flow rate for the air loop’s supply inlet node for the jth zone (kg/s)

<span>$NumOfZones$</span>                =    number of zones, or number of air loop supply air inlet nodes for all zones served by the air loop (-)

The unitary system component is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Fan:OnOff must be used to model AUTO fan, while Fan:OnOff or Fan:ConstantVolume can be used to model fan ON. The fan operation mode is specified using a supply air fan operating mode schedule where schedule values of 0 denote cycling fan operation and schedule values other than 0 (a 1 is usually used) denote continuous fan operation. Using this schedule, the unitary system fan may be cycled with cooling or heating coil operation or operated continuously based on time of day (e.g., cycling fan operation at night and continuous fan operation during the daytime). If the fan operating mode schedule name field is left blank in the unitary system object, the unitary system assumes cycling or AUTO fan mode operation throughout the simulation.

The unitary system operates based on the user-specified (or autosized) design supply air flow rate(s). The ‘design’ supply air mass flow rate may be different for cooling, heating, and when no cooling or heating is required and the fan operates continuously based on user-specified inputs.

**Cooling Operation**

If EnergyPlus determines that the unitary system must supply cooling to the control zone to meet the zone air temperature setpoint, then the model computes the total sensible cooling load to be met by the unitary system based on the control zone sensible cooling load and the fraction of the unitary system air flow that goes through the control zone.

<div>$$UnitarySystemCoolingLoad = \frac{{ControlZoneCoolingLoad}}{{ControlZoneAirFlowFraction}}$$</div>

If the supply air fan operating mode schedule requests cycling fan operation, the model first checks for the presence of an ecomomizer in the outside air system serving the unitary system’s air loop (Ref. AirLoopHVAC:OutdoorAirSystem). If an outside air system is not present or if an air-side economizer is not used, the unitary system’s compressor is used to meet the unitary system cooling load. If an air-side economizer is used and is active (i.e., economizer controls indicate that conditions are favorable to increase the outside air flow rate), the unitary system will try to meet the cooling load by operating only the supply air fan. If the fan is able to satisfy the unitary system cooling load, the compressor remains off for the entire simulation time step. If the operation of the fan alone is unable to meet the entire cooling load, then the compressor is enabled and additional calculations are performed to determine the compressor’s part-load ratio.

The model then calculates the unitary system’s sensible cooling energy rate delivered to the zones being served when the system runs at full-load conditions and when the cooling coil is OFF. If the supply air fan cycles with the compressor, then the sensible cooling energy rate is zero when the cooling coil is OFF. However if the fan is configured to run continuously regardless of coil operation, then the sensible cooling energy rate will probably not be zero when the cooling coil is OFF. Calculating the sensible cooling energy rate involves modeling the supply air fan (and associated fan heat), the cooling coil, and the heating and reheat coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node). For each of these cases (full load and cooling coil OFF), the sensible cooling energy rate delivered by the unitary system is calculated as follows:



<div>$$Full\;Cool\;Output = (Mass\;Flow\;Rat{e_{ful\;load}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;full\;load}}$$</div>

<div>$$No\;Cool\;Output = (Mass\;Flow\;Rat{e_{coil\;off}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*Mass Flow Rate<sub>full\\ load</sub>* = air mass flow rate through unitary system at full-load conditions, kg/s

*h<sub>out,\\ full\\ load</sub>* = enthalpy of air exiting the unitary system at full-load conditions, J/kg

*h<sub>control\\ zone</sub>*<sub> </sub> = enthalpy of air in the control zone (where thermostat is located), J/kg

*HR<sub>min</sub>      =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio

of the unitary system exiting air or the air in the control zone

*Mass Flow Rate<sub>coil\\ off</sub>* = air mass flow rate through the unitary system with the cooling coil OFF, kg/s

*h<sub>out,\\ coil\\ off</sub>*  = enthalpy of air exiting the unitary system with the cooling coil OFF, J/kg

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;full\;load}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{full\;load}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{coil\;off}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

With the calculated sensible cooling energy rates and the total sensible cooling load to be met by the system, the part-load ratio for the unitary system is estimated.

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{\left( {UnitarySystemCoolingLoad - NoCoolOutput} \right)}}{{\left( {FullCoolOutput - NoCoolOutput} \right)}}} \right)$$</div>

Since the part-load performance of the cooling coil is frequently non-linear, and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the unitary system’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the unitary system’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {UnitarySystemCoolingLoad - {Q_{UnitarySystem}}} \right)}}{{UnitarySystemCoolingLoad}}$$</div>

where:

<span>${Q_{UnitarySystem}}$</span>= Unitary system delivered sensible capacity (W)

If the unitary system has been specified with cycling fan/cycling coil (AUTO fan), then the unitary system’s operating supply air mass flow rate is multiplied by PartLoadRatio to determine the average air mass flow rate for the system simulation time step. In this case, the air conditions at nodes downstream of the cooling coil represent the full-load (steady-state) values when the coil is operating.

If the fan operates continuously (i.e., when the supply air fan operating mode schedule values are NOT equal to 0), the operating air mass flow rate through the unitary system is calculated as the average of the user-specified air flow rate when the cooling coil is ON and the user-specified air flow rate when the cooling coil is OFF (user-specified supply air volumetric flow rates converted to dry air mass flow rates).

<div>$${\mathop m\limits^ \bullet_{UnitarySystem}} = PartLoadRatio\left( {{{\mathop m\limits^ \bullet  }_{CoolCoilON}}} \right) + \left( {1 - PartLoadRatio} \right)\left( {{{\mathop m\limits^ \bullet  }_{CoilOFF}}} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  CoolCoilON$</span> = air mass flow rate through unitary system when the cooling coil is ON (kg/s)

<span>$\mathop m\limits^ \bullet  CoilOFF$</span> = air mass flow rate through unitary system when no cooling or heating is needed (kg/s)

In this case, the air conditions at nodes downstream of the cooling coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and inlet air conditions when the coil is OFF).



**Cooling Operation (multi or variable speed coils)**

After the unitary system cooling load is determined as described in Eq. above, the multi or variable speed cooling coil models calculations are described in this section.

The model calculates the unitary system’s sensible cooling energy rate delivered to the zones being served when the system runs at full-load conditions at the highest speed and when the DX cooling coil is OFF. If the supply air fan cycles with the compressor, then the sensible cooling energy rate is zero when the cooling coil is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible cooling energy rate will not be zero when the cooling coil is OFF. Calculating the sensible cooling energy rate involves modeling the supply air fan (and associated fan heat) and the multi/variable speed DX cooling coil. The multi/variable speed DX heating coil and the supplemental heating coil are also modeled, but only to pass the air properties and mass flow rate from their inlet nodes to their outlet nodes. For each of these cases (full load at highest cooling speed and DX cooling coil OFF), the sensible cooling energy rate delivered by the unitary system is calculated as follows:

<span>$FullCoolOutpu{t_{Highest\;Speed}} = ({\dot m_{HighestSpeed}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;HighestSpeed}}$</span><span>$NoCoolOutput = ({\dot m_{CoilOff}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$</span>

where:

*<span>${\dot m_{HighestSpeed}}$</span>* = air mass flow rate through unitary system at the highest cooling speed [kg/s]

*h<sub>out,\\ full\\ load</sub>*   = enthalpy of air exiting the unitary system at full-load conditions [J/kg]

*h<sub>control \\ zone</sub>*   = enthalpy of air leaving the control zone (where thermostat is located) [J/kg]

*HR<sub>min</sub>=* the minimum humidity ratio of the unitary system exiting air or the air leaving the control zone [kg/kg]

<span>${\dot m_{CoilOff}}$</span> = air mass flow rate through the unitary system with the cooling coil OFF [kg/s]

*h<sub>out,coil \\ off</sub>*    = enthalpy of air exiting the unitary system with the cooling coil OFF [J/kg]

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;HighestSpeed}} = \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad \quad  + \left( {{{\dot m}_{_{HighestSpeed}}} - \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the cooling coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {{{\dot m}_{_{coil\;off}}} - \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>



If the unitary system’s sensible cooling rate at the highest speed (full load, no cycling) is insufficient to meet the entire cooling load, the controlled zone conditions will not be met. The reported cycling rate and speed ratio are 1, and the speed number is set to the highest index number. If the total sensible cooling load to be met by the system is less than the sensible cooling rate at the highest speed, then the following steps are performed.

·        Calculate the sensible cooling energy rate at Speed 1

<div>$$FullCoolOutpu{t_{Speed1}} = ({\dot m_{Speed1}}){({h_{out,fullload}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;Speed1}}$$</div>

where

*<span>${\dot m_{Speed1}}$</span>* = air mass flow rate through unitary system at Speed 1 [kg/s]

Δ<sub>sen,</sub> <sub>Speed1</sub>**=Sensible load difference between the system output node and the zone inlet node at full-load conditions at Speed 1

<div>$$\begin{array}{l}{\Delta_{sen,\;Speed1}} = \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {{{\dot m}_{_{Speed1}}} - \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

·        If the sensible cooling energy rate delivered by the unitary system at Speed 1 is greater or equal to the sensible load, the cycling ratio (part-load ratio) for the unitary system is estimated.

<div>$$\begin{array}{l}CyclingRatio = \frac{{\left( {ABS(CoolingCoilSensibleLoad)} \right)}}{{FullCoolingCoilCapacity}}\\ = MAX\left( {0.0,\frac{{\left( {UnitarySystemCoolingLoad - AddedFanHeat} \right)}}{{\left( {FullCoolOutpu{t_{speed1}} - AddedFanHea{t_{speed1}}} \right)}}} \right)\end{array}$$</div>



where

AddedFanHeat  = generated supply air fan heat, which is a function of part load ratio and as internal component cooling load [W].

AddedFanHeat<sub>Speed1</sub>        = generated supply air fan heat at Speed 1 (part load ratio=1) [W].

Since the part-load performance of the DX cooling coil is frequently non-linear,and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the unitary system’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the unitary system’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {UnitarySystemOutpu{t_{cycling}} - {Q_{UnitarySystem}}} \right)}}{{UnitarySystemCoolingLoad}}$$</div>

where:

Unitary systemOutput<sub>Cycling</sub> = unitary system delivered sensible capacity for Speed 1 operating at a specific cycling ratio (W)

<div>$$UnitarySystemOutpu{t_{cycling}} = {\mathop m\limits^ \bullet_{UnitarySystem}}{\left( {{h_{out}} - {h_{ControlZone}}} \right)_{HR\min }} - {\Delta_{cycling}}$$</div>

where

<span>${\mathop m\limits^ \bullet_{UnitarySystem}}$</span>      = average air mass flow rate defined in the next section [kg/s]

h<sub>out,</sub>        = enthalpy of air exiting the unitary system at part load conditions [J/kg]

Δ<sub>cycling</sub>    =average sensible load difference between the system output node and the zone inlet node

<div>$${\Delta_{cycling}} = \frac{{{{\mathop m\limits^ \bullet  }_{ZoneInlet}}}}{{frac}}\left( {{h_{ZoneInlet}} - {h_{ControlZone}}} \right) + \left( {{{\mathop m\limits^ \bullet  }_{UnitarySystem}} - \frac{{{{\mathop m\limits^ \bullet  }_{ZoneInlet}}}}{{frac}}} \right)\left( {{h_{Out}} - {h_{ControlZone}}} \right)$$</div>



<span>${\dot m_{_{ZoneInlet}}}$</span> = Air mass flow rate in the supply inlet node in the controlled zone [kg/s]

For this case where speed 1 operation was able to meet the required cooling load, the speed ratio is set to zero and speed number is equal to 1.

·        If the unitary system’s cooling output at full load for Speed 1 is insufficient to meet the entire cooling load, the Cycling ratio is set equal to 1.0 (compressor and fan are not cycling). Then the cooling speed is increased and the delivered sensible capacity is calculated. If the full load sensible capacity at Speed n is greater than or equal to the sensible load, the speed ratio for the unitary system is estimated:

<div>$$SpeedRatio = \frac{{ABS\left( {UnitarySystemCoolingLoad - AddedFanHeat - FullCoolOutpu{t_{Speedn - 1}}} \right)}}{{ABS\left( {FullCoolOutpu{t_{Speedn}} - FullCoolOutpu{t_{Speedn - 1}}} \right)}}$$</div>

Although a linear relationship is assumed by applying the speed ratio to obtain the effective capacity and mass flow rate between speed n and n-1, the outlet air node conditions are dependent on the combined outputs and may not be linear. In addition, the supply air fan heat varies with the speed ratio due to different supply mass flow rates between speed n and n-1 . Therefore, the final speed ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the unitary system’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the unitary system’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {UnitarySystemCoolingLoad - UnitarySystemOutpu{t_{SpeedRatio}}} \right)}}{{UnitarySystemCoolingLoad}}$$</div>

where:

Unitary systemOutput<sub>Speed,n</sub>= unitary system delivered sensible capacity between two consecutive speeds at a specific speed ratio (W)

<div>$$\begin{array}{l}UnitarySystemOutpu{t_{SpeedRatio}} = (SpeedRatio)FullCoolOutpu{t_{speedn}} + \\\(1 - SpeedRatio)FullCoolOutpu{t_{speedn - 1}} - AddedFanHea{t_{SpeedRatio}}\end{array}$$</div>

Where

AddedFanHeat<sub>SpeedRatio</sub>          = generated supply air fan heat at a specific speed ratio [W]

In this case, the reported cycling ratio is 1 and speed number is equal to n.

##### Air Mass Flow Rate Calculation

Speed 1 operation

If the unitary system has been specified with cycling fan/cycling coil (AUTO fan), then the unitary system’s operating supply air mass flow rate is determined by the cycling ratio (PartLoadRatio) for Speed 1. The supply air mass flow rate is multiplied by the cycling ratio to determine the average air mass flow rate for the system simulation time step. The air conditions at nodes downstream of the cooling coils represent the full-load (steady-state) values when the coil is operating.

<div>$${\mathop m\limits^ \bullet_{UnitarySystem}} = \left( {CyclingRatio} \right){\mathop m\limits^ \bullet_{speed1}}$$</div>

If the fan operates continuously (i.e., when the supply air fan operating mode schedule values are NOT equal to 0), the operating air mass flow rate through the unitary system is calculated as the average of the user-specified air flow rate when the unitary system cooling coil is ON at Speed 1 and the user-specified air flow rate when the unitary system cooling coil is OFF (user-specified supply air volumetric flow rates converted to dry air mass flow rates).

<div>$${\mathop m\limits^ \bullet_{UnitarySystem}} = \left( {CyclingRatio} \right){\mathop m\limits^ \bullet_{speed1}} + \left( {1 - CyclingRatio} \right){\mathop m\limits^ \bullet_{coiloff}}$$</div>

where:

<span>${\mathop m\limits^ \bullet_{UnitarySystem}}$</span> = average air mass flow rate through unitary system [kg/s]

<span>${\dot m_{Speed1}}$</span>= air mass flow rate through unitary system when cooling coil is ON at Speed 1 [kg/s]

<span>${\dot m_{CoilOff}}$</span> = air mass flow rate through unitary system when no heating or cooling is needed [kg/s]

In this case, the air conditions at nodes downstream of the cooling coils are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and inlet air conditions when the coil is OFF).

##### Higher Speed Operation

When the unitary system operates at higher speeds to meet the required cooling load, the supply air mass flow rate is linearly interpolated between two consecutive speeds:

<div>$${\mathop m\limits^ \bullet_{UnitarySystem}} = \left( {SpeedRatio} \right){\mathop m\limits^ \bullet_{Speedn}} + \left( {1 - SpeedRatio} \right){\mathop m\limits^ \bullet_{Speedn - 1}}$$</div>

where:

<span>${\mathop m\limits^ \bullet_{UnitarySystem}}$</span>= average air mass flow rate through the unitary system for the time step [kg/s]

<span>${\dot m_{Speed\;n}}$</span>= air mass flow rate through unitary system when cooling coil is ON at Speed n [kg/s]

<span>${\dot m_{Speed\;n - 1}}$</span>= air mass flow rate through unitary system when cooling coil is ON at Speed n-1 [kg/s]

For this case of higher speed operation, the air conditions at nodes downstream of the cooling coils are determined by the delivered cooling capacity and supply air mass flow rates between two consecutive speeds.

Although the above sections present the capacity and air mass flow rate calculation separately, they are dependent and change every iteration until convergence is reached for the time step being simulated.



**Heating Operation**

Calculations for heating operation are similar to those for cooling operation in most respects. However, due to the inclusion of a supplemental heating coil, additional calculations are necessary to properly meet the total heating load for the zones being served.

If EnergyPlus determines that the unitary system must supply heating to the control zone to meet the zone air temperature setpoint, then the unitary system model computes the total sensible heating load to be delivered to the zones being served based on the control zone sensible heating load and the control zone airflow fraction.

<div>$$UnitarySystemHeatingLoad = \frac{{ControlZoneHeatingLoad}}{{ControlZoneAirFlowFraction}}$$</div>

The model then calculates the unitary system’s sensible heating energy rate delivered to the zones being served when the system runs at full-load conditions and when the heating coil is OFF (without supplemental heater operation in either case). If the supply air fan cycles with the compressor, then the sensible heating energy rate is zero when the compressor is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible heating energy rate will not be zero when the compressor is OFF. Calculating the sensible heating energy rate involves modeling the supply air fan (and associated fan heat), the  cooling coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node), the  heating coil, and the supplemental heating coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node). For each of these cases (full load and  heating coil OFF, without supplemental heater operation in either case), the sensible heating energy rate delivered by the unitary system is calculated as follows:

<div>$$Full\;Heat\;Output = (Mass\;Flow\;Rat{e_{ful\;load}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;full\;load}}$$</div>

<div>$$No\;Heat\;Output = (Mass\;Flow\;Rat{e_{coil\;off}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*Mass Flow Rate <sub>full\\ load</sub>*  = air mass flow rate through unitary system at full-load conditions, kg/s

*h<sub>out,\\ full\\ load</sub>*  = enthalpy of air exiting the unitary system at full-load conditions, J/kg

*h<sub>control \\ zone</sub>*  = enthalpy of air leaving the control zone (where thermostat is located), J/kg

*HR<sub>min</sub>=* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the unitary system exiting air or the air leaving the control zone

*Mass Flow Rate <sub>coil \\ off</sub>*  = air mass flow rate through the unitary system with the heating coil OFF, kg/s

*h<sub>out,\\ coil \\ off</sub>*  = enthalpy of air exiting the unitary system with the heating coil OFF, J/kg

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;full\;load}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{full\;load}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{coil\;off}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

With the calculated sensible heating energy rates and the total sensible heating load to be met by the system, the part-load ratio for the unitary system is estimated.

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{\left( {UnitarySystemHeatingLoad - NoHeatOutput} \right)}}{{\left( {FullHeatOutput - NoHeatOutput} \right)}}} \right)$$</div>

Since the part-load performance of the  heating coil is frequently non-linear, and the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the heating coil compressor and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the unitary system’s heating output matches the heating load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the unitary system’s heating output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {UnitarySystemHeatingLoad - {Q_{UnitarySystem}}} \right)}}{{UnitarySystemHeatingLoad}}$$</div>

where:

<span>${Q_{UnitarySystem}}$</span>= Unitary system delivered sensible capacity (W)

If the unitary system’s  heating coil output at full load is insufficient to meet the entire heating load, PartLoadRatio is set equal to 1.0 (compressor and fan are not cycling) and the remaining heating load is passed to the supplemental heating coil. If the unitary system model determines that the outdoor air temperature is below the minimum outdoor air temperature for compressor operation, the compressor is turned off and the entire heating load is passed to the supplemental gas or electric heating coil. The unitary system exiting air conditions and energy consumption are calculated and reported by the individual component models (fan,  heating coil, and supplemental gas or electric heating coil).

If the unitary system has been specified with cycling fan/cycling coil (AUTO fan), then the unitary system’s operating supply air mass flow rate is multiplied by PartLoadRatio to determine the average air mass flow rate for the system simulation time step. The air conditions at nodes downstream of the heating coils represent the full-load (steady-state) values when the coils are operating. If the fan operates continuously (i.e., when the supply air fan operating mode schedule values are NOT equal to 0), the operating air mass flow rate through the unitary system is calculated as the average of the user-specified air flow rate when the unitary system heating coil is ON and the user-specified air flow rate when the unitary system heating coil is OFF (user-specified supply air volumetric flow rates converted to dry air mass flow rates).

<div>$${\mathop m\limits^ \bullet_{UnitarySystem}} = PartLoadRatio\left( {{{\mathop m\limits^ \bullet  }_{HeatCoilON}}} \right) + \left( {1 - PartLoadRatio} \right)\left( {{{\mathop m\limits^ \bullet  }_{CoilOFF}}} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  HeatCoilON$</span> = air mass flow rate through unitary system when the heating coil is ON (kg/s)

<span>$\mathop m\limits^ \bullet  CoilOFF$</span> = air mass flow rate through unitary system when no heating or cooling is needed (kg/s)

In this case, the air conditions at nodes downstream of the heating coils are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coils are operating and inlet air conditions when the coils are OFF).



#### Heating Operation (multi or variable speed coils )

After the unitary system heating load is determined as described in Eq. above, the multi or variable speed heating coil models calculation are described in this section.

The model calculates the unitary system’s sensible heating energy rate delivered to the zones being served when the system runs at full-load conditions at the highest speed and when the DX heating coil is OFF (without supplemental heater operation in either case). If the supply air fan cycles with the compressor, then the sensible heating energy rate is zero when the compressor is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible heating energy rate will not be zero when the compressor is OFF. Calculating the sensible heating energy rate involves modeling the supply air fan (and associated fan heat), the DX cooling coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node), the DX heating coil, and the supplemental heating coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node). For each of these cases (full load and DX heating coil OFF, without supplemental heater operation in either case), the sensible heating energy rate delivered by the unitary system is calculated as follows:

<div>$$FullHeatOutpu{t_{Highest\;Speed}} = ({\dot m_{HighestSpeed}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;HighestSpeed}}$$</div>

<div>$$NoHeatOutput = ({\dot m_{CoilOff}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*<span>${\dot m_{HighestSpeed}}$</span>* = air mass flow rate through unitary system at the highest heating speed [kg/s]

*h<sub>out,\\ full\\ load</sub>*   = enthalpy of air exiting the unitary system at full-load conditions [J/kg]

*h<sub>control \\ zone</sub>*   = enthalpy of air leaving the control zone (where thermostat is located) [J/kg]

*HR<sub>min</sub>=* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the unitary system exiting air or the air leaving the control zone

<span>${\dot m_{CoilOff}}$</span>= air mass flow rate through the unitary system with the heating coil OFF [kg/s]

*h<sub>out,coil \\ off</sub>*    = enthalpy of air exiting the unitary system with the heating coil OFF [J/kg]

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;HighestSpeed}} = \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad \quad  + \left( {{{\dot m}_{_{HighestSpeed}}} - \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {{{\dot m}_{_{coil\;off}}} - \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

If the unitary system’s DX heating coil output full load at the highest speed is insufficient to meet the entire heating load, the remaining heating load is passed to the supplemental heating coil. If the unitary system model determines that the outdoor air temperature is below the minimum outdoor air temperature for compressor operation (specified by the user), the compressor is turned off and the entire heating load is passed to the supplemental gas or electric heating coil. The unitary system exiting air conditions and energy consumption are calculated and reported by the individual component models (fan, DX heating coil, and supplemental gas or electric heating coil).

If the total heating load to be met by the system is less than the sensible heating rate at the highest speed, then the following steps are performed.

1.    Calculate the sensible heating energy rate at Speed 1

<div>$$FullHeatOutpu{t_{Speed1}} = ({\dot m_{Speed1}}){({h_{out,fullload}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;Speed1}}$$</div>

where:

*<span>${\dot m_{Speed1}}$</span>* = air mass flow rate through unitary system at Speed 1 [kg/s]

Δ<sub>sen,</sub> <sub>Speed1</sub>**=Sensible load difference between the system output node and the zone inlet node at full-load conditions at Speed 1

<div>$$\begin{array}{l}{\Delta_{sen,\;Speed1}} = \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {{{\dot m}_{_{Speed1}}} - \frac{{{{\dot m}_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

2.    If the sensible heating energy rate delivered by the unitary system at Speed 1 is greater or equal to the sensible load, the cycling ratio (part-load ratio) for the unitary system is estimated.

<div>$$\begin{array}{l}CyclingRatio = \frac{{\left( {ABS(HeatingCoilSensibleLoad)} \right)}}{{FullHeatingCoilCapacity}}\\ = MAX\left( {0.0,\frac{{\left( {UnitarySystemHeatingLoad - AddedFanHeat} \right)}}{{\left( {FullHeatOutpu{t_{speed1}} - AddedFanHea{t_{speed1}}} \right)}}} \right)\end{array}$$</div>



where

AddedFanHeat        = generated supply air fan heat, which is a function of part load ratio and as internal component heating load [W].

AddedFanHeat<sub>Speed1</sub>  = generated supply air fan heat at Speed 1 (part load ratio=1) [W].

Since the part-load performance of the DX heating coil is frequently non-linear, and the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the heating coil compressor and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the unitary system’s heating output matches the heating load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the unitary system’s heating output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {UnitarySystemHeatingLoad - UnitarySystemOutpu{t_{cycling}}} \right)}}{{UnitarySystemHeatingLoad}}$$</div>

where:

Unitary systemOutput<sub>Cycling</sub>= unitary system delivered sensible capacity for Speed 1 operating at a specific cycling ratio (W)

<div>$$UnitarySystemOutpu{t_{cycling}} = {\mathop m\limits^ \bullet_{UnitarySystem}}{\left( {{h_{out}} - {h_{ControlZone}}} \right)_{HR\min }} - {\Delta_{cycling}}$$</div>

where

<span>${\mathop m\limits^ \bullet_{UnitarySystem}}$</span> = average air mass flow rate defined in the next section [kg/s]

h<sub>out,</sub>              = enthalpy of air exiting the unitary system at part load conditions [J/kg]

Δ<sub>cycling</sub>          =average sensible load difference between the system output node and the zone inlet node

<div>$${\Delta_{cycling}} = \frac{{{{\mathop m\limits^ \bullet  }_{ZoneInlet}}}}{{frac}}\left( {{h_{ZoneInlet}} - {h_{ControlZone}}} \right) + \left( {{{\mathop m\limits^ \bullet  }_{UnitarySystem}} - \frac{{{{\mathop m\limits^ \bullet  }_{ZoneInlet}}}}{{frac}}} \right)\left( {{h_{Out}} - {h_{ControlZone}}} \right)$$</div>

<span>${\dot m_{_{ZoneInlet}}}$</span>       = Air mass flow rate in the supply inlet node in the controlled zone [kg/s]

For this case where speed 1 operation was able to meet the required heating load, the speed ratio is set to zero and speed number is equal to 1.

3.    If the unitary system’s heating output at full load for Speed 1 is insufficient to meet the entire heatling load, the Cycling ratio (PartLoadRatio) is set equal to 1.0 (compressor and fan are not cycling). Then the heating speed is increased and the delivered sensible capacity is calculated. If the full load sensible capacity at Speed n is greater than or equal to the sensible load, the speed ratio for the unitary system is estimated:

<div>$$SpeedRatio = \frac{{ABS\left( {UnitarySystemHeatingLoad - AddedFanHeat - FullHeatOutpu{t_{Speedn - 1}}} \right)}}{{ABS\left( {FullHeatOutpu{t_{Speedn}} - FullHeatOutpu{t_{Speedn - 1}}} \right)}}$$</div>

Although a linear relationship is assumed by applying the speed ratio to obtain the effective capacity and air mass flow rate between speed n and n-1, the outlet node conditions are dependent on the combined outputs and may not be linear. In addition, the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan). Therefore, the final speed ratio for the heating coil compressor and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the unitary system’s heating output matches the heating load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the unitary system’s heating output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {UnitarySystemHeatingLoad - UnitarySystemOutpu{t_{SpeedRatio}}} \right)}}{{UnitarySystemHeatingLoad}}$$</div>

where:

UnitarySystemOutput<sub>SpeedRatio</sub>= unitary system delivered sensible capacity between two consecutive speeds at a specific ratio [W]

<div>$$\begin{array}{l}UnitarySystemOutpu{t_{SpeedRatio}} = (SpeedRatio)FullHeatOutpu{t_{speedn}} + \\\(1 - SpeedRatio)FullHeatOutpu{t_{speedn - 1}} - AddedFanHea{t_{SpeedRatio}}\end{array}$$</div>

Where

AddedFanHeat<sub>SpeedRatio</sub>          = generated supply air fan heat at a specific speed ratio [W]

In this case, the reported cycling ratio is 1 and speed number is equal to n.

##### Air Mass Flow Rate Calculation

The air mass flow rate calculations during heating operation are the same as those described above for cooling operation for multi/variable speed.

#### High Humidity Control

The specific configuration of the unitary system with supplemental heating coil is shown above (see Figure 227). This figure shows the fan placement when a blow through fan is specified. If a draw through fan is specified, the fan is located between the heating coil and the supplemental heating coil. The system is controlled to keep the high relative humidity in the control zone from exceeding the setpoint specified in the object ZoneControl:Humidistat. This option is available when the supply air fan operates continuously (i.e., the supply air fan operating mode schedule values are never equal to 0) or the supply air fan cycles with the compressor. In addition, when high humidity control is specified and the compressor operates, the unitary system operates at the cooling air flow rate when a zone heating load is present as determined by the zone thermostat. High humidity control is specified as either None, MultiMode, or CoolReheat in the Dehumidification Control Type input field. MultiMode is specified when a heat exchanger is used to improve the dehumidification performance of the cooling coil. The heat exchanger will be activated when the sensible part-load ratio is insufficient to meet the zone latent load. CoolReheat is specified when a cooling coil is used to over-cool the supply air stream in order to meet the zone latent load. In this case, a supplemental heating coil will ensure the zone temperature does not fall below the zone heating temperature set point. When a heat exchanger is used in conjunction with a cooling coil and CoolReheat is specified as the Dehumidification Control Type, the heat exchanger is “locked on” to meet either the sensible or latent cooling load. If the dehumidification control type is selected as None and a heat exchanger assisted cooling coil is used, the heat exchanger is “locked on” and the air conditioner runs only to meet the sensible cooling load. A supplemental heating coil is required for all dehumidification control types.

The model first calculates the *PartLoadRatio* required to meet the sensible cooling load.  The unitary system’s sensible cooling load is determined from the control zone sensible cooling load to the cooling setpoint and the control zone air flow fraction to maintain the dry-bulb temperature setpoint in the control zone.:

<div>$$UnitarySystemCoolingLoad = \frac{{ControlZoneCoolingLoad}}{{ControlZoneAirFlowFraction}}$$</div>



The unitary system’s sensible cooling load to be met and the full load cooling output are used to calculate the sensible the part-load ratio iteratively based on user specified convergence criterion.

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{\left( {UnitarySystemCoolingLoad - NoCoolOutput} \right)}}{{\left( {FullCoolOutput - NoCoolOutput} \right)}}} \right)$$</div>

hen the unitary system’s sensible cooling capacity meets the system sensible cooling load at a given sensible part load ratio, then the Unitary system meets the controlled zone cooling setpoint temperature. If a moisture (latent) load exists because the control zone humidity has exceeded the setpoint, the total moisture load to be met by the unitary systems (Unitary systemMoistureLoad) is calculated based on the control zone moisture load and the control zone air flow fraction.

<div>$$UnitarySystemMoistureLoad = \frac{{ControlZoneMoistureLoad}}{{ControlZoneAirFlowFraction}}$$</div>

Then the *LatentPartLoadRatio* required to meet the high humidity setpoint is calculated as follows:

<span>$LatentPartLoadRatio = MIN\left( {PL{R_{Min}},\frac{{\left( {UnitarySystemMoistureLoad - NoLatentOutput} \right)}}{{\left( {FullLatentOutput - NoLatentOutput} \right)}}} \right)$</span>The model uses the greater of the two part-load ratios, *PartLoadRatio* or *LatentPartLoadRatio*, to determine the operating part-load ratio of the Unitary system’s DX cooling coil.

<div>$$LatentPartLoadRatio = MAX\left( {PartLoadRatio,LatentPartLoadRatio} \right)$$</div>

As previously described, iterations are performed to converge on the solution within the convergence tolerance.

Where,

<span>$ControlZoneCoolingLoad$</span>= the control zone sensible cooling load to the cooling setpoint, (W).

<span>$ControlZoneMoistureLoad$</span>          = the control zone moisture load to the dehumidifying relative humidity setpoint, (W).

<span>$ControlZoneAirFlowFraction$</span>     = the supply air fraction that goes though the control zone, (-).

<span>$FullLatentOutput$</span> =the Unitary system’s latent cooling energy rate at full-load conditions, W

<span>$NoLatentOutput$</span>   = the Unitary system’s latent cooling energy rate with cooling coil OFF, W

<span>$PartLoadRatio$</span>     = the unitary system’s part-load-ratio required to meet system sensible load, (-).

<span>$LatentPartLoadRatio$</span>= the unitary system’s part-load-ratio required to meet system moisture load, (-).

<span>$PL{R_{Min}}$</span>*=*the minimum part-load ratio, which is usually 0.0. For the case when the latent capacity degradation model is used (Ref: DX Cooling Coil Model), this value is the minimum part-load ratio at which the cooling coil will dehumidify the air.

When the predicted zone air temperature is above the heating setpoint and if there is a dehumidification load, the supplemental heating coil load is required to offset the excess cooling as shown in Figure 228. If the model determines that the LatentPartLoadRatio is to be used as the operating part-load ratio of the unitary system’s cooling coil, the supplemental heating coil is used to offset the excess sensible capacity provided by the unitary system cooling coil. The model first checks the sensible load that exists for the current simulation time step (predicted zone temperature with no HVAC operation compared to the thermostat setpoint temperatures). If a sensible cooling load or no sensible cooling or heating load exists, the model calculates the difference between the sensible heating load required to reach or maintain the heating dry-bulb temperature setpoint and the actual sensible cooling energy rate delivered by the unit (with LatentPartLoadRatio). In this case, thesupplemental heating coil is used to offset the excess sensible cooling energy provided by the cooling coil (if any) that could have caused an overshoot of the heating dry-bulb temperature setpoint. Note that when a humidistat is used and high humidity control is required, the zone dry-bulb temperature will typically move toward the heating temperature setpoint when a high moisture (latent) load exists.

![HiHumidControl](EngineeringReference/media/image5015.png)

Figure 219. Supplemental heating coil load when predicted zone air temperature is above the heating Setpoint

If a heating load exists (Figure 229), the supplementalheating coil is used to meet the heating coil load and at the same time offset the entire sensible cooling energy rate of the cooling coil (to meet the humidistat setpoint). Note that when a heating load exists and high humidity control is required, the unitary system operates at the user-specified cooling air flow rate for the entire simulation time step. As with the fan, and cooling coil, report variables associated with supplemental heating coil performance (e.g., heating coil energy, heating coil rate, heating coil gas or electric energy, heating coil runtime fraction, etc.) are managed in the supplemental (heating) coil object.

![HiHumidControl-1](EngineeringReference/media/image5016.png)

Figure 220. Supplemental heating coil load when predicted zone air temperature is below the heating setpoint

#### Waste Heat Calculation

Waste heat calculations are done when the multi speed cooling and heating coils are specified in the unitary system and the heat recovery is active (the value of the Design Heat Recovery Water Flow Rate field is greater than 0), the outlet node temperature of heat recovery is calculated based on the recoverable waste heat generated by the child objects Coil:Cooling:DX:MultiSpeed and Coil:Heating:DX:MultiSpeed:

<div>$${T_{outlet}} = {T_{inlet}} + \frac{{{Q_{WasteHeat}}}}{{{C_p}{{\dot m}_{hr}}}}$$</div>

where

T<sub>outlet</sub>            = outlet node temperature of heat recovery, C

T<sub>inlet</sub> = inlet node temperature of heat recovery, C

Q<sub>WasteHeat</sub>      = recoverable waste heat generated by its child objects, W

C<sub>p</sub>              = inlet node temperature of heat recovery, C

<span>${\dot m_{hr}}$</span>            = mass flow rate of heat recovery, kg/s

If the outlet node temperature is above the value of the Maximum Temp for Heat Recovery field, the outlet node temperature is reset to the value of Maximum Temp for Heat Recovery.

### Forced-Air Furnace and Central Air Conditioning

#### Overview

The input objects AirLoopHVAC:Unitary:Furnace:HeatOnly and AirLoopHVAC:Unitary:Furnace:HeatCool provide a “virtual” component that collect and control a set of components:  an on/off or constant volume fan component and a gas or electric heating coil component. If the HeatCool version is selected, then a DX cooling coil is also modeled as part of the system as shown in Figure 221 below. For the HeatCool version, an optional reheat coil may also be modeled for controlling high zone humidity levels and the furnace’s configuration when specifying this option is shown in Figure 222 below. The unit may be configured to have either a blow through or draw through fan. If a blow through fan configuration is specified, the furnace fan is placed before the heating coil for the HeatOnly version, or before the cooling coil for the HeatCool version as shown in the figure below. If a draw through fan configuration is specified, the fan is placed directly after the heating coil.

Note: the coil order shown here has been revised from previous versions of Energyplus to configure the cooling coil upstream of the heating coil. This configuration provides uniformity with all unitary equipment. However, for unitary HeatCool systems that do not use a reheat coil, the heating coil can also be placed upstream of the cooling coil. This optional coil placement is retained to allow compatibility with previous versions of Energyplus. For input files developed using previous versions of Energyplus, it is recommended that the coil order be revised according to the figure below.

![FurnaceSchematic\_BlowThru](EngineeringReference/media/image5019.png)

Figure 221. Schematic of the EnergyPlus Furnace (Blow Through Configuration)

While the furnace may be configured to serve multiple zones, system operation is controlled by a thermostat located in a single “control” zone. One of the key parameters for the furnace component is the fraction of the total system air flow that goes through the control zone. This fraction is calculated as the ratio of the maximum air mass flow rate for the air loop’s supply inlet node for the control zone (e.g., AirTerminal:SingleDuct:Uncontrolled, field = Maximum Air Flow Rate, converted to mass flow) to the sum of the maximum air mass flow rates for the air loop’s supply inlet nodes for all zones served by this air loop. The furnace module scales the calculated load for the control zone upward based on this fraction to determine the total load to be met by the furnace. The module then proceeds to calculate the required part-load ratio for the system coil and the supply air fan to meet this total load. The heating or cooling capacity delivered by the furnace is distributed to all of the zones served by this system via the terminal units that supply air to each zone. The supply air fraction that goes though the control zone is calculated as follows:

<div>$$Control Zone Air Flow\,Fraction = \frac{{{{\dot m}_{TUMax\,ControlZone}}}}{{\sum\limits_{j = 1}^{NumOfZones} {{{\dot m}_{TUMax\,Zone\,j}}} }}$$</div>

where:

<span>${\dot m_{TUMax\,ControlledZone}}$</span>    =    maximum air mass flow rate for the air loop’s supply inlet node (terminal unit) for the control zone (kg/s)

<span>${\dot m_{TUMax\,Zone\,j}}$</span>            =    maximum air mass flow rate for the air loop’s supply inlet node for the jth zone (kg/s)

<span>$NumOfZones$</span>                =    number of zones, or number of air loop supply air inlet nodes for all zones served by the air loop (-)

The furnace component is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Fan:OnOff must be used to model AUTO fan, while Fan:OnOff or Fan:ConstantVolume can be used to model fan ON. The fan operation mode is specified using a supply air fan operating mode schedule where schedule values of 0 denote cycling fan operation and schedule values other than 0 (a 1 is usually used) denote continuous fan operation. Using this schedule, the furnace fan may be cycled with cooling or heating coil operation or operated continuously based on time of day (e.g., cycling fan operation at night and continuous fan operation during the daytime). If the fan operating mode schedule name field is left blank in the furnace object, the furnace assumes cycling or AUTO fan mode operation throughout the simulation.

The only output variables reported by the furnace object are the fan part-load ratio and the compressor part-load ratio (HeatCool only). The fan part-load ratio is defined as the actual air mass flow rate through the system for the time step divided by the design supply air mass flow rate specified for the furnace (<span>${{{{\dot m}_{actual}}} \mathord{\left/ {\vphantom {{{{\dot m}_{actual}}} {{{\dot m}_{design}}}}} \right. } {{{\dot m}_{design}}}}$</span>)..The furnace operates based on the user-specified (or autosized) design supply air flow rate(s). The ‘design’ supply air mass flow rate may be different for cooling, heating, and when no cooling or heating is required and the fan operates continuously based on user-specified inputs (HeatCool only). For the HeatCool version, If alternate air flow rates are specified for cooling, heating, and when no cooling or heating is required, the design supply air mass flow rate is the maximum of these specified values. Also for the HeatCool version, the compressor part-load ratio is reported as the ratio of the actual cooling load to the full-load sensible capacity (see Eqn. ). Reporting of other variables of interest for the furnace (heating rate, cooling rate, energy consumption, etc.) is done by the individual system components (fan, heating coil and DX cooling coil).

#### Model Description

As described previously, the furnace is a “virtual” component consisting of a fan, heating coil and, for the HeatCool version, a cooling coil with an optional reheat coil. The sole purpose of the furnace model is to properly coordinate the operation of the various system components. The following sections describe the flow of information within the model for both the HeatOnly and HeatCool configurations, as well as the differences between cycling and continuous supply air fan operation. The last section describes the optional control of high zone humidity with a reheat coil for the HeatCool configuration.

#### HeatOnly Configuration

The HeatOnly configuration consists of an on/off or constant volume fan and an electric or gas heating coil. When the model is first called during an EnergyPlus simulation, all of the input data specified for each furnace in the input data file are read into data structures for use throughout the remainder of the simulation.

For each simulation time step when the performance of a heat-only furnace is being modeled, the first step is to retrieve the heating load required to meet the thermostat setpoint for the “control” zone (see Figure 221. Schematic of the EnergyPlus Furnace). See the section “Summary of Predictor-Corrector Procedure” elsewhere in this document for more details regarding load calculations. Since the furnace may be specified to serve several zones but controlled based on the load calculated for the “control” zone, the total heating load to be met by the furnace is determined from the following equation:

<div>$$Furnace\,Heating\,Load\, = \frac{{Control\,Zone\,Heating\,Load}}{{Control\,Zone\,Air\,Flow\,Fraction}}$$</div>

The model then calculates the furnace’s sensible heating energy rate delivered to the zones being served when the system runs at full-load conditions and when the heating coil is OFF. If the supply air fan cycles on and off with the heater, then the sensible heating energy rate is zero when the heating coil is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible heating energy rate will not be zero when the heating coil is OFF. Calculating the sensible heating energy rate involves modeling the supply air fan (and associated fan heat) and the heating coil. For each of these cases (full load and heating coil OFF), the sensible heating energy rate delivered by the furnace is calculated as follows:

<div>$$Full\;Heat\;Output = (Mass\;Flow\;Rat{e_{ful\;load}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;full\;load}}$$</div>

<div>$$No\;Heat\;Output = (Mass\;Flow\;Rat{e_{coil\;off}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*Mass Flow Rate<sub>full\\ load</sub>* = air mass flow rate through furnace at full-load conditions, kg/s

*h<sub>out,\\ full\\ load</sub>* = enthalpy of air exiting the furnace at full-load conditions, J/kg

*h<sub>control\\ zone</sub>*<sub> </sub> = enthalpy of air in the control zone (where thermostat is located), J/kg

*HR<sub>min</sub>      =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio

of the furnace exiting air or the air in the control zone

*Mass Flow Rate<sub>coil\\ off</sub>* = air mass flow rate through the furnace with the heating coil OFF, kg/s

*h<sub>out,\\ coil\\ off</sub>*  = enthalpy of air exiting the furnace with the heating coil OFF, J/kg

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;full\;load}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{full\;load}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{_{Out,\;full\;load}}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,coil\;off}} = \frac{{Mass\;Flow\;Rat{e_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \; + \left( {Mass\;Flow\;Rat{e_{coil\;off}} - \frac{{Mass\;Flow\;Rat{e_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {{h_{Out,coil\;off}} - {h_{Control\;Zone}}} \right)_{HR\min }}\end{array}$$</div>

With the calculated sensible heating energy rates and the total sensible heating load to be met by the system, the part-load ratio for the furnace is estimated.

<div>$$PartLoadRatio\, = \,MAX\left( {0.0,MIN\left( {1.0,\frac{{ABS\left( {FurnaceHeatingLoad - NoHeatOutput} \right)}}{{ABS(FullHeatOutput - NoHeatOutput)}}} \right)} \right)$$</div>



The part-load ratio calculated above is used to determine the required heating coil capacity as <span>$Qheating\,coil = Qdesign\,*PartLoadRatio$</span> where *Q<sub>design</sub>* is the nominal heating coil capacity as specified in the heating coil object. If the fan cycles on and off with the heating coil (i.e.,  when the supply air fan operating mode schedule values are equal to 0), then this part-load ratio is also used to determine the operating mass flow rate of the furnace as

<div>$${\dot m_{furnace}} = {\dot m_{design}}*PartLoadRatio$$</div>

 If the fan operates continuously (i.e. fan ON), the operating mass flow rate is specified as <span>${\dot m_{design}}$</span>. The furnace’s fan and heating coil are then re-simulated to determine the furnace’s delivered sensible heating capacity at the above calculated part-load ratio.

<div>$${Q_{furnace}} = \left( {{{\dot m}_{furnace}}} \right){\left( {{h_{out,actual}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,\;actual}}$$</div>

where:

<span>$Qfurnace$</span>          =sensible heating capacity delivered by the furnace (W)

<span>${\dot m_{furnace}}$</span>          = air mass flow rate through the furnace (kg/s)

*h<sub>out,\\ actual</sub>*<sub>          \\      </sub> = enthalpy of air exiting the furnace (J/kg)

*h<sub>out,\\ control\\ zone</sub>*  = enthalpy of air in the control zone (J/kg)

*HR<sub>min</sub>      *       = enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio

of the furnace exiting air or the air in the control zone

Δ<sub>sen,\\ actual</sub> =Sensible load difference between the system output node and the zone inlet node at the above calculated part-load ratio.

<div>$$\begin{array}{l}{\Delta_{sen,\;actual}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;actual}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {{{\dot m}_{furnace}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;actual}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

Since the part-load performance of the heating coil can be non-linear, and the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the heating coil and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the furnace’s heating output matches the heating load to be met within the heating convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the furnace’s heating output divided by the load to be met.

<div>$$Tolerance = {\raise0.7ex\hbox{${\left( {FurnaceHeatingLoad - {Q_{furnace}}} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {FurnaceHeatingLoad - {Q_{furnace}}} \right)} {FurnaceHeatingLoad}}}\right.}\!\lower0.7ex\hbox{${FurnaceHeatingLoad}$}} = 0.001$$</div>

If the furnace has been specified with cycling fan/cycling coil (AUTO fan), then the furnace’s design air mass flow rate is multiplied by PartLoadRatio to determine the average air mass flow rate for the system simulation time step. The air conditions at nodes downstream of the heating coil represent the full-load (steady-state) values when the coil is operating. If the supply air fan is specified to run continuously (fan ON), then the air mass flow rate remains at the furnace’s design air mass flow rate. In this case, the air conditions at nodes downstream of the heating coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and inlet air conditions when the coil is OFF).

For the case where the furnace is scheduled to operate with continuous supply air fan operation, but no heating load is required to meet the setpoint temperature in the control zone, the supply air fan model is still called to determine the fan exiting air conditions. The heating coil model is also called, but for the case with no heating load the heating coil model simply passes the inlet air conditions and mass flow rate from its inlet node to its outlet node. The air exiting the heating coil is then sent to the direct air units for distribution to each zone served by the furnace, where the zone heat balance is performed to determine the resulting zone air conditions. The furnace exiting air conditions and energy consumption are calculated and reported by the individual component models (fan and heating coil).

#### HeatCool Configuration

The HeatCool configuration consists of an on/off or constant volume fan, a DX cooling coil, and an electric or gas heating coil. For the cases where a heating load is calculated for the control zone or no heating/cooling load is calculated for the control zone, the model follows nearly identical computational steps as described in the HeatOnly Configuration section above. The only difference is the air mass flow rate during no cooling/heating operation with continuous supply air fan operation can be different from the air mass flow rate during heater operation for the HeatCool configuration. If a cooling load is calculated by EnergyPlus for the control zone, the solution methodology is also virtually identical and is described here for completeness.

If EnergyPlus determines that the furnace must supply cooling to the control zone to meet the zone air temperature setpoint, then the model computes the total sensible cooling load to be met by the furnace based on the control zone sensible cooling load and the fraction of the furnace air flow that goes through the control zone.

<div>$$Furnace\,Cooling\,Load\, = \frac{{Control\,Zone\,Cooling\,Load}}{{Control\,Zone\,Air\,Flow\,Fraction}}$$</div>

If the supply air fan operating mode schedule requests cycling fan operation, the model first checks for the presence of an ecomomizer in the outside air system serving the furnace’s air loop (Ref. AirLoopHVAC:OutdoorAirSystem). If an outside air system is not present or if an air-side economizer is not used, the furnace’s compressor is used to meet the furnace cooling load. If an air-side economizer is used and is active (i.e., economizer controls indicate that conditions are favorable to increase the outside air flow rate), the furnace will try to meet the cooling load by operating only the supply air fan. If the fan is able to satisfy the furnace cooling load, the compressor remains off for the entire simulation time step. If the operation of the fan alone is unable to meet the entire cooling load, then the compressor is enabled and additional calculations are performed to determine the compressor’s part-load ratio.



The model then calculates the furnace’s sensible cooling energy rate delivered to the zones being served when the system runs at full-load conditions and when the DX cooling coil is OFF. If the supply air fan cycles with the compressor, then the sensible cooling energy rate is zero when the cooling coil is OFF. However if the fan is configured to run continuously regardless of coil operation, then the sensible cooling energy rate will probably not be zero when the cooling coil is OFF. Calculating the sensible cooling energy rate involves modeling the supply air fan (and associated fan heat), the DX cooling coil, and the heating coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node). For each of these cases (full load and DX cooling coil OFF), the sensible cooling energy rate delivered by the furnace is calculated as follows:



<div>$$Full\;Cool\;Output = (Mass\;Flow\;Rat{e_{ful\;load}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;full\;load}}$$</div>

<div>$$No\;Cool\;Output = (Mass\;Flow\;Rat{e_{coil\;off}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*Mass Flow Rate<sub>full\\ load</sub>* = air mass flow rate through furnace at full-load conditions, kg/s

*h<sub>out,\\ full\\ load</sub>* = enthalpy of air exiting the furnace at full-load conditions, J/kg

*h<sub>control\\ zone</sub>*<sub> </sub> = enthalpy of air in the control zone (where thermostat is located), J/kg

*HR<sub>min</sub>      =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio

of the furnace exiting air or the air in the control zone

*Mass Flow Rate<sub>coil\\ off</sub>* = air mass flow rate through the furnace with the cooling coil OFF, kg/s

*h<sub>out,\\ coil\\ off</sub>*  = enthalpy of air exiting the furnace with the cooling coil OFF, J/kg

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;full\;load}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{full\;load}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{coil\;off}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

With the calculated sensible cooling energy rates and the total sensible cooling load to be met by the system, the part-load ratio for the furnace is estimated.

<div>$$PartLoadRatio\, = \,MAX\left( {0.0,\frac{{ABS\left( {Furnace\,Cooling\,Load - NoCoolOutput} \right)}}{{ABS\left( {FullCoolOutput - NoCoolOutput} \right)}}} \right)$$</div>

Since the part-load performance of the DX cooling coil is frequently non-linear (Ref: DX Cooling Coil Model), and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the furnace’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the furnace’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge {\raise0.7ex\hbox{${\left( {FurnaceCoolingLoad - {Q_{furnace}}} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {FurnaceCoolingLoad - {Q_{furnace}}} \right)} {FurnaceCoolingLoad}}}\right.}\!\lower0.7ex\hbox{${FurnaceCoolingLoad}$}}$$</div>

where:

<span>$Qfurnace$</span>= Furnace delivered sensible capacity (W)

If the furnace has been specified with cycling fan/cycling coil (AUTO fan) and high humidity control *has not* been specified, then the furnace’s operating supply air mass flow rate is multiplied by PartLoadRatio to determine the average air mass flow rate for the system simulation time step. The air conditions at nodes downstream of the cooling coil represent the full-load (steady-state) values when the coil is operating. If a cycling fan is used and high humidity control *has* been specified, the calculation of average air mass flow rate is based on the greater of the heating or cooling part-load ratio (see following section on high humidity control). When the heating part-load ratio is greater than the cooling part-load ratio, the air conditions at nodes downstream of the cooling coil represent the weighted average of full-load conditions when the cooling coil is operating and inlet air conditions when the cooling coil is off (i.e., the fan continues to operate due to a heating requirement where the heating PLR is greater than the cooling PLR). If the supply air fan is specified to run continuously (fan ON), then the air mass flow rate continues to operate at the user-specified supply air mass flow rate when no cooling or heating is required. In this case, the air conditions at nodes downstream of the cooling coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and inlet air conditions when the coil is OFF). The furnace exiting air conditions and energy consumption are calculated and reported by the individual component models (fan and DX cooling coil).

#### High Humidity Control with HeatCool Configuration

An optional reheat coil can be specified with the HeatCool configuration to allow the furnace to control high zone humidity levels. The specific configuration of the HeatCool Furnace with high humidity control option is shown in Figure 222. The figure below shows the fan placement when a blow through fan is specified. If a draw through fan is specified, the fan is located between the heating coil and the reheat coil. The system is controlled to keep the relative humidity in the control zone from exceeding the setpoint specified in the object ZoneControl:Humidistat. This option is available when the supply air fan operates continuously (i.e., the supply air fan operating mode schedule values are never equal to 0) or the supply air fan cycles with the compressor. For the case of cycling fan mode when the high humidity control is specified as CoolReheat *and* the heating part-load ratio is greater than the compressor part-load ratio, the air conditions at nodes downstream of the cooling coil are calculated as the average conditions during the duration of fan operation (i.e., the weighted average of full load conditions when the coil is operating and inlet air conditions when the coil is off and the fan continues to operate to meet the heating load). For the case where cycling fan mode is used *and* the heating part-load ratio is less than the compressor part-load ratio, the air conditions at the nodes downstream of the cooling coil are simply the full load (steady-state) values when the coil is operating. In addition, when high humidity control is specified and the compressor operates, the furnace operates at the cooling air flow rate when a zone heating load is present as determined by the zone thermostat.

High humidity control is specified as either None, MultiMode, or CoolReheat in the Dehumidification Control Type input field. MultiMode is specified when a heat exchanger is used to improve the dehumidification performance of the cooling coil. The heat exchanger will be activated when the sensible part-load ratio is insufficient to meet the zone latent load. CoolReheat is specified when a DX cooling coil is used to over-cool the supply air stream in order to meet the zone latent load. In this case, a reheat coil will ensure the zone temperature does not fall below the zone heating temperature set point. When a heat exchanger is used in conjunction with a DX cooling coil and CoolReheat is specified as the Dehumidification Control Type, the heat exchanger is “locked on” to meet either the sensible or latent cooling load. If the dehumidification control type is selected as None and a heat exchanger assisted cooling coil is used, the heat exchanger is “locked on” and the air conditioner runs only to meet the sensible cooling load. Although a reheat coil is required when CoolReheat is specified in the Dehumidification Control Type input field, this reheat coil may optionally be present for the other Dehumidification Control Types (e.g., None and Multimode). If the reheat coil is present and the dehumidification control type input is not specified as CoolReheat, the reheat coil will not be active. This allows changing the dehumidification control option without requiring a change in the unit’s coil configuration.

The model first calculates the PartLoadRatio required to meet the sensible cooling load as described above (see Eqn. ) to maintain the dry-bulb temperature setpoint in the control zone. If a moisture (latent) load exists because the control zone humidity has exceeded the setpoint, the total moisture load to be met by the HeatCool furnace (SystemMoistureLoad) is calculated based on the control zone moisture load and the control zone air flow fraction. The model then calculates the LatentPartLoadRatio required to meet the humidistat setpoint.

<div>$$SystemMoistureLoad\, = \frac{{Control\,Zone\,Moisture\,Load}}{{Control\,Zone\,Air\,Flow\,Fraction}}$$</div>

<div>$$LatentPartLoadRatio\, = \,MAX\left( {MinPLR,\frac{{ABS\left( {SystemMoistureLoad - NoLatentOutput} \right)}}{{ABS\left( {FullLatentOutput - NoLatentOutput} \right)}}} \right)$$</div>

where:

*FullLatentOutput  *= the furnace’s latent cooling energy rate at full-load conditions, W

*NoLatentOutput*     = the furnace’s latent cooling energy rate with the cooling coil OFF, W

*MinPLR*                = the minimum part-load ratio, which is usually 0.0. For the case when the latent capacity degradation model is used (Ref: DX Cooling Coil Model), this value is the minimum part-load ratio at which the cooling coil will dehumidify the air.

The model uses the greater of the two part-load ratios, PartLoadRatio or LatentPartLoadRatio, to determine the operating part-load ratio of the furnace’s DX cooling coil. As previously described, iterations are performed to converge on the solution within the convergence tolerance.

![FurnaceSchematic\_BlowThru\_HighRHControl](EngineeringReference/media/image5049.png)

Figure 222. Schematic for Blow Through Furnace with High Humidity Control

If the model determines that the LatentPartLoadRatio is to be used as the operating part-load ratio of the furnace’s cooling coil, the reheat coil is used to offset the excess sensible capacity provided by the unit. The model first checks the sensible load that exists for the current simulation time step (predicted zone temperature with no HVAC operation compared to the thermostat setpoint temperatures). If a sensible cooling load or no sensible cooling or heating load exists (Figure 223), the model calculates the difference between the sensible heating load required to reach or maintain the heating dry-bulb temperature setpoint and the actual sensible cooling energy rate delivered by the unit (with LatentPartLoadRatio). In this case, the reheat coil is used to offset the excess sensible cooling energy provided by the DX cooling coil (if any) that could have caused an overshoot of the heating dry-bulb temperature setpoint. Note that when a humidistat is used and high humidity control is required, the zone dry-bulb temperature will typically move toward the heating temperature setpoint when a high moisture (latent) load exists. If a heating load exists (Figure 224), the reheat coil is used to offset the entire sensible cooling energy rate of the DX cooling coil (to meet the humidistat setpoint) and the heating coil is used to meet the entire heating load as described in the HeatOnly configuration section above. Note that when a heating load exists and high humidity control is required, the furnace operates at the user-specified cooling air flow rate for the entire simulation time step. As with the fan, DX cooling coil, and heating coil, report variables associated with reheat coil performance (e.g., heating coil energy, heating coil rate, heating coil gas or electric consumption, heating coil runtime fraction, etc.) are managed in the reheat (heating) coil object.

![ZoneLoadSchematic](EngineeringReference/media/image5050.png)

Figure 223. Reheat Coil Load when Predicted Zone Temperature is Above Heating Setpoint

![ZoneLoadSchematic2](EngineeringReference/media/image5051.png)

Figure 224. Reheat Coil Load when Predicted Zone Temperature is Below Heating Setpoint

### Unitary Systems

The input objects AirLoopHVAC:UnitaryHeatCool and AirLoopHVAC:UnitaryHeatOnly provides models that are identical to the Furnace and Central Air models described above.  Please reference the previous section for details.

### Unitary System with Changeover-Bypass-Variable Air Volume

#### Overview

The input object AirLoopHVAC:UnitaryHeatCool:VAVChangeoverBypass provides a model for a changeover-bypass variable air volume (CBVAV) unitary system that is a compound object made up of other components. Each CBVAV system consists of an outside air mixer, direct expansion (DX) cooling coil, heating coil, and a supply air fan as shown in the figures below. Zone thermostats and terminal units are required in each zone served by this system. The terminal units are specific to this system type and are either AirTerminal:SingleDuct:VAV:HeatAndCool:Reheat or AirTerminal:SingleDuct:VAV:HeatAndCool:NoReheat. A zone humidistat and single zone max humidity setpoint manager may also be specified to help control high humidity levels. These individual components are described elsewhere in this document. The CBVAV unitary system object coordinates the operation of these components and is modeled as a type of air loop equipment (Ref. AirLoopHVAC).



![DrawthruCBVAV](EngineeringReference/media/image5052.png)



Figure 225. Schematic of a Changeover Bypass VAV Unitary System with Draw Through Fan



![BlowthruCBVAV](EngineeringReference/media/image5053.png)

Figure 226. Schematic of Changeover Bypass VAV Unitary System with Blow Through Fan

The CBVAV unitary system conditions one or more zones and is controlled by thermostats located in each zone (the use of a single humidistat is also allowed when using multi-mode DX cooling coils). The CBVAV system operates to meet the zone sensible cooling or sensible heating requirements as dictated by the thermostat schedule(s). The priority control input determines the mode of operation and is specified as Cooling Priority, Heating Priority, or Zone Priority. If Cooling Priority is specified, the system operates to meet the cooling load when any zone served by this system (air loop) requires cooling. If Heating Priority is specified, the system operates to meet the heating load when any zone requires heating. If Zone Priority is specified, the system operates based on the maximum number of zones requiring either heating or cooling.

Once the operating mode is determined, the CBVAV model calculates a target supply air temperature required to operate a single terminal unit at its maximum air flow rate. The remaining terminal units will modulate as required to maintain the dry-bulb temperature in the zone they are serving according to the thermostat schedule for their respective zone. The system air flow rate (through the supply air fan, cooling coil and heat coil) remains constant during cooling operation, heating operation, and no cooling/heating mode as specified by the user. Therefore, as the zone terminal units modulate to reduce zone air flow rates, the excess system air flow is “bypassed” from the bypass duct splitter node back to the bypass duct mixer node of the CBVAV system (see figures above).

The CBVAV system is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). A Fan:OnOff or Fan:ConstantVolume is used in either case. Since the excess system air flow is bypassed while the zone terminal units modulate, the supply air fan operates the entire simulation time step when heating or cooling is required. For this reason, AUTO fan only allows the supply air fan to turn off when no cooling or heating is required. If fan ON is specified, the supply air fan runs the entire time the system is scheduled to operate (via its availability schedule). The mode of operation for the supply air fan is specified through a fan operating mode schedule where a value of 0 in the schedule indicates cycling fan mode and a value greater than 0 indicates continuous fan mode. If the schedule is not provided, the supply air fan operating mode is considered to be continuous (fan ON).

Output variables reported for the CBVAV system include the supply air fan part-load ratio, the compressor part-load ratio, and the electric consumption of the CBVAV system. Additional output variables report the total heating rate and total cooling rate provided by the CBVAV system. The sensible and latent components for total system cooling and heating are also available as output variables. Reporting of other variables of interest for the CBVAV system (DX coil cooling rate, heating rate, crankcase electric power and energy, supply air fan electric power, etc.) is done by the individual system components (fan, DX cooling coil, and heating coil).

#### Model Description

As described previously, the CBVAV system conditions one or more zones and is controlled by zone thermostats (Ref. ZoneControl:Thermostat). For each simulation time step, EnergyPlus performs a zone air heat balance to determine if cooling or heating is required to meet the zone thermostat setpoints, excluding any impacts from CBVAV system operation. CBVAV system performance is then modeled with all heating/cooling coils off but with the supply air fan operating according to the user specified supply air fan operating mode schedule. If the zone air heat balance plus the impact of CBVAV system operation with coils off results in no requirement for heating or cooling by the CBVAV coils, or if the CBVAV system is scheduled off (via its availability schedule), then the CBVAV coils do not operate and the compressor part-load ratio output variable is set to 0. If the model determines that cooling or heating is required and the CBVAV system is scheduled to operate, the model calculates a target supply air temperature required to maintain a single terminal unit at it’s maximum air flow rate, the amount of bypass air returning to the bypass duct mixer node, and the part-load ratio of the cooling or heating coils in order to meet the target supply air temperature.

When high humidity control is desired, a ZoneControl:Humidistat input object and a SetpointManager:SingleZone:Humidity:Maximum, SetpointManager:MultiZone:MaximumHumidity:Average    or SetpointManager:MultiZone:Humidity:Maximum object are required. The air outlet node of the CBVAV system is used as the control node for the setpoint manager. For this reason, only a single humidistat should be specified for one of the zones being served by this system. If humidistat/setpoint manager objects are specified for more than one zone served by this system, only the last of the SetpointManager:SingleZone:Humidity:Maximum objects is used (the setpoint manager objects are read in order of occurrence in the input file). Since the outlet node of the CBVAV system is always used as the control node, the setpoints calculated by the previous setpoint managers are overwritten by the last setpoint manager in the input. When a heat exchanger is used to improve the dehumidification performance of the cooling coil (i.e. CoilSystem:Cooling:DX:HeatExchangerAssisted), the heat exchanger is always active and can not be turned on and off based on zone humidity levels.

The remainder of this section describes the calculations performed when cooling or heating coil operation is required. For any HVAC simulation time step, the CBVAV system can only cool or heat the air, not both. Because the CBVAV system bypasses system air flow back to the inlet of the CBVAV unit, the system operates for the entire simulation time step. If the user specifies continuous fan operation, then the supply air fan continues to operate at a user-specified flow rate even during periods when the coils cycle off. If the user specifies AUTO fan operation, then the supply air fan cycles off for the entire simulation time step only when no cooling or heating is required.

##### Operating Mode

The first step in modeling a CBVAV system is to obtain the cooling or heating load for each zone as calculated by EnergyPlus based on the zone thermostat setpoint temperature(s). The calculated loads for each zone are used to determine the total cooling and heating requirements for all zones served by this system. In addition to summing the zone cooling and heating loads, the number of zones in cooling and the number of zones in heating are totalized. The priority control mode specified by the user is then used to determine the operating mode for this simulation time step.

If Cooling Priority is specified and the total cooling requirement in all zones is not equal to zero, then cooling is selected as the operating mode. If the total cooling requirement is equal to zero and the total heating requirement is not equal to zero, then heating is selected as the operating mode. If the total cooling requirement and total heating requirement are equal to zero then the zones are allowed to float (no heating or cooling provided).

If Heating Priority is specified and the total heating requirement in all zones is not equal to zero, then heating is selected as the operating mode. If the total heating requirement is equal to zero and the total cooling requirement is not equal to zero, then cooling is selected as the operating mode. If the total cooling requirement and total heating requirement are equal to zero then the zones are allowed to float (no heating or cooling provided).

If Zone Priority is specified and the total number of zones requiring cooling is greater than the total number of zones requiring heating, then cooling is selected as the operating mode. If the total number of zones requiring heating is greater than the total number of zones requiring cooling, then heating is selected as the operating mode. If the total number of zones requiring cooling is equal to the total number of zones requiring heating, then the magnitude of the total cooling and heating requirements for all zones sets the operating mode. In this case, if the magnitudes of the cooling and heating requirements are zero, then the zones are allowed to float (no heating or cooing provided). If the magnitudes of the cooling and heating requirements are non-zero and identical, then cooling is selected as the operating mode.

##### Calculation of Bypass Duct Mixer Node Conditions

The operation of this system is unique in that it uses constant-air-volume equipment to provide variable air volume to the conditioned zones. This is accomplished with the use of a bypass duct (shown in the figures above) which shunts excess system air flow from the bypass duct splitter node at the system’s outlet back to the bypass duct mixer node at the system’s inlet. The air conditions at the bypass duct mixer node are based on the inlet air to the CBVAV system, the system outlet air conditions required to meet the zone loads, and the fraction of bypassed air. The following calculations are performed each simulation time step.

<div>$$BypassFrac = 1.0 - \left( {\frac{{{{\dot m}_{supply}}}}{{{{\dot m}_{system}}}}} \right)$$</div>

<div>$${T_{bypassductmixernode}} = \left( {1 - BypassFrac} \right){T_{inlet}} + \left( {BypassFrac} \right){T_{outlet}}$$</div>

<div>$${\omega_{bypassductmixernode}} = \left( {1 - BypassFrac} \right){\omega_{inlet}} + \left( {BypassFrac} \right){\omega_{outlet}}$$</div>

<div>$${h_{bypassductmixernode}} = PsyHFnTdbW\left( {{T_{mixerinlet}},{\omega_{mixerinlet}}} \right)$$</div>

where:

<span>$BypassFrac$</span>      = fraction of system air directed to the bypass duct mixer node

<span>${\dot m_{supply}}$</span>                 = Air mass flow rate at the system’s air outlet node, kg/s

<span>${\dot m_{system}}$</span>                 = Air mass flow rate through CBVAV system (coils and supply air fan), kg/s

<span>${T_{bypassductmixernode}}$</span>    = Air temperature at the bypass duct mixer node, °C

<span>${T_{inlet}}$</span>                    = Air inlet node temperature, °C

<span>${T_{outlet}}$</span>                   = Air outlet node temperature, °C

<span>${\omega_{bypassductmixernode}}$</span>   = Air humidity ratio at the bypass duct mixer node, kg/kg

<span>${\omega_{inlet}}$</span>                   = Air inlet node humidity ratio, kg/kg

<span>${\omega_{outlet}}$</span>                  = Air outlet node humidity ratio, kg/kg

<span>${h_{bypassductmixernode}}$</span>    = Air enthalpy at the bypass duct mixer node, J/kg

<span>$PsyHFnTdbW$</span>  = Psychrometric function calculating enthalpy given dry-bulb temperature and humidity ratio

##### Cooling Operation

If the model determines that the CBVAV system must supply cooling to the zones, the model first calculates a target outlet air dry-bulb temperature required to operate a single terminal unit at its maximum air flow rate. The minimum target temperature for all zones is used to control the CBVAV system in cooling mode.

<div>$$T_{target}^i = T_{Zone}^i + \left( {{\raise0.7ex\hbox{${Q_{Zone}^i}$} \!\mathord{\left/ {\vphantom {{Q_{Zone}^i} {\dot m_{zone,max}^i*{C_p}}}}\right.}\!\lower0.7ex\hbox{${\dot m_{zone,max}^i*{C_p}}$}}} \right);i = 1,n$$</div>

<div>$${T_{target}} = MIN\left( {T_{target}^i} \right);\,\,i = 1,n$$</div>

where:

<span>$T_{target}^i$</span>      = Target supply air temperature for zone *i*, °C

<span>$T_{zone}^i$</span>        = Air temperature in zone *i*, °C

<span>$Q_{zone}^i$</span>       = Cooling or heating load for zone *i* (cooling loads are negative values,      heating loads are positive values), W

<span>$Cp$</span>          = Specific heat of supply air with coils off, J/kg-K

<span>$\dot m_{zone,max}^i$</span>  = Maximum terminal unit mass flow rate in zone *i*, kg/s

<span>$T_{target}^{}$</span>      = Target supply (outlet) air temperature for the CBVAV system, °C

The model then calculates the part-load ratio of the DX compressor required to meet the target supply (outlet) air temperature. Since the part-load performance of the DX cooling coil is frequently non-linear (Ref: Coil:Cooling:DX:SingleSpeed model), the actual part-load ratio for the cooling coil compressor is determined through iterative calculations (successive modeling of the DX cooling coil model) until the CBVAV system’s outlet air temperature (including on/off cycling effects of the DX coil) matches the target supply (outlet) air temperature within a small temperature convergence tolerance (1E-5 ˚C).

Since the supply air fan operates continuously for each simulation time step (or is OFF for the entire HVAC system time step), the air conditions at nodes downstream of the cooling coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of coil’s outlet node conditions when the coil is operating and the coil’s inlet node conditions when the coil is OFF).

##### Heating Operation

Modeling the CBVAV system’s DX heating coil is identical to the calculations described above for cooling operation except that the maximum target supply air temperature for all zones is used to control the CBVAV system in heating mode.

<div>$${T_{target}} = MAX\left( {T_{target}^i} \right);\,\,i = 1,n$$</div>

Iterative calculations (successive modeling of the DX heating coil model) are used to determine the final heating coil part-load ratio to account for the non-linear performance of the DX heating coil at part-load conditions.

When a gas or electric heating coil is used instead of a DX heating coil, the amount of heat required by the coil is calculated based on the target supply (outlet) air temperature and the coil inlet air temperature as follows:

<div>$${Q_{heating}} = {\dot m_{system}}{C_p}({T_{target}} - {T_{inlet,heatcoil}})$$</div>

where:

<span>${Q_{heating}}$</span>       = Heating coil load, W

<span>${C_p}$</span>             = Specific heat of heating coil inlet air, J/kg-K

<span>${T_{inlet,heatcoil}}$</span>  = Heating coil inlet air temperature, °C

##### Floating Operation (no cooling or heating)

When the zone thermostats determine that there is no cooling or heating requirement in any zone, the CBVAV coils are OFF and the zone temperatures are allowed to float. However, a special case exists where the user specifies continuous supply air fan operation and no cooling or heating requirements exist in any zone. In this case, the outlet air temperature of the CBVAV system (with fan ON and coils OFF) is compared to the target outlet air temperatures required to maintain the zone’s cooling and heating setpoint temperatures. If the outlet air temperature with the supply fan ON and coils OFF is below the target outlet air temperature required to maintain the heating setpoint, then heating mode is enabled to avoid overshooting the zone heating setpoint temperature. Conversely, if the outlet air temperature with the supply fan ON and coils OFF is above the target outlet air temperature required to maintain the cooling setpoint, then cooling mode is enabled to avoid overshooting the zone cooling setpoint temperature. This special case is handled at any time a no load condition is reported by the thermostats and overshooting the zone air temperature setpoint is possible regardless of the priority control mode selected by the user.

##### Minimum and Maximum Outlet Air Temperature in Cooling/Heating Operation

The user also specifies a minimum outlet air temperature during cooling operation and a maximum outlet air temperature during heating operation. The target outlet air temperature, as calculated above, is compared to each of these limits during each simulation time step. The resulting target outlet air temperature is used to control the heating and cooling coils.

<div>$${T_{target}} = MAX\left( {{T_{target}},\,\,{T_{min,cooling}}} \right)$$</div>

<div>$${T_{target}} = MIN\left( {{T_{target}},\,\,{T_{max,heating}}} \right)$$</div>

where:

<span>${T_{min,cooling}}$</span>= Minimum outlet air temperature during cooling operation, °C

<span>${T_{max,heating}}$</span>= Maximum outlet air temperature during heating operation, °C

##### Air Flow Calculations

The changeover-bypass VAV system operates based on user-specified (or autosized) air flow rates. The CBVAV system air flow rate (i.e., air flow through the supply air fan and heating/cooling coils) during cooling operation may be different than the system air flow rate during heating operation. In addition, the system air flow rate when no cooling or heating is required but the supply air fan remains ON can be different than the air flow rates when cooling or heating is required. The outside air flow rates can likewise be different in these various operating modes. The model takes these different air flow rates into account when simulating the performance of the CBVAV system. The system air flow rate for each simulation time step is based on the current operating mode (cooling, heating, or no cooling/heating) and is reported on the inlet/outlet air nodes of the various CBVAV components (e.g. fan, cooling coil, and heating coil). The supply air flow rate delivered to the individual zones is calculated based on the sum of the air flow rates through each terminal unit and is reported at the air inlet and outlet nodes of the CBVAV system each simulation time step. The difference between the system air mass flow rate and the supply air mass flow rate delivered to all zones is equal to the bypass air mass flow rate which is also reported each simulation time step.

The system and outside air flow rates when a system coil is ON (e.g., system air volumetric flow rate during cooling operation, system air volumetric flow rate during heating operation, outside air volumetric air flow rate during cooling operation, and outside air volumetric air flow rate during heating operation) or the system coils are OFF and the fan operates continuously (e.g., system air volumetric flow rate when no cooling or heating is needed and outside air volumetric air flow rate when no cooling or heating is needed) are specified by the user, or can be autosized, and are converted from volumetric flow rate to mass flow rate at standard conditions. If the user has specified cycling fan operation, then the system air and outside air mass flow rates when the system coils are OFF the entire time step are zero. If the user has specified constant fan operation, then the air flow rates when no cooling or heating is needed are used when the system coils are OFF the entire time step.

There is one special case. If the user has specified constant fan operation and they specify that the system air volumetric flow rate when no cooling or heating is needed is zero (or if the field is left blank), then the model assumes that the system air mass flow rate when the system coils are OFF the entire time step is equal to the corresponding air mass flow rate when any system coil was last operating (ON). This model handles the zero (or blank) entry for outside air volumetric flow rate when no cooling or heating is needed in an analogous fashion.

<div>$${\dot m_{system}} = {\rho_{air,std}}*{\dot V_{mode}}$$</div>

<div>$${\dot m_{system,OA}} = {\rho_{air,std}}*{\dot V_{mode,OA}}$$</div>

<div>$${\dot m_{supply}} = \sum\limits_{i = 1}^n {{{\dot m}_{zone}}} $$</div>

<div>$${\dot m_{bypass}} = {\dot m_{system}} - {\dot m_{supply}}$$</div>

where:

<span>$\rho air,std$</span>             = standard air density (1.204 kg/m<sup>3</sup>) adjusted for the local barometric pressure (standard barometric pressure corrected for altitude, ASHRAE 1997 HOF pg. 6.1), kg/m<sup>3</sup>

<span>${\dot V_{mode}}$</span>                = User-specified system volumetric flow rate in cooling, heating, or no cooling or heating mode, m<sup>3</sup>/s

<span>${\dot m_{system,OA}}$</span>          = Outdoor air mass flow rate introduced through the CBVAV system, kg/s

<span>${\dot V_{mode,OA}}$</span>            = User-specified outdoor air volumetric flow rate in cooling, heating, or no cooling or heating mode, m<sup>3</sup>/s

##### Calculation of System Heating and Cooling Rates

At the end of each HVAC simulation time step, this object reports the heating or cooling rate and energy delivered by the system, as well as the electric power and consumption by the system. In terms of thermal energy delivered by the system, the sensible, latent and total energy transfer rates for the system are calculated as follows:

<div>$${\dot Q_{total}} = ({\dot m_{supply}})({h_{outlet}} - {h_{inlet}})$$</div>

<div>$${\dot Q_{sensible}} = ({\dot m_{supply}}){({h_{outlet}} - {h_{inlet}})_{HRmin}}$$</div>

<div>$${\dot Q_{latent}} = {\dot Q_{total}} - {\dot Q_{sensible}}$$</div>

where:

<sub><span>${\dot Q_{total}}$</span>            </sub>= total energy transfer rate by the system, W

<sub><span>${\dot Q_{sensible}}$</span>        </sub>= sensible energy transfer rate by the system, W

<sub><span>${\dot Q_{latent}}$</span>           </sub>= latent energy transfer rate by the system, W

*h<sub>inlet</sub>*                        = enthalpy of the air entering the unit at its inlet node, J/kg

*h<sub>outlet</sub>*          = enthalpy of the air leaving the unit at its outlet node, J/kg

<span>$H{R_{min}}$</span>        = minimum of the inlet air and outlet air humidity ratio, kg/kg

Since each of these energy transfer rates can be calculated as positive or negative values, individual reporting variables are established for cooling and heating and only positive values are reported. The following calculations are representative of what is done for each of the energy transfer rates:

<div>$$\begin{array}{l}If\;({{\dot Q}_{total}} < 0.0)\;Then\\\quad {{\dot Q}_{total,cooling}} = ABS({{\dot Q}_{total}})\\\quad {{\dot Q}_{total,heating}} = 0.0\\Else\\\quad {{\dot Q}_{total,cooling}} = 0.0\\\quad {{\dot Q}_{total,heating}} = {{\dot Q}_{total}}\\Endif\end{array}$$</div>

where:

<sub><span>${\dot Q_{total,cooling}}$</span>          </sub>= output variable ‘Unitary System Total Cooling Rate, W’

<sub><span>${\dot Q_{total,heating}}$</span>          </sub>= output variable ‘Unitary System Total Heating Rate, W’

In addition to heating and cooling rates, the heating and cooling energy supplied by the system are also calculated for the time step being reported. The following example for total zone cooling energy is representative of what is done for the sensible and latent energy as well as the heating counterparts.

<div>$${Q_{total,cooling}} = {\dot Q_{total,cooling}}*TimeStepSys*3600$$</div>

where:

<sub><span>${Q_{total,cooling}}$</span>      </sub>= output variable ‘Unitary System Total Cooling Energy, J’

*TimeStepSys*  = HVAC system simulation time step, hr

3600              = conversion factor, sec/hr

#### Changeover-bypass VAV Unitary System Sizing

The changeover-bypass VAV system is modeled as an air loop component and is sized according to the methodology described elsewhere in this document (Ref. System Design Loads and Air Flow Rates). The following volumetric air flow rates may be autosized:

·        system air volumetric flow rate during cooling operation

·        system air volumetric flow rate during heating operation

·        system air volumetric flow rate when no cooling or heating is needed

·        outside air volumetric air flow rate during cooling operation

·        outside air volumetric air flow rate during heating operation

·        outside air volumetric air flow rate when no cooling or heating is needed

### Unitary Air-To-Air Heat Pump

#### Overview

The input object AirLoopHVAC:UnitaryHeatPump:AirToAir provides a model for an air-to-air heat pump that is a “virtual” component that consists of an on/off or constant volume fan component, a DX cooling coil, a DX heating coil, and a gas or electric supplemental heating coil. The specific configuration of the blow through heat pump is shown in the following figure. For a draw through heat pump, the fan is located between the DX heating coil and the supplemental heating coil.

![FurnaceSchematic\_HeatPump](EngineeringReference/media/image5106.png)

Figure 227. Schematic of a Blow Through Air-to-Air Heat Pump

While the heat pump may be configured to serve multiple zones, system operation is controlled by a thermostat located in a single “control” zone. One of the key parameters for the heat pump component is the fraction of the total system airflow that goes through the control zone. This fraction is calculated as the ratio of the maximum air mass flow rate for the air loop’s supply inlet node for the control zone (e.g., AirTerminal:SingleDuct:Uncontrolled, field = Maximum Air Flow Rate, converted to mass flow) to the sum of the maximum air mass flow rates for the air loop’s supply inlet nodes for all zones served by this air loop. The heat pump module scales the calculated load for the control zone upward based on this fraction to determine the total load to be met by the heat pump. The module then proceeds to calculate the required part-load ratio for the system coil and the supply air fan to meet this total load. The heating or cooling capacity delivered by the heat pump is distributed to all of the zones served by this system via the direct air units that supply air to each zone. The supply air fraction that goes though the control zone is calculated as follows:

<div>$$Control Zone Air Flow\,Fraction = \frac{{{{\dot m}_{TUMax\,ControlZone}}}}{{\sum\limits_{j = 1}^{NumOfZones} {{{\dot m}_{TUMax\,Zone\,j}}} }}$$</div>

where:

<span>${\dot m_{TUMax\,ControlledZone}}$</span>    =    maximum air mass flow rate for the air loop’s supply inlet node (terminal unit) for the control zone (kg/s)

<span>${\dot m_{TUMax\,Zone\,j}}$</span>            =    maximum air mass flow rate for the air loop’s supply inlet node for the jth zone (kg/s)

<span>$NumOfZones$</span>                =    number of zones, or number of air loop supply air inlet nodes for all zones served by the air loop (-)

The heat pump component is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Fan:OnOff must be used to model AUTO fan, while Fan:OnOff or Fan:ConstantVolume can be used to model fan ON. The fan operation mode is specified using a supply air fan operating mode schedule where schedule values of 0 denote cycling fan operation and schedule values other than 0 (a 1 is usually used) denote continuous fan operation. Using this schedule, the furnace fan may be cycled with cooling or heating coil operation or operated continuously based on time of day (e.g. cycling fan operation at night and continuous fan operation during the day). If the fan operating mode schedule name field is left blank in the heat pump object, the heat pump assumes cycling or AUTO fan mode operation throughout the simulation.

The output variables reported by the heat pump object are fan part-load ratio and compressor part-load ratio. Fan part-load ratio is defined as the actual air mass flow rate through the system for the time step divided by the operating supply air mass flow rate specified for the heat pump (<span>${{\mathop m\limits^\cdot  actual} \mathord{\left/ {\vphantom {{\mathop m\limits^\cdot  actual} {\mathop m\limits^\cdot  }}} \right. } {\mathop m\limits^\cdot  }}ON$</span>). The operating supply air mass flow rate may be different for cooling, heating, and when no cooling or heating is required and the fan operates continuously. Compressor part-load ratio is the actual load for the time step divided by the full-load sensible capacity (see Eqn. or Eqn.). Reporting of other variables of interest for the heat pump (heating rate, cooling rate, energy consumption, etc.) is done by the individual system components (fan, DX cooling coil, DX heating coil, and supplemental heating coil).

#### Model Description

As described previously, the heat pump is a “virtual” component consisting of a fan, DX cooling coil, DX heating coil and a supplemental heating coil. The sole purpose of the heat pump model is to properly coordinate the operation of the various system components. The following sections describe the flow of information within the model, as well as the differences between cycling and continuous supply air fan operation.

#### Cooling Operation

If EnergyPlus determines that the heat pump must supply cooling to the control zone to meet the zone air temperature setpoint, then the heat pump model computes the total sensible cooling load to be delivered to the zones being served based on the control zone sensible cooling load and the fraction of the heat pump air flow that goes through the control zone.

<div>$$Heat\,Pump\,Cooling\,Load\, = \frac{{Control\,Zone\,Cooling\,Load}}{{Control\,Zone\,Air\,Flow\,Fraction}}$$</div>

If the supply air fan operating mode schedule requests cycling fan operation, the model first checks for the presence of an ecomomizer in the outside air system serving the heat pump’s air loop (Ref. AirLoopHVAC:OutdoorAirSystem). If an outside air system is not present or if an air-side economizer is not used, the heat pump’s compressor is used to meet the heat pump cooling load. If an air-side economizer is used and is active (i.e., economizer controls indicate that conditions are favorable to increase the outside air flow rate), the heat pump will try to meet the cooling load by operating only the supply air fan. If the fan is able to satisfy the heat pump cooling load, the compressor remains off for the entire simulation time step. If the operation of the fan alone is unable to meet the entire cooling load, then the compressor is enabled and additional calculations are performed to determine the compressor’s part-load ratio.

The model then calculates the heat pump’s sensible cooling energy rate delivered to the zones being served when the system runs at full-load conditions and when the DX cooling coil is OFF. If the supply air fan cycles with the compressor, then the sensible cooling energy rate is zero when the cooling coil is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible cooling energy rate will not be zero when the cooling coil is OFF. Calculating the sensible cooling energy rate involves modeling the supply air fan (and associated fan heat) and the DX cooling coil. The DX heating coil and the supplemental heating coil are also modeled, but only to pass the air properties and mass flow rate from their inlet nodes to their outlet nodes. For each of these cases (full load and DX cooling coil OFF), the sensible cooling energy rate delivered by the heat pump is calculated as follows:

<div>$$Full\;Cool\;Output = (Mass\;Flow\;Rat{e_{ful\;load}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;full\;load}}$$</div>

<div>$$No\;Cool\;Output = (Mass\;Flow\;Rat{e_{coil\;off}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*Mass Flow Rate<sub>full \\ load</sub>*  = air mass flow rate through heat pump at full-load conditions, kg/s

*h<sub>out,\\ full\\ load</sub>*   = enthalpy of air exiting the heat pump at full-load conditions, J/kg

*h<sub>control \\ zone</sub>*   = enthalpy of air leaving the control zone (where thermostat is located), J/kg

*HR<sub>min</sub>=* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the heat pump exiting air or the air leaving the control zone

*Mass Flow Rate<sub>coil\\ off</sub>*  = air mass flow rate through the heat pump with the cooling coil OFF, kg/s

*h<sub>out,coil \\ off</sub>*    = enthalpy of air exiting the heat pump with the cooling coil OFF, J/kg

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;full\;load}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{full\;load}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{coil\;off}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

With the calculated sensible cooling energy rates and the total sensible cooling load to be met by the system, the part-load ratio for the heat pump is estimated.

<div>$$PartLoadRatio\, = \,MAX\left( {0.0,\frac{{ABS\left( {Heat\,Pump\,Cooling\,Load - NoCoolOutput} \right)}}{{ABS\left( {FullCoolOutput - NoCoolOutput} \right)}}} \right)$$</div>

Since the part-load performance of the DX cooling coil is frequently non-linear, and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the heat pump’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the heat pump’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge {\raise0.7ex\hbox{${\left( {HeatPumpCoolingLoad - {Q_{HeatPump}}} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {HeatPumpCoolingLoad - {Q_{HeatPump}}} \right)} {HeatPumpCoolingLoad}}}\right.}\!\lower0.7ex\hbox{${HeatPumpCoolingLoad}$}}$$</div>

where:

<span>$QHeatPump$</span>= Heat pump delivered sensible capacity (W)

If the heat pump has been specified with cycling fan/cycling coil (AUTO fan), then the heat pump’s operating supply air mass flow rate is multiplied by PartLoadRatio to determine the average air mass flow rate for the system simulation time step. In this case, the air conditions at nodes downstream of the cooling coil represent the full-load (steady-state) values when the coil is operating.

If the fan operates continuously (i.e., when the supply air fan operating mode schedule values are NOT equal to 0), the operating air mass flow rate through the heat pump is calculated as the average of the user-specified air flow rate when the cooling coil is ON and the user-specified air flow rate when the cooling coil is OFF (user-specified supply air volumetric flow rates converted to dry air mass flow rates).

<div>$$\mathop m\limits^ \bullet  furnace = PartLoadRatio\left( {\mathop m\limits^ \bullet  CoolCoilON} \right) + \left( {1 - PartLoadRatio} \right)\left( {\mathop m\limits^ \bullet  CoilOFF} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  CoolCoilON$</span> = air mass flow rate through heat pump when the cooling coil is ON (kg/s)

<span>$\mathop m\limits^ \bullet  CoilOFF$</span> = air mass flow rate through heat pump when no cooling or heating is needed (kg/s)

In this case, the air conditions at nodes downstream of the cooling coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and inlet air conditions when the coil is OFF).

Heating Operation

Calculations for heating operation are similar to those for cooling operation in most respects. However, due to the inclusion of a supplemental heating coil, additional calculations are necessary to properly meet the total heating load for the zones being served.

If EnergyPlus determines that the heat pump must supply heating to the control zone to meet the zone air temperature setpoint, then the heat pump model computes the total sensible heating load to be delivered to the zones being served based on the control zone sensible heating load and the control zone airflow fraction.

<div>$$Heat\,Pump\,Heating\,Load\, = \frac{{Control\,Zone\,Heating\,Load}}{{Control\,Zone\,Air\,Flow\,Fraction}}$$</div>

The model then calculates the heat pump’s sensible heating energy rate delivered to the zones being served when the system runs at full-load conditions and when the DX heating coil is OFF (without supplemental heater operation in either case). If the supply air fan cycles with the compressor, then the sensible heating energy rate is zero when the compressor is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible heating energy rate will not be zero when the compressor is OFF. Calculating the sensible heating energy rate involves modeling the supply air fan (and associated fan heat), the DX cooling coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node), the DX heating coil, and the supplemental heating coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node). For each of these cases (full load and DX heating coil OFF, without supplemental heater operation in either case), the sensible heating energy rate delivered by the heat pump is calculated as follows:

<div>$$Full\;Heat\;Output = (Mass\;Flow\;Rat{e_{ful\;load}}){({h_{out,full\;load}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;full\;load}}$$</div>

<div>$$No\;Heat\;Output = (Mass\;Flow\;Rat{e_{coil\;off}}){({h_{out,\;coil\;off}} - {h_{control\;zone}})_{HR\min }} - {\Delta_{sen,\;coil\;off}}$$</div>

where:

*Mass Flow Rate <sub>full\\ load</sub>*  = air mass flow rate through heat pump at full-load conditions, kg/s

*h<sub>out,\\ full\\ load</sub>*  = enthalpy of air exiting the heat pump at full-load conditions, J/kg

*h<sub>control \\ zone</sub>*  = enthalpy of air leaving the control zone (where thermostat is located), J/kg

*HR<sub>min</sub>=* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the heat pump exiting air or the air leaving the control zone

*Mass Flow Rate <sub>coil \\ off</sub>*  = air mass flow rate through the heat pump with the heating coil OFF, kg/s

*h<sub>out,\\ coil \\ off</sub>*  = enthalpy of air exiting the heat pump with the heating coil OFF, J/kg

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;full\;load}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{full\;load}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;full\;load}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$$\begin{array}{l}{\Delta_{sen,\;coil\;off}} = \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}{\left( {{h_{Out,\;coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }}\\\quad \quad \quad \quad  + \left( {Mass\;Flow\;Rat{e_{_{coil\;off}}} - \frac{{Mass\;Flow\;Rat{e_{_{Zone\;Inlet}}}}}{{Frac}}} \right){\left( {{h_{Out,\;coil\;off}} - {h_{_{Control\;Zone}}}} \right)_{HR\min }}\end{array}$$</div>

With the calculated sensible heating energy rates and the total sensible heating load to be met by the system, the part-load ratio for the heat pump is estimated.

<div>$$PartLoadRatio\, = \,MAX\left( {0.0,\frac{{ABS\left( {Heat\,Pump\,Heating\,Load - NoHeatOutput} \right)}}{{ABS\left( {FullHeatOutput - NoHeatOutput} \right)}}} \right)$$</div>

Since the part-load performance of the DX heating coil is frequently non-linear (Ref: Single-Speed Electric Heat Pump DX Air Heating Coil), and the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the heating coil compressor and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the heat pump’s heating output matches the heating load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the heat pump’s heating output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge {\raise0.7ex\hbox{${\left( {HeatPumpHeatingLoad - {Q_{HeatPump}}} \right)}$} \!\mathord{\left/ {\vphantom {{\left( {HeatPumpHeatingLoad - {Q_{HeatPump}}} \right)} {HeatPumpHeatingLoad}}}\right.}\!\lower0.7ex\hbox{${HeatPumpHeatingLoad}$}}$$</div>

where:

<span>$QHeatPump$</span>= Heat pump delivered sensible capacity (W)

If the heat pump’s DX heating coil output at full load is insufficient to meet the entire heating load, PartLoadRatio is set equal to 1.0 (compressor and fan are not cycling) and the remaining heating load is passed to the supplemental heating coil. If the heat pump model determines that the outdoor air temperature is below the minimum outdoor air temperature for compressor operation, the compressor is turned off and the entire heating load is passed to the supplemental gas or electric heating coil. The heat pump exiting air conditions and energy consumption are calculated and reported by the individual component models (fan, DX heating coil, and supplemental gas or electric heating coil).

If the heat pump has been specified with cycling fan/cycling coil (AUTO fan), then the heat pump’s operating supply air mass flow rate is multiplied by PartLoadRatio to determine the average air mass flow rate for the system simulation time step. The air conditions at nodes downstream of the heating coils represent the full-load (steady-state) values when the coils are operating. If the fan operates continuously (i.e., when the supply air fan operating mode schedule values are NOT equal to 0), the operating air mass flow rate through the heat pump is calculated as the average of the user-specified air flow rate when the heat pump heating coil is ON and the user-specified air flow rate when the heat pump heating coil is OFF (user-specified supply air volumetric flow rates converted to dry air mass flow rates).

<div>$$\mathop m\limits^ \bullet  HeatPump = PartLoadRatio\left( {\mathop m\limits^ \bullet  HeatCoilON} \right) + \left( {1 - PartLoadRatio} \right)\left( {\mathop m\limits^ \bullet  CoilOFF} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  HeatCoilON$</span> = air mass flow rate through heat pump when the heating coil is ON (kg/s)

<span>$\mathop m\limits^ \bullet  CoilOFF$</span> = air mass flow rate through heat pump when no heating or cooling is needed (kg/s)

In this case, the air conditions at nodes downstream of the heating coils are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coils are operating and inlet air conditions when the coils are OFF).

#### High Humidity Control with AirToAir HeatPump Model

The specific configuration of the AirToAir HeatPump with supplemental heating coil is shown above (see Figure 227). This figure shows the fan placement when a blow through fan is specified. If a draw through fan is specified, the fan is located between the heating coil and the supplemental heating coil. The system is controlled to keep the high relative humidity in the control zone from exceeding the setpoint specified in the object ZoneControl:Humidistat. This option is available when the supply air fan operates continuously (i.e., the supply air fan operating mode schedule values are never equal to 0) or the supply air fan cycles with the compressor. In addition, when high humidity control is specified and the compressor operates, the heatpump operates at the cooling air flow rate when a zone heating load is present as determined by the zone thermostat. High humidity control is specified as either None, MultiMode, or CoolReheat in the Dehumidification Control Type input field. MultiMode is specified when a heat exchanger is used to improve the dehumidification performance of the cooling coil. The heat exchanger will be activated when the sensible part-load ratio is insufficient to meet the zone latent load. CoolReheat is specified when a DX cooling coil is used to over-cool the supply air stream in order to meet the zone latent load. In this case, a supplemental heating coil will ensure the zone temperature does not fall below the zone heating temperature set point. When a heat exchanger is used in conjunction with a DX cooling coil and CoolReheat is specified as the Dehumidification Control Type, the heat exchanger is “locked on” to meet either the sensible or latent cooling load. If the dehumidification control type is selected as None and a heat exchanger assisted cooling coil is used, the heat exchanger is “locked on” and the air conditioner runs only to meet the sensible cooling load. A supplemental heating coil is required for all dehumidification control types.

The model first calculates the *PartLoadRatio* required meeting the sensible cooling load.  The heatpump’s sensible cooling load is determined from the control zone sensible cooling load to the cooling setpoint and the control zone air flow fraction to maintain the dry-bulb temperature setpoint in the control zone.:

<div>$$HeatPumpCoolingLoad = \,\frac{{ControlZoneCoolingLoad}}{{ControlZoneAirFlowFraction}}$$</div>

The heatpump’s sensible cooling load to be met and the full load cooling output are used to calculate the sensible the part-load ratio iteratively based on user specified convergence criterion.

<div>$$PartLoadRatio = MAX\left( {0.0,\,\frac{{ABS\left( {HeatPumpCoolingLoad - NoCoolOutput} \right)}}{{ABS\left( {FullCoolOutput - NoCoolOutput} \right)}}} \right)$$</div>

When the heat pump’s sensible cooling capacity meets the system sensible cooling load at a given sensible part load ratio, then the Heat pump meets the controlled zone cooling setpoint temperature. If a moisture (latent) load exists because the control zone humidity has exceeded the setpoint, the total moisture load to be met by the heat pumps (HeatPumpMoistureLoad) is calculated based on the control zone moisture load and the control zone air flow fraction.

<div>$$HeatPumpMoistureLoad = \,\frac{{ControlZoneMoitureLoad}}{{ControlZoneAirFlowFraction}}$$</div>

Then the *LatentPartLoadRatio* required to meet the high humidity setpoint is calculated as follows:

<div>$$LatentPartLoadRatio = MIN\left( {PL{R_{Min}},\,\frac{{ABS\left( {HeatPumpMoistureLoad - NoLatentOutput} \right)}}{{ABS\left( {FullLatentOutput - NoLatentOutput} \right)}}} \right)$$</div>

The model uses the greater of the two part-load ratios, *PartLoadRatio* or *LatentPartLoadRatio*, to determine the operating part-load ratio of the Heat Pump’s DX cooling coil.

<div>$$LatentPartLoadRatio = MAX\left( {PartLoadRatio,\,LatentPartLoadRatio} \right)$$</div>

As previously described, iterations are performed to converge on the solution within the convergence tolerance.

Where,

<span>$ControlZoneCoolingLoad$</span>= the control zone sensible cooling load to the cooling setpoint, (W).

<span>$ControlZoneMoistureLoad$</span>         = the control zone moisture load to the dehumidifying relative humidity setpoint, (W).

<span>$ControlZoneAirFlowFraction$</span>     = the supply air fraction that goes though the control zone, (-).

*FullLatentOutput*      =         the Heat Pump’s latent cooling energy rate at full-load conditions, W

*NoLatentOutput*       =          the Heat Pump’s latent cooling energy rate with cooling coil OFF, W

<span>$PartLoadRatio$</span>     =          the heat pump’s part-load-ratio required to meet system sensible load, (-).

<span>$LatentPartLoadRatio$</span>      =          the heat pump’s part-load-ratio required to meet system moisture load, (-).

<span>$PL{R_{MIN}}$</span>*       =  *the minimum part-load ratio, which is usually 0.0. For the case when the latent capacity degradation model is used (Ref: DX Cooling Coil Model), this value is the minimum part-load ratio at which the cooling coil will dehumidify the air.

When the predicted zone air temperature is above the heating setpoint and if there is a dehumidification load, the supplemental heating coil load is required to offset the excess cooling as shown in Figure 228. If the model determines that the LatentPartLoadRatio is to be used as the operating part-load ratio of the heatpump’s cooling coil, the supplemental heating coil is used to offset the excess sensible capacity provided by the heat pump DX cooling coil. The model first checks the sensible load that exists for the current simulation time step (predicted zone temperature with no HVAC operation compared to the thermostat setpoint temperatures). If a sensible cooling load or no sensible cooling or heating load exists (see Figure 2),  the model calculates the difference between the sensible heating load required to reach or maintain the heating dry-bulb temperature setpoint and the actual sensible cooling energy rate delivered by the unit (with LatentPartLoadRatio). In this case, thesupplemental heating coil is used to offset the excess sensible cooling energy provided by the DX cooling coil (if any) that could have caused an overshoot of the heating dry-bulb temperature setpoint. Note that when a humidistat is used and high humidity control is required, the zone dry-bulb temperature will typically move toward the heating temperature setpoint when a high moisture (latent) load exists.

![HiHumidControl](EngineeringReference/media/image5145.png)

Figure 228. Supplemental heating coil load when predicted zone air temperature is above the heating Setpoint

If a heating load exists (Figure 229), the supplementalheating coil is used to meet the heating coil load and at the same time offset the entire sensible cooling energy rate of the DX cooling coil (to meet the humidistat setpoint). Note that when a heating load exists and high humidity control is required, the heat pump operates at the user-specified cooling air flow rate for the entire simulation time step. As with the fan, and DX cooling coil, report variables associated with supplemental heating coil performance (e.g., heating coil energy, heating coil rate, heating coil gas or electric energy, heating coil runtime fraction, etc.) are managed in the supplemental (heating) coil object.

![HiHumidControl-1](EngineeringReference/media/image5146.png)

Figure 229. Supplemental heating coil load when predicted zone air temperature is below the heating setpoint

### Unitary Multi-Speed Air-To-Air Heat Pump

#### Overview

The input object AirLoopHVAC:UnitaryHeatPump:AirToAir:MultiSpeed provides a model for a multispeed air-to-air heat pump that is a “virtual” component that consists of an on/off or constant volume fan component, a multispeed DX cooling coil, a multispeed DX heating coil, and a gas or electric supplemental heating coil. The main difference between this heat pump object and other EnergyPlus heat pump objects is that this object allows from two to four discrete compressor speeds for heating and cooling operation (instead of a single speed for each mode). The specific configuration of the blow through heat pump is shown in the following figure. For a draw through heat pump, the fan is located between the DX heating coil and the supplemental heating coil.

![FurnaceSchematic\_BlowThru\_Multispeed](EngineeringReference/media/image5147.png)

Figure 230. Schematic of a Multispeed Air-to-Air Heat Pump (Blow-through Configuration)

While the heat pump may be configured to serve multiple zones, system operation is controlled by a thermostat located in a single “control” zone. One of the key parameters for the heat pump component is the fraction of the total system airflow that goes through the control zone. This fraction is calculated as the ratio of the maximum air mass flow rate for the air loop’s supply inlet node for the control zone (e.g., AirTerminal:SingleDuct:Uncontrolled, field = Maximum Air Flow Rate, converted to mass flow) to the sum of the maximum air mass flow rates for the air loop’s supply inlet nodes for all zones served by this air loop. The heat pump module scales the calculated load for the control zone upward based on this fraction to determine the total load to be met by the heat pump. The module then proceeds to calculate the required cycling ratio, speed ratio and speed number for the system coil and determines the supply air mass flow rate to meet this total load based on the speed number. The cycling ratio is the ratio of the sensible load (heating or cooling) to the steady-state capacity of the multispeed heat pump’s DX heating or cooling coil at Speed 1 for the entire system time step. It is equivalent to the part load ratio for a single speed DX coil. The value is between 0.0 and 1.0 when the system operates at its lowest speed (Speed 1) and 1.0 when the multispeed heat pump operates at speeds above 1. The speed ratio is the ratio of time in a system time step that the compressor is at rated speed between two consecutive speed numbers ([Compressor Speed - Compressor speed at Speed i-1] / [Compressor speed at Speed i - Compressor speed at Speed i-1]). The compressor speed ratio is between 0.0 and 1.0 when the speed number is above 1 and is 0.0 during Speed 1 operation. The speed number is the lowest index number whose corresponding full-load sensible capacity at the given air mass flow rate is greater than or equal to the sensible load (heating or cooling) in a system time step. The heating or cooling capacity delivered by the heat pump is distributed to all of the zones served by this system via the direct air units that supply air to each zone.

The heat pump component is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Fan:OnOff must be used to model AUTO fan, while Fan:OnOff or Fan:ConstantVolume can be used to model fan ON. The fan operation mode is specified using a supply air fan operating mode schedule where schedule values of 0 denote cycling fan operation and schedule values other than 0 (a 1 is usually used) denote continuous fan operation. Using this schedule, the supply air fan may be cycled with cooling or heating coil operation or operated continuously based on time of day (e.g. cycling fan operation at night and continuous fan operation during the day).

Several output variables are reported by the heat pump object including fan part-load ratio, compressor part-load ratio, cycling ratio, speed ratio and speed number. Fan part-load ratio is defined as the actual air mass flow rate through the system for the time step divided by the operating supply air mass flow rate specified for the heat pump (<span>${{{{\dot m}_{actual}}} \mathord{\left/ {\vphantom {{{{\dot m}_{actual}}} {{{\dot m}_{design}}}}} \right. } {{{\dot m}_{ON}}}}$</span>) at speed 1. Fan part-load ratio is set to 1.0 when the heat pump operates at speeds above 1. The operating supply air mass flow rate may be different for cooling, heating, and when no cooling or heating is required. Compressor part-load ratio is the actual load for the time step divided by the full-load sensible capacity (see Eqn. or Eqn.). If the defrost strategy is reverse cycle for a DX heating coil, the compressor part-load ratio is the sum of the actual load and the defrost load divided by the full-load sensible capacity. Therefore, the compressor part load ratio for the DX heating coil may be greater than the cycling ratio. This heat pump object also reports the sensible, latent and total cooling and heating rate, as well as the electricity consumption for the unit with separate accounting of auxiliary electric consumption. Furthermore, five report variables related to waste heat recovery are available if the user chooses to model this option.

#### Model Description

As described previously, the heat pump is a “virtual” component consisting of a fan, multispeed DX cooling coil, multispeed DX heating coil and supplemental heating coil. The sole purpose of the heat pump model is to properly coordinate the operation of the various system components. The following sections describe the flow of information within the model, as well as the differences between cycling and continuous supply air fan operation.

#### Cooling Operation

The description of heat pump cooling operation is divided in two sections: sensible capacity and average supply air flow rate. Actually, the determinations of capacity and supply air flow rate are related, so these calculations are performed in unison.

##### Capacity calculation

If EnergyPlus determines that the heat pump must supply cooling to the control zone to meet the zone air temperature setpoint, then the heat pump model computes the total sensible cooling load (negative) to be delivered to the zones being served based on the control zone sensible cooling load and the fraction of the heat pump air flow that goes through the control zone.

<div>$$Heat\;Pump\;Cooling\;Load = \frac{{Control\;Zone\;Cooling\;Load}}{{Control\;Zone\;Air\;Flow\;Fraction}}$$</div>

The model then calculates the heat pump’s sensible cooling energy rate delivered to the zones being served when the system runs at full-load conditions at the highest speed and when the DX cooling coil is OFF. If the supply air fan cycles with the compressor, then the sensible cooling energy rate is zero when the cooling coil is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible cooling energy rate will not be zero when the cooling coil is OFF. Calculating the sensible cooling energy rate involves modeling the supply air fan (and associated fan heat) and the multispeed DX cooling coil. The multispeed DX heating coil and the supplemental heating coil are also modeled, but only to pass the air properties and mass flow rate from their inlet nodes to their outlet nodes. For each of these cases (full load at highest cooling speed and DX cooling coil OFF), the sensible cooling energy rate delivered by the heat pump is calculated as follows:

<span>$FullCoolOutpu{t_{Highest\;Speed}} = \left( {{{\dot m}_{HighestSpeed}}} \right){\left( {{h_{out,full\;load}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,HighestSpeed}}$</span><span>$NoCoolOutput = \left( {{{\dot m}_{CoilOff}}} \right){\left( {{h_{out,coil\;off}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,coil\;off}}$</span>

where:

*<span>${\dot m}_{HighestSpeed}$</span>* = air mass flow rate through heat pump at the highest cooling speed [kg/s]

*h<sub>out,\\ full\\ load</sub>*   = enthalpy of air exiting the heat pump at full-load conditions [J/kg]

*h<sub>control \\ zone</sub>*   = enthalpy of air leaving the control zone (where thermostat is located) [J/kg]

*HR<sub>min</sub>=* the minimum humidity ratio of the heat pump exiting air or the air leaving the control zone [kg/kg]

<span>${\dot m}_{CoilOff}$</span> = air mass flow rate through the heat pump with the cooling coil OFF [kg/s]

*h<sub>out,coil \\ off</sub>*    = enthalpy of air exiting the heat pump with the cooling coil OFF [J/kg]

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$${\Delta_{sen,HighestSpeed}} = \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }} + \left( {{{\dot m}_{HighestSpeed}} - \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {h_{Out,full\;load} - {h_{Control\;Zone}}} \right)_{HR\min }}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the cooling coil OFF conditions

<div>$${\Delta_{sen,coil\;off}} = \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }} + \left( {{{\dot m}_{coil\;off}} - \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {{h_{Out,coil\;off}} - {h_{Control\;Zone}}} \right)_{HR\min }}$$</div>



If the heat pump’s sensible cooling rate at the highest speed (full load, no cycling) is insufficient to meet the entire cooling load, the controlled zone conditions will not be met. The reported cycling rate and speed ratio are 1, and the speed number is set to the highest index number. If the total sensible cooling load to be met by the system is less than the sensible cooling rate at the highest speed, then the following steps are performed.

·        Calculate the sensible cooling energy rate at Speed 1

<div>$$FullCoolOutpu{t_{Speed1}} = \left( {{{\dot m}_{Speed1}}} \right){\left( {{h_{out,fullload}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,Speed1}}$$</div>

where

*<span>${{{\dot m}_{Speed1}}}$</span>* = air mass flow rate through heat pump at Speed 1 [kg/s]

Δ<sub>sen,</sub> <sub>Speed1</sub>**=Sensible load difference between the system output node and the zone inlet node at full-load conditions at Speed 1

<div>$${\Delta_{sen,Speed1}} = \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }} + \left( {{{\dot m}_{Speed1}} - \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {{h_{Out,full\;load}} - {h_{Control\;Zone}}} \right)_{HR\min }}$$</div>

·        If the sensible cooling energy rate delivered by the heat pump at Speed 1 is greater or equal to the sensible load, the cycling ratio (part-load ratio) for the heat pump is estimated.

<div>$$\begin{array}{l}CyclingRatio = \frac{{ABS(HeatingCoilSensibleLoad)}}{{FullHeatingCoilCapacity}}\\\;\;\;\;\;\;\;\; = MAX\left( {0.0,\frac{{ABS(Heat\;Pump\;Heating\;Load - AddedFanHeat)}}{{ABS(FullHeatOutpu{t_{Speed1}} - AddedFanHea{t_{Speed1}})}}} \right)\end{array}$$</div>

where

AddedFanHeat  = generated supply air fan heat, which is a function of part load ratio and as internal component cooling load [W].

AddedFanHeat<sub>Speed1</sub>        = generated supply air fan heat at Speed 1 (part load ratio=1) [W].

Since the part-load performance of the DX cooling coil is frequently non-linear,and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the heat pump’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the heat pump’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{\left( {Heat\,Pump\,Cooling\,Load - HeatPumpOutpu{t_{Cycling}}} \right)}}{{Heat\,Pump\,Cooling\,Load}}$$</div>

where:

HeatPumpOutput<sub>Cycling</sub> = heat pump delivered sensible capacity for Speed 1 operating at a specific cycling ratio (W)

<div>$$HeatPumpOutpu{t_{cycling}} = {\dot m_{_{HeatPump}}}{\left( {{h_{out}} - {h_{Control\;Zone}}} \right)_{HR\min }} - {\Delta_{cycling}}$$</div>

where

<span>${\dot m_{HeatPump}}$</span>          = average air mass flow rate defined in the next section [kg/s]

h<sub>out,</sub>        = enthalpy of air exiting the heat pump at part load conditions [J/kg]

Δ<sub>cycling</sub>    =average sensible load difference between the system output node and the zone inlet node

<div>$$\begin{array}{l}\;{\Delta_{cycling}} = \frac{{{{\dot m}_{_{ZoneInlet}}}}}{{frac}}\left( {{h_{ZoneInlet}} - {h_{Control\;Zone}}} \right) + \left( {{{\dot m}_{_{HeatPump}}} - \frac{{{{\dot m}_{_{ZoneInlet}}}}}{{frac}}} \right)\left( {{h_{Out}} - {h_{Control\;Zone}}} \right)\\\;\end{array}$$</div>

<span>${{{\dot m}_{ZoneInlet}}}$</span> = Air mass flow rate in the supply inlet node in the controlled zone [kg/s]

For this case where speed 1 operation was able to meet the required cooling load, the speed ratio is set to zero and speed number is equal to 1.

·        If the heat pump’s cooling output at full load for Speed 1 is insufficient to meet the entire cooling load, the Cycling ratio is set equal to 1.0 (compressor and fan are not cycling). Then the cooling speed is increased and the delivered sensible capacity is calculated. If the full load sensible capacity at Speed n is greater than or equal to the sensible load, the speed ratio for the heat pump is estimated:

<span>$Speed{\kern 1pt} Ratio = \frac{{ABS(Heat{\kern 1pt} Pump{\kern 1pt} Cooling{\kern 1pt} Load - AddeFanHeat - Full{\kern 1pt} Cool{\kern 1pt} Outpu{t_{Speed{\kern 1pt} n - 1}})}}{{ABS(Full{\kern 1pt} CoolOutpu{t_{Speed{\kern 1pt} n}} - Full{\kern 1pt} CoolOutpu{t_{Speed{\kern 1pt} n - 1}})}}$</span>Although a linear relationship is assumed by applying the speed ratio to obtain the effective capacity and mass flow rate between speed n and n-1, the outlet air node conditions are dependent on the combined outputs and may not be linear. In addition, the supply air fan heat varies with the speed ratio due to different supply mass flow rates between speed n and n-1 . Therefore, the final speed ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the cooling coil and fan) until the heat pump’s cooling output matches the cooling load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the heat pump’s cooling output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{Heat\,Pump\,Cooling\,Load - HeatPumpOutpu{t_{SpeedRatio}}}}{{Heat\,Pump\,Cooling\,Load}}$$</div>

where:

HeatPumpOutput<sub>Speed,n</sub>= heat pump delivered sensible capacity between two consecutive speeds at a specific speed ratio (W)

       <span>$\begin{array}{l}HeatPumpOutpu{t_{SpeedRatio}} = (SpeedRatio)FullCoolOutpu{t_{Speed\;n}}\\\;\;\;\;\;\;\; = (1 - SpeedRatio)FullCoolOutpu{t_{Speed\;n - 1}} - AddedFanHea{t_{SpeedRatio}}\end{array}$</span>

Where

AddedFanHeat<sub>SpeedRatio</sub>          = generated supply air fan heat at a specific speed ratio [W]

In this case, the reported cycling ratio is 1 and speed number is equal to n.





##### Air Mass Flow Rate Calculation

Speed 1 operation

If the heat pump has been specified with cycling fan/cycling coil (AUTO fan), then the heat pump’s operating supply air mass flow rate is determined by the cycling ratio (PartLoadRatio) for Speed 1. The supply air mass flow rate is multiplied by the cycling ratio to determine the average air mass flow rate for the system simulation time step. The air conditions at nodes downstream of the cooling coils represent the full-load (steady-state) values when the coil is operating.

<div>$${\dot m_{HeatPump}} = (CyclingRatio){\dot m_{Speed1}}$$</div>

If the fan operates continuously (i.e., when the supply air fan operating mode schedule values are NOT equal to 0), the operating air mass flow rate through the heat pump is calculated as the average of the user-specified air flow rate when the heat pump cooling coil is ON at Speed 1 and the user-specified air flow rate when the heat pump cooling coil is OFF (user-specified supply air volumetric flow rates converted to dry air mass flow rates).

<div>$${\dot m_{HeatPump}} = (CyclingRatio){\dot m_{Speed1}} + (1.0 - CyclingRatio){\dot m_{CoilOff}}$$</div>

where:

<span>${\dot m_{HeatPump}}$</span> = average air mass flow rate through heat pump [kg/s]

<span>${{{\dot m}_{Speed1}}}$</span>= air mass flow rate through heat pump when cooling coil is ON at Speed 1 [kg/s]

<span>${{{\dot m}_{CoilOff}}}$</span> = air mass flow rate through heat pump when no heating or cooling is needed [kg/s]

In this case, the air conditions at nodes downstream of the cooling coils are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and inlet air conditions when the coil is OFF).

##### Higher Speed Operation

When the heat pump operates at higher speeds to meet the required cooling load, the supply air mass flow rate is linearly interpolated between two consecutive speeds:

<div>$${\mathop m\limits^ \bullet_{HeatPump}} = (SpeedRatio)\mathop m\limits^ \bullet  {{\kern 1pt}_{Speed{\kern 1pt} n}} + (1.0 - SpeedRatio)\mathop m\limits^ \bullet  {{\kern 1pt}_{Speed{\kern 1pt} n - 1}}$$</div>

where:

<span>${\dot m_{HeatPump}}$</span>= average air mass flow rate through the heat pump for the time step [kg/s]

<span>${\dot m_{Speed\;n}}$</span>= air mass flow rate through heat pump when cooling coil is ON at Speed n [kg/s]

<span>${\dot m_{Speed\;n - 1}}$</span>= air mass flow rate through heat pump when cooling coil is ON at Speed n-1 [kg/s]

For this case of higher speed operation, the air conditions at nodes downstream of the cooling coils are determined by the delivered cooling capacity and supply air mass flow rates between two consecutive speeds.

Although the above sections present the capacity and air mass flow rate calculation separately, they are dependent and change every iteration until convergence is reached for the time step being simulated.

#### Heating Operation

The description of heat pump heating operation is divided in two sections: total (sensible) capacity and average supply air flow rate. Actually, the determinations of capacity and supply air flow rate are related, so these calculation are performed in unison.

##### Capacity calculation

If EnergyPlus determines that the heat pump must supply heating to the control zone to meet the zone air temperature setpoint, then the heat pump model computes the total sensible heating load (positive) to be delivered to the zones being served based on the control zone sensible heating load and the fraction of the heat pump air flow that goes through the control zone.

<div>$$Heat\;Pump\;Heating\,Load = \frac{{Control\;Zone\;Heating\,Load}}{{Control\;Zone\;Air\;Flow\;Fraction}}$$</div>

The model then calculates the heat pump’s sensible heating energy rate delivered to the zones being served when the system runs at full-load conditions at the highest speed and when the DX heating coil is OFF (without supplemental heater operation in either case). If the supply air fan cycles with the compressor, then the sensible heating energy rate is zero when the compressor is OFF. However if the fan is scheduled to run continuously regardless of coil operation, then the sensible heating energy rate will not be zero when the compressor is OFF. Calculating the sensible heating energy rate involves modeling the supply air fan (and associated fan heat), the DX cooling coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node), the DX heating coil, and the supplemental heating coil (simply to pass the air properties and mass flow rate from its inlet node to its outlet node). For each of these cases (full load and DX heating coil OFF, without supplemental heater operation in either case), the sensible heating energy rate delivered by the heat pump is calculated as follows:

<div>$$FullHeatOutpu{t_{Highest\;Speed}} = \left( {{{\dot m}_{HighestSpeed}}} \right){\left( {{h_{out,full\;load}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,HighestSpeed}}$$</div>

<div>$$NoHeatOutput = \left( {{{\dot m}_{CoilOff}}} \right){\left( {{h_{out,coil\;off}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,coil\;off}}$$</div>

where:

*<span>${\dot m}_{HighestSpeed}$</span>* = air mass flow rate through heat pump at the highest heating speed [kg/s]

*h<sub>out,\\ full\\ load</sub>*   = enthalpy of air exiting the heat pump at full-load conditions [J/kg]

*h<sub>control \\ zone</sub>*   = enthalpy of air leaving the control zone (where thermostat is located) [J/kg]

*HR<sub>min</sub>=* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the heat pump exiting air or the air leaving the control zone

<span>${\dot m}_{CoilOff}$</span>= air mass flow rate through the heat pump with the heating coil OFF [kg/s]

*h<sub>out,coil \\ off</sub>*    = enthalpy of air exiting the heat pump with the heating coil OFF [J/kg]

Δ<sub>sen,</sub> *<sub>full\\ load</sub>*=Sensible load difference between the system output node and the zone inlet node at full-load conditions

<div>$${\Delta_{sen,HighestSpeed}} = \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }} + \left( {{{\dot m}_{HighestSpeed}} - \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {h_{Out,full\;load} - {h_{Control\;Zone}}} \right)_{HR\min }}$$</div>

where:

Frac = Control zone air fraction with respect to the system mass flow rate

Δ<sub>sen,coil\\ off</sub>**=Sensible load difference between the system output node and the zone inlet node with the heating coil OFF conditions

<div>$${\Delta_{sen,coil\;off}} = \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,coil\;off}} - {h_{Zone\;Inlet}}} \right)_{HR\min }} + \left( {{{\dot m}_{coil\;off}} - \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {{h_{Out,coil\;off}} - {h_{Control\;Zone}}} \right)_{HR\min }}$$</div>

If the heat pump’s DX heating coil output full load at the highest speed is insufficient to meet the entire heating load, the remaining heating load is passed to the supplemental heating coil. If the heat pump model determines that the outdoor air temperature is below the minimum outdoor air temperature for compressor operation (specified by the user), the compressor is turned off and the entire heating load is passed to the supplemental gas or electric heating coil. The heat pump exiting air conditions and energy consumption are calculated and reported by the individual component models (fan, DX heating coil, and supplemental gas or electric heating coil).

If the total heating load to be met by the system is less than the sensible heating rate at the highest speed, then the following steps are performed.

1.    Calculate the sensible heating energy rate at Speed 1

<div>$$FullHeatOutpu{t_{Speed1}} = \left( {{{\dot m}_{Speed1}}} \right){\left( {{h_{out,fullload}} - {h_{control\;zone}}} \right)_{HR\min }} - {\Delta_{sen,Speed1}}$$</div>

where:

*<span>${{{\dot m}_{Speed1}}}$</span>* = air mass flow rate through heat pump at Speed 1 [kg/s]

Δ<sub>sen,</sub> <sub>Speed1</sub>**=Sensible load difference between the system output node and the zone inlet node at full-load conditions at Speed 1

<div>$${\Delta_{sen,Speed1}} = \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}{\left( {{h_{Out,full\;load}} - {h_{Zone\;Inlet}}} \right)_{HR\min }} + \left( {{{\dot m}_{Speed1}} - \frac{{{{\dot m}_{Zone\;Inlet}}}}{{Frac}}} \right){\left( {{h_{Out,full\;load}} - {h_{Control\;Zone}}} \right)_{HR\min }}$$</div>

2.    If the sensible heating energy rate delivered by the heat pump at Speed 1 is greater or equal to the sensible load, the cycling ratio (part-load ratio) for the heat pump is estimated.

<div>$$\begin{array}{l}CyclingRatio = \frac{{ABS(HeatingCoilSensibleLoad)}}{{FullHeatingCoilCapacity}}\\\;\;\;\;\;\;\; = MAX\left( {0.0,\frac{{ABS(Heat\;Pump\;Heating\;Load - AddedFanHeat)}}{{ABS(FullHeatOutpu{t_{Speed1}} - AddedFanHea{t_{Speed1}})}}} \right)\end{array}$$</div>

where

AddedFanHeat        = generated supply air fan heat, which is a function of part load ratio and as internal component heating load [W].

AddedFanHeat<sub>Speed1</sub>  = generated supply air fan heat at Speed 1 (part load ratio=1) [W].

Since the part-load performance of the DX heating coil is frequently non-linear (Ref: Single-Speed Electric Heat Pump DX Air Heating Coil), and the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan), the final part-load ratio for the heating coil compressor and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the heat pump’s heating output matches the heating load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the heat pump’s heating output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{Heat\,Pump\,Heating\,Load - HeatPumpOutpu{t_{Cycling}}}}{{Heat\,Pump\,Heating\,Load}}$$</div>

where:

HeatPumpOutput<sub>Cycling</sub>= heat pump delivered sensible capacity for Speed 1 operating at a specific cycling ratio (W)

<div>$$HeatPumpOutpu{t_{cycling}} = {\dot m_{_{HeatPump}}}{\left( {{h_{out}} - {h_{Control\;Zone}}} \right)_{HR\min }} - {\Delta_{cycling}}$$</div>

where

<span>${\dot m_{HeatPump}}$</span>    = average air mass flow rate defined in the next section [kg/s]

h<sub>out,</sub>              = enthalpy of air exiting the heat pump at part load conditions [J/kg]

Δ<sub>cycling</sub>          =average sensible load difference between the system output node and the zone inlet node

<div>$$\begin{array}{l}\;{\Delta_{cycling}} = \frac{{{{\dot m}_{_{ZoneInlet}}}}}{{frac}}\left( {{h_{ZoneInlet}} - {h_{Control\;Zone}}} \right) + \left( {{{\dot m}_{_{HeatPump}}} - \frac{{{{\dot m}_{_{ZoneInlet}}}}}{{frac}}} \right)\left( {{h_{Out}} - {h_{Control\;Zone}}} \right)\\\;\end{array}$$</div>

<span>${{{\dot m}_{ZoneInlet}}}$</span>       = Air mass flow rate in the supply inlet node in the controlled zone [kg/s]

For this case where speed 1 operation was able to meet the required heating load, the speed ratio is set to zero and speed number is equal to 1.

3.    If the heat pump’s heating output at full load for Speed 1 is insufficient to meet the entire heatling load, the Cycling ratio (PartLoadRatio) is set equal to 1.0 (compressor and fan are not cycling). Then the heating speed is increased and the delivered sensible capacity is calculated. If the full load sensible capacity at Speed n is greater than or equal to the sensible load, the speed ratio for the heat pump is estimated:

<div>$$Speed{\kern 1pt} Ratio = \frac{{ABS(Heat{\kern 1pt} Pump{\kern 1pt} Heating{\kern 1pt} Load - AddeFanHeat - Full{\kern 1pt} Heat{\kern 1pt} Outpu{t_{Speed{\kern 1pt} \;n - 1}})}}{{ABS(Full{\kern 1pt} HeatOutpu{t_{Speed\;n}} - Full{\kern 1pt} HeatOutpu{t_{Speed\;n - 1}})}}$$</div>

Although a linear relationship is assumed by applying the speed ratio to obtain the effective capacity and air mass flow rate between speed n and n-1, the outlet node conditions are dependent on the combined outputs and may not be linear. In addition, the supply air fan heat varies based on heating coil operation for the case of cycling fan/cycling coil (AUTO fan). Therefore, the final speed ratio for the heating coil compressor and fan are determined through iterative calculations (successive modeling of the heating coil and fan) until the heat pump’s heating output matches the heating load to be met within the convergence tolerance. The convergence tolerance is fixed at 0.001 and is calculated based on the difference between the load to be met and the heat pump’s heating output divided by the load to be met.

<div>$$Tolerance = 0.001 \ge \frac{{Heat\,Pump\,Heating\,Load - HeatPumpOutpu{t_{SpeedRatio}}}}{{Heat\,Pump\,Heating\,Load}}$$</div>

where:

HeatPumpOutput<sub>SpeedRatio</sub>= heat pump delivered sensible capacity between two consecutive speeds at a specific ratio [W]

       <span>$\begin{array}{l}HeatPumpOutpu{t_{SpeedRatio}} = (SpeedRatio)FullHeatOutpu{t_{Speed\;n}}\\\;\;\;\;\;\;\; = (1 - SpeedRatio)FullHeatOutpu{t_{Speed\;n - 1}} - AddedFanHea{t_{SpeedRatio}}\end{array}$</span>

Where

AddedFanHeat<sub>SpeedRatio</sub>          = generated supply air fan heat at a specific speed ratio [W]

In this case, the reported cycling ratio is 1 and speed number is equal to n.

##### Air Mass Flow Rate Calculation

The air mass flow rate calculations during heating operation are the same as those described above for cooling operation.

#### Fan Placement

Supply air fan placement impacts the iteration strategy. When the fan placement type is blow through, the air mass flow rate and coil part load factor (PLF) affect the fan outlet conditions. Since the fan is upstream of the coil components with this fan placement, the fan outlet conditions are calculated without knowing the next component’s performance at the beginning of each iteration. DX coil performance is strongly dependent on the inlet conditions, so without correct inlet conditions the DX coil components may not be simulated correctly. Therefore, the heat pump components are called twice for each iteration when fan placement is ‘blow through’. The correct part load factor for the fan component is obtained after the first call, so that the more realistic fan outlet conditions are used to simulate the coil performance in the second call. This extra call to the heat pump components is not required for the draw through fan since the supply air fan is located downstream of the DX coils with this fan placement.

#### Waste Heat Calculation

When the heat recovery is active (the value of the Design Heat Recovery Water Flow Rate field is greater than 0), the outlet node temperature of heat recovery is calculated based on the recoverable waste heat generated by its child objects (Coil:Cooling:DX:MultiSpeed and Coil:Heating:DX:MultiSpeed):

<div>$${T_{outlet}} = {T_{inlet}} + \frac{{{Q_{WasteHeat}}}}{{{C_p}{{\dot m}_{hr}}}}$$</div>

where

T<sub>outlet</sub>            = outlet node temperature of heat recovery, C

T<sub>inlet</sub> = inlet node temperature of heat recovery, C

Q<sub>WasteHeat</sub>      = recoverable waste heat generated by its child objects, W

C<sub>p</sub>              = inlet node temperature of heat recovery, C

<span>${{{\dot m}_{hr}}}$</span>            = mass flow rate of heat recovery, kg/s

If the outlet node temperature is above the value of the Maximum Temp for Heat Recovery field, the outlet node temperature is reset to the value of Maximum Temp for Heat Recovery.

### DX Cooling Package

#### Overview

The DX cooling package subsystem model provides a “virtual” component that consists of a DX air cooling coil component as shown in the figure below. The CoilSystem:Cooling:DX input object provides a container component that controls the associated DX cooling coil which is specified in a separate object. This coil can be specified anywhere in the air loop simulation and is controlled by the setpoint(s) on the control node. Optional dehumidification controls may also be specified. CoilSystem:Cooling:DX assumes continuous fan operation for any given time step, because it is not able to control cycling fan operation in the way that other AirLoopHVAC:Unitary\* systems can.

This system does not need any plant specification and will provide the electric consumption necessary to operate the compressor and the condenser fan.

![](EngineeringReference/media/image5198.png)

Figure 231.  Schematic of Packaged DX Cooling Subsystem in Air Loop for a Blow-Thru Application

#### Controls

The system calculates the current sensible load using the temperature of the inlet node and the System Node Setpoint Temp on the control node. If the control node is not the outlet node, the desired outlet node temperature is adjusted for the current temperature difference between the outlet node and the control node. Likewise, the current latent load is calculated using the humidity ratio of the inlet node and the System Node Humidity Ratio Max on the control node. The controls determine the required coil run-time fraction and dehumidification mode (if applicable) using the steps outlined below.

##### Step 1 – Meet Sensible Load Requirement

The controls first attempt to meet the sensible requirement. The specified DX coil model is called with a part-load ratio (PLR) of 1.0 to determine the full-load output of the coil. This is compared with the desired outlet node temperature and a sensible PLR is calculated. If the PLR is &lt;1.0, a Regula-Falsi iteration routine is called to determine the coil run-time fraction which results in the desired outlet node temperature. For a variable-speed DX cooling coil, if the load is smaller than the sensible capacity at the lowest speed, the coil run-time fraction is determined in the same way as a single-speed DX cooling coil. Otherwise, its speed level and speed ratio between two neighboring speeds are selected to match the load.

If the cooling coil type is specified as CoilSystem:Cooling:DX:CoolingHeatExchanganerAssisted and the dehumidification control type is specified as CoolReheat, the heat exchanger is active during this attempt to meet the sensible requirement.

##### Step 2 – Meet Latent Load Requirement (if activated)

If dehumidification controls are active, the leaving humidity ratio resulting from operation to meet the sensible load (Step 1 above) is compared with the desired outlet node humidity ratio. If the humidity requirement is already met, then no further control action is taken. If the humidity requirement has not been met, then the coil is re-simulated depending on the type of humidity control.

##### Step 2a – Humidity Control = MultiMode

If the humidity control type is MultiMode, then the coil's enhanced dehumidification mode is activated when the coil type is Coil:Cooling:DX:TwoStageWithHumidityControlMode or the heat exchanger is activated when the coil type is CoilSystem:Cooling:DX:CoolingHeatExchangerAssisted and Step 1 above is repeated to meet the sensible load using the coil performance resulting from the enhanced dehumidificaiton mode. This is a semi-passive approach to dehumidification which may fall short or may exceed the dehumidification requirement. If the user has specified Run on Latent Load = Yes in the CoilSystem:Cooling:DX object, and there is no sensible load to be met, then the system will try to meet the entire dehumidification load. If dehumidification mode should not be active when there is no sensible load, then choose Run on Latent Load = No.

##### Step 2b – Humidity Control = CoolReheat

If the humidity control type is CoolReheat, the coil is re-simulated to achieve the desired outlet node humidity ratio. This option is valid for all cooling coil types. When the coil type is Coil:Cooling:DX:TwoStageWithHumidityControlMode, only the cooling performance mode is used for this step and enhanced dehumidification mode is not activated.

### DX Heating Package

#### Overview

The DX heating package subsystem model provides a “virtual” component that consists of a DX air-to-air heating coil component and associated controls. The CoilSystem:Heating:DX input object provides a container component that controls the associated DX heating coil  which is specified in a separate object. See the entry called Single-Speed and Variable-Speed Electric Heat Pump DX Air Heating Coil for details of the coil model itself.  This coil can be specified anywhere in the air loop simulation and is controlled by the setpoint on the heating coil’s outlet node. This model is analogous to the model for CoilSystem:Cooling:DX which is similar but for cooling.  The model assumes continuous fan operation for any given time step, because it is not able to control cycling fan operation in the way that other AirLoopHVAC:Unitary\* systems can.

This system does not need any plant specification and will provide the electric consumption necessary to operate the compressor and the condenser fan.

#### Controls

The DX heating package system calculates how the coil should operate to meet current sensible load using the temperature of the inlet node and the System Node Setpoint Temp on the outlet node. The controls determine the required coil run-time fraction to meet the sensible requirement. The Single-Speed Electric Heat Pump DX Air Heating Coil model is called with a part-load ratio (PLR) of 1.0 to determine the full-load output of the coil. If the PLR is &lt;1.0, a Regula-Falsi iteration routine is called to determine the coil run-time fraction which results in the desired outlet node temperature. For a variable-speed DX heating coil, if the load is smaller than the heating capacity at the lowest speed, the coil run-time fraction is determined in the same way as a single-speed DX heating coil. Otherwise, its speed level and speed ratio between two neighboring speeds are selected to match the load.

### Desiccant Dehumidifier Package

#### Overview

The input object Dehumidifier:Desiccant:System provides a model that packages components for a desiccant-based subsystem that dehumidifies an air stream, normally called the process air stream. A second heated air stream, called the regeneration air stream, is used to remove the collected moisture from the desiccant heat exchanger and this moisture-laden air is then usually exhausted from the building. This Dehumidifier:Desiccant:System object is similar to the Dehumidifier:Desiccant:NoFans object but has some additional modeling capabilities.

The Dehumidifier:Desiccant:System desiccant dehumidifier object in EnergyPlus is a compound object that can be placed anywhere in an air loop. Common locations for this object are in an AirLoopHVAC:OutdoorAirSystem or in the main air loop downstream of a cooling coil (postcooling desiccant dehumidifier). This compound object coordinates the operation of several ‘children’ objects: a desiccant heat exchanger, a regeneration air fan, and an optional regeneration air heater. If this dehumidifier is placed in the main air loop immediately downstream of a direct expansion (DX) cooling coil, then the dehumidifier’s operation can be coordinated with the operation of the companion DX coil and it is also possible to specify that the DX system’s condenser waste heat can be used to help regenerate the desiccant heat exchanger. For the case of condenser waste heat regeneration, an optional exhaust fan can also be modeled by this desiccant dehumidifier compound object to help maintain a setpoint temperature for air entering the regeneration side of the desiccant heat exchanger. Refer to the EnergyPlus Input Output Reference for the specific input syntax for this desiccant dehumidifier object.

![DesiccantDehumidifier\_DrawThrough](EngineeringReference/media/image5199.png)

Figure 232. Schematic of a Desiccant Dehumidifier with Draw Through Regeneration Fan Placement



![DesiccantDehumidifier\_BlowThrough](EngineeringReference/media/image5200.png)

Figure 233. Schematic of a Desiccant Dehumidifier in Blow Through Regeneration Fan Placement

#### Control Logic

The model first decides if the dehumidifier can operate for the simulation time step, based on its availability schedule and if there is air flow detected on the process air inlet node. If available to operate, then the target humidity ratio for the process outlet air is determined based on the maximum humidity ratio setpoint on the control node (System Node Setpoint Humidity Ratio Max). If the control node is not the process air outlet node, the target humidity ratio is adjusted for the current humidity ratio difference between the process air outlet node and the control node. If the humidity ratio of the process inlet air is greater than the target humidity ratio for the process outlet air, then the dehumidifier operates to meet the target to the extent possible.

Once it is determined that the dehumidifier should operate, the components upstream of the desiccant heat exchanger’s regeneration inlet are modeled. The actual components that are modeled depend on the configuration specified by the user.

If the waste heat from the companion cooling coil is being used to heat the regeneration air, then this model determines the temperature of the air leaving the cooling coil condenser. The user may also specify a setpoint temperature for the regeneration air entering the desiccant heat exchanger and an optional exhaust fan, which can impact the condenser leaving air temperature. For this case, the exhaust fan is used to control the condenser leaving air temperature by boosting the air flow rate through the condenser to meet the setpoint temperature (minus regeneration fan heat if blow through fan placement).

Note: If the desiccant dehumidifier is OFF for a simulation time step but its companion cooling coil is operating and is specified to provide regeneration air heating, then the exhaust fan operates at the maximum air flow rate (i.e., this fan serves at the condenser fan for the companion cooling coil system when regeneration air heating is specified, so the inputs for the companion cooling coil object should not include the condenser fan energy since the condenser fan energy is modeled by the Dehumidifier:Desiccant:SystemDesiccant Dehumidifier object).

The exhaust fan power is determined as follows:

<div>$$\begin{array}{l}If\,dehumidifier\,is\,operating:\\\,\,\,PL{R_{exhaust}} = \,\frac{{{{\mathop m\limits^ \bullet  }_{exhaust}}}}{{\left( {{\rho_{Std}} * {{\mathop {\rm{V}}\limits^ \bullet  }_{exhaust,\,max}}} \right)}}\\\,\,\,{P_{exhaust}} = \,{P_{exhaust,\,max}} * \,ExhFanModFac\\\\If\,dehumidifier\,\,is\,\,not\,\,operating\,\,but\,\,companion\,\,coil\,\,is\,\,operating:\\\,\,\,{P_{exhaust}} = \,{P_{exhaust,\,max}} * \,PL{R_{companion\,coil}}\end{array}$$</div>

where:

<span>$PL{R_{exhaust}}$</span>  = part load ratio of the exhaust fan

<span>${\mathop {\rm{V}}\limits^ \bullet_{exhaust,\,max}}$</span>  = exhaust fan maximum volumetric flow rate, user input (m<sup>3</sup>/s)

<span>${\rho_{Std}}$</span>           = density of air at standard temperature and pressure [dry air at 20°C] (m<sup>3</sup>/kg)

<span>${P_{exhaust,\,max}}$</span>   = exhaust fan maximum power, user input (W)

<span>$ExhFanModFac$</span>= exhaust fan power modifier curve evaluated at PLR<sub>exhaust</sub>. If modifier                                        curve not provided by the user, then this factor is assumed to be 1.0.

<span>$PL{R_{companion\,coil}}$</span>     = part load ratio of the companion cooling coil

<span>${P_{exhaust}}$</span>        = output variable ‘Dehumidifier Exhaust Fan Electric Power, W’

The exhaust fan electric consumption is then calculated as:

<div>$${E_{exhaust}} = {P_{exhaust}}*\,\,TimeStepSys\,\,*\,\,3600.$$</div>

where:

<span>${E_{exhaust}}$</span>          = output variable ‘Dehumidifier Exhaust Fan Electric Energy, J’

<span>$TimeStepSys$</span>= HVAC system simulation time step, hr

Once the outlet conditions from the companion coil condenser are determined (if present), then the regeneration air fan (if blow through configuration) and regeneration air heater (if present) are simulated. To the extent possible (e.g., if the heater is available to operate based on its availability schedule and it has sufficient heating capacity), the regeneration air heater operates to raise its outlet air temperature to the specified regeneration inlet air setpoint temperature.

With the inlet air conditions to the regeneration and process sides of the desiccant heat exchanger now known, the performance of the desiccant heat exchanger is modeled. If the desiccant dehumidifier is specified with a companion cooling coil upstream of the heat exchanger’s process inlet, then the model assumes that the dehumidifier operates at the same time as the companion coil (same part-load ratio). If not, then the desiccant dehumidifier model calculates the fraction of time it must operate to meet the process outlet air maximum humidity target (setpoint) using the following equation:

<div>$$\begin{array}{l}\,DDPartLoadRatio = \,\frac{{\left( {{w_{Proc,\,\,in}} - {w_{max, set\,point}}} \right)}}{{\left( {{w_{Proc,\,\,in}} - {w_{Proc,\,\,out,HXon}}} \right)}}\\DDPartLoadRatio = MAX\left( {0.0,DDPartLoadRatio} \right)\\DDPartLoadRatio = MIN\,\left( {1.0,DDPartLoadRatio} \right)\end{array}$$</div>

where:

<span>$\,DDPartLoadRatio$</span> = output variable ‘Dehumidifier Part Load Ratio’

<span>${w_{Proc,\,\,in}}$</span>      = process inlet air humidity ratio (kg/kg)

<span>${w_{max, set\,point}}$</span> = target humidity ratio (setpoint) for the process outlet air (kg/kg)

<span>${w_{Proc,\,\,out,HXon}}$</span>= process outlet air humidity ratio when the desiccant heat exchanger operates       (kg/kg)

After all of the desiccant dehumidifier components are modeled at the appropriate part load ratio, the water removal rate and water removed are calculated.

<div>$$
  \begin{array}{rl}
    {\mathop m\limits^ \bullet_{water\_removed,Proc}} &= \,{\mathop m\limits^ \bullet_{Proc,in}}\left( {{w_{Proc,\,\,in}} - {w_{Proc,\,\,out}}} \right) \\
    {m_{water\_removed,Proc}}                         &= {\mathop m\limits^ \bullet_{water\_removed,Proc}}*\,\,TimeStepSys\,\,*\,\,3600.
  \end{array}
$$</div>

where:

<span>${\mathop m\limits^ \bullet_{water\_removed,Proc}}$</span> = output variable ‘Dehumidifier Removed Water Mass Flow Rate, kg/s’

<span>${\mathop m\limits^ \bullet_{Proc,in}}$</span>       = air mass flow rate at the process air inlet node (kg/s)

<span>${w_{Proc,\,\,out}}$</span>     = process outlet air humidity ratio (kg/kg)

<span>${m_{water\_removed,Proc}}$</span>= output variable ‘Dehumidifier Removed Water Mass, kg’

#### References

ASHRAE. 2004. Chapter 22: Desiccant Dehumidification and Pressure-Drying Equipment. 2004 ASHRAE HVAC Systems and Equipment Handbook. Atlanta, GA: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Kosar, D. 2006. Dehumidification Enhancements, ASHRAE Journal, Vol. 48, No. 2, February 2006.

Kosar, D. et al. 2006. Dehumidification Enhancement of Direct Expansion Systems Through Component Augmentation of the Cooling Coil. 15<sup>th</sup> Symposium on Improving Building Systems in Hot and Humid Climates, July 24-26, 2006.

### Unitary Water-To-Air Heat Pump

#### Overview

The input object AirLoopHVAC:UnitaryHeatPump:WaterToAir provides a model for a water-to-Air heat pump that is a “virtual” component that consists of an on/off fan component, a water-to-air heat pump cooling coil, a water-to-air heat pump heating coil, and a gas or electric supplemental heating coil. The specific configuration of the blowthru heat pump is shown in the following figure. For a drawthru heat pump, the fan is located between the water-to-air heat pump heating coil and the supplemental heating coil. The configuration of the water-to-air heat pump in the air loop is similar to an air-to-air heat pump. In addition, a water-to-air heat pump has a water loop connection on its source side. The water loop can be served by a condenser loop (like GHE for Ground source systems), or by a cooling tower/ boiler plant loop (for water loop systems).

![FurnaceSchematic\_WSHP](EngineeringReference/media/image5222.png)

Figure 234.  Source Side and Load Side Configuration of a BlowThru WateroToAir Heat Pump

There are two different models for water-to-air heat pump cooling and heating coils. Cooling and heating coils are modeled using a Single Speed or Variable Speed Equation Fit model or a Parameter Estimation model. The parameter estimation procedure is quite detailed and the equation fit model is designed to simplify the user inputs. Each model is discussed in short in the following sections. The Variable-Speed Equation Fit model is described in a separate section, as Coil:Cooling:WaterToAirHeatPump:VariableSpeedEquationFit and Coil:Heating:WaterToAirHeatPump:VariableSpeedEquationFit.

#### Single Speed Equation-Fit Model:

This section describes the equation-fit model for Water-to-Air heat pump  (Object names: **Coil:Cooling:WaterToAirHeatPump:EquationFit** and **Coil:Heating:WaterToAirHeatPump:EquationFit**). This documentation is derived from the M.S. dissertation of Tang (2005) which is available on the Oklahoma State University web site . The model uses five non-dimensional equations or curves to predict the heat pump performance in cooling and heating mode. The methodology involved using the generalized least square method to generate a set of performance coefficients from the catalog data at indicated reference conditions. Then the respective coefficients and indicated reference conditions are used in the model to simulate the heat pump performance. The variables or inlet conditions that influenced the water-to-air heat pump performance are load side inlet water temperature, source side inlet temperature, source side water flow rate and load side water flow rate. The governing equations for the cooling and heating mode are as following:

Cooling Mode:

<div>$$\frac{{Q{}_{total}}}{{Q{}_{total,ref}}} = A1 + A2\left[ {\frac{{{T_{wb}}}}{{{T_{ref}}}}} \right] + A3\left[ {\frac{{T{}_{w,in}}}{{T{}_{ref}}}} \right] + A4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + A5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

<div>$$\frac{{{Q_{sens}}}}{{{Q_{sens,ref}}}} = B1 + B2\left[ {\frac{{T{}_{db}}}{{T{}_{ref}}}} \right] + B3\left[ {\frac{{T{}_{wb}}}{{T{}_{ref}}}} \right] + B4\left[ {\frac{{T{}_{w,in}}}{{T{}_{ref}}}} \right] + B5\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + B6\left[ {\frac{{\dot V{}_w}}{{\dot V{}_{w,ref}}}} \right]$$</div>

<div>$$\frac{{Power{}_c}}{{Power{}_{c,ref}}} = C1 + C2\left[ {\frac{{{T_{wb}}}}{{{T_{ref}}}}} \right] + C3\left[ {\frac{{T{}_{w,in}}}{{T{}_{ref}}}} \right] + C4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + C5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

Heating Mode:

<div>$$\frac{{{Q_h}}}{{Q{}_{h,ref}}} = E1 + E2\left[ {\frac{{{T_{db}}}}{{{T_{ref}}}}} \right] + E3\left[ {\frac{{T{}_{w,in}}}{{T{}_{ref}}}} \right] + E4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + E5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

<div>$$\frac{{Powe{r_h}}}{{Power{}_{h,ref}}} = F1 + F2\left[ {\frac{{{T_{db}}}}{{{T_{ref}}}}} \right] + F3\left[ {\frac{{T{}_{w,in}}}{{T{}_{ref}}}} \right] + F4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + F5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

Assuming no losses, the source side heat transfer rate for cooling and heating mode is calculated as following;

<div>$${Q_{source,c}} = {Q_{total}} + Powe{r_c}$$</div>

<div>$${Q_{source,h}} = {Q_h} - Powe{r_h}$$</div>

where:

<span>$A1 - F5$</span>     = Equation fit coefficients for the cooling and heating mode

<span>${T_{ref}}$</span>            = 283K

<span>${T_{w,in}}$</span>           = Entering water temperature, K

<span>${T_{db}}$</span>             = Entering air dry-bulb temperature, K

<span>${T_{wb}}$</span>            = Entering air wet-bulb temperature, K

<span>${\dot V_{air}}$</span>            = Load side air volumetric flow rate, m<sup>3</sup>/s

<span>${\dot V_w}$</span>                         = Source side water volumetric flow rate, m<sup>3</sup>/s

<span>${Q_{total}}$</span>          = Total cooling capacity, W

<span>${Q_{sens}}$</span>          = Sensible cooling capacity, W

<span>$Powe{r_c}$</span>     = Power consumption (cooling mode), W

<span>${Q_{source,c}}$</span>      = Source side heat transfer rate (cooling mode), W

<span>${Q_h}$</span>                         = Total heating capacity, W

<span>$Powe{r_h}$</span>     = Power consumption (heating mode), W

<span>${Q_{source,h}}$</span>      = Source side heat transfer rate (heating mode), W

The inlet conditions or variables are divided by the reference conditions. This formulation allows the coefficients to fall into smaller range of values. Moreover, the value of the coefficient indirectly represents the sensitivity of the output to that particular inlet variable. The reference conditions used when generating the performance coefficients must be the same as the reference conditions used later in the model. The reference temperature <span>${T_{ref}}$</span>is fixed at 283K. Temperature unit of Kelvin is used instead of Celsius to keep the ratio of the water inlet temperature and reference temperature positive value should the water inlet temperature drop below the freezing point.

For cooling mode, the reference conditions; reference load side air volumetric flow rate <span>$\left( {{{\dot V}_{air,ref}}} \right)$</span>,reference source side water volumetric flow rate<span>$\left( {{{\dot V}_{w,ref}}} \right)$</span>,reference sensible capacity <span>$\left( {{Q_{sens,ref}}} \right)$</span> and reference power input <span>$\left( {Powe{r_{c,ref}}} \right)$</span> are the conditions when the heat pump is operating at the highest cooling capacity or reference cooling capacity<span>$\left( {{Q_{total,ref}}} \right)$</span> indicated in the manufacturer’s catalog. Note that the reference conditions for heating mode might differ from the reference conditions specified for the cooling mode.

#### Coefficient estimation procedure:

The generalized least square method is used to generate the coefficients. This method utilizes an optimization method which calculates the coefficients that will give the least amount of differences between the model outputs and the catalog data. A set of coefficients for the cooling mode is generated which includes A1-A5 for total cooling capacity, B1-B6 for sensible cooling capacity, and C1-C5 for power consumption. The same procedure is repeated for the heating mode to generate the coefficients E1-E5 and F1-F5. An information flow chart showing the inputs, reference conditions, performance coefficients and outputs are shown in the figure below:

![](EngineeringReference/media/image5250.png)

Figure 235. Information Flow Chart for Water-to-Air Heat Pump Equation Fit Model (Tang 2005)

#### High Humidity Control with WaterToAir HeatPump Equation Fit model

The specific configuration of the WaterToAir HeatPump with supplemental heating coil is shown above (see Figure 234). This figure shows the fan placement when a blow through fan is specified. If a draw through fan is specified, the fan is located between the heating coil and the reheat coil. The system is controlled to keep the high relative humidity in the control zone from exceeding the setpoint specified in the object ZoneControl:Humidistat. When high humidity control is specified and the compressor operates, the heatpump always operates at the cooling air flow rate when a zone heating load is present as determined by the zone thermostat. High humidity control is specified as either None, or CoolReheat in the Dehumidification Control Type input field. CoolReheat is specified when a DX cooling coil is used to over-cool the supply air stream in order to meet the zone latent load. In this case, a supplemental heating coil will ensure the zone temperature does not fall below the zone heating temperature set point. If the dehumidification control type is selected as None, the WaterToAir HeatPump uns only to meet the sensible cooling load. A supplemental heating coil is required for all dehumidification control types.

The model first calculates the *PartLoadRatio* required meeting the sensible cooling load.  The heatpump’s sensible cooling load is determined from the control zone sensible cooling load to the cooling setpoint and the control zone air flow fraction to maintain the dry-bulb temperature setpoint in the control zone:

<div>$$HeatPumpCoolingLoad = \,\frac{{ControlZoneCoolingLoad}}{{ControlZoneAirFlowFraction}}$$</div>

The heatpump’s sensible cooling load to be met and the full load cooling output are used to calculate the sensible the part-load ratio iteratively based on user specified convergence criterion.

<div>$$PartLoadRatio = MAX\left( {0.0,\,\frac{{ABS\left( {HeatPumpCoolingLoad - NoCoolOutput} \right)}}{{ABS\left( {FullCoolOutput - NoCoolOutput} \right)}}} \right)$$</div>

When the heat pumps sensible cooling capacity meets the system sensible cooling load at a given sensible part load ratio, then the Heat pump meets the controlled zone cooling setpoint temperature.  If a moisture (latent) load exists because the control zone humidity has exceeded the setpoint, the total moisture load to be met by the heat pumps (HeatPumpMoistureLoad) is calculated based on the control zone moisture load and the control zone air flow fraction.

<div>$$HeatPumpMoistureLoad = \,\frac{{ControlZoneMoitureLoad}}{{ControlZoneAirFlowFraction}}$$</div>

Then the *LatentPartLoadRatio* required to meet the high humidity setpoint is calculated as follows:

<div>$$LatentPartLoadRatio = MIN\left( {PL{R_{Min}},\,\frac{{ABS\left( {HeatPumpMoistureLoad - NoLatentOutput} \right)}}{{ABS\left( {FullLatentOutput - NoLatentOutput} \right)}}} \right)$$</div>

The model uses the greater of the two part-load ratios, *PartLoadRatio* or *LatentPartLoadRatio*, to determine the operating part-load ratio of the Heat Pump’s DX cooling coil.

<div>$$LatentPartLoadRatio = MAX\left( {PartLoadRatio,\,LatentPartLoadRatio} \right)$$</div>

As previously described, iterations are performed to converge on the solution within the convergence tolerance.

Where,

<span>$ControlZoneCoolingLoad$</span>= the control zone sensible cooling load to the cooling setpoint, (W).

<span>$ControlZoneMoistureLoad$</span>         = the control zone moisture load to the dehumidifying relative humidity setpoint, (W).

<span>$ControlZoneAirFlowFraction$</span>     = the supply air fraction that goes though the control zone, (-).

*FullLatentOutput*      =         the Heat Pump’s latent cooling energy rate at full-load conditions, W

*NoLatentOutput*       =          the Heat Pump’s latent cooling energy rate with cooling coil OFF, W

<span>$PartLoadRatio$</span>     =          the heat pump’s part-load-ratio required to meet system sensible load, (-).

<span>$LatentPartLoadRatio$</span>      =          the heat pump’s part-load-ratio required to meet system moisture load, (-).

<span>$PL{R_{MIN}}$</span>*       =  *the minimum part-load ratio, which is usually 0.0. For the case when the latent capacity degradation model is used (Ref: DX Cooling Coil Model), this value is the minimum part-load ratio at which the cooling coil will dehumidify the air.

When the predicted zone air temperature is above the heating setpoint and if there is a dehumidification load, the supplemental heating coil load is required to offset the excess cooling as shown in Figure 236. If the model determines that the LatentPartLoadRatio is to be used as the operating part-load ratio of the heatpump’s cooling coil, the supplemental coil is used to offset the excess sensible capacity provided by the unit. The model first checks the sensible load that exists for the current simulation time step (predicted zone temperature with no HVAC operation compared to the thermostat setpoint temperatures). If a sensible cooling load or no sensible cooling or heating load exists (see Figure 236),  the model calculates the difference between the sensible heating load required to reach or maintain the heating dry-bulb temperature setpoint and the actual sensible cooling energy rate delivered by the heat pump (with LatentPartLoadRatio). In this case, thesupplemental heating coil is used to offset the excess sensible cooling energy provided by the DX cooling coil (if any) that could have caused an overshoot of the heating dry-bulb temperature setpoint. Note that when a humidistat is used and high humidity control is required, the zone dry-bulb temperature will typically move toward the heating temperature setpoint when a high moisture (latent) load exists.



![HiHumidControl-2](EngineeringReference/media/image5262.png)

Figure 236. Supplemental heating coil load when predicted zone air temperature is above the heating Setpoint

If a heating load exists (Figure 237), the supplementalheating coil is used to meet the heating coil load and at the same time offset the entire sensible cooling energy rate of the DX cooling coil (to meet the humidistat setpoint). Note that when a heating load exists and high humidity control is required, the heat pump operates at the user-specified cooling air flow rate for the entire simulation time step. As with the fan, and DX cooling coil, report variables associated with supplemental heating coil performance (e.g., heating coil energy, heating coil rate, heating coil gas or electric energy, heating coil runtime fraction, etc.) are managed in the supplemental (heating) coil object.

![HiHumidControl-3](EngineeringReference/media/image5263.png)

Figure 237. Supplemental heating coil load when predicted zone air temperature is below the heating setpoint

#### Parameter Estimation Model

The steady state simulation model (Object: AirLoopHVAC:UnitaryHeatPump:WaterToAir) for a water-to-air vapor compression heat pump is described in this section. The model is implemented under the air-loop manager similar to the algorithm discussed under AirLoopHVAC:UnitaryHeatPump. The heat pump 'coil' objects (Coil:Cooling:WaterToAirHeatPump:ParameterEstimation and
 Coil:Heating:WaterToAirHeatPump:ParameterEstimation) actually consist of a steady state simulation of the unitary heat pump in cooling or heating mode respectively.  This documentation is derived from the Ph.D. dissertation of Hui Jin which is available on the Oklahoma State University web site .  The model parameters, solution technique and solution algorithm are all identical to that of the water to water heat pump.  The only difference between the two models is in the modeling of the water to air heat exchanger.

The effectiveness of this heat exchanger is given by

<div>$$\varepsilon  = 1 - {e^{ - NTU}}$$</div>

Where NTU is defined by

<div>$$NTU = \frac{{UA}}{{(\dot mC{}_p){}_{water/air}}}$$</div>

UA for the source side and the load side are two of the parameters estimated in the parameter estimation procedure.

Additional model details and a discussion of the parameters and parameter estimation technique are described in the following section on Water to Water Heat Pumps.

### Water To Water Heat Pumps

There are two water-water heat pump models available in EnergyPlus which are **parameter estimation based model** and **equation-fit model**. Detailed descriptions of the model are available in the references Tang and Jin

### Equation Fit Water To Water Heat Pump Model

This section describes the equation-fit model for water-to-water heat pump.   (Object names: HeatPump:WaterToWater:EquationFit:Cooling & HeatPump:WaterToWater:EquationFit:Heating). This documentation is derived from the M.S. dissertation of Tang (2005) which is available on the Oklahoma State University web site . The model uses four non-dimensional equations or curves to predict the heat pump performance in cooling and heating mode. The methodology involved using the generalized least square method to generate a set of performance coefficients from the catalog data at indicated reference conditions. Then the respective coefficients and indicated reference conditions are used in the model to simulate the heat pump performance. The variables that influenced the water-to-water heat pump performance are load side inlet water temperature, source side inlet temperature, source side water flow rate and load side water flow rate. The governing equations for the cooling and heating mode are as following:

Cooling Mode:

<div>$$\frac{{Q{}_c}}{{Q{}_{c,ref}}} = A1 + A2\left[ {\frac{{T{}_{L,in}}}{{T{}_{ref}}}} \right] + A3\left[ {\frac{{T{}_{S,in}}}{{T{}_{ref}}}} \right] + A4\left[ {\frac{{{{\dot V}_L}}}{{{{\dot V}_{L,ref}}}}} \right] + A5\left[ {\frac{{{{\dot V}_S}}}{{{{\dot V}_{S,ref}}}}} \right]$$</div>

<div>$$Powe{r_c} = \frac{{{Q_c}}}{{CO{P_c}}}$$</div>

Heating Mode:

<div>$$\frac{{{Q_h}}}{{Q{}_{h,ref}}} = C1 + C2\left[ {\frac{{T{}_{L,in}}}{{T{}_{ref}}}} \right] + C3\left[ {\frac{{T{}_{S,in}}}{{T{}_{ref}}}} \right] + C4\left[ {\frac{{{{\dot V}_L}}}{{{{\dot V}_{L,ref}}}}} \right] + C5\left[ {\frac{{{{\dot V}_S}}}{{{{\dot V}_{S,ref}}}}} \right]$$</div>

<div>$$Powe{r_h} = \frac{{{Q_h}}}{{CO{P_h}}}$$</div>

Assuming no losses, the source side heat transfer rate for cooling and heating mode is calculated as following;

<div>$${Q_{source,c}} = {Q_c} + Powe{r_c}$$</div>

<div>$${Q_{source,h}} = {Q_h} - Powe{r_h}$$</div>



Where:

<span>$A1 - B5$</span>     = Equation fit coefficients for the cooling and heating mode

<span>${T_{ref}}$</span>            = 283.15K

<span>${T_{L,in}}$</span>           = Entering load side water temperature, K

<span>${T_{S,in}}$</span>           = Entering source side water temperature, K

<span>${\dot V_L}$</span>                         = Load side volumetric flow rate, m<sup>3</sup>/s

<span>${\dot V_S}$</span>                         = Source side volumetric flow rate, m<sup>3</sup>/s

<span>${Q_c}$</span>                         = Load side heat transfer rate (cooling mode), W

<span>$Powe{r_c}$</span>     = Power consumption (cooling mode), W

<span>${Q_{source,c}}$</span>      = Source side heat transfer rate (cooling mode), W

<span>${Q_h}$</span>                         = Load side heat transfer rate (heating mode), W

<span>$Powe{r_h}$</span>     = Power consumption (heating mode), W

<span>${Q_{source,h}}$</span>      = Source side heat transfer rate (heating mode), W

*COP<sub>c</sub>*          = Cooling coefficient of performance, W/W

*COP<sub>h</sub>*          = Heating coefficient of performance, W/W



If the load side heat transfer rate (*Q<sub>c</sub>* or *Q<sub>h</sub>*) or power consumption (*Power<sub>c</sub>* or *Power<sub>h</sub>*) are less than or equal to zero, then the heat pump is turned off for that simulation time step, a warning is issued, and the simulation continues.

The inlet conditions or variables are divided by the reference conditions. This formulation allows the coefficients to fall into smaller range of values. Moreover, the value of the coefficient indirectly represents the sensitivity of the output to that particular inlet variable. The reference conditions used when generating the performance coefficients must be the same as the reference conditions used later in the model. The reference temperature <span>${T_{ref}}$</span>is fixed at 283K. Temperature unit of Kelvin is used instead of Celsius to keep the ratio of the water inlet temperature and reference temperature positive value should the water inlet temperature drop below the freezing point.

For cooling mode, the reference conditions; reference load side volumetric flow rate, <span>${\dot V_{L,ref}}$</span>, reference source side volumetric flow rate, <span>${\dot V_{S,ref}}$</span>, <span>$Powe{r_{c,ref}}$</span>  and reference source side heat transfer rate, <span>${Q_{source,c,ref}}$</span>  are the conditions when the heat pump is operating at the highest cooling capacity or reference cooling capacity, <span>${Q_{c,ref}}$</span> indicated in the manufacturer’s catalog. Note that the reference conditions for heating mode might differ from the reference conditions specified for the cooling mode.

#### Coefficient estimation procedure:

The generalized least square method is used to generate the coefficients. This method utilizes an optimization method which calculates for the coefficients that will give the least amount of differences between the model outputs and the catalog data. A set of coefficients for the cooling mode is generated which includes A1-A5 for load side heat transfer. The same procedure is repeated for the heating mode to generate the coefficients B1-B5. An information flow chart showing the inputs, reference conditions, performance coefficients and outputs are shown in the figure below:

![](EngineeringReference/media/image5290.png)

Figure 238.  Information Flow Chart for Water-To-Water Heat Pump Equation Fit (Tang 2005)

### Parameter Estimation Water-To-Water Heat Pump Model

A steady state simulation model for a water-to-water reciprocating vapor compression heat pump (Object names: HeatPump:WaterToWater:ParameterEstimation:Cooling & HeatPump:WaterToWater:ParameterEstimation:Heating) is described in this section. This documentation is derived from the Ph.D. dissertation of Hui Jin which is available on the Oklahoma State University web site . The model incorporates a multivariable unconstrained optimization algorithm to estimate several unspecific parameters. The aim of the model is to describe the detailed physical geometry and operation of each component and replicate the performance of the actual unit in operation. Assuming the thermodynamic process in the expansion device and the pressure drop at the suction and discharge valves to be isenthalpic the heat balance equation is given by

<div>$${\dot Q_s} = \dot W + {\dot Q_{_L}}$$</div>

Where:

<span>${\dot Q_s}$</span> = Source side heat transfer rate

<span>${\dot Q_L}$</span> = Load side heat transfer rate

<span>$\dot W$</span>= Compressor power input

The compressor model is based on an isentropic process shown in Figure 239 governed by

<span>$P{V^\gamma }$</span> = Constant

Where:

P = Pressure

v = Specific volume

![](EngineeringReference/media/image5296.png)

Figure 239.  Schematic indicator diagram for a reciprocating Compressor(Jin 2002)

Since the refrigerant vapor in the clearance volume as shown in the previous figure goes through a re-expansion procedure, the mass flow rate of the compressor refrigerant is a decreasing function of the pressure ratio.

<div>$$\mathop m\limits^ \bullet   = \frac{{PD}}{{\nu {}_{suc}}}(1 + C - C{(\frac{{P{}_{dis}}}{{P{}_{suc}}})^{\frac{1}{\gamma }}}$$</div>

Where:

<span>$\mathop m\limits^ \bullet  $</span>  = refrigerant mass flow rate

PD = Piston displacement

C   = Clearance factor

<span>$P{}_{dis}$</span> = discharge pressure

<span>$P{}_{suc}$</span> = Suction pressure

<span>$\gamma $</span>     = Isentropic exponent

#### Parameter estimation procedure:

A set of parameters for the cooling mode is defined on the basis of the equations used in the model. An information flowchart indicating the parameters, inputs to the model and the resulting outputs acquired are shown in Figure 240. The estimation of parameters is conducted using the catalog data.

The parameter definition include:

n Piston displacement, PD

n Clearance factor, C

n Pressure drop across the suction and discharge valves, <span>${\rm{\Delta P}}$</span>

n Loss factor used to define the electromechanical losses supposed to be proportional to the theoretical power, <span>${\rm{\eta }}$</span>

n Superheat in <sup>ο</sup>C or F, <span>${\rm{\Delta T}}{}_{{\rm{sh}}}$</span>

n Constant part of the electromechanical losses,<span>${\rm{W}}{}_{{\rm{loss}}}$</span>

n Source side heat transfer coefficient, (UA)<sub>S</sub>

n Load side heat transfer coefficient, (UA)<sub>L</sub>

![](EngineeringReference/media/image5306.png)

Figure 240.  Information Flowchart for Water-To-Water Heat Pump Parameter Estimation Mmodel implementation (Jin 2002)

Where:

TWiL   = Entering water Load side temperature

TWiS   = Entering water Source side temperature

<span>$\mathop {\rm{m}}\limits^ \bullet  {}_{{\rm{WiL}}}$</span>= Entering water Load side mass flow rate

<span>$\mathop {\rm{m}}\limits^ \bullet  {}_{{\rm{WiS}}}$</span>= Entering water Source side mass flow rate

S      =  Thermostatic Signal

The parameter estimation procedure incorporates an objective function that computes the difference between the model outputs and the catalog outputs.  The objective function is then minimized by using a multi variable unconstrained multi modal Nelder Mead optimization algorithm. As the objective function value lowers after each iteration, the model outputs approach the catalog outputs consequently leading to convergence and the correct parameters are estimated for the respective model. The inputs to the model include the entering water temperatures and mass flow rates on the load side and the source side. The calculation of the objective function is shown in the form of a formula flowchart in Figure 241. The square of the sum of the errors (SSQE) for a given set of parameter values that will be minimized is given by

<div>$$SSQE = \sum\limits_{i = 1} {{{\left( {\frac{{\left( {\mathop {W{}_{cat}}\limits^{} } \right) - \left( {\mathop W\limits^{} } \right){}_i}}{{\left( {\mathop {W{}_{cat}}\limits^{} } \right)}}} \right)}^2}}  + \left( {\frac{{\left( {\mathop {QL{}_{cat}}\limits^{} } \right) - \left( {\mathop {QL}\limits^{} } \right){}_i}}{{\left( {\mathop {QL{}_{cat}}\limits^{} } \right)}}} \right)$$</div>

Where

<span>${\rm{W}}{}_{{\rm{cat}}}$</span>= Catalog power consumption

<span>${\rm{W}}{}_{}$</span> = Model power consumption

<span>${\rm{QL}}{}_{{\rm{cat}}}$</span>= Catalog load side heat transfer

<span>${\rm{QL}}{}_{}$</span> = Model load side heat transfer

Extrapolation beyond the catalog data grants the parameter estimation model an upper hand in comparison with the equation fit and deterministic models. However, the detailed model is computationally more intensive. Moreover, when the model is implemented within a transient system simulation program, it may come across figures that are random and unplanned by the manufacturer such as low water flow rates or extreme temperatures. This oddity may result in unrealistic set of results.

![Jin's flow chart](EngineeringReference/media/image5314.png)

Figure 241.  Flow diagram of EnergyPlus Water to Water HeatPump implementation

#### Control Strategy:

Both water-to-water heat pump models; parameter estimation based model and curve-fit model use the “cycle time control logic” developed by Murugappan (2002).

This strategy keeps the heat pump from short-cycling whereby the heat pump will stay on or off for the specified cycle time after switching states. The control logic is identical to the operation of a physical heat pump whereby the heat pump does not switch between on and off instantly. Refer to Muraggapan (2002) for the further details on the control strategy.

#### References

Jin, Hui. 2002. Parameter Estimation Based Models of Water Source Heat Pumps. Phd. Thesis, Department of Mechanical and Aerospace Engineering, Oklahoma State University. (downloadable from [http://www.hvac.okstate.edu/](http://www.hvac.okstate.edu))

Tang,C. C. 2005. Modeling Packaged Heat Pumps in Quasi-Steady State Energy Simulation Program. M.S. Thesis. Department of Mechanical and Aerospace Engineering, Oklahoma State University. (downloadable from [http://www.hvac.okstate.edu/](http://www.hvac.okstate.edu))

Murugappan, Arun. 2002.  Implementing Ground Source Heat Pump and Ground Loop Heat Exchanger Models in the EnergyPlus Simulation Environment, M.S. Thesis, Department of Mechanical and Aerospace Engineering, Oklahoma State University (downloadable from [http://www.hvac.okstate.edu/](http://www.hvac.okstate.edu))

Variable Refrigerant Flow Heat Pumps <a name="VRF"></a>
------------------------------------

There are two common types of variable refrigerant flow heat pump systems:

n cooling only or heating only air-conditioning systems (a.k.a. heat pump), or

n heat recovery systems that allow simultaneous cooling and heating

Energyplus models heat pump and heat recovery operating modes as described in the section entitled Variable Refrigerant Flow Heat Pump Model. The variable refrigerant flow model currently supports air-, evaporatively-, or water-cooled condenser equipment. Throughout this section, the term “condenser” refers to the outdoor unit where the compressor is located.

### Variable Refrigerant Flow Heat Pump Model

#### Overview

The figure below schematically depicts the AirConditioner:VariableRefrigerantFlow (VRF AC) system. The outdoor unit is connected directly to the zone terminal units using a zone terminal unit list (ref: ZoneTerminalUnitList). The VRF AC system conditions multiple zones and is controlled by thermostats located in each zone. Zone terminal units operate to meet the zone sensible cooling or sensible heating requirements as determined by the zone thermostat schedule.

When the heat pump does not operate to reclaim waste heat, the VRF AC system can only operate in either cooling *or* heating mode. Based on the master thermostat priority control selection, the operating mode is determined by polling the appropriate zone(s) served by the VRF HP system. When the system is operating in cooling mode, the cooling coils will be enabled only in the terminal units where zone cooling is required. When the system is operating in heating mode, the heating coils will be enabled only in the terminal units where zone heating is required. Supply air fans will continue to operate if the zone terminal unit’s fan operating mode is set to continuous fan.

When the heat pump does operate to reclaim waste heat, the VRF AC system can simultaneously cool and heat multiple zones. The heat pump will select an operating mode according to the dominant load as reported by the zone thermostat(s). The calculation of the dominant load is based on the master thermostat priority control selection and may either be based on individual zone loads, the number of zones requiring cooling or heating, the master thermostat zone load, or an operating mode schedule. The heat pump will operate in cooling mode, and provide waste heat to zones with a heating load, when the dominant load among all zone terminal units is cooling. The heat pump will operate in heating mode, and absorb heat from zones with a cooling load, when the dominant load among all zone terminal units is heating.

The figure below shows the VRF AC terminal units with draw through fan placement. Blow through fan placement can also be modeled by connecting the supply air fan inlet node to the outside air mixer’s mixed air node if an outdoor air mixer is used or to the zone terminal unit inlet node if an outdoor air mixer is not used. The variable refrigerant flow heat pump coordinates the operation of these components and is modeled as a type of zone equipment where the *zone terminal units* are specified in a zone equipment list (Ref. ZoneHVAC: EquipmentList and ZoneHVAC:EquipmentConnections). The AirConditioner: VariableRefrigerantFlow object *is not* specified in an air primary loop or a zone equipment list object.

![](EngineeringReference/media/image5315.png)

Figure 242. Variable Refrigerant Flow Heat Pump (draw through fan placement)



![](EngineeringReference/media/image5316.png)

Figure 243. Variable Refrigerant Flow object connections in Energyplus

The terminal unit is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Fan:Simple:OnOff must be used to model AUTO fan, while Fan:Simple:OnOff or Fan:Simple:ConstVolume can be used to model fan ON.

Output variables reported by the VRF AC object include the heat pump’s operating capacity (cooling or heating), electric consumption, operating COP, defrost electric consumption, part-load ratio (ratio of actual capacity to available capacity), runtime fraction (when cycling), cycling ratio (actual compressor cycling rate), crankcase heater power, and other report variables associated with an evaporative condenser. Report variables are also available to indicate the maximum available terminal unit cooling or heating capacity (i.e., when the condensers available capacity is insufficient to supply the capacity requested by all terminal units). Reporting of other variables of interest for the VRF AC (fan electric power, DX coil cooling rate, DX coil heating rate, terminal unit total cooling rate, etc.) is done by the individual system components (e.g., fan, DX cooling coil, DX heating coil, and zone terminal unit). For convenience, the total cooling and heating coil capacities (i.e., the coil loads) is also reported.

#### Model Description

As described previously, the VRF AC system conditions multiple zones and is controlled by one or more zone thermostats (ZoneControl:Thermostatic). Each simulation time step, EnergyPlus performs a zone air heat balance to determine if cooling or heating is required to meet each zone’s thermostat set point. When heat pump mode is selected (i.e., heat recovery is not selected), an operating mode is chosen based on the master thermostat priority control and all terminal units are operated in that specific mode. When heat recovery mode is selected, the dominant load is determined based on the master thermostat priority control and the outdoor unit operates in this mode. The indoor terminal units operate in either cooling or heating mode based on the individual coil loads The heat pump condenser is then modeled to determine any impact the condensing unit might have on the zone terminal units (i.e., capacity limitations due to oversized terminal units, operating limitations due to allowable operating temperature range, impacts of defrost operation, changes in performance when heat recovery mode is active, etc.). The following sections describe the performance calculations for cooling and heating.

#### Cooling Operation

The operating capacity of the heat pump is calculated based on the user defined input for the heat pump’s rated cooling capacity, the ratio of indoor terminal unit capacity to outdoor unit capacity (combination ratio), the actual operating conditions, and whether or not the system’s heat recovery mode is active. Performance correction factors are used to correct for off-design performance as follows:

#### Cooling Combination Ratio Correction Factor

The cooling combination ratio correction factor is defined as the total terminal unit rated cooling capacity divided by the heat pump’s rated cooling capacity. The combination ratio is important when multiple terminal units (or DX coils) are attached to a single variable-speed condensing unit. If the combination ratio is less than 1, the condenser’s rated capacity is assumed to be able to meet the indoor terminal unit’s demand request. However, if the combination ratio is determined to be greater than 1, the maximum cooling capacity available from the heat pump’s condenser may be higher than the user specified rated cooling capacity. The combination ratio capacity correction factor is based on a linear, quadratic or cubic curve and provides a multiplier &gt; 1 to correct for combination ratio’s greater than 1. For example, a combination ratio of 1.3 (130%) may result in a combination ratio capacity correction factor of 1.06 (outdoor condenser can actually provide 106% of rated capacity) . The cooling combination ratio correction factor is applied to cooling performance calculations. If the cooling combination ratio correction curve name is not specified by the user, the cooling combination ratio correction factor (CR <sub>cooling,\\ correction</sub>) in the following equation is assumed to be equal to 1.

<div>$$C{R_{cooling\,,\,rated\,}} = {\raise0.7ex\hbox{${\sum\limits_1^n {{{\mathop Q\limits^ \bullet  }_{coil(i)\,,\,cooling,\,rated}}} }$} \!\mathord{\left/ {\vphantom {{\sum\limits_1^n {{{\mathop Q\limits^ \bullet  }_{coil(i)\,,\,cooling,\,rated}}} } {{{\mathop Q\limits^ \bullet  }_{cooling,\,total,\,\,rated}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cooling,\,total,\,\,rated}}}$}}$$</div>

<div>$$C{R_{\,cooling\,,\,correction}} = a + b\left( {C{R_{cooling\,,\,rated}}} \right) + c{\left( {C{R_{cooling\,,\,rated}}} \right)^2} + d{\left( {C{R_{cooling\,,\,rated}}} \right)^3}$$</div>

<div>$$C{R_{\,cooling\,,\,correction}} = MAX\left( {1.0\,\,,\,\,C{R_{\,cooling\,,\,correction}}} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{coil(i)\,,\,cooling\,,\,rated}}$</span> = rated total (sensible + latent) cooling capacity in zone *i* (W)

<span>${\mathop Q\limits^ \bullet_{cooling,\,total\,,\,rated}}$</span>   = rated total cooling capacity of heat pump (W)

<span>$C{R_{\,cooling\,,\,correction}}$</span> = Cooling Combination Ratio capacity correction factor at rated conditions (this value is reported in the eio file)

<span>$a - d$</span>                = equation coefficients for cooling combination ratio correction factor

<span>$C{R_{cooling\,,\,rated}}$</span>      = the cooling combination ratio defined as the total indoor terminal unit’s rated total cooling capacity divided by the rated total cooling capacity of the heat pump condenser.

The sum of the individual zone total cooling requirements is used to calculate the performance of the outdoor condensing unit. The operating capacities of the indoor cooling coils are calculated based on the indoor cooling coil’s rated cooling capacity and the actual operating conditions. The operating capacity of the heat pump condenser is calculated in a similar fashion using a load-weighted average indoor wet-bulb temperature of all operating cooling coils.

#### Cooling Capacity Ratio Modifier Function of Low Temperature

The heat pump’s cooling capacity correction factor (function of temperature) is determined by averaging the zone cooling coil inlet air wet-bulb temperature for all operating cooling coils. A load-weighted average inlet air wet-bulb temperature is used in the calculations. The weighted average cooling coil inlet air wet-bulb temperature and the outdoor condenser entering air dry-bulb temperature are then used to calculate the temperature correction factor in cooling mode for the heat pump condenser. The actual zone air wet-bulb temperature is used to calculate the operating capacity of the individual zone cooling coils.

<div>$${\mathop Q\limits^ \bullet_{zone,\,total}} = \sum\limits_1^i {{{\mathop Q\limits^ \bullet  }_{zone(i)}}} $$</div>

<div>$${T_{wb,avg}} = \sum\limits_1^i {\left( {{T_{wb,i}}} \right)} \left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{zone(i)}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{zone(i)}}} {{{\mathop Q\limits^ \bullet  }_{zone,\,total}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{zone,\,total}}}$}}} \right)$$</div>

The operating capacity of the heat pump is calculated using a bi-quadratic equation using a load-weighted average indoor wet-bulb temperature and outdoor dry-bulb temperature as the independent variables.

<div>$$CAPF{T_{HP,cooling}} = a + b\left( {{T_{wb,avg}}} \right) + c{\left( {{T_{wb,avg}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{wb,avg}}} \right)\left( {{T_c}} \right)$$</div>

The operating capacity of the terminal unit’s DX cooling coil is calculated using either a linear, quadratic, or cubic curve. If more information is available to more accurately model the DX cooling coil, a bi-quadratic curve may be used (i.e., if the performance of the DX cooling coil is also a function of outdoor dry-bulb temperature).

<div>$$CAPF{T_{coil,\,cooling}} = a + b\left( {{T_{wb,i}}} \right) + c{\left( {{T_{wb,i}}} \right)^2} + d{\left( {{T_{wb,i}}} \right)^3}$$</div>

 - or -

<div>$$CAPF{T_{coil,cooling}} = a + b\left( {{T_{wb,i}}} \right) + c{\left( {{T_{wb,i}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{wb,i}}} \right)\left( {{T_c}} \right)$$</div>

where

<span>${T_{wb,i}}$</span> = wet-bulb temperature of the air entering the cooling coil in zone *i* (°C)

<span>${T_{wb,avg}}$</span>= load-weighted average wet-bulb temperature of the air entering all operating cooling coils (°C)

<span>${\mathop Q\limits^ \bullet_{zone(i)}}$</span> = total (sensible + latent) cooling load in zone *i* (W)

<span>${\mathop Q\limits^ \bullet_{zone,\,total}}$</span> =total (sensible + latent) cooling load in all zones (W)

<span>$CAPF{T_{\,HP,cooling}}$</span> = heat pump Cooling Capacity Ratio Modifier (function of temperature)

<span>$CAPF{T_{\,coil,cooling}}$</span> = zone coil Cooling Capacity Ratio Modifier (function of temperature)

<span>$a - f$</span>  = equation coefficients for Cooling Capacity Ratio Modifier

<span>${T_c}$</span>    = temperature of the air entering an air-cooled or evaporatively-cooled condenser (°C)

#### Using multiple curves to define Cooling Capacity Ratio Modifier

The cooling capacity ratio modifier determines the change in total (sensible + latent) capacity with respect to the heat pump rated cooling capacity. This modifier corrects for off-design performance and provides the operating total (sensible + latent) cooling capacity for the heat pump condenser. The performance data for VRF AC systems may be specified using a single curve object, however, if the performance data does not reflect a smooth change in performance as outdoor conditions vary, the overall performance of the system may be described using two cooling capacity ratio modifier curves (i.e., a separate curve at low and high outdoor temperatures) and a boundary curve (i.e., the curve defining the separation at specific outdoor temperatures).

#### Application of Dual Performance Curves

Two additional inputs are available to more accurately model the cooling performance of a VRF AC system. The first additional input is a boundary curve which is used to distinguish differences in performance at “low” and “high” outdoor temperature regions and the second input is a cooling capacity performance curve for the “high” outdoor temperature region. The boundary curve is a linear, quadratic or cubic curve defining the outdoor temperature as a function of average indoor wet-bulb temperature. The cooling capacity ratio function of high temperature curve is a biquadratic curve using average indoor wet-bulb temperature and outdoor dry-bulb temperature as the two independent variables. These additional curves are used to define the performance over two separate performance regions as shown in Figure 244. The red circles in the figure identify the points at which the performance changes abruptly (i.e., slopes or shapes are significantly different) and are used to create the boundary curve. The performance on either side of the boundary curve can be a smooth curve changing with outdoor condition or a flat plateau where system controls maintain a constant operating condition. This type of performance cannot be accurately simulated using a single performance curve object. For this reason, dual capacity performance curves may be used.

Note: If the cooling performance can be described using a single performance curve object, the boundary and high temperature performance curve objects are not required.

Manufacturers may also provide this information in a tabular format. In this case the data should first be graphically displayed to identify any non-linearities and to also identify where an abrupt change in performance occurs so that a boundary curve can be created.

The cooling capacity ratio boundary curve object is used to differentiate between dual cooling capacity ratio performance curves. This curve defines the outdoor temperature below which the cooling capacity ratio function of low temperature curve object is used, otherwise, the cooling capacity ratio function of high temperature curve object is used.

<div>$${T_{OA,DB}} = a + b\left( {{T_{I,WB}}} \right) + c{\left( {{T_{I,WB}}} \right)^2} + d{\left( {{T_{I,WB}}} \right)^3}$$</div>

where

T<sub>OA,DB</sub> = Outside air dry-bulb temperature (C)

a-d = coefficients for cooling capacity ratio boundary curve object

T<sub>I,WB</sub> = Weighted average indoor wet-bulb temperature (C)

For the performance data shown below, the boundary curve would be created by identifying the outdoor dry-bulb temperature at which the performance changed abruptly for each of the indoor wet-bulb temperature curves shown in the figure. The following example shows the data interpreted from the figure used to regress the cooling capacity ratio boundary curve coefficients. For this example, the regression coefficients were found to be: A1 = 29.87396, B1 = -0.6928, C1= 0.01928, D1 = -0.000532

Table 73. Performance Data for Variable Refrigerant Flow Air Conditioner Model

![](EngineeringReference/media/image5339.svg.png)

Although the capacity and energy performance curves each have an independent boundary curve input, in this example the same boundary curve may be used for both the capacity and energy input ratio curves. When the “low” and “high” predicted performance data do not line up at the boundary curve points, the boundary curve may have to be modified slightly to allow a smooth transition in performance from the “low” to “high” temperature region. In this case, the boundary curves for capacity and energy may be different.

![](EngineeringReference/media/image5340.png)

Figure 244. Non-Linear Performance of VRF Heat Pump in Cooling Mode

A regression is then performed on the data to the left of the boundary curve to calculate the low temperature cooling performance curve coefficients. A regression is also performed on the data to the right of the boundary curve to create the high temperature cooling performance curve coefficients. The model then uses the boundary curve to determine which performance curve (low or high) to use during the simulation. For example, given a particular average indoor wet-bulb temperature, if the boundary curve object calculates an outdoor dry-bulb temperature that is above the actual outdoor dry-bulb temperature then the cooling capacity ratio function of low temperature performance curve is used to determine AC system performance for that specific simulation time step. When creating the boundary curve, be careful to make sure the low and high performance curves meet, as closely as possible, at the boundary curve points (i.e., that discontinuities do not exist or are minimized to the extent possible). Tabular data (ref: Table:TwoIndependentVariables) may also be used to specify performance and will usually eliminate the need for dual performance curves.

#### Determining Cooling Coil Sensible Capacity

The zone terminal unit’s cooling coil is controlled by a zone thermostat and must meet a zone “sensible” load. The cooling coil’s sensible capacity is defined as the cooling coil’s total capacity multiplied by the coil’s sensible heat ratio (SHR) at the current operation conditions. Since the SHR of the variable refrigerant flow cooling coil changes as the inlet air wet-bulb temperature and the operating part-load ratio change, an iterative solution technique must be used to determine the coil’s sensible capacity. The target solution is found when the sensible capacity of the zone cooling coil equals the zone sensible cooling load (if sufficient capacity is available). The iterative solution converges when the difference (error) between the zone sensible cooling load and the terminal unit sensible cooling capacity is within tolerance (0.001) or the terminal unit has insufficient capacity to meet the zone sensible cooling load. Refer to the description of the VRF cooling coil model for further details (ref: Variable Refrigerant Flow Cooling Coil).

<div>$${\mathop Q\limits^ \bullet_{coil(i)\,,\,cooling\,,\,total}} = {\mathop Q\limits^ \bullet_{coil(i)\,,\,cooling\,,\,rated}}\left( {CAPF{T_{coil,cooling}}} \right)$$</div>

<div>$$PL{R_i} = 1$$</div>

<div>$$\begin{array}{l}Iteration\,\,Loop(PL{R_i}) -  -  -  -  -  -  -  -  -  -  -  -  -  - \\\,\,\,\,SH{R_{PLR}} = f\left( {{T_{wb,\,i}},\,PL{R_i},\,{{\mathop m\limits^ \bullet  }_i}} \right)\\\,\,\,\,{\mathop Q\limits^ \bullet_{coil(i),\,cooling,\,sensible}} = {\mathop Q\limits^ \bullet_{coil(i),\,cooling,\,total}}\left( {SH{R_{PLR}}} \right)\left( {PL{R_i}} \right)\\\,\,\,\,Error = \left( {{{\mathop Q\limits^ \bullet  }_{zone(i)}} - {{\mathop Q\limits^ \bullet  }_{coil(i),\,cooling,\,sensible}}} \right)/{\mathop Q\limits^ \bullet_{zone(i)}}\\End\,Iteration\,Loop -  -  -  -  -  -  -  -  -  -  -  -  -  -  -  - \end{array}$$</div>

where

<span>${\mathop Q\limits^ \bullet_{coil(i)\,,\,cooling\,,\,total}}$</span>= zone terminal unit total (sensible + latent) cooling capacity, [W], report variable “Zone VRF Air Terminal Total Cooling Rate”

<span>${\mathop Q\limits^ \bullet_{coil(i),\,cooling,\,sensible}}$</span>= zone terminal unit sensible cooling capacity [W], report variable “Zone VRF Air Terminal Sensible Cooling Rate”

<span>$PL{R_i}$</span>= cooling coil sensible part-load ratio in zone *i*

<span>$SH{R_{PLR}}$</span> = cooling coil sensible heat ratio (function of PLR, inlet air wet-bulb temperature, and cooling coil inlet air mass flow rate)

<span>${\mathop m\limits^ \bullet_{_i}}$</span> = cooling coil inlet air mass flow rate [m<sup>3</sup>/s]

The terminal unit total cooling (sensible + latent) capacity is then summed to provide the total terminal unit cooling requirement. The cooling coils capacity includes the impacts of fan heat and any outdoor air provided to the zone.

<div>$${\mathop Q\limits^ \bullet_{cooling,TerminalUnits}} = \sum\limits_1^i {\left( {{{\mathop Q\limits^ \bullet  }_{coil(i),cooling,total}}} \right)\left( {PLR(i)} \right)} $$</div>

where

<span>${\mathop Q\limits^ \bullet_{cooling,\,TerminalUnits\,}}$</span>= total terminal unit cooling requirement (sensible + latent) in all zones, [W]

The piping correction factor is then used to adjust the total zone cooling requirement to account for piping losses in the air conditioner’s refrigeration piping system.

#### Cooling Piping Correction Factor in cooling mode

The cooling piping correction factor is calculated using either one or two independent variables. Both the equivalent piping length and the combination ratio are used together to determine piping losses, or the equivalent piping length itself is used. The vertical height specified by the user is also added to the result calculated by either. If a single independent variable is used, a linear, quadratic, or cubic equation is used to determine the equivalent length correction factor. If two independent variables are used, a biquadratic equation is used to determine the equivalent length correction factor. The program will automatically use the correct equation based on the performance curve type. In either case, a single coefficient adjusts the piping correction factor based on the difference in height from the highest to lowest terminal unit. Coefficients a-d (e) in the following equation(s) are inputs in the piping correction factor for length in cooling mode performance curve object. Coefficient f is a direct input to the VRF model as the piping correction factor for height in cooling mode coefficient. The equivalent piping length in cooling mode (P<sub>EQ,cooling</sub>) is also a direct input in the VRF model. The cooling combination ratio (CR<sub>cooling</sub>) is automatically calculated by the program. The vertical height, the difference between the highest and lowest terminal unit (e.g., 12 m higher than condenser – 3 m lower than condenser = 9 m height), is a common input for both cooling and heating. When all terminal units are above or below the outdoor unit, an average positive or negative value is used. The limits on the calculated cooling piping correction factor are 0.5 &lt; P<sub>correction,cooling</sub> &lt; 1.

<div>$$C{R_{cooling}} = {\raise0.7ex\hbox{${\sum\limits_1^n {{{\mathop Q\limits^ \bullet  }_{coil(i),cooling,rated}}} }$} \!\mathord{\left/ {\vphantom {{\sum\limits_1^n {{{\mathop Q\limits^ \bullet  }_{coil(i),cooling,rated}}} } {{{\mathop Q\limits^ \bullet  }_{cooling,total,rated}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cooling,total,rated}}}$}}$$</div>

<div>$${P_{correction,\,cooling}} = a + b\left( {{P_{EQ,\,cooling}}} \right) + c{\left( {{P_{EQ,\,cooling}}} \right)^2} + d{\left( {{P_{EQ,\,cooling}}} \right)^3} + f\left( {{P_H}} \right)$$</div>

- or  -

<div>$$\begin{array}{l}{P_{correction,\,cooling}} = a + b\left( {{P_{EQ,\,cooling}}} \right) + c{\left( {{P_{EQ,\,cooling}}} \right)^2} + d\left( {C{R_{cooling}}} \right) + e{\left( {C{R_{cooling}}} \right)^2}\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + f\left( {{P_{EQ,\,cooling}}} \right)\left( {C{R_{cooling}}} \right) + g\left( {{P_H}} \right)\end{array}$$</div>

where

<span>${P_{\,correction,\,cooling}}$</span> = Piping Correction Factor in Cooling Mode

*a - f*       = equation coefficients for piping correction factor in cooling mode

*g*              = user specified piping correction factor for height in cooling mode coefficient

<span>${P_{\,EQ,\,cooling}}$</span> = user specified equivalent piping length in cooling mode [m]

<span>$C{R_{cooling}}$</span> = combination ratio in cooling mode (total rated indoor terminal unit capacity divided by the rated condenser cooling capacity) (reported to eio file)

<span>${P_H}$</span>           = user specified vertical height used for piping correction factor calculation [m]

An example piping correction factor chart is shown in the following figure. The height selected for use in the equation above is selected to minimize the piping correction factor and serves to identify the worst case piping losses.

![PipingFactorCorrectionChart](EngineeringReference/media/image5358.png)

Figure 245. Typical Piping Factor Correction Chart

The total demand on the heat pump condenser is then calculated as the quotient of the total terminal unit cooling capacity and the cooling piping correction factor. The piping losses are fixed throughout the simulation (i.e., these losses are not based on which terminal units are requesting refrigerant).

<div>$${\mathop Q\limits^ \bullet_{cooling,\,total\,}} = {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cooling,\,TerminalUnits\,}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{cooling,\,TerminalUnits\,}}} {{P_{correction\,,\,cooling}}}}}\right.}\!\lower0.7ex\hbox{${{P_{correction\,,\,cooling}}}$}}$$</div>

The heat pump’s total available cooling capacity is then calculated as:

<div>$${\mathop Q\limits^ \bullet_{HP,\,cooling,\,\,total}} = {\mathop Q\limits^ \bullet_{cooling,\,\,total,\,\,rated}}\left( {CAPF{T_{HP,\,\,cooling}}} \right)\left( {C{R_{cooling,\,\,correction}}} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{cooling\,,\,total}}$</span> = total heat pump condenser cooling load (W)

<span>${\mathop Q\limits^ \bullet_{HP,\,cooling,\,\,total}}$</span> = heat pump total available cooling capacity (W)

#### Heat Recovery Cooling Capacity Modifier

When operating in heat recovery mode, the heat pump’s available cooling capacity is typically different than the available capacity when operating in cooling only mode. This modifier is used to adjust the available cooling capacity using a fraction when heat recovery is active. This fraction is based on a bi-quadratic equation with indoor and outdoor temperatures used as the independent terms.

*HRCapMod* *<sub>HP,cooling</sub>* = <span>$a + b\left( {T{}_{ent}} \right) + c{\left( {T{}_{ent}} \right)^2} + d\left( {{T_{cond}}} \right) + e{\left( {{T_{cond}}} \right)^2} + f\left( {T{}_{ent}} \right)\left( {{T_{cond}}} \right)$</span>

This equation can be used to provide a constant fractional difference for available cooling capacity in heat recovery mode (i.e., only *a* is non-zero) or a fractional term that varies with indoor and outdoor conditions. With very limited performance data available at this time, it is recommended that only the constant (a) term be used at this time. When the VRF system is not operating in heat recovery mode, this fraction is set to 1.The available cooling capacity in heat recovery mode is then:

<div>$${\mathop Q\limits^ \bullet_{HR,cooling,\,total}} = {\mathop Q\limits^ \bullet_{HP,\,cooling,\,\,total}}\left( {HRCapMo{d_{HP,\,cooling}}} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{HR,cooling,\,total}}$</span> = heat recovery total available cooling capacity (W)

The figure below shows VRF system laboratory data for cooling only mode (solid characters) and heat recovery mode (dotted characters). Using the limited laboratory data, the available cooling capacity fraction used to model heat recovery mode is approximately 0.91 and the cooling energy fraction is approximately 1.14. This is the only data available at this time to estimate the impact of heat recovery mode on performance. In the bi-quadratic equation, only coefficient a should be used until more complete data sets exist. Laboratory testing will eventually provide more data and better estimates of performance in heat recovery mode.

![](EngineeringReference/media/image5366.png)

Figure 246.  Comparison of cooling only and heat recovery mode operation

#### Transition from Cooling Only mode to Heat Recovery mode

When the VRF system transitions from cooling only operation to heat recovery operation, this transition takes some finite amount of time. During the transition period the available cooling capacity can change significantly, The following figure illustrates the transition between cooling only mode and heat recovery mode. For this test, the VRF system was turned on and allowed to reach steady-state operation. Three of the four indoor terminal units were operating in cooling mode, When the fourth terminal unit was enabled in heating mode, the transition from cooling only mode to heat recovery mode took approximately 45 minutes. During this time, the available cooling is significantly reduced and recovers over time. When the system again reaches steady-state operation, the available cooling capacity and power consumption are markedly different. Although computer models do not typically simulate this type of transitional performance, efforts to model this aspect of performance were included in the VRF AC heat recovery model. The initial heat recovery cooling capacity fraction and heat recovery cooling capacity time constant are used to model this transition period. The initial heat recovery cooling capacity fraction identifies the fraction of available heat recovery mode cooling capacity at the start of the transition period, the heat recovery cooling capacity time constant identifies the time needed to recover to 99% of the steady-state value. This exponential model used for simulating the transition period can be turned off by setting the initial heat recovery cooling capacity fraction to 1.





![](EngineeringReference/media/image5367.png)

Figure 247.  Laboratory test identifies performance changes during transition period

#### Heat Recovery Cooling Capacity Fraction and Time Constant

When the heat pump changes operating modes (i.e., from cooling only to heat recovery mode), the transition does not happen immediately. There is a time delay, and a period of time where the available cooling capacity is well below the steady-state capacity available after the system has had time to adjust. When this type of transition is modeled, an exponential decay curve is used. At the start of the transition period, only a fraction (*k<sub>cool</sub>*) of the steady-state capacity in heat recovery mode is available. The remaining capacity is recovered over a period of 5 time constants (t<sub>c</sub>) and is modeled with the following equation. This equation was used to replicate both the cooling capacity and condenser power curves in the previous figure.

<div>$${\mathop Q\limits^ \bullet_{HR,avail,\,cooling}} = {k_{cool}}\left( {{{\mathop Q\limits^ \bullet  }_{HR,cooling,\,total}}} \right) + \left( {1 - {k_{cool}}} \right)\left( {{{\mathop Q\limits^ \bullet  }_{HR,cooling,\,total}}} \right)\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{\tau_c}}}}\right.}\!\lower0.7ex\hbox{${{\tau_c}}$}}} \right)}}} \right)$$</div>

where:

*k<sub>cool</sub>* = fraction of steady-state capacity at beginning of heat recovery mode

*t<sub>c</sub>* = time constant to reach steady-state operation, 5 time constants equals 99% of steady-state capacity (hr)

*Q<sub>HR,avail,cooling</sub>* = available cooling capacity in heat recovery mode (W)

*<span>$\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{t_{c,cool}}}}}\right.}\!\lower0.7ex\hbox{${{t_{c,cool}}}$}}} \right)}}} \right)$</span>*= The multiplier used during the transition period from cooling mode to heat recovery mode. This multiplier can be viewed using the report variable “VRF Heat Pump Heat Recovery Status Change Multiplier” (ref: object Output:Variable).



The operating part-load ratio of the VRF system can then be calculated:

<div>$$PLR = {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cooling,\,total}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{cooling,\,total}}} {{{\mathop Q\limits^ \bullet  }_{HR,\,avail,\,cooling}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{HR,\,avail,\,cooling}}}$}}$$</div>

<span>$PLR$</span>         = heat pump part-load ratio, report variable “VRF Heat Pump Part Load Ratio”

Note: for calculation purposes <span>${\mathop Q\limits^ \bullet_{HR,\,avail,\,cooling}}$</span> is equivalent to <span>${\mathop Q\limits^ \bullet_{HR,\,cooling,\,total}}$</span> when heat recovery mode is not active.

The heat pump total available cooling capacity must be greater than or equal to the total cooling capacity requested by the zone terminal units. When the total operating capacity of all terminal unit’s will be greater than the available operating capacity of the heat pump condenser, one or more of the terminal unit’s operating capacity must be reduced to the point where the sum of the indoor terminal unit demand request plus piping losses is equal to the total available cooling capacity of the outdoor condenser. At this point, the part-load ratio of the heat pump condenser will be equal to 1.

A maximum terminal unit cooling capacity limit is used to restrict the cooling capacity of each indoor terminal unit. The capacity limit is equivalent to a maximum allowed operating capacity for all zone terminal units. This limit is used to conserve energy between multiple indoor terminal units and a single outdoor condensing unit. Assuming no terminal unit can provide more capacity than can be delivered by the outdoor condenser, the terminal unit total cooling capacity calculation previously discussed is revised as follows:

<div>$${\mathop Q\limits^ \bullet_{coil(i),\,\,cooling}} = \sum\limits_1^i {MIN\left( {\left( {{{\mathop Q\limits^ \bullet  }_{coil(i),cooling,total}}} \right)\left( {PLR(i)} \right),\,\,CoolingCapacityLimit} \right)} $$</div>

where:

<span>$CoolingCapacityLimit(C{L_{cooling}})$</span>= Report variable (ref: Output:Variable) describing the “VRF Heat Pump Maximum Capacity Cooling Rate”, W

When multiple terminal units are operating, the terminal units near their maximum capacity are more likely to be capacity limited than those terminal units operating well below their available capacity. The assumption here is that terminal units that are not capacity limited can provide more refrigerant to meet the same load. When the model finds that there is no terminal unit capacity limit, this variable will report 1E+20 indicating that no limit exists.  The figure below demonstrates the application of the capacity limit factor for the case where all indoor terminal units are operating at different capacities. A solution is reached when the sum of the indoor terminal unit’s cooling capacities (accounting for piping losses) is equal to the heat pump condenser’s available cooling capacity.

![](EngineeringReference/media/image5376.png)

Figure 248. Example of Cooling Capacity Limit

When the heat pump’s part-load ratio is less than 1 (i.e., the total capacity of all terminal unit’s is less than the actual operating capacity of the heat pump condenser), the heat pump’s part-load ratio is compared to the minimum heat pump part-load ratio. If the heat pump’s part-load ratio is less than the minimum heat pump part-load ratio, the heat pump will cycle on and off to meet the cooling load. A correction factor is used to account for startup losses of the compression system.

***Cooling Part-Load Fraction Correlation (function of cycling ratio)***

The cooling part-load fraction correlation (function of heat pump cycling ratio) is a linear, quadratic or cubic curve with the independent variable being cycling ratio (part-load ratio / minimum part-load ratio). The output of this curve is used in combination with the rated EIR and EIR modifier curves to give the “effective” EIR for a given simulation time step.

<div>$$CyclingRatioFrac = a + b\left( {CyclingRatio} \right) + c{\left( {CyclingRatio} \right)^2} + d{\left( {CyclingRatio} \right)^3}$$</div>

where

<div>$$CyclingRatio = {\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PL{R_{min}}}}}\right.}\!\lower0.7ex\hbox{${PL{R_{min}}}$}}$$</div>

a-c (d) = coefficients for the quadratic (cubic) cycling ratio correlation curve equation

The cycling ratio can be viewed using the report variable “VRF Heat Pump Cycling Ratio” (ref: Output:Variable).

The cooling part-load ratio correlation should be normalized to a value of 1.0 when the cycling ratio equals 1.0 (i.e., no efficiency losses when the heat pump runs continuously [PLR ≥ PLR<sub>min</sub>] for the simulation time step). For cycling ratio values between 0 and 1 (0 &lt;= CyclingRatio &lt; 1), the following rules apply:

      CyclingRatioFrac &gt;= 0.7   and   CyclingRatioFrac &gt;= CyclingRatio

If CyclingRatioFrac &lt; 0.7 a warning message is issued, the program resets the CyclingRatioFrac value to 0.7, and the simulation proceeds. The runtime fraction of the heat pump is defined as CyclingRatio/CyclingRatioFrac. If CyclingRatioFrac &lt; CyclingRatio, the runtime fraction will exceed 1. In this case a warning message is issued and the runtime fraction of the heat pump is limited to 1.0.

<div>$$Heat\,Pump\,Runtime\,Fraction\,(HPRTF) = {\raise0.7ex\hbox{${CyclingRatio}$} \!\mathord{\left/ {\vphantom {{CyclingRatio} {CyclingRatioFrac}}}\right.}\!\lower0.7ex\hbox{${CyclingRatioFrac}$}}$$</div>

The heat pump runtime fraction can be viewed using the report variable “VRF Heat Pump Runtime Fraction” (ref: Output:Variable).

Since manufacturers data do not typically provide information defining the cycling losses of VRF AC systems, a typical part-load fraction correlation for a conventional DX refrigeration system (e.g., residential or small commercial unit) may be substituted here as:

      CyclingRatioFrac = 0.85 + 0.15(CyclingRatio)

The electrical power consumed by the heat pump condenser is then calculated based on the heat pump’s rated electric power consumption (including condenser fan power), the actual operating conditions, and the cycling ratio of the refrigeration system. Performance correction factors are used here to correct for off-design performance as follows:

#### Cooling Energy Input Ratio Modifier Function of Low Temperature

As described previously (Ref. Application of Dual Performance Curves), the cooling energy input ratio modifier curve can either be applied as a single curve object as shown below, or applied using dual performance curve objects. The equation form used for a single or dual performance curve application is shown here.

<div>$$EIRF{T_{\,cooling}} = a + b\left( {{T_{wb,avg}}} \right) + c{\left( {{T_{wb,avg}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{wb,avg}}} \right)\left( {{T_c}} \right)$$</div>

where

<span>$EIRF{T_{\,cooling}}$</span> = cooling energy input ratio modifier (function of temperature)

#### Cooling Energy Input Ratio Modifier Function of Part-Load Ratio

The cooling energy input ratio calculation is based on 2 EIR curves. One is used when the heat pump part-load ratio is less than or equal to 1, and a second curve is used to describe the variation of cooling energy input ratio when the part-load ratio is greater than 1. The part-load ratio curve when PLR&gt;1 is not a required input and when not used, the energy use is assumed to be constant when PLR &gt; 1.

<div>$$\begin{array}{l}IF\left( {PLR \le 1} \right)THEN\\\,\,\,\,EIRFPL{R_{cooling}} = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2} + d{\left( {PLR} \right)^3}\\ELSE\\\,\,\,\,EIRFPL{R_{cooling}} = e + f\left( {PLR} \right) + g{\left( {PLR} \right)^2} + h{\left( {PLR} \right)^3}\end{array}$$</div>

where

<span>$EIRFPL{R_{cooling}}$</span> = cooling energy input ratio correction factor (function of part-load ratio)

a-d = coefficient for cooling energy input ratio correlation when part-load ratio ≤ 1

e-h = coefficient for cooling energy input ratio correlation when part-load ratio &gt; 1

The total power consumed by the heat pump condenser in cooling mode is based on the user specified coefficient of performance (COP) and calculated as:

<div>$$CoolingPower = \left( {\frac{{{{\mathop Q\limits^ \bullet  }_{cooling,total,rated}}CAPF{T_{cooling}}}}{{CO{P_{cooling,\,\,reference}}}}} \right)\left( {EIRF{T_{cooling}}} \right)\left( {EIRFPL{R_{cooling}}} \right)\left( {HPRTF} \right)$$</div>

The cooling COP is then calculated as the ratio of the outdoor unit cooling capacity divided by the total electric consumption rate of all components associated with the outdoor unit. Although included in the equiation, defrost power is typically 0 during cooling mode operation.

<div>$$CO{P_{cooling}} = {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{cooling,total}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{cooling,total}}} {\left( {CoolingPower + {P_{CrankaseHeater}} + {P_{EvapCoolerPower}} + {P_{defrost}}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {CoolingPower + {P_{CrankaseHeater}} + {P_{EvapCoolerPower}} + {P_{defrost}}} \right)}$}}$$</div>

COP<sub>cooling</sub>        = operating coefficient of performance, report variable “VRF Heat Pump Cooling COP”

CoolingPower = operating electric consumption rate, [W], report variable “VRF Heat Pump Cooling Electric Power”

P<sub>CrankcaseHeater</sub> = report variable for electric consumption rate of crankcase heater (W)

P<sub>EvapCoolerPump</sub> = report variable for electric consumption rate of evaporatively-cooled condenser water pump (W)

<span>${P_{defrost}}$</span>         = report variable for average defrost power for the simulation time step (W)

When operating in heat recovery mode, equations similar to those used for available cooling capacity are used to model heating electric consumption rate.

*HREIRMod* *<sub>HP,cooling</sub>* = <span>$a + b\left( {{T_{ent}}} \right) + c{\left( {{T_{ent}}} \right)^2} + d\left( {{T_{cond}}} \right) + e{\left( {{T_{cond}}} \right)^2} + f\left( {{T_{ent}}} \right)\left( {{T_{cond}}} \right)$</span>

This equation can be used to provide a constant fractional difference for cooling electric consumption rate in heat recovery mode (i.e., only *a* is non-zero) or a fractional term that varies with indoor and outdoor conditions. With very limited performance data available at this time, it is recommended that only the constant (a) term be used at this time. When the VRF system is not operating in heat recovery mode, this fraction is set to 1. The cooling electric consumption rate in heat recovery mode is then:



<div>$$CoolingPowe{r_{HR}} = CoolingPower\left( {HREIRMo{d_{HP,\,cooling}}} \right)$$</div>

<span>$Powe{r_{HR}} = {k_{EIR,\,cool}}\left( {CoolingPowe{r_{HR}}} \right) + \left( {1 - {k_{EIR,\,cool}}} \right)\left( {CoolingPowe{r_{HR}}} \right)\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{\tau_{c,\,EIR,\,cool}}}}}\right.}\!\lower0.7ex\hbox{${{\tau_{c,\,EIR,\,cool}}}$}}} \right)}}} \right)$</span>where:

*k<sub>EIR,\\ copl</sub>* = fraction of steady-state cooling electric consumption rate at beginning of heat recovery mode

*t<sub>c,EIR,\\ cool</sub>* = time constant to reach steady-state operation, 5 time constants equals 99% of steady-state capacity (hr)

*CoolingPower<sub>HR</sub>* = cooling electric consumption rate in heat recovery mode (W)

*<span>$\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{\tau_{c,\,EIR,\,cool}}}}}\right.}\!\lower0.7ex\hbox{${{\tau_{c,\,cool}}}$}}} \right)}}} \right)$</span>*= The multiplier used during the transition period from cooling mode to heat recovery mode. This multiplier can be viewed using the report variable “VRF Heat Pump Heat Recovery Status Change Multiplier” (ref: Output:Variable).

#### Heating Operation

Calculations of the heat pump’s heating performance is nearly identical to the calculations described above for cooling operation.

The sum of the individual zone total heating requirements are used to calculate the performance of the outdoor condensing unit. The operating capacity of the indoor heating coils are calculated based on the indoor heating coil’s nominal heating capacity and the actual operating conditions. A capacity correction factor is used to correct for off-design performance as follows:

***Heating Combination Ratio Correction Factor (function of capacity ratio)***

The heating combination ratio correction factor is defined as the total terminal unit rated heating capacity divided by the heat pump’s rated heating capacity. In some instances, the cooling combination ratio may be used to define the correction factor used to modify the heat pump’s rated heating capacity and is manufacturer specific. The combination ratio is important when multiple terminal units (or DX coils) are attached to a single variable-speed condensing unit. If the combination ratio is less than 1, the condenser has sufficient capacity to meet the indoor terminal unit’s capacity request. However, if the combination ratio is determined to be greater than 1, the maximum heating capacity available from the heat pump’s condenser may be higher than the user specified rated heating capacity. The combination ratio capacity correction factor is based on a linear, quadratic or cubic curve and provides a multiplier &gt; 1 to correct for combination ratio’s greater than 1. For example, a combination ratio of 1.3 (130%) may result in a combination ratio capacity correction factor of 1.06 (outdoor condenser can actually provide 106% of rated capacity) . The heating combination ratio correction factor is applied to heating performance calculations. If the heating combination ratio correction curve name is not specified by the user, the heating combination ratio correction factor (CR <sub>heating,\\ correction</sub>) in the following equation is assumed to be equal to 1.

<div>$$C{R_{heating}} = {\raise0.7ex\hbox{${\sum\limits_1^n {{{\mathop Q\limits^ \bullet  }_{coil(i),heating,rated}}} }$} \!\mathord{\left/ {\vphantom {{\sum\limits_1^n {{{\mathop Q\limits^ \bullet  }_{coil(i),heating,rated}}} } {{{\mathop Q\limits^ \bullet  }_{heating,total,rated}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{heating,total,rated}}}$}}$$</div>

<div>$$C{R_{heating,correction}} = a + b\left( {C{R_{heating}}} \right) + c{\left( {C{R_{heating}}} \right)^2} + d{\left( {C{R_{heating}}} \right)^3}$$</div>

<div>$$C{R_{\,heating\,,\,\,correction}} = MAX\left( {1.0\,\,,\,\,C{R_{\,heating\,,\,\,correction}}} \right)$$</div>

where

<span>${\mathop Q\limits^ \bullet_{coil(i)\,,\,heating\,,\,rated}}$</span> = rated total heating capacity in zone *i* (W)

<span>${\mathop Q\limits^ \bullet_{heating,\,total\,,\,rated}}$</span> = rated total heating capacity of heat pump (W)

<span>$C{R_{\,heating\,,\,\,correction}}$</span> = Heating Combination Ratio capacity correction factor at rated conditions

<span>$a - d$</span>        = cubic equation coefficients for heating combination ratio correction factor

<span>$C{R_{heating}}$</span> = combination ratio in heating mode (total rated indoor terminal unit capacity divided by the rated condenser heating capacity) (reported to eio file)

#### Heating Capacity Ratio Modifier (function of temperature)

As described previously (Ref. Application of Dual Performance Curves), the heating capacity ratio modifier curve can either be applied as a single curve object as shown below, or applied using dual performance curve objects. The single curve object application is described here.

The heat pump’s heating capacity ratio modifier (function of temperature) is determined by averaging the zone heating coil inlet air dry-bulb temperature for all operating heating coils. A zone load-weighted average is used when calculating the performance of the heat pump condenser. This weighted-average heating coil inlet air dry-bulb temperature and the outdoor condenser entering air wet-bulb temperature are then used to calculate the heat pump’s temperature correction factor in heating mode.

Note that some manufacturers do not provide performance data as a function of outdoor wet-bulb temperature. In this case, substituting outdoor dry-bulb temperature is permitted and the Heating Performance Curve Outdoor Temperature Type input should be specified as DryBulbTemperature. This also means that performance curve coefficients for both capacity (CAPFT) and energy (EIRFT) should be calculated using indoor and outdoor dry-bulb temperature.

<div>$${T_{db,avg}} = \sum\limits_1^i {\left( {{T_{db,i}}} \right)} \left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{zone(i)}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{zone(i)}}} {{{\mathop Q\limits^ \bullet  }_{zone,\,total}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{zone,\,total}}}$}}} \right)$$</div>

<div>$$CAPF{T_{HP,heating}} = a + b\left( {{T_{db,avg}}} \right) + c{\left( {{T_{db,avg}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{db,avg}}} \right)\left( {{T_c}} \right)$$</div>

<div>$$CAPF{T_{coil,heating}} = a + b\left( {{T_{db,i}}} \right) + c{\left( {{T_{db,i}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{db,i}}} \right)\left( {{T_c}} \right)$$</div>

where

<span>${T_{db,i}}$</span>= dry-bulb temperature of the air entering the heating coil in zone *i*, °C

<span>${T_{db,avg}}$</span>= weighted-average dry-bulb temperature of the air entering all operating heating coils, °C

<span>$CAPF{T_{\,heating}}$</span> = Heating Capacity Correction Factor (function of temperature)

<span>$a - f$</span>  = bi-quadratic equation coefficients

<span>${T_c}$</span>    = wet-bulb temperature of the air entering an air-cooled condenser, °C

The total terminal unit heating capacity required is the simple sum of the terminal unit capacity. If the heat pump is off or there is no zone heating requirement, the terminal unit total heating requirement will be zero. The heating coils capacity includes the impacts of fan heat and any outdoor air provided to the zone.

<div>$${\mathop Q\limits^ \bullet_{heating,TerminalUnits}} = \sum\limits_1^i {\left( {{{\mathop Q\limits^ \bullet  }_{coil(i),\,heating,total}}} \right)\left( {PLR(i)} \right)} $$</div>

where

<span>${\mathop Q\limits^ \bullet_{heating\,,\,TerminalUnits\,}}$</span>= heat pump’s outdoor condenser total zone heating requirement (W)

<span>${\mathop Q\limits^ \bullet_{coil(i),\,heating,\,total}}$</span>= zone terminal unit total heating capacity [W], report variable “Zone VRF Air Terminal Total Heating Rate”

The piping correction factor is then used to adjust the zone heating requirement to account for piping losses in the AC refrigeration system.

#### Piping Correction Factor in heating mode

The piping correction factor in heating mode is calculated based on the length of the farthest terminal unit and the difference in height from the highest to lowest terminal unit. The piping losses are fixed throughout the simulation (i.e., these losses are not based on which terminal units are requesting refrigerant). Coefficients a-f in the following equations are inputs in the piping correction factor for length in heating mode curve object. The curve may use either one or two independent variables. Coefficient g is a direct input to the VRF model as piping correction factor for height in heating mode coefficient. The equivalent piping length in heating mode (P<sub>EQ,heating</sub>) is also a direct input in the VRF model. The vertical height (P<sub>H</sub>), the difference between the highest and lowest terminal unit (e.g., 12 m higher than condenser – 3 m lower than condenser = 9 m height), is a common input for both cooling and heating.

<div>$${P_{correction,\,heating}} = a + b\left( {{P_{EQ,\,heating}}} \right) + c{\left( {{P_{EQ,\,heating}}} \right)^2} + d{\left( {{P_{EQ,\,heating}}} \right)^3} + g\left( {{P_H}} \right)$$</div>

- or -

<div>$$\begin{array}{l}{P_{correction,\,heating}} = a + b\left( {{P_{EQ,\,heating}}} \right) + c{\left( {{P_{EQ,\,heating}}} \right)^2} + d\left( {C{R_{heating}}} \right) + e{\left( {C{R_{heating}}} \right)^2}\\\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\,\, + f\left( {{P_{EQ,\,heating}}} \right)\left( {C{R_{heating}}} \right) + g\left( {{P_H}} \right)\end{array}$$</div>

where

<span>${P_{correction,\,heating}}$</span> = Piping Correction Factor in Heating Mode

*a-f* = equation coefficients for piping correction factor in heating mode

*g  * = user specified piping correction factor for height in heating mode coefficient

<span>${P_{EQ,\,heating}}$</span>= the equivalent piping length for heating specified by the user [m]

<span>${P_H}$</span>          = user specified vertical height used for piping correction factor [m]

The heat pump’s total available heating capacity is then determined using the previously described modifiers.

<div>$${\dot Q_{HP,cooling,total}} = {\dot Q_{cooling,total,rated}}\left( {CAPF{T_{HP,cooling}}} \right)\left( {C{R_{cooling,correction}}} \right)$$</div>

#### Heat Recovery Heating Capacity Modifier

When operating in heat recovery mode, the heat pump’s available heating capacity is typically different than the available capacity when operating in heating only mode. This modifier is used to adjust the available heating capacity using a fraction when heat recovery is active. This fraction is based on a bi-quadratic equation with indoor and outdoor temperatures used as the independent terms.

*HRCapMod* *<sub>HP,heating</sub>* = <span>$a + b\left( {{T_{ent}}} \right) + c{\left( {{T_{ent}}} \right)^2} + d\left( {{T_{cond}}} \right) + e{\left( {{T_{cond}}} \right)^2} + f\left( {{T_{ent}}} \right)\left( {{T_{cond}}} \right)$</span>

This equation can be used to provide a constant fractional difference for available heating capacity in heat recovery mode (i.e., only *a* is non-zero) or a fractional term that varies with indoor and outdoor conditions. With very limited performance data available at this time, it is recommended that only the constant (a) term be used at this time. The available heating capacity in heat recovery mode is then:

<div>$${\mathop Q\limits^ \bullet_{HR,heating,\,total}} = {\mathop Q\limits^ \bullet_{HP,\,heating,\,\,total}}\left( {HRCapMo{d_{HP,\,heating}}} \right)$$</div>

#### Transition from Heating Only mode to Heat Recovery mode

When the VRF system transitions from heating only operation to heat recovery operation, this transition takes some finite amount of time. During the transition period the available heating capacity can change significantly, As described for the transition from cooling only operating to heat recovery mode, the initial heat recovery heating capacity fraction and heat recovery heating capacity time constant are used to model the transition from heating only mode to heat recovery mode. The initial heat recovery heating capacity fraction identifies the fraction of available heat recovery mode heating capacity at the start of the transition period, the heat recovery heating capacity time constant identifies the time needed to recover to 99% of the steady-state value. This exponential model used for modeling the transition period can be turned off by setting the initial heat recovery heating capacity fraction to 1.0.

#### Heat Recovery Heating Capacity Fraction and Time Constant

When the heat pump changes operating modes (i.e., from heating only to heat recovery mode), the transition does not happen immediately. There is a time delay, and a period of time where the available heating capacity is different from the steady-state capacity available after the system has had time to adjust. When this type of transition is modeled, an exponential decay curve is used. At the start of the transition period, only a fraction (*k<sub>heat</sub>*) of the steady-state capacity in heat recovery mode is available. The remaining capacity is recovered over a period of 5 time constants (t<sub>c,\\ heat</sub>) and is modeled with the following equation. This equation was used to replicate both the cooling capacity and condenser power curves in the previous figure.

<div>$${\mathop Q\limits^ \bullet_{HR,\,avail,\,heating}} = {k_{heat}}\left( {{{\mathop Q\limits^ \bullet  }_{HR,\,heating,\,\,total}}} \right) + \left( {1 - {k_{heat}}} \right)\left( {{{\mathop Q\limits^ \bullet  }_{HR,\,heating,\,\,total}}} \right)\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{\tau_{c,\,heat}}}}}\right.}\!\lower0.7ex\hbox{${{\tau_{c,\,heat}}}$}}} \right)}}} \right)$$</div>

where:

*k<sub>heat</sub>*= fraction of steady-state heating capacity at beginning of heat recovery mode

*t<sub>c,\\ heat</sub>* = time constant to reach steady-state operation, 5 time constants equals 99% of steady-state capacity (hr)

*Q<sub>HR,avail,heating</sub>* = available heating capacity in heat recovery mode (W)

*<span>$\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{t_{c,heat}}}}}\right.}\!\lower0.7ex\hbox{${{t_{c,heat}}}$}}} \right)}}} \right)$</span>*= The multiplier used during the transition period from heating mode to heat recovery mode. This multiplier can be viewed using the report variable “VRF Heat Pump Heat Recovery Status Change Multiplier” (ref: Output:Variable).

#### Defrost Energy Input Ratio Modifier (function of temperature)

The defrost energy input ratio (EIR) modifier curve (function of temperature) is a bi-quadratic curve with two independent variables: heating coil average entering air wet-bulb temperature and outdoor air dry-bulb temperature. The output of this curve is multiplied by the heating coil capacity, the fractional defrost time period and the runtime fraction of the heating coil to give the defrost power at the specific temperatures at which the coil is operating. The use of outdoor wet-bulb temperature is explicit in this curve object and the defrost equation below and is independent of the selection for Heating Performance Curve Outdoor Temperature Type.

<div>$$DefrostEIRTempModFac = a + b\left( {{T_{wb,avg}}} \right) + c{\left( {{T_{wb,avg}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{wb,avg}}} \right)\left( {{T_c}} \right)$$</div>

The heat pump condenser’s total heating load is then calculated as the quotient of the total terminal unit capacity and the piping correction factor. Additional load due to defrost is also included (see following section).

<div>$${\mathop Q\limits^ \bullet_{heating,\,total}} = \left( {{\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{heating,\,TerminalUnits}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{heating,\,TerminalUnits}}} {{P_{correction,\,heating}}}}}\right.}\!\lower0.7ex\hbox{${{P_{correction,\,heating}}}$}}} \right) + {\mathop Q\limits^ \bullet_{defrost}}$$</div>

The heat pump’s total (gross) heating capacity is then calculated based on the capacity correction factor as a function of temperatures. The impact of defrost on total heat pump heating capacity is also accounted for (see following section). The part-load ratio of the heat pump condenser can then be calculated.

<div>$${\mathop Q\limits^ \bullet_{HP\,,\,total}} = {\mathop Q\limits^ \bullet_{total,\,\,rated}}\left( {CAPF{T_{\,HP,\,heating}}} \right)\left( {C{R_{heating,\,\,correction}}} \right)\left( {HCA{P_{defrost}}} \right)$$</div>

<div>$$PLR = {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{heating,\,total\,}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{heating,\,total\,}}} {{{\mathop Q\limits^ \bullet  }_{HP\,,\,total}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{HP\,,\,total}}}$}}$$</div>

where

<span>${\mathop Q\limits^ \bullet_{HP\,,\,total}}$</span> = heat pump total available heating capacity (W)

<span>$PLR$</span>     = heat pump part-load ratio

<span>$HCA{P_{defrost}}$</span>= heating capacity correction factor for defrost mode

As described for cooling operation, the available heating capacity of the heat pump is compared to the requested heating capacity of all indoor terminal units. If the requested heating capacity of all indoor terminal units is greater than the available heating capacity of the heat pump, one or more of the indoor terminal unit’s capacity is limited such that the sum of the zone terminal unit heating demand plus piping losses is equal to the available heat pump heating capacity (including the impact due to defrost).

The electrical power consumed by the heat pump condenser is calculated based on the heat pump’s nominal electric power consumption in heating mode and the actual operating conditions. A performance correction factor is used to correct for off-design performance as follows:

Heating Part-Load Fraction Correlation (function of heat pump cycling ratio)

The part-load fraction correlation (function of heat pump cycling ratio) is a linear, quadratic or a cubic curve with the independent variable being cycling ratio (part-load ratio / minimum part-load ratio). The output of this curve is used in combination with the rated EIR and EIR modifier curves to give the “effective” EIR for a given simulation time step. The cycling ratio correlation accounts for startup losses of the heat pump’s compression system.

<div>$$CyclingRatioFrac = a + b\left( {CyclingRatio} \right) + c{\left( {CyclingRatio} \right)^2}$$</div>

or

<div>$$CyclingRatioFrac = a + b\left( {CyclingRatio} \right) + c{\left( {CyclingRatio} \right)^2} + d{\left( {CyclingRatio} \right)^3}$$</div>

where

<div>$$CyclingRatio = {\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PL{R_{\min }}}}}\right.}\!\lower0.7ex\hbox{${PL{R_{\min }}}$}}$$</div>

The cycling ratio can be viewed using the report variable “VRF Heat Pump Cycling Ratio” (ref: Output:Variable).

The cycling ratio correlation should be normalized to a value of 1.0 when the cycling ratio equals 1.0 (i.e., no efficiency losses when the compressor(s) run continuously for the simulation time step). For cycling ratio values between 0 and 1 (0 &lt;= CyclingRatio &lt; 1), the following rules apply:

      CyclingRatioFrac &gt;= 0.7   and   CyclingRatioFrac &gt;= CyclingRatio

If CyclingRatioFrac &lt; 0.7 a warning message is issued, the program resets the CyclingRatioFrac value to 0.7, and the simulation proceeds. The runtime fraction of the heat pump is defined as CyclingRatio/CyclingRatioFrac. If CyclingRatioFrac &lt; CyclingRatio, then a warning message is issued and the runtime fraction of the heat pump is limited to 1.0.

<div>$$Heat\,Pump\,Runtime\,Fraction\left( {HPRTF} \right) = {\raise0.7ex\hbox{${CyclingRatio}$} \!\mathord{\left/ {\vphantom {{CyclingRatio} {CyclingRatioFrac}}}\right.}\!\lower0.7ex\hbox{${CyclingRatioFrac}$}}$$</div>

The heat pump runtime fraction can be viewed using the report variable “VRF Heat Pump Runtime Fraction” (ref: Output:Variable).

Since manufacturers data do not typically provide information defining the cycling losses of VRF AC systems, a typical part-load fraction correlation for a conventional DX refrigeration system (e.g., residential or small commercial unit) may be substituted here as:

      CyclingRatioFrac = 0.85 + 0.15(CyclingRatio)

Heating Energy Input Ratio Modifier (function of temperature)

As described previously (Ref. Application of Dual Performance Curves), the heating energy input ratio modifier curve can either be applied as a single curve object as shown below, or applied using dual performance curve objects. The single curve object application is discussed here.

<div>$$EIRF{T_{\,heating}} = a + b\left( {{T_{db,avg}}} \right) + c{\left( {{T_{db,avg}}} \right)^2} + d\left( {{T_c}} \right) + e{\left( {{T_c}} \right)^2} + f\left( {{T_{db,avg}}} \right)\left( {{T_c}} \right)$$</div>

where

<span>$EIRF{T_{\,heating}}$</span> = heating energy input ratio correction factor (function of temperature) (0-1)

Heating Energy Input Ratio Modifier (function of part-load ratio)

<div>$$\begin{array}{l}IF\left( {PLR \le 1} \right)THEN\\\,\,\,\,EIRFPL{R_{heating}} = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2} + d{\left( {PLR} \right)^3}\\ELSE\\\,\,\,\,EIRFPL{R_{heating}} = e + f\left( {PLR} \right) + g{\left( {PLR} \right)^2} + h{\left( {PLR} \right)^3}\end{array}$$</div>

where

<span>$EIRFPL{R_{heating}}$</span> = heating energy input ratio modifier (function of part-load ratio)

a-d = coefficient for heating energy input ratio modifier when part-load ratio ≤ 1

e-h = coefficient for heating energy input ratio modifier when part-load ratio &gt; 1

The total power consumed by the heat pump condenser in heating mode is then calculated. A correction for power consumed due to defrost is also included (see following section).

The total power consumed by the heat pump condenser in heating mode is based on the user specified coefficient of performance (COP). A correction for power consumed due to defrost is also included (see following section).

<div>$$HeatingPower = \left( {\frac{{{{\mathop Q\limits^ \bullet  }_{heating,\,total,rated}}CAPF{T_{heating}}}}{{CO{P_{heating,reference}}}}} \right)\left( {EIRF{T_{heating}}} \right)\left( {EIRFPL{R_{heating}}} \right)\left( {HPRTF} \right)\left( {EI{R_{defrost}}} \right)$$</div>

The operating COP is then calculated as:

The heating COP is then calculated as the ratio of the outdoor unit heating capacity divided by the total electric consumption rate of all components associated with the outdoor unit. Evaporatively-cooled condenser pump power is typically 0 during heating mode operation.<span>$CO{P_{heating}} = {\raise0.7ex\hbox{${{{\mathop Q\limits^ \bullet  }_{heating,total}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop Q\limits^ \bullet  }_{heating,total}}} {\left( {HeatingPower + {P_{CrankaseHeater}} + {P_{EvapCoolerPower}} + {P_{defrost}}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {HeatingPower + {P_{CrankaseHeater}} + {P_{EvapCoolerPower}} + {P_{defrost}}} \right)}$}}$</span>

COP<sub>heating</sub>        = operating coefficient of performance, report variable “VRF Heat Pump Heating COP”

HeatingPower = operating electric consumption rate, [W], report variable “VRF Heat Pump Heating Electric Power”

When operating in heat recovery mode, equations similar to those used for available heating capacity are used to model operating power.

*HREIRMod* *<sub>HP,heating</sub>* = <span>$a + b\left( {{T_{ent}}} \right) + c{\left( {{T_{ent}}} \right)^2} + d\left( {{T_{cond}}} \right) + e{\left( {{T_{cond}}} \right)^2} + f\left( {{T_{ent}}} \right)\left( {{T_{cond}}} \right)$</span>

This equation can be used to provide a constant fractional difference for heating electric consumption rate in heat recovery mode (i.e., only *a* is non-zero) or a fractional term that varies with indoor and outdoor conditions. With very limited performance data available at this time, it is recommended that only the constant (a) term be used at this time. When the VRF system is not operating in heat recovery mode, this fraction is set to 1.The available heating electric consumption rate in heat recovery mode is then calculated as:

<div>$$HeatingPowe{r_{HR}} = HeatingPower\left( {HREIRMo{d_{HP,\,heating}}} \right)$$</div>

<div>$$Powe{r_{HR}} = {k_{EIR,\,heat}}\left( {HeatingPowe{r_{HR}}} \right) + \left( {1 - {k_{EIR,\,heat}}} \right)\left( {HeatingPowe{r_{HR}}} \right)\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{\tau_{c,\,EIR,\,heat}}}}}\right.}\!\lower0.7ex\hbox{${{\tau_{c,\,EIR,\,heat}}}$}}} \right)}}} \right)$$</div>

where:

*k<sub>EIR,\\ heat</sub>* = fraction of steady-state heating electric consumption rate at beginning of heat recovery mode

*t<sub>c,EIR,\\ heat</sub>* = time constant to reach steady-state operation, 5 time constants equals 99% of steady-state capacity (hr)

*HeatingPower<sub>HR</sub>* = heating electric consumption rate in heat recovery mode (W)

*<span>$\left( {1 - {e^{\left( {{\raise0.7ex\hbox{${ - t}$} \!\mathord{\left/ {\vphantom {{ - t} {{\tau_{c,\,EIR,\,heat}}}}}\right.}\!\lower0.7ex\hbox{${{\tau_{c,\,EIR,\,heat}}}$}}} \right)}}} \right)$</span>*= The multiplier used during the transition period from heating mode to heat recovery mode. This multiplier can be viewed using the report variable “VRF Heat Pump Heat Recovery Status Change Multiplier” (ref: Output:Variable).

#### Operating Coefficient of Performance

Similar to the cooling and heating COP report variables, a report variable is included to identify the overall COP of the system. The numerator represents the total cooling and heating coil capacities (or loads) where piping losses have been accounted for. If heat recovery is not used only one of these terms is non-zero. When heat recovery is used, one or both of these terms can be non-zero, therefore, the operating COP includes recovered energy. The denominator includes the electric consumption rates of all system components. For water-cooled VRF AC systems, the plant pump power is not included.

<div>$$CO{P_{operating}} = \frac{{\left( {{{\mathop Q\limits^ \bullet  }_{cooling,TerminalUnits}} + {{\mathop Q\limits^ \bullet  }_{heating,TerminalUnits}}} \right)}}{{\left( {OutdoorUnitPower + {P_{CrankaseHeater}} + {P_{EvapCoolerPower}} + {P_{defrost}} + {P_{TU,fan}} + {P_{TU,parasitic}}} \right)}}$$</div>

where:

OutdoorUnitPower = Cooling or heating electric consumption rate of outdoor unit (W)

P<sub>TU,fan</sub> = electric consumption rate of all terminal unit fans (W)

P<sub>TU,parasitic</sub> = electric consumption rate of all terminal unit parasitic electric (W)



#### Defrost Adjustment Factors

Frost formation on the outdoor coil, and the need to periodically defrost this coil, has a significant impact on heating capacity and energy use by the DX heating system. This model uses a timed reverse-cycle defrost model. If the outdoor air dry-bulb temperature is below the specified maximum temperature for defrost operation, then the model calculates adjustment factors for heating capacity and input power due to frost formation This method of accounting for the impacts of frosting/defrost was taken from the model used in DOE-2.1E (ESTSC 2001, Miller and Jaster 1985).

The model first estimates the outdoor coil temperature according to a linear empirical relationship with outdoor air dry-bulb temperature as the independent variable.

<div>$${T_{coil,out}} = 0.82{T_{db,o}} - 8.589$$</div>

The difference between the outdoor air humidity ratio (from the weather file) and the saturated air humidity ratio at the estimated outdoor coil temperature is then calculated, and this value is used as an indication of frost formation on the outdoor coil.

<div>$$\Delta {\omega_{coil,out}} = MAX\left[ {1.0E - 6,{\omega_{outdoor}} - {\omega_{sat}}\left( {{T_{coil,out}},OutBaroPress} \right)} \right]$$</div>

Frost formation on the outdoor coil must be periodically removed. The fraction of compressor runtime when the coil is being defrosted is entered by the user. Adjustment factors to total heating coil capacity and input power due to frost formation on the outdoor coil are calculated by an empirical model with <span>$\Delta {\omega_{coil,out}}$</span> as the independent variable as shown below.

<div>$$HCA{P_{defrost}} = 0.909 - 107.33\left( {\Delta {w_{coil\,,\,out}}} \right)$$</div>

<div>$$EI{R_{defrost}} = 0.9 - 36.45\left( {\Delta {w_{coil\,,\,out}}} \right)$$</div>

If the outdoor air dry-bulb temperature is above the specified maximum temperature for defrost operation, the fractional defrost time period is set to zero and the heating capacity/input power multipliers are set to unity (1).

#### Defrost Operation

If the fractional defrost time period is greater than zero for the simulation time step, then the model calculates the electrical power used during defrost. The additional heating load due to defrost (indoor cooling during defrost) is also calculated so that it may be added to the existing heating load when calculating input power for the compressor(s) and outdoor coil fan(s).

<div>$${Q_{defrost}} = 0.01\left( {{t_{frac,defrost}}} \right)\left( {7.222 - {T_{db,o}}} \right)\left( {\frac{{{Q_{total,rated}}}}{{1.01667}}} \right)$$</div>

<div>$${P_{defrost}} = DefrostEIRTempModFac\left( {\frac{{{Q_{total,rated}}}}{{1.01667}}} \right)\left( {{t_{frac,defrost}}} \right)\left( {RTF} \right)$$</div>

where:

<span>${Q_{defrost}}$</span>        = additional indoor heating load due to reverse-cycle defrost (*W*)

<span>${{Q_{total,rated}}}$</span>= total full-load heating capacity of the coil at rated conditions (W)

<span>${P_{defrost}}$</span>         = report variable for average defrost power for the simulation time step (W)

*DefrostEIRTempModFac* = energy input ratio modifier curve applicable during defrost

<span>${t_{frac\,,\,defrost}}$</span>= defrost time period fraction specified by user

<div>$$RTF = \left( {{\raise0.7ex\hbox{${PLR}$} \!\mathord{\left/ {\vphantom {{PLR} {PartLoadFrac}}}\right.}\!\lower0.7ex\hbox{${PartLoadFrac}$}}} \right) = runtime\;fraction\;of\;the\;heating\;coil$$</div>

### Zone Terminal Unit List

The zone terminal unit list identifies the terminal units that are connected to a single variable refrigerant flow heat pump. The zone terminal unit list is used exclusively in the variable refrigerant flow (VRF) heat pump object (ref: AirConditioner:VariableRefrigerantFlow) and VRF zone terminal units (ref: ZoneHVAC: TerminalUnit:VariableRefrigerantFlow). Up to 20 terminal units may be connected to a single VRF outdoor condensing unit. This list is extensible if additional indoor terminal units are required. The following figure shows the connection scheme between the zone terminal units, the zone terminal unit list, and finally the VRF AC system. The zone terminal units are connected to the zone through zone inlet and outlet zone nodes. Each zone terminal unit is entered in a list which represents all terminal units connected to a single VRF AC system. And finally, the zone terminal unit list name is entered in the corresponding VRF AC object.

![](EngineeringReference/media/image5454.png)

Figure 249. Zone Terminal List connections in EnergyPlus objects

Heat Exchangers <a name="HX"></a>
---------------

### Air System Air-To-Air Sensible and Latent Effectiveness Heat Exchanger

#### Overview

The input object HeatExchanger:AirToAir:SensibleAndLatent provides a model for a generic, sensible and latent air-to-air heat exchanger that is an HVAC air system component that consists of a heat exchanger and primary/secondary airflow bypass dampers. The specific configuration of the component is shown in the following figure.

![](EngineeringReference/media/image5455.png)



Figure 250. Schematic of the Sensible and Latent Air-to-Air Heat Exchanger

The sensible and latent air-to-air heat exchanger is typically used for exhaust or relief air heat recovery. Heat exchanger performance can be specified to transfer sensible energy, latent energy or both between the supply and exhaust air streams. The input requires no geometric data. Performance is defined by specifying sensible and/or latent effectiveness at 75% and 100% of the nominal (rated) supply air flow rate in both heating and cooling conditions (Table 74).

Table 74.  Operating Conditions for Defining Heat Exchanger Performance

Parameter

Conditions

Heating

Cooling

Entering supply air temperature:

     Dry-bulb

     Wet-bulb



1.7°C (35°F)

0.6°C (33°F)



35°C (95°F)

26°C (78°F)

Entering exhaust air temperature:

     Dry-bulb

     Wet-bulb



21°C (70°F)

14°C (58°F)



24°C (75°F)

17°C (63°F)

Note: Conditions consistent with the Air-Conditioning and Refrigeration Institute’s Standard 1060 (ARI 2001).

Heat exchange between the supply and exhaust air streams occurs whenever the unit is scheduled to be available (availability schedule) and supply/exhaust air flows are present. This heat exchanger object can be used in conjunction with a conventional air-side economizer (i.e., specify an appropriate economizer control type in the Controller:OutdoorAir object), whereby heat exchange is suspended whenever the air-side economizer is active (i.e., air flow is fully bypassed around a fixed-plate heat exchanger or the rotation of a rotary heat exchanger is stopped). This object is also able to suspend heat exchange for the purpose of providing free cooling operation in the absence of a conventional air-side economizer (i.e., specify MinimumFlowWithBypass in the Controller:Outside Air object). Suspension of heat exchange during economizer mode may be customized as necessary using the economizer lockout field. Note that the Economizer Type must be set to something other than NoEconomizer for this control interaction to function.

Several methods of frost control are available to warm the heat exchanger core to prevent frost formation. Available methods are preheat, exhaust only, exhaust air recirculation, and minimum exhaust temperature. Preheat frost control uses a separate heater object placed in the supply inlet air stream to keep the air temperature above the frost threshold temperature. All other frost control methods are modeled within this heat exchanger object.

This heat exchanger object can also control the supply air outlet temperature to a setpoint when a setpoint manager and temperature schedule are used. This temperature control is accomplished through wheel speed modulation or bypassing supply air around the heat exchanger to maintain the desired setpoint and avoid overheating the supply air.

#### Model Description

The heat exchanger object models energy transfer between the supply air stream and the exhaust air stream according to the effectiveness values that are specified by the user in the input data file (see IO Reference Document, HeatExchanger:AirToAir:SensibleAndLatent). The operating volumetric air flow rate through the heat exchanger (i.e., the average of the actual supply and exhaust air flow rates for the simulation time step) should be between 50% and 130% of the nominal supply air flow rate specified for the heat exchanger. Operating air flow rates outside this range result in a warning message and a recommendation to adjust air flow rates to within the appropriate range.

The user must enter the sensible and latent effectiveness of the heat exchanger for heating and cooling conditions (Table 74) with balanced air flow (supply flow equal to the exhaust flow) at two flow rates: 75% and 100% of the nominal supply air flow rate. Heat exchanger manufacturers can typically provide this performance information, and it is also available for equipment contained in ARI’s Certified Product Directory for Air-to-Air Energy Recovery Ventilation Equipment (ARI 2003). Values may be entered for sensible effectiveness, latent effectiveness, or both. The model assumes default values of 0.0 for sensible and latent effectiveness, thus requiring the user to input representative values for the heat exchanger being modeled.

To obtain the “operating” effectiveness of the heat exchanger at different air flow rates, the model first calculates the average volumetric air flow rate through the heat exchanger (average of the supply and exhaust air flow rates) for each simulation time step. Air flows through the heat exchanger may be unbalanced (supply greater than exhaust, or vice versa), but an unbalanced air flow ratio greater than 2:1 is not recommended  (beyond this range a warning message is issued). The model determines the operating effectiveness of the heat exchanger by linear interpolation or extrapolation of the 100% flow and 75% flow effectiveness values specified in the input data file, using the average volumetric air flow rate through the heat exchanger. Extrapolation is allowed down to 50% and up to 130% of the nominal supply air flow rate (beyond this range a warning message is issued).

<span>${\varepsilon_{operating,sensible}} = {\varepsilon_{sensible,75\% \,flow}} + ({\varepsilon_{sensible,100\% \,flow}} - {\varepsilon_{sensible,75\% \,flow}})\left( {\frac{{H{X_{flowratio}} - 0.75}}{{1 - 0.75}}} \right)$</span>  

<div>$${\varepsilon_{operating,latent}} = {\varepsilon_{latent,75\% \,flow}} + ({\varepsilon_{latent,100\% \,flow}} - {\varepsilon_{latent,75\% \,flow}})\left( {\frac{{H{X_{flowratio}} - 0.75}}{{1 - 0.75}}} \right)$$</div>

*where*:

<span>${\varepsilon_{operating,sensible}}$</span> = operating sensible effectiveness of the heat exchanger

<span>${\varepsilon_{operating,latent}}$</span>    = operating latent effectiveness of the heat exchanger

<span>${\varepsilon_{sensible,75\% \,flow}}$</span>  =  sensible effectiveness at 75% airflow condition

<span>${\varepsilon_{sensible,100\% \,flow}}$</span> =  sensible effectiveness at 100% airflow condition

<span>${\varepsilon_{latent,75\% \,flow}}$</span>  =  latent effectiveness at 75% airflow condition

<span>${\varepsilon_{latent,100\% \,flow}}$</span> =  latent effectiveness at 100% airflow condition

<span>$H{X_{flowratio}}$</span> = the ratio of the average operating volumetric air flow rate [(supply flow plus exhaust flow) / 2.0] to the nominal supply air flow rate

If the heat exchanger’s supply air inlet temperature is less than the exhaust air inlet temperature, the operating sensible and latent effectivenesses are calculated using the 75% and 100% heating condition values; otherwise, the 75% and 100% cooling effectiveness values are used in Equations and .

The supply air conditions leaving the heat exchanger are determined using the heat exchanger operating effectiveness calculated above, the ratio of the air stream with the minimum heat capacity rate to the supply air stream heat capacity rate, and the difference in temperature or humidity ratio between the supply and exhaust inlet air:

<div>$$\mathop m\limits^ \bullet  cp,\min \, = MIN(\mathop m\limits^ \bullet  cp,\sup \,,\,\mathop {\,m}\limits^ \bullet  cp,exh)$$</div>

<div>$${T_{SupAirOut}} = {T_{SupAirIn}} + {\varepsilon_{operating,sensible}}\left( {\frac{{\mathop m\limits^ \bullet  cp,\min }}{{\mathop m\limits^ \bullet  cp,\sup }}} \right)({T_{ExhAirIn}} - {T_{SupAirIn}})$$</div>

<div>$${\omega_{SupAirOut}} = {\omega_{SupAirIn}} + {\varepsilon_{operating,latent}}\left( {\frac{{\mathop m\limits^ \bullet  cp,\min }}{{\mathop m\limits^ \bullet  cp,\sup }}} \right)({\omega_{ExhAirIn}} - {\omega_{SupAirIn}})$$</div>

*where*:

<span>$\mathop m\limits^ \bullet  cp,\min $</span>           = minimum heat capacity rate (W/K)

<span>$\mathop m\limits^ \bullet  cp,\sup $</span>            = heat capacity rate of the supply air stream (W/K)

<span>$\mathop {\,m}\limits^ \bullet  cp,exh$</span>           = heat capacity rate of the exhaust air stream (W/K)

*T<sub>SupAirOut</sub>*<sub>                     </sub> = supply air temperature leaving the heat exchanger (°C)

*T<sub>SupAirIn</sub>*<sub>                         </sub> = supply air inlet temperature (°C)

*T<sub>ExhAirIn</sub>*<sub>                         </sub> = exhaust air inlet temperature (°C)

<span>${\omega_{SupAirOut}}$</span>          = supply air humidity ratio leaving the heat exchanger (kg/kg)

<span>${\omega_{SupAirIn}}$</span>           = supply air inlet humidity ratio (kg/kg)

<span>${\omega_{ExhAirIn}}$</span>           = exhaust air inlet humidity ratio (kg/kg)

Using the supply air outlet temperature and humidity ratio, the enthalpy of the supply air leaving the heat exchanger is calculated.

<div>$${h_{SupAirOut}} = PsyHFnTdbW({T_{SupAirOut}},{\omega_{SupAirOut}})$$</div>

where:

*h<sub>SupAirOut</sub>*<sub>             </sub>= enthalpy of the supply air leaving the heat exchanger (J/kg)

*PsyHFnTdbW* = psychrometric routine calculating air enthalpy as a function of

    temperature and humidity ratio

If the predicted conditions of the supply air leaving the heat exchanger exceed the saturation curve (&gt;100% RH), then the temperature and humidity ratio of the air are reset to saturated conditions (= 100% RH) at the enthalpy condition calculated above (*h<sub>SupAirOut</sub>).*

Next, the sensible and total heat recovery rates of the heat exchanger are calculated:

<div>$${\mathop Q\limits^ \bullet_{Sensible}} = \left( {\mathop m\limits^ \bullet  cp,\sup } \right)({T_{SupAirIn}} - {T_{SupAirOut}})$$</div>

<div>$${\mathop Q\limits^ \bullet_{Total}} = {\mathop m\limits^ \bullet_{SupAir}}({h_{SupAirIn}} - {h_{SupAirOut}})$$</div>

where:

<div>$${\mathop Q\limits^ \bullet_{Sensible}}$$</div>            = sensible heat recovery rate (W)

<span>${\mathop Q\limits^ \bullet_{Total}}$</span>               = total heat recovery rate (W)

*h<sub>SupAirIn</sub>*            = supply air inlet enthalpy (J/kg)

<span>${\mathop m\limits^ \bullet_{SupAir}}$</span>             = mass flow rate of the supply air stream (kg/s)

The conditions of the exhaust (secondary) air leaving the heat exchanger are then calculated:

<div>$${T_{ExhAirOut}} = {T_{ExhAirIn}}\, + \,\,\frac{{{{\mathop Q\limits^ \bullet  }_{Sensible}}}}{{\mathop m\limits^ \bullet  cp,exh}}$$</div>

<div>$${h_{ExhAirOut}} = {h_{ExhAirIn}}\, + \,\,\frac{{\mathop Q\limits^ \bullet  {\,_{Total}}}}{{{{\mathop m\limits^ \bullet  }_{_{ExhAir}}}}}$$</div>

<div>$${\omega_{ExhAirOut}} = PsyWFnTdbH({T_{ExhAirOut}},{h_{ExhAirOut}})$$</div>

*where*:

*T<sub>ExhAirOut</sub>*<sub>                     </sub> = exhaust air temperature leaving the heat exchanger (°C)

*h<sub>ExhAirOut</sub>*           = exhaust air enthalpy leaving the heat exchanger (J/kg)

<span>${\mathop m\limits^ \bullet_{ExhAir}}$</span>             = mass flow rate of the exhaust air stream (kg/s)

<span>${\omega_{ExhAirOut}}$</span>          = exhaust air humidity ratio leaving the heat exchanger (kg/kg)

*PsyWFnTdbH* = psychrometric routine calculating air humidity ratio as a function of

    temperature and enthalpy

As was done for the supply air, calculated exhaust air conditions beyond the saturation curve are reset to saturation conditions at the calculated air enthalpy value.

Once the air conditions leaving each side of the heat exchanger (supply and exhaust) are calculated, this air is blended with any bypass air that was directed around the heat exchanger core to determine the final air conditions leaving the heat exchanger unit. These outlet air conditions are used in Equations and to determine the sensible and total heat recovery rate for the overall heat exchanger unit. The latent heat recovery rate for the overall unit is then calculated as the difference between the total and sensible heat recovery rates:

<div>$${\mathop Q\limits^ \bullet_{Latent}} = {\mathop Q\limits^ \bullet_{Total}}\,\, - \,{\mathop {\,Q}\limits^ \bullet_{Sensible}}$$</div>

Heat recovery electric power is the electric consumption rate of the unit in watts. The nominal electric power rate for the heat exchanger is specified in the input data file, and can be used to model controls (transformers, relays, etc.) and/or a motor for a rotary heat exchanger. The model assumes that this electric power is consumed whenever the heat exchanger is scheduled to operate and supply/exhaust air flow rates exist. The electric power is assumed to be zero for all other times or if heat exchange is suspended to provide free cooling (economizer operation). None of this electric power is assumed to contribute thermal load to either of the heat exchanger air streams.

At the end of each HVAC simulation time step, this object reports the sensible, latent and total heat recovery rates for the overall unit as calculated above. The heat recovery rates are reported separately for times when the supply air is heated and when it is cooled (Ref: HeatExchanger:AirToAir:SensibleAndLatent in the EnergyPlus Input Output Reference). The heat recovery electric power is also reported for each simulation time step. In addition to the heat recovery rates and electric power, heating/cooling energy transferred to the supply air and the electric energy consumption by the heat exchanger unit are calculated for the time step being reported as follows:

<div>$$\,{Q_{SensibleCooling}} = \,\,{\mathop Q\limits^ \bullet_{SensibleCooling}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

<div>$$\,{Q_{LatentCooling}} = \,\,{\mathop Q\limits^ \bullet_{LatentCooling}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

<div>$$\,{Q_{TotalCooling}} = \,\,{\mathop Q\limits^ \bullet_{TotalCooling}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

<div>$$\,{Q_{SensibleHeating}} = \,\,{\mathop Q\limits^ \bullet_{SensibleHeating}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

<div>$$\,{Q_{LatentHeating}} = \,\,{\mathop Q\limits^ \bullet_{LatentHeating}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

<div>$$\,{Q_{TotalHeating}} = \,\,{\mathop Q\limits^ \bullet_{TotalHeating}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

<div>$$\,{E_{HXUnit}} = \,\,{P_{HXUnit}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

where:

<sub><span>${Q_{SensibleCooling}}$</span>             </sub>= output variable ‘Heat Exchanger Sensible Cooling Energy, J’

<span>$\,{\mathop Q\limits^ \bullet_{SensibleCooling}}$</span>          = output variable ‘Heat Exchanger Sensible Cooling Rate, W’ = <div>$${\mathop Q\limits^ \bullet_{Sensible}}$$</div>

                                   during times when the supply air is cooled

*TimeStepSys*           = HVAC system simulation time step, hr

<sub><span>${Q_{LatentCooling}}$</span>                               </sub>= output variable ‘Heat Exchanger Latent Cooling Energy, J’

<span>$\,{\mathop Q\limits^ \bullet_{LatentCooling}}$</span>           = output variable ‘Heat Exchanger Latent Cooling Rate, W’ = <div>$${\mathop Q\limits^ \bullet_{Latent}}$$</div>

   during times when the supply air is dehumidified

<sub><span>${Q_{TotalCooling}}$</span>                 </sub>= output variable ‘Heat Exchanger Total Cooling Energy, J’

<span>$\,{\mathop Q\limits^ \bullet_{TotalCooling}}$</span>             = output variable ‘Heat Exchanger Total Cooling Rate, W’ = <span>${\mathop Q\limits^ \bullet_{Total}}$</span>during

    times when the supply air enthalpy is reduced

<sub><span>${Q_{SensibleHeating}}$</span>             </sub>= output variable ‘Heat Exchanger Sensible Heating Energy, J’

<span>$\,{\mathop Q\limits^ \bullet_{SensibleHeating}}$</span>          = output variable ‘Heat Exchanger Sensible Heating Rate, W’ = <div>$${\mathop Q\limits^ \bullet_{Sensible}}$$</div>

   during times when the supply air is heated

<sub><span>${Q_{LatentHeating}}$</span>                               </sub>= output variable ‘Heat Exchanger Latent Heating Energy, J’

<sub><span>${Q_{LatentHeating}}$</span>                               </sub>= output variable ‘Heat Exchanger Latent Gain Energy, J’

<span>$\,{\mathop Q\limits^ \bullet_{LatentHeating}}$</span>           = output variable ‘Heat Exchanger Latent Gain Rate, W’ = <div>$${\mathop Q\limits^ \bullet_{Latent}}$$</div> during times when the supply air is humidified

<sub><span>${Q_{TotalHeating}}$</span>                 </sub>= output variable ‘Heat Exchanger Total Heating Energy, J’

<span>$\,{\mathop Q\limits^ \bullet_{TotalHeating}}$</span>             = output variable ‘Heat Exchanger Total Heating Rate, W’ = <span>${\mathop Q\limits^ \bullet_{Total}}$</span>during times when the supply air enthalpy is increased

<span>$\,{E_{HXUnit}}$</span>                  = output variable ‘Heat Exchanger Electric Energy, J’

<span>${P_{HXUnit}}$</span>                   = output variable ‘Heat Exchanger Electric Power, W’

#### Frost Control Methods

In cold weather, frost can form on the heat exchanger causing a reduction in air flow and heat recovery performance. Various strategies can be employed to limit frost formation. Heat exchangers that transfer total energy (sensible plus latent) usually have a lower frost threshold temperature than sensible-only heat exchangers. Frost threshold temperatures for sensible-only heat exchangers may be -1°C to -12°C for plate and rotary heat exchangers respectively, while those for comparable total (sensible plus latent) heat exchangers may be 10°C lower. The frost threshold temperature for a specific application is dependent on the exhaust air dry-bulb temperature and relative humidity, heat exchanger type (e.g., sensible-only or total heat exchange, flat plate or rotary), and the heat exchanger effectiveness. Consult manufacturer’s literature to obtain specific frost threshold temperatures for the heat exchanger being modeled.

Four frost control strategies can be modeled for this air-to-air heat exchanger unit. Each of these four strategies is discussed in detail below.

#### Preheat

One method to control frost formation is to preheat the cold outdoor (supply) air entering the heat exchanger. When a preheat coil is used for frost control, a separate heating coil object must be placed in the supply air stream at the inlet to the heat exchanger (Coil:Heating:Water, Coil:Heating:Electric or Coil:Heating:Gas). The preheat coil should be controlled to maintain a minimum supply air inlet temperature thereby eliminating frost buildup on the heat exchanger core. When modeling preheat frost control, specify “None” as the frost control method in the heat exchanger object. When modeling this heat exchanger as part of an air loop, refer to the objects AirLoopHVAC:OutdoorAirSystem and SetpointManager:Scheduled the EnergyPlus Input Output Reference for additional information on specifying a preheat coil and controlling its supply air temperature.This frost control method is not currently available when this heat exchanger is being used as part of the compound object ZoneHVAC:EnergyRecoveryVentilator.

#### Exhaust Only

This method of frost control bypasses the incoming supply air around the heat exchanger core thereby warming the core using the exiting exhaust air. This method is similar to ‘supply air off’ frost control where the supply air fan is turned off for a predetermined period of time while the exhaust air fan continues to operate. For the ‘supply air off’ method, the supply air flow is stopped for a period of time thereby reducing the ventilation air supplied to the zone(s). In addition, the building may be negatively pressurized for the period of time that the supply air flow is stopped since the exhaust air fan continues to operate. On the other hand, the ‘exhaust only’ method of frost control modeled by EnergyPlus continues to provide outdoor ventilation air to the zone(s), but this air is simply bypassed around the heat exchanger core for a portion of the time and the potential problem with negatively pressurizing the building is avoided. Since the supply airflow rate through the heat exchanger core is purposely reduced to control frost formation, average volumetric airflow rates below 50% of nominal are allowed when this frost control is active and no warning message is issued.

The user enters a threshold temperature, an initial defrost time fraction, and a rate of defrost time fraction increase. When the temperature of the supply air (e.g., outdoor air) entering the heat exchanger is equal to or below the specified threshold temperature, the fractional amount of time that the supply air is bypassed around the heat exchanger core is determined from the following equation:

<div>$${X_{DefrostTime}} = {X_{Initial}} + {X_{RateofIncrease}}({T_{Threshold}} - {T_{SupAirIn}})$$</div>

where:

<span>${X_{DefrostTime}}$</span>  = Fractional time period for frost control <span>$\left( {0\,\, \le \,\,\,{X_{DefrostTime}}\,\, \le \,\,1} \right)$</span>

<span>${X_{Initial}}$</span>        = Initial defrost time fraction

<span>${X_{RateofIncrease}}$</span>= Rate of defrost time fraction increase (K<sup>-1</sup>)

<span>${T_{Threshold}}$</span>     = Threshold temperature (°C)

<span>${T_{SupAirIn}}$</span>       = Supply air inlet temperature (°C)

During the defrost time, supply air flow is fully bypassed around the heat exchanger core and no heat transfer takes place. For the remainder of the time period, no air is bypassed and full heat exchange is achieved. The average supply air flow bypassed around the heat exchanger core is calculated as follows:

<div>$${\mathop m\limits^ \bullet_{_{SupAirBypass}}} = ({X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{SupAir}}}$$</div>

To determine the average heat transfer rates for the simulation time step, the supply air outlet conditions are first calculated as if the heat exchanger were not in defrost mode (see previous section, Model Description). The sensible and total heat transfer rates are then calculated and multiplied by the fractional time period that the heat exchanger is not in defrost mode (1-*X<sub>DefrostTime</sub>*).

<div>$${\mathop Q\limits^ \bullet_{Sensible}} = (1 - {X_{DefrostTime}})\left( {\mathop m\limits^ \bullet  cp,\sup } \right)({T_{SupAirIn}} - {T_{SupAirOut}})$$</div>

<div>$${\mathop Q\limits^ \bullet_{Total}} = (1 - {X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{SupAir}}}({h_{SupAirIn}} - {h_{SupAirOut}})$$</div>

Once the average heat transfer rates are determined, the average conditions of the supply air exiting the overall heat exchanger unit are calculated as follows:

<div>$${T_{SupAirOut}} = {T_{SupAirIn\,}}\,\,\, - \,\,\,\frac{{{{\mathop Q\limits^ \bullet  }_{Sensible}}}}{{\mathop m\limits^ \bullet  cp,\sup }}$$</div>

<div>$${h_{SupAirOut}} = {h_{SupAirIn}}\,\,\, - \,\,\,\frac{{{{\mathop Q\limits^ \bullet  }_{_{Total}}}}}{{{{\mathop m\limits^ \bullet  }_{_{SupAir}}}}}$$</div>

<div>$${\omega_{SupAirOut}} = PsyWFnTdbH({T_{SupAirOut}},{h_{SupAirOut}})$$</div>

As described previously, if the predicted conditions of the exiting supply air exceed the saturation curve (&gt;100% RH), then the temperature and humidity ratio of the air are reset to saturated conditions (= 100% RH) at the enthalpy condition calculated above (*h<sub>SupAirOut</sub>).*If the supply air temperature is reset, the average sensible heat transfer rate is recalculated before the exhaust air outlet conditions are determined:

<div>$${T_{ExhAirOut}} = {T_{ExhAirIn}}\,\,\, + \,\,\,\frac{{{{\mathop Q\limits^ \bullet  }_{Sensible}}}}{{\mathop m\limits^ \bullet  cp,exh}}$$</div>

<div>$${h_{ExhAirOut}} = {h_{ExhAirIn}}\,\,\,\, + \,\,\,\frac{{{{\mathop Q\limits^ \bullet  }_{_{Total}}}}}{{{{\mathop m\limits^ \bullet  }_{_{ExhAir}}}}}$$</div>

<div>$${\omega_{ExhAirOut}} = PsyWFnTdbH({T_{ExhAirOut}},{h_{ExhAirOut}})$$</div>

#### Exhaust Air Recirculation

This method of frost control routes exhaust (outlet) air back through the supply side of the heat exchanger to warm the core. Since this method routes exhaust air back into the building, the building is typically not depressurized when this frost control is active. However, the incoming supply (outdoor ventilation) air flow is stopped for the fractional period of time that frost control is active. If significant periods of time exist when outdoor temperatures are below the selected threshold temperature and outdoor ventilation air is continuously required, an alternative method of frost control should be considered.

The user enters a threshold temperature, an initial defrost time fraction, and a rate of defrost time fraction increase. When the temperature of the inlet supply air (e.g., outdoor air) is equal to or below the specified threshold temperature, the fractional amount of time that this heat exchanger frost control strategy is active is determined from the following equation:

<div>$${X_{DefrostTime}} = {X_{Initial}} + {X_{RateofIncrease}}({T_{Threshold}} - {T_{SupAirIn}})$$</div>

The air mass flow rate of the supply air leaving the heat exchanger unit is then calculated using the defrost time fraction calculated above the mass flow rates of supply and exhaust air entering the unit.

<div>$${\mathop m\limits^ \bullet_{_{SupAirOut}}} = (1 - {X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{SupAirIn}}}\,\, + \,\,{X_{DefrostTime}}{\mathop m\limits^ \bullet_{_{ExhAirIn}}}$$</div>

The model assumes that no heat exchange occurs during defrost, and the average supply supply air conditions are simply a blend of the conditions when the unit is not in defrost and the exhaust air inlet conditions during defrost operation:

<div>$${T_{SupAirOut}} = \,\,\frac{{(1 - {X_{DefrostTime}}){{\mathop m\limits^ \bullet  }_{_{SupAirIn}}}{T_{SupAirOut,NoDefrost\,}} + \,\,{X_{DefrostTime}}{{\mathop m\limits^ \bullet  }_{_{ExhAirIn}}}{T_{ExhAirIn\,}}}}{{{{\mathop m\limits^ \bullet  }_{_{SupAirOut}}}}}$$</div>

<div>$${\omega_{SupAirOut}} = \,\,\frac{{(1 - {X_{DefrostTime}}){{\mathop m\limits^ \bullet  }_{_{SupAirIn}}}{\omega_{SupAirOut,NoDefrost\,}} + \,\,{X_{DefrostTime}}{{\mathop m\limits^ \bullet  }_{_{ExhAirIn}}}{\omega_{ExhAirIn\,}}}}{{{{\mathop m\limits^ \bullet  }_{_{SupAirOut}}}}}$$</div>

<div>$${h_{SupAirOut}} = PsyHFnTdbW({T_{SupAirOut}},{\omega_{SupAirOut}})$$</div>

The operating effectivenesses of the heat exchanger are initially calculated according to Equations and assuming no defrost operation. Since the supply air flow across the heat exchanger core is not reduced during defrost operation, the sensible and latent effectiveness are therefore derated (for reporting purposes) in direct proportion to the fraction of time that frost control is not active.

<div>$${\varepsilon_{operating,sensible}} = (1 - {X_{DefrostTime}}){\varepsilon_{operating,sensible}}$$</div>

<div>$${\varepsilon_{operating,latent}} = (1 - {X_{DefrostTime}}){\varepsilon_{operating,latent}}$$</div>

Since the exhaust outlet air is recirculated through the supply side of the heat exchanger core, the incoming supply air and exiting exhaust air flows are stopped for the fraction of the time when frost control is active. The average air mass flow rate at the supply air inlet and the exhaust air outlet nodes are therefore reduced accordingly.

<div>$${\mathop m\limits^ \bullet_{_{SupAirIn}}} = (1 - {X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{SupAirIn}}}$$</div>

<div>$${\mathop m\limits^ \bullet_{_{ExhAirOut}}} = (1 - {X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{ExhAirOut}}}$$</div>

The conditions of the exiting (outlet) exhaust air (temperature, humidity ratio and enthalpy) are reported as the values when frost control is not active (i.e., the conditions when exhaust air is actually leaving the unit).

#### Minimum Exhaust Temperature

With this frost control method, frost formation is avoided by continuously maintaining the temperature of the exhaust air leaving the heat exchanger core above a specified setpoint. The minimum exhaust air temperature is maintained by modulating heat exchanger rotational speed or by bypassing supply air around a plate heat exchanger. For this frost control method, the user must only enter the threshold (minimum) temperature.

For the case of modulating heat exchanger rotation, the operating effectivenesses and outlet air conditions are first calculated as if the heat exchanger is not in defrost mode (see Model Description). If the resulting temperature of the exhaust air leaving the heat exchanger core is below the specified threshold temperature, then the operating effectivenesses are reduced as follows:

<div>$${X_{DefrostTime}} = \frac{{({T_{Threshold}} - {T_{ExhAirOut}})}}{{({T_{ExhAirIn}} - {T_{ExhAirOut}})}}$$</div>

<div>$${\varepsilon_{operating,sensible}} = (1 - {X_{DefrostTime}}){\varepsilon_{operating,sensible}}$$</div>

<div>$${\varepsilon_{operating,latent}} = (1 - {X_{DefrostTime}}){\varepsilon_{operating,latent}}$$</div>

The supply air and exhaust air outlet conditions are then recalculated using these reduced effectiveness values. Finally the sensible, latent and total heat recovery rates are calculated along with the unit’s electric power and electric consumption.

The calculation procedure is slightly different for the case of a plate heat exchanger where the supply air is bypassed around the heat exchanger core. Since the volumetric air flow rate through the heat exchanger core is reduced when frost control is active, an iterative process is used to determine the operating effectiveness of the heat exchanger. The operating effectivenesses and outlet air conditions are first calculated as if the heat exchanger is not in defrost mode (see Model Description). If the resulting temperature of the exhaust air leaving the heat exchanger core is below the specified threshold temperature, then the fractional defrost time is calculated as follows:

<div>$${X_{DefrostTime}} = \frac{{({T_{Threshold}} - {T_{ExhAirOut}})}}{{({T_{ExhAirIn}} - {T_{ExhAirOut}})}}$$</div>

The iteration process then begins to determine the heat exchanger effectiveness and the exhaust air outlet temperature as if frost control were active. The operating mass flow rate through the supply side of the heat exchanger core is calculated.

*Beginning of iteration process:*

<div>$${\mathop m\limits^ \bullet_{_{SupAirCore}}} = (1 - {X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{SupAirIn}}}$$</div>

<div>$${\mathop m\limits^ \bullet_{_{SupAirBypass}}} = ({X_{DefrostTime}}){\mathop m\limits^ \bullet_{_{SupAirIn}}}$$</div>

The ratio of average volumetric flow rate through the heat exchanger core to heat exchanger’s nominal volumetric flow rate (*HX<sub>flowratio</sub>*) is then determined and used to calculate the operating effectiveness of the heat exchanger using Equations and . Since the supply airflow rate through the heat exchanger core is purposely reduced to control frost formation, average volumetric airflow rates below 50% of nominal are allowed and no warning message is issued. Supply air outlet temperature (leaving the heat exchanger core), sensible heat transfer, and exhaust air outlet temperature are then calculated using the revised heat exchanger effectiveness.

<div>$${T_{SupAirOut}} = {T_{SupAirIn}} + {\varepsilon_{operating,sensible}}\left( {\frac{{\mathop m\limits^ \bullet  cp,\min }}{{\mathop m\limits^ \bullet  cp,\sup }}} \right)({T_{ExhAirIn}} - {T_{SupAirIn}})$$</div>

<div>$${\mathop Q\limits^ \bullet_{Sensible}} = (1 - {X_{DefrostTime}})\left( {\mathop m\limits^ \bullet  cp,\sup } \right)({T_{SupAirInlet}} - {T_{SupAirOutlet}})$$</div>

<div>$${T_{ExhAirOut}} = {T_{ExhAirIn}} + \frac{{{{\mathop Q\limits^ \bullet  }_{Sensible}}}}{{\mathop m\limits^ \bullet  cp,exh}}$$</div>

The error between the exhaust outlet temperature and the threshold temperature for frost control and a new defrost time fraction are subsequently calculated.

<div>$$Error = {T_{ExhAirOut}} - {T_{Threshold}}$$</div>

<div>$${X_{DefrostTime}} = \,{X_{DefrostTime}}\,\left( {\frac{{{T_{ExhAirIn}} - {T_{ExhAirOut}}}}{{{T_{ExhAirIn}} - {T_{Threshold}}}}} \right)$$</div>

*End of iteration process:*

The iteration process ends when the calculated error is within an error tolerance of 0.001.  The air streams passing through the heat exchanger core and bypassing the core through the bypass damper are then blended together to provide the air conditions leaving the heat exchanger unit. Finally the sensible, latent and total heat recovery rates are calculated along with the unit’s electric power and electric consumption.

#### Economizer Operation

A conventional air-side economizer may be used in conjunction with this heat exchanger object. The air-side economizer is specified through the use of an outside air controller (see object: Controller:OutdoorAir). Specify the appropriate economizer control type, and provide the required control points and air flow rates as defined in the outside air controller object. Energy transfer provided by the heat exchanger will be suspended whenever free cooling is available (i.e., when the air-side economizer is activated) and *the user specified economizer lockout input is specified as Yes*. For plate heat exchangers, heat transfer is suspended by fully bypassing the supply and exhaust air around the heat exchanger core. For rotary heat exchangers, air flows continue through the core but it is assumed that heat exchanger rotation is stopped.

Heat exchange can also be suspended for the purposes of providing free cooling operation in the absence of a conventional air-side economizer. In this case specify “MinimumFlowWithBypass” as the economizer choice and again provide the required control points as defined in the outside air controller object. Energy transfer provided by the heat exchanger will be suspended whenever free cooling is available and *the user specified economizer lockout input is specified as Yes*, however the supply air flow rate will remain at the minimum value specified in the outside air controller object. Note that the Economizer Type must be set to something other than NoEconomizer for this control interaction to function.

If economizer operation is not required, specify “NoEconomizer” as the economizer control type in the outside air controller object. The heat exchanger will operate according to its availability schedule and free cooling will not be provided. . If economizer operation *is* required and the heat exchanger *should not* provide free cooling, specify the input for the heat exchanger’s economizer lockout as No and heat recovery will remain active during economizer mode.

Heat recovery for this heat exchanger may also be suspended during a high humidity control event (see object Controller:OutdoorAir) in a similar manner. Specifying Yes for economizer lockout will also suspend heat recovery when high humidity control is activated. The default value for economizer lockout is Yes and must be specifically entered as No to disable the economizer or high humidity control lockout feature.

#### Supply Air Outlet Temperature Control

This heat exchanger object can also control the supply air outlet temperature to a setpoint to avoid overheating. This temperature control is accomplished through wheel speed modulation or bypassing supply air around the heat exchanger. To model this temperature control, the user must specify ‘Yes’ for the Supply Air Outlet Temperature Control field in this heat exchanger object, and a separate setpoint manager (see object: SetpointManager:Scheduled) and temperature schedule  must be specified for the heat exchanger unit’s supply air outlet node.

This control strategy is typically used in conjunction with economizer operation (see object Controller:OutdoorAir), and an example control profile is shown in the figure below. When the outdoor air temperature falls to the specified maximum limit for economizer operation, heat exchange is suspended (air is fully bypassed around the heat exchanger core or heat exchanger rotation is stopped). The figure below shows economizer operation being initiated based on outdoor temperature but other triggers can be used (e.g. differential temperature [outdoor temperature with respect to exhaust air temperature], single point enthalpy or differential enthalpy). Heat exchange remains suspended until the outdoor temperature falls to the minimum temperature (temperature lower limit) for economizer control. The setpoint for the supply air outlet temperature control should match the economizer temperature lower limit.

As the outdoor air temperature falls further below the setpoint for the supply air outlet temperature (same as the economizer lower temperature limit), the heat exchanger bypass dampers will modulate closed to maintain the desired supply air temperature for a plate heat exchanger. For a rotary heat exchanger the rotary heat exchanger speed will gradually increase to maintain the desired supply air temperature. Modulation of heat exchanger performance will continue until the supply air temperature setpoint can no longer be maintained. This control is only active if the entering supply (primary) air temperature is less thatn the heat exchanger setpoint temperature.

![](EngineeringReference/media/image5550.png)



Figure 251.  Air to Air Heat Exchanger with Supply Air Temperature Control

#### References

ARI. 2001. Rating Air-to-Air Heat Exchangers for Energy Recovery Ventilation Equipment. Arlington, Virginia: Air-Conditioning & Refrigeration Institute.

ARI. 2003. Certified Product Directory for Air-to-Air Energy Recovery Ventilation Equipment. Arlington, Virginia: Air-Conditioning & Refrigeration Institute.

### Air System Air-To-Air Flat Plate Heat Exchanger

#### Overview

The input object HeatExchanger:AirToAir:FlatPlate provides an NTU – effectiveness model of a static flat plate air-to-air heat exchanger. Humidity issues are ignored in this model. A full, detailed description of the model can be found in the reference.

The inputs for the model are the design values for the primary air flow rate, primary air inlet and outlet temperature,  secondary air flow rate, and secondary air inlet temperature. No design UAs are required: instead, the ratio (at design conditions) of the primary *hA* to the secondary *hA* (*r<sub>hA</sub>*) is input. The flow configuration is also an input (counter, parallel, or crossflow).

n An important feature of this model is that the heat exchanger total *UA* is a time varying function of the primary and secondary mass flow rates and inlet temperatures.

#### Model Description

The design inlet / outlet conditions determine a design effectiveness *eff*<sub>des</sub>. From the design capacity flow ratio, the flow arrangement, and *eff*<sub>des,</sub> the NTU – effectiveness formulas give the *NTU<sub>des</sub>* and *UA<sub>des</sub>*.

The time varying calculations proceed as follows. First the *UA* is determined:

<div>$$UA = U{A_{des}}({r_{hA}} + 1)/({({\dot m_{p,des}}{T_{p,des}}/{\dot m_p}{T_p})^{.78}} + {r_{hA}}{({\dot m_{s,des}}{T_{s,des}}/{\dot m_s}{T_s})^{.78}})$$</div>

where *des* means *design*, *p* means *primary*, *s* means *secondary*, *T* is air stream temperature, and <span>$\dot m$</span>is air stream mass flow rate. From the *UA* and the capacity flow ratio the *NTU* is determined: <span>$NTU = UA/{C_{\min }}$</span>. Then the NTU – effectiveness formulas are used to calculate the effectiveness. From the effectiveness and the inlet conditions, outlet condtions are determined.

#### Economizer Operation

A conventional air-side economizer may be used in conjunction with this heat exchanger object. The air-side economizer is specified through the use of an outside air controller (see object: Controller:OutdoorAir). Specify the appropriate economizer control type, and provide the required control points and air flow rates as defined in the outside air controller object. Energy transfer provided by the heat exchanger will be suspended whenever free cooling is available (i.e., when the air-side economizer is activated) or high humidity control is active and *the user specified economizer lockout input is specified as Yes*. For this flat plate heat exchanger, heat transfer is suspended by fully bypassing the supply and exhaust air around the heat exchanger core. If the economizer lockout is specified as No, the flat plate heat exchanger is operational even when economizer or high humidity mode is active. The default value for economizer lockout is Yes and must be specifically entered as No to disable the economizer or high humidity control lockout feature.

#### References

M. Wetter. 1999. *Simulation Model: Air-To-Air Plate Heat Exchanger*, LBNL-42354. This document can be downloaded from [*http://simulationresearch.lbl.gov*](http://simulationresearch.lbl.gov).

### Air System Air-To-Air Balanced Flow Desiccant Heat Exchanger

#### Overview

The input object HeatExchanger:Desiccant:BalancedFlow provides a model for a desiccant heat exchanger that is an HVAC component used to model both temperature (sensible) and moisture (latent) heat exchange between two air streams (Figure 252). The model assumes balanced air flow through the regeneration and process sides of the heat exchanger (i.e., regeneration and process air volume flow rates and face velocities are the same). Heat exchanger performance is specified through a performance data type object (e.g., Heat Exchanger:Desiccant:BalancedFlow:Performance Data Type 1). Refer to the EnergyPlus Input Output Reference for the specific input syntax for this desiccant heat exchanger object.

![BalancedFlowDesiccantHeatExchanger\_Schematic](EngineeringReference/media/image5554.png)

Figure 252. Schematic of the Balanced Flow Desiccant Heat Exchanger

EnergyPlus has another air-to-air heat exchanger object for modeling sensible and latent heat transfer between two air streams that uses the input object HeatExchanger:AirToAir:SensibleAndLatent. That heat exchanger model uses effectiveness values specified by the user to determine exiting air conditions from each side of the heat exchanger. In contrast, the balanced flow desiccant heat exchanger references a performance data type object (e.g., HeatExchanger:Desiccant:BalancedFlow:PerformanceDataType1) which defines the model equations, user-specified model coefficients, and min/max limits for the model’s independent and dependent variables.

#### Model Description

This heat exchanger is a simple object that performs three basic functions:

1.    Informs the associated performance data type object (e.g., HeatExchanger:Desiccant:BalancedFlow:PerformanceDataType1) if it should calculate heat exchange for a simulation time step, or if heat exchange is suspended for the time step (i.e., bypass air flow around a fixed-plate heat exchanger or stop the rotation of a rotary heat exchanger),

2.    Passes the process and regeneration air inlet conditions (e.g., dry-bulb temperature, humidity ratio, air mass flow rate) to the associated performance data type object, and

3.    Reports the total, sensible and latent cooling/heating rates and electric power based on the results from the performance data type model that is specified.

While the desiccant heat exchanger object’s availability to provide heat exchange between the two air streams is determined by the user-specified availability schedule, other objects that call this heat exchanger object can also control its heat exchange during a simulation time step. Currently, this desiccant heat exchanger model can be referenced by two compound objects: CoilSystem:Cooling:DX:HeatExchangerAssisted and Dehumidifier:Desiccant:System, both of which are used to provide enhanced dehumidification over conventional systems. If this heat exchanger is referenced by a compound object, the compound object will control heat exchanger operation (i.e., tell the heat exchanger if heat exchange is needed or not for each simulation time step). Details for how the compound objects control exchanger operation are described elsewhere in this document (ref. CoilSystem:Cooling:DX:HeatExchangerAssisted and Dehumidifier:Desiccant:System).

This desiccant heat exchanger object may also be specified directly in a AirLoopVHAC (air loop BranchList) or in an AirLoopHVAC:OutdoorAirSystem:EquipmentList without being referenced by a compound object. If specified directly in a AirLoopHVAC loop or AirLoopHVAC:OutdoorAirSystem:EquipmentList, then the heat exchanger can be controlled to provide heat exchange based on a maximum and/or minimum humidity setpoint placed on the process air outlet node (ref. SetpointManagers). If no humidity setpoints are provided on this node, then heat exchange will be provided whenever the heat exchanger is available to operate (via its availability schedule) and there is a temperature and/or humidity ratio difference between the two air streams. Further details regarding heat exchanger control via humidity setpoints on the process air outlet node are described in the section for the associated data type object (e.g., HeatExchanger:Desiccant:BalancedFlow:PerformanceDataType1).

The balanced flow desiccant heat exchanger model first checks for three conditions to be true before calling the specified performance data type model to calculate heat exchanger performance:

·        Non-zero air mass flow rates on the process and regeneration inlet air nodes,

·        Desiccant heat exchanger is available to operate based on its availability schedule,

·        If a compound object is calling this desiccant heat exchanger, it is requesting that heat exchange be provided.

If any of these conditions is false, then heat exchange is suspended and the model simply passes the air conditions on the process and regeneration air inlet nodes to the respective outlet air nodes. In addition, the heat exchanger electric power is set to zero.

If all of the above conditions are true, then heat exchange is active and the specified performance data type model is called to calculate the process and regeneration outlet air conditions and heat exchanger electric power. Immediately before this call to the performance data type model, a check is made to determine if the operating air flow rates through the heat exchanger (i.e., the actual air flow rates for the simulation time step) are equal (balanced flow). If a difference of more than 2% exists between the process and regeneration air flow rates at any time during the simulation, a warning is issued.

After the specified performance data type model calculates the process/regeneration air outlet conditions and heat exchanger electric power, the balanced flow desiccant heat exchanger model uses that information to report overall performance. Specifically, the heat exchanger’s sensible, latent and total heating and cooling rates are calculated for the process air side of the heat exchanger. Since energy must be conserved, the same heating or cooling rates apply to the regeneration air stream although they are opposite in heat transfer direction (e.g., a sensible cooling rate on the process air side of the heat exchanger would indicate an equivalent sensible heating rate on the regeneration air side).

<div>$${\mathop Q\limits^ \bullet_{Sensible}} = \,{\mathop m\limits^ \bullet_{Proc}}C{p_{Proc,\,\,in}}\left( {{T_{Proc,\,\,out}}\, - \,{T_{Proc,\,\,in}}} \right)$$</div>

<div>$${\mathop Q\limits^ \bullet_{Total}} = \,{\mathop m\limits^ \bullet_{Proc}}\left( {{h_{Proc,\,\,out}}\, - \,{h_{Proc,\,\,in}}} \right)$$</div>

<div>$${\mathop Q\limits^ \bullet_{Latent}} = \,{\mathop Q\limits^ \bullet_{Total}}\, - \,{\mathop Q\limits^ \bullet_{Sensible}}$$</div>

where:

<div>$${\mathop Q\limits^ \bullet_{Sensible}}$$</div>      = sensible heat transfer rate to the process air stream (W)

<span>${\mathop Q\limits^ \bullet_{Total}}$</span>         = total heat transfer rate to the process air stream (W)

<div>$${\mathop Q\limits^ \bullet_{Latent}}$$</div>        = latent heat transfer rate to the process air stream (W)

<span>${\mathop m\limits^ \bullet_{Proc}}$</span>         = process air mass flow rate (kg/s)

<span>$C{p_{Proc,\,\,in}}$</span>     = specific heat of inlet process air (J/kg-K)

<span>${T_{Proc,\,\,out}}$</span>      = process air outlet temperature (°C)

<span>${T_{Proc,\,\,in}}$</span>        = process air inlet temperature (°C)

<span>${h_{Proc,\,\,out}}$</span>      = process air outlet enthalpy (J/kg)

<span>${h_{Proc,\,\,in}}$</span>        = process air inlet enthalpy (J/kg)



To simplify the accounting of heat exchanger performance, the sensible, latent, and total heat transfer rates for the process side of the heat exchanger are stored in cooling and heating report variables. For example, if the sensible heat transfer rate is negative, the absolute value is stored in a “cooling” rate report variable. Conversely, if the sensible heat transfer rate is positive, the value is stored in a “heating” rate report variable. Similar accounting is performed for the latent and total heat transfer rate variables as follows:

<div>$$IF\left( {{{\mathop Q\limits^ \bullet  }_{Sensible}} <  = 0} \right){\mathop Q\limits^ \bullet_{SensibleCooling}} = ABS\left( {{{\mathop Q\limits^ \bullet  }_{Sensible}}} \right)$$</div>

<div>$$IF\left( {{{\mathop Q\limits^ \bullet  }_{Sensible}} > 0} \right){\mathop Q\limits^ \bullet_{SensibleHeating}} = {\mathop Q\limits^ \bullet_{Sensible}}$$</div>

<div>$$IF\left( {{{\mathop Q\limits^ \bullet  }_{Latent}} <  = 0} \right){\mathop Q\limits^ \bullet_{LatentCooling}} = ABS\left( {{{\mathop Q\limits^ \bullet  }_{Latent}}} \right)$$</div>

<div>$$IF\left( {{{\mathop Q\limits^ \bullet  }_{Latent}} > 0} \right){\mathop Q\limits^ \bullet_{LatentHeating}} = {\mathop Q\limits^ \bullet_{Latent}}$$</div>

<div>$$IF\left( {{{\mathop Q\limits^ \bullet  }_{Total}} <  = 0} \right){\mathop Q\limits^ \bullet_{TotalCooling}} = ABS\left( {{{\mathop Q\limits^ \bullet  }_{Total}}} \right)$$</div>

<div>$$IF\left( {{{\mathop Q\limits^ \bullet  }_{Total}} > 0} \right){\mathop Q\limits^ \bullet_{TotalHeating}} = {\mathop Q\limits^ \bullet_{Total}}$$</div>

At the end of each HVAC simulation time step, this object reports the sensible, latent and total cooling/heating energy and electric consumption for the heat exchanger as follows:

<div>$${Q_{SensibleCooling}} = {\dot Q_{SensibleCooling}}*TimeStepSys*3600.$$</div>

<div>$${Q_{LatentCooling}} = {\dot Q_{LatentCooling}}*TimeStepSys*3600.$$</div>

<div>$${Q_{TotalCooling}} = {\dot Q_{TotalCooling}}*TimeStepSys*3600.$$</div>

<div>$${Q_{SensibleHeating}} = {\dot Q_{SensibleHeating}}*TimeStepSys*3600.$$</div>

<div>$${Q_{LatentHeating}} = {\dot Q_{LatentHeating}}*TimeStepSys*3600.$$</div>

<div>$${Q_{TotalHeating}} = {\dot Q_{TotalHeating}}*TimeStepSys*3600.$$</div>

<div>$${E_{HXUnit}} = {P_{HXUnit}}*TimeStepSys*3600.$$</div>

where:

<sub><span>${Q_{SensibleCooling}}$</span>             </sub>= output variable ‘Heat Exchanger Sensible Cooling Energy, J’

<span>${\dot Q_{SensibleCooling}}$</span>          = output variable ‘Heat Exchanger Sensible Cooling Rate, W’ = <div>$${\dot Q_{Sensible}}$$</div>

                                   during times when the process air is cooled

*TimeStepSys*           = HVAC system simulation time step, hr

<sub><span>${Q_{LatentCooling}}$</span>               \\                </sub>= output variable ‘Heat Exchanger Latent Cooling Energy, J’

<span>${\dot Q_{LatentCooling}}$</span>           = output variable ‘Heat Exchanger Latent Cooling Rate, W’ = <span>${\dot Q_{Latent}}$</span>

   during times when the process air is dehumidified

<sub><span>${Q_{TotalCooling}}$</span>                 </sub>= output variable ‘Heat Exchanger Total Cooling Energy, J’

<span>${\dot Q_{TotalCooling}}$</span>             = output variable ‘Heat Exchanger Total Cooling Rate, W’ = <span>${\dot Q_{Total}}$</span>during

    times when the process air enthalpy is reduced

<sub><span>${Q_{SensibleHeating}}$</span>             </sub>= output variable ‘Heat Exchanger Sensible Heating Energy, J’

<span>${\dot Q_{SensibleHeating}}$</span>          = output variable ‘Heat Exchanger Sensible Heating Rate, W’ = <span>${\dot Q_{Sensible}}$</span>

   during times when the process air is heated

<sub><span>${Q_{LatentHeating}}$</span>               </sub>= output variable ‘Heat Exchanger Latent Gain Energy, J’

<span>${\dot Q_{LatentHeating}}$</span>           = output variable ‘Heat Exchanger Latent Gain Rate, W’ = <span>${\dot Q_{Latent}}$</span> during times when the process air is humidified

<sub><span>${Q_{TotalHeating}}$</span>                 </sub>= output variable ‘Heat Exchanger Total Heating Energy, J’

<span>${\dot Q_{TotalHeating}}$</span>             = output variable ‘Heat Exchanger Total Heating Rate, W’ = <span>${\dot Q_{Total}}$</span>during times when the process air enthalpy is increased

<span>${E_{HXUnit}}$</span>                  = output variable ‘Heat Exchanger Electric Energy, J’

<span>${P_{HXUnit}}$</span>                   = output variable ‘Heat Exchanger Electric Power, W’

#### Economizer Operation

A conventional air-side economizer may be used in conjunction with this heat exchanger object. The air-side economizer is specified through the use of an outside air controller (see object: Controller:OutdoorAir). Specify the appropriate economizer control type, and provide the required control points and air flow rates as defined in the outside air controller object. Energy transfer provided by the heat exchanger will be suspended whenever free cooling is available (i.e., when the air-side economizer is activated) or high humidity control is active and *the user specified economizer lockout input is specified as Yes*. For the desiccant heat exchanger, heat transfer is assumed to be provided by a rotating heat exchanger core. For this reason, air continues to flow through the core when the outdoor air economizer is active but it is assumed that the rotation of the heat exchanger core is stopped. If the economizer lockout is specified as No, the desiccant heat exchanger is operational even when economizer or high humidity mode is active. This specific type of heat exchanger is typically *not* controlled by an outdoor air economizer. For this reason, the default value for economizer lockout is No and must be specifically entered as Yes to enable the economizer or high humidity control lockout feature.

#### Desiccant Heat Exchanger Performance Data

##### Overview

The input object HeatExchanger:Desiccant:BalancedFlow:PerformanceDataType1 specifies a performance model and model coefficients for a balanced flow desiccant heat exchanger. The HeatExchanger:Desiccant:BalancedFlow:PerformanceDataType1 object is referenced by a HeatExchanger:Desiccant:BalancedFlow object. This performance data object is used to specify the thermal performance and electric consumption of the heat exchanger. Some representative inputs for this object are provided in the EnergyPlus Reference DataSets (PerfCurves.idf).

This model predicts the regeneration air stream outlet temperature and humidity ratio values based on the entering regeneration and process air stream temperature, humidity ratio and face velocity. The process air stream outlet humidity ratio and temperatures are calculated based on a simple heat and moisture balance. The model requires that the user enter the nominal volumetric flow rate and a nominal face velocity, electric power consumption, empirical model coefficients for the regeneration outlet air temperature and humidity ratio equations, and the applicable minimum and maximum values for both the independent and dependent variables for the empirical model coefficients provided. Refer to the EnergyPlus Input Output Reference for details regarding the input syntax for this object.

##### Heat Exchanger Face Area and Air Velocity

The user is required to enter a nominal volumetric air flow rate and a nominal face velocity. From these inputs, a heat exchanger face area (applicable for both the regeneration and process sides of the heat exchanger) is calculated and used to determine the operating face velocity during the simulation.

<div>$${A_{face}}\, = \,{\raise0.7ex\hbox{${{V_{face,nom}}}$} \!\mathord{\left/ {\vphantom {{{V_{face,nom}}} {{{\mathop v\limits^ \bullet  }_{face,nom}}}}}\right.}\!\lower0.7ex\hbox{${{{\mathop v\limits^ \bullet  }_{face,nom}}}$}}$$</div>

<div>$$RFV\, = \,{\raise0.7ex\hbox{${{{\mathop m\limits^ \bullet  }_{Reg,in}}}$} \!\mathord{\left/ {\vphantom {{{{\mathop m\limits^ \bullet  }_{Reg,in}}} {\left( {{\rho_{Std}}{A_{face}}} \right)}}}\right.}\!\lower0.7ex\hbox{${\left( {{\rho_{Std}}{A_{face}}} \right)}$}}$$</div>

where:

<span>${A_{face}}$</span>          = heat exchanger face area (m<sup>2</sup>)

<span>${V_{face,nom}}$</span>      = nominal air volume flow rate specified for the heat exchanger (m<sup>3</sup>/s)

<span>${\mathop v\limits^ \bullet_{face,nom}}$</span>      = nominal air face velocity specified for the heat exchanger (m/s)

<span>$RFV$</span>         = face velocity of the regeneration (and process) air stream (m/s)

<span>${\mathop m\limits^ \bullet_{Reg,in}}$</span>       = mass flow rate of the regeneration air stream (kg/s)

<span>${\rho_{Std}}$</span>           = density of air at standard temperature and pressure [dry air at 20°C] (m<sup>3</sup>/kg)



The face velocity calculated each simulation time step is used in the empirical equations (see ‘Model Calculations’ below) and should be within the minimum and maximum velocity boundaries specified for the model coefficients (see ‘Empirical Model Boundaries (Minimum and Maximum)‘ below). When the calculated air velocity exceeds one of the boundaries, a warning is issued and the velocity is reset to the appropriate boundary value before being passed to the empirical equations for calculating regeneration air outlet temperature and humidity ratio. If the user is confident in their empirical model coefficients, the minimum and maximum velocity boundaries may be expanded slightly (caution should be used here) to allow extrapolation of the empirical equations during the simulation.

##### Model Calculations

The model coefficients may be obtained by curve fitting field measurements or the results from other computer models that accurately reflect the performance of a balanced flow desiccant heat exchanger. A wide range of data is necessary to properly define the performance of the desiccant heat exchanger such that all operating conditions expected during a simulation are included in the range of data used to obtain the model coefficients. The minimum and maximum boundaries for the independent variables used to generate the empirical model coefficients are used by this model to ensure that model extrapolation does not occur at any point during the simulation. For this reason, it is recommended that the widest possible range of data be used to determine the model coefficients.

The dry-bulb temperature of the regeneration outlet air is determined using the equation shown below.

<div>$$RTO = B1 + B2*RWI + B3*RTI + B4*\left( {\frac{{RWI}}{{RTI}}} \right) + B5*PWI + B6*PTI + B7*\left( {\frac{{PWI}}{{PTI}}} \right) + B8*RFV$$</div>

where:

<span>$RTO$</span> = regeneration outlet air dry-bulb temperature (°C)

<span>$RWI$</span> = regeneration inlet air humidity ratio (kg/kg)

<span>$RTI$</span>  = regeneration inlet air dry-bulb temperature (°C)

<span>$PWI$</span> = process inlet air humidity ratio (kg/kg)

<span>$PTI$</span>  = process inlet air dry-bulb temperature (°C)

<span>$RFV$</span> = regeneration (and process) face velocity (m/s)



Similarly, the humidity ratio of the regeneration outlet air is defined using the same empirical equation form; however, different coefficients are used as follows:

<div>$$RWO = C1 + C2*RWI + C3*RTI + C4*\left( {\frac{{RWI}}{{RTI}}} \right) + C5*PWI + C6*PTI + C7*\left( {\frac{{PWI}}{{PTI}}} \right) + C8*RFV$$</div>

where:

<span>$RWO$</span> = regeneration outlet air humidity ratio (kg/kg)



If the regeneration outlet air conditions exceed the saturation curve, RTO and RWO are reset to saturated conditions (100% RH) at the enthalpy calculated based on the original RTO and RWO values.

Once the regeneration outlet air conditions are determined as described above, the dry-bulb temperature and humidity ratio differences across the regeneration side of the heat exchanger are calculated.

<div>$${T_{diff}} = \,RTO - {T_{Reg,\,\,in}}$$</div>

<div>$${w_{diff}} = \,RWO - {w_{Reg,\,\,in}}$$</div>

where:

<span>${T_{Reg,\,\,in}}$</span>         = actual regeneration inlet air dry-bulb temperature (°C)

<span>${w_{Reg,\,\,in}}$</span>        = actual regeneration inlet air humidity ratio (kg/kg)

<span>${T_{diff}}$</span>           = regeneration air temperature difference based on empirical model (°C)

<span>$wdiff$</span>          = regeneration air humidity ratio difference based on empirical model (kg/kg)



The regeneration outlet air conditions described above represent the full load outlet conditions under steady-state operation. However, there are times when the heat exchanger may not operate for the entire simulation time step (i.e., bypass air flow around a fixed-plate heat exchanger or stop the rotation of a rotary heat exchanger for a portion of the time step). For example, the parent object calling this heat exchanger model may request that it only provide heat exchange for a portion of the time step (*HXPartLoadRatio*). Another example would be if this heat exchanger is not called by a parent object but is instead placed directly in a AirLoopHVAC or AirLoopHVAC:OutdoorAirSystem and a setpoint manager is used to place a minimum and/or maximum humidity ratio setpoint on the process air outlet node. For this case the humidity setpoints, if present, are used to calculate a part-load ratio for the heat exchanger assuming the full-load process air humidity ratio difference is equivalent (but opposite in sign) to the regeneration air humidity ratio difference (*w<sub>diff</sub>*):



<span>$\begin{array}{l}IF\,\,\left( {{w_{diff}} > 0.0} \right)\,\,THEN\,\,!\,\,Regen\,\,air\,humidified,\,process\,air\,dehumidified\\\,\,\,\,\,\,\,\,HXPartLoadRatio = \,\frac{{\left( {{w_{Proc,\,\,in}} - {w_{max, set\,point}}} \right)}}{{{w_{diff}}}}\\ELSE\,IF\,\left( {{w_{diff}} < 0.0} \right)\,\,THEN\,\,!\,\,Regen\,\,air\,dehumidified,\,process\,air\,humidified\\\,\,\,\,\,\,\,\,HXPartLoadRatio = \,\frac{{\left( {{w_{Proc,\,\,in}} - {w_{min, set\,point}}} \right)}}{{{w_{diff}}}}\\END\,IF\\HXPartLoadRatio = MAX\left( {0.0,HXPartLoadRatio} \right)\\HXPartLoadRatio = MIN\,\left( {1.0,HXPartLoadRatio} \right)\end{array}$</span>

If this heat exchanger is not being called by a parent object and no humidity setpoints are placed on the process air outlet node, then the model assumes that the heat exchanger operates for the entire simulation time step when it is available to operate (based on its availability schedule) and there is a temperature and/or humidity ratio difference between the two air streams.

EnergyPlus has an established convention for placing information on outlet air nodes. If the air flow rate is continuous but the device only operates for a portion of the simulation time step, then the average outlet conditions (temperature, humidity and enthalpy) are placed on the outlet air node. If the air flow rate cycles on and off during the simulation time step, then the full load outlet conditions are placed on the outlet air node along with the average air mass flow rate for the simulation time step. To account for these cases, this model uses the following logic:

<div>$$\begin{array}{l}IF(FanOpMode\,\,.EQ.\,\,CycFanCycComp\,\,.OR.\,\,RegAirInletIsOANode)\,THEN\\\,\,\,\,\,\,\,\,{T_{Reg,\,\,out}}\, = \,{T_{Reg,\,\,in}} + {T_{diff}}\\\,\,\,\,\,\,\,\,{w_{Reg,\,\,out}}\, = \,{w_{Reg,\,\,in}} + {w_{diff}}\\ELSE\\\,\,\,\,\,\,\,\,{T_{Reg,\,\,out}}\, = \,{T_{Reg,\,\,in}} + \left( {{T_{diff}}*HXPartLoadRatio} \right)\\\,\,\,\,\,\,\,\,{w_{Reg,\,\,out}}\, = \,{w_{Reg,\,\,in}} + \left( {{w_{diff}}*HXPartLoadRatio} \right)\\ENDIF\end{array}$$</div>

where:

<span>${T_{Reg,\,\,out}}$</span>       = regeneration outlet air dry-bulb temperature (°C)

<span>${w_{Reg,\,\,out}}$</span>      = regeneration outlet air humidity ratio (kg/kg)

<span>$HXPartLoadRatio$</span> = heat exchanger part-load ratio (determined by parent object calling this model, or calculated based on a minimum/maximum humidity ratio setpoints as shown above).



In the logic shown above, *RegAirInletIsOANode* is true if the regeneration air inlet node is an outside air node. If so, the model assumes that the air flow through the regeneration side of the heat exchanger cycles on and off as required during the simulation time step. Also, the regeneration outlet air humidity ratio is limited to be between 1E-5 and 1.0.

The regeneration outlet air enthalpy is then calculated using the regeneration outlet air temperature and humidity ratio.

<div>$${h_{Reg,\,\,out}} = \,PsyHFnTdbW\left( {{T_{Reg,\,\,out}}\,,\,\,{w_{Reg,\,\,out}}} \right)$$</div>

Using the regeneration outlet air conditions, the heat transfer on the regeneration side of the heat exchanger is then calculated:

<div>$${\mathop Q\limits^ \bullet_{Sensible,Reg}} = \,{\mathop m\limits^ \bullet_{Reg}}C{p_{Reg,\,\,in}}\left( {{T_{Reg,\,\,out}}\, - \,{T_{Reg,\,\,in}}} \right)$$</div>

<div>$${\mathop Q\limits^ \bullet_{Total,Reg}} = \,{\mathop m\limits^ \bullet_{Reg}}\left( {{h_{Reg,\,\,out}}\, - \,{h_{Reg,\,\,in}}} \right)$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{Sensible,Reg}}$</span>  = sensible heat transfer rate to the regeneration air stream (W)

<span>${\mathop Q\limits^ \bullet_{Total,Reg}}$</span>     = total heat transfer rate to the regeneration air stream (W)

<span>${\mathop m\limits^ \bullet_{Reg}}$</span>          = regeneration air mass flow rate (kg/s)

<span>$C{p_{Reg,\,\,in}}$</span>      = specific heat of inlet regeneration air (J/kg-K)



Since the model assumes that total and sensible heat transfer is conserved, these heat transfer rates are then used to calculate the process air outlet conditions:

<div>$${h_{Proc, out}} = \,{h_{Proc,in}} - \left( {\frac{{{{\mathop Q\limits^ \bullet  }_{Total,Reg}}}}{{{{\mathop m\limits^ \bullet  }_{Proc}}}}} \right)$$</div>

<div>$${T_{Proc, out}} = \,{T_{Proc,in}} - \left( {\frac{{{{\mathop Q\limits^ \bullet  }_{Sensible,Reg}}}}{{{{\mathop m\limits^ \bullet  }_{Proc}}C{p_{Proc,in}}}}} \right)$$</div>

<div>$${w_{Proc,\,\,out}} = \,PsyWFnTdbH\left( {{T_{Proc,\,\,out}}\,,\,\,{h_{Proc,\,\,out}}} \right)$$</div>

where:

<span>${h_{Proc,\,\,out}}$</span>      = process outlet air enthalpy (J/kg)

<span>${T_{Proc,\,\,out}}$</span>      = process outlet air dry-bulb temperature (°C)

<span>${w_{Proc,\,\,out}}$</span>      = process outlet air humidity ratio (kg/kg)

<span>${\dot m_{Proc}}$</span>         = process air mass flow rate (kg/s)

<span>$C{p_{Proc,in}}$</span>     = specific heat of inlet process air (J/kg-K)

Like the regeneration outlet air conditions, the process outlet air conditions are also checked for exceeding saturated conditions and, if detected, the temperature and humidity ratio are reset assuming constant enthalpy.

<div>$$\begin{array}{l}{T_{sat}} = \,PsyTsatFnHPb\left( {{h_{Proc,\,\,out}}\,,\,\,PB} \right)\\IF({T_{sat}} > \,{T_{Proc,out}})\,THEN\\\,\,\,\,\,\,\,\,\,\,{T_{Proc,out}} = {T_{sat}}\\\,\,\,\,\,\,\,\,\,\,{w_{Proc,out}} = PsyWFnTdbH\left( {{T_{Proc,out}}\,,\,\,{h_{Proc,out}}} \right)\\END\,IF\end{array}$$</div>

Heat recovery electric power is the electric consumption rate of the unit in watts. The nominal electric power for the heat exchanger is specified in the input data file, and can be used to model controls (transformers, relays, etc.) and/or a motor for a rotary heat exchanger. The model assumes that this electric power is consumed whenever the heat exchanger operates. The electric power is assumed to be zero for all other times. None of this electric power is assumed to contribute thermal load to either of the heat exchanger air streams. As with the thermal performance of the heat exchanger, the power used by the heat exchanger is also proportional to the heat exchanger part load ratio.

<div>$${P_{HXUnit}}\, = \,{P_{HX,\,nom}}\left( {HXPartLoadRatio} \right)$$</div>

where:

<span>${P_{HXUnit}}$</span>       = output variable ‘Heat Exchanger Electric Power, W’ reported by the HeatExchanger:Desiccant:BalancedFlow object.

<span>${P_{HX,\,nom}}$</span>       = user specified ‘Nominal Electric Power, W’

##### Empirical Model Boundaries (Minimum and Maximum)

Since this model uses empirical equations and extrapolation can cause unexpected results, the entering air conditions to both the regeneration and process sides of the heat exchanger are checked during each simulation time step to make sure they are within the valid range defined by the user. If any of the independent variables used in the equations for RTO and RWO above are outside the minimum and maximum limits specified for each independent variable, the values for these specific independent variables are limited to the appropriate boundary (min/max) value for use by the empirical equations and a warning is issued.

Additional model checks occur by testing the regeneration and process inlet air relative humidities. In this case, the process and regeneration inlet air relative humidities are calculated and compared to the minimum/maximum values specified by the user. If the calculated relative humidity exceeds the specified range at any point during the simulation when the heat exchanger is operating, a warning message is issued but the simulation proceeds.

If the user is confident in their empirical model coefficients, the minimum and maximum independent variable boundaries may be expanded (caution should be used here) to allow extrapolation of the empirical equations during the simulation.

In addition to checking the inlet air conditions, the model allows the user to specify limits for the regeneration air outlet conditions (RTO and RWO). If the calculated value for RTO or RWO exceeds the minimum/maximum limits specified by the user, then the calculated value is reset to the appropriate boundary (min/max) value and a warning message is issued.

This model also assumes that the performance of the desiccant heat exchanger (i.e., the output of the empirical equations) conforms to the following two guidelines.

1.    The regeneration outlet air temperature (RTO) is always less than or equal to the regeneration inlet air temperature (*T<sub>RegIn</sub>*)

2.    The regeneration outlet air humidity ratio (RWO) is always greater than or equal to the regeneration inlet air humidity ratio (*w<sub>RegIn</sub>*)

When the calculated regeneration outlet air conditions do not follow these guidelines, a warning is issued and the simulation proceeds.

### Plant Loop Deep-Ground-To-Water Vertical U-Tube Field Heat Exchanger

This model (Object: GroundHeatExchanger:Vertical) documentation is derived from the M.S. thesis of Arunachalam Murugappan, which is available on the Oklahoma State University web site [http://www.hvac.okstate.edu/](http://www.hvac.okstate.edu/).  Eskilson (1987) Yavuzturk and Spitler (1999) developed the long and short time response factors respectively, which are used in determining the borehole temperature responses. Response factors are infinite series of numbers, which relate the current value of a variable to past values of other variables at discrete time intervals.  These response factors are referred as *g*-functions. The variable time-step model presented here uses both long time-step *g*-functions and short time-step *g*-functions to predict the boreholes response to short term fluctuations in the load.

#### Long Time-Step Response Factors

Eskilson developed *g*-functions for various borehole configurations. He plotted the g function curves for different sets of borehole spacing to borehole length ratio <span>$B/H$</span> typically for .05, 0.1, 0.15, 0.2, 0.3 and ∞ (∞ represents the single borehole configuration. All the plots were for the ratio of 0.0005 between the borehole radius and the borehole length <span>${r_b}/H$</span>. For any other radius a simple relation between the two radii as given by Eskilson (1987) can be used. Eskilson gives the *g*-function curves for 38 different configurations.

Figure 253 shows the *g*-function plotted against the non-dimensional time defined as <span>$\ln (t/{t_s})$</span>, <span>${t_s} = {H^2}/9\alpha $</span> for various configurations of vertical boreholes with *B/H* ratio of .1 along with single borehole. It is seen from this figure that the thermal interaction between boreholes increases with time and with the number of boreholes in field.

![](EngineeringReference/media/image5651.png)

Figure 253.  Short Time Step g Function Curve as an Extension of Long Time Step g Function Curves for Different Configuration of Boreholes (Eskilson 1987, Yavuzturk 1999).

The *g*-functions developed by Eskilson are valid only after time estimated by Eskilson as <span>$5r_b^2/\alpha $</span>. This time varies from 3-6 hours for a typical borehole field. This is because the analytical line source model, based on which the Eskilson’s model was developed, does not give a prompt increase in borehole wall temperature at <span>$r = {r_b}$</span>. It gives acceptable results only after the non-dimensional times of <span>$\alpha t/r_b^2 > 5$</span>. But to model short time responses of a borehole we need response factors, which can give accurate results down to minutes.

#### Short Time-Step Response Factors

Yavuzturk and Spitler (1999) developed short time step response factors using a transient, two-dimensional, implicit finite volume model on a polar grid.

The circular u-tube pipe in the ground loop heat exchanger was approximated as a pie sector of equivalent perimeter.  A constant heat flux for the heat transfer form/to U-tube, a zero heat flux in the angular direction and a constant far field temperature in the radial axis makes up the three boundary condition and undisturbed far field temperature as the initial condition. The numerical model accounts for the thermal resistance due to individual borehole elements; such as resistance of the pipe and grout material and the convection resistance due to the heat transfer fluid in the pipes. The long time step *g*-functions discussed in the previous section do not account for such effects.

The short time-step *g*-functions are the same for different borehole configurations. This is because there is no thermal interaction between the boreholes for times less than 200 hrs during which the short time-step *g*-functions apply. So it is suggested to use the short time-step *g* function for time steps in the range of 2.5 min and 200 hours and the long time-step *g*-functions for time steps longer than 200 hours. The *g* function for any time can be found by linear interpolation between the bounding known values.

#### Development of the Variable Short Time Step Model

The variable time step model was developed as an extension of the model presented by Yavuzturk and Spitler (1999). The variable, short time step model uses a similar algorithm and extends it to accommodate sub-hourly responses, variable time steps and explicit equations to calculate the outlet fluid temperature of the ground loop heat exchanger.

The uniform time-steps model developed by Yavuzturk and Spitler (1999) is able to pre-calculate all the g-functions at the beginning of the simulation. The variable time-step model on the other hand must calculate the *g*-functions when the borehole response calculation for each time step is carried out. For every time step a different set of *g*-functions is needed in the variable time step model as the time at which the *g*-function is to be applied for the past loads changes for each time-steps.

This is made clear from the illustration in Figure 254, which shows a simulation in progress. The boxes with numbers represent the sub-hourly loads. The time (in hrs) at which these loads occurred are shown by solid arrows above the respective load boxes. The right-most solid arrow gives the current simulation time, which is 3.31 hrs. The times given below the boxes, pointed by dashed arrows, are the time at which the *g*-functions are to be estimated and applied to the respective sub hourly loads (boxes) for the current time.

For example, let us take the sub hourly loads 1,2 & 3. These loads occurred at 0 hrs, 0.16 hrs & 0.28 hrs. The response of the borehole temperature for the current time step is calculated by applying the *g­-*functions at 3.15 hrs, 3.03 hrs & 2.5 hrs respectively. Thus to calculate the present borehole temperature, the sub hourly loads 1-12 are superposed using the corresponding *g* functions at times given by the dashed lines.  This gives the borehole temperature at hr 3.31. However, for the previous time step, which occurred at 3.15 hrs, the g-functions for the loads 1, 2 & 3 are at 2.99 hrs 2.87 hrs and 2.42 hrs, and the over all response is obtained by superposing the loads 1-11.

Thus for each time step since the time step increments are not uniform we need to store the simulation times at which these time-steps occurred, and calculate corresponding *g*-functions at each time-step.

![](EngineeringReference/media/image5655.png)

Figure 254.  Variable Timestep Ground Loop Heat Exchanger Model Schematic Explaining the *g* Function Estimation.

Yavuzturk model calculates the outlet fluid temperature by iteration beginning with the undisturbed mean temperature of the surrounding ground as an initial guess. This aggravates the time taken by an already computationally intensive algorithm. To circumvent this a set of explicit equations were formulated to estimate the outlet fluid temperature.

#### Description of the Load Aggregation Scheme

A load aggregation scheme was developed for energy simulation software with variable short time steps down to one minute. A major issue in the development was the calculation of the *g*-functions.  As discussed previously in the variable time step environments, the time step increments are not uniform. As a result, g-functions cannot e pre-calculated. Figure 255 shows a schematic of the variable time step ground loop heat exchanger model. The figure shows the larger monthly block loads, hourly loads and sub hourly loads and along with the time of occurrence of those loads. The figure also shows the time at which the *g*-functions are applied to different load blocks.

![](EngineeringReference/media/image5656.png)

Figure 255.  Schematic of Variable Time Step Model *g* Function Calculation.

To calculate the response of a past load on the borehole temperature we apply the *g*-function corresponding to the time elapsed since the load was applied. This is easily understood form the schematic. For example, to calculate the response of the aggregated load 1” (at the end of 730hrs.) for the current time step (2193.733hrs) we apply a *g*-function at 1463.73hrs. The *g*-function for the same block 1” at the previous time step, which occurred at 2193.25 hrs, would be at 1463.25hrs. From the schematic it is also seen that for the other two aggregated monthly loads 2”, 3” the *g*-function are applied at 733.73 hrs and 3.73 hrs for the current time-step and at 733.25 hrs and 3.25 hrs respectively for the previous time-step. The same scheme applies to hourly and sub-hourly. Thus to estimate the time at which the past monthly, hourly or sub-hourly loads occur, we might be tempted to store the simulation times at each time step for the entire simulation, storing load times for the whole length of simulation for a multi year simulation with a variable short time step would require a large amount of memory. But little consideration shows that it is not necessary.  Since the monthly and hourly loads occur at equal intervals of time 730hrs and 1hr respectively, the *g*-functions can be estimated with the current simulation time and the time at which the load block ends, which is a multiple of the monthly duration of the block size. Only the sub-hourly loads require storage of simulation times.

For example from the schematic (Figure 256), for the sub hourly load 1, which occurred at the end of 2193.25 a *g*-function at .48 hrs has to be applied and for the next load 2 a *g*-function at 0.34 hrs has to be applied. Since the time intervals are not even for the sub hourly loads, we need to store the time steps at which those loads occurred. These times are required to estimate the time elapsed between the current simulation time and the time at which the sub hourly loads occurred.

Thus, the algorithm keeps track of the sub hourly loads along with their time of occurrence for a user-defined length of time during which the sub hourly calculations are made. The algorithm also estimates the time weighted hourly load from their corresponding sub hourly loads as each hour passes. The sub-hourly loads are time weighted because of the irregular intervals at which the time-step occurs. This is also illustrated in Figure 256. The sub hourly loads 1,2 &3 occur for varying length of time. The load 3 occurs for a longer duration than 1 and 2 in that order. This implies that the load 3 has to be given more weight than 1 and 2. So the sub hourly loads for a particular hour are multiplied by the length of their respective period of occurrence and averaged over the hour. This is further explained by the schematic in Figure 5.

![](EngineeringReference/media/image5657.png)

Figure 256.  Schematic Showing the Calculation of Hourly Load from the Sub Houly Loads.

The bottom text in the boxes represents the magnitude of the sub hourly loads in W/m for each time step. The duration of the occurrence of each time-step for the each block is shown below the respective block. The first hourly load is given by the expression

<div>$${\overline q_1} = \left[ \begin{array}{l}\left( {8.36 \times .159} \right) + \left( {6.51 \times .339} \right) + \left( {10.3 \times .107} \right)\\ + \left( {6.92 \times .162} \right) + \left( {9.03 \times .181} \right) + \left( {12 \times .05} \right)\end{array} \right] = 7.993W/m$$</div>

Where <span>${\overline q_1}$</span> = the first hourly load in W/m

The algorithm keeps track of enough of these past hourly loads to calculate the monthly load. As each month or user defined time passes, hourly loads over the entire month or user defined time “blocks” are averaged and stored in arrays for the respective monthly user defined block of time.

The borehole temperature for any time step is computed by superposing the monthly (larger time block loads) hourly and sub-hourly loads for each time step. To understand more clearly consider the schematic in Figure 256 where the borehole temperature at 2193.733 hour is to be estimated. Here the monthly block time is 730 hrs. We have three monthly aggregated load blocks for 730 hrs, 1460 hrs and 2190 hrs and hourly loads from 2191<sup>st</sup> hr to 2193<sup>rd</sup> hour. For the remaining 0.733 hours a sub hourly calculation is done. The three monthly aggregated load blocks when superposed using long time *g-*functions, yields the borehole temperature at the end of 2190<sup>th</sup> hour. Then the hourly loads from 2191<sup>st</sup> to 2193<sup>rd</sup> hrs are superposed using the corresponding short time step *g* functions values yielding the borehole temperature at the end of 2193<sup>rd</sup> hour. The sub-hourly variations for the current hour are obtained, by superposing the sub-hourly loads. From the schematic, we see there are two sub-hourly loads, 1 and 2. Thus the borehole temperature at the end of 2193.733 is expressed as:

<div>$${T_{2193.733}} = {T_{ground}} + \sum\limits_{m = 1}^3 {\left[ {\frac{{{{\overline{\overline q} }_m} - {{\overline{\overline q} }_{m - 1}}}}{{2\pi {k_{ground}}}}g\left( {\frac{{{t_{2193.733}} - {t_{730(m - 1)}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

<div>$$ + \sum\limits_{n = 2190}^{2193} {\left[ {\frac{{{{\overline q }_n} - {{\overline q }_{n - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{2193.733}} - {t_{n - 1}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

<div>$$ + \sum\limits_{p = 2193}^{2193.733} {\left[ {\frac{{{q_p} - {q_{p - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{2193.733}} - {t_p}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

Where

<span>$\overline{\overline q} $</span> = The average monthly loads

<span>$\overline q $</span>  = The average hourly loads

*Q* = the sub-hourly loads

*m* = index for monthly aggregated blocks

*p* = array index for sub hourly loads

*t* = time

t<sub>p</sub>  =  the sub hourly time steps over the history period. (here increment is not always unity)

Superposing the temperature responses of monthly (larger) blocks over the shorter, namely the hourly and sub hourly, introduces some error in the borehole temperature calculation at the beginning of every month. Yavuzturk and Spitler suggest a method to reduce the error in borehole temperature prediction by using a minimum hourly history period during which only the short time step superposition is carried out. In our model this idea is extended to sub hourly loads as well. Thus a user specified minimum sub-hourly history period is included along with the minimum hourly history period to model the sub-hourly variations. During this period only sub-hourly and hourly superpositions are made. This guarantees that at any given time step the superposition of temperature responses involves a minimum period of short time responses, which ensures a better estimation of borehole temperature. For example, a minimum hourly history period of 96 hrs and a minimum sub hourly history period of 5 hours would result in only 2 monthly aggregation blocks (1” and 2”). The last monthly aggregation does not occur because neither of the minimum hourly history period of 96 hours or sub-hourly history period of five hrs is met. So an hourly superposition of the load is carried out for the third month until the minimum sub-hourly history period after which sub hourly superposition is carried out. The equation becomes

<div>$${T_{2193.733}} = {T_{ground}} + \sum\limits_{m = 1}^2 {\left[ {\frac{{{{\overline{\overline q} }_m} - {{\overline{\overline q} }_{m - 1}}}}{{2\pi {k_{ground}}}}g\left( {\frac{{{t_{2193.733}} - {t_{730(m - 1)}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

<div>$$ + \sum\limits_{n = 1460}^{2188} {\left[ {\frac{{{{\overline q }_n} - {{\overline q }_{n - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{2193.733}} - {t_{n - 1}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

<div>$$ + \sum\limits_{p = 2188}^{2193.733} {\left[ {\frac{{{q_p} - {q_{p - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{2193.733}} - {t_p}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

Yavuzturk and Spitler have done a detailed analysis on the effect of minimum hourly history period. They found that a minimum hourly history period of 192 hrs for an annual simulation would reduce the running time by 90%.  They also found that for a 20year simulation, the computation time of the aggregated load scheme is just 1% of the non-aggregated load scheme.

#### Summary of Variable Short Time Step Response Factor Model

The load aggregation scheme developed in line with the above example is summarized eight steps as follows:

1.    Define monthly load blocks duration (mb) in hrs (generally 730 hrs) and the minimum hourly history period and minimum sub hourly history period.

2.    Read Borehole Geometry Parameters: number of boreholes, borehole length radius thickness of the pipe etc. Read Ground and Fluid thermal properties: Ground conductivity, volumetric specific heat capacity of the ground and heat carrier fluid. Read the short and long time-step *g-*functions into arrays with their respective non-dimensionalized times.

3.    Start Simulation from p=1 to nts. Here “nts” is the number of time steps that have occurred since the start of simulation. (Note that P in not a count of number of hour elapsed in the simulation)

4.    Compute the hourly loads as each hour passes. This is done by averaging the sub hourly loads during the past hour. The monthly loads are calculated by averaging the hourly loads during that month. This is done by summing the hourly loads during that monthly period and dividing the sum by 730 hours NumMonths(the number of months used in aggregation calculations) is set to the number of months of simulation (current number of aggregated load blocks)

5.    If the simulation time is less than the minimum sub hourly history period the borehole temperature is estimated with no aggregation. Only sub hourly loads are superposed as given by the following equation.

<div>$${T_{nts}} = {T_{ground}} + \sum\limits_{p = 1}^{nts} {\left[ {\frac{{{q_p} - {q_{p - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_p}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

6.    . If the simulation time is less than sum of minimum hourly history and sub hourly history periods, then decomposed hourly aggregated loads are superposed using their corresponding g function until the sub hourly history required. Then the sub hourly temperature differences are found by superposing the decomposed sub hourly loads with their short time step *g* functions. Average borehole temperature is found by superposing the hourly and sub hourly temperature differences with the following equation

<div>$${T_{nts}} = \sum\limits_{n = 1}^{nh - sh} {\left[ {\frac{{{{\overline q }_n} - {{\overline q }_{n - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_{n - 1}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]}  + \sum\limits_{p = nts - sh}^{nts} {\left[ {\frac{{{q_p} - {q_{p - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_p}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

7.    If the simulation time is greater then the sum of a monthly period, sub hourly history and the hourly history period. Then monthly load aggregation is performed. Here if the difference between the simulation time and product of a monthly block period and the current number of monthly blocks is greater than the sum of the minimum hourly history and sub hourly history periods then the average borehole temperature is found by the following equation.

<div>$${T_{nts}} = {T_{ground}} + \sum\limits_{m = 1}^{calb} {\left[ {\frac{{{{\overline{\overline q} }_m} - {{\overline{\overline q} }_{m - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_{mb[m - 1]}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

<div>$$ + \sum\limits_{n = nh - [calb(mb) + sh]}^{nh - sh} {\left[ {\frac{{{{\overline q }_n} - {{\overline q }_{n - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_{n - 1}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

**<span>$ + \sum\limits_{p = nts - sh}^{nts} {\left[ {\frac{{{q_p} - {q_{p - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_p}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $</span>                                                       **

8.    If the difference between the simulation time and product of a monthly block period and the current number of monthly blocks is less than the sum of the minimum hourly history and sub hourly history periods, then NumMonths is set to one month less than the actual number of months of simulation completed. The average borehole temperature is calculated by superposing the long and time step temperature differences using the following equation.

<div>$${T_{nts}} = {T_{ground}} + \sum\limits_{m = 1}^{calb - 1} {\left[ {\frac{{{{\overline{\overline q} }_m} - {{\overline{\overline q} }_{m - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_{mb[m - 1]}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

<div>$$ + \sum\limits_{n = nh - [(calb - 1)(mb) + sh]}^{nh - sh} {\left[ {\frac{{{{\overline q }_n} - {{\overline q }_{n - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_{n - 1}}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $$</div>

**<span>$ + \sum\limits_{p = nts - sh}^{nts} {\left[ {\frac{{{q_p} - {q_{p - 1}}}}{{2\pi {\kappa_{ground}}}}g\left( {\frac{{{t_{nts}} - {t_p}}}{{{t_s}}},\frac{{{r_b}}}{H}} \right)} \right]} $</span>                          **

Define Monthly block duration, minimum hourly history period and minimum sub hourly history period (step 1)



Read Borehole Geometry parameters, Ground and carrier fluid properties and read short and long time-step *g* functions. (Step 2)

** **

**Do until** p = 1 to number of time-steps (nts) (Step 3)

Compute the Ground Load for the current time step using Entering Fluid temperature (For the first time-step *T*<sub>FarField</sub> may be used)

Compute the hourly loads as each hour and monthly loads as each month passes. Calculate the number of monthly blocks (NumMonths)(**Step 4**)

**If** (Current time less than minimum sub hourly history) (**Step 5**)

**   ** use Equation

**Else If** (Current Simulation Time less than sum of minimum hourly history and minimum sub hourly history) (**step 6**)

    use Equation

    **Else**

**If** (Difference between current simulation    time and duration of the total number months is Greater than sum of minimum hourly and sub hourly histories) (**step 7**)

    use Equation

           **Else** (**step 8**)

                  use Equation

           **End if**

    **End if**

**End do**

** **

#### References

Eskilson, P. 1987. Thermal Analysis of Heat Extraction Boreholes. Ph.D. Thesis, Department of Mathematical Physics, University of Lund, Lund, Sweden.

Yavuzturk, C. 1999. Modeling of Vertical Ground Loop Heat Exchangers for Ground Source Heat Pump Systems. Ph.D. Thesis, Department of Mechanical and Aerospace Engineering, Oklahoma State University, Stillwater, Oklahoma.

Yavuzturk, C., J.D. Spitler. 1999.[ A Short Time Step Response Factor Model for Vertical Ground Loop Heat Exchangers.](http://www.hvac.okstate.edu/research/Documents/ASHRAE/Yavuzturk_Spitler_99.pdf) *ASHRAE Transactions*. 105(2):475-485.

### GroundHeatExchanger:Slinky

This model reuses much of the same code including the load aggregation and temperature response caluclations which are described above in the GroundHeatExchanger:Vertical model. As a result, that section can also be used as reference material. This model is unique in that it generates it’s own temperature response factor g-functions, rather than relying on the other software or data to generate the g-functions. These are generated based on the work by Xiong et al. 2015.

#### Horizontal Slinky Temperature Response Functions

Equation used for calculating the g-function temperature response factors for the horizontal Slinky HX are seen below.

<div>$$   
 g_s\left(t\right) = \sum_{i=1}^{N_{ring}} \sum_{j=1}^{N_{ring}} \frac{R}{4\pi N_{ring}} \int_0^{2\pi} \int_0^{2\pi} 
            \left[ 
                \frac{erfc\left(d\left(P_j,P_i\right)/2\sqrt{\alpha t}\right)}{d\left(P_j,P_i\right)} - 
                \frac{erfc\left(\sqrt{d\left(P_j,P_i\right)^2+4h^2/\left(2\sqrt{\alpha t}\right)}\right)}{\sqrt{d\left(P_j,P_i\right)^2+4h^2} }
            \right]d\omega d\varphi
$$</div>

Where:

<div>$$
  d\left(P_j,P_i\right) = \frac{d\left(P_{ii},P_j\right) + d\left(P_{io},P_j\right)}{2}
$$</div>

<div>$$
  d\left(P_{ii},P_j\right) = \sqrt{\left[x_{0i} + \left(R-r\right)\cos \varphi - x_{0j}-R\cos \omega\right]^2 + \left[y_{0i} + \left(R-r\right)\sin \varphi - y_{0j}-R\sin \omega\right]^2}
$$</div>

<div>$$
  d\left(P_{io},P_j\right) = \sqrt{\left[x_{0i} + \left(R-r\right)\cos \varphi - x_{0j}-R\cos \omega\right]^2 + \left[y_{0i} + \left(R+r\right)\sin \varphi - y_{0j}-R\sin \omega\right]^2}
$$</div>

#### Vertical Slinky Temperature Response Functions

Equations used for calculating the g-function temperature response factors for the vertical Slinky HX are seen below.

<div>$$   
 g_s\left(t\right) = \sum_{i=1}^{N_{ring}} \sum_{j=1}^{N_{ring}} \frac{R}{4\pi N_{ring}} \int_0^{2\pi} \int_0^{2\pi} 
            \left[ 
                \frac{erfc\left(d\left(P_j,P_i\right)/2\sqrt{\alpha t}\right)}{d\left(P_j,P_i\right)} - 
                \frac{erfc\left(d\left(P_{j'},P_i\right)/2\sqrt{\alpha t}\right)}{d\left(P_{j'},P_i\right)}
            \right]d\omega d\varphi
$$</div>

Where: 

<div>$$
  d\left(P_j,P_i\right) = \frac{d\left(P_{ii},P_j\right) + d\left(P_{io},P_j\right)}{2}
$$</div>

<div>$$
  d\left(P_{j'},P_i\right) = \frac{d\left(P_{ii},P_{j'}\right) + d\left(P_{io},P_{j'}\right)}{2}
$$</div>

<div>$$
  d\left(P_{ii},P_j\right) = \sqrt{\left[x_{0i} + \left(R-r\right)\cos \varphi - x_{0j}-R\cos \omega\right]^2 + \left[y_{0i}-y_{0j}\right]^2 + \left[z_{0i} + \left(R-r\right)\sin \varphi - z_{0j}-R\sin \omega\right]^2}
$$</div>

<div>$$
  d\left(P_{io},P_j\right) = \sqrt{\left[x_{0i} + \left(R+r\right)\cos \varphi - x_{0j}-R\cos \omega\right]^2 + \left[y_{0i}-y_{0j}\right]^2 + \left[z_{0i} + \left(R+r\right)\sin \varphi - z_{0j}-R\sin \omega\right]^2}
$$</div>

<div>$$
  d\left(P_{ii},P_{j'}\right) = \sqrt{\left[x_{0i} + \left(R-r\right)\cos \varphi - x_{0j}-R\cos \omega\right]^2 + \left[y_{0i}-y_{0j}\right]^2 + \left[z_{0i} + \left(R-r\right)\sin \varphi - z_{0j} - 2h - R\sin \omega\right]^2}
$$</div>

<div>$$
  d\left(P_{io},P_{j'}\right) = \sqrt{\left[x_{0i} + \left(R+r\right)\cos \varphi - x_{0j}-R\cos \omega\right]^2 + \left[y_{0i}-y_{0j}\right]^2 + \left[z_{0i} + \left(R+r\right)\sin \varphi - z_{0j} - 2h - R\sin \omega\right]^2}
$$</div>

#### Model Simplifications for Computational Efficiency

Several simplifications were used to ensure the g-function temperature response factors are computationally efficient. The first simplification is achieved by taking advantage of symmetry. In the [Figure](#SlinkyGHX1) below we can see that by taking advantage of symmettry the temperature response for only one quarter of the rings needs be calculated.

The second simplification occurs by realizing that the effect between two rings decreases exponentially as the distance between the rings increases. Near-field rings are defined as rings whose centers are within 2.5m + D distance from the center of ring i as is seen in [Figure](#SlinkyGHX1). Far-field rings are defined as rings whose centers are beyond 10m + D, with middle-field rings occupying the space in between the near-field and far-field rings. Near-field ring temperature response factors are determined as indicated above for horzontal or vertical slinkys. Middle-field rings are considerably simplified – the interaction between ring is approximated as that of two point sources at their centers. Thermal effect of far-field rings are ignored.

The third and final simplification takes advantatge of geometric similarity that ring share. Ring pairs that are geometrically similar do not require recalculation of distances or reponse factors. Thus the calculations for geometrically similar ring pairs can be reused.

For more information, see [Xiong et al. 2015](#SlinkyReferenceXiong).

![](EngineeringReference/media/image8001.png)

Figure: Schematic of first and second improvements to the algorithm for computational efficiency. <a name="SlinkyGHX1"></a>

#### References

Xiong, Z., D.E. Fisher, and J.D. Spitler. 2015. Development and Validation of a Slinky(TM) Ground Heat Exchanger Model. Applied Energy 141: 57-69. <a name="SlinkyReferenceXiong"></a>

### Plant Loop Pond-To-Water Heat Exchanger

The pond model (Object: GroundHeatExchanger:Pond) is a ‘lumped parameter’ model where the pond is represented by a single node with thermal mass. The pond surface temperature is the same as the temperature at this node, i.e. the surface temperature is the same as the bulk temperature. A first order differential equation is solved in the model to calculate the pond temperature at each time step. This type of heat rejecter is modeled as several circuits connected in parallel.

![](EngineeringReference/media/image5676.png)

Figure 257.  Heat Transfer Mechanisms in a Pond (Chiasson 1999)

Rees(2002) implemented the model developed by Chiasson(1999) for the shallow ponds. The model is based on the assumption that thermal gradients in shallow ponds are negligible, especially during times of heat rejection. Using the lumped parameter approach, an overall energy balance for the pond may be devised as

<div>$$q{}_{in} - q{}_{out} = V\rho C{}_p\frac{{dT}}{{dt}}$$</div>

Where

<span>$q{}_{in}$</span>   =   Heat transfer to the pond

<span>$q{}_{out}$</span>  =   Heat transfer from the pond

<span>$V$</span>     =   Pond Volume

<span>$\rho $</span>     =   Density of pond water

<span>${q_{in}}$</span> = Heat transfer to the pond

<span>$C{}_p$</span> = Specific heat capacity of pond water

<span>$\frac{{dT}}{{dt}}$</span> = rate of change of temperature of the pond water

Rate of change in average pond temperature is given as

<div>$$\frac{{dT}}{{dt}} = \frac{{q{}_{solar} + q{}_{thermal} + q{}_{convection} + q{}_{groundwater} + q{}_{evaporation} + q{}_{fluid}}}{{V\rho C{}_p}}$$</div>

Where

q<sub>solar   \\                    \\     </sub>= Solar radiation heat gain to the pond

q<sub>thermal       \\          </sub>= Thermal radiation heat transfer at the pond surface.

q<sub>convection           </sub> = Convection heat transfer at the pond surface

q<sub>ground\\                   \\    </sub>= Heat transfer to/from ground to the pond

q<sub>groundwater\\          \\    </sub>= Heat transfer due to ground water inflow/outflow

q<sub>evaporation        </sub> = Heat transfer due to evaporation at the pond surface

q<sub>fluid                    </sub> = Total heat transfer to/from the heat exchanging fluid flowing in all spools or  coils in the pond

A heat balance is calculated at a single node that represents the pond. Heat transfer takes place by surface convection, long-wave radiation to the sky, absorption of solar energy, ground heat transfer and heat exchange with the fluid. A heat exchanger analogy is used to calculate the heat transfer between the heat transfer fluid and the pond. The differential equation defined by the heat balance is solved using a fourth order Runge-Kutta numerical integration method. The implementation along with the model equations are summarized in the figure below.

![](EngineeringReference/media/image5686.png)

Figure 258.  Pond Model Component Configuration (Chiasson 1999)

The model overall pond model consists in a number of sub-models which are enumerated below.

#### Solar radiation heat gain to the pond

<div>$$\rho ' = {\tau_a} - \tau $$</div>

where

<span>$\rho '$</span>is the reflectance

<span>$\tau $</span> is the transmittance of solar radiation by the pond surface and the subscript ‘a’ refers to the absorbed component.

<div>$${\tau_a} = {e^{\frac{{ - \mu 'd}}{{\cos {\theta_r}}}}}$$</div>

and

<div>$$\tau  = \frac{1}{2}\left( {\frac{{1 - {r_{par}}}}{{1 + {r_{par}}}} + \frac{{1 - {r_ \bot }}}{{1 + {r_ \bot }}}} \right){e^{\frac{{ - \mu 'd}}{{\cos {\theta_r}}}}}$$</div>

where

<span>$\mu '$</span>is the extinction coefficient for water

<span>$d$</span> is the pond depth

<span>${r_{par}}$</span>represents the parallel component of unpolarized radiation and

<span>${r_ \bot }$</span>represents the perpendicular component of unpolarized radiation which are computed by Duffie and Beckman (1991) as:

<sub><span>${r_{par}} = \frac{{{{\tan }^2}\left( {{\theta_r} - \theta } \right)}}{{{{\tan }^2}\left( {{\theta_r} + \theta } \right)}}$</span></sub>

<sub><span>${r_ \bot } = \frac{{{{\sin }^2}\left( {{\theta_r} - \theta } \right)}}{{{{\sin }^2}\left( {{\theta_r} - \theta } \right)}}$</span></sub>

Finally, the amount of solar radiation absorbed by the pond (<span>${q_{solar}}$</span>) is expressed as:

<div>$${q_{solar}} = I\left( {1 - \rho '} \right){A_{pond}}$$</div>

where

<span>$I$</span>is the solar radiation flux incident on the pond surface (here, the total reflectance is approximated by the beam reflectance)

<span>${A_{pond}}$</span>is the area of the pond surface.

The model also accepts solar radiation in the form of beam <span>$\left( {{I_b}} \right)$</span>and diffuse <span>$\left( {{I_d}} \right)$</span> components, in which case <span>$I$</span>is computed from:

<div>$$I = {I_b}\cos \theta  + {I_d}$$</div>

#### Thermal radiation heat transfer at the pond surface

<div>$$q{}_{thermal} = \sigma \alpha (T{{}_{surface}^4} - T{{}_{sky}^4})$$</div>

Where

<span>$\alpha $</span>= Thermal absorptivity

<span>$\sigma $</span>= Stefan Boltzman constant

#### Convection heat transfer at the pond surface

<div>$$q{}_{convection} = h{}_c(T{}_{pond} - T{}_{db})$$</div>

ASHRAE simple convection coefficient model is used to obtain the convection coefficient for external surfaces. Initializing of pond temps to mean of dry-bulb temperature T<sub>db</sub> and ground temperatures is useful because repeated warm up days tend to drive the initial pond temperature toward the dry-bulb temperature Hence, for each environment the simulation starts the pond temperature T<sub>pond</sub> midway between the dry-bulb and ground temperature.

#### Heat transfer to/from ground to the pond

Hull et al (1984) expressed the following equation for ground heat losses from any pond. The equations are also based on the assumption that, for all practical purposes, the constant temperature sink is the ground water table (Kishore and Joshi 1984)

<div>$$q{}_{ground} = U{}_{ground}A{}_{ground}(T{}_{groundwater} - T{}_{pond})$$</div>

<div>$$U{}_{ground} = 0.999\left( {\frac{{k{}_{ground}}}{{d{}_{groundwater} - d{}_{pond}}}} \right) + 1.37\left( {\frac{{k{}_{ground}P{}_{pond}}}{{A{}_{pond}}}} \right)$$</div>

Where

<span>$k{}_{ground}$</span>        = Thermal conductivity of the ground

 <span>$d{}_{groundwater}$</span> = depth of water table

<span>$d{}_{pond}$</span>          = Pond depth

<span>$P{}_{pond}$</span>         = Pond perimeter

#### Heat transfer due to evaporation at the pond surface

Evaporation is calculated assuming a fixed Lewis number unlike the Chaisson model.

<div>$$q{}_{evaporation} = {\left( {\frac{{\Pr }}{{Sc}}} \right)^{2/3}}\left( {\frac{{h{}_c}}{{Cp{}_{air}}}} \right)\left( {HR{}_f - HR{}_a} \right)\left( {q{}_l} \right)$$</div>

Where

Pr =Prandtl number for air

Sc = Schmidt number for air

Hc = convection coefficient

HRf= humidity ratio at pond surface/film temperature

HRa= humidity ratio of air

ql  = Latent heat of air

Air properties are obtained by applying the existing the psychometric functions of EnergyPlus.

#### Total heat transfer to/from the heat exchanging fluid flowing in all spools or coils in the pond

<div>$$q{}_{fluid} = UA{}_{pipe}(T{}_{fluid} - T{}_{pond})N{}_{circuit}$$</div>

Where

<span>$UA{}_{pipe}$</span> = overall heat transfer coefficient expressed in terms of inside pipe area

<span>$N{}_{circuit}$</span>= number of spools installed in the pond

The fluid temperature Tfluid is computed as the average fluid temperatures of the inlet and the outlet node at a given temperature.

<div>$$U{A_{pipe}} = \frac{{2\pi {r_i}\cdot {L_{spool}}}}{{\sum {{r_t}} }}$$</div>

where

<span>${r_i}$</span>= inner pipe radius

<span>${L_{spool}}$</span>l= length of one spool

<span>$\sum {{r_t}} $</span>= composite thermal resistance defined as

<span>$\sum {{r_t}} $</span>=Resistance due to fluid flow in the pipe +external pipe thermal resistance +fouling factor

#### References

Chiasson, A.D. 1999. *Advances in modeling of groundsourceheat pump systems*. Master’s thesis,Oklahoma State University, Stillwater, OK

Duffie, J.A., and W.A. Beckman. 1991. *Solar engineering of thermal processes,* 2d ed. New York: John Wiley & Sons.

Hull, J.R., K.V. Liu, W.T. Sha, J. Kamal, and C.E. Nielsen. 1984. Dependence of ground heat losses upon solar pond size and perimeter insulation—Calculated and experimental results. *Solar Energy* 33(1): 25-33

Kishore, V.V.N., and V. Joshi. 1984. A practical collector efficiency equation for nonconvecting solar ponds. *Solar Energy* 33(5): 391-395.

Rees, S.J., J.D. Spitler and X. Xiao, X 2002.[Transient Analysis of Snow-melting System Performance](http://www.hvac.okstate.edu/pdfs/Rees_Spitler_Xiao_02.pdf).*ASHRAE Transactions.*108(2):406-423.

### Plant Loop Surface-Ground-To-Water Heat Exchanger

This model (Object: GroundHeatExchanger:Surface) is based on the QTF formulation of heat transfer through building elements with embedded heat sources/sinks. The model uses a heat exchanger analogy to relate the inlet fluid temperature to the net heat transfer rate and consequently outlet temperature. The model is entirely passive, i.e. it does not set any flow rates or incorporate any controls. In order to deal with the non-linear boundary conditions at the top surface due to the presence of ice/snow fluxes have to be calculated by the QTF model and temperature calculated from the surface heat balance. This requires some iteration. Note, top surface variables correspond to ‘outside’ variables in standard CTF/QTF definition. Bottom surface variables correspond to ‘inside’ variables.

For given current surface temperatures the terms of the QTF equations can be grouped into constant terms, and those depending on the current source flux. The surface heat balance may be given by the following equation (Strand,1997)

<div>$$QS{}_{} = \sum\limits_{m = 1}^M {X{}_{k,m}} T{}_{i,t - m + 1} - \sum\limits_{m = 1}^M {Y{}_{k,m}} T{}_{o,t - m + 1} + \sum\limits_{m = 1}^k {F{}_m} q{}_{i,t - m} + \sum\limits_{m = 1}^M {W{}_m} {q''}{}_{source,t - m + 1}$$</div>

<div>$$T{}_S{}_{} = \sum\limits_{m = 1}^M {X{}_{k,m}} T{}_{i,t - m + 1} - \sum\limits_{m = 1}^M {Y{}_{k,m}} T{}_{o,t - m + 1} + \sum\limits_{m = 1}^k {F{}_m} q{}_{i,t - m} + \sum\limits_{m = 1}^M {W{}_m} q''{}_{source,t - m + 1}$$</div>

Where

T<sub>s</sub>    = temperature of the node where the heat source or sink is present

<span>$QS$</span>= Surface heat balance

<span>${q''}$</span>= Heat flux

T   = Temperature

i    =  inside of the building element

o   = outside of the building element

t    = current time step

X Y F = Conduction transfer functions

The surface balance equation includes terms for incident solar energy, radiation heat transfer from internal sources, linearized radiation between surfaces using the mean radiation temperature concept and convection to the surrounding air.

The heat balance on the water loop is given by

<div>$$q = \dot mc{}_p(T{}_{wi} - T{}_{wo})$$</div>

Where

q = heat transferred between the water loop and the building elements.

<span>$\dot m$</span>= mass flow rate of water

<span>$T{}_{wi}$</span>= Inlet water temperature

<span>$T{}_{wo}$</span>= Outlet water temperature

From the second law of thermodynamics the maximum amount of heat transfer is

<div>$$q{}_{\max } = (\dot mc{}_p){}_{water}(T{}_{wi} - T{}_s)$$</div>

Where

T<sub>s</sub> = temperature at the source location

The effectiveness of the heat exchanger is given by

<div>$$\varepsilon  = 1 - {e^{ - NTU}}$$</div>

Where NTU is defined by

<div>$$NTU = \frac{{UA}}{{(\dot mC{}_p){}_{water}}}$$</div>

<div>$$UA = h\pi DL$$</div>

h is the convection coefficient, D is the interior tube diameter and L is the total length of the tube.

The Colburn equation is used to define the Nusselt number Nu

<div>$$Nu = \frac{{hD}}{k} = 0.023{\mathop{\rm Re}\nolimits} {{}_D^{4/5}}{\Pr ^{1/3}}$$</div>

Pr is the Prandtl number, Re is the Reynolds number and k is the thermal conductivity of the fluid

<div>$${\mathop{\rm Re}\nolimits} {}_D = \frac{{4\dot m}}{{\pi \mu D}}$$</div>

with <span>$\mu $</span> being the absolute viscosity of water

### Plant Loop Fluid-to-Fluid Heat Exchanger

This component (Object: HeatExchanger:FluidToFluid) is a simple hydronic heat exchanger that can be used to couple two (hydronic) plant or condenser loops.  Sizing and nominal capacity calculations are discussed elsewhere in this document, see the section called Plant Heat Exchanger Sizing. This section first discusses the heat transfer modeling and the control issues.

Heat exchanger performance modeling uses classic effectiveness-NTU correlations. The heat exchanger model can be specified as one of seven types:  cross flow both fluid streams unmixed, cross flow both fluid streams mixed, cross flow maximum capacity flow mixed min), counter flow, parallel flow, or ideal. The model correlations determine a heat transfer effectiveness value, <span>$\varepsilon $</span>, which is a function of heat exchanger UA, the mass flow rates through boths sides, and the specific heat of the fluids in the streams.  The effectiveness of an ideal heat exchanger is set to 1.0 and no correlation is needed.

Because the heat exchanger is intended to be generic, its two sides are distinguished by the nature of loop side being connected.  One side is called “Loop Supply Side” to indicate the heat exchanger is situated on the supply side of a loop. The other side is called “Loop Demand Side” to indicate it is on the demand side of a loop.  The heat exchanger is intended to act as a supply component for the loop connected to it as the “Loop Supply Side” and as a demand component for the loop connected to it as the “Loop Demand Side.”  From the point of view of the heat exchanger component itself, the Loop Demand Side acts like a supply source/sink for the Loop Supply Side which acts like a demand to the component.

The mass flow rates and specific heat capacity are multiplied together to evaluate flow thermal capacity for each side and the minimum, maximum, and capacity ratio, <span>${R_C}$</span>, are determined.

<div>$${\left( {\dot m{c_p}} \right)_{SupLoop}} = {\dot m_{SupLoop}}*{c_p}_{SupLoop}$$</div>

<div>$${\left( {\dot m{c_p}} \right)_{DmdLoop}} = {\dot m_{DmdLoop}}*{c_p}_{DmdLoop}$$</div>

<div>$${\left( {\dot m{c_p}} \right)_{Min}} = MIN\left( {{{\left( {\dot m{c_p}} \right)}_{SupLoop}},{{\left( {\dot m{c_p}} \right)}_{DmdLoop}}} \right)$$</div>

<div>$${\left( {\dot m{c_p}} \right)_{Max}} = MAX\left( {{{\left( {\dot m{c_p}} \right)}_{SupLoop}},{{\left( {\dot m{c_p}} \right)}_{DmdLoop}}} \right)$$</div>

<div>$${R_C} = \frac{{{{\left( {\dot m{c_p}} \right)}_{Min}}}}{{{{\left( {\dot m{c_p}} \right)}_{Max}}}}$$</div>

NTU, or Number of Transfer Units, is calculated using:

<div>$$NTU = \frac{{UA}}{{{{\left( {\dot m{c_p}} \right)}_{Min}}}}$$</div>

For a counter flow heat exchanger, effectiveness is calculated using:

<div>$$\varepsilon  = \frac{{1 - exp\left[ { - NTU\left( {1 - {R_C}} \right)} \right]}}{{1 - {R_C}exp\left[ { - NTU\left( {1 - Rc} \right)} \right]}}$$</div>

For a parallel flow heat exchanger, effectiveness is calculated using:

<div>$$\varepsilon  = \frac{{1 - exp\left[ { - NTU\left( {1 + {R_C}} \right)} \right]}}{{\left( {1 + {R_C}} \right)}}$$</div>

For a cross flow heat exchanger with both streams unmixed, effectiveness is calculated using:

<div>$$\varepsilon  = 1 - exp\left\{ {\frac{{NT{U^{0.22}}}}{{{R_C}}}\left[ {exp\left( { - {R_C}NT{U^{0.78}}} \right) - 1} \right]} \right\}$$</div>

For a cross flow heat exchanger with both streams mixed, the effectiveness is calculated using:

<div>$$\varepsilon  = {\left[ {\frac{1}{{1 - exp\left( { - NTU} \right)}} + \frac{{{R_C}}}{{1 - exp\left( { - {R_C}NTU} \right)}} - \frac{1}{{NTU}}} \right]^{ - 1}}$$</div>

For a cross flow heat exchanger with the stream with the higher capacity mixed and the stream with the lower capacity unmixed, the effectiveness is calculated using:

<div>$$\varepsilon  = \frac{1}{{{R_C}}}\left\{ {1 - exp\left[ {{R_C}\left( {exp\left( { - NTU} \right) - 1} \right)} \right]} \right\}$$</div>

For a cross flow heat exchanger with the stream with higher capacity unmixed and the stream with lower capacity mixed, the effectiveness is calculated using:

<div>$$\varepsilon  = 1 - exp\left\{ { - \frac{1}{{{R_C}}}\left[ {1 - exp\left( { - {R_C}NTU} \right)} \right]} \right\}$$</div>

Effectiveness values are always limited to be no higher than 1.0.  The program code protects from evaluating the exponential with operands that are too large or too small. Once the effectiveness value is determined, the heat transfer rate is calculated using:

<div>$$\dot Q = \varepsilon {\left( {\dot m{c_p}} \right)_{Min}}\left( {{T_{SupLoop,In}} - {T_{DmdLoop,In}}} \right)$$</div>

Lastly, the fluid temperatures leaving the heat exchanger are calculated using:

<div>$${T_{SupLoop,Out}} = {T_{SupLoop,In}} - \frac{{\dot Q}}{{{{\left( {\dot m{c_p}} \right)}_{SupLoop}}}}$$</div>

<div>$${T_{DmdLoop,Out}} = {T_{DmdLoop,In}} + \frac{{\dot Q}}{{{{\left( {\dot m{c_p}} \right)}_{DmdLoop}}}}$$</div>

The plant heat exchanger offers a number of control options for a wide variety of applications.  This section documents the control decision logic. The general goal of the control is to provide appropriate conditioning of the fluid at the Loop Supply Side connection.  The basic control action is to request the appropriate flow rates for each side of the heat exchanger.  For all of the control modes, there is also an availability schedule that provides a level of supervisory control to determine if the heat exchange is available to run at all.  If the device is scheduled off, then zero flow is requested for both connections. All the control modes can also use minimum and maximum temperature limits.  If the limits are used and either of the two inlet temperatures exceeds the limit, the zero flow is requested for both connections.

**UncontrolledOn. ** This control type is very simple.  If scheduled on it requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

**OperationSchemeModulated. ** This control type uses the plant operation schemes. Any of the various plant (or condenser) operation schemes (e.g. PlantEquipmentOperation:CoolingLoad or PlantEquipmentOperation:HeatingLoad ). When the heat exchanger is called, the operation scheme will pass a value for the load to be met.  If the absolute value of the load is less than a small tolerance (1 W), then zero flow is requested for both connections.  If load is significant and negative, then the heat exchanger will attempt to provide cooling.  If the load is significant and positive, then it will attempt to provide heating.  The two inlet fluid temperatures are compared and if their difference exceeds the minimum temperature difference and has the correct sign for heating or cooling as needed, then the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then a flow rate for the Loop Demand Side is found to attempt to meet the load.  The load value is converted to a target temperature for the fluid leaving the Loop Supply Side connection.  The target temperature is then used with the numerical method Regula Falsi to solve for the flow rate.

**OperationSchemeOnOff**.  This control type uses the plant operation schemes. Any of the various plant (or condenser) operation schemes (e.g. PlantEquipmentOperation:CoolingLoad or PlantEquipmentOperation:HeatingLoad). When the heat exchanger is called, the operation scheme will pass a value for the load to be met.  If the absolute value of the load is less than a small tolerance (1 W), then zero flow is requested for both connections.  If load is significant and negative, then the heat exchanger will attempt to provide cooling.  If the load is significant and positive, then it will attempt to provide heating.  The two inlet fluid temperatures are compared and if their difference exceeds the minimum temperature difference and has the correct sign for heating or cooling as is needed, then the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

**HeatingSetpointModulated**.  This control scheme uses a node setpoint. The two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible.  The temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if heating is desired.  If heating is both desired and possible, then the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then a flow rate for the Loop Demand Side is found to attempt to meet the setpoint.  The setpoint temperature is then used with the numerical method Regula Falsi to solve for the flow rate.

**HeatingSetpointOnOff**.  This control scheme uses a node setpoint. The two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible.  The temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if heating is desired.  If heating is both desired and possible, then the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

**CoolingSetpointModulated**.  This control scheme uses a node setpoint. The two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible.  The temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if cooling is desired.  If cooling is both desired and possible, then the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then a flow rate for the Loop Demand Side is found to attempt to meet the setpoint.  The setpoint temperature is then used with the numerical method Regula Falsi to solve for the flow rate.

**CoolingSetpointOnOff**.  This control scheme uses a node setpoint. The two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible.  The temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if cooling is desired.  If cooling is both desired and possible, then the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

**CoolingSetpointOnOffWithComponentOverride**.  This control scheme uses one of three different control signals, a node setpoint, outdoor air drybulb temperature, or outdoor air wetbulb temperature. The two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible.  The control signal is compared to the inlet temperature for the Loop Supply Side to see if cooling is desired.  If cooling is both desired and possible, then the heat exchanger is turned “on.”  When the heat exchanger is on, the remote chiller component is turned off.  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

**CoolingDifferentialOnOff**.  This control scheme is based on a simple temperature difference. The two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible.  If cooling is possible then it is assumed to be desired and the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

**DualDeadbandSetpointModulated**.  This control scheme uses dual setpoints on a node. The basic idea is that the heat exchanger will condition the Loop Supply Side connection to drive its temperature into the deadband whenever its inlet temperature is outside the deadband.  The model expects dual temperature setpoints to be placed on the setpoint, for example using the object SetpointManager:Scheduled:DualSetpoint.

The heat exchanger will operate to cool the Loop Supply Side fluid when the following three conditions are all met:

1)  the two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible,

2) the higher temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible, and

3)  the higher temperature setpoint on the reference node is compared to the inlet temperature for the Loop Demand Side to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible.

The heat exchanger will operate to heat the Loop Supply Side fluid when the following three conditions are all met:

1)  the two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible,

2)  the lower temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible, and

3) the lower temperature setpoint on the reference node is compared to the inlet temperature for the Loop Demand Side to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible.

When the heat exchanger is turned “on.”  The model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then a flow rate for the Loop Demand Side is found to attempt to meet the setpoint.  The setpoint temperature is then used with the numerical method Regula Falsi to solve for the flow rate.

**DualDeadbandSetpointOnOff**. This control scheme uses dual setpoints on a node. The basic idea is that the heat exchanger will condition the Loop Supply Side connection to drive its temperature into the deadband whenever its inlet temperature is outside the deadband.  The model expects dual temperature setpoints to be placed on the setpoint, for example using the object SetpointManager:Scheduled:DualSetpoint.

The heat exchanger will operate to cool the Loop Supply Side fluid when the following three conditions are all met:

1)  the two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible,

2) the higher temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible, and

3)  the higher temperature setpoint on the reference node is compared to the inlet temperature for the Loop Demand Side to see if their difference exceeds the minimum temperature difference and has the correct sign for cooling to be possible.

The heat exchanger will operate to heat the Loop Supply Side fluid when the following three conditions are all met:

1)  the two inlet fluid temperatures are compared to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible,

2)  the lower temperature setpoint on the reference node is compared to the inlet temperature for the Loop Supply Side to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible, and

3) the lower temperature setpoint on the reference node is compared to the inlet temperature for the Loop Demand Side to see if their difference exceeds the minimum temperature difference and has the correct sign for heating to be possible.

When the heat exchanger is turned “on,” the model requests the full design flow rate on the Loop Supply Side connection.  If the Loop Supply Side flow rate exceeds a small tolerance, then the full design flow rate is requested for the Loop Demand Side connection.

### References

Strand, R.K. and C.O. Pedersen, 1997.  Implementation of a Radiant Heating and Cooling Model Into an Integrated Building Energy Analysis Program, ASHRAE Transactions v. 103, n. 1, pp 949-958, 1997.

Incropera, F.P. and D.P. DeWitt. 1981. Fundamentals of Heat Transfer. New York: John Wiley & Sons.

Mills, A.F.1999. Heat Transfer, Second Edition. Prentice Hall. New Jersey.

Presentation by Taylor Engineering.

Air System Humidifiers <a name="Humidifiers"></a>
----------------------

### Overview

Air system humidifiers are components that add moisture to the supply air stream. They fall into 2 broad categories: spray type humidifiers which act like direct evaporative coolers, cooling the supply air as well as humidifying it; and dry steam humidifiers, which humidify the supply air stream while causing almost no change to the supply air stream temperature. The EnergyPlus electric and gas fired steam humidifier uses electrical energy and thermal energy, respectively, to convert ordinary tap water to steam which it then injects into the supply air stream by means of a blower fan. The actual electric dry steam unit might be an electrode-type humidifier or a resistance-type humidifier.

### Electric and Gas Steam Humidifier

The electric and gas steam humidifier models (object names: Humidifier:Steam:Electric and Humidifier:Steam:Gas) are based on moisture and enthalpy balance equations plus standard psychrometric relationships. The approach is similar to that taken in the ASHRAE HVAC 2 Toolkit, page 4-112 (ASHRAE 1993). EnergyPlus contains its own module of psychrometric routines; the psychrometric theory and relations are given in the 2001 edition of ASHRAE Fundamentals, Chapter 6 (ASHRAE 2001). The model contains both an ideal controller and the component. The control model assumes that there is a minimum humidity setpoint on the component air outlet node. This setpoint is established by a setpoint manager described elsewhere.

#### Model

The component model is a forward model: its inputs are its inlet conditions; its outputs are its outlet conditions and its energy consumption. The inputs are the temperature, humidity ratio, and mass flow rate of the inlet air stream, which are known; and the water addition rate (kg/s) which is determined by the controller.  The moisture mass balance and psychometric calculations are identical for both gas and electric dry steam humidifiers.  The only difference is how a heat source (electric or gas) is used to generate the steam.

#### Controller

The controller first decides whether the humidifier is on or off. For the humidifier to be on:

* the humidifier schedule value must be nonzero;

* the inlet air mass flow must be greater than zero;

* the inlet air humidity ratio must be less than the minimum humidity ratio setpoint.

If the humidifier is off, the water addition rate is set to zero. If the humidifier is on, the water addition rate needed to meet the humidity setpoint is calculated.

<div>$${\dot m_a} \cdot {w_{in}} + {\dot m_{w,add,needed}} = {\dot m_a} \cdot {w_{set}}$$</div>

where

<span>${\dot m_a}$</span> = the air mass flow rate [kg/s]

<span>${w_{in}}$</span>= the inlet air humidity ratio [kg/kg]

<span>${\dot m_{w,add,needed}}$</span> = water addition rate needed to meet the setpoint [kg/s]

<span>${w_{set}}$</span>= the humidity ratio setpoint [kg/kg]

Equation is the moisture balance equation for the component. It is solved for <span>${\dot m_{w,add,needed}}$</span> (the other variables are known) which is passed to the humidifier component model as its desired inlet water addition rate.

#### Component

The inputs to the component model are the air inlet conditions and mass flow rate and the water addition rate set by the controller. The outputs are the air outlet conditions. First the desired water addition rate is checked against component capacity.

<div>$${\dot m_{w,add,needed,{\rm{max}}}} = Min({\dot m_{w,add}},Ca{p_{nom}})$$</div>

where

<span>$Ca{p_{nom}}$</span> = the humidifier nominal capacity [kg/s], a user input.

If <span>${\dot m_{w,add,needed,{\rm{max}}}}$</span> is zero, the outlet conditions are set to the inlet conditions and the water addition rate is set to zero. If the humidifier is scheduled on the component power consumption is set to the standby power consumption: <span>${W_{hum}} = {W_{stby}}$</span>. Otherwise <span>${W_{hum}}$</span> = 0.

If <span>${\dot m_{w,add,needed,{\rm{max}}}}$</span> &gt; 0, then the moisture and enthalpy balance equations

<div>$${\dot m_a} \cdot {w_{in}} + {\dot m_w} = {\dot m_a} \cdot {w_{out}}$$</div>

<div>$${\dot m_a} \cdot {h_{in}} + {\dot m_w} \cdot {h_w} = {\dot m_a} \cdot {h_{out}}$$</div>

with <span>${\dot m_w}$</span> set equal to <span>${\dot m_{w,add,needed,{\rm{max}}}}$</span> are solved for <span>${w_{out}}$</span> and <span>${h_{out}}$</span>. Here

<span>${\dot m_a}$</span> = the air mass flow rate [kg/s]

<span>${w_{in}}$</span>= the inlet air humidity ratio [kg/kg]

<span>${\dot m_w}$</span> = the inlet water addition rate [kg/s]

<span>${w_{out}}$</span> = the outlet air humidity ratio [kg/kg]

<span>${h_{in}}$</span> = the inlet air specific enthalpy [J/kg]

<span>${h_w}$</span> = the steam specific enthalpy = 2676125.  [J/kg] at 100 <sup>o</sup>C

<span>${h_{out}}$</span> = the outlet air specific enthalpy [J/kg]

The outlet temperature is obtained from

<div>$${T_{out}} = PsyHFnTdbW({h_{out}},{w_{out}})$$</div>

where

<span>${T_{out}}$</span> = outlet air temperature [<sup>o</sup>C],

<span>$PsyHFnTdbW({h_{out}},{w_{out}})$</span> is an EnergyPlus psychrometric function.

The humidity ratio at saturation at the outlet temperature is

<div>$${w_{out,sat}} = PsyWFnTdbRhPb({T_{out}},1.0,{P_{atmo}})$$</div>

where

<span>${P_{atmo}}$</span> = the barometric pressure [Pa],

1.0 is the relative humidity at saturation,

<span>$PsyWFnTdbRhPb$</span> is an EnergyPlus psychrometric function.

IF <span>${w_{out}} \le {w_{out,sat}}$</span> then the outlet condition is below the saturation curve and the desired moisture addition rate can be met. <span>${\dot m_{w,add}}$</span> is set to <span>${\dot m_{w,add,needed,{\rm{max}}}}$</span> and the calculation of outlet conditions is done. But if <span>${w_{out}} > {w_{out,sat}}$</span> then it is assumed that this condition will be detected and the steam addition rate throttled back to bring the outlet conditions back to the saturation condition. We need to find the point where the line drawn between state 1 (inlet) and state 2 (our desired outlet) crosses the saturation curve. This will be the new outlet condition. Rather than iterate to obtain this point, we find it approximately by solving for the point where 2 lines cross: the first drawn from state 1 to state 2, the second from <span>${T_1}$</span>, <span>${w_{1,sat}}$</span> to <span>${T_2}$</span>, <span>${w_{2,sat}}$</span>; where

<span>${w_{1,sat}}$</span> is the inlet temperature [<sup>o</sup>C],

<span>${w_{2,sat}}$</span> is the humidity ratio at saturation at temperature <span>${w_{1,sat}}$</span> [kg/kg],

<span>${T_2}$</span> is the desired outlet temperature [<sup>o</sup>C],

<span>${w_{2,sat}}$</span> is the humidity ratio at saturation at temperature <span>${T_2}$</span> [kg/kg].

The 2 lines are given by the equations:

<div>$$w = {w_1} + (({w_2} - {w_1})/({T_2} - {T_1})) \cdot (T - {T_1})$$</div>

<div>$$w = {w_{1,sat}} + (({w_{2,sat}} - {w_{1,sat}})/({T_2} - {T_1})) \cdot (T - {T_1})$$</div>

Solving for the point (state 3) where the lines cross:

<div>$${w_3} = {w_1} + (({w_2} - {w_1}) \cdot ({w_{1,sat}} - {w_1}))/({w_2} - {w_{2,sat}} + {w_{1,sat}} - {w_1})$$</div>

<div>$${T_3} = {T_1} + ({w_3} - {w_1}) \cdot (({T_2} - {T_1})/({w_2} - {w_1}))$$</div>

This point isn't quite on the saturation curve since we made a linear approximation of the curve, but the temperature should be very close to the correct outlet temperature. We will use this temperature as the outlet temperature and move to the saturation curve for the outlet humidity and enthalpy. Thus we set <span>${T_{out}}$</span> = <span>${T_3}$</span> and

<div>$${w_{out}} = PsyWFnTdbRhPb({T_{out}},1.0,{P_{atmo}})$$</div>

<div>$${h_{out}} = PsyHFnTdbW({T_{out}},{w_{out}})$$</div>

where <span>$PsyHFnTdbW$</span> is an EnergyPlus psychrometric function. The water addition rate is set to

<div>$${\dot m_{w,add}} = {\dot m_a} \cdot ({w_{out}} - {w_{in}})$$</div>

We now have the outlet conditions and the adjusted steam addition rate for the case where the desired outlet humidity results in an outlet state above the saturation curve.  The energy consumption of the electric and gas steam humidifiers is calculated separately.

The electric steam humidifier electric consumption is given by

<div>$${W_{hum}} = ({\dot m_{w,add}}/Ca{p_{nom}}) \cdot {W_{nom}} + {W_{fan}} + {W_{stby}}$$</div>

where

<span>${W_{fan}}$</span> = nominal fan power [W], a user input,

<span>${W_{stby}}$</span> = standby power [W], a user input.

The gas steam humidifier performance calculation is done for fixed and variable entering water temperature. The calculation procedure for fixed and variable entering water temperature are as follows.

#### Fixed Inlet WaterTemperature:

The gas steam humidifier gas consumption rate for fixed entering water temperature is given by:

<div>$$\dot{Q}_{NG} = \frac{\dot{m}_{w,add}}{\dot{m}_{cap,nom}}Q_{NG,nom}$$</div>

The actual gas use rate accounting for gas fired humidifier thermal efficiency variation with part load ratio is given by: 

<div>$$ Q_{NG}=\dot{Q}_{NG}\frac{\eta_{rated}}{\eta_{actual}} $$</div>

<div>$$ \eta_{actual} = \eta_{rated} \times \rm{EffModCurveValue}\left(PLR\right) $$</div>

<div>$$ \rm{PLR} = \frac{\dot{Q}_{NG}}{Q_{NG,nom}} $$</div>

where,
EffModCurveValue = thermal efficiency modifier curve value as function of part load ratio. This curve is generated from manufacturer’s part load performance data. 
PLR = part load ratio, (-).
Q_NG_nom = nominal or rated gas use rate, (Watts).
Q_NG = actual gas use rate, (Watts).
eta_rated = nominal or rated thermal efficiency of gas fired steam humidifier, (-)
eta_actual = actual thermal efficiency of gas fired steam humidifier accounting for part load performance, (-). 

#### Variable Inlet WaterTemperature: 

The gas use rate is determined from the theoretical gas input rate and actual thermal efficiency. The actual thermal efficiency is the rated thermal efficiency corrected for part load ratio operation. At steady state the gas use rate is given by:

<div>$$ Q_{NG}=\frac{\dot{m}_w \left(h_{fg}+c_{p,w}\left(100-T_{w,inlet}\right)\right)}{\eta_{rated}} $$</div>

<div>$$ \rm{PLR} = \frac{\dot{Q}_{NG}}{Q_{NG,nom}} $$</div>
 
<div>$$ \eta_{actual} = \eta_{rated} \times \rm{EffModCurveValue}\left(PLR\right) $$</div>
 
<div>$$ Q_{NG}=\dot{Q}_{NG}\frac{\eta_{rated}}{\eta_{actual}} $$</div> 

where,
T_w_inlet = temperature of water entering the gas steam humidifier, °C. This value depends on the water source.  

If the rated gas use rated input field is not autosized, then user specified thermal efficiency will be overriden with a value calculated from user specified rated gas use rate, nominal  capacity (m3/s) and design conditions as follows:

<div>$$ \eta_{rated}=\frac{\dot{V}_{cap,nom} \rho_w \left(h_{fg}+c_{p,w}\Delta T_w}{Q_{NG,nom}} $$</div>

The gas steam humidifier requires electric power input to the blower fan and associated control units.  The auxiliary electric power input rate of the gas steam humidifier is given by:

<div>$$W_{aux} = W_{fan} + W_{controls}$$</div>
 
where
W_fan = nominal fan power [W], a user input,
W_controls = control electric power [W], a user input.

The water consumption rate is, in m3/s, for electric and steam humidifier at a reference temperature of 5.05 C is given by.

<div>$${\dot V_{cons}} = {\dot m_{w,add}}/{\rho_w}$$</div>

where

<span>${\dot V_{cons}}$</span> = the water consumption rate [m<sup>3</sup>],

<span>${\rho_w}$</span> = water density (998.2 kg/m<sup>3</sup>).

#### References

ASHRAE. 1993. HVAC 2 Toolkit: A Toolkit for Secondary HVAC System Energy Calculations. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2001. 2001 ASHRAE Handbook Fundamentals. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.


Zone Internal Gains <a name="ZoneGains"></a>
-------------------

### Sources and Types of Gains

Internal heat gains from lights, people, and equipment of various types are often significant elements in the zone thermal balance.  EnergyPlus allows the user to specify heat gains for several equipment types including people, lights, gas/electric equipment, and several other types.  The total heat gain is comprised of convective, radiant and latent gains in various proportions from these sources.  Convective gains are instantaneous additions of heat to the zone air.  Radiant gains are distributed on the surfaces of the zone, where they are first absorbed and then released back into the room (with some fraction conducted through the surface) according to the surface heat balances. {See Surface Heat Balance Manager / Processes in this document}.  Latent gains must be handled by ventilation or air conditioning equipment.  Recommended heat gains are given by ASHRAE [1].  These recommendations include the sensible (convective plus radiative) and latent proportions.  Sensible gains from equipment are primarily radiant.  The user can specify the heat gains and proportions for any type of equipment.  Determining the gains from lights, people and baseboard heat are slightly more complicated.

### Heat Gain from Lights

The input object Lights provides a model for internal gains from lights.  Radiant gains from lights must be handled differently from other radiant gains for reasons described here (long wavelength description).  The total radiant gains from lights must be divided into visible and thermal portions.  For example, the total electric input to typical incandescent lights is converted to 10% visible radiation, 80% thermal radiation, and 10% convective gain.  In contrast, the electric input to typical fluorescent lights is converted to 20% visible radiation, 20% thermal radiation, and 60% convective gain [2].  These percentage splits are under user control with the Lights input object.

### Heat Gain from People

The input object People provides a model for internal gains from occupants.  Heat is generated in the human body by oxidation at a rate called the metabolic rate (see Thermal Comfort discussion for more details).  This heat is dissipated from the body surface and respiratory tract by a combination of radiation, convection, and evaporation.  The relative proportions of sensible (radiation plus convection) and latent (evaporation) heat from people is a complex function of the metabolic rate and the environmental conditions.  EnergyPlus uses a polynomial function to divide the total metabolic heat gain into sensible and latent portions.  That function is based on a fit to data [3] at average adjusted metabolic rates of 350, 400, 450, 500, 750, 850, 1000 and 1450 Btu/h each at temperatures of 70, 75, 78, 80, 82 degrees Fahrenheit.  Sensible gains of 0 at 96 F and sensible gains equal to the metabolic rate at 30 F were assumed in order to give reasonable values beyond the reported temperature range.

Average adjusted metabolic rate [3] is the metabolic rate to be applied to a mixed group of people with a typical percent composition based on the following factors:

Metabolic rate, adult female=Metabolic rate, adult male X 0.85

Metabolic rate, children = Metabolic rate, adult male X 0.75

The original data was in I-P (Inch-Pound) units, but the following correlation is in SI (Systems-International) units.

<div>$$\begin{array}{c}S = 6.461927 + .946892\cdot M + .0000255737\cdot {M^2}\\ + 7.139322\cdot T - .0627909\cdot T\cdot M + .0000589172\cdot T\cdot {M^2}\\ - .198550\cdot {T^2} + .000940018\cdot {T^2}\cdot M - .00000149532\cdot {T^2}\cdot {M^2}\end{array}$$</div>

where

M=Metabolic Rate (W)

T=Air Temperature (C)

S=Sensible Gain (W)

Latent Gain is simply the total gain (metabolic rate) – sensible gain:

<div>$$LatentGain = MetabolicRate - SensibleGain$$</div>

![](EngineeringReference/media/image5820.png)

Figure 259.  Sensible Heat Gain from People Correlation

The function for sensible gain calculation is compared to the original data points in the following figure.  The radiant fraction of the sensible gain is a user input on the People object.

### Heat Gain from IT Equipment

The input object ElectricEquipment:ITE:AirCooled describes air-cooled electric information technology equipment (ITE) which has variable power consumption as a function of loading and temperature. The calculations are described below.

#### Variable Definitions – User Inputs:

* PDesign = Design power input when fully loaded and entering air temperature is at the user-specified design inlet temperature [W]
* PFanFracDesign = Design fan power input fraction of total power input when fully loaded and entering air temperature is at the user-specified design inlet temperature
* SchDesignLevel = Scheduled fraction of this equipment which is powered up
* SchCPULoading = Scheduled fraction of CPU loading
* TAirInDesign = Air inlet temperature at design condition [C]
* VAirDesign = Air volume flow rate at design condition [m3/s]
* VAirfLoadTAir = Air volume flow rate modifier function of TAirIn and SchCPULoading
* PCPUfLoadTAir = CPU power input modifier function of TAirIn and SchCPULoading
* PFanfFlowFrac = Fan power input modifier function of air flow fraction
* RecircFracDesign = Recirculation Fraction at design condition [C]
* RecircfLoadTAir = Recirculation Fraction modifier function of TAirSupply and SchCPULoading
* UPSEfficDesign = Design electric power supply efficiency
* UPSEfficfPLR = Electric power supply efficiency function of part load ratio
* UPSLossFracToZone = Fraction of electric power supply losses to zone
 
#### Variable Definitions – Simulation Inputs:

* TAirIn = Air inlet temperature at current conditions [C]
* TAirSupply = Supply air node temperature at current conditions [C]
* TZone = Zone air temperature at current conditions [C]
* TRoomAirNodeIn = Room air model inlet node air temperature at current conditions [C]
* RhoAir = Air density [kg/m3]
* CpAir = Air specific heat [J/kg-K]
 
#### Variable Definitions – Intermediate Calculations:

* PCPUDesign = Design CPU power input when fully loaded and entering air temperature is at the user-specified design inlet temperature [W]
* PFanDesign = Design fan power input when fully loaded and entering air temperature is at the user-specified design inlet temperature [W]
* UPSPLR = Electric power supply part load ratio (can be greater than 1.0)
 
#### Variable Definitions – Outputs:

* PCPU = CPU power input [W]
* PFan = Fan power input [W]
* PUPS = Electric power supply net power input [W]
* TAirOut = Air outlet temperature [C]
* VAir = Air volume flow rate [m3/s]
* FlowFrac = Air volume flow rate fraction of design flow rate
* RecircFrac = Recirculation fraction
* QAir = Air cooling rate [W]
* QUPS = Electric power supply heat loss rate to zone [W]
* QConv = Convective heat gain rate to zone heat balance [W]
* SHI = Supply heat index
* SHIZone = Zone average supply heat index
 
#### Calculations

The design power input is first split into portions for the CPU (everything in the equipment except the cooling fans) and the fan(s).

PCPUDesign = PDesign * (1 - PFanFracDesign)
 
PFanDesign = PDesign * PFanFracDesign
 
For each time step, the air inlet temperature is calculated depending on the type of air node connection.
 
TAirIn:

* If Air Node Connection Type = AdjustedSupply
    * RecircFrac = RecircFracDesign * RecircfLoadTAir(SchCPULoading TAirSupply)
    * TAirIn = TAirSupply * (1 – RecircFrac) +TAirZone * RecircFrac
 
* If Air Node Connection Type = ZoneAirNode
    * TAirIn = TAirZone
 
* If Air Node Connection Type = RoomAirModel
    * TAirIn = TRoomAirNodeIn
 
Using the air inlet temperature, the CPU power consumption, air flow rate, fan power consumption, and power supply power consumption are calculated.
 
PCPU = PCPUDesign * SchDesignLevel * PfLoadTAir(SchCPULoading, TAirIn)
 
FlowFrac = VAirfLoadTAir(SchCPULoading, TAirIn)
 
VAir = VAirDesign * FlowFrac
 
PFan = PFanDesign * SchDesignLevel * PFanfFlowFrac(FlowFrac)
 
UPSPLR = (PCPU + PFan) / (PCPUDesign + PFanDesign)
 
PUPS = (PCPU + PFan) * (1 - UPSEfficDesign * UPSEfficfPLR (UPSPLR))
 
The convective heat gain to the zone and the air outlet temperature are then calculated. The user specified fration of power supply losses are always added to the general zone heat balace convective heat gain. For air node connection types AdjustedSupply and ZoneAirNode, the CPU and fan power consumption are also added to the zone convective heat gain. For air connection type RoomAirModel, the gains from the CPU and fan power consumption are added to the outlet room air model node.
 
QAir = PCPU + PFan
 
QUPS = PUPS * UPSLossFracToZone
 
QConv:

* If Air Node Connection Type = AdjustedSupply OR ZoneAirNode
    * QConv = QAir + QUPS
 
* If Air Node Connection Type = RoomAirModel
    * QConv = QUPS
 
TAirOut = TAirIn + QAir / (VAir * RhoAir * CpAir)
 
The individual ITE supply heat index is calculated as shown below.
 
SHI = (TAirIn – TAirSupply) / (TAirOut - TAirSupply)
 
The zone average ITE supply heat index is weighted by the air flow rate of each ITE object.
 
SHIZone = ∑ [VAir * (TAirIn – TAirSupply)] / ∑ [VAir * (TAirOut - TAirSupply)]

### Heat Gain from Baseboard Heat

The input object ZoneBaseboard:OutdoorTemperatureControlled provides a model for an outdoor temperature controlled baseboard heater that adds energy to the zone according a control profile as shown in the following figure.  At TA = T2, the baseboard heat gain is Q2.  For TA &gt; T2, there is no heat gain.  For TA &lt; T1, a maximum amount of energy, Q1, is added to the zone.  There is proportional control between those two temperatures:

![](EngineeringReference/media/image5821.png)

Figure 260.  Control of Outdoor Temperature Controlled Baseboard Heat

<div>$$Q = Q2 - \frac{{(Q2 - Q1)\cdot (T2 - TA)}}{{(T2 - T1)}}$$</div>

These temperature and capacity fields can be autosized based upon envelope, infiltration, and ventilation loads. To autosize these fields, users may set a design zone heating temperature that is assumed to be 20°C if blank.

The capacity at low temperature is the maximum capacity of the unit. It includes external envelope conduction load, infiltration load, and ventilation load in a space where the unit serves. The model first finds the lowest outdoor air temperature throughout design days included in the simulation, and determines the conduction load through external envelop as:

<div>$${q_{Cond}} = UA\left( {{T_{Htg}} - {T_L}} \right)$$</div>

where

*q<sub>Cond</sub>* is conduction load through external envelope, W

*U* is heat transfer coefficient of external wall, W/m<sup>2</sup>K

*A* is area of external wall, m<sup>2</sup>

*T<sub>Htg</sub>* is baseboard zone heating setpoint temperature, °C

*T<sub>L</sub>* is low temperature, °C



The capacity at low temperature that is the maximum capacity of the unit is thus expressed as:

<div>$$Ca{p_{{T_L}}} = {q_{Cond}} + {q_I} + {q_V}$$</div>

where

<span>$Ca{p_{{T_L}}}$</span>is capacity at low temperature, W

*q<sub>I</sub>* is design infiltration sensible load, W

*q<sub>V</sub>* = design ventilation sensible load, W



The capacity at high temperature is then prorated against the reference low and high temperatures as:

<div>$$Ca{p_{{T_H}}} = Ca{p_{{T_L}}}\frac{{\left( {{T_{Htg}} - {T_H}} \right)}}{{\left( {{T_{Htg}} - {T_L}} \right)}}$$</div>

where

<span>$Ca{p_{{T_H}}}$</span> is capacity at high temperature, W

*T<sub>H</sub>* is high temperature, °C



### Distribution of Radiant Gains

It is useful to consider the distribution of short wavelength (including visible) radiant energy separate from long wavelength (thermal) radiant energy because many materials have different optical properties at different wavelengths.  An extreme example is glass that is opaque to the long wavelengths and transparent to the short.  Properties of materials vary across the entire spectrum of wavelengths.  In EnergyPlus, all radiant interactions are represented in terms of only two wavelengths: “short” and “long”.  Short wavelength refers to the distribution given by a ~6000K black body source such as the sun.  Long wavelengths refer to radiation from ~300K sources such as walls or people.  There is negligible overlap between these two distributions.  Some sources, such as lights, must be considered as emitting both long and short wavelength radiation in proportions that approximate their actual effects on room surfaces.

Long wavelength radiation from all internal sources, such as people, lights and equipment, is combined and then distributed over surfaces. (see Internal Long-Wave Radiation Exchange).

Some fraction of the beam solar radiation transmitted into the zone is directly absorbed by the interior surfaces according to the solar distribution algorithm (see Solar Distribution) selected by the user.  The beam radiation not directly absorbed, plus the diffuse sky and ground-reflected radiation, plus the short wavelength radiation from lights are combined and distributed over the surfaces of the zone according to:

<div>$$QS{I_i} = Q{S_n}\cdot {\alpha_i}/\sum\limits_{i = 1}^{NS} {{S_i}\cdot (1 - {\rho_i})} $$</div>

If all surfaces in the room are opaque, the radiation is distributed in proportion to the area\*absorptance product of each surface.  For surfaces which are transparent,

<div>$${\rho_i} = 1 - {\alpha_i} - {\tau_i}$$</div>

That fraction of radiation represented by <span>${\tau_i}$</span> is lost from the zone.

The transmittance and absorptance of transparent surfaces (windows or glass doors) are calculated as in section Window Calculation Module based on the optical properties of the window material layers.  The total absorptance of the window is computed for the interior shading device, the inside surface, and the outside surface for diffuse solar radiation incident from outside the zone.  Those absorptances are used for short wavelength radiation incident from inside the zone.  In most cases, this should not cause significant error.  When movable insulation covers the window, the radiation that would have been transmitted is absorbed at the outer surface of the window (thermally equal to the inside surface of the insulation).

### References

ASHRAE. 2001. Handbook of Fundamentals, pp 29.8-29.13, Atlanta: ASHRAE.

Carrier Air Conditioning Company. 1965a. Handbook of Air Conditioning System Design, pp 1-99 to 1-100. New York: McGraw Hill.

Carrier Air Conditioning Company. 1965b. Handbook of Air Conditioning System Design, pp 1-100, Table # 48. New York: McGraw Hill.

Indoor Swimming Pool <a name="IndoorSwimmingPool"></a>
-----

The modeling of the indoor swimming pool is integrated into the surface heat balance procedures already in EnergyPlus with special modifications for radiation between the pool water surface and the surrounding of the space, convection to the surrounding air, evaporation of water, conduction to the pool bottom, and solar radiation absorbed in the pool water, the pool heating system, the presence of a cover, etc.  Effectively, the pool water mass is “added” to or lumped into the inside face of the surface to which the pool is “linked”.  Conduction through the floor uses the standard CTF formulation, however the heat balance is modified to include other terms specific to the pool water.

Some assumptions of the model are given below, followed by more details of individual components of the model.

* The pool water is lumped together at the inside face of a surface and follows the standard EnergyPlus heat balance methodology with some modifications based on the pool model details described in this section.
* The pool itself must reference a surface that is specifically defined as a floor and it covers the entire floor to which it is linked.
* The pool cannot by part of a low temperature radiant system (meaning that the construction of the floor cannot have any embedded pipes for heating or cooling).  In addition, the floor/pool cannot be defined with any movable insulation or be defined as a ventilated slab.
* The pool/floor surface must use the standard CTF solution algorithm.
* The pool may be covered and the fraction covered is defined by user input.  This value may vary from 0.0 to 1.0.
* The pool cover has an impact on evaporation, convection, short-wavelength radiation, and long-wavelength radiation.  Each of these has a separate user input that reduces the heat transfer parameter from the maximum achieved with a cover.  While the cover percentage is allowed to vary via a user schedule input, each individual parameter for these four heat transfer modes is a fixed constant.  For evaporation and convection, the factors simply reduce the amount of heat transfer proportionally.  For the radiation terms, the factors reduce the amount of radiation that impacts the surface (pool) directly.  The remaining radiation is assumed to be convected off of the pool cover to the zone air.
* Pool water heating is achieved by defining the pool as a component on the demand side of a plant loop.
* Makeup water replaces any evaporation of water from the pool surface and the user has control over the temperature of the makeup water.
* The pool is controlled to a particular temperature defined by user input.
* Evaporation of water from the pool is added to the zone moisture balance and affects the zone humidity ratio.
* The pool depth is small in comparison to its surface area.  Thus, heat transfer through the pool walls is neglected.  This is in keeping with the standard assumption of one-dimensional heat transfer through surfaces in EnergyPlus.

### Energy Balance of Indoor Swimming Pool

Heat losses from indoor swimming pools occur by a variety of mechanisms. Sensible heat transfer by convection, latent heat loss associated with evaporation, and net radiative heat exchange with the surrounding occur at the pool surface. Conductive heat losses take place through the bottom of the pool.  Other heat gains/losses are associated with the pool water heating system, the replacement of evaporated water with makeup water The energy balance of the indoor swimming pool estimates the heat gains/losses occurring due to:

* convection from the pool water surface
* evaporation from the pool water surface
* radiation from the pool water surface
* conduction to bottom of pool
* fresh pool water supply
* pool water heating by the plant
* changes in the pool water temperature

Detailed methods for estimating these heat losses and gains of the indoor swimming pools are described in the subsections below.

### Convection from the pool water surface

The convection between the pool water and the zone are defined using:

<div>$$Q_{conv} = h \cdot A \cdot (T_p – T_a)$$</div>

<div>$$h = 0.22 \cdot (T_p – T_a)1/3$$</div>

where

$Q_{conv}$ = Convective heat transfer rate (Btu/h·ft2)

$h$ = Convection heat transfer coefficient (Btu/h· ft2·⁰F)

$T_p$ = Pool water temperature (⁰F)

$T_a$ = Air temperature over pool (⁰F)

When a cover is present, the cover and the cover convection factor reduce the heat transfer coefficient proportionally.  For example, if the pool is half covered and the pool cover reduces convection by 50%, the convective heat transfer coefficient is reduced by 25% from the value calculated using the above equation.

### Evaporation from the pool water surface 

There are 5 main variables used to calculate the evaporation rate ($Q_{evap}$):

* Pool water surface area 
* Pool water temperature
* Room air temperature
* Room air relative humidity
* Pool water agitation and Activity Factor

<div>$$\dot{m}_{evap} = 0.1 \cdot A \cdot AF \cdot (P_w – P_{dp})$$</div>

where

$\dot{m}_{evap}$ = Evaporation Rate of pool water (lb/h)

$A$ = Surface area of pool water (ft²)

$AF$ = Activity factor

$P_w$ = Saturation vapor pressure at surface of pool water (in. Hg)

$P_{dp}$ = Partial vapor pressure at room air dew point (in. Hg)

Typical Activity Factor (AF)

<table class="table table-striped">

<tr>
<th>Type of Pool</th><th>Activity Factor (AF)</th>
</tr>
<tr>
<td>Recreational</td><td>0.5</td>
</tr>
<tr>
<td>Physical Therapy</td><td>0.65</td>
</tr>
<tr>
<td>Competition</td><td>0.65</td>
</tr>
<tr>
<td>Diving</td><td>0.65</td>
</tr>
<tr>
<td>Elderly Swimmers</td><td>0.5</td>
</tr>
<tr>
<td>Hotel</td><td>0.8</td>
</tr>
<tr>
<td>Whirlpool, Spa</td><td>1.0</td>
</tr>
<tr>
<td>Condominium</td><td>0.65</td>
</tr>
<tr>
<td>Fitness Club</td><td>0.65</td>
</tr>
<tr>
<td>Public, Schools</td><td>1.0</td>
</tr>
<tr>
<td>Wave Pool, Water Slides</td><td>1.5 – 2.0</td>
</tr>

</table>

When a cover is present, the cover and the cover evaporation factor reduce the amount of evaporation proportionally.  For example, if the pool is half covered and the pool cover reduces convection by 50%, the convective heat transfer coefficient is reduced by 25% from the value calculated using the above equation.
The value is converted to a latent gain (loss) through multiplication of the evaporation rate by the heat of vaporization of water.

### Radiation exchange with the pool water surface 

This uses the EnergyPlus internal short- and long-wavelength radiation balances already in place.  When a cover is present, it acts to reduce the amount of radiation that arrives at the pool water surface in comparison to the no cover case.  Any reduction in either type of radiation is accounted for by adding a convective gain/loss to the zone air.  So, in effect, the cover absorbs some radiation and then convects it to the zone air.

### Conduction through the bottom of the pool

The model ignores 2-d effects of pool walls and assume that pool depth is much less than the pool area. Conduction is calculated using the Conduction Transfer Function (CTF) equation with the outside temperature determined by the outside heat balance and the inside surface temperature calculated using the pool water heat balance that is lumped together with the inside surface heat balance.

### Makeup pool water supply

<div>$$Q_{fw} = m_{fw} \cdot cw \cdot (T_p – T_{fw})$$</div>

where

$m_{fw}$ = Mass flow rate

$c_w$ = Specific heat of water 

$T_p$ = Pool water temperature

$T_{fw}$ = Fresh water supply temperature

### Heat Gain from People

The input for the swimming pool requires that the user enter the maximum number of people in the pool, a schedule modifying the maximum number of people for different pool occupancies, and a heat gain per person schedule for differing activities.  These three parameters allow for the calculation of a total heat gain from () ̇during a given time.  It is assumed that all of the heat gain from people is via convection to the pool water.

### Heat from auxiliary pool heater

<div>$$Q_{fw} = m_{hw} \cdot c_w \cdot (T_p – T_{hw})$$</div>

where

$m_{hw}$ = Mass flow rate (lb·s)

$c_w$ = Specific heat of water (Btu/lb·⁰F)

$T_p$ = Pool water temperature (⁰F)

$T_{hw}$ = Heated water supply temperature (⁰F)

### Pool Heating to Control the Pool Water Temperature

The equation used to determine the flow rate request of hot water from the plant is an extremely simplified version of the pool heat balance.  This is because the mass of the pool is so much larger than any of the other heat flows.  As a result, for the sake of establishing a heated water flow rate, the following equation is used:

<div>$$\frac{m_w c_p}{\Delta t} (T_{set}-T_{old}) = \dot{m}_p \cdot c_p \cdot (T_{in} - T_{set} )$$</div>

where

$m_w$ = mass of pool water

$cp$ = specific heat of water

$\Delta t$ = time step length

$T_{set}$ = desired pool water temperature

$T_{old}$ = temperature of water at the last time step

$m_p$ = needed mass flow rate of water from the plant

$T_{in}$ = inlet water temperature from the plant

This equation is rearranged to solve for the needed mass flow rate of water from the plant since all of the other terms are known or given based on user input.  This establishes a flow request to the plant and is capped at the maximum value defined in input by the user.

### Pool/Surface Heat Balance Equation Summary

The following equation is the basis for the pool/surface heat balance.  As has been mentioned previously, the pool water is “merged” with the inside surface heat balance which is essentially the same thing as lumping the entire water of the pool in the inside surface heat balance.

<div>$$\frac{m_w \cdot c_p}{\Delta t} (T_{set} - T_{old}) = Q_{cond} + Q_{conv} + Q_{lwrad} + Q_{swrad} + Q_{damp} + Q_{muw} + Q_{heater} + Q_{evap}$$</div>

where

$\frac{m_w \cdot c_p}{\Delta t} (T_{set} - T_{old} )$ = the change in energy stored in the pool water

$Q_{cond}$ = net conduction to/from the pool water to the floor

$Q_{conv}$ = net convection between the pool water and the zone air

$Q_{lwrad}$ = net long-wavelength radiation between the pool water/floor and the surrounding surfaces as well as from internal heat gains

$Q_{swrad}$ = net short-wavelength radiation to the pool water/floor from solar and internal heat gains

$Q_{damp}$ = standard damping term used in the inside heat balance to avoid large swings in the radiation balance that sometimes cause instability in the solution (see the standard heat balance information for more details)

$Q_{muw}$ = net gain/loss from replacing water evaporated from the pool with makeup water

$Q_{heater}$ = net heat added to the pool via the plant loop (controlled to maintain a setpoint temperature as described above)

$Q_{evap}$ = net heat loss due to evaporation of pool water to the zone air

Details on each of these terms was either provided in previous parts of this section or in the standard EnergyPlus heat balance discussion elsewhere in the Engineering Reference.

### Other additional information

The following subsections are some useful information that those wishing to model a swimming pool in EnergyPlus might find helpful.  Further information can be found on-line or in reputable sources such as the ASHRAE Handbooks.

### Swimming Pool Flow Rate

The flow rate of the circulating pump is designed to turn over (circulate) the entire volume of water in the pool in 6 to 8 hours, or 3 or 4 times in 24 hours. About 1 or 2 percent of the pumped circulation rate should be provided as continuous makeup water demand to overcome losses from evaporation, bleed-off, and spillage. To fill the pool initially, a separate quick-fill line should be provided to do the job in 8 to 16 hours; however, filling is usually done at off-peak hours. Thus, the demand flow rate need not be considered in the system demand calculations, unless it out-weighs the demand of all other demands even during the off-peak hours.

### Comfort and Health

Indoor pools are normally maintained between 50 and 60% RH for two reasons:

* Swimmers leaving the water feel chilly at lower relative humidity due to evaporation off the body
* It is considerably more expensive (and unnecessary) to maintain 40% RH instead of 50% RH

### Air Delivery Rates (Indoor Pool)

Most codes require a minimum of 6 ACH, except where mechanical cooling is used. This rate may prove inadequate for some occupancy and use. Where mechanical dehumidification is provided, air delivery rates should be established to maintain appropriate conditions of temperature and humidity. The following rates are typically desired:

* Pools with no spectator areas, 4 ~ 6 ACH
* Spectator areas, 6 ~ 8 ACH
* Therapeutic pools, 4 ~ 6 ACH

Typical Swimming Pool Design Conditions

<table class="table table-striped">
<tr>
<th>Type of Pool</th><th>Air Temperature, ⁰C</th><th>Water Temperature, ⁰C</th>
</tr>
<tr>
<td>Recreational</td><td>24-30</td><td>24-30</td>
</tr>
<tr>
<td>Physical Therapy</td><td>26-30</td><td>30-32</td>
</tr>
<tr>
<td>Competition</td><td>26-29</td><td>24-28</td>
</tr>
<tr>
<td>Diving</td><td>27-29</td><td>27-32</td>
</tr>
<tr>
<td>Elderly Swimmers</td><td>29-32</td><td>29-32</td>
</tr>
<tr>
<td>Hotel</td><td>28-29</td><td>28-30</td>
</tr>
<tr>
<td>Whirlpool / Spa</td><td>27-29</td><td>36-40</td>
</tr>
</table>


### References

ASHRAE (2011). 2011 ASHRAE Handbook – HVAC Applications. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc., p.5.6-5.9.

Janis, R. and W. Tao (2005). Mechanical and Electrical Systems in Buildings. 3rd ed. Upper Saddle River, NJ: Pearson Education, Inc., p.246.

Kittler, R. (1989). Indoor Natatorium Design and Energy Recycling. ASHRAE Transactions 95(1), p.521-526.

Smith, C., R. Jones, and G. Löf (1993). Energy Requirements and Potential Savings for Heated Indoor Swimming Pools. ASHRAE Transactions 99(2), p.864-874.


Pipes <a name="Pipes"></a>
-----

### Heat Transfer Pipes (Objects: Pipe:Indoor & Pipe:Outdoor)

#### Heat Loss and Time Delay in Pipes

The effects of heat loss and time delay in plant loop pipes exposed to air (Pipe:Indoor and Pipe:Outdoor) can be modeled explicitly in EnergyPlus. Users can select the environment with which the pipe transfers heat. Currently users have three options: ‘OutdoorAir’, ‘Zone’ and ‘Schedule’. Simulation for each of the environments is similar except the way in which the heat transfer between the pipe outer wall and the surrounding environment is calculated. When using the ‘OutdoorAir’ option, the current outdoor dry-bulb temperature and wind velocity from the weather file (or design day input) are used. When the environment is specified as ‘Zone’, the mean air temperature and room air velocity of the corresponding zone are used.

In the case of a pipe in a zone, the heat loss or gain is accounted for in the pipe heat transfer calculation and is also included in the zone air heat balance calculations. When the environment is specified as ‘Schedule’, the user specifies a temperature and velocity schedule which will be used to calculate the heat transfer.

Pipe heat transfer in EnergyPlus is simulated by discretizing the pipe length into a number of nodes (20) and is an implementation of the model by Hanby et al. (2002). A control volume drawn around a node in the pipe is shown in Figure 261. Three nodes are defined at each discrete section of the pipe and represent the fluid, pipe wall and external environment. The fluid and pipe have defined thermal capacitance (mass). The insulation around the pipe is currently modeled as steady-state (no thermal mass), and so the effect of this resistance is accounted for within the h<sub>f</sub> term in the following description.  For the fluid, there is one-dimensional flow from each upstream node.

![PipeDelay](EngineeringReference/media/image5831.png)

Figure 261. Control Volume drawn around node *i*

The model is formulated from the heat balances on the fluid and wall nodes.

<div>$${M_{f,i}}{C_{P,f}}\frac{{d{T_{f,i}}}}{{dt}} = \dot m{C_{P,f}}\left( {{T_{f,i - 1}} - {T_{f,i}}} \right) - {h_f}{A_i}\left( {{T_{f,i}} - {T_{w,i}}} \right)$$</div>

<div>$${M_{w,i}}{C_{P,w}}\frac{{d{T_{w,i}}}}{{dt}} = {h_f}{A_i}\left( {{T_{f,i}} - {T_{w,i}}} \right) - {h_e}{A_i}\left( {{T_{w,i}} - {T_e}} \right)$$</div>

Where, subscript *w*, *f* and *e* denote the values for pipe wall, fluid and environment respectively. The current node is represented by a subscript of *i*, while the previous node is represented by *i-1*.

<span>$M$</span> = Mass

<span>${C_p}$</span> = Specific Heat

<span>$\dot m$</span> = Mass flow rate of fluid in pipe

<span>$T$</span>  = Temperature

<span>$A$</span>  =  Heat Transfer Area

<span>$h$</span>  = Film convective resistance

<span>$t$</span>   = time

The exterior film convective resistance is calculated based on either wind speed, room air velocity, or a scheduled value based on the type of pipe heat transfer object. However, when the velocity gets too low, natural convection must be modeled. This is handled within the program by having a lower limit on the Nusselt number. For natural convection from a horizontal cylinder, a constant Nusselt number is assumed based on information from Spang (referenced below). This Nusselt number is 0.36. The Nusselt number used in calculating the exterior convection coefficient (Incropera and Dewitt 1996) is the maximum of the Nusselt number from the forced convection coefficient correlation and this natural convection Nusselt number (0.36).

In addition, the exterior resistance from the pipe wall inner surface to the environment will include resistance values for the pipe wall itself and any insulation specified around the pipe. This is treated as steady state value, so the simulation results are not affected by a change in insulation specific heat. However, the resistance is calculated based on thermal conductivity and thickness (using radial coordinate system), so the simulation results will vary with material conductivity changes. Again, this resistance is added in series with the exterior surface film convective resistance such that h<sub>f</sub> contains film and insulation resistance.

Approximating the derivatives using backward differencing enables these equations to be represented as simultaneous algebraic equations. For the fluid, at time step n, the heat balance is:

<div>$$\frac{{{M_{f,i}}{C_{P,f}}}}{{\Delta t}}\left( {T_{f,i}^n - T_{f,i}^{n - 1}} \right) = \dot m{C_{P,f}}\left( {T_{f,i - 1}^n - T_{f,i}^n} \right) - {h_f}{A_i}\left( {T_{f,i}^n - T_{w,i}^n} \right)$$</div>

Rearranging gives,

<div>$$T_{f,i}^n\left[ {{M_{f,i}}{C_{P,f}} + \dot m{C_{P,f}}\Delta t + {h_f}{A_i}\Delta t} \right] = \dot m{C_{P,f}}\Delta tT_{f,i - 1}^n + {h_f}{A_i}\Delta tT_{w,i}^n + {M_{f,i}}{C_{P,f}}T_{f,i}^{n - 1}$$</div>

or,

<div>$${a_1}T_{f,i}^n = {a_2}T_{f,i - 1}^n + {a_3}T_{w,i}^n + {a_4}T_{f,i}^{n - 1}$$</div>

where,

<div>$$\begin{array}{l}{a_1} = {M_{f,i}}{C_{P,f}} + \dot m{C_{P,f}}\Delta t + {h_f}{A_i}\Delta t\\ {a_2} = \dot m{C_{P,f}}\Delta t\\ {a_3} = {h_f}{A_i}\Delta t\\ {a_4} = {M_{f,i}}{C_{P,f}}\end{array}$$</div>

Similarly, taking backwards differences for the conduit wall at time step n, the heat balance becomes,

<div>$$\frac{{{M_{w,i}}{C_{P,w}}}}{{\Delta t}}\left( {T_{w,i}^n - T_{w,i}^{n - 1}} \right) = {h_f}{A_i}\left( {T_{f,i}^n - T_{w,i}^n} \right) - {h_e}{A_i}\left( {T_{w,i}^n - T_e^n} \right)$$</div>

Rearranging gives,

<div>$$T_{w,i}^n\left[ {{M_{w,i}}{C_{P,w}} + {h_f}{A_i}\Delta t + {h_e}{A_i}\Delta t} \right] = {h_f}{A_i}\Delta tT_{f,i}^n + {h_e}{A_i}\Delta tT_e^n + {M_{w,i}}{C_{P,w}}T_{w,i}^{n - 1}$$</div>

or,

<div>$${b_1}T_{w,i}^n = {b_2}T_{f,i}^n + {b_3}T_{e,i}^n + {b_4}T_{w,i}^{n - 1}$$</div>

where,

<div>$$\begin{array}{l}{b_1} = {M_{w,i}}{C_{P,w}} + {h_f}{A_i}\Delta t + {h_e}{A_i}\Delta t\\ {b_2} = {h_f}{A_i}\Delta t\\ {b_3} = {h_e}{A_o}\Delta t\\ {b_4} = {M_{w,i}}{C_{P,w}}\end{array}$$</div>

Substituting into gives an equation for the current fluid temperature:

<div>$${a_1}T_{f,i}^n = {a_2}T_{f,i - 1}^n + {a_3}\left( {{b_2}T_{f,i}^n + {b_3}T_{e,i}^n + {b_4}T_{w,i}^{n - 1}} \right)/{b_1} + {a_4}T_{f,i}^{n - 1}$$</div>

<div>$$T_{f,i}^n = \frac{1}{{\left( {{a_1} - {a_3}{b_2}/{b_1}} \right)}}\left[ {{a_2}T_{f,i - 1}^n + {a_3}\left( {{b_3}T_{e,i}^n + {b_4}T_{w,i}^{n - 1}} \right)/{b_1} + {a_4}T_{f,i}^{n - 1}} \right]$$</div>

The conduit is simulated by solving Eq. followed by Eq. for each of the twenty cells in the model and incrementing the time step. The fluid temperature of the last node is taken to be the pipe outlet temperature.

#### References

Hanby, V.I., Wright, J.A., Fletcher, D.W and Jones, D.N.T. 2002. Modeling the Dynamic Response of Conduits. International Journal of HVACR&R, Vol.8, No.1. pp. 1-12.

Incropera, F.P. and Dewitt, D.P. 1996. Fundamentals of Heat Transfer, 4th Edition, pp. 369-370.

Spang, Bernhard. Correlations for Convective Heat Transfer. Chemical Engineers’ Resource Page:

### Underground Pipe (Object: Pipe:Underground)

#### Description of Model

The buried pipe model in EnergyPlus is similar to the other pipe heat transfer objects (i.e., Pipe:Indoor and Pipe:Outdoor) except for the way in which the pipe boundary condition is developed. For a buried pipe the ground between the pipe and the surface must be modeled. For a shallow buried pipe, the GroundHeatExchanger:Surface object may be used, which uses modified conduction transfer functions to model the ground. However, beyond a certain thickness, the transfer function method fails, and EnergyPlus will respond with a fatal error due to convergence problems. Therefore, when a pipe is buried deeper than about one meter, this new buried pipe model should be used. When the pipe is buried shallower than one meter, either model may be used. Due to the finite difference nature of the Pipe:Underground model, the GroundHeatExchanger:Surface may be slightly faster and therefore more desirable.

The buried model develops a grid around the pipe. The grid was based originally on a model by Piechowski (1999), and still carries the model nomenclature. The grid extends from the ground surface down to a calculated distance below the pipe. The domain extends sideways from the symmetric center of the pipe to a calculated distance from the pipe. The grid stretches along the full length of the pipe. At each cross section, transient 2D Cartesian finite difference equations are used, updating each node except the node centered on the pipe. Axial heat transfer is not modeled in the soil. The large view of the outer Cartesian grid system is shown in Figure 262.

![](EngineeringReference/media/image5851.png)

Figure 262. Pipe:Underground Outer Finite Difference Grid

When the model encounters the pipe node, the existing model for Pipe:Interior and Pipe:Exterior pipes is used. The finite difference temperatures neighboring the pipe, grid spacing and soil properties are used to create an average boundary temperature for the pipe along with a conductance value. With a boundary temperature available and a conductance value mimicking the convection coefficient, the simulation continues exactly as with the other pipe heat transfer objects. To avoid redundancy, see the Pipe:Indoor or Pipe:Outdoor objects for a detailed description of the pipe model.

#### Boundary Conditions

The boundary conditions for this model include a symmetric vertical boundary centered on the pipe, the ground surface, a ‘far-field’, and a ‘deep ground’. The ground surface boundary uses current simulation outdoor dry-bulb temperature, and the user-entered convection coefficient. The ‘far-field’ and ‘deep ground’ use a correlation by Kusuda and Achenbach (1965). This correlation requires surface temperature data. Either the Site:GroundTemperature:Shallow object must be given, or the three optional ground surface temperature inputs must be given.

Currently, the model is set up to be exposed to open soil above the pipe. If the user intends on simulating this buried pipe under a foundation slab, the effects can be approximating by use of the basement/slab heat transfer preprocessor program. This program takes in general building information, and performs a simulation which generates ground temperatures. Typically these effects are used to generate boundary conditions for the floor zone, but they may also be used in generating the ground surface temperatures for this pipe model. The data from the slab program will be monthly temperatures, so the user can use these as a surface ground temperature object which provides boundary data to the Pipe:Underground model.

#### Geometry

The model develops the pipe depth and ground thickness from the user-entered construction information. The soil, pipe wall, and optional pipe insulation are entered as materials (with inherent thicknesses). The soil is entered as a standalone material, while the pipe insulation (if applicable) and the pipe wall should be given as a construction containing one or two materials. With knowledge of each individual thickness, the pipe geometry is obtained. The pipe length and inside diameter are the only additional geometry inputs.

#### Model Assumptions

n Constant properties throughout domain

n Moisture is not directly involved with the model operation, so careful selection of soil thermal conductivity is a priority

n Negligible axial heat transfer compared to radial heat transfer

n Axisymmetric heat transfer in near pipe region

n Surface convection coefficient is constant throughout simulation (does not vary with wind speed)

#### References

Kusuda, T. & Achenbach, P. 1965. ‘Earth Temperature and Thermal Diffusivity at Selected Stations in the United States’, ASHRAE Transactions Vol. 71, Part 1, pp. 61–75.

Piechowski, M. 1999. ‘Heat and Mass Transfer Model of a Ground Heat Exchanger: Theoretical Development’, Energy Research 23 (7), pp. 571–588.

### PipingSystem:Underground Simulation

In order to simulate diverse underground piping systems, a generalized model has been implemented which allows placement of pipes in a solid medium (soil).  The model simulates circuiting effects of multiple pipes by allowing fluid to flow in the pipes in different directions.  The model also has the capability of simulating interaction with zone surfaces to account for things such as basement heat transfer in a foundation heat exchanger.  Different aspects of the modelling approach are described in this section which can assist the user in determining if this model is appropriate for a particular application, and determining input parameter values.

An alternative interface is implemented which provides a simpler set of inputs for simulating horizontal trench heat exchangers.  The key limitations of the simpler inputs include all piping in the domain being on a single circuit, all trenches equidistance apart, and each trench with the same burial depth.  If this is satisfactory for an application, the GroundHeatExchanger:HorizontalTrench object is a suitable object.  The object uses the same underlying simulation algorithms and data structures as the detailed piping system model, but with a simpler set of input parameters.  For other cases and more detailed studies, the PipingSystem:Underground:\* objects provide full flexibility.

A dual-coordinate system finite volume heat transfer model of pipes buried in a conducting medium is employed.  The dual-coordinate system consists of a coarse Cartesian system in the conducting region (the soil, for example) with a refined radial system in the near-pipe region.  The pipes are connected as objects on the plant loop and are simulated as needed during loop convergence, while the ground itself is only simulated once per system time step.

#### Approach:

#### General Development and Solution Scheme

A new heat transfer model is implemented to handle a diverse set of buried pipe conditions.  The model uses a dual-coordinate system approach to solve a finite volume domain in a computationally efficient manner.  The main idea behind the dual coordinate system technique is to focus the computational effort to the region where it is most needed: near the pipe(s).  To this end, a coarse grid Cartesian coordinate system is used to solve the slow-moving ground heat transfer.  Then, within one of these cells, a radial coordinate system is configured around the pipe/insulation with a specialized interface cell between the systems.  Figure 263 shows an example of cells surrounding a pipe, including the radial region in the near-pipe cell, while Figure 264 shows a zoomed-in view of the near-pipe cell itself.

![](EngineeringReference/media/image5852.png)

Figure 263. Radial "near-pipe" cell within a Cartesian cell



![](EngineeringReference/media/image5853.png)

Figure 264. Close-up view of example radial cell

The ground heat transfer model can be set up in a fully-3D or quasi-3D manner.  In either case, there is a three-dimensional grid of Cartesian cells placed in the domain.  In fully-3D mode, the axial heat transfer is accounted for; in quasi-3D mode, the axial effects are ignored and the result is essentially a set of 2D slices along the length of the domain.  The determination of which method will be utilized in the final model shall be based upon final testing and on a balance between accuracy vs. computation time.  This option could be left to the end-user, but this will likely be unnecessary input overhead.

A fully implicit (and thus numerically stable) formulation is used to describe all cells, which means an iteration loop must be implemented.  In this solver, an outer iteration loop is used to bring the entire domain to convergence, while an inner iteration loop is used over all the radial cells.  This is intended to focus the computational effort even further.  The outer region may converge within one or two iterations, while the “near-pipe” cells may take much more iteration.  For this reason, it does not make sense to iterate over the entire domain a large number of times.

#### Boundary Conditions

The farfield boundary condition is defined by a Kusuda and Achenbach (1965) correlation, which requires annual ground surface temperature data.  As with the current Pipe:Underground model, the user will be able to enter the correlation parameters directly, or information from the monthly ground temperature input object will be used to infer the parameters.

The ground surface boundary condition is defined by an energy balance between the surrounding interior cells and the ground surface, including convection and radiation.  As with the Pipe:Underground object, the ground surface sun exposure may be an optional input to allow for a shaded ground surface.  In addition to the standard conduction, convection, and both short- and long-wave solar radiation at the surface, the ground surface boundary condition also includes the effects of evapotranspiration in the surface vegetation—the heat loss due to evaporation from soil to plant surface, and transpiration internal to the plant itself.  The evapotranspiration rate is calculated as a moisture loss by using the Walter et al. (2005) model, and translated into a heat loss by multiplication with the density and latent heat of evaporation of water.  The evapotranspiration rate is dependent on the type of vegetation at the surface; the user can vary the surface vegetation from anywhere between a concrete surface and a fairly tall grass (about 7”).

Based on the application, an adiabatic boundary condition will also be implemented and employed on particular surfaces of the domain.  For the case where a basement or under-slab region is present, for example, an adiabatic boundary will represent the vertical line of symmetry.

#### “Pipe Cell” Simulation

The ground is discretized into coarse Cartesian cells, some of which will contain a pipe.  These “pipe-cells” are further discretized into a radial system with a specialized interface cell to couple these systems.  The radial cells consist of a number of ground cells, with an optional insulation cell, then the pipe cell, followed by the fluid itself.

The fluid is modeled as a cylindrical cell interacting with incoming fluid and heat transfer to the pipe.  When there is no flow in the system, the cell essentially becomes radially adiabatic so that the fluid temperature will float during off periods.  It will not be equal to ground temperatures, unless it is off for a long time and the transient heat is allowed to dissipate.  When there is flow in the system, the incoming fluid and heat transfer from the pipe wall balance with the mass of the cell to come up with a new fluid temperature for that cell, to be passed downstream to the next cell.

The fluid within the cells is modeled directionally, so that the flow can be circuited through multiple pipe segments in different directions.  The flow direction in each pipe is specified by a choice field input.

#### Basement Interaction

The model can also interact with basement surfaces.  The interaction is split into two sections: floor surfaces and wall surfaces.  For each of these, the analysis is lumped, i.e., all walls are treated as one average wall surface and all floors are treated as one average floor surface.  The distance that the basement impinges within the domain is defined by a simple width and height specification.  The domain is then *cutaway* for that region.  Note that these distances then refer to the exterior surface of the wall or floor.

The ground heat transfer model does not perform any transient simulation of the basement surfaces.  The transient condition through these surfaces are left to the appropriate surface heat balance algorithms.  Instead, this model interacts directly at the outer boundary through the use of an *OtherSideConditions* model.  The ground heat transfer model will take the current exterior surface heat flux and use that as the boundary for neighboring cells.  Once convergence is achieved, the ground model will then effectively apply a constant surface temperature boundary condition by using a very high value of convection coefficient.  The surface heat balance algorithms will then pick this up during the next zone time step.

#### Mesh Development

The mesh is developed by using a few simple parameters.  There are two distinct categories, the large-scale Cartesian mesh and the near-pipe refined radial mesh.

n X, Y, Z mesh

n Mesh Layout

n Cell density

n Radial mesh

n Radial mesh thickness

n Cell count

The Cartesian mesh uses a cell density parameter to define the number of cells to use in the simulation.  Instead of requiring a detailed specification of all cell regions in the domain, this one parameter is used to specify a mesh density and is applied to all domain regions.  The cell density parameter represents the number of cells within any two domain partitions.  A domain partition is a basement wall or a pipe placed in the domain.  Once these partitions are all laid out and validated, the regions between them are populated with the number of cells specified in the cell density parameter.  Although this may lead to a variation of cell size within the domain, it is assumed that this will help focus computational intensity in the domain.  Of course, the number of cells (cell density parameter) can be different for each of the X, Y, and Z directions to allow for further fine tuning of the domain.

The Cartesian mesh is laid out in either a uniform or symmetric-geometric fashion.  In the former, the cells between any two domain partitions are equally sized.  In the latter, the cells are smaller near the partitions to again help fine-tuning computational intensity.  If the latter is selected, the amount of non-uniformity is specified by an additional parameter.

The radial coordinate system is always uniform for the soil cells, The two parameters to be specified for this region are the cell count (the number of soil cells to be generated outside of the pipe cell), and the radial mesh thickness (the radial distance from pipe outer wall to the cell boundary).  Each soil cell will then have a radial thickness equal to the radial mesh thickness divided by the cell count.

#### Simulation Methodology

The actual simulation of this model is performed in two parts: the ground simulation and the pipe cell simulation.

Since the ground is likely to be slow-moving and easily converging, it is simulated once per system time step.  This will simulate all the cells in the domain which do not contain a pipe segment.  The boundary conditions for this step are then the current surface conditions and farfield model along with the previous values for pipe cell temperature.  This small lag should provide suitable accuracy as the system time step will usually be smaller than the time constant of the pipe cell.  This decoupling leverages the core of the model development by again placing computational effort where it is needed most, near the pipes.

The ground simulation is performed once per time step, but the pipe cell simulation is performed at each call to the component.  Each pipe will be placed on a plant loop, but not necessarily on the same plant loop or loop side.  Thus, at each call to the object, that pipe will use the temperatures of the ground cells near the pipe as boundary conditions to simulate the “near-pipe” radial cells and fluid cell.  In this manner, the pipes will simulate numerous times following the convergence flow of the plant loop system.

#### References

Kusuda, T. & Achenbach, P. 1965. ‘Earth Temperature and Thermal Diffusivity at Selected Stations in the United States’, ASHRAE Transactions Vol. 71, Part 1, pp. 61–75.

Allen, R.G., Walter, I.A., Elliott, R.L., Howell, T.A., Itenfisu, D., Jensen, M.E., Snyder, R.L. 2005. The ASCE standardized reference evapotranspiration equation. Reston, VA:American Society of Civil Engineers. 59 p.



Pumps <a name="Pumps"></a>
-----

The water pump is quite simply the component that drives the flow in plant and condenser loops. How it reacts depends on several different conditions. In total, there are three different decision variables, two of which are defined by user input. These three deciding factors are whether the pump is constant or variable speed, whether the pump operation is continuous or intermittent, and whether or not there is a load on the loop. The pump is simulated first on the supply side loop after the demand side loop has determined what the demand on the loop will be. For further reference look at sections Pump Control for Plant and Condenser Loops, Plant/Condenser Supply Side, and Plant/Condenser Demand Side in the Plant Flow Resolver of this document.

### Summary of Pump Rules

n Pumps in Plant Loop can be on the supply side or demand side

n A Pump, if present, in the demand side of plant loop must be the first component of the inlet branch.

n Pumps in Condenser loop must be on supply side

n Pumps can operate as constant or variable flow.

n Pumps can run continuously or intermittently.

n Single boiler/chiller with NO bypass, use Pump:ConstantSpeed

n Boiler/chiller should be constant flow

n Pump should be intermittent

n Single boiler/chiller with NO bypass, Pump:VariableSpeed

n Boiler/chiller should be variable flow, regardless of whether pump is intermittent or continuous (runs at the minimum if demand is less than minimum, this includes zero.)

n Single boiler/chiller with bypass, Pump:ConstantSpeed

n Boiler/chiller can be constant or variable flow

n Pump may be intermittent or continuous as long as the bypass can handle the entire pump volume when the boiler is not operating

Multiple branches add more complexity, but it is nothing more than continuity. If the pump is putting out flow then it has to have a branch to flow down whether it is a chiller or a bypass. It can be safer to add the bypass for a simulation. If the active machines require the flow the bypass will be dry. If performing a pressure simulation, and the flow goes through a machine which is off, the pressure drop will be accounted for, but no heat transfer through the machine will be calculated.

If the user designates a pump that is operating continuously, the pump will run regardless of whether or not there is a load. This may have the net effect of adding heat to the loop if no equipment is turned on. If the pump operates intermittently, the pump will run at its capacity if a load is sensed and will shut off if there is no load on the loop. If the pump is scheduled, the schedule modifies the Rated Volumetric Flow Rate of the pump on a time basis. The default is that the pump is ON and runs according to its other operational requirements.

Shown below is the calculation of the total efficiency of the pump and the actual pumping efficiency when the motor efficiency is accounted for either the variable or constant volume pumps.

!  Total\_Efficiency % = Rated\_Volume\_Flow\_Rate \* Rated\_Pump\_Head / Rated\_Power\_Use

 TotalEffic =   PumpEquip(PumpNum)%NomVolFlowRate \*

                   PumpEquip(PumpNum)%NomPumpHead /

                     PumpEquip(PumpNum)%NomPowerUse



!     Calculated Pump\_Efficiency % =Total\_Efficiency % / Motor\_Efficiency %

      PumpEquip(PumpNum)%PumpEffic =  TotalEffic /

                   PumpEquip(PumpNum)%MotorEffic

### Dynamic Pump Pressure Head

There is an option when performing plant/condenser loop simulations to account for dynamically changing loop pressure drop. For the current implementation, the loop pressure drop is calculated based on pressure drop data on each branch of the loop, then this total pressure drop is set as the pump pressure head. There is no pump curve implemented yet, so it is assumed that the pump can always handle this pressure value. This is a first approximation to actually having the pump ride a curve, and this initial implementation allows the user to enter minimal data, and yet get a more dynamic output for pump power, which is calculated based on current pressure drop and flow rate. The equation for pump power is now:

<div>$$Pump\;Electric\;Power = Pump\;Volume\;Flow\;Rate*\frac{{Pump\;Head}}{{Total\;Efficiency}}$$</div>

Without the pressure simulation, the pump power is based on the rated value entered with the pump object. For further information, see the input-output reference for Branch objects, and PlantLoop/CondenserLoop objects; as well as the Plant/Condenser loop section of this engineering reference.

### Variable Speed Pump

A variable speed pump (object name: Pump:VariableSpeed) is defined with maximum and minimum flow rates that are the physical limits of the device. The pump will operate and select a flow somewhere between the minimum and maximum limits. In the case where the pump is running, the pump will try to meet the flow request made by demand side components.

All of the pump rules and efficiency and power calculations are applicable from the introduction in the pump group section. The main difference between the the variable volume pump and the constant volume pump is the Part Load Performance Curve.The fraction of full load power is determined by the cubic equation:

<div>$$FractionFullLoadPower = {C_1} + {C_2}PLR + {C_3}PL{R^2} + {C_4}PL{R^3}$$</div>

where C<sub>1</sub>,C<sub>2</sub>,C<sub>3</sub>,and C<sub>4</sub> are Coefficients 1 – 4 and PLR is the Part Load Ratio. In the pseudo code below the FracFullLoadPower modifies the NomPowerUse for the total pump “Power” and shows the “ShaftPower” and the “PumpHeattoFluid”.

VolFlowRate = PumpMassFlowRate / LoopDensity



  PartLoadRatio = VolFlowRate / PumpEquip(PumpNum)%NomVolFlowRate



  FracFullLoadPower =   PumpEquip(PumpNum)%PartLoadCoef(1)                     &

                      + PumpEquip(PumpNum)%PartLoadCoef(2) \* PartLoadRatio     &

                      + PumpEquip(PumpNum)%PartLoadCoef(3) \* PartLoadRatio\*\*2  &

                      + PumpEquip(PumpNum)%PartLoadCoef(4) \* PartLoadRatio\*\*3



  Power = FracFullLoadPower \* PumpEquip(PumpNum)%NomPowerUse



  ShaftPower = Power \* PumpEquip(PumpNum)%MotorEffic



! This adds the pump heat based on User input for the pump

! We assume that all of the heat ends up in the fluid eventually since this is a closed loop

!  PumpHeattoFluid = ShaftPower\*(1-PumpEquip(PumpNum)%PumpEffic)  &



  PumpHeattoFluid = ShaftPower + (Power - ShaftPower)\*PumpEquip(PumpNum)%FracMotorLossToFluid



  Node(OutletNode)%Temp = Node(InletNode)%Temp+PumpHeattoFluid/(PumpMassFlowRate \* LoopCp)



  PumpEquip(PumpNum)%Power = Power

### Pressure-based Flow for Variable Speed Pumps

With the introduction of pressure simulations in plant loops, the variable speed pump object now has the capability to model a more realistic variable speed operation. There are two operation modes which are introduced: differential pressure control is a widely used VFD control method while most VFDs also have a manual control mode in which the user determines the input frequency of the electric motor. The mode can be selected as ‘ManualControl’ or ‘PressureSetpointControl’ in the VFD Control Type input in Pump:VariableSpeed objects.

In manual VFD control mode the specified schedule will determine the current pump rotational speed throughout the simulation. This RPM value will be used to scale the pump curve which is entered by the user in non-dimensional form. Once the pump curve has been fixed then the successive substitution method will use this curve with the system curve to resolve the operating point. VFD manual control mode is implemented in EnergyPlus with the use of the RPM schedule input.

Differential pressure based control will maintain the differential pressure within the specified range. The pressure drop corresponding to the mass flow request will be calculated using the effective pressure constant of the system. This pressure drop will be checked against the pressure set point range. If the pressure drop is within the user specified range, then the mass flow rate will be checked against mass flow rates of operating points corresponding to maximum and minimum rotational speeds. Maximum and minimum differential pressure and rotational speeds are schedule inputs and can be entered as constant schedule.

The allowable mass flow rate range for the Differential pressure control is explained in the figure below:

![](EngineeringReference/media/image5856.png)

Figure 265. Allowable mass flow rate range for the Differential pressure control

### Constant Speed Pump

The operation of a constant speed pump (object name: Pump:ConstantSpeed) is fairly straightforward. The user designates a maximum flow rate and when this pumpo operates it will run at that capacity. The main difference between the constant speed pump and the variable speed pump is that the fraction of full load power is always = 1. In the pseudo code below the FracFullLoadPower is = 1.0, therefore the Power is always the full power.

VolFlowRate = PumpMassFlowRate / LoopDensity



  PartLoadRatio = VolFlowRate / PumpEquip(PumpNum)%NomVolFlowRate



  FracFullLoadPower = 1.0



  Power = FracFullLoadPower \* PumpEquip(PumpNum)%NomPowerUse



  ShaftPower = Power \* PumpEquip(PumpNum)%MotorEffic



! This adds the pump heat based on User input for the pump

! We assume that all of the heat ends up in the fluid eventually since this is a closed loop

!  PumpHeattoFluid = ShaftPower\*(1-PumpEquip(PumpNum)%PumpEffic)  &



  PumpHeattoFluid = ShaftPower + (Power - ShaftPower)\*PumpEquip(PumpNum)%FracMotorLossToFluid



  Node(OutletNode)%Temp = Node(InletNode)%Temp+PumpHeattoFluid/(PumpMassFlowRate \* LoopCp)



  PumpEquip(PumpNum)%Power = Power

### Pressure-based Flow for Constant Speed Pumps

The constant speed pump can flow can also be overridden dynamically based on a response to the plant loop pressure drop. In “single-loop-pump” simulations (no branch pumps, no common pipe), the user can enter a dimensionless pump curve on the Pump:ConstantSpeed (see I/O ref) object which represents the single speed pressure-flow relationship of the pump. In the process of determining the operating flow rate for the pump, the pump will check to see if a valid pressure simulation is being performed. If it is, a flow will be prescribed based on a resolution between system pressure characteristics and the pump pressure curve. This will cause the pump flow to be “unpredictable,” meaning that it will not always be a constant, expected value, which is basically what the constant speed pump gives you without the pressure simulation. There is more detail on the pressure based simulation in the Plant/Condenser loop sections of this documentation.

### Pump Heat Addition to the Loop

Due to the fact that a pump is a mechanical device that acts on the fluid it is circulating, it causes the fluid to increase in temperature. The EnergyPlus model assumes that all pressure increase caused by the pump will eventually be lost due to friction, and that friction will be added as heat to the fluid. Since the plant and condenser loops are not yet true pressure-based models, EnergyPlus assumes that all of the heat resulting from the pump itself and from friction throughout the loop. Therefore, as of version 7, the pump heat is added to the plant loop interface by injecting the heat into the mixed tanks used to model loop thermal capacitance(previously it was added at the outlet node of the pump). The amount of heat added to the fluid is calculated using the following two equations:

<div>$$ShaftPower = PumpPower * PumpMotorEfficiency$$</div>

<div>$$PumpHeatToFluid = ShaftPower + \left( {PumpPower - ShaftPower} \right) * FracMotorLossToFluid$$</div>

where the pump motor efficiency is defined by the user input and the FracMotorLossToFluid is the amount of heat generated by the pump motor that is added to the fluid loop (as opposed to being lost to the environment where the pump is located). FracMotorLossToFluid is also a user input.

Note that the shaft power relates to the increase in head through the pump. Since all of this head is lost through the piping network due to frictional heat, this represents a heat gain by the fluid throughout the network. For simplicity, this heat is added along with the heat resulting from the pump motor. The difference between the pump power and the shaft power is the inefficiency of the pump—or the amount of energy input into the pump that the motor converts to heat rather than mechanical energy. Some of this heat is added to the fluid being pumped. These two terms are shown in the PumpHeatToFluid equation shown above. As of version 7, this heat is added to the loop capacitance tank(s) rather than at the pump’s outlet and so the outlet temperatue is equal to the inlet temperaure.

### Pump Heat Addition to Surrounding Zone

If the user input includes naming a Zone that surrounds the pump, then the pump becomes a source of internal heat gain to that zone.  The amount of heat transmitted to the surrounding zone is simply the difference between power input and the rate of heat transferred to the fluid. The user can also input a fraction,<span>${f_{rad}}$</span> , that controls the overall split between thermal radiation and sensible convection.  The pump’s sensible zone gains are determined using the following equations:

<div>$$TotalZoneGain = PumpPower - PumpHeatToFluid$$</div>

<div>$$ConvectiveZoneGain = \left( {1 - {f_{rad}}} \right)*TotalZoneGain$$</div>

<div>$$RadiativeZoneGain = {f_{rad}}*TotalZoneGain$$</div>

### Headered Pumps

The input objects HeaderedPumps:ConstantSpeed and HeaderedPumps:VariableSpeed  provide models for headered pumps that consist of two or more pumps connected in parallel. The headered pump is simulated as a single component, and it is specified as an integer number of a specific pump. The flow rate provided by the headered pump is determined by the number of pumps in operation and the flow rate of the individual pump. The total flow rate is calculated as

<div>$$FlowProvided = NumPumpsON*IndividualPumpFlowRate$$</div>

The simulation starts by turning ON all pumps in the group. The pumps are then turned OFF one at a time until the flow provided is less than the flow requested. Finally the last pump is turned back ON to meet the remaining flow (FlowDifference) requested. The flow rate of the last pump depends on the pump bank type. For constant speed headered pumps, the last pump runs at the nominal flow rate, thereby giving a final headered pump flow which is equal to or greater than the flow requested. In a variable speed headered pump the last pump runs at part load so that the flow provided matches the flow requested. The power of the headered pump is then calculated as

<div>$$Power = (P{R_{FL}}{\rm{*N}}{}_{{\rm{FL}}} + {\rm{P}}{{\rm{R}}_{{\rm{PL}}}}{\rm{*}}{{\rm{N}}_{{\rm{PL}}}}{\rm{)*}}{{\rm{P}}_{{\rm{Nom}}}}{\rm{  }}$$</div>

Where;

*Power* = Power consumed by the pump bank

*PR<sub>FL</sub>* = Power ratio at full load (Generally equal to 1)

*N<sub>FL</sub>* = Number of pumps running at full load

*PR<sub>PL</sub>* = Power ratio at part load

*N<sub>PL</sub>* = Number of pumps running at part load

*P<sub>Nom</sub>* = Nominal power consumption of individual pumps

For a constant speed headered pump *N<sub>PL</sub>* is zero. For a variable speed headered pump *N<sub>PL</sub>* is equal to one.

### Condensate Pumps

The input object Pump:VariableSpeed:Condensate provides a model for steam condensate pumps, see the discussion for steam loops, reference: Condensate Pump.

Ideal Loads Air System <a name="IdealLoads"></a>
----------------------

### Overview

The input object ZoneHVAC:IdealLoadsAirSystem provides a model for an ideal HVAC system. It occupies a place in the program hierarchy corresponding to a zone HVAC unit. It is not connected to a central air system – instead each ZoneHVAC:IdealLoadsAirSystem object supplies cooling or heating air to a zone in sufficient quantity to meet the zone load or up to its limits, if specified. The supply air conditions are controlled based on specifications in the ZoneHVAC:IdealLoadsAirSystem input. The system has options for humidity control, outdoor air, economizer, demand controlled ventilation, and heat recovery.

### Model

The ZoneHVAC:IdealLoadsAirSystem object is modeled as an ideal VAV terminal unit with variable supply temperature and humidity. The supply air flow rate is varied between zero and the maximum in order to satisfy the zone heating or cooling load, zone humidity controls, outdoor air requirements, and other constraints, if specified.

#### Inputs and Data

The user specifies some or all of the following data for each ZoneHVAC:IdealLoadsAirSystem object:

·        name of unit availability schedule

·        name of the zone inlet node;

·        name of the zone exhaust node;

·        maximum supply air temperature when in heating mode *T<sub>max,heating</sub>* [C];

·        minimum supply air temperature when in cooling mode *T<sub>min,cooling</sub>* [C];

·        maximum supply air humidity ratio when in heating mode *W<sub>max,humid</sub>* [kg water/kg dry air];

·        minimum supply air humidity ratio when in cooling mode *W<sub>min,dehum</sub>* [kg water/kg dry air];

·        heating limit type flag (*LimitFlowRate, LimitCapacity, LimitFlowRateAndCapacity* or *NoLimit*) *HeatingLimit*;

·        maximum heating air flow rate  [m<sup>3</sup>/s]

·        maximum sensible heating capacity  [W]

·        cooling limit type flag (*LimitFlowRate, LimitCapacity, LimitFlowRateAndCapacity* or *NoLimit*) *CoolingLimit*

·        maximum cooling air flow rate  [m<sup>3</sup>/s]

·        maximum total cooling capacity  [W]

·        name of heating availability schedule

·        name of cooling availability schedule

·        dehumidification control type flag (*ConstantSensibleHeatRatio, Humidistat, None,* or *ConstantSupplyHumidityRatio*) *DehumidCtrlType*

·        cooling sensible heat ratio

·        humidification control type flag (*Humidistat, None,* or *ConstantSupplyHumidityRatio*) *HumidCtrlType*

·        name of a DesignSpecification:OutdoorAir object

·        outdoor air inlet node name

·        demand controlled ventilation control type flag (*None, OccupancySchedule or CO2Setpoint*)

·        outdoor air economizer type flag (*NoEconomizer, DifferentialDryBulb, or DifferentialEnthalpy*)

·        heat recovery type flag (*None, Sensible, or Enthalpy*)

·        sensible heat recovery effectiveness

·        latent heat recovery effectiveness

#### All input data for the ZoneHVAC:IdealLoadsAirSystem is stored in the array PurchAir. The model and data are encapsulated in the module PurchasedAirManager.Calculation

·        Set the unit on/off flag *UnitOn*.

The unit is off (*UnitOn* = *False*) if the unit availability schedule value is &lt;=0; otherwise the unit is on (*UnitOn* = *True*). If the unit is on, the calculation proceeds through the remaining steps. If the unit is off, the zone inlet node conditions are set to the zone node condition, the inlet node mass flow rate is set to zero, and the unit outputs are set to zero.

·        Calculate the minimum outdoor air mass flow rate based on the specifications in the DesignSpecification:OutdoorAir object, if specified.

·        Calculate the sensible and latent impact of the outdoor air flow relative to the zone conditions

·        Determine if the unit needs to heat or cool

o   If outdoor air sensible impact is &gt;= load to zone cooling setpoint and the current thermostat type is not SingleHeatingSetPoint, then unit is in cooling mode

o   If outdoor air sensible impact is &lt; load to zone heating setpoint then unit is in heating mode

o   Else if neither condition is true, then unit is in deadband mode (provides outdoor air but shuts off economizer and heat recovery and all humidity control options except *Humidistat* option)

·        If in cooling mode, simulate outdoor air economizer and adjust outdoor air mass flow rate

·        Calculate supply air mass flow rate

o   If outdoor air flow rate exceeds applicable maximum flow rate (heating or cooling) then reduce outdoor air mass flow rate, issue warning, and set supply air mass flow rate equal to outdoor air mass flow rate

Else

o   Calculate supply air mass flow rate required to meet zone sensible load at the applicable (heating or cooling) supply temperature limit (*T<sub>max,heating</sub>* or *T<sub>min,cooling</sub>*)

<div>$${\dot m_s} = {\dot Q_z}/({c_{p,air}}\cdot ({T_s} - {T_z}))$$</div>



o   If *DehumidCtrlType*= Humidistat (and other conditions are met, see below), then calculate the supply air mass flow rate required to meet the humidistat dehumidification setpoint at *W<sub>min,dehum</sub>*

o   If *HumidCtrlType*= Humidistat (and other conditions are met, see below), then calculate the supply air mass flow rate required to meet the humidistat humidification setpoint at *W<sub>max,humid</sub>*

o   Set the supply air mass flow rate to the greatest of these, but limit to the applicable (heating or cooling) maximum flow rate

·        Calculate the mixed air conditions, modeling heat recovery, if applicable

o   The recirculation air conditions are set equal to the zone return air node conditions; if there is no return air node the recirculation air conditions are set equal to the conditions at the zone node.

o   The unit entering conditions are then:

If <span>${\dot m_s}$</span>&gt; <span>${\dot m_{oa}}$</span> then

<div>$${h_{ma}} = ({\dot m_{oa}} \cdot {h_{oa}} + ({\dot m_s} - {\dot m_{oa}}) \cdot {h_{recirc}})/{\dot m_s}$$</div>

<div>$${W_{ma}} = ({\dot m_{oa}} \cdot {W_{oa}} + ({\dot m_s} - {\dot m_{oa}}) \cdot {W_{recirc}})/{\dot m_s}$$</div>

<div>$${T_{ma}} = {\mathop{\rm PsyHFnTdbW}\nolimits} ({h_{ma}},{W_{ma}})$$</div>

Otherwise the entering air conditions are set equal to the outside air conditions.

·        Calculate the supply air temperature required to meet the zone sensible load at the supply air mass flow rate, but limit to the applicable (heating or cooling) supply temperature limit (*T<sub>max,heating</sub>* or *T<sub>min,cooling</sub>*)

<div>$${T_s} = {T_{ma}} + {\dot Q_z}/({c_{p,air}}\cdot {\dot m_s})$$</div>

·        Calculate the supply humidity ratio based on the specified humidity control types, but limit to the applicable (heating or cooling) supply humidity ratio limit

o   *DehumidCtrlType = None* sets the supply air humidity ratio equal to the mixed air humidity ratio.

o   *DehumidCtrlType = Humidistat,* this will actively dehumidify to the humidistat dehumidification setpoint during cooling and deadband operation, and during heating operation if *HumidCtrlType = Humidistat*

o   *DehumidCtrlType = ConstantSensibleHeatRatio* sets the supply air humidity ratio using the cooling sensible heat ratio.

o   *DehumidCtrlType = ConstantSupplyHumidityRatio* sets the supply air humidity ratio = *W<sub>min,dehum</sub>*.

o   *HumidCtrlType = None* sets the supply air humidity ratio equal to the mixed air humidity ratio.

o   *HumidCtrlType = Humidistat,* this will actively humidify to the humidistat humidifying setpoint during heating and deadband operation, and during cooling operation if *DehumidCtrlType = Humidistat*

o   *HumidCtrlType = ConstantSupplyHumidityRatio* sets the supply air humidity ratio = *W<sub>max,humid</sub>*.

·        Limit supply humidity ratio to saturation at the supply temperature

·        Check the applicable capacity limits (sensible heating and total cooling) and adjust supply air temperature and humidity if needed.

·        Set the zone inlet node conditions to the supply air mass flow rate, temperature, and humidity ratio.

·        Calculate the unit output and load components.

### References

No specific references.

District Cooling <a name="DistrictCooling"></a>
----------------

When the user is not interested in a plant simulation or there is some centralized source of chilled water, the following model can be used in the input.  This allows the user to achieve a simulation without specifying operating parameters or curve fits for chiller models.  This model only needs the connections to the loop and the nominal capacity to simulate.  See the InputOutput Reference for additional information (Object: DistrictCooling).  This model calculates the output capacity necessary from the inlet temperature to the setpoint temperature for that loop with the given mass flow rate in Watts.

District Heating <a name="DistrictHeating"></a>
----------------

When the user is not interested in a plant simulation or there is some centralized source of hot water, the following model can be used in the input.  This allows the user to achieve a simulation without specifying operating parameters or curve fits for boiler models.  This model only needs the connections to the loop and the nominal capacity to simulate.  See the InputOutput Reference for additional information (Object: DistrictHeating).  This model calculates the output capacity necessary from the inlet temperature to the setpoint temperature for that loop with the given mass flow rate in Watts.

CentralHeatPumpSystem <a name="CentralHeatPumpSystem"></a>
---------------------

### Overview

The CentralHeatPumpSystem object simulates the performance of a central heat pump system containing one or more chiller-heater objects. The main function of the object is to call relevant calculation methods for the chiller-heater objects depending on their operating modes, and to calculate temperatures at the outlet nodes and the total energy transfer. The object can be connected to plant loops and a source loop (see Input-Output Reference document), and the node connections are solely dependent on individual chiller-heaters’ operating modes. The central system receives water flows from each plant and source loop and then distributes them to individual chiller-heaters as requested. The conditioned water flows leaving the chiller-heaters are then returned to the system, and in turn flow back to the plant loops and source loop to produce heating and cooling, or exchange heat with the source loop.

### Model Description

The model first determines operating modes based on the cooling and heating loads on the system, and then decides which calculation algorithm is called. It calls the cooling calculation subroutine when cooling load is demanded, the heating calculation subroutine when heating load is demanded, and both cooling and heating calculation subroutines when both cooling and heating loads are demanded, i.e., simultaneous cooing-heating mode. It then calculates mass-weighed temperatures and heat transfer energy. Six different operating modes (0 through 5) are possible:

0: off

1: cooling-only mode

2: heating-only mode

3: heat recovery mode

4: cooling dominant simultaneous cooling-heating mode

5: heating dominant simultaneous cooling-heating mode.

The model reads different node information over the operating mode so that outlet water conditions at each node of the system can be appropriately determined.

In cooling-only mode (mode 1), the system is connected to the chilled water loop and source loop. It thus reads the evaporator outlet temperatures and mass flow rates of the chiller-heaters to calculate a mass-weighed chilled water temperature at the system outlet node, and the condenser outlet temperatures and mass flow rates of the chiller-heaters to calculate a mass-weighed source water temperature at the system outlet node. In heating-only mode (mode 2), the system is connected to the hot water loop and source loop. It thus reads the condenser temperatures and mass flow rates of the chiller-heaters to calculate a mass-weighed hot water temperature at the system outlet node, and the evaporator temperatures and mass flow rates of the chiller-heaters to calculate a mass-weighed source temperature at the system outlet node.

In simultaneous cooling-heating mode, three different operating modes (mode 3 through 5) are possible. The model checks which simultaneous cooling-heating mode (3, 4, or 5) each chiller-heater is in, and calculates relevant mass-weighed temperatures. The system may be connected to three loops such as chilled water loop, hot water loop, and source water loop in mode 4 or mode 5.

In heat recovery mode, both evaporator temperatures and condenser temperatures are read and a mass-weighed temperature for both chilled water and hot water is calculated. The chiller-heaters in mode 3 do not exchange heat with source water. At least one of the chiller-heaters within the system is in heat recovery mode during simultaneous cooling-heating mode. The system may be only connected to both chilled water loop and hot water loop if all operating chiller-heaters are in heat recovery mode.

The following nomenclature is used in the following equations:

<span>${\dot m_{cw,bypass}}$</span> = chilled water bypass mass flow rate in the system [kg/s]

<span>${\dot m_{hw,bypass}}$</span>= hot water bypass mass flow rate in the system [kg/s]

<span>${\dot m_{src,bypass}}$</span> =source water bypass mass flow rate in the system [kg/s]

<span>${\dot m_{cw,CH}}$</span> =chilled water mass flow rate of i<sup>th</sup> chiller-heater’s evaporator [kg/s]

<span>${\dot m_{hw,CH}}$</span> =hot water mass flow rate of i<sup>th</sup> chiller-heater’s condenser [kg/s]

<span>${\dot m_{src,CH}}$</span> =source water mass flow rate of i<sup>th</sup> chiller-heater, which varies with operating modes [kg/s]

<span>${\dot m_{cw,sys}}$</span> =chilled water mass flow rate of the system [kg/s]

<span>${\dot m_{hw,sys}}$</span> =hot water mass flow rate of the system [kg/s]

<span>${\dot m_{src,sys}}$</span> =source water mass flow rate of the system [kg/s]

<span>${T_{cw,sys}}$</span> =chilled water outlet temperature of the system [C]

<span>${T_{hw,sys}}$</span> =hot water outlet temperature of the system [C]

<span>${T_{src,sys}}$</span> =source water outlet temperature of the system [C]

<span>${T_{cw,bypass}}$</span> =mass-weighed bypass chilled water temperature in the system [C]

<span>${T_{hw,bypass}}$</span> =mass-weighed bypass hot water temperature in the system [C]

<span>${T_{src,bypass}}$</span> =mass-weighed bypass source water temperature in the system [C]

<span>${T_{cw,CH}}$</span> =mass-weighed chilled water outlet temperature from chiller-heaters [C]

<span>${T_{hw,CH}}$</span> =mass-weighed hot water outlet temperature from chiller-heaters [C]

<span>${T_{src,CH}}$</span> =mass-weighed source water outlet temperature from chiller-heaters [C]

<span>${T_{cw,i}}$</span> =chilled water inlet temperature of the system [C]

<span>${T_{hw,i}}$</span> =hot water inlet temperature of the system [C]

<span>${T_{src,i}}$</span> =source water inlet temperature of the system [C]

<span>${T_{cw,out}}$</span> =chilled water outlet temperature of i<sup>th</sup> chiller-heater [C]

<span>${T_{hw,out}}$</span> =hot water outlet temperature of i<sup>th</sup> chiller-heater [C]

<span>${T_{src,out}}$</span> =source water outlet temperature of i<sup>th</sup> chiller-heater [C]

The model reads node information and local variables of individual chiller-heaters. The nodes and local variables vary with the operating modes as described above in order to calculate mass-weighed temperatures. In the cooling-only mode, it calculates a mass-weighed chilled water temperature (*T<sub>cw,CH</sub>*) and a source water temperature (*T<sub>src,CH</sub>*) as follows:

<div>$${T_{cw,CH}} = \sum\limits_{CH = 1}^n {{T_{cw,out}}} \frac{{{{\dot m}_{cw,CH}}}}{{{m_{cw,sys}}}}$$</div>

***<span>${T_{src,CH}} = \sum\limits_{CH = 1}^n {{T_{src,out}}} \frac{{{{\dot m}_{src,CH}}}}{{{m_{src,sys}}}}$</span> ***.

In heating-only mode, it calculates a mass-weighed hot water temperature (*T<sub>hw,CH</sub>*) and a source water temperature (*T<sub>src,CH</sub>*) as follows:

***<span>${T_{hw,CH}} = \sum\limits_{CH = 1}^n {{T_{hw,out}}} \frac{{{{\dot m}_{hw,CH}}}}{{{m_{hw,sys}}}}$</span> ***

***<span>${T_{src,CH}} = \sum\limits_{CH = 1}^n {{T_{src,out}}} \frac{{{{\dot m}_{src,CH}}}}{{{m_{src,sys}}}}$</span> ***.

When all chiller-heaters are in heat recovery mode, it calculates a mass-weighed chilled water temperature (*T<sub>cw,CH</sub>*) and hot water temperature (*T<sub>hw,CH</sub>*) as follows:

***<span>${T_{cw,CH}} = \sum\limits_{CH = 1}^n {{T_{cw,out}}} \frac{{{{\dot m}_{cw,CH}}}}{{{m_{cw,sys}}}}$</span>***

***<span>${T_{hw,CH}} = \sum\limits_{CH = 1}^n {{T_{hw,out}}} \frac{{{{\dot m}_{hw,CH}}}}{{{m_{hw,sys}}}}$</span> ***.

In cooling or heating dominant simultaneous cooling-heating mode (mode 4 and 5), at least one chiller-heater should be in heat recovery mode, and the other(s) are in either mode 4 or mode 5. The system is connected to three loops such as chilled water loop, hot water loop, and source water loop. The model thus calculates a mass-weighed chilled water temperature (*T<sub>cw,CH</sub>*), hot water temperature (*T<sub>hw,CH</sub>*), and source water temperature (*T<sub>src,CH</sub>*) as follows:

***<span>${T_{cw,CH}} = \sum\limits_{CH = 1}^n {{T_{cw,out}}} \frac{{{{\dot m}_{cw,CH}}}}{{{m_{cw,sys}}}}$</span>***

***<span>${T_{hw,CH}} = \sum\limits_{CH = 1}^n {{T_{hw,out}}} \frac{{{{\dot m}_{hw,CH}}}}{{{m_{hw,sys}}}}$</span>***

***<span>${T_{src,CH}} = \sum\limits_{CH = 1}^n {{T_{src,out}}} \frac{{{{\dot m}_{src,CH}}}}{{{m_{src,sys}}}}$</span>*** .

The model then calculates a mass-weighed temperature for the by-pass flows remained in the system as follows:

<div>$${T_{cw,bypass}} = {T_{cw,i}}\frac{{{{\dot m}_{cw,bypass}}}}{{{m_{cw,sys}}}}$$</div>

<div>$${T_{hw,bypass}} = {T_{hw,i}}\frac{{{{\dot m}_{hw,bypass}}}}{{{m_{hw,sys}}}}$$</div>

<div>$${T_{src,bypass}} = {T_{src,i}}\frac{{{{\dot m}_{src,bypass}}}}{{{m_{src,sys}}}}$$</div>

The outlet temperatures at each outlet node of the system are then determined as it sums both mass-weighed temperatures up as follows:

<div>$${T_{cw,sys}} = {T_{cw,CH}} + {T_{cw,bypass}}$$</div>

<div>$${T_{hw,sys}} = {T_{hw,CH}} + {T_{hw,bypass}}$$</div>

<span>${T_{src,sys}} = {T_{src,CH}} + {T_{src,bypass}}$</span>.

The total heat transfer energy of the system is also calculated in the same manner as the temperature calculations. The model simply sums all heat transfer energy of the chiller-heaters depending on their operating modes.

ChillerHeaterPerformance:Electric:EIR <a name="ChillerHeater"></a>
-------------------------------------

### Overview

The object simulates the performance of a chiller-heater which can receive pre-cooled or pre-heated water from the source loop, and provide cooling, heating, or simultaneous cooling-heating. The object needs to work with the Central Heat Pump System object to be controlled properly. This model does not simulate the thermal performance or the power consumption of associated pumps or cooling towers. The Central Heat Pump System object holds the input/output nodes connection of the chiller-heater and its control scheme, once the chiller-heater is properly referred.

### Model Description

The model uses user-input performance information at design conditions along with three performance curves (curve objects) for cooling capacity and efficiency to determine chiller operation at off-design conditions. Three additional performance curves for heating capacity and efficiency are used when the chiller is operating in a heating-only mode or simultaneous cooling-heating mode.

#### Cooling-only mode

The following nomenclature is used in the cooling equations:

*CompMotorEffic* =compressor motor efficiency

*CompPower<sub>clg</sub>* =compressor power [W]

*CompPower<sub>@PLRmin</sub>*  =compressor power at the minimum part-load ratio [W]

<span>${C_{p,cw}}$</span> =chilled water specific heat  [J/kgK]

*CyclingRatio*<sub></sub> =compressor cycling ratio =*PLR<sub>actual</sub>* / *PLR<sub>min</sub>*

*EvapCapAvail<sub>clg</sub>* =available full-load cooling capacity at current conditions [W]

*EvapCapFT<sub>clg</sub>* =cooling capacity function of temperature curve

*EIRFT<sub>clg</sub>* =electric input to cooling output factor for temperature function curve

*EIRFPLR<sub>clg</sub>* =electric input to cooling output factor for part-load function curve

<span>${\dot m_{cw}}$</span> =chilled water mass flow rate [kg/s]

<span>${\dot m_{avail,cw}}$</span> =chilled water maximum available mass flow rate [kg/s]

*PLR<sub>clg</sub>* =cooling part-load ratio = *CoolingLoad* / *EvapCapAvail<sub>clg</sub>*

*PLR<sub>actual</sub>* =actual part-load ratio at current conditions

*PLR<sub>min</sub>* =minimum part-load ratio

<span>$QCon{d_{c\lg }}$</span> =total condenser heat transfer energy [J]

<span>$\dot QCon{d_{c\lg }}$</span> =condenser heat transfer rate [W]

<span>$QEva{p_{c\lg }}$</span> =total evaporator heat transfer energy [J]

<span>$\dot QEva{p_{c\lg }}$</span> =evaporator heat transfer rate [W]

<span>${\dot Q_{falseloading,c\lg }}$</span> =false loading rate [W]

*RefCOP<sub>clg</sub>* =reference coefficient of performance [W/W]

*RefEvapCap<sub>clg</sub>* =reference evaporator capacity [W]

*FullLoadPwr<sub>clg</sub>* =reference full load power = *EvapCapAvail<sub>clg</sub>* / *RefCOP<sub>clg</sub>* [W]

*T<sub>cond</sub>* =either entering or leaving condenser water temperature depending on user input for condenser water independent variable. *T<sub>cond,l</sub>*, if “LeavingCondenser” is chosen, or *T<sub>cond,e</sub>*, if “EnteringCondenser” is chosen.

*T<sub>cond,e</sub>* =entering condenser water temperature [C]

*T<sub>cond,l</sub>* =leaving condenser water temperature [C]

*T<sub>cw,e</sub>* =entering chilled water  temperature [W]

*T<sub>cw,l</sub>* =leaving chilled water  temperature [W]

<span>$\Delta {T_{cw}}$</span> =chilled water inlet and outlet temperature difference [C]

<span>$\Delta {T_{cw}}_{,\max }$</span> =maximum chilled water inlet and outlet temperature difference [C]

The model sequentially calls each chiller-heater module in the order defined in the Central Heat Pump System object. It then determines cooling load that each chiller-heater needs to meet and water flow rates delivered to each chiller-heater. Once each chiller-heater is assumed to operate, it determines cooling capacity and efficiency using user-supplied performance information.

Three performance curves are used in the calculation of cooling capacity and efficiency as follows:

1)   Cooling mode cooling capacity function of temperature curve (*EvapCapFT<sub>clg</sub>*)

2)   Cooling mode electric input to cooling output ratio function of temperature curve (*EIRFT<sub>clg</sub>*)

3)   Cooling mode electric input to cooling output ratio function of part load ratio curve (*EIRFPLR<sub>clg</sub>*)

The Cooling Capacity Function of Temperature Curve (*EvapCapFT<sub>clg</sub>*) represents the fraction of the cooling capacity of the chiller-heater as it varies by temperature. The curve should have a value of 1.0 at the reference conditions. The output of a bi-quadratic curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser water temperature is given by:

***<span>$EvapCapF{T_{c\lg }} = a + b{T_{cw,l}} + c{T_{cw,l}}^2 + d{T_{Cond}} + e{T_{Cond}}^2 + f{T_{cw,l}}{T_{Cond}}$</span>***.

The Cooling Mode Electric Input to Cooling Output Ratio Function of Temperature (EIRFT<sub>clg</sub>) curve represents the fraction of electricity to the chiller-heater at full load as it varies by temperature. The output of a bi-quadratic curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser water temperature is given by:

***<span>$EIRF{T_{c\lg }} = a + b{T_{cw,l}} + c{T_{cw,l}}^2 + d{T_{Cond}} + e{T_{Cond}}^2 + f{T_{cw,l}}{T_{Cond}}$</span>***.

The Cooling Mode Electric Input to Cooling Output Ratio Function of Part Load Ratio (EIRFPLR<sub>clg</sub>) curve represents the fraction of electricity to the chiller-heater as the load on the chiller varies at a given set of operating temperatures. The curve is normalized so that at full load the value of the curve should be 1.0. Note that the bi-cubic formulation below is generally only valid when LeavingCondenser variable is chosen for the field of Cooling Mode Condenser Water Temperature Curve Input Variable whereas the quadratic curve can be used for both choices, i.e., LeavingCondenser and EnteringCondenser. Bi-cubic may also be used when the chiller-heater uses a variable-speed compressor motor drive. The output of this curve can be determined by one of the following three performance curves:

<div>$$EIRFPL{R_{c\lg }} = a + b{T_{Cond,l}} + c{T_{Cond,l}}^2 + dPLR + ePL{R^2} + f{T_{Cond,l}}PLR + g \cdot 0 + hPL{R^3} + i \cdot 0 + j \cdot 0$$</div>

<div>$$EIRFPL{R_{c\lg }} = a + bPLR + cPL{R^2}$$</div>

<div>$$EIRFPL{R_{c\lg }} = a + bPLR + cPL{R^2} + dPL{R^3}$$</div>

The full-load cooling capacity at specific temperature operating conditions (i.e., at temperatures different from the design temperatures) is then computed as follows:

***<span>$EvapCapAvai{l_{c\lg }} = RefEvapCa{p_{c\lg }} \cdot EvapCapF{T_{c\lg }}$</span>***.

The model then determines current chiller-heater’s evaporator heat transfer rate based on the total cooling load required a central heat pump system to meet and the maximum available chiller-heater cooling capacity. The maximum evaporator temperature difference between the entering chilled water temperature (*T<sub>cw,e</sub>*) and the leaving chilled water temperature (*T<sub>cw,l</sub>*) obtained from the plant loop setpoint temperature can also be determined. It then calculates mass flow rate for variable flow control chiller-heaters and the temperature difference for constant flow control chiller-heaters, setting the cooling load each chiller-heater needs to meet equal to the evaporator heat transfer rate.

As for variable flow control chiller-heaters, the chilled water mass flow rate is computed as follows:

***<span>${\dot m_{cw}} = \frac{{\dot QEva{p_{c\lg }}}}{{{C_{p,cw}}\Delta {T_{cw,\max }}}}$</span>***.

The chilled water mass flow rate calculated is then compared to the maximum available mass flow rate for individual chiller-heaters. If the calculated one is bigger than the maximum, the model sets the chilled water mass flow rate equal to the maximum. It then adjusts the temperature difference based on the evaporator heat transfer rate and the maximum mass flow rate. If the adjusted temperature difference also exceeds the maximum, the model finally adjusts the evaporator heat transfer rate at the maximum temperature difference and mass flow rate as follows:

***<span>$\dot QEva{p_{c\lg }} = {\dot m_{avail,cw}}{C_{p,cw}}\Delta {T_{cw,\max }}$</span>***.

As for constant flow control chiller-heaters, the model calculates chilled water temperature difference as follows:

***<span>$\Delta {T_{cw}} = \frac{{\dot QEva{p_{c\lg }}}}{{{{\dot m}_{avail,cw}}{C_{p,cw}}}}$</span>***.

The temperature difference calculated is then compared to the maximum temperature difference allowed. If the calculated one is bigger than the maximum, the model sets the chilled water temperature difference equal the maximum, and then adjusts the evaporator heat transfer rate at the given conditions as follows:

***<span>$\dot QEva{p_{c\lg }} = {\dot m_{avail,cw}}{C_{p,cw}}\Delta {T_{cw,\max }}$</span>***.

The model then calculates the part-load ratio as the ratio of the evaporator heat transfer rate to the available chiller-heater capacity as follows:

***<span>$PL{R_{c\lg }} = \frac{{\dot QEva{p_{c\lg }}}}{{\dot QEvapAvai{l_{c\lg }}}}$</span>***.

The part-load ratio calculated is set to be between the maximum of 1.0 and the minimum of 0.0 when it is out of the range. Once the part-load ratio is calculated the cycling ratio and false loading rate can be obtained as follows:

<div>$$CyclingRatio = \frac{{PL{R_{{\rm{actual}}}}}}{{PL{R_{{\rm{min}}}}}}$$</div>

<span>${\dot Q_{falseloading,c\lg }} = EvapCapAvai{l_{{\rm{clg}}}} \cdot PL{R_{c\lg }} \cdot CyclingRatio - \dot QEva{p_{{\rm{clg}}}}$</span>.

The compressor power demand is then computed by:

<span>$CompPowe{r_{c\lg }} = RefFullLoadPowe{r_{{\rm{clg}}}} \cdot {\rm{ }}EIRF{T_{c\lg }}{\rm{ }} \cdot EIRFPL{R_{c\lg }} \cdot CyclingRatio$</span>.

The heat transfer rate for the chiller-heater condenser can then be computed as follows:

<span>$\dot QCon{d_{c\lg }} = ComPowe{r_{c\lg }} \cdot CompMotorEffic + \dot QEva{p_{c\lg }} + {\dot Q_{falseloading,c\lg }}$</span> .

The total heat transfer energy by the evaporator and condenser can be calculated as follows:

<div>$$QEva{p_{c\lg }} = \dot QEva{p_{c\lg }} \cdot TimeStepSys \cdot 3600$$</div>

<span>$QCon{d_{c\lg }} = \dot QCon{d_{c\lg }} \cdot TimeStepSys \cdot 3600$</span> .

#### Heating-only mode and Simultaneous cooling-heating mode

The following nomenclature is used in the heating equations:

*CompMotorEffic* =compressor motor efficiency

*CompPower<sub>htg</sub>* =compressor power demand [W]

*CompPower<sub>@PLRmin</sub>*  =compressor power at the minimum part-load ratio [W]

<span>${C_{p,evap}}$</span> =evaporator water specific heat  [J/kgK]

<span>${C_{p,hw}}$</span> =hot water specific heat  [J/kgK]

*CyclingRatio*<sub></sub> =compressor cycling ratio =*PLR<sub>actual</sub>* / *PLR<sub>min</sub>*

*EvapCapAvail<sub>htg</sub>* =available full-load cooling capacity at current conditions [W]

*EvapCapFT<sub>htg</sub>* =heating mode cooling capacity function of temperature curve

*EIRFT<sub>htg</sub>* =electric input to cooling output factor for temperature function curve

*EIRFPLR<sub>htg</sub>* =electric input to cooling output factor for part-load function curve

<span>${\dot m_{avail,evap}}$</span> =evaporator water maximum available mass flow rate [kg/s]

<span>${\dot m_{avail,hw}}$</span> =condenser water maximum available mass flow rate [kg/s]

<span>${\dot m_{hw}}$</span> =hot water mass flow rate [kg/s]

*PLR<sub>htg</sub>* =cooling part-load ratio = *RefCap* / *EvapCapAvail<sub>htg</sub>*

*PLR<sub>max</sub>* =maximum part-load ratio at current conditions

*PLR<sub>min</sub>* =minimum part-load ratio

<span>$QCon{d_{htg}}$</span> =total condenser heat transfer energy [J]

<span>$\dot QCondAvai{l_{htg}}$</span> =available full-load heating capacity at current conditions [W]

<span>$\dot QCon{d_{htg}}$</span> =condenser heat transfer rate [W]

<span>$QEva{p_{htg}}$</span> =total evaporator heat transfer energy [J]

<span>$\dot QEva{p_{htg}}$</span> =evaporator heat transfer rate [W]

<span>${\dot Q_{falseloading,htg}}$</span> =false loading rate [W]

*RefCOP<sub>htg</sub>* =reference coefficient of performance [W/W]

*RefEvapCap<sub>htg</sub>* =reference evaporator capacity [W]

*FullLoadPwr<sub>htg</sub>* =reference full load power = *EvapCapAvail<sub>htg</sub>*/ *RefCOP<sub>htg</sub>* [W]

*T<sub>cond</sub>* =either entering or leaving condenser water temperature depending on user input for condenser water independent variable. *T<sub>cond,l</sub>*, if “LeavingCondenser” is chosen, or *T<sub>cond,e</sub>*, if “EnteringCondenser” is chosen.

*T<sub>cond,e</sub>* =entering condenser water temperature [C]

*T<sub>cond,l</sub>* =leaving condenser water temperature [C]

*T<sub>cw,l</sub>* =leaving chilled water  temperature [C]

*T<sub>hw,e</sub>* =entering hot water temperature [C]

*T<sub>hw,l</sub>* =leaving hot water temperature [C]

<span>$\Delta {T_{evap}}$</span> =evaporator inlet and outlet water temperature difference [C]

<span>$\Delta {T_{hw}}$</span> =hot water inlet and outlet temperature difference [C]

<span>$\Delta {T_{hw}}_{,\max }$</span> =maximum hot water inlet and outlet temperature difference [C]

The calculations for the evaporator side are similar to the cooling-only mode calculations. The evaporator capacity and efficiency is determined by a different set of three performance curves read in the cooling-only mode, and the performance curve set is used for both heating-only mode and simultaneous cooling-heating mode. During these modes, the evaporator side is not connected to the chilled water loop, but source water loop. The model thus assumes that each chiller-heater does not meet the plant loop chilled water setpoint temperature while the evaporator operates at the full load capacity to produce heating at a constant water flow rate.

The model sequentially calls each chiller-heater module in the order of the definition in the central heat pump system. It then determines heating load that each chiller-heater needs to meet and water flow rates delivered to each chiller-heater. Once each chiller-heater is assumed to operate, it determines heating capacity and efficiency using the following performance curves:

1)   Heating mode cooling capacity function of temperature curve (*EvapCapFT<sub>htg</sub>*)

2)   Heating mode electric input to cooling output ratio function of temperature curve (*EIRFT<sub>htg</sub>*)

3)   Heating mode electric input to cooling output ratio function of part load ratio curve (*EIRFPLR<sub>htg</sub>*)

The output of a Heating Mode Cooling Capacity Function of Temperature curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser water temperature is given by:

***<span>$EvapCapF{T_{htg}} = a + b{T_{cw,l}} + c{T_{cw,l}}^2 + d{T_{Cond}} + e{T_{Cond}}^2 + f{T_{cw,l}}{T_{Cond}}$</span>***

The output of a Heating Mode Cooling Output Ratio Function of Temperature curve with the input variables being the leaving chilled water temperature and either the entering or leaving condenser water temperature is given by:

***<span>$EIRF{T_{htg}} = a + b{T_{cw,l}} + c{T_{cw,l}}^2 + d{T_{Cond}} + e{T_{Cond}}^2 + f{T_{cw,l}}{T_{Cond}}$</span>***.

The output of Heating Mode Cooling Output Ratio Function of Part Load Ratio curve can be determined by one of the following three performance curves as follows:

<div>$$EIRFPL{R_{htg}} = a + b{T_{Cond,l}} + c{T_{Cond,l}}^2 + dPLR + ePL{R^2} + f{T_{Cond,l}}PLR + g \cdot 0 + hPL{R^3} + i \cdot 0 + j \cdot 0$$</div>

<div>$$EIRFPL{R_{htg}} = a + bPLR + cPL{R^2}$$</div>

<div>$$EIRFPL{R_{htg}} = a + bPLR + cPL{R^2} + dPL{R^3}$$</div>

The full-load evaporator capacity at specific temperature operating conditions is then given by:

***<span>$EvapCapAvai{l_{htg}} = RefEvapCa{p_{htg}} \cdot EvapCapF{T_{htg}}$</span>***.

The part-load ratio is set to be between zero and the maximum, and the evaporator heat transfer rate is computed by:

***<span>$\dot QEva{p_{htg}} = EvapCapAvai{l_{htg}}PL{R_{htg}}$</span>***The evaporator inlet and outlet temperature difference is then given by:

***<span>$\Delta {T_{evap}} = \frac{{\dot QEva{p_{htg}}}}{{{{\dot m}_{avail,evap}}{C_{p,evap}}}}$</span>***

Once the part-load ratio is calculated the cycling ratio and false loading rate are computed by:

<div>$$CyclingRatio = \frac{{PL{R_{{\rm{actual}}}}}}{{PL{R_{{\rm{min}}}}}}$$</div>

<span>${\dot Q_{falseloading,htg}} = EvapCapAvai{l_{{\rm{htg}}}} \cdot PL{R_{htg}} \cdot CyclingRatio - \dot QEva{p_{{\rm{htg}}}}$</span>.

The compressor power demand is then computed by:

***<span>$CompPowe{r_{htg}} = FullLoadPowe{r_{{\rm{htg}}}} \cdot {\rm{ }}EIRF{T_{htg}}{\rm{ }} \cdot EIRFPL{R_{htg}} \cdot CyclingRatio$</span>***

The heat transfer rate of the chiller-heater condenser is then computed as follows:

<div>$$\dot QCondAvai{l_{htg}} = ComPowe{r_{htg}} \cdot CompMotorEffic + \dot QEva{p_{htg}} + {\dot Q_{falseloading,htg}}$$</div>

Once condenser available heating capacity is determined, the model calculates current chiller-heater’s condenser heat transfer rate based on the total heating load required a central heat pump system to meet as well as available heating capacity of the chiller-heater. The maximum condenser temperature difference between the entering hot water temperature (*T<sub>hw,e</sub>*) and the leaving hot water temperature (*T<sub>hw,l</sub>*) obtained from the plant loop setpoint temperature can also be obtained. It then calculates condenser water mass flow rate for variable flow control chiller-heaters and the hot water temperature difference for constant flow control chiller-heaters, setting the cooling load that each chiller-heater needs to meet equal the evaporator heat transfer rate.

As for variable flow control chiller-heaters, the condenser water mass flow rate is computed as follows:

***<span>${\dot m_{hw}} = \frac{{\dot QCon{d_{htg}}}}{{{C_{p,hw}}\Delta {T_{hw,\max }}}}$</span>***.

The condenser water mass flow rate calculated is then compared to the maximum available mass flow rate for individual chiller-heaters. If the calculated one is bigger than the maximum, the model sets the condenser water mass flow rate equal the maximum. It then adjusts the hot water temperature difference at the maximum mass flow rate. If the adjusted temperature difference also exceeds the maximum, the model finally adjusts the condenser heat transfer rate at the maximum allowable conditions as follows:

***<span>$\dot QCon{d_{htg}} = {\dot m_{avail,hw}}{C_{p,hw}}\Delta {T_{hw,\max }}$</span>***.

As for constant flow control chiller-heaters, the model calculates condenser temperature difference as follows:

***<span>$\Delta {T_{hw}} = \frac{{\dot QCon{d_{htg}}}}{{{{\dot m}_{avail,hw}}{C_{p,hw}}}}$</span>***.

The temperature difference calculated is then compared to maximum hot water temperature difference. If the calculated one is bigger than the maximum, the model sets the hot water temperature difference equal the maximum, and then adjusts the condenser heat transfer rate at the given conditions as follows:

***<span>$\dot QCon{d_{htg}} = {\dot m_{avail,hw}}{C_{p,hw}}\Delta {T_{hw,\max }}$</span>***.

Finally, the total heat transfer energy by the evaporator and condenser can then be calculated as follows:

***<span>$QEva{p_{htg}} = \dot QEva{p_{htg}} \cdot TimeStepSys \cdot 3600$</span>***

***<span>$QCon{d_{htg}} = \dot QCon{d_{htg}} \cdot TimeStepSys \cdot 3600$</span>***.

### References

Central Geothermal Systems, Applications Engineering Manual, Trane Company, April 2010, SYS-APM009-EN.

Plant Temperature Source Component <a name="PlantComponent"></a>
----------------------------------

This component (Object: PlantComponent:TemperatureSource) is a simple object used to simulate systems with a known supply temperature.  This could include a river, well, or other configuration where a known temperature is pumped back into the plant system.  This fluid could be isolated from chilled water and other loops by using a heat exchanger connection between the loops.

The temperature of the source of this object can be either constant or scheduled.  If scheduled, it could also be actuated by EMS to allow a calculated temperature at run-time.

The logic of this component is quite simple: if there is flow through the component, the outlet temperature is always the source temperature.  The component requests flow from the design flow rate, which can be autosized.

#### References

No specific references.


Radiant System Models <a name="RadiantSystems"></a>
---------------------

### Low Temperature Radiant System Model

The input objects ZoneHVAC:LowTemperatureRadiant:ConstantFlow, ZoneHVAC:LowTemperatureRadiant:VariableFlow, and ZoneHVAC:LowTemperatureRadiant:Electric provide models for low temperature radiant heating and cooling systems that appear, on the surface, to be relatively simple systems.  The system circulates hot or cold fluid through tubes embedded in a wall, ceiling, or floor or runs current through electric resistance wires embedded in a surface or a panel.  Energy is thus either added to or removed from the space, and zone occupants are conditioned by both radiation exchange with the system and convection from the surrounding air that is also affected by the system.  Unless specifically required for indoor air quality considerations, fans, ductwork, dampers, etc. are not needed.

Despite the relative simplicity of the low temperature radiant systems, the integration of such a system within an energy analysis program requires one to overcome several challenges.  First, for systems with significant thermal mass, the conduction transfer function method for modeling transient conduction must be extended to include embedded heat sources or sinks.  Second, one must integrate this formulation within an energy analysis program like EnergyPlus.  Finally, one must overcome the fact that the radiant system is both a zone heat balance element and a conditioning system.  Each of these issues will be addressed in the next several subsections.

#### One Dimensional Heat Transfer Through Multilayered Slabs

One of the most important forms of heat transfer in energy analysis is heat conduction through building elements such as walls, floors, and roofs.  While some thermally lightweight structures can be approximated by steady state heat conduction, a method that applies to all structures must account for the presence of thermal mass within the building elements.  Transient one dimensional heat conduction through a homogeneous layer with constant thermal properties such as the one shown in Figure 266 is governed by the following equation:

<div>$$\frac{{{\partial ^2}T}}{{\partial {x^2}}} = \frac{1}{\alpha }\frac{{\partial T}}{{\partial t}}$$</div>

where: T is the temperature as a function of position and time,

x is the position,

t is the time,

<span>$\alpha  = \frac{k}{{\rho {c_p}}}$</span> is the thermal diffusivity of the layer material,

k is its thermal conductivity,

r is its density, and

cp is its specific heat.

This equation is typically coupled with Fourier’s law of conduction that relates the heat flux at any position and time to temperature as follows:

<div>$$q''\left( {x,t} \right) =  - k\frac{{\partial T\left( {x,t} \right)}}{{\partial x}}$$</div>

![](EngineeringReference/media/image5973.png)

Figure 266. Single Layered Building Element

While analytical solutions exist for the single homogeneous layer shown in Figure 266, the solution becomes extremely tedious for the multiple layered slab shown in Figure 267.

![](EngineeringReference/media/image5974.png)

Figure 267. Multilayered Building Element

#### Time Series Solutions:  Conduction Transfer Functions

Equations and can be solved numerically in a variety of ways.  As mentioned in the previous section, other models have used control theory and numerical methods such as finite difference and finite element.  However, each of these methods have drawbacks which render them inappropriate for use within an energy analysis program which requires both accuracy and efficiency from the simulation.

Another possible modeling method is a time series solution.  Several of the detailed energy analysis programs such as EnergyPlus use a time series solution to transient heat conduction.  The most basic time series solution is the response factor equation which relates the flux at one surface of an element to an infinite series of temperature histories at both sides as shown by:

<div>$${q''_{i,t}} = \sum\limits_{m = 1}^\infty  {{X_m}{T_{i,t - m + 1}}}  - \sum\limits_{m = 1}^\infty  {{Y_m}{T_{o,t - m + 1}}} $$</div>

where q” is heat flux, T is temperature, i signifies the inside of the building element, o signifies the outside of the building element, and t represents the current time step.

While in most cases the terms in the series decay fairly rapidly, the infinite number of terms needed for an exact response factor solution makes it less than desirable.  Fortunately, the similarity of higher order terms can be used to replace them with flux history terms.  The new solution contains elements that are called conduction transfer functions (CTFs).  The basic form of a conduction transfer function solution is shown by the following equation:

<div>$${q''_{i,t}} = \sum\limits_{m = 1}^M {{X_m}{T_{i,t - m + 1}}}  - \sum\limits_{m = 1}^M {{Y_m}{T_{o,t - m + 1}}}  + \sum\limits_{m = 1}^k {{F_m}{{q''}_{i,t - m}}} $$</div>

where k is the order of the conduction transfer functions, M is a finite number defined by the order of the conduction transfer functions, and X, Y, and F are the conduction transfer functions.  This equation states that the heat flux at the interior surface of any generic building element for which the assumption of one dimensional conduction heat transfer is valid is linearly related to the current and some of the previous temperatures at both the interior and exterior surface as well as some of the previous flux values at the interior surface.  A similar equation holds for the heat flux at the exterior surface.

The final CTF solution form reveals why it is so elegant and powerful.  With a single, relatively simple equation, the conduction heat transfer through an element can be calculated.  The coefficients (CTFs) in the equation are constants that only need to be determined once.  The only storage of data required is the CTFs themselves and a limited number of temperature and flux terms.  The formulation is valid for any surface type and does not require the calculation or storage of element interior temperatures.

As the next several sections will detail, there are two main methods for calculating conduction transfer functions:  the Laplace Transform method and the State Space method.  Both methods are well suited for the main focus of this research, the extension of conduction transfer functions to include heat sources or sinks.

#### Laplace Transform Formulation

The traditional method for calculating conduction transfer functions is described in detail by Hittle (1981).  Beginning with the transient one dimensional heat conduction equation {Equation } and Fourier's law of conduction {Equation }, the Laplace transform method is used to convert the governing equations into the s-domain for a single layer such as the one shown in Figure 266.

<div>$$\frac{{{d^2}T\left( {x,s} \right)}}{{d{x^2}}} = \frac{s}{\alpha }T\left( {x,s} \right)$$</div>

<div>$$q''\left( {x,s} \right) =  - k\frac{{dT\left( {x,s} \right)}}{{dx}}$$</div>

The transformed equations are solved and then put in matrix form as shown below:

<div>$$
  \left[ 
    {\begin{array}{*{20}{c}}
      {{T_1}\left( s \right)} \\ {{q_1}\left( s \right)}
    \end{array}}
  \right] = \left[ 
    {\begin{array}{*{20}{c}}
      {{A_1}\left( s \right)}&{{B_1}\left( s \right)} \\
      {{C_1}\left( s \right)}&{{D_1}\left( s \right)}
    \end{array}}
  \right] \left[ 
    {\begin{array}{*{20}{c}}
      {{T_2}\left( s \right)} \\
      {{q_2}\left( s \right)}
    \end{array}}
  \right]
$$</div>

where: T1(s), T2(s), q1(s), and q2(s) are the temperature and flux terms in the Laplace domain,

<span>${A_1}\left( s \right) = \cosh \left( {{\ell_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} } \right)$</span>,

<span>${B_1}\left( s \right) = \left( {{1 \mathord{\left/ {\vphantom {1 {{k_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} }}} \right. } {{k_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} }}} \right)\sinh \left( {{\ell_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} } \right)$</span>,

<span>${C_1}\left( s \right) = {k_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} \sinh \left( {{\ell_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} } \right)$</span>,

<span>${D_1}\left( s \right) = \cosh \left( {{\ell_1}\sqrt {{s \mathord{\left/ {\vphantom {s {{\alpha_1}}}} \right. } {{\alpha_1}}}} } \right)$</span>,

k1 is the thermal conductivity of the layer,

a1 is the thermal diffusivity of the layer, and

<span>${\ell_1}$</span> is the thickness of the layer.

The 2 x 2 matrix consisting of A1(s), B1(s), C1(s), and D1(s) is called the transmission matrix and contains all of the thermophysical properties of the layer necessary to calculate transient conduction heat transfer through it.  It can easily be shown that a second layer could be characterized in a similar way as:

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_2}\left( s \right)}\\ {{q_2}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_2}\left( s \right)}&{{B_2}\left( s \right)}\\ {{C_2}\left( s \right)}&{{D_2}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_3}\left( s \right)}\\ {{q_3}\left( s \right)}\end{array}} \right]$$</div>

where A2(s), B2(s), C2(s), and D2(s) are calculated using the properties of the second layer.  This can be substituted into Equation to provide insight how the extension to multilayered slabs is achieved.

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{A_2}\left( s \right)}&{{B_2}\left( s \right)}\\ {{C_2}\left( s \right)}&{{D_2}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_3}\left( s \right)}\\ {{q_3}\left( s \right)}\end{array}} \right]$$</div>

Thus, for a multilayered element as shown in Figure 267, each separate layer has a transmission matrix of Ai(s), Bi(s), Ci(s), and Di(s) associated with it.  The form of the matrix equation for the multilayered element is the same as the equation for a single layer:

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{A\left( s \right)}&{B\left( s \right)}\\ {C\left( s \right)}&{D\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_{n + 1}}\left( s \right)}\\ {{q_{n + 1}}\left( s \right)}\end{array}} \right]$$</div>

but the transmission matrix is replaced by:

<div>$$\left[ {\begin{array}{*{20}{c}}{A\left( s \right)}&{B\left( s \right)}\\ {C\left( s \right)}&{D\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{A_2}\left( s \right)}&{{B_2}\left( s \right)}\\ {{C_2}\left( s \right)}&{{D_2}\left( s \right)}\end{array}} \right] \cdots \left[ {\begin{array}{*{20}{c}}{{A_n}\left( s \right)}&{{B_n}\left( s \right)}\\ {{C_n}\left( s \right)}&{{D_n}\left( s \right)}\end{array}} \right]$$</div>

Equation is typically rearranged as follows:

<div>$$\left[ {\begin{array}{*{20}{c}}{{q_1}\left( s \right)}\\ {{q_{n + 1}}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{{D\left( s \right)}}{{B\left( s \right)}}}&{\frac{{ - 1}}{{B\left( s \right)}}}\\ {\frac{1}{{B\left( s \right)}}}&{\frac{{ - A\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{T_{n + 1}}\left( s \right)}\end{array}} \right]$$</div>

which relates the flux at either surface of the element to the temperature histories at both surfaces.  When the temperature histories are formulated as triangular pulses made up of simple ramp functions, the roots of this equation can be found and result in response factors.  The response factors can be simplified as described above through the introduction of flux history terms to form conduction transfer functions.  A simplified method of finding the roots of the Laplace domain equations is described by Hittle and Bishop (1983) and is used by the current version of BLAST.

#### State Space Formulation

Recently, another method of finding conduction transfer functions starting from a state space representation has begun receiving increased attention (Ceylan and Myers 1980; Seem 1987; Ouyang and Haghighat 1991).  The basic state space system is defined by the following linear matrix equations:

<div>$$\frac{{d\left[ x \right]}}{{dt}} = \left[ A \right]\left[ x \right] + \left[ B \right]\left[ u \right]$$</div>

<div>$$\left[ y \right] = \left[ C \right]\left[ x \right] + \left[ D \right]\left[ u \right]$$</div>

where x is a vector of state variables, u is a vector of inputs, y is the output vector, t is time, and A, B, C, and D are coefficient matrices.  Through the use of matrix algebra, the vector of state variables (x) can be eliminated from the system of equations, and the output vector (y) can be related directly to the input vector (u) and time histories of the input and output vectors.

This formulation can be used to solve the transient heat conduction equation by enforcing a finite difference grid over the various layers in the building element being analyzed.  In this case, the state variables are the nodal temperatures, the environmental temperatures (interior and exterior) are the inputs, and the resulting heat fluxes at both surfaces are the outputs.  Thus, the state space representation with finite difference variables would take the following form:

<div>$$\frac{{d\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right]}}{{dt}} = \left[ A \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right] + \left[ B \right]\left[ {\begin{array}{*{20}{c}}{{T_i}}\\ {{T_o}}\end{array}} \right]$$</div>

<div>$$\left[ {\begin{array}{*{20}{c}}{{{q''}_i}}\\ {{{q''}_o}}\end{array}} \right] = \left[ C \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right] + \left[ D \right]\left[ {\begin{array}{*{20}{c}}{{T_i}}\\ {{T_o}}\end{array}} \right]$$</div>

where T1, T2, ..., Tn-1, Tn are the finite difference nodal temperatures, n is the number of nodes, Ti and To are the interior and exterior environmental temperatures, and <span>${q''_i}$</span> and <span>${q''_o}$</span> are the heat fluxes (desired output).

Seem (1987) shows that for a simple one layer slab with two interior nodes as in Figure 268 and convection at both sides the resulting finite difference equations are given by:

<div>$$C\frac{{d{T_1}}}{{dt}} = hA\left( {{T_o} - {T_1}} \right) + \frac{{{T_2} - {T_1}}}{R}$$</div>

<div>$$C\frac{{d{T_2}}}{{dt}} = hA\left( {{T_i} - {T_2}} \right) + \frac{{{T_1} - {T_2}}}{R}$$</div>

<div>$${q''_i} = h\left( {{T_i} - {T_2}} \right)$$</div>

<div>$${q''_o} = h\left( {{T_1} - {T_o}} \right)$$</div>

where:         <span>$R = \frac{\ell }{{kA}}$</span>  , thermal resistance

<span>$C = \frac{{\rho {c_p}\ell A}}{2}$</span> , thermal capacitance

<span>${T_o}$</span>= outside temperature

<span>${T_i}$</span>= inside temperature

<span>${T_1}$</span>=temperature of node 1

<span>${T_2}$</span>=temperature of node 2

and

A is the area of the surface exposed to the environmental temperatures.

In matrix format:

<div>$$\left[ {\begin{array}{*{20}{c}}{\frac{{d{T_1}}}{{dt}}}\\ {\frac{{d{T_2}}}{{dt}}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{{ - 1}}{{RC}} - \frac{{hA}}{C}}&{\frac{1}{{RC}}}\\ {\frac{1}{{RC}}}&{\frac{{ - 1}}{{RC}} - \frac{{hA}}{C}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ {{T_2}}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{\frac{{hA}}{C}}&0\\0&{\frac{{hA}}{C}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_o}}\\ {{T_i}}\end{array}} \right]$$</div>

<div>$$\left[ {\begin{array}{*{20}{c}}{{{q''}_i}}\\ {{{q''}_o}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}0&{ - h}\\h&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ {{T_2}}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}0&h\\ { - h}&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_o}}\\ {{T_i}}\end{array}} \right]$$</div>

![](EngineeringReference/media/image6008.svg.png)

Figure 268. Two Node State Space Example

The important aspect of the state space technique is that through the use of relatively simple matrix algebra the state space variables (nodal temperatures) can be eliminated to arrive at a matrix equation that gives the outputs (heat fluxes) as a function of the inputs (environmental temperatures) only.  This eliminates the need to solve for roots in the Laplace domain.  In addition, the resulting matrix form has more physical meaning than complex functions required by the Laplace transform method.  The current version of EnergyPlus uses the state space method for computing CTFs.

The accuracy of the state space method of calculating CTFs has been addressed in the literature.  Ceylan and Myers (1980) compared the response predicted by the state space method to various other solution techniques including an analytical solution.  Their results showed that for an adequate number of nodes the state space method computed a heat flux at the surface of a simple one layer slab within 1% of the analytical solution.  Ouyang and Haghighat (1991) made a direct comparison between the Laplace and state space methods.  For a wall composed of insulation between two layers of concrete, they found almost no difference in the response factors calculated by each method.

#### Extension of Time Series Solutions to Include Heat Sources and Obtain Internal Temperatures

#### Laplace Transform Formulation

Degiovanni (1988) proposed two methodologies for including sources or sinks in the Laplace Transform Formulation.  The first method shows how a source that varies as a function of time and location can be incorporated.  The resulting equations involve some fairly complicated terms including spatial derivatives.

The second method that will be analyzed in more detail involves the addition of a source or sink at the interface between two layers.  The derivation of the necessary equations is begun by analyzing the simple two layer element shown in Figure 269.

![](EngineeringReference/media/image6009.png)

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_2}\left( s \right)}\\ {{q_2}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_2}\left( s \right)}&{{B_2}\left( s \right)}\\ {{C_2}\left( s \right)}&{{D_2}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_3}\left( s \right)}\\ {{q_3}\left( s \right)}\end{array}} \right]$$</div>

Figure 269.  Two Layer Example for Deriving the Laplace Transform Extension to Include Sources and Sinks

For the first layer, it was determined that in the Laplace domain

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_2}\left( s \right)}\\ {{q_2}\left( s \right)}\end{array}} \right]$$</div>

For the second layer:



To link the two layers and include the heat source between them, the following substitution is made:

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_2}\left( s \right)}\\ {{q_2}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{T_{2 + }}\left( s \right)}\\ {{q_{2 + }}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}0\\ {{q_{source}}\left( s \right)}\end{array}} \right]$$</div>

which results in:

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left\{ {\left[ {\begin{array}{*{20}{c}}{{T_{2 + }}\left( s \right)}\\ {{q_{2 + }}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}0\\ {{q_{source}}\left( s \right)}\end{array}} \right]} \right\}$$</div>

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left\{ {\left[ {\begin{array}{*{20}{c}}{{A_2}\left( s \right)}&{{B_2}\left( s \right)}\\ {{C_2}\left( s \right)}&{{D_2}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_3}\left( s \right)}\\ {{q_3}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}0\\ {{q_{source}}\left( s \right)}\end{array}} \right]} \right\}$$</div>

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{A_2}\left( s \right)}&{{B_2}\left( s \right)}\\ {{C_2}\left( s \right)}&{{D_2}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_3}\left( s \right)}\\ {{q_3}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{{A_1}\left( s \right)}&{{B_1}\left( s \right)}\\ {{C_1}\left( s \right)}&{{D_1}\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}0\\ {{q_{source}}\left( s \right)}\end{array}} \right]$$</div>

While Degiovanni concludes with this formula, some insight into what the generic equation for an element that has n layers might look like is gained by working with Equation .  If a layer is added to the left of the first layer, the entire right hand side of Equation is multiplied by the transmission matrix of the new layer.  Conversely, if a layer is added to the right of the second layer in Figure 269, the vector containing the Laplace transform of the temperature and heat flux at interface 3 is replaced by the product of the transmission matrix of the new layer and the vector for temperature and heat flux at the next interface, and the term dealing with the heat source is not affected.  The general equation for a building element with n layers and m layers between the left hand surface and the heat source can be derived as:

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left( {\prod\limits_{i = 1}^n {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} } \right)\left[ {\begin{array}{*{20}{c}}{{T_{n + 1}}\left( s \right)}\\ {{q_{n + 1}}\left( s \right)}\end{array}} \right] + \left( {\prod\limits_{i = 1}^m {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} } \right)\left[ {\begin{array}{*{20}{c}}0\\ {{q_{source}}\left( s \right)}\end{array}} \right]$$</div>

or in more compact form:

<div>$$\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{q_1}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{A\left( s \right)}&{B\left( s \right)}\\ {C\left( s \right)}&{D\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_{n + 1}}\left( s \right)}\\ {{q_{n + 1}}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{a\left( s \right)}&{b\left( s \right)}\\ {c\left( s \right)}&{d\left( s \right)}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}0\\ {{q_{source}}\left( s \right)}\end{array}} \right]$$</div>

where:  <span>$\left[ {\begin{array}{*{20}{c}}{A\left( s \right)}&{B\left( s \right)}\\ {C\left( s \right)}&{D\left( s \right)}\end{array}} \right] = \prod\limits_{i = 1}^n {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} $</span>  and  <span>$\left[ {\begin{array}{*{20}{c}}{a\left( s \right)}&{b\left( s \right)}\\ {c\left( s \right)}&{d\left( s \right)}\end{array}} \right] = \prod\limits_{i = 1}^m {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} $</span> .

Next, Equation must be rearranged to match the form of Equation , which relates the heat flux at both sides of the element to the temperature at each side.  The matrix equation that is obtained shows that:

<div>$$\left[ {\begin{array}{*{20}{c}}{{q_1}\left( s \right)}\\ {{q_{n + 1}}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{{D\left( s \right)}}{{B\left( s \right)}}}&{\frac{{ - 1}}{{B\left( s \right)}}}\\ {\frac{1}{{B\left( s \right)}}}&{\frac{{ - A\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{T_{n + 1}}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{d\left( s \right) - \frac{{D\left( s \right)b\left( s \right)}}{{B\left( s \right)}}}\\ {\frac{{b\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {{q_{source}}\left( s \right)} \right]$$</div>

This equation bears a striking resemblance to Equation .  If the source term in Equation is dropped, then the equation is identical to Equation .  This result conforms with the superposition principle which was used to develop the conduction transfer functions from the summation of a series of triangular pulses or ramp sets.  Now, the effect of the heat source is simply added to the response to the temperature inputs.

While Equation is correct for any single or multilayered element, the first term in the heat source transmission matrix does not appear to match the compactness of the other terms in the matrix equation.  It can be shown (see Strand 1995: equations 32 through 42 which detail this derivation) that the heat source transmission term for a two-layer problem reduces to

<div>$$\left[ {\begin{array}{*{20}{c}}{{q_1}\left( s \right)}\\ {{q_3}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{{D\left( s \right)}}{{B\left( s \right)}}}&{\frac{{ - 1}}{{B\left( s \right)}}}\\ {\frac{1}{{B\left( s \right)}}}&{\frac{{ - A\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{T_3}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{\frac{{{B_2}\left( s \right)}}{{B\left( s \right)}}}\\ {\frac{{{B_1}\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {{q_{source}}\left( s \right)} \right]$$</div>

If this is extended to a slab with n layers and a source between the m and m+1 layers, the general matrix equation for obtaining heat source transfer functions using the Laplace transform method is:

<div>$$\left[ {\begin{array}{*{20}{c}}{{q_1}\left( s \right)}\\ {{q_{n + 1}}\left( s \right)}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{{D\left( s \right)}}{{B\left( s \right)}}}&{\frac{{ - 1}}{{B\left( s \right)}}}\\ {\frac{1}{{B\left( s \right)}}}&{\frac{{ - A\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}\left( s \right)}\\ {{T_{n + 1}}\left( s \right)}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{\frac{{\bar b\left( s \right)}}{{B\left( s \right)}}}\\ {\frac{{b\left( s \right)}}{{B\left( s \right)}}}\end{array}} \right]\left[ {{q_{source}}\left( s \right)} \right]$$</div>

where: <span>$\left[ {\begin{array}{*{20}{c}}{A\left( s \right)}&{B\left( s \right)}\\ {C\left( s \right)}&{D\left( s \right)}\end{array}} \right] = \prod\limits_{i = 1}^n {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} $</span> ,

<span>$\left[ {\begin{array}{*{20}{c}}{a\left( s \right)}&{b\left( s \right)}\\ {c\left( s \right)}&{d\left( s \right)}\end{array}} \right] = \prod\limits_{i = 1}^m {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} $</span> , and

<span>$\left[ {\begin{array}{*{20}{c}}{\bar a\left( s \right)}&{\bar b\left( s \right)}\\ {\bar c\left( s \right)}&{\bar d\left( s \right)}\end{array}} \right] = \prod\limits_{i = m + 1}^n {\left[ {\begin{array}{*{20}{c}}{{A_i}\left( s \right)}&{{B_i}\left( s \right)}\\ {{C_i}\left( s \right)}&{{D_i}\left( s \right)}\end{array}} \right]} $</span> .

At first glance, the terms in the heat source transmission matrix may appear to be reversed.  It is expected that only the layers to the left of the source will affect q1(s), but the presence of <span>$\bar b\left( s \right)$</span> in the element multiplied by qsource(s) to obtain q1(s) seems to be contradictory.  In fact, the entire term, <span>${{\bar b\left( s \right)} \mathord{\left/ {\vphantom {{\bar b\left( s \right)} {B\left( s \right)}}} \right. } {B\left( s \right)}}$</span>, must be analyzed to determine the effect of qsource(s) on q1(s).  In essence, the appearance of <span>$\bar b\left( s \right)$</span> removes the effects of the layers to the right of the source from B(s) leaving only the influence of the layers to the left of the source.  The form displayed by Equation is, however, extremely convenient because the terms in the heat source transmission matrix have the same denominators, and thus roots, as the terms in the temperature transmission matrix.  Thus, the same roots that are calculated for the CTFs can be used for the QTFs, saving a considerable amount of computer time during the calculation of the transfer functions.

Once Equation is inverted from the Laplace domain back into the time domain, the combined CTF–QTF solution takes the following form:

<div>$${q''_{i,t}} = \sum\limits_{m = 1}^M {{X_m}{T_{i,t - m + 1}}}  - \sum\limits_{m = 1}^M {{Y_m}{T_{o,t - m + 1}}}  + \sum\limits_{m = 1}^k {{F_m}{{q''}_{i,t - m}}}  + \sum\limits_{m = 1}^M {{W_m}{q_{source,t - m + 1}}} $$</div>

This relation is identical to Equation except for the presence of the QTF series that takes the heat source or sink into account.

#### State Space Formulation

The two-node example introduced by Seem (1987) can be utilized to examine the extension of the state space method to include heat sources or sinks.  Figure 270 shows the simple two node network with a heat source added at node 1.

The nodal equations for the finite difference network shown in Figure 270 are:

<div>$$C\frac{{d{T_1}}}{{dt}} = hA\left( {{T_o} - {T_1}} \right) + \frac{{{T_2} - {T_1}}}{R} + {q_{source}}A$$</div>

<div>$$C\frac{{d{T_2}}}{{dt}} = hA\left( {{T_i} - {T_2}} \right) + \frac{{{T_1} - {T_2}}}{R}$$</div>

<div>$${q''_i} = h\left( {{T_i} - {T_2}} \right)$$</div>

<div>$${q''_o} = h\left( {{T_1} - {T_o}} \right)$$</div>

![](EngineeringReference/media/image6034.svg.png)

Figure 270.  Two Node State Space Example with a Heat Source

In obtaining the matrix equivalent for this set of equations, it should be noted that the source term is not a constant but rather an input that varies with time.  Thus, it must be grouped with the environmental temperatures as inputs.  The resulting matrix equations take the following form:

<div>$$\left[ {\begin{array}{*{20}{c}}{\frac{{d{T_1}}}{{dt}}}\\ {\frac{{d{T_2}}}{{dt}}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}{\frac{{ - 1}}{{RC}} - \frac{{hA}}{C}}&{\frac{1}{{RC}}}\\ {\frac{1}{{RC}}}&{\frac{{ - 1}}{{RC}} - \frac{{hA}}{C}}\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ {{T_2}}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}{\frac{{hA}}{C}}&0&{\frac{A}{C}}\\0&{\frac{{hA}}{C}}&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_o}}\\ {{T_i}}\\ {{q_{source}}}\end{array}} \right]$$</div>

<div>$$\left[ {\begin{array}{*{20}{c}}{{{q''}_1}}\\ {{{q''}_2}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}0&{ - h}\\h&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ {{T_2}}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}0&h&0\\ { - h}&0&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_o}}\\ {{T_i}}\\ {{q_{source}}}\end{array}} \right]$$</div>

Equation appears to suggest that the source term has no direct effect on the heat flux at either side of the element because its coefficients are zero.  This is not the case.  Equation only relates variables that have a direct influence on heat flux.  So, while Ti has no direct influence on<span>${q''_o}$</span>, it does have an indirect influence through the nodal network.  The same would hold for the influence of qsource.

If this analysis is extended to a finite difference network with n nodes, the corresponding matrix equations can be shown to be:

<div>$$\frac{{d\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right]}}{{dt}} = \left[ A \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right] + \left[ B \right]\left[ {\begin{array}{*{20}{c}}{{T_o}}\\ {{T_i}}\\ {{q_{source}}}\end{array}} \right]$$</div>

<div>$$\left[ {\begin{array}{*{20}{c}}{{{q''}_i}}\\ {{{q''}_o}}\end{array}} \right] = \left[ C \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right] + \left[ D \right]\left[ {\begin{array}{*{20}{c}}{{T_o}}\\ {{T_i}}\\ {{q_{source}}}\end{array}} \right]$$</div>

The influence of the heat source is also confirmed by the final solution form, which is identical to the Laplace transform result shown in Equation .  As with the Laplace solution method, the state space method results in a set of QTFs that relate the heat source at the current time step and several previous time steps to the current heat flux at the surface of the element.

Other similarities between the two solution methods are evident.  It is interesting to note that as with the Laplace method there is no alteration of the CTFs calculated by the state space method.  Thus, the principle of superposition is still valid.  Furthermore, the introduction of the source term did not substantially increase the computing effort required to calculate the additional transfer functions.  In the Laplace method, this was shown by the common roots, B(s), shared by both the CTFs and the QTFs.  In the state space method, it can be noted that the A matrices in Equations and are identical.  Since the state space method requires the inversion and the exponentiation of the A matrix only, the additional QTF terms will not require a substantial amount of additional computing time for their calculation.

#### Determination of Internal Temperatures

One aspect of low temperature radiant systems that has not been addressed to this point is the appropriateness of specifying the effect of the system on slab response via a heat source term.  For a heating system that employs electrical resistance heating, the use of a heat source as the input variable is logical.  The heat produced by such a system can easily be related to the current passing through the heating wire.  However, for a hydronic heating or cooling system, the known quantity is not heat but rather the temperature of the water being sent to the building element.

The use of a temperature to simulate the presence of a heating or cooling system presents one major obstacle.  When fluid is not being circulated, there is no readily available temperature value available for use as an input variable.

In a hydronic system, a link between the fluid temperature being sent to the slab and the heat delivered to the slab exist.  The most effective way of relating these two variables is to consider the slab to be a heat exchanger.  Using heat exchanger relationships, an equation could then be formulated to obtain the heat delivered to the slab based on the inlet fluid temperature.

Most heat exchangers are used to thermally link two fluids.  In the case of a hydronic radiant system, there is only one fluid and a stationary solid.  Presumably, if the inlet fluid temperature, the system geometry, and the solid temperature are known, then the outlet temperature and thus the heat transfer to the building element can be computed.  This leads to an interesting question:  what is the solid temperature?

By definition, for one dimensional conduction heat transfer, the solid temperature is the temperature of the building element at the depth where the hydronic loop is located.  Typically, this temperature is not known because it is not needed.  The goal of both methods of calculating CTFs was the elimination of internal temperatures that were not needed for the simulation.  For a hydronic system, it is necessary to extract this information to solve for the heat source term.  Two methods of accomplishing this are described below.

Returning to the two layer example shown in Figure 269, it can be shown that the final solution form in the time domain for the slab with a source at the interface between the two layers is:

<div>$${q''_{1,t}} = \sum\limits_{m = 1}^M {{X_{k,m}}{T_{1,t - m + 1}}}  - \sum\limits_{m = 1}^M {{Y_{k,m}}{T_{3,t - m + 1}}}  + \sum\limits_{m = 1}^k {{F_m}{{q''}_{1,t - m}}}  + \sum\limits_{m = 1}^M {{W_m}{q_{source,t - m + 1}}} $$</div>

A similar equation could be written for the response of the first layer in absence of any source term and is given by:

<div>$${q''_{1,t}} = \sum\limits_{m = 1}^M {{x_{k,m}}{T_{1,t - m + 1}}}  - \sum\limits_{m = 1}^M {{y_{k,m}}{T_{2,t - m + 1}}}  + \sum\limits_{m = 1}^k {{f_m}{{q''}_{1,t - m}}} $$</div>

While the current temperature at the interface is not known, presumably the previous values of this parameter will be known.  In addition, the temperatures and the flux histories at surface 1 are also know.  The unknowns in Equation are the current heat flux at surface 1 and the temperature at surface 2.  However, Equation does define the current value of the heat flux at surface 1 based on temperature, heat flux, and heat source histories.  Thus, if this value is used in Equation , the only remaining unknown in this equation is the current temperature at surface 2, the surface where the heat source or sink is present.  Rearranging Equation provides an equation from which the temperature at the source location may be calculated:

<div>$${T_{2,t}} = \sum\limits_{m = 1}^M {{{\bar X}_{k,m}}{T_{1,t - m + 1}}}  - \sum\limits_{m = 1}^{M - 1} {{{\bar Y}_{k,m}}{T_{2,t - m}}}  + \sum\limits_{m = 1}^{k + 1} {{{\bar F}_m}{{q''}_{1,t - m + 1}}} $$</div>

where the new coefficients are obtained from the standard conduction transfer functions for the first layer via the following equations:

<div>$${\bar X_{k,m}} = \frac{{{x_{k,m}}}}{{{y_1}}}\left( {m = 1, \cdots ,M} \right)$$</div>

<div>$${\bar Y_{k,m}} = \frac{{{y_{k,m + 1}}}}{{{y_1}}}\left( {m = 1, \cdots ,M - 1} \right)$$</div>

<div>$${\bar F_1} = \frac{1}{{{y_1}}}$$</div>

<div>$${\bar F_m} = \frac{{{f_{m - 1}}}}{{{y_1}}}\left( {m = 2, \cdots ,k + 1} \right)$$</div>

This system for backing out an internal temperature through the use of a second, rearranged CTF equation is valid regardless of whether the Laplace transform or state space method is utilized to calculate the CTFs and QTFs.  The state space method, however, offers a more direct method of obtaining an internal temperature through its definition as an additional output variable.

Consider again the state space example shown in Figure 270.  Two output variables were defined for this example: <span>${q''_i}$</span> and <span>${q''_o}$</span>.  The temperature of the node where the source is present can also be defined as an output variable through the identity equation:

<div>$${T_1} = {T_1}$$</div>

When this equation for T1 is added to Equation , the resulting output matrix equation for the heat flux at both surfaces and the internal temperature is:

<div>$$\left[ {\begin{array}{*{20}{c}}{{{q''}_i}}\\ {{{q''}_o}}\\ {{T_1}}\end{array}} \right] = \left[ {\begin{array}{*{20}{c}}0&{ - h}\\h&0\\1&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ {{T_2}}\end{array}} \right] + \left[ {\begin{array}{*{20}{c}}0&h&0\\ { - h}&0&0\\0&0&0\end{array}} \right]\left[ {\begin{array}{*{20}{c}}{{T_i}}\\ {{T_o}}\\ {{q_{source}}}\end{array}} \right]$$</div>

The only difference between this relation and Equation is the presence of T1 on both the right and left hand side of the equation.  The dual role of T1 as a state variable and an output parameter may seem to contradict the goal of the state space method of eliminating the state variables.  However, due to the flexibility of the formulation, nodal temperatures can be extracted in the same manner that any other output quantity would be obtained.  For an element with n layers, Equation becomes:

<div>$$\left[ {\begin{array}{*{20}{c}}{{{q''}_i}}\\ {{{q''}_o}}\\ {{T_s}}\end{array}} \right] = \left[ C \right]\left[ {\begin{array}{*{20}{c}}{{T_1}}\\ \vdots \\ {{T_n}}\end{array}} \right] + \left[ D \right]\left[ {\begin{array}{*{20}{c}}{{T_i}}\\ {{T_o}}\\ {{q_{source}}}\end{array}} \right]$$</div>

where Ts is the temperature of the node where the heat source or sink is present.  The transfer function equation for the calculation of Ts that results from Equation is identical in form to Equation :

<div>$${T_{s,t}} = \sum\limits_{m = 1}^M {{x_{k,m}}{T_{i,t - m + 1}}}  - \sum\limits_{m = 1}^M {{y_{k,m}}{T_{o,t - m + 1}}}  + \sum\limits_{m = 1}^k {{f_m}{T_{s,t - m}}}  + \sum\limits_{m = 1}^M {{w_m}{q_{source,t - m + 1}}} $$</div>

Instead of the flux at either side of the element characterized as a function of temperature, flux, and source history terms, the temperature at the source location is related to source and temperature histories including histories of Ts.  The validity of these internal temperature calculation methods as well as heat source transfer functions in general will be discussed in the next chapter.

#### Low Temperature Radiant System Controls

The use of this equation allows the low temperature radiant system to be handled like any other surface within the heat balance framework.  Heat balances at the inside and outside surfaces take on the same form as other surfaces, and the participation of the radiant system in the radiation balance within the space and thermal comfort models is automatically included.  Thus, the radiant system model is fully integrated into the heat balance, and any improvements that are made in areas such as convection coefficients, shading models, etc. are immediately available to the radiant system as part of the overall heat balance solution.

Once the transient nature of the system is accounted for, one must then turn to the next difficult issue: controls.  Controls are problematic for almost any simulation program.  The problem is not whether something can be simulated because typically a simulation program offers the ability to experiment with many different control strategies.  Rather, the problem is typically the diversity of controls that are implemented and keeping the controls that can be simulated up to date.  EnergyPlus offers two different control schemes: variable flow (ZoneHVAC:LowTemperatureRadiant:VariableFlow) and variable temperature (ZoneHVAC:LowTemperatureRadiant:ConstantFlow).  The control strategies are different enough that they were developed as separate system types.  More details of the controls are described below.

The controls for variable flow low temperature radiant systems within EnergyPlus are fairly simple though there is some flexibility through the use of schedules.  The program user is allowed to define a setpoint temperature as well as a throttling range through which the system varies the flow rate of water (or current) to the system from zero to the user defined maximum flow rate.  The flow rate is varied linearly with the flow reaching 50% of the maximum when the controlling temperature reaches the setpoint temperature.  Setpoint temperatures can be varied on an hourly basis throughout the year if desired.  The controlling temperature can be the mean air temperature, the mean radiant temperature, or the operative temperature of the zone, and this choice is also left to the user’s discretion.  (Operative temperature for radiant system controls is the average of MAT and MRT.)  Since flow rate is varied, there is no explicit control on the inlet water temperature or mixing to achieve some inlet water temperature in a hydronic system.  However, the user does have the ability to specify on an hourly basis through a schedule the temperature of the water that would be supplied to the radiant system.

Graphical descriptions of the controls for the low temperature radiant system model in EnergyPlus are shown in Figure 271 for a hydronic system.  In a system that uses electric resistance heating, the power or heat addition to the system varies in a manner similar to mass flow rate variation shown in Figure 271.

In the constant flow-variable temperature systems, the controls are also considered piecewise linear functions, but in this case the user selects both the control temperatures and the water temperatures via schedules.  This offers greater flexibility for defining how the radiant system operates though it may not model every situation.  Figure 272 shows how the “desired” inlet water temperature is controlled based on user schedules.  The user has the ability to specify the high and low water and control temperature schedules for heating and cooling (separately; a total of eight temperature schedules).  Note that this inlet temperature is a “desired” inlet temperature in that there is no guarantee that the system will provide water to the system at that temperature.  The model includes a local loop that attempts to meet this demand temperature through mixing and recirculation.

![](EngineeringReference/media/image6053.png)

Figure 271.  Variable Flow Low Temperature Radiant System Controls

![](EngineeringReference/media/image6054.png)

Figure 272.  Variable Temperature Low Temperature Radiant System Controls

The constant flow (variable temperature) low temperature radiant system model is actually a combination of mixing valves, a pump (constant speed, but the maximum flow can be modified by a schedule), and the radiant system (surface, panel, or group of surfaces/panels).  This is connected to the main loop through the standard inlet connections as shown in Figure 273.  The system controls determine the desired inlet temperature and system flow rate while loop controls determine the flow rate and temperature of the loop.  Note that pump heat also factors into the model through a simple constant speed pump model and user input.

There are four possible conditions (separate for heating and cooling).  First, if the loop has adequate temperature and flow to meet system requests, then the model sets the radiant system inlet temperature and controls to the desired values based on the controls and simulates.  This is the best condition and recirculation and bypass amounts are adjusted accordingly based on radiant system outlet temperatures.  Second, if the loop temperature is adequate but the loop flow rate is less than the radiant system flow rate, we may or may not be able to meet the desired inlet temperature since recirculation might lower the temperature below the desired temperature.  In this second case, the model first simulates the radiant system with the desired conditions and then resimulates it to solve for the actual inlet temperature (see later in this section) if it cannot achieve the desired inlet temperature.  Third, if the loop flow is greater than the radiant flow but the temperature of the loop is not adequate, then there is no amount of mixing that will solve this problem.  All of the radiant flow comes from the loop and the loop temperature (after pump heat addition) becomes the radiant system inlet regardless of the temperature controls.  Finally, if both the temperature and the flow of the loop are inadequate, then the model simply solves for the actual radiant system inlet temperature and does not try to meet the controls (merely tries to get as close as physically possible given the loop conditions).

![](EngineeringReference/media/image6055.png)

Figure 273.  Variable Temperature Low Temperature Radiant System Component Details

One remaining challenge is the merging of the low temperature radiant system model with an integrated building simulation program.  In the past, most simulation programs have simulated the building envelope, the space conditioning systems, and the central plant equipment in three separate steps.  While this had some advantages and was partly due to a lack of computing capacity, the large drawback for this arrangement is that there is no feedback from the space conditioning system or central plant response to the building conditions.  Thus, if the system or plant was undersized, it was reported as an “unmet load” and does not affect the temperatures experienced within the building.  IBLAST, a predecessor (Taylor 1991) to EnergyPlus, resolved this issue by integrating all three major components of a building simulation and thus allowing feedback between the equipment and the building envelope.

This integration was not a trivial task and required that the systems be simulated at shorter time steps in some cases to maintain solution stability.  In essence, the system simulation will shorten its time step whenever it senses that conditions are changing too rapidly.  While this is effective in maintaining solution stability, it can present problems for a radiant system.  The radiant system has either a direct or an indirect impact on the surfaces within a building.  So, it must be simulated with the building envelope.  Yet, it is also a space conditioning system that must act on the space like any other system and thus must also be simulated at the system time step, which can be less than the building time step and can also vary within EnergyPlus.

This issue was handled using a multi-step approach.  In EnergyPlus, the heat balance is always simulated first.  When this happens, the radiant system is temporarily shut-off to find how the building would respond if there was no heat source/sink.  Then, as the system and plant are simulated at multiple shorter time steps, the radiant system is allowed to operate per the controls specified by the user.  Flow rate is allowed to vary at each system time step, and the radiant system model is simulated at each time step as if the current flow rate was being used throughout the entire zone time step.  This means that each time the heat source/sink in the radiant system is varied during the system simulation the zone heat balance must be recomputed to see what the reaction of the rest of the zone is to this change in the conditions of one (or more) of the surfaces.

In reality, this is not physically correct because each change in the flow rate throughout the system simulation will have an impact on the system time steps remaining before the heat balance is simulated during the next zone time step.  Yet, other approaches to solving the mismatch between the system and the zone response of radiant systems are not feasible.  One could force the system to run at the same time step as the zone, but this could result in instabilities in other types of systems that might be present in the simulation.  On the other hand, one could try to force the zone to run at the shorter time steps of the system, but this could lead to instability within the heat balance due to limits on the precision of the conduction transfer function coefficients.

Despite the fact that the simulation algorithm described above may either over- or under-predict system response dependent on how the system has been controlled in previous system time steps, it is reasonable to expect that the effect of these variations will balance out over time even though it might lead to slightly inaccurate results at any particular system time step.  The long-term approach is also in view in the final simulation step at each zone time step.  After the system has simulated through enough system time steps to equal a zone time step, the radiant system will rerun the heat balance using the average heat source/sink over all of the system time steps during the past zone time step.  This maintains the conservation of energy within the heat balance simulation over the zone time steps and defines more appropriate temperature and flux histories at each surface that are critical to the success of a conduction transfer function based solution.  A graphical picture of this somewhat complex multiple step simulation is shown in the figure below.

![](EngineeringReference/media/image6056.png)

Figure 274.  Resolution of Radiant System Response at Varying Time Steps

#### Heat Exchanger Formulation for Hydronic Systems

As has been mentioned previously, the actual heat transferred between the building element and the hydronic loop is related to the temperature of the building element at the source location as well as the water system inlet and outlet temperatures.  In EnergyPlus, it is assumed that the inlet temperature to the slab (defined by a user schedule and the plant simulation) and the mass flow rate (determined by the control algorithm) are known and that the remaining parameters must be calculated.  However, the heat balance equations require the heat transferred to the building element from the water loop in order to calculate the heat transferred from the element to the building environment.

Even though systems defined by this model can vary somewhat, the same characteristic link between the system variables exist.  For modeling purposes, the overall water/slab system can be thought of as a heat exchanger.  While in principle there are two alternative heat exchanger methodologies, it is more convenient to use the effectiveness-NTU method in this case.

Several assumptions will be incorporated into the heat exchanger analysis.  It is assumed that the building element that contains the hydronic loop is stationary and that its temperature along the length of the tubing is constant.  The latter part of this assumption stems from assumptions made in both the one and two dimensional heat source transfer function derivations.  In either case, the source was added at a single node that was characterized by a single temperature.  For consistency, this assumption must be made again in the heat exchanger analysis.  Another assumption for the current EnergyPlus model is that the fluid in the tubing is water.  Additionally, it is assumed that the thermal properties of the water do not vary significantly over the length of the tubing and that the water flows at a constant flow rate.  Finally, the temperature at the inside surface of the water tubing is assumed to be equal to the temperature at the source location.  In other words, it is assumed that the water tubing itself has no appreciable effect on the heat transfer process being modeled.

Using these assumptions and the effectiveness-NTU heat exchanger algorithm, several equations can be defined which establish the relationship between the heat source and the water temperatures.  First, a heat balance on the water loop results in:

<div>$$q = {\left( {\dot m{c_p}} \right)_{water}}\left( {{T_{wi}} - {T_{wo}}} \right)$$</div>

where q is the energy transferred between the water loop and the building element, <span>$\dot m$</span> is the mass flow rate of the water, cp is the specific heat of the water, Twi is the inlet water temperature, and Two is the outlet water temperature.

The maximum amount of heat transfer that is possible according to the Second Law of Thermodynamics is:

<div>$${q_{\max }} = {\left( {\dot m{c_p}} \right)_{water}}\left( {{T_{wi}} - {T_s}} \right)$$</div>

where qmax is the maximum amount of energy transfer that is possible and Ts is the temperature at the source location.

The effectiveness of the heat exchanger, e, is defined as the ratio of the actual energy transfer to the maximum possible, or:

<div>$$\varepsilon  \equiv \frac{q}{{{q_{\max }}}}$$</div>

For a heat exchanger where one fluid is stationary, the effectiveness can be related to NTU, the number of transfer units, by the following equation (Incropera and DeWitt 1985):

<div>$$\varepsilon  = 1 - {e^{ - NTU}}$$</div>

where NTU is defined by:

<div>$$NTU \equiv \frac{{UA}}{{{{\left( {\dot m{c_p}} \right)}_{water}}}}$$</div>

Since the water tubes were assumed to have no effect on the heat transfer process, the only term present in the overall heat transfer coefficient, UA, is a convection term.  Thus, the equation for UA is:

<div>$$UA = h\left( {\pi DL} \right)$$</div>

where h is the convection coefficient, D is the interior tube diameter, and L is the total length of the tube.

The convection coefficient can be obtained from internal flow correlations that relate the Nusselt dimensionless number to other flow properties.  For laminar flow in a tube of constant surface temperature, the Nusselt number is defined by:

<div>$$N{u_D} = \frac{{hD}}{k} = 3.66$$</div>

where k is the thermal conductivity of the water.

For turbulent internal flow, the Colburn equation can be used to define the Nusselt number:

<div>$$N{u_D} = \frac{{hD}}{k} = 0.023{\mathop{\rm Re}\nolimits}_D^{{4 \mathord{\left/ {\vphantom {4 5}} \right. } 5}}{\Pr ^{{1 \mathord{\left/ {\vphantom {1 3}} \right. } 3}}}$$</div>

where Pr is the Prandtl number of water and ReD is the Reynolds number which is defined by:

<div>$${{\mathop{\rm Re}\nolimits}_D} = \frac{{4\dot m}}{{\pi \mu D}}$$</div>

The parameter m is the absolute viscosity of water.  For internal pipe flow, the flow is assumed to be turbulent for ReD ≥ 2300.

Knowledge of the flow conditions allows Equations through to be calculated.  This essentially eliminates e as an unknown in Equation .  The controls and the plant define the water mass flow rate and the inlet water temperature, leaving two equations (Equations and ) and three unknowns.  The third equation that can be used in conjunction with Equations and is Equation , which is the CTF/QTF equation for the temperature at the source location.

Knowing the inlet water temperature and water mass flow rate, the calculation procedure is somewhat involved and requires, in addition to Equations , , and , the use of a modified form of Equation .  Equation is the standard conduction transfer function formula for a building element with an embedded source/sink of heat.  In EnergyPlus, the surface flux on the left hand side of the equation is replaced with a surface heat balance:

<div>$$\left[ {\begin{array}{*{20}{c}}{Surface}\\ {Heat}\\ {Balance}\end{array}} \right] = \sum\limits_{m = 1}^M {{X_{k,m}}{T_{1,t - m + 1}}}  - \sum\limits_{m = 1}^M {{Y_{k,m}}{T_{3,t - m + 1}}}  + \sum\limits_{m = 1}^k {{F_m}{{q''}_{1,t - m}}}  + \sum\limits_{m = 1}^M {{W_m}{q_{source,t - m + 1}}} $$</div>

The surface heat balance includes terms for incident solar energy, radiation heat transfer from internal heat sources such as lights and electrical equipment, radiation between surfaces using Hottel’s Gray Interchange concept, and convection to the surrounding air.  The presence of the surface temperature in the heat balance does not pose any problems since Equation will be rearranged to solve for this temperature.  Since the radiation heat balance is dependent on conditions at the other surfaces, an iteration loop is required to provide a more accurate estimate of the radiative exchange within the building.  This is not the case with the mean air temperature.  An assumption of the heat balance is that the mean temperature of the surrounding air is equal to the final air temperature of the previous time step.  Using this estimate in the heat balance avoids a second iterative loop around the radiative iteration loop.

Thus, the terms of the heat balance on the left hand side of the equation have been set with the only unknown quantity being Ti, the inside surface temperature at the current time step.  On the right hand side of Equation , most of the terms are already defined since they depend on known values from previous time steps (temperature, flux, and source histories).  The only terms which are not defined are the inside surface temperature (Ti), outside surface temperature (To), and internal heat source/sink (qsource) of the current time step.

The outside surface temperature will depend on the type of environment to which it is exposed.  For example, if the surface is a slab on grade floor, the outside surface temperature is defined as ground temperature and does not require an outside surface heat balance.  If the element is an interior surface which has both surfaces exposed to the same air space, the outside surface temperature is redefined to be equal to the inside surface temperature.  In cases where the outside surface temperature is not simply defined such as a surface exposed to the exterior environment, a heat balance similar to Equation is required to define the outside surface temperature.  However, to again avoid iteration, the heat balance equation for the outside surface assumes that conditions at the inside surface were the same as the previous time step.  In most cases, since the influence of the current inside surface temperature on the outside surface temperature is very small, this is a valid assumption.  In cases were the inside surface temperature has a significant effect, an approximate inside surface heat balance which defines the inside surface temperature is used.  This approximate inside balance uses mean air and radiant temperatures from the previous time step.

At this point in the simulation algorithm then, all of the terms in Equation have been defined except the value at the current time step of the inside surface temperature and the heat source/sink.  Thus, Equation can be rewritten in a simpler form:

<div>$${T_{i,t}} = {C_1} + {C_2}{q_{source,t}}$$</div>

where the variable C1 includes surface heat balance and past history terms as well as the influence of the current outside temperature.  The term C2 will depend on the heat source transfer function term and the coefficients of terms linked directly to Ti,t.

Equation , which was the CTF/QTF equation for the temperature at the source location, can be simplified in a similar manner.  Grouping the temperature and source history terms which are known quantities together with the effect of the outside surface temperature which is defined as described above, the original equation

<div>$${T_{s,t}} = \sum\limits_{m = 1}^M {{x_{k,m}}{T_{i,t - m + 1}}}  - \sum\limits_{m = 1}^M {{y_{k,m}}{T_{o,t - m + 1}}}  + \sum\limits_{m = 1}^k {{f_m}{T_{s,t - m}}}  + \sum\limits_{m = 1}^M {{w_m}{q_{source,t - m + 1}}} $$</div>

can be reduced to:

<div>$${T_s} = {C_3} + {C_4}{q_{source,t}} + {C_5}{T_{i,t}}$$</div>

where C3 includes all of the history terms and the effect of the current outside temperature, C4 is the heat source transfer function for the current time step, and C5 is the conduction transfer function for the inside surface temperature at the current time step.

Substituting Equation into Equation and noting that qsource,t is the same quantity as q in Equations and results in:

<div>$${T_s} = {C_3} + {C_4}q + {C_5}\left( {{C_1} + {C_2}q} \right)$$</div>

When this equation is combined with Equation , the heat source, which results from a known water inlet temperature, can be shown to be:

<div>$$q = \frac{{{T_{wi}} - {C_3} - {C_1}{C_5}}}{{\frac{1}{{\varepsilon {{\left( {\dot m{c_p}} \right)}_{water}}}} + {C_4} + {C_2}{C_5}}}$$</div>

With both q and Twi known, it is a trivial matter to calculate Two and Ts from Equations and , respectively.  Even though the coefficients in Equation are fairly complex, the final equation relating the heat source directly to inlet water temperature is compact and does not require any iteration.  As with flux control, once the heat source/sink is defined, the inside surface heat balance can be performed to determine the surface temperatures.

It should be noted that Equations through are a slight simplification of the actual implementation in EnergyPlus.  The development shown above follows the heat balance conventions that assume previous values of the inside temperature to calculate the outside temperature.  This, in reality, is not necessary and since the radiant system can be significantly influenced by the delay that such an assumption might cause, the initial implementation of radiant systems in EnergyPlus used a development (shown below) that does not lag either the inside or the outside surface temperature.  In effect, we can establish three basic equations for the temperature at the inside and outside surface as well as at the location of the heat source/sink:

<div>$${T_{inside}} = {C_a} + {C_b}{T_{outside}} + {C_C}q''$$</div>

<div>$${T_{outside}} = {C_d} + {C_e}{T_{inside}} + {C_f}q''$$</div>

<div>$${T_{source}} = {C_g} + {C_h}q'' + {C_i}{T_{inside}} + {C_j}{T_{outside}}$$</div>

where:  T<sub>inside</sub> is the temperature at the inside surface

T<sub>outside</sub> is the temperature at the outside surface

T<sub>source</sub> is the temperature within the radiant system at the location of the source/sink

C<sub>a</sub> is all of the other terms in the inside heat balance (solar, LW exchange, conduction history terms, etc.)

C<sub>b</sub> is the current cross CTF term

C<sub>c</sub> is the QTF inside term for the current heat source/sink

C<sub>d</sub> is all of the other terms in the outside heat balance (solar, LW exchange, conduction history terms, etc.)

C<sub>e</sub> is the current cross CTF term (should be equal to Cb)

C<sub>f</sub> is the QTF outside term for the current heat source/sink

C<sub>g</sub> is the summation of all temperature and source history terms at the source/sink location

C<sub>h</sub> is the QTF term at the source/sink location for the current heat source/sink

C<sub>i</sub> is the CTF inside term for the current inside surface temperature

C<sub>j</sub> is the CTF outside term for the current outside surface temperature

Equations and above can be solved to remove the other surface temperature.  Substituting the new equations for T<sub>inside</sub> and T<sub>outside</sub> as a function of C and q" into the equation for Tsource and simplifying results in the following equation:

<div>$${T_{source}} = {C_k} + {C_l}q''$$</div>

where:         <span>${C_k} = {C_g} + \frac{{{C_i}\left( {{C_a} + {C_b}{C_d}} \right) + {C_j}\left( {{C_d} + {C_e}{C_a}} \right)}}{{1 - {C_e}{C_b}}}$</span>

<div>$${C_l} = {C_h} + \frac{{{C_i}\left( {{C_c} + {C_b}{C_f}} \right) + {C_j}\left( {{C_f} + {C_e}{C_c}} \right)}}{{1 - {C_e}{C_b}}}$$</div>

Combining this with heat exchanger analysis as shown above, we eventually arrive at the following equation to relate the flux to the slab to the water inlet temperature and mass flow rate:

<div>$$q'' = \frac{{{T_{water,in}} - {C_k}}}{{\frac{{{C_l}}}{A} + \frac{1}{{\varepsilon {{\left( {\dot m{c_p}} \right)}_{water}}}}}}$$</div>

which includes all of the inside and outside heat balance terms (“hidden” in the C<sub>k</sub> and C<sub>l</sub> coefficients).  Once the flux to the slab is known, the remaining terms of interest (outlet water temperature, inside and outside surface temperatures, etc.) can be calculated using the relatively simpler equations shown above.

Note that the above development is valid for both the hydronic (variable flow) low temperature radiant system and for constant flow (variable temperature) low temperature radiant systems where the inlet temperature is known (based on controls).  However, when due to loop conditions and the presence of recirculation, it is not possible to know the inlet temperature to the radiant system without simulating it, we must either iterate or perform more mathematics to arrive at the inlet temperature.  The implementation in EnergyPlus chose to avoid iteration and solved for the inlet temperature as shown in the next paragraphs.

The previous equation combines with the following equation which is valid for an surface in the current radiant system:

<div>$${{\rm{q}}_{\rm{j}}}{\rm{  =  }}{{\rm{\dot m}}_{\rm{j}}}{{\rm{c}}_{\rm{p}}}{\rm{(}}{{\rm{T}}_{{\rm{water,in}}}}{\rm{  -  }}{{\rm{T}}_{{\rm{water,out,j}}}}{\rm{)}}$$</div>

where q<sub>j</sub> is the heat transfer to the jth surface in the radiant system, m<sub>j</sub> is the mass flow rate only to this surface, and T<sub>water,out,j</sub> is the outlet temperature for the jth surface.  Combining the previous two equations results in:

<div>$${\rm{(}}{{\rm{T}}_{{\rm{water,in}}}}{\rm{  -  }}{{\rm{T}}_{{\rm{water,out,j}}}}{\rm{)}} = \frac{{{\varepsilon_j}\left( {{{\rm{T}}_{{\rm{water,in}}}} - {C_{k,j}}} \right)}}{{1 + \frac{{{\varepsilon_j}{{\dot m}_j}{c_p}{C_{l,j}}}}{A}}}$$</div>

If for each surface in the radiant system, we let:

<div>$${{\rm{C}}_{m,j}} = \frac{{{\varepsilon_j}}}{{1 + \frac{{{\varepsilon_j}{{\dot m}_j}{c_p}{C_{l,j}}}}{A}}}$$</div>

then the previous equations because the slightly less complex:

<div>$${\rm{(}}{{\rm{T}}_{{\rm{water,in}}}}{\rm{  -  }}{{\rm{T}}_{{\rm{water,out,j}}}}{\rm{)}} = {C_{m,j}}\left( {{{\rm{T}}_{{\rm{water,in}}}} - {C_{k,j}}} \right)$$</div>

Rearranging to obtain the outlet temperature for the jth surface:

<div>$${{\rm{T}}_{{\rm{water,out,j}}}} = \left( {1 - {C_{m,j}}} \right){{\rm{T}}_{{\rm{water,in}}}} + {C_{m,j}}{C_{k,j}}$$</div>

The overall outlet temperature from the radiant system is just a simple mixing of all of the surface outlet temperatures based on flow fraction and results in T<sub>water,out</sub>.

An energy balance on the mixing valve-pump group results in the following equation that relates the radiant system inlet temperature (T<sub>water,in</sub>) to the loop inlet water temperature (T<sub>loop,in</sub>), the radiant system outlet temperature (T<sub>water,out</sub>), and the pump heat addition:

<div>$${{\rm{T}}_{{\rm{water,in}}}} = \frac{{{{\dot m}_{loop}}}}{{{{\dot m}_{system}}}}{{\rm{T}}_{{\rm{loop,in}}}} + \frac{{{{\dot m}_{recirc}}}}{{{{\dot m}_{system}}}}{{\rm{T}}_{{\rm{water,out}}}} + \frac{{PumpHeat}}{{{{\dot m}_{system}}{c_p}}}$$</div>

Plugging in the definition of T<sub>water,out</sub> based on the summation of T<sub>water,out,j</sub> equations results in:

<div>$${{\rm{T}}_{{\rm{water,in}}}} = \frac{{LoopTerm + {\mathop{\rm Re}\nolimits} circTerm}}{{TwiCoeff}}$$</div>

where:

<div>$${\rm{L}}oopTerm = \frac{{{{\dot m}_{loop}}}}{{{{\dot m}_{system}}}}{{\rm{T}}_{{\rm{loop,in}}}} + \frac{{PumpHeat}}{{{{\dot m}_{system}}{c_p}}}$$</div>

<div>$${\mathop{\rm Re}\nolimits} circTerm = \frac{{{{\dot m}_{recirc}}}}{{{{\dot m}_{system}}}}\sum\limits_{\rm{j}} {{\rm{FlowFractio}}{{\rm{n}}_{\rm{j}}}{{\rm{T}}_{{\rm{water,out,j}}}}} $$</div>

<div>$$TwiCoeff = \left( {1 - \frac{{{{\dot m}_{recirc}}}}{{{{\dot m}_{system}}}}} \right)\sum\limits_{\rm{j}} {\left[ {{\rm{FlowFractio}}{{\rm{n}}_{\rm{j}}}\left( {1 - {C_{m,j}}} \right)} \right]} $$</div>

Once the actual water inlet temperature is calculated with this equation, it is then possible to calculate individual outlet temperatures for each surface, the overall outlet temperature, and finally all of the necessary flow and loop quantities.  This procedure avoids iteration but is somewhat complex to follow.  However, this second mathematical process is only needed for select cases of the constant flow radiant system when the inlet temperature is not known explicitly.  With the proper establishment of input data, it can be avoided.

**NOTE:** In some “low-energy” applications, it is possible that during cooling mode the elevated water temperatures may result in a heat source (or net heating) to the radiant system.  To avoid heating the slab when cooling is desired, EnergyPlus performs a temperature limit check.  If heating would result during cooling mode or cooling during heating mode, the model will cut-off the flow rate until the inlet water temperature will produce the proper effect.

### High Temperature Radiant Heater Model

The input object ZoneHVAC:HighTemperatureRadiant provides a model for a high temperature radiant heater that is intended to encapsulate an entire class of heating devices that seek to heat the occupants within a zone by direct radiation.  This encompasses a wide variety of heaters including both gas-fired and electric.  In most cases, the heater appears much like a lamp or a tube that is suspended from the ceiling of a space, and the surface temperatures are high enough that the heaters must be a safe distance away from the occupied portion of the space for safety concerns.

In EnergyPlus, the high temperature radiant heater model allows the user a reasonable amount of flexibility.  Rather than specifying an exact location for the radiant heater(s), the user is allowed to specify the percentage of heat leaving the heater as radiation and then on which surfaces this radiation is incident.  In addition, the user is also allowed the ability to define what fraction of radiation leaving the heater is incident directly on a person within the zone for thermal comfort purposes.  This amount of heat is then used in the thermal comfort models as shown in Equations for Fanger, for Pierce Two-Node and for KSU Two-node. These equations are similar in form to the equation promoted by Fanger (1970).  The input parameters for the high temperature radiant heater model are shown in Figure 275.

<div>$${T_{radiant}} = {\left[ {\left( {T_{MRT}^4} \right) + \left( {\frac{{{Q_{heater \to person}}}}{{\sigma {A_{person}}}}} \right)} \right]^{0.25}}$$</div>

HIGH TEMP RADIANT SYSTEM,! Program keyword for high temp. radiant heaters

  Zone 1 Radiant Heater, ! Zone name

  Radiant Operation,     ! Availability schedule

  SHOP ZONE,             ! Zone name (name of zone system is serving)

  10000,                 ! maximum power input (in Watts)

  GAS,                   ! type of heater (either gas or electric)

  0.85,                  ! combustion efficiency (ignored for elec. heaters)

  0.75,                  ! fraction radiant

  0.05,                  ! fraction latent

  0.05,                  ! fraction lost

  OPERATIVE,             ! temperature control type (MAT, MRT also possible)

  2.0 ,                  ! heating throttling range (in C)

  Heating Setpoints,     ! schedule of heating setpoint temperatures

  0.05,                  ! fraction of radiant energy to people

  Zn001:Flr001, 0.75,    ! surface/fraction of radiant energy incident on it

  Zn001:Wall001, 0.05,   ! surface/fraction of radiant energy incident on it

  Zn001:Wall002, 0.05,   ! surface/fraction of radiant energy incident on it

  Zn001:Wall003, 0.05,   ! surface/fraction of radiant energy incident on it

  Zn001:Wall004, 0.05;   ! surface/fraction of radiant energy incident on it

Figure 275.  Input Description for High Temperature Radiant Heaters

The input for the high temperature radiant heater has two additive relationships that are assumed.  First, the fractions of radiant, convective, latent, and lost heat must sum to unity.  The user is required to enter the fractions radiant, latent, and lost with the remainder assumed to be convective energy.  The fraction latent is added to the latent energy balance and will affect moisture levels within the zone.  The fraction lost is assumed to have no impact on the energy balance of the zone and is assumed to be lost or vented to the exterior environment.

The second additive relationship is within the distribution of the radiant fraction.  This energy is distributed to people and to the surfaces within the zone.  The sum of all of these distribution fractions (the last six lines of input shown in Figure 275) must sum to unity.  Note that each high temperature radiant heater is allowed to distribute energy to up to 20 surfaces and that radiant energy placed on a surface using these distribution fractions is assumed to be completely absorbed.  Thus, the distribution fractions should also take into account any differences in long wavelength absorptivity among the surfaces.

Several things should be noted about the fraction of heat that is radiated directly to people.  This parameter is somewhat sensitive and will have a direct impact on the thermal comfort models.  This is exactly the intent of the high temperature radiant heaters; however, one must use caution when determining this fraction since overestimation of this number might lead to predictions of thermal comfort where in fact it does not exist.  In addition, this fraction of radiant energy to people does not have a direct impact on any of the surface heat balances.  The thermal comfort energy balance is completely separate from and has no bearing on the zone air or the surface heat balances.  Thus, in order to not “lose” this amount of energy from the perspective of the zone air or the surface heat balances, the model assumes that any radiation from the high temperature radiant heater that is incident directly on people is accounted for in the thermal comfort model using Equation but is also assumed to be added to the zone air heat balance via convection from people to the surrounding air.  This guarantees that the people within the space feel the direct radiative effect of the heaters and that this quantity of energy is not “lost” within the heat balance routines.

Many of the control and integration aspects of the high temperature radiant system model in EnergyPlus are very similar to the low temperature radiant system model.  The controls are the same as shown in “Figure 271.  Variable Flow Low Temperature Radiant System Controls” where the amount of heat generated by the radiant heater varies as a function of the difference between the controlling and the setpoint temperatures.  As with the low temperature radiant system, the controlling temperature is allowed to be the mean air, the mean radiant, or the operative temperature, and the setpoint temperature is allowed to vary hourly based on a user defined schedule.  (Operative temperature for radiant system controls is the average of MAT and MRT.)  Also, since the high temperature radiant heater has a direct impact on the surfaces within a zone, the surface heat balances are recalculated to determine an approximate response to the radiation from the heater.  A final “average” heat balance calculation is done after all of the system time steps have been simulated to maintain continuity within the surface heat balances.  The algorithm shown in “Figure 274.  Resolution of Radiant System Response at Varying Time Steps is also used for high temperature radiant heaters.

#### References

Ceylan, H.T. and G.E. Myers.  1980.  Long-time solutions to heat conduction transients with time-dependent inputs.  ASME Journal of Heat Transfer, Volume 102, Number 1, pp. 115-120.

Degiovanni, A.  1988.  Conduction dans un “mur” multicouche avec sources:  extension de la notion de quadripole.  International Journal of Heat and Mass Transfer, Volume 31, Number 3, pp. 553-557.

Fanger, P.O. 1970. Thermal Comfort-Analysis and Applications in Environmental Engineering, Danish Technical Press, Copenhagen.

Hittle, D.C.  1981.  Calculating building heating and cooling loads using the frequency response of multilayered slabs.  Ph.D. Thesis, Department of Mechanical and Industrial Engineering, University of Illinois at Urbana-Champaign and Technical Manuscript E-169, United States Army Construction Engineering Research Laboratory, Champaign, IL.

Hittle, D.C. and R. Bishop.  1983.  An improved root-finding procedure for use in calculating transient heat flow through multilayered slabs.  International Journal of Heat and Mass Transfer, Volume 26, Number 11, pp. 1685-1693.

Hottel, H.C. and A.F. Sarofim. 1967. Radiative Transfer, McGraw-Hill, New York.

Incropera, F.P. and D.P. DeWitt.  1985.  Introduction to Heat Transfer.  New York:  John Wiley & Sons.

Lee, J. and R.K. Strand. 2001. “An Analysis of the Effect of the Building Envelope on Thermal Comfort using the EnergyPlus Program”, submitted for publication in the proceedings of the 2001 ACSA (Association of Collegiate Schools of Architecture) Technology Conference, Austin, TX.

Liesen, R.J. and C.O. Pedersen. 1997. “An Evaluation of Inside Surface Heat Balance Models for Cooling Load Calculations”, ASHRAE Transactions, Volume 103, Part 2.

Maloney, D. 1987. “Development of a radiant heater model and the incorporation of thermal comfort considerations into the BLAST energy analysis program”, M.S. thesis, University of Illinois at Urbana-Champaign, Department of Mechanical and Industrial Engineering.

McClellan, T.M. and C.O. Pedersen. 1997. “Investigation of Outside Heat Balance Models for Use in a Heat Balance Cooling Load Calculation Procedure”, ASHRAE Transactions, Volume 103, Part 2.

Pedersen, C.O., D.E. Fisher, and R.J. Liesen. 1997. “Development of a Heat Balance Procedure for Cooling Loads”, ASHRAE Transactions, Volume 103, Part 2.

Pedersen, C.O., D.E. Fisher, J.D. Spitler, and R.J. Liesen. 1998. Cooling and Heating Load Calculation Principles, ASHRAE.

Seem, J.E.  1987.  Modeling of heat transfer in buildings.  Ph.D. Thesis, University of Wisconsin-Madison.

Strand, R.K., and C.O. Pedersen. 1994. “Analytical verification of heat source transfer functions”, First Joint Conference of International Simulation Societies, Zürich, Switzerland.

Strand, R.K. 1995. “Heat source transfer functions and their application to low temperature radiant heating systems”, Ph.D. dissertation, University of Illinois at Urbana-Champaign, Department of Mechanical and Industrial Engineering.

Strand, R.K. and C.O. Pedersen. 1997. “Implementation of a Radiant Heating and Cooling Model into an Integrated Building Energy Analysis Program”, ASHRAE Transactions, Volume 103, Part 1.

Strand, R.K. and C.O. Pedersen. 2001. “Modularization and Simulation Techniques for Heat Balance Based Energy and Load Calculation Programs: the Experience of the ASHRAE LOADS Toolkit and EnergyPlus”, International Building Performance Simulation Association, Conference Proceedings of Building Simulation 2001, Rio de Janeiro, Brazil.

Taylor, R.D., C.O. Pedersen, D. Fisher, R. Liesen, and L. Lawrie. 1991. “Impact of simultaneous simulation of building and mechanical systems in heat balance based energy analysis programs on system response and control”, International Building Performance Simulation Association, Conference Proceedings of Building Simulation 1991, Nice, France.

Refrigeration Equipment <a name="Refrigeration"></a>
-----------------------

### Overview

EnergyPlus can model refrigerated case equipment consisting of a compressor rack, multiple refrigerated cases and walk-in coolers, secondary loop equipment, and  optional heat reclaim air and water heating coils. The refrigerated case equipment models perform four major functions:

n calculate the electric consumption of refrigerated cases and walk-in coolers connected to a compressor rack

n determine the impact of refrigerated cases and walk-in coolers on zone cooling and dehumidification loads (i.e., case credits), including the effects of HVAC duct configuration

n calculate the electric consumption and COP of the compressor rack, and the electric and water (if applicable) consumption related to cooling the compressor rack’s condenser.

n determine the total amount of heat rejected by the compressor rack’s condenser and store this information for use by waste heat recovery models (e.g., using Desuperheater heating coil (object: Coil:Heating:Desuperheater) as an air reheat coil for high humidity control in a supermarket)

The case and walk-in models account for nearly all performance aspects of typical supermarket refrigeration equipment. Refrigerated case and walk-in performance are based on the combined effects of evaporator load, fan operation, lighting, defrost type, and anti-sweat heater operation. Optional air and water heating coils can be modeled to reclaim available waste heat (superheat) from the compressor rack.

The user has two options when describing the balance of the system. Energy used to cool the condenser is simulated in both approaches. The simplest option is to use a compressor rack object, combining the compressors and condenser into a single unit with the performance determined by the heat rejection environment and the total case load. An example schematic of a compressor rack system is shown in Figure 276 below.

A detailed refrigeration system object models compressor and condenser performance separately. The detailed refrigeration system also includes the ability to transfer refrigeration load from one system to another using subcoolers, cascade condensers, and secondary loops. An example schematic of the detailed refrigeration system is shown in Figure 277 below. Subcooler \#2 is shown twice on  Figure 277 because it represents a liquid suction heat exchanger. This type of subcooler uses the cool suction gas to subcool the warmer condensed liquid. Subcoolers \#1 and \#3 on Figure 277 represent mechanical subcoolers. These subcoolers are used to subcool the condensate on a lower-temperature system using the cold liquid refrigerant from a higher temperature system. On this example, only subcoolers \#1 and \#2 would be defined as a part of the refrigeration system. However, subcooler \#3 would place a refrigerating load, similar to the load of a refrigerated case, on the system.

![racksystem\_low](EngineeringReference/media/image6091.png)

Figure 276. Typical Compressor Rack Equipment Schematic

![DetailedSystem](EngineeringReference/media/image6092.png)

Figure 277. Typical Detailed Refrigeration System Equipment Schematic

Four classes of secondary refrigeration loops can be modeled:

n a separate water loop is used to remove heat rejected by the condenser,

n a lower-temperature refrigeration system rejects heat to a higher-temperature refrigeration system via a cascade condenser,

n a fluid, such as a brine or glycol solution, is cooled in a secondary evaporator and is then circulated to chill the refrigerated cases and walk-ins, and

n a refrigerant, such as CO<sub>2</sub>, is partially evaporated in the refrigerated cases and walk-ins in a liquid-overfeed circuit, and then condensed in a secondary evaporator.

The first two classes of secondary loops are modeled using Refrigeration:System objects with Refrigeration:Condenser:WaterCooled and Refrigeration:Condenser:Cascade objects, respectively.  Figure 277 shows how cascade condensers and secondary evaporators are treated as a refrigeration load on a primary detailed system. The second two classes are modeled with a Refrigeration:SecondarySystem object described later in this section.

The compressor rack, detailed and secondary refrigeration systems, refrigerated case, and other component models are described below. The optional air and water heating coils are described elsewhere in this document (Ref. objects Coil:Heating:Desuperheater and Coil:WaterHeating:Desuperheater).

### Refrigeration Compressor Racks

The refrigerated case compressor rack object works in conjunction with the refrigerated case and walk-in cooler objects (Refrigeration:Case and Refrigeration:WalkIn) to simulate the performance of a simple supermarket-type refrigeration system. This object (Refrigeration:CompressorRack) models the electric consumption of the rack compressors and the cooling of the compressor rack’s condenser. Heat removed from the refrigerated cases and walk-ins and compressor/condenser fan heat can be rejected either outdoors or to a zone. Compressor rack condenser waste heat can also be reclaimed for use by an optional air heating coil (Ref. object Coil:Heating:Desuperheater) or by a user-defined plant water loop (Ref. object Coil:WaterHeating:Desuperheater).

The performance of the compressor rack is simulated using the sum of the evaporator loads for all refrigerated cases and walk-ins connected to the rack. Whether a single refrigerated case is connected to a rack (e.g., stand-alone refrigerated case, meat cooler, or produce cooler) or several cases are connected to a rack, the rack electric consumption is calculated based on the total evaporator load for the connected cases and walk-ins and the coefficient of performance (COP) for the compressor rack. At least one refrigerated case or walk-in must be connected to the compressor rack. The model assumes the compressor rack has sufficient capacity to meet the connected refrigeration load for any simulation time step. Additionally, the model neglects compressor cycling losses at part-load conditions.

For condenser heat rejection to the outdoors, condenser cooling can be modeled as dry air cooling, wet evaporative cooling, or water loop cooling. Using evaporative cooling rather than dry air cooling will allow for more efficient condenser heat rejection based on the entering air approaching the wet-bulb temperature rather than the dry-bulb temperature. Analyses under the International Energy Agency’s (IEA) Heat Pumping Programme Annex 26 indicates that this measure can improve refrigeration system efficiency by up to 10% (IEA 2003). The use of an evaporative-cooled condenser requires a water pump and, optionally, a basin sump water heater (to protect against freezing). Makeup water will also be required to replace that lost by evaporation. In colder climates, some evaporative-cooled condensers are drained for the winter months and run as dry air units. This scenario can be modeled by using an optional evaporative condenser availability schedule.

The simulation of the evaporative cooled condenser utilizes an effective air dry-bulb temperature that is assumed to be the result of evaporation of water in the air stream (similar to object EvaporativeCooler:Direct:CelDekPad). As discussed below, this effective temperature is used by performance curves that are a function of temperature. While some designs of evaporative coolers use water film cascading across the condenser coil for evaporative cooling, the current model uses the effective temperature method as a surrogate for the more complex water film on coil calculations.

If the condenser heat rejection is specified as water cooled, an appropriate plant water loop must be defined by the user (see documentation on *Plant/Condenser Loops* for additional details about plant loops).  This will include defining cooling supply components, such as pumps, water storage tanks, and cooling towers, as well as related branches, nodes, and connectors. The heat rejection from the refrigeration condenser is modeled as a cooling demand, which is satisfied by heat extraction devices (e.g., water tank and cooling tower) on the cooling supply side of a water loop. An example of such an arrangement is shown in Figure 278.

![watertankheatrecoveryschematic](EngineeringReference/media/image6093.png)

Figure 278. Example Of Condenser Heat Recovery To Water Storage Tank

#### Compressor Energy Use

Calculation of compressor rack electric power uses a simple model based on the total evaporator load (sum of the evaporator loads for all refrigerated cases and walk-ins connected to a rack) and the compressor rack operating COP which accounts for the air temperature entering the condenser:

<div>$$CO{P_{operating}} = CO{P_{design}}\left( {COPfTemp} \right)$$</div>

where:

<span>$CO{P_{operating}}$</span>              = compressor coefficient of performance at actual operating conditions (W/W)

<span>$CO{P_{design}}$</span>     = compressor coefficient of performance at design conditions (W/W)

<span>$COPfTemp$</span> = output of the normalized “Compressor Rack COP as a Function of Temperature Curve” (dimensionless)

Because the COP curve is defined only as a function of the condensing temperature, it is important that this curve definition corresponds to the lowest evaporating temperature served by the compressor rack. The air temperature used to evaluate the “Compressor Rack COP as a Function of Temperature Curve” depends on where the compressor rack’s condenser is located (Heat Rejection Location). When modeling condenser heat rejected directly to a zone (typical of a stand-alone packaged refrigerated case with integral condenser located in a building zone), the zone air dry-bulb temperature is used to calculate the change in compressor COP from the design value. If more than one refrigerated case and no walk-ins are attached to a compressor rack that rejects its condenser heat to a zone, then all cases served by this rack must reside in the same zone. When modeling a compressor rack serving at least one walk-in, OR with condenser heat rejected to outdoors, the refrigerated cases and walk-ins connected to this rack may be located in different zones. If the condenser type is specified as “Air Cooled”, the outdoor air dry-bulb temperature is used to evaluate the “Compressor Rack COP as a Function of Temperature Curve.”  If the condenser type is specified as “Evap Cooled”, the air temperature leaving the condenser is related to the effectiveness of the evaporative cooling system. If the evaporative process were 100% effective, the effective temperature of air leaving the evaporative media would equal the air wet-bulb temperature. However, the efficiency of the direct evaporative process is typically less than 100%, and the effective temperature leaving the condenser is determined by:

<div>$${T_{effective}} = {T_{owb}} + (1 - \varepsilon )*[{T_{odb}} - {T_{owb}}]$$</div>

where:

<span>${T_{effective}}$</span>       = effective dry-bulb temperature of air leaving the condenser cooling coil (°C)

<span>${T_{owb}}$</span>           = outdoor air wet-bulb temperature (°C)

<span>${T_{odb}}$</span>           = outdoor air dry-bulb temperature (°C)

<span>$\varepsilon $</span>               = evaporative condenser effectiveness.

If the user is modeling an evaporative cooled condenser and is using COPfTemp curve data (e.g., manufacturer’s data) based on wet-bulb temperature rather than dry-bulb temperature, the evaporative condenser effectiveness should be set to 1.0 for consistency.

If the condenser is water cooled, the effective temperature experienced by the condenser is based on the return water temperature from the plant loop heat rejection system (e.g., cooling tower) that is defined by the user. This return water temperature is typically related to the outdoor ambient conditions at each time step.

The electric power input to the rack compressor(s) is calculated for each simulation time step as the sum of the connected refrigerated case evaporator loads divided by the operating COP:

<div>$${P_{{\rm{rack}}}} = \frac{{\sum {{{\dot Q}_{case}} + \sum {{{\dot Q}_{walkin}}} } }}{{CO{P_{operating}}}}$$</div>

where:

<span>${P_{rack}}$</span>  = output variable “Refrigeration Compressor Rack Electric Power [W]”, electric power input to the rack compressor(s)

<span>${\dot Q_{case}}$</span>  = evaporator load for each refrigerated case connected to the rack (W)

<span>${\dot Q_{walkin}}$</span>= refrigeration load for each walk-in connected to the rack (W)

#### Condenser Heat Rejection, Energy Use, and Water Use

The compressor rack can reject heat to an air-, water-, or evaporative-cooled condenser. The condenser type determines the heat rejection temperature used for the compressor rack COP calculation. The compressor rack also allows superheat heat reclaim and heat rejection to a conditioned zone.

##### Condenser Fan Energy Use

Condenser fan power for any simulation time step is calculated by multiplying the design fan power by the condenser fan power as a function of temperature curve.

<div>$${P_{CondFan}}\,\, = {P_{CondFan,design}}\left( {CondFanfTemp} \right)$$</div>

where:

<span>${P_{CondFan}}$</span>                  = output variable “Refrigeration Compressor Rack Condenser Fan Electric Energy [W]”

<span>${P_{CondFan,design}}$</span>           = design condenser fan power (W)

<span>$CondFanfTemp$</span>    = output of the optional “Condenser Fan Power as a Function of Temperature Curve”

Similar to the compressor rack energy use described above, the air temperature used to evaluate the “Condenser Fan Power as a Function of Temperature Curve” depends on where the condenser rack’s condenser is located (i.e., zone air dry-bulb temperature if the condenser is located in a zone, outdoor air dry-bulb temperature if the condenser is located outdoors and is specified as air cooled, or effective temperature if the condenser is outdoors and is specified as evaporative cooled). If the sum of the evaporator loads for the refrigerated cases connected to the rack is equal to zero, the condenser fan power is set equal to zero. If the user does not provide a “Condenser Fan Power as a Function of Temperature Curve”, then the model assumes the condenser fan power is at the design power level when any of the refrigerated cases connected to this rack are operating.

If the user is modeling an evaporative cooled condenser and is using CondFanfTemp curve data based on wet-bulb temperature rather than dry-bulb temperature, the evaporative condenser effectiveness should be set to 1.0 for consistency.

For a water cooled condenser, there is no fan load at the condenser (i.e., the  water/refrigerant heat exchanger). Any fan load would be related to and accounted for at the heat rejection object (e.g., cooling tower).

##### Superheat Reclaim Heating Coil

EnergyPlus can simulate waste heat being reclaimed from a compressor rack for use by a refrigerant-to-air or refrigerant to water heating coil. Heat reclaimed from the compressor rack is assumed to be recovered from the superheated refrigerant gas leaving the compressor(s) and does not directly impact the performance of the compressor rack or refrigerated cases connected to the rack. The total heat rejected by the condenser (in Watts) is calculated each time step as follows:

<div>$${\dot Q_{condenser}} = \left( {\sum {{{\dot Q}_{case}} + \left. {\sum {{{\dot Q}_{walkin}}} } \right)} } \right.\left( {1 + \left. {\frac{1}{{CO{P_{operating}}}}} \right)} \right.$$</div>

The heat reclaim heating coil is able to transfer a fixed percentage of this total amount of rejected energy (not to exceed 30%) and use it to heat air and water. Refer to objects Coil:Heating:Desuperheater and Coil:WaterHeating:Desuperheater for a complete description of how these coils are modeled.

NOTE: When modeling a heat reclaim coil, the heat rejection location in the Refrigeration:CompressorRack object must be “Outdoors”. If the compressor rack heat rejection location is “Zone”, the total amount of waste heat available for reclaim (e.g., by a desuperheater heating coil) is set to zero by the compressor rack object and the simulation proceeds.

##### Heat Rejection to Zone

The compressor rack model can simulate condenser heat being rejected to a zone. As explained previously, if this heat rejection option is selected then all refrigerated cases connected to the rack must be located in the same zone and a superheat heat reclaim heating coil can not be modeled (Ref. Superheat Reclaim Heating Coil).

The refrigerated case and walk-in objects (Refrigeration:Case and Refrigeration:WalkIn) already calculate and report the sensible case credits which impact the zone air heat balance (Ref. Sensible Case Credits). When refrigerated cases and/or walk-ins are served by a compressor rack that rejects condenser waste heat directly to the zone (e.g., a stand-alone refrigerated case with integral compressor and condenser), this condenser waste heat also impacts the zone air heat balance and offsets some or all of the sensible case credits.

If only cases are served, the amount of condenser waste heat rejected to the zone and/or the HVAC return air (zone return air path outlet node) is calculated and reported by the refrigerated case compressor rack object as follows:

<div>$${\dot Q_{Zone,heating}}\,\,\, = \,\,\,\frac{{\sum {\left( {{{\dot Q}_{case}}[1 - RAF]} \right)} }}{{\sum {\left( {{{\dot Q}_{case}}} \right)} }}\,\left( {{{\dot Q}_{condenser}}\,\, + \,\,{P_{CondFan}}} \right)$$</div>

<div>$${\dot Q_{HVAC,heating}}\,\,\, = \,\,\left( {{{\dot Q}_{condenser}}\,\, + \,\,{P_{CondFan}}} \right) - \,{\dot Q_{zone,heating}}$$</div>

where:

<span>${\dot Q_{Zone,heating}}$</span> = output variable “Refrigeration Compressor Rack Zone Sensible Heating Rate [W] “

*RAF*           = return air factor for each case connected to the rack (Ref. Figure 279)

<span>${\dot Q_{HVAC,heating}}$</span>= output variable “Refrigeration Compressor Rack Return Air Sensible Heating Rate [W] “

If the HVAC system is off for a simulation time step (no return air mass flow), the rack condenser heat normally attributed to the HVAC return is set equal to zero and all condenser heat energy is applied to the zone air heat balance.

If, however, walk-in cooler(s) are also served by this compressor rack, no condenser heat is rejected to the HVAC return air. For walk-in cooler(s), the user must specify the zone that accepts the condenser heat rejection (because walk-ins can exchange heat with multiple zones). In that case:

<div>$${\dot Q_{Zone,heating}} = {\dot Q_{condenser}} + {P_{CondFan}}$$</div>

##### Water Cooled Condenser

If the refrigeration condenser is water cooled, a water plant loop must be defined in the input file. At a minimum, the loop must contain a pump and one or more heat sinks of sufficient capacity to remove the condenser heat load. In the system shown in Figure 278, the heat sinks are the water heater tank and the cooling tower. The water pump in the loop can be either constant (Ref. Pump:ConstantSpeed)  or variable speed (Ref. Pump:VariableSpeed). A variable speed pump permits the loop flow to vary and allows for a setpoint to be established on the condenser outlet water temperature. As the refrigeration condenser heat load varies through time, the speed of the pump can be adjusted to achieve a mass flow consistent with a desired outlet water temperature according to

<div>$$m = \frac{{{Q_{condenser}}}}{{{c_p} \cdot ({T_{out}} - {T_{in}})}}$$</div>

where:

*m*               = mass flow in the water loop

*Q<sub>condenser</sub>      * = heat rejected by the condenser

*c<sub>p</sub>  *             = specific heat of water

*T<sub>out</sub> *             = desired water outlet temperature

*T<sub>in</sub>               =* return water inlet temperature.

The desired water outlet temperature is specified using a schedule, subject to a maximum water outlet temperature (input specified). The maximum temperature is typically defined by constraints on the refrigerant loop pressures and temperatures. The desired mass flow in the water loop to meet the temperature schedule is also compared to the user-supplied maximum flow rate. If the desired mass flow is greater than the maximum allowed flow, the flow rate is set to the maximum value and the resulting water outlet temperature is determined.

The return water inlet temperature is a function of the cooling system defined by the user. A minimum return water temperature may need to be taken into consideration to prevent lowering the resulting refrigerant condensing pressure to the point that refrigerant expansion valve operation becomes impaired. When ambient conditions produce low temperature warnings based on the minimum return water temperature, an outlet temperature setpoint control may need to be placed on the water heat sink object (e.g., cooling tower) to keep the return water temperature above the minimum.

If the water loop flow is constant (i.e., driven by a constant speed pump), then the outlet water temperature will vary with the amount of heat rejected by the condenser.    Using the equation above, the resulting water outlet temperature is calculated as

<div>$${T_{out}} = \frac{{{Q_{condenser}}}}{{{c_p} \cdot m}} + {T_{in}}$$</div>

##### Evaporative Condenser Water Pump

If the condenser type is specified as “Evap Cooled”, a water pump is required to circulate water in the evaporative condenser. The pump power can be input directly or be autocalculated using a relationship of 0.004266 W per watt [15 W/ton] of rated total cooling capacity where the total cooling capacity is the sum of the rated total cooling capacities for the refrigeration load connected to this compressor rack. Following manufacturer’s recommendations regarding the avoidance of scaling, the water pump does not cycle when there is no cooling demand (i.e., when the compressors are not running), but rather runs continuously. However, if the evaporative condenser availability schedule is set such that evaporative cooling is not available (e.g., during very cold months to avoid freezing), then the pump power consumption will be zero during that period.

##### Evaporative Condenser Water Consumption

With evaporative cooling of the condenser’s entering air, makeup water is needed to replenish the water lost due to evaporation. The quantity required is calculated as the product of the air mass flow rate and the difference between the entering and leaving air humidity ratio, divided by the density of water. The air mass flow rate is determined by multiplying the evaporative condenser air volume flow rate times the density of the entering air (i.e., at the condenser air inlet node if provided, or outdoor air conditions [e.g., no adjustment for height above ground] if the condenser air inlet node field is left blank). The volumetric air flow rate is either specified directly in the user input or is autocalculated using the relationship 0.000144 m<sup>3</sup>/s per watt of rated total cooling capacity [850 cfm/ton] where the total cooling capacity is the sum of the rated total cooling capacities for the refrigerated cases and walk-ins connected to this compressor rack (Ref. Refrigeration:Case and Refrigeration:WalkIn). The air mass flow rate is multiplied by the variable *CondFanfTemp*, described above, to simulate the modulation of air flow by the condenser fans (e.g., staging, multi-speed, or variable speed) as a function of temperature. Mathematically,

<div>$${\dot V_{evaporation,makeup}} = \frac{{{{\dot m}_{air}}\left( {CondFanfTemp} \right)({\omega_{air,outlet}} - {\omega_{air,inlet}})}}{{{\rho_{water}}}}$$</div>

where:

<span>$\mathop {{{\dot V}_{evaporation,makeup}}}\limits^{} $</span>= Refrigeration Compressor Rack Evaporative Condenser Water Volume Flow Rate (m<sup>3</sup>/s)

<span>${\dot m_{air}} = $</span> mass flow rate of air through the evaporative condenser (kg/s)

<span>${\omega_{air,outlet}}$</span> = humidity ratio of air leaving the evaporative media (kg<sub>water</sub>/kg<sub>dry\\ air</sub>) based on the effective dry-bulb temperature *T<sub>effective</sub>*, as described above, outdoor air wet-bulb temperature, and outdoor barometric pressure

<span>${\omega_{air,inlet}}$</span> = humidity ratio of inlet air (kg<sub>water</sub>/kg<sub>dry\\ air</sub>) based on conditions at the condenser air inlet node if provided, or outdoor air conditions (e.g., no adjustment for height above ground) if the condenser air inlet node field is left blank

<span>${\rho_{water}}$</span> = density of water evaluated at the effective air temperature (kg/m<sup>3</sup>)

The source of the makeup water may be specified as a water storage tank. If not specified, the makeup water is assumed to come from the building mains (Ref. Water Mains Temperatures).

##### Evaporative Condenser Basin Heater

In cold climates, a basin heater may be needed to prevent freezing of the evaporative cooling water. This feature is included in the model whereby an electric basin heater provides heat to the sump water only when the condenser cooling system is idle (i.e., no refrigeration load) and when the outdoor air dry-bulb temperature is below a user-specified setpoint. Since heat balances and basin water temperatures are not explicitly determined, a linear loading relationship, as a function of the difference in outdoor air dry-bulb temperature and the setpoint temperature, is used calculate the power demand at a given time step by the basin heater.

<div>$${P_{ba\sinh eater}} = {P_{heatercapacity}}*({T_{setpo{\mathop{\rm int}} }} - {T_{OutDb}})$$</div>

where:

<span>${P_{ba\sinh eater}}$</span>= electric power demand for basin heater in current time step (W)

<span>${P_{heatercapacity}}$</span>= electric heater capacity as a function of differential temperature (W/deg K)

<span>${T_{setpo{\mathop{\rm int}} }}$</span>= setpoint temperature below which the heater turns on (°C)

<span>${T_{OutDb}}$</span> = outdoor air dry-bulb temperature (°C)

A default value for the basin heater capacity of 200 W/deg K has been established based on manufacturer data.

##### Evaporative Condenser Availability Schedule

Some manufacturer’s evaporative cooling systems for refrigeration condensers permit seasonal draining in the colder months and operation as an air-cooled system during that time. This optional feature is available through an availability schedule. This is important in climates subject to freezing weather in order to avoid excessive ice formation on the condenser surfaces and surroundings. (The Availability Schedule is the correct way to model the use of evaporative condensers in cold climates. However, some users may take a single input description and use it to model a building with a refrigeration system in a variety of climates. To avoid modeling the use of evaporative coolers in freezing weather, the code includes a cutout to switch to dry operation whenever the outdoor drybulb temperature drops below 4C.) During periods when evaporative cooling is not available, the outdoor condenser behaves as an air-cooled system with no water consumption or pump and basin heater loads. The effective temperature of air entering the condenser coil during this period (used to evaluate COPfTemp and CondFanfTemp) is equal to the outdoor air dry-bulb temperature at the condenser air inlet node if provided, or outdoor air conditions (e.g., no adjustment for height above ground) if the condenser air inlet node field is left blank.

### Refrigerated Cases

The refrigerated case object (Refrigration:Case) works in conjunction with the compressor rack, detailed refrigeration system, or secondary refrigeration system object (Refrigeration:CompressorRack, Refrigeration:System, or Refrigeration:SecondarySystem) to simulate the performance of a refrigerated case system. The refrigerated case model uses performance information at rated conditions along with performance curves for latent case credits and defrost heat load to determine performance at off-rated conditions. Energy use for lights, fans and anti-sweat heaters is modeled based on inputs for nominal power, schedules, and control type. The refrigerated case model accounts for the sensible and latent heat exchange with the surrounding environment (termed "case credits") which impacts the temperature and humidity in the zone where the case is located. The simplified model described here provides the flexibility to simulate a broad range of refrigerated case types.

The total load on the refrigerated case evaporator is made up of various components:

<div>$${\dot Q_{case}} = {\dot Q_{walls}} + {\dot Q_{rad}} + {\dot Q_{{\rm{inf,sens}}}} + {\dot Q_{{\rm{inf,lat}}}} + {\dot Q_{lights}} + {\dot Q_{as}} + {\dot Q_{def}} + {\dot Q_{fan}} + {\dot Q_{restock}}$$</div>

where:

<span>${\dot Q_{case}}$</span>    = total load on the refrigerated case evaporator (W)

<span>${\dot Q_{walls}}$</span>   = heat transfer through case walls due to the difference between the refrigerated case operating dry-bulb temperature and the zone air dry-bulb temperature (W)

<span>${\dot Q_{rad}}$</span>     = radiant heat transfer to the refrigerated case (W)

<span>${\dot Q_{{\rm{inf,}}sens}}$</span> = sensible heat transfer by air infiltration to the refrigerated case through the air curtain or via door openings (W)

<span>${\dot Q_{{\rm{inf,lat}}}}$</span>   = latent heat transfer by air infiltration to the refrigerated case through the air curtain or via door openings (W)

<span>${\dot Q_{lights}}$</span>   = lighting heat load (W)

<span>${\dot Q_{as}}$</span>      = anti-sweat heater load (W)

<span>${\dot Q_{def}}$</span>     = defrost heat load (W)

<span>${\dot Q_{fan}}$</span>     = fan heat load (W)

<span>${\dot Q_{restock}}$</span> = sensible load on the refrigerated case due to restocking of products that are at a higher temperature than the case (W)

The model assumes that these load components are known for a refrigerated case at rated ambient air conditions (typically 23.9˚C [75˚F] and 55% relative humidity) and the specified case operating temperature. A combination of user input curves and fixed correlations (defined within EnergyPlus) adjust for case performance at off-rated conditions. Several of the load components are typically provided by the case manufacturer (e.g., total rated load, fan, lighting, anti-sweat heater, and defrost loads). The remaining load components are not usually provided by the manufacturer and must be estimated (heat conduction through case walls, radiation heat transfer, sensible/latent air infiltration, and restocking).

For estimating the latent air infiltration load, the model requires that the user provide the latent heat ratio (LHR) for the refrigerated case at rated conditions. Research results are available to provide guidance in selecting this value (ASHRAE 2002, Howell 1993a, Howell 1993b). The rated LHR for refrigerated cases typically ranges from 0.1 to 0.3 depending on case configuration (e.g., glass door reach-in versus multi-deck open case) and case operating temperature.

The case loads due to wall heat conduction, radiation, and sensible air infiltration are estimated by the model as a single lumped value (sensible case credits). The sensible case credits are calculated by subtracting the known loads at rated conditions (fan, lighting, anti-sweat heater, defrost and latent case credits) from the rated total cooling capacity of the case which is provided by the case manufacturer (<span>${\dot Q_{case,rated}}$</span>).

Using these assumptions and the schedule inputs provided by the user, the refrigerated case evaporator load components in Equation are determined for each simulation time step. The variation in certain loads with respect to changes in ambient air temperature and/or humidity (e.g., latent and sensible case credits, defrost load, and anti-sweat heater load) are factored into the calculation based on user-provided inputs or by the model itself.

Whenever the total heat load on the case is greater than the available evaporator capacity, such as during defrost (when the evaporator capacity is set to zero) or restocking, the load is accumulated to be met during subsequent time steps. This accounts for the energy required to bring the case back down to the rated operating temperature even though the rise in case temperature during defrost or restocking is not explicitly modeled. Following defrost, it may take multiple time steps to meet this accumulated load.

The specific calculations for case evaporator load components and electric power for these loads (as applicable) are provided below.

#### Case Evaporator Fan

The refrigerated case evaporator fan electric power is calculated for each simulation time step as the product of the operating case fan power per unit length of case, the length of the refrigerated case, and the fraction of time that the case is not being defrosted. For cases with hot-gas or electric defrost (with or without temperature termination), the fan is disabled during the entire scheduled defrost drip-down time period. The evaporator fan operates continuously for off-cycle defrost or no defrost.

<div>$${P_{fan}}\,\,\,\, = \,\,\,\,{P'}_{fan,oper}\left( {{L_{case}}} \right)\left( {1 - SC{H_{defrost,dripdown}}} \right)$$</div>

where:

<span>${P_{fan}}$</span>           = output variable “Refrigerated Case Evaporator Fan Electric Power [W]”

<span>${P'}_{fan,oper}$</span>     = operating case fan power per unit length (W/m)

<span>${L_{case}}$</span>          = case length (m)

<span>$SC{H_{defrost,dripdown}}$</span> = fraction of time case is being defrosted (0 to 1), including drip-down period (based on the defrost drip-down schedule) for hot-gas or electric defrost. For off-cycle defrost or no defrost, this value is set to zero for this calculation.

The model assumes that the evaporator fan is entirely contained within the thermal envelope of the case, and that all fan power results in a direct heat load on the case evaporator:

<div>$${\dot Q_{fan}} = \,{P_{fan}}$$</div>

#### Case Lighting

The refrigerated case lighting electric power is calculated for each simulation time step as the product of the installed case lighting power per unit length of case, the lighting schedule value, and the length of the refrigerated case:

<div>$${P_{{\rm{lights}}}} = P{'_{{\rm{lights,  installed}}}}({L_{{\rm{case}}}})(SC{H_{{\rm{lights}}}})$$</div>

where:

<span>${P_{lights}}$</span>          = output variable “Refrigerated Case Lighting Electric Power [W]”

<span>$P{'_{{\rm{lights,  installed}}}}$</span>          = installed case lighting power per unit length (W/m)

<span>$SC{H_{lights}}$</span>    = case lighting schedule value (0 to 1)

A maximum schedule value of 1.0 means the lights are fully on at the installed case lighting power level. Schedule values of 0.0 indicate the lights are off and 0.5 at half-power.

The user can specify the fraction of lighting energy that directly contributes to the case evaporator heat load:

<div>$${\dot Q_{lights}} = \,{P_{lights}}\left( {{F_l}} \right)$$</div>

where:

<span>${F_l}$</span>  = fraction of lighting energy to case

The remainder of the lighting energy (1 - *F<sub>l</sub>*) is a heating load to the zone where the case is located, which is discussed further in section Sensible Case Credits below. This fraction (1 - *F<sub>l</sub>*) can be used to represent lighting ballasts and/or bulbs located outside the air curtain of the refrigerated case.

#### Anti-Sweat Heater Performance

Anti-sweat heaters warm the refrigerated case rails or doors to provide protection from moisture condensation. Different anti-sweat heater control strategies are used depending on the case temperature and the type of anti-sweat heater installed. Several types of anti-sweat heater control strategies can be simulated with this model: constant, linear variation with ambient relative humidity or dewpoint temperature, and a theoretical model that determines the minimum anti-sweat heater power required to maintain the case surface just above the temperature where condensation would occur. Additionally, anti-sweat heater performance can be disregarded if the type of refrigerated case does not warrant its use. For the control strategies described below (except “None” and “Constant Method”), the model does not allow the anti-sweat heater power to be less than the minimum power nor greater than the case anti-sweat heater power specified by the user. Each anti-sweat heater control type is described in detail below.

##### None

Used for refrigerated cases that do not require an anti-sweat heater.

<div>$${\dot Q_{as}} = 0$$</div>

where:

<span>${\dot Q_{as}}$</span>            = anti-sweat heater load on the case evaporator (W)

##### Constant Method

For refrigerated cases requiring constant anti-sweat heater output, the power use is simply calculated as the case anti-sweat heater power per unit length multiplied by the length of the case. This method is used when the manufacturer recommends that cycling of the heaters not occur.

<div>$${P_{as}} = {P'}_{as}\,\left( {{L_{case}}} \right)$$</div>

where:

<span>${P_{as}}$</span>             = output variable “Refrigerated Case Anti-Sweat Heater Electric Power [W]”

<span>${P'}_{as}$</span>           = case anti-sweat heater power per unit length (W)

##### Relative Humidity Method

Anti-sweat heater power can be reduced at lower ambient relative humidity levels to save energy while still protecting from moisture condensation on cold surfaces. For this control type, anti-sweat heater power use is reduced linearly based on case anti-sweat heater power at the rated ambient relative humidity (typically 55% RH), the relative humidity specified by the user where no anti-sweat heater power is required, and the relative humidity of the ambient (zone) air surrounding the case.

<div>$${P_{as}} = {P'}_{as}\left( {{L_{case}}} \right)\left( {1 - \left[ {\frac{{R{H_{rated}} - R{H_{air}}}}{{R{H_{rated}} - R{H_{\min }}}}} \right]} \right)$$</div>

where:

<span>$R{H_{air}}$</span>        = relative humidity of the ambient (zone) air (%)

<span>$R{H_{rated}}$</span>      = rated ambient relative humidity (%)

<span>$R{H_{\min }}$</span>       = relative humidity at zero anti-sweat heater energy (%)

##### Dewpoint Method

Anti-sweat heater power can also be reduced as a function of ambient air dewpoint temperature based on a similar correlation to that used by the relative humidity method. This control method varies the anti-sweat heater power linearly based on the ambient air dewpoint temperature, the case operating temperature, and the rated ambient dewpoint temperature (calculated by the model using the rated ambient temperature and rated ambient relative humidity entered by the user).

<div>$${P_{as}} = {P'}_{as}\left( {{L_{case}}} \right)\left( {\frac{{{T_{dp,air}} - {T_{case}}}}{{{T_{dp,rated}} - {T_{case}}}}} \right)$$</div>

where:

<span>${T_{dp,air}}$</span>         = dewpoint temperature of the ambient (zone) air (˚C)

<span>${T_{dp,rated}}$</span>       = rated ambient dewpoint temperature (˚C)

<span>${T_{case}}$</span>           = case operating temperature (˚C)



##### Heat Balance Method

A theoretical model may also be used to simulate the performance of anti-sweat heater operation at various indoor dewpoint temperatures (Henderson and Khattar 1999). The model calculates that amount of heat required to hold the case or door surface at (or slightly above) the dewpoint temperature of the ambient air using the following simple heat balance equation:

<div>$${P_{as}} = \,\,\left( {\frac{{\left( {{T_{dp,air}} - {T_{db,air}}} \right){H_{case}}}}{{{R_{air}}}} + \frac{{\left( {{T_{dp,air}} - {T_{case}}} \right){H_{case}}}}{{{R_{case}}}}} \right){L_{case}}$$</div>

where:

<span>${T_{dp,air}}$</span>         = dewpoint temperature of the ambient (zone) air (˚C)

<span>${T_{db,air}}$</span>         = dry-bulb temperature of the ambient (zone) air (˚C)

<span>${H_{case}}$</span>         = height of the case (m)

<span>${R_{air}}$</span>           = air film resistance (assumed constant at 0.3169 m<sup>2</sup>-˚C/W)

<span>${R_{case}}$</span>          = heat transfer resistance of case (m<sup>2</sup>-˚C/W)

<span>${T_{case}}$</span>           = case operating temperature (˚C)

<span>${L_{case}}$</span>          = case length (m)

The model above provides a linear relationship of anti-sweat heater power with varying ambient air dewpoint temperature at constant ambient air dry-bulb and case temperatures. By assuming that the ‘nominal’ anti-sweat heater power entered by the user is required to avoid moisture condensation at rated ambient air conditions, the value of <span>${R_{case}}$</span> can be determined by rearranging the equation and solving as follows:

<div>$${R_{case}} = \frac{{\left( {{T_{dp,rated}} - {T_{case}}} \right)}}{{\left( {\frac{{{P'}_{as}}}{{{H_{case}}}}} \right) - \left( {\frac{{{T_{dp,rated}} - {T_{db,rated}}}}{{{R_{air}}}}} \right)}}$$</div>

where:

<span>${T_{db,rated}}$</span>       = rated ambient temperature (˚C)

With *R<sub>case</sub>*known, *P<sub>as</sub>* can be calculated for each simulation time step using the actual ambient (zone) air dry-bulb and dewpoint temperatures.

##### All Anti-Sweat Heater Control Methods

For all control methods, the user can specify the fraction of anti-sweat heater energy that directly contributes to the case evaporator heat load:

<div>$${\dot Q_{as}} = \,{P_{as}}\left( {{F_{as}}} \right)$$</div>

where:

<span>${F_{as}}$</span>            = fraction of anti-sweat heater energy to case

The remainder of the anti-sweat heater energy (1 - *F<sub>as</sub>*) is a heating load to the zone where the case is located, which is discussed further in section Sensible Case Credits below.

#### Case Restocking

The impact of restocking the refrigerated case with product that is not at the case operating temperature is modeled with the case restocking schedule. The schedule is entered as a heat gain rate per unit length of the refrigerated case (W/m). The heat load due to restocking is calculated as the scheduled load multiplied by the length of the refrigerated case. The load due to product restocking is assumed to be only sensible (temperature) heat; a latent (moisture) component is not modeled.

<div>$${\dot Q_{restock}} = SC{H_{restock}}\left( {{L_{case}}} \right)$$</div>

where:

<span>$SC{H_{restock}}$</span>  = refrigerated case restocking schedule value (W/m)

The restocking heat load is removed by the refrigerated case evaporator any time the case is not being defrosted and excess sensible cooling capacity is available. If the evaporator cooling capacity is insufficient to remove the entire restocking load, the unmet portion is carried over to the next simulation time step.

#### Case Defrost

Eight refrigerated case defrost strategies can be simulated: none, off-cycle, electric, electric with temperature termination, hot-gas, hot-gas with temperature termination, hot-brine, and hot-brine with temperature termination. Some research has shown that the defrost times for cases defrosted using hot brine can be significantly shorter than defrost times for electric or hot gas.(Terrell, W. J. Jr., 1999) For each of these strategies, the refrigerated case evaporator is turned off for the required time period to allow accumulated frost to melt. Additional time can be scheduled (drip-down) to allow the water to drip from the evaporator and drain from the case.

Refrigerated cases typically require a specific number of defrost cycles per day for a pre-determined length of time. Refer to manufacturer’s recommendations for proper defrost frequency and duration. For example, a refrigerated case may have a single defrost period each day with defrost scheduled from 7:00 – 7:40 am and defrost drip-down scheduled from 7:00 – 7:55 am. Notice the drip-down schedule and the defrost schedule start at the same time, and the drip-down schedule is longer than the defrost schedule. These schedules should normally repeat for each day of the year.

For electric, hot gas, and hot brine defrost types, energy use by the defrost heater occurs during the scheduled defrost period. For defrost with temperature termination, the energy is also multiplied by the defrost ratio simulating a defrost duration shorter than the defined (maximum) period. For all non-electric defrost types, defrost electric power is set equal to zero (and is not available as an output variable). For hot gas and hot brine defrost types in cases served by a detailed system, the condenser heat rejection load is reduced by the amount of heat recovered for use in the defrost system. This condenser credit is not applied for the simple compressor rack system.

<div>$$\begin{array}{l}If\,(DefrostType\, = \,Electric)\,\,Then\\ ,\,\,\,\,\,{P_{def}} = {P'}_{def}\left( {{L_{case}}} \right)\left( {SC{H_{defrost}}} \right)\\ElseIf\,(DefrostType\, = \,ElectricWithTempTermination)\,Then\\ ,\,\,\,\,\,{P_{def}} = {P'}_{def}\left( {{L_{case}}} \right)\left( {SC{H_{defrost}}} \right)(DefrostRatio)\\Else\\ ,\,\,\,\,\,{P_{def}} = 0.0\\EndIf\end{array}$$</div>

where:

<span>${P_{def}}$</span>           = output variable “Refrigerated Case Defrost Electric Power [W]”

<span>${P'}_{def}$</span>          = case defrost power per unit length (W)

<span>${L_{case}}$</span>          = case length (m)

<span>$SC{H_{defrost}}$</span>  = case defrost schedule value (0 to 1)

<span>$DefrostRatio$</span> = fraction of maximum defrost time, used with temperature termination

Frost accumulation on the case evaporator will vary with the humidity level in the ambient air surrounding the case. Therefore, defrost heater operation can be reduced when ambient air humidity levels are low. Several methods are used to reduce unnecessary defrost heater operation, including terminating heater operation when the measured evaporator temperature indicates that the accumulated frost has been completely melted. For modeling refrigerated cases with temperature-terminated defrost, EnergyPlus allows the user to specify a defrost energy correction curve to account for variations in defrost energy as ambient air humidity levels change. The user can select from four correction curve types: None, Case Temperature Method, Relative Humidity Method, or Dewpoint Method.

<div>$$\begin{array}{l}{\rm{None (default):}}\\ ,\,\,\,DefrostRatio = 1\\ {\rm{Case}}\,{\rm{Temperature}}\,{\rm{Method:}}\\ ,\,\,\,DefrostRatio = 1 - \left( {R{H_{rated}} - R{H_{air}}} \right)\left[ {a + b\left( {{T_{case}}} \right) + c{{\left( {{T_{case}}} \right)}^2} + d{{\left( {{T_{case}}} \right)}^3}} \right]\,\\ {\rm{RH}}\,{\rm{method:}}\\ ,\,\,\,DefrostRatio = e + f\left( {R{H_{air}}} \right) + g{\left( {R{H_{air}}} \right)^2} + h{\left( {R{H_{air}}} \right)^3}\\ {\rm{Dewpoint}}\,{\rm{method:}}\\ ,\,\,\,DefrostRatio = i + j\left( {{T_{dp,air}}} \right) + k{\left( {{T_{dp,air}}} \right)^2} + l{\left( {{T_{dp,air}}} \right)^3}\end{array}$$</div>

where:

<span>$R{H_{rated}}$</span>      = rated ambient relative humidity (%)

<span>$R{H_{air}}$</span>        = relative humidity of the ambient (zone) air (%)

<span>${T_{case}}$</span>           = case operating temperature (˚C)

<span>${T_{dp,air}}$</span>         = dewpoint temperature of the ambient (zone) air (˚C)

a…l                        = user-defined coefficients using a cubic curve object (Curve:Cubic)

The user specifies the defrost energy correction curve type and the name of the cubic curve object (Curve:Cubic) that defines the curve coefficients. Representative curve coefficients for curve type “Case Temperature Method” are provided in Table 75.

Table 75. Representative Defrost Energy Correction Curve Coefficients for Case Temperature Method

<table class="table table-striped">






<tr>
<td>Coefficient</td>
<td>Single-shelf horizontal
display case</td>
<td>Multi-shelf vertical
display case</td>
</tr>
<tr>
<td>a</td>
<td>2.3632E-2</td>
<td>2.4598E-2</td>
</tr>
<tr>
<td>b</td>
<td>6.2320E-4</td>
<td>7.6439E-4</td>
</tr>
<tr>
<td>c</td>
<td>2.8320E-5</td>
<td>-3.8637E-5</td>
</tr>
<tr>
<td>d</td>
<td>4.4035E-7</td>
<td>7.45686E-7</td>
</tr>

</table>

Note: Coefficients derived for *RH<sub>rated</sub>* = 55% and a rated ambient temperature of 23.9˚C (75˚F). Source:  Howell 1993b.

As mentioned above, the refrigerated case evaporator is turned off while it is being defrosted. Heat gains during defrost must be removed once the defrost period (drip-down schedule) has ended. The model assumes that heat gains due to defrost heater operation are at least partially offset by converting accumulated frost to liquid water (condensate) which drains from the case. Frost accumulation during each simulation time step is estimated by the model using the actual latent heat transfer to the refrigerated case and the heat of vaporization plus the heat of fusion for water. The model assumes that frost is not accumulated on the evaporator during the defrost drip-down time period.

<div>$$Frost = Frost + \left( {\frac{{{{\dot Q}_{case,rated}}\left( {{L_{case}}} \right)\left( {RT{F_{rated}}} \right)\left( {LH{R_{rated}}} \right)\left( {LatentRatio} \right)\left( {{t_{zn}}} \right)}}{{\left( {{h_f} + {h_{fg}}} \right)}}} \right)\left( {1 - SC{H_{defrost,dripdown}}} \right)$$</div>

where:

<span>$Frost$</span>        = amount of accumulated frost on the case evaporator (kg)

<span>${\dot Q_{case,rated}}$</span>    = case rated total cooling capacity per unit length (W/m)

<span>${L_{case}}$</span>          = case length (m)

<span>$RT{F_{rated}}$</span>     = runtime fraction of the refrigerated case at rated conditions

<span>$LH{R_{rated}}$</span>    = latent heat ratio of the refrigerated case at rated conditions

<span>$LatentRatio$</span> = ratio of actual latent load to rated latent load on the case, based on latent case credit curve (see section Latent Case Credits below)

<span>${t_{zn}}$</span>             = duration of zone simulation time step (s)

<span>${h_{fg}}$</span>                        = heat of vaporization of water (assumed constant at 2,498,000 J/kg)

<span>${h_f}$</span>             = heat of fusion of water (335,000 J/kg)

<span>$SC{H_{defrost,dripdown}}$</span>    = defrost drip-down schedule value (0 to 1)

During defrost (SCHdefrost), the model assumes that the hot gas, hot brine, or electric heater energy directly contributes to melting the frost (heat of fusion of water). Defrost energy not attributed to melting frost from the evaporator coil results in a heat load on the refrigerated case evaporator (<sub><span>${\dot Q_{def}}$</span></sub>). When the defrost drip-down time period ends, this defrost energy heat load is added to the actual case load (up to the maximum evaporator capacity) until the total defrost energy heat load is removed (which may take several simulation time steps)

<div>$$\begin{array}{l}If\left( {DefrostType = Electric\;or\;HotGas\;or\;HotBrine} \right)\;Then\\ quad \quad {{\dot Q}_{def}} = MAX\left( {0.0,\left[ {P_{def}'({L_{case}})(SC{H_{def}}) - \frac{{Frost({h_f})}}{{{t_{zn}}}}} \right]} \right)\\Else\\ quad \quad {{\dot Q}_{def}} = 0.0\\Endif\end{array}$$</div>

where:

<span>${\dot Q_{def}}$</span>     = defrost heat load (W)

#### Sensible Case Credits

Refrigerated cases remove sensible energy from the surrounding environment (termed “sensible case credits”). In this model, the sensible case credits are composed of wall heat conduction, radiation heat transfer, and sensible heat transfer by air infiltration (<span>${\dot Q_{walls}}$</span>+ <span>${\dot Q_{rad}}$</span>+ <span>${\dot Q_{{\rm{inf,sens}}}}$</span> in equation ). To quantify this energy transfer, the model first calculates the rated sensible case credits by subtracting the known loads at rated conditions (fan, lighting, and anti-sweat heater) from the rated sensible cooling capacity of the case. It should be noted that the lighting and fan heat discussed here are for standard-efficiency equipment. Manufacturers typically provide ratings for both standard and high-efficiency fan and lighting equipment; however, the standard equipment is used to determine rated sensible case credits. (Some manufacturers no longer include any lighting in their rated capacity values. For these cases, P’<sub>lights,std</sub> will equal zero.)

<div>$$\dot Qc{c_{sens,rated}} = \left[ {{{\dot Q}_{case,rated}}\left( {RT{F_{rated}}} \right)\left( {1 - LH{R_{rated}}} \right) - {P'}_{lights,std}\left( {{F_l}} \right) - {P'}_{as}\left( {{F_{as}}} \right) - {P'}_{fan,std}} \right]{L_{case}}$$</div>

where:

<span>$\dot Qc{c_{sens,rated}}$</span>  = sensible case credits at rated conditions (W)

<span>${\dot Q_{case,rated}}$</span>    = case rated total cooling capacity per unit length (W/m)

<span>$RT{F_{rated}}$</span>     = runtime fraction of the refrigerated case at rated conditions

<span>$LH{R_{rated}}$</span>    = latent heat ratio of the refrigerated case at rated conditions

<span>${P'}_{lights,std}$</span>    = standard case lighting power per unit length (W/m)

<span>${F_l}$</span>              = fraction of lighting energy to case

<span>${P'}_{as}$</span>           = case anti-sweat heater power per unit length (W)

<span>${F_{as}}$</span>                        = fraction of anti-sweat heater energy to case

<span>${P'}_{fan,std}$</span>      = standard case fan power per unit length (W/m)

<span>${L_{case}}$</span>          = case length (m)

For every simulation time step, the rated sensible case credits are then adjusted to account for variations at off-rated ambient air temperatures. The model also allows the user to define a case credit fraction using a schedule object. This case credit fraction can be useful for modeling cases that operate differently during specific time periods. For example, metal or plastic coverings may be installed on refrigerated display cases during unoccupied hours which would significantly reduce case credits (e.g., air infiltration) compared to occupied hours when the coverings are removed. If the user does not define a case credit fraction schedule, then the fraction is assumed to be 1 for the entire simulation.

<div>$$\dot Qc{c_{sens}} = \dot Qc{c_{sens,rated}}\left( {\frac{{{T_{db,air}} - {T_{case}}}}{{{T_{db,rated}} - {T_{case}}}}} \right)\left( {SC{H_{cc}}} \right)$$</div>

where:

<span>$\dot Qc{c_{sens}}$</span>      = sensible case credits adjusted for ambient temperature and case credit fraction (W)

<span>${T_{db,air}}$</span>         = dry-bulb temperature of the ambient (zone) air (˚C)

<span>${T_{case}}$</span>           = case operating temperature (˚C)

<span>${T_{db,rated}}$</span>       = rated ambient (zone) dry-bulb temperature (˚C)

<span>$SC{H_{cc}}$</span>       = case credit fraction (schedule value, 0 to 1)

The sensible case credits calculated above are considered heat loads on the refrigerated case evaporator. The ***net*** impact of the case credits on the surrounding zone includes adjustment for the portion of the lighting and anti-sweat heater power that does not directly contribute to the case evaporator load. Sensible case credits are negative values when heat is removed from the zone load.

<div>$$\dot Qc{c_{sens,NET}} = {P_{lights}}(1 - {F_l})\,\, + \,\,{P_{as}}(1 - {F_{as}})\,\, - \,\,\dot Qc{c_{sens}}$$</div>

where:

<span>$\dot Qc{c_{sens,NET}}$</span> = net impact of the sensible case credits on the surrounding zone, negative for cooling (W)

<span>${P_{lights}}$</span>          = case lighting electric power (W)

<span>${F_l}$</span>              = fraction of lighting energy to case

<span>${P_{as}}$</span>             = anti-sweat heater electric power (W)

<span>${F_{as}}$</span>                        = fraction of anti-sweat heater energy to case

When refrigerated cases are served by a compressor rack that rejects condenser waste heat directly to the zone (e.g., a stand-alone refrigerated case with integral compressor and condenser), this condenser waste heat offsets some or all of the sensible case credits. The amount of condenser waste heat rejected to the zone is calculated and reported by the refrigerated case compressor rack object (Ref. Heat Rejection to Zone).

#### Latent Case Credits

Refrigerated cases also remove latent energy (moisture) from the surrounding environment (termed “latent case credits”). In this model, the latent case credit is composed solely of the latent heat transfer by air infiltration <span>${\dot Q_{inf,lat}}$</span>in equation . The latent case credits are calculated as the product of the case length and the total cooling capacity per unit length, latent heat ratio, and runtime fraction at rated conditions. As described previously (Ref. Sensible Case Credits), a case credit fraction schedule is used to model cases that operate differently during specific time periods. The same case credit fraction is used to modify both the sensible and latent case credits. If the user does not define a case credit fraction schedule, then the fraction is assumed to be 1 for the entire simulation. The calculation of latent case credits also includes a factor (*LatentRatio*) that accounts for lower ambient humidity levels. Latent case credits are set to zero during the defrost-dripdown periods.

<div>$${\dot Q_{{\rm{inf}},lat}} = \,\,\,\, - \dot Qc{c_{lat}}\,\, = \,\,{\dot Q_{case,rated}}\left( {LH{R_{rated}}} \right)\left( {RT{F_{rated}}} \right)\left( {SC{H_{cc}}} \right)\left( {LatentRatio} \right){L_{case}}$$</div>

where:

<span>${\dot Q_{{\rm{inf,lat}}}}$</span>         = latent load on the refrigerated case evaporator at current ambient conditions (W)

<span>$\dot Qc{c_{lat}}$</span>        = latent case credit impact on zone load, negative for dehumidification (W)

<span>${\dot Q_{case,rated}}$</span>  = case rated total cooling capacity per unit length (W/m)

<span>$LH{R_{rated}}$</span>  = latent heat ratio of the refrigerated case at rated conditions

<span>$RT{F_{rated}}$</span>   = runtime fraction of the refrigerated case at rated conditions

SCH<sub>CC</sub>     = case credit fraction (schedule value, 0 to 1)

<span>$LatentRatio$</span> = ratio of actual latent load to rated latent load on the case, based on latent case credit curve

<span>${L_{case}}$</span>         = case length (m)

Latent load on the refrigerated case evaporator will vary with ambient humidity levels. Therefore, the refrigerated case model allows the user to specify a latent case credit curve to adjust case credits based on ambient humidity, and the user can select from three curve types: Case Temperature Method, Relative Humidity Method, or Dewpoint Method.

<div>$$\begin{array}{l}{\rm{Case}}\,{\rm{Temperature}}\,{\rm{Method:}}\\ ,\,\,\,LatentRatio = 1 - \left( {R{H_{rated}} - R{H_{air}}} \right)\left[ {m + n\left( {{T_{case}}} \right) + o{{\left( {{T_{case}}} \right)}^2} + p{{\left( {{T_{case}}} \right)}^3}} \right]\,\\ {\rm{RH}}\,{\rm{method:}}\\ ,\,\,\,LatentRatio = q + r\left( {R{H_{air}}} \right) + s{\left( {R{H_{air}}} \right)^2} + t{\left( {R{H_{air}}} \right)^3}\\ {\rm{Dewpoint}}\,{\rm{method:}}\\ ,\,\,\,LatentRatio = u + v\left( {{T_{dp,air}}} \right) + w{\left( {{T_{dp,air}}} \right)^2} + x{\left( {{T_{dp,air}}} \right)^3}\end{array}$$</div>

where:

<span>$R{H_{rated}}$</span>      = rated ambient relative humidity (%)

<span>$R{H_{air}}$</span>        = relative humidity of the ambient (zone) air (%)

<span>${T_{case}}$</span>           = case operating temperature (˚C)

<span>${T_{dp,air}}$</span>         = dewpoint temperature of the ambient (zone) air (˚C)

m…x          = user-defined coefficients using a cubic curve object (Curve:Cubic)

The user specifies the latent case credit curve type and the name of the cubic curve object (Curve:Cubic) that defines the curve coefficients. Representative curve coefficients for curve type “Case Temperature Method” are provided in Table 76.

Table 76. Representative Latent Case Credit Curve Coefficients for Case Temperature Method

<table class="table table-striped">






<tr>
<td>Coefficient</td>
<td>Single-shelf horizontal</td>
<td>Multi-shelf vertical</td>
</tr>
<tr>
<td>m</td>
<td>2.0376E-2</td>
<td>2.6520E-2</td>
</tr>
<tr>
<td>n</td>
<td>2.4378E-4</td>
<td>1.0780E-3</td>
</tr>
<tr>
<td>o</td>
<td>1.1400E-5</td>
<td>-6.0256E-5</td>
</tr>
<tr>
<td>p</td>
<td>1.8110E-7</td>
<td>1.2373E-6</td>
</tr>

</table>


 Note: Coefficients derived for *RH<sub>rated</sub>* = 55% and a rated ambient temperature of 23.9˚C (75˚F). Source:  Howell 1993b.

#### Refrigerated Case Credits With Under Case Return Air

For certain refrigerated case types, the sensible case credits provided to the zone can create an uncomfortably cold environment in the surrounding area. For this reason, return air ducts are frequently placed behind these cases to draw this cold air under the case and direct it back to the HVAC system. This reduces localized over-cooling and improves occupant comfort.

![RAFraction](EngineeringReference/media/image6247.png)

Figure 279. Return Air Factor Versus Under Case HVAC Return Air Fraction

Since under case return ducts reduce the temperature and humidity of the air being recirculated to the HVAC system, this can impact HVAC system performance. Figure 279 shows the relationship that is used by the refrigerated case model to determine the fraction of case credits that directly cool and dehumidify the HVAC system return air. This fraction, referred to as the Return Air Factor (RAF), is a function of the fraction of the HVAC system return air that comes from under the cases. The remaining fraction of the case credits (1-RAF) becomes part of the overall zone air energy balance. If the HVAC system is off for a simulation time step (no return air mass flow), the sensible and latent case credits normally attributed to the HVAC return are set equal to zero (even though they get calculated and reported here as non-zero values) and all case credit energy is applied to the zone air heat balance.

<div>$$\dot Qc{c_{sens,zone}} = \dot Qc{c_{sens,NET}}\left( {1 - RAF} \right)$$</div>

<div>$$\dot Qc{c_{lat,zone}} = \dot Qc{c_{lat}}\left( {1 - RAF} \right)$$</div>

<div>$$\dot Qc{c_{sens,HVAC}} = \dot Qc{c_{sens,NET}}\left( {RAF} \right)$$</div>

<div>$$\dot Qc{c_{lat,HVAC}} = \dot Qc{c_{lat}}\left( {RAF} \right)$$</div>

where:

<span>$\dot Qc{c_{sens,zone}}$</span> = sensible case credit applied to the zone air heat balance (W)

<span>$\dot Qc{c_{lat,zone}}$</span>   = latent case credit applied to the zone air heat balance (W)

<span>$\dot Qc{c_{sens,HVAC}}$</span>= sensible case credit applied to the HVAC return air (zone return air path outlet node) (W)

<span>$\dot Qc{c_{lat,HVAC}}$</span> = latent case credit applied to the HVAC return air (zone return air path outlet node) (W)

RAF            = return air factor (see Figure 279 above)

#### Variable Evaporator Temperature

Control systems are now available that increase the evaporator temperature to improve compressor efficiency whenever the total loads on a system are less than the system capacity. To model these systems, a variable evaporator temperature is an option available with the detailed refrigeration system object (Refrigeration:System). If this option is selected, the model will compare the refrigeration load on each case to the load at rated conditions. If the case load in a particular time step is less than the rated load, an acceptable elevated evaporator temperature is determined for that case. The evaporator temperature for the whole refrigeration system is then set by the minimum evaporator temperature needed for any particular case.

<div>$$\begin{array}{l}L{F_{case}} = \frac{{{{\dot Q}_{case,actual}}}}{{{{\dot Q}_{case,rated}}}};0.5 \le L{F_{case}} \le 1.0\\ {T_{{\rm{Evap,Allowed}}}} = {T_{case}} - L{F_{case}}({T_{case}} - {T_{Evap,Design}})\end{array}$$</div>

where:

LF<sub>case</sub>          = Load factor for a particular case

Tevap         = Evaporator temperature, C.

### Walk-In Coolers and Freezers

The walk-in object (Refrigeration:WalkIn) is another type of refrigeration load that can be placed on either a refrigeration compressor rack, detailed refrigeration system, or secondary refrigeration system object (Refrigeration:CompressorRack, Refrigeration:System, or Refrigeration:SecondarySystem). Walk-in coolers and freezers differ from refrigerated cases in that they may have surfaces facing more than one zone and in that they are always equipped with doors, that is, they do not have open shelves. Their sensible and latent exchange with zones is therefore calculated in a different manner than for refrigerated cases. Also, the walk-in model does not interact directly with the HVAC system, that is, the return air fraction option available in the refrigerated case model is not included.

The walk-in cooler performance is based on the ASHRAE load model, which includes infiltration through door openings and sensible loss through walls/ceilings described by the user for each zone.(ASHRAE 2006d, ASHRAE 2006e, Gosney, W.B., Olama, G.A.-L. 1975) All equipment loads (fan, light, heaters) are modeled as well.  Sensible and latent exchange with multiple adjoining zones is included. A master schedule is used for the Walk In operation and  additional schedules control the lights, defrost, and heater operation.  Just as for cases, unmet refrigeration loads are accumulated to be met the following time step.  This usually occurs during defrost and  restocking.

#### Walk-In Sensible and Latent Heat Exchange

A walk-in can exchange both sensible and latent energy with multiple zones.  The heat transfer calculations are performed separately for each zone so that the heat transfer impact, or zone credits, can be determined. The area of all walls and ceilings facing each zone are described by the user by their thermal conductance and area. Sensible energy exchange takes place between these surfaces and the surrounding zones.  Because these walls interface with conditioned zones at relatively constant temperatures, this heat exchange is modeled very simply:

Q<sub>SurfacesZn</sub> = U<sub>SurfacesZn</sub> x A<sub>SurfacesZn</sub> x ΔT<sub>Zn</sub>

Q<sub>DoorSensZn</sub>     =  U<sub>DoorZn</sub>  x  Area<sub>DoorZn</sub>  x ΔT<sub>Zn</sub>

The heat transfer through the floor is similarly modeled.

Q<sub>Floor</sub> = A<sub>Floor</sub> x U<sub>Floor</sub> x (T<sub>Ground</sub> – T<sub>WalkIn</sub>)

Where:

A<sub>Floor</sub>           = Area of the walkin floor, m<sup>2</sup>

A<sub>SurfacesZn           </sub> = Area of surfaces facing Zone n, m<sup>2</sup>

Q<sub>DoorSensZn</sub>     = Sensible heat transfer through the closed door(s) facing Zone n, W

Q<sub>surfacesZn</sub>      = Sensible heat transfer through walls and ceilings facing Zone n, W

T<sub>Ground</sub>          = Ground temperature, C

T<sub>WalkIn</sub>          = Walk-in operating temperature, C

U<sub>Floor</sub>           = Thermal conductance of floor, W/m2-K

U<sub>DoorZn</sub>         = Thermal conductance of doors facing Zone n, W/m2-K

U<sub>SurfacesZn\\           </sub> = Thermal conductance of surfaces facing Zone n, W/m2-K

ΔT<sub>Zn</sub>            = Difference between walk-in operating temperature and Zone n drybulb temperature, C

Infiltration through doorways places both a sensible and a latent load upon the walk-in, and corresponding credits upon the adjacent zone.  Two types of doors are available, nominally called ‘stock’ and ‘glass’ doors, to enable the user to model doors that differ in thermal conductance, door protection type, and frequency of opening.  The sensible and latent infiltration loads are modeled according to the guidance specified in (ASHRAE 2006d, ASHRAE 2009, and Gosney and Olama, 1975).  The air within the cooler is assumed to be at 90% relative humidity. Equal air exchange is assumed, that is, the mass of dry air infiltrating into the walkin is assumed to equal the mass of dry air infiltrating out of the walkin.

Q<sub>Infiltration</sub> = Q<sub>FullFlow</sub>  x  Factor<sub>DoorOpen</sub>  x Factor<sub>Flow</sub>  x (1 - Factor<sub>Protection</sub>)

Q<sub>FullFlow</sub>=0.221\*A<sub>Door</sub>(h<sub>ZoneAir</sub>-h<sub>AirWalkIn</sub>)ρ<sub>AirWalkIn</sub>(1-ρ<sub>ZoneAir</sub>/ρ<sub>AirWalkIn</sub>)<sup>0.5</sup>(g\*H<sub>Door</sub>)<sup>0.5</sup>Factor<sub>Density</sub>

Factor<sub>Density</sub> = (2 /(1 + (ρ<sub>AirWalkIn</sub> / ρ<sub>ZoneAir</sub>)<sup>0.333</sup>)) <sup>1.5</sup>

m<sub>DryAir</sub> = Q<sub>Infiltration</sub> / (h<sub>ZoneAir</sub> - h<sub>AirWalkIn</sub>)

m<sub>Water</sub> =  m<sub>DryAir</sub>  x (W<sub>ZoneAir</sub> - W<sub>AirWalkIn</sub>)

Q<sub>WalkInLatentZn</sub> = m<sub>Water</sub> x Δh<sub>IcetoVapor</sub>  x (1  - SCH<sub>Defrost,DripDown</sub>)

Q<sub>WalkInSensInfZn</sub>  = Q<sub>Infiltration</sub> - (m<sub>Water</sub> x Δh<sub>IcetoVapor</sub>)

Where:

A<sub>door</sub>            =  Area of door facing Zone n, m<sup>2</sup>

Factor<sub>DoorOpen</sub> = Value scheduled by user, fraction of time door open during time step

Factor<sub>Flow</sub>    =  Doorway flow factor, = 0.8 if ΔT<sub>Zn</sub> &gt; 11C; =1.1 if ΔT<sub>Zn</sub> &lt;= 11C

Factor<sub>Protection</sub> = Doorway protection factor, = 0 for no protection; =  0.5 for an air curtain; and 0.9 for a strip curtain

g    =  Gravitational constant

h<sub>AirWalkIn               </sub> =  enthalpy of the air within the walk in, =  f(T<sub>WalkIn</sub>,P<sub>Oudoor</sub>, 90%RH), J/kg

h<sub>ZoneAir                  </sub> =  enthalpy of the air in Zone n, J/kg

H<sub>door</sub>            =  Height of door facing Zone n, m

Q<sub>FullFlow</sub>        = Sensible and latent refrigeration load for fully established flow, W

Q<sub>Infiltration</sub>       = Average infiltration (sensible and latent) refrigeration load for the time step, W

Q<sub>WalkInLatentZn</sub> = Latent load upon the walk in facing Zone n, W

Q<sub>WalkInSensInfZn</sub>  = Sensible load due to infiltration upon the walkin facing Zone n, W

m<sub>DryAir</sub>          = Mass of dry air infiltrating into the walk-in, kg/s

m<sub>Water</sub>          = Mass of water removed from the infiltrating air, kg/s

P<sub>Oudoor                  </sub> =  Outdoor air pressure, Pa

SCH<sub>Defrost,DripDown</sub> = value from 0 to 1 indicating whether the system is in the dripdown period

W<sub>AirWalkIn            </sub> =  Humidity ratio of the air within the walk in, =  f(T<sub>WalkIn</sub>,P<sub>Oudoor</sub>, 90%RH), kg/kg

W<sub>ZoneAir</sub>        =  Humidity ratio of Zone n air, kg/kg

Δh<sub>IcetoVapor</sub>     =  Latent heat absorbed to change ice to vapor, J/kg

ρ<sub>AirWalkIn               </sub> =  Density of the air within the walk in =  f(T<sub>WalkIn</sub>,P<sub>Oudoor</sub>, 90%RH), kg/m<sup>3</sup>

ρ<sub>ZoneAir</sub>          =  Density of air in Zone n, kg/m<sup>3</sup>



The sensible load on the case and the sensible credit to the zone continue throughout the defrost and dripdown periods.  However, to be consistent with the treatment of refrigerated cases, there is no latent credit to the zone or latent load upon the cooler during the dripdown period. Latent load and latent credit are both based on reducing the infiltrating vapor to ice. The sensible heat exchange between the walk in and the zone is then the total of the heat transfer through the doors and surfaces and the infiltration sensible load. The latent load upon the walkin is converted to the amount of frost added to the coils during each time step.  This accumulating value is used later to determine the load placed upon the walkin during the defrost cycle.

Q<sub>WalkInSensZn </sub>  = Q<sub>WalkInSensInfZn</sub> + Q<sub>DoorZn</sub> + Q<sub>surfacesZn</sub>

Q<sub>ZoneLatent</sub>  = - Q<sub>WalkInLatentZn</sub>

Q<sub>ZoneSens</sub>  = - Q<sub>WalkInSensZn</sub>

ΔFrost<sub>Zn</sub> = (m<sub>Water</sub> \*Δtime)\* (1- SCH<sub>Defrost,DripDown</sub>)

Where:

Q<sub>WalkInSensZn    </sub>  = Total sensible heat exchange between the walkin and Zone n, W

Q<sub>ZoneLatent</sub>      = Latent load upon the Zone n, W

Q<sub>ZoneSens</sub>       = Sensible load upon Zone n , W

ΔFrost<sub>Zn           </sub> = Change in frost inventory, kg

Δtime          = Length of time step, s

After the heat exchange with each zone is calculated, the total load on the walkin is calculated:

Q<sub>WalkInLatentTot</sub> = ∑Q<sub>WalkInLatentZn</sub>

Q<sub>WalkInSensTot  </sub> = ∑Q<sub>WalkInSensZn</sub> + Q<sub>Light</sub>+ Q<sub>Fan</sub>+ Q<sub>Heater</sub> + Q<sub>Defrost\\ +</sub> Q<sub>Stocking\\ +</sub> Q<sub>Floor</sub>

Q<sub>WalkInTotal</sub> = Q<sub>WalkInLatentTot</sub> + Q<sub>WalkInSensTot</sub>

ΔFrost<sub>Tot</sub> = ∑ΔFrost<sub>Zn</sub>

Where Q<sub>Light</sub>, Q<sub>Fan</sub>, Q<sub>Heater</sub> , Q<sub>Stocking</sub> , and Q<sub>Defrost</sub> are described below.

#### Walk-In Fans, Heaters, Lighting, and Restocking

Sensible heat loads are placed on a walk-in by fans, heaters, and lighting. Unlike refrigerated cases, there is no option to allocate any portion of these heat loads to the surrounding zone(s). Larger walk-ins will have separate fans at the cooling coil and for general circulation. The general circulation fan is assumed to run at all times. The cooling coil fan is assumed to be off for Hot-Fluid and Electric defrost. Lighting, heating, and restocking are modeled according to the schedule values entered by the user. For lighting and heating, the maximum power is entered along with a scheduled ratio (between 0 and 1) to be applied for any point in time.  The heating power includes all heaters except those used for defrost purposes. The heater power should include anti-sweat, door, floor, and drain-pan heaters. For restocking, the total sensible load in Watts is scheduled for each point in time (the restocking latent load is assumed to be zero).

Q<sub>Light</sub> = RatedQ<sub>Lighting</sub> \* SCH<sub>Lighting</sub>

Q<sub>Fan</sub> =  Power<sub>CircFan</sub> + Power<sub>CoilFan</sub> \* ( 1 - SCH<sub>DripDown</sub> )

Q<sub>Heater</sub> = Power<sub>Heater</sub> \* SCH<sub>Heater</sub>

Q<sub>Stocking</sub> = SCH<sub>Stocking</sub>

Where:

Q<sub>Light                      </sub> = Refrigeration load due to lighting during current time step, W

RatedQ<sub>Lighting</sub> = Maximum lighting load specified for the walk-in, W

SCH<sub>Lighting        </sub> = Scheduled value between 0 and 1 for the current time step

Q<sub>Fan</sub>            =  Refrigeration load due to fan power during the current time step, W

Power<sub>CircFan</sub> =  Rated circulating fan power, W

Power<sub>CoilFan</sub> =  Rated coil fan power, W

SCH<sub>DripDown    </sub> = Scheduled value between 0 and 1 for the current time step

Q<sub>Heater</sub>          = Refrigeration load due to heaters during current time step, W

Power<sub>Heater</sub>   = Rated total heater(s) power (including anti-sweat, floor, door, etc.) , W

SCH<sub>Heater\\          </sub> = Scheduled value between 0 and 1 for the current time step

Q<sub>Stocking</sub>        = Refrigeration load due to stocking during the time step, W

SCH<sub>Stocking</sub>    = Scheduled value of load due to stocking, W

#### Defrost

The defrost types available for the walk-in model include none, off-cycle, electric, and hot-fluid. Defrosts are started according to scheduled times and can be ended either by schedule or by temperature termination. Dripdown schedules are used to keep the cooling coil off long enough to drain any condensate from the system.

For defrost types none and off-cycle, the refrigeration load on the walk-in due to defrost is zero.  For off-cycle, the walk-in refrigeration capacity is set to zero during the drip-down scheduled time.

The energy required for hot-fluid defrost is assumed to be reclaimed from the compressor exhaust (for detailed systems, this energy appears as a credit against the heat rejection needed at the condenser). The energy used by electric defrost is available as an output variable.

If the defrost cycle is controlled by the schedule, the refrigeration load placed upon the walk-in is calculated as the product of the defrost capacity and the defrost schedule. The load is then reduced according to the amount of accumulated ice melted during that time step.

Q<sub>Defrost</sub> = Capacity<sub>Defrost</sub>\*SCH<sub>Defrost</sub> – Δfrost x Δh<sub>IceMelt</sub> / Δtime

Where:

Q<sub>Defrost</sub>         = Refrigeration load imposed by defrost heat, W

Capacity<sub>Defrost</sub> = Rated defrost power, W

SCH<sub>Defrost         </sub> = Scheduled value between 0 and 1 for the current time step

Δfrost         = amount of frost melted during time step, kg

Δh<sub>IceMelt</sub>        = heat of fusion for ice, J/kg

Δtime          = time in time step, s

If the defrost is controlled by temperature termination, the defrost cycle is assumed to end when all the ice is melted.  However, we need to recognize not all defrost heat goes to melt ice. Some of the defrost heat goes to raising the temperature of the coil mass to greater than 0C, and some is transferred to the walk-in environment as some of the coils are defrosted before others.  The user enters a ‘defrost energy fraction’ to specify the portion of the defrost energy that goes directly to melting ice.  The default for defrost energy fraction is 0.7 for electric defrost and 0.3 for warm fluid defrost.( Baxter, V. D., Mei, V.C., 2002) For this type of defrost control, the model calculates the amount of energy available to melt the ice in each time step. The accumulated amount of ice is then reduced accordingly. When all the ice is melted, the defrost schedule value is set to zero and no further defrost load is placed upon the walk-in cooler.  If the defrost schedule ends before the ice is melted, the schedule is used and the ice continues to accumulate until the next defrost cycle. The refrigeration capacity is kept at zero until the end of the drip-down schedule. Until the accumulated ice is melted, the defrost heat load upon the walk-in is:

Q<sub>Defrost</sub> = Capacity<sub>Defrost</sub> x SCH<sub>Defrost</sub> x (1- Fraction<sub>DefrostEnergy</sub>)

### Air Chillers and Air Chiller Sets

The Air Chiller object (Refrigeration:AirChiller) is another type of refrigeration load that can be placed on either a refrigeration compressor rack, detailed refrigeration system, or secondary refrigeration system object (Refrigeration:CompressorRack, Refrigeration:System, or Refrigeration:SecondarySystem). Air chillers are used to model the type of equipment typically used in refrigerated warehouses. For that reason, there is a major difference between the air chiller model and those for refrigerated cases or walk-ins. For cases and walk-ins, a portion of the model is directed toward calculating the amount of refrigeration needed to maintain the refrigerated volume at the desired temperature due to heat exchange with the surrounding zone, and that zone is conditioned to a nearly constant temperature.  In a refrigerated warehouse, the refrigeration load is caused by heat exchange with a variable external environment.  For that reason, the loads for these zones are calculated by the usual EnergyPlus zone heat balance.  The amount of refrigeration needed to maintain the specified temperature set points is then passed to the air chiller model, in a similar fashion to the load passed to a window air conditioner model. The air chillers are therefore solved using the system time step, not the zone time step used for cases and walk-ins.

The air chiller performance is based on three types of manufacturers ratings, Unit Load Factor, Total Capacity Map, or a set of European standards. Correction factors for material and refrigerant are applied to all of these ratings.

#### Unit Load Factor Capacity

Bruce Nelson has provided a useful description of the Unit Load Factor approach.(Nelson, B.I., 2010)

*“One well-known method used to calculate the sensible cooling capacity of evaporators is the effectiveness method.(Kays,* *W.M., A.L. London, 1964)  Heat exchanger effectiveness is defined as the ratio of the actual amount of heat transferred to the maximum possible amount of heat that could be transferred with an infinite area. This method is extremely useful because cooling capacity can be calculated directly knowing only the dimensional characteristics of the coil and the initial temperature difference (entering air temperature minus the evaporating temperature). This initial temperature difference is referred to as “DT1” … in the refrigeration industry. Sensible cooling capacity is calculated as follows:*

<div>$${q_{{\rm{sens}}}} = \dot m \times {c_p} \times \varepsilon  \times ({T_{{\rm{coil inlet}}}} - {T_{{\rm{evap}}}}) = \dot m \times {c_p} \times \varepsilon  \times DT1$$</div>

*For a given size of coil operating with constant airflow rate, the effectiveness can be considered constant over the small op- erating temperature ranges typical of refrigeration applications, and therefore, capacity can be considered to be proportional to the ratio of DT1. Hence, if evaporator coil sensible capac- ity is known for a given DT1, then capacity at a new initial temperature difference, DT1␣, can be found by multiplying the original capacity by the ratio DT1␣/DT1.”*

Where:

q<sub>sens</sub>            = Cooling capacity (sensible only), W

<span>$\dot m$</span>              = mass flow rate of air, kg/s

<span>${c_p}$</span>             = specific heat capacity of moist air, J/kg-C

<span>$\varepsilon $</span>               = effectiveness (=(T<sub>coil\\ inlet</sub> – T<sub>coil</sub> exit)/(T<sub>coil\\ inlet</sub> - T<sub>evap</sub>)

T<sub>coil\\ inlet</sub>         = dry-bulb air temperature entering the coil, C

T<sub>evap</sub>            = average refrigeratnt evaporating temperature, C

T<sub>coil\\ exit</sub>          = dry-bulb air temperature leaving the coil, C

DT1            = initial temperature difference, C



Using this approach, the manufacturer specifies the Unit Load Factor in terms of sensible capacity per degree of temperature difference.

<div>$$ULF = Capacit{y_{Rated,Sensible}}/DT{1_{Rated}}$$</div>

*The total capacity is the sum of the sensible and latent capacity. The sensible heat ratio (SHR) is the sensible heat transfer divided by the total (sensible plus latent) heat transfer. Again, from Nelson,* (Nelson, B.I., 2010)

*The mass transfer process is much more “thermally effective” than the sensible heat transfer process, that is, the heat flux through the evaporator surfaces during the mass transfer process is extremely high.(AHRI, 2001) Consequently, if the surface effectiveness of the coil were to remain constant, the increase in the evaporator cooling capacity during combined sensible and latent cooling would be equal to the sensible cooling capacity divided by the SHR… However, the increase in heat flux through the fin surfaces has the effect of decreasing fin efficiency and overall surface effectiveness due to an increase in the fin surface temperature gradient.7 The result is a slightly lower total cooling capacity.*

<div>$$\begin{array}{*{20}{c}}{{Q_{ideal}} = \frac{{{q_{sens}}}}{{SHR}};}&{SHR = \frac{{{q_{sens}}}}{{{Q_{total}}}}}\end{array}$$</div>

Where:

<span>${Q_{{\rm{ideal}}}}$</span>          = Cooling capacity (total) if fin efficiency and total effectiveness were constant, W

<span>${Q_{{\rm{Total}}}}$</span>         = Cooling capacity (total), actual



The total capacity is therefore a function of the sensible heat ratio, which is a function of the total capacity, and they are both, of course a function of the psychometrics of the air flowing through the chiller. This is handled with a two step estimation process.

<div>$$\begin{array}{l}\Delta T = {\rm{Minimum}}(\Delta {T_{{\rm{max}}}},({T_{{\rm{Coil inlet}}}} - {T_{{\rm{evap}}}}))\\ {q_{{\rm{sens,max}}}} = ULF*\Delta T \times (1 - SC{H_{{\rm{Defrost,DripDown}}}}) \times SC{H_{{\rm{Coil}}}}\\ {T_{{\rm{Coil exit estimate}}}} = {T_{{\rm{Coil inlet}}}} - \frac{{{q_{{\rm{sens,max}}}}}}{{{{\dot m}_{{\rm{DryA ir}}}} \times {c_{p,{\rm{Coil Inlet Dry Air}}}}}}\\ {h_{{\rm{Coil exit estimate}}}} = f({T_{{\rm{Coil exit estimate}}}},{P_{{\rm{Barometric}}}}){\rm{at a Relative Humidity of 1}}{\rm{.0}}\\ {Q_{{\rm{Total estimate}}}} = ({h_{{\rm{Coil Inlet}}}} - {h_{{\rm{Coil exit estimate}}}}) \times {{\dot m}_{{\rm{max}}}}\\SHR = \frac{{{q_{{\rm{sens,max}}}}}}{{{Q_{{\rm{Total estimate}}}}}}\\ {\rm{Correction}} = f(SHR);{\rm{Function input by user, linear or quadratic curve}}\\ {Q_{{\rm{Total}}}} = {\rm{Correction}} \times {q_{{\rm{sens,max}}}}\end{array}$$</div>

Where:

<span>$\Delta T$</span>            = Temperature difference between the inlet air and the average evaporating temperature, C

<span>$\Delta T{}_{Max}$</span>       = Maximum temperature difference specified by the user, C

SCH<sub>Coil</sub>        = Coil availability schedule

h<sub>Coil\\ exit</sub>         = Enthalpy of air at the coil exit

h<sub>Coil\\ inlet</sub>         = Enthalpy of air at the coil inlet

P<sub>Barometric</sub>      =Barometric air pressure,Pa



The “Correction” function must be obtained from the chiller manufacturer. Some curves typical of ammonia chillers have been published (see, for example, Fig. 2 in (Nelson, B.I., 2010)). A default linear approximation of this curve is provided as an input option.

#### European Standard Ratings

Five standard rating conditions have been defined in a European rating system. The capacity is reported at the rating condition as either the “Nominal” or “Standard” capacity. The “Nominal” capacity includes both latent and sensible loads and the “Standard” capacity includes sensible loads only. “Wet Coil Factors” are provided with the ratings to translate between the two, along with a chart giving the impact of Air Inlet Temperature on the Wet Coil Factor. The user identifies the rating condition used and whether the capacity input is “Nominal” or “Standard”. These rating factors, along with the air inlet temperature and evaporating temperature are used to calculate the actual cooling capacity.

<div>$${Q_{{\rm{Total}}}} = {Q_{{\rm{Nominal}}}} \times \frac{{WetCoilFactor({T_{{\rm{Coil inlet}}}})}}{{WetCoilFactor({\rm{Standard Condition}})}} \times \frac{{\Delta T}}{{\Delta {T_{{\rm{Rated}}}}}}$$</div>

#### Total Capacity Map

Some manufacturers are beginning to provide more comprehensive performance information. For these air chillers, the manufacturers specify a Rated Total Capacity at a given inlet air relative humidity.  A table or set of curves is then provided to calculate the total capacity Q<sub>Total</sub>,  as a function of the inlet air temperature and relative humidity, and the average evaporating temperature.

#### Sensible and Latent Capacity

The sensible and latent loads served are then calculated as:

<div>$$\begin{array}{l}{h_{{\rm{Coil exit}}}} = {h_{{\rm{Coil Inlet}}}} - \frac{{{Q_{{\rm{Total}}}}}}{{{{\dot V}_{{\rm{A ir,Max}}}} \times {\rho_{{\rm{Coil Inlet}}}}}}\\ {T_{{\rm{Coil exit}}}} = f({h_{{\rm{Coil exit}}}}){\rm{at a Relative Humidity of 1}}{\rm{.0}}\\H{R_{{\rm{Coil exit}}}} = f({T_{{\rm{Coil exit}}}},{h_{{\rm{Coil exit}}}})\\ {{\dot m}_{Water}} = {{\dot m}_{dryair,\max }} \times (H{R_{{\rm{Coil exit}}}} - H{R_{{\rm{Coil inlet}}}})\\ {q_{latent}} = {{\dot m}_{water}} \times {h_{icetovapor}}\\ {q_{{\rm{sens}}}} = {Q_{Total}} - {q_{latent}}\end{array}$$</div>

Where:

<span>${\dot V_{Air,Max}}$</span>       = Maximum air flow, m<sup>3</sup>/s

HR              = Humidity Ratio, kg water/kg dry air

h<sub>ice\\ to\\ vapor</sub>  =   enthalpy of phase change from vapor to ice

When the sensible capacity provided is greater than the sensible load requested from the zone energy balance, the coil fan speed is varied as described later for the condenser fan. The latent load and amount of water condensed from the air are scaled accordingly.

The frost accumulation and defrost cycles are handled as described previously for walk-in coolers.

The net sensible heat impact on the zone is the difference between the coil’s sensible cooling capacity and any energy added during that time step by heaters, fan motors, and defrost.



### Detailed Refrigeration Systems

The detailed refrigeration system object (Refrigeration:System) is an alternative to the refrigeration compressor rack object (Refrigeration:CompressorRack). Either works in conjunction with the refrigerated case and walk-in objects (Refrigeration:Case and Refrigeration:WalkIn) to simulate the performance of a retail refrigeration system. The detailed system model differs from the compressor rack model in that it:

1)    requires performance data for each compressor (see the RefrigerationCompressorCurves dataset),

2)    requires condenser performance curves for air- and evaporative-cooled condensers,

3)    explicitly calculates the amount of superheat available for reclaim in an optional air or water heating coil,

4)    allows the suction temperature to rise when the case loads are less than the design loads, thus improving compressor efficiency,

5)    allows the transfer of loads from one system to another, including cascade condensers and secondary systems typically used to reduce the amount of refrigerant inventory in the primary system, and mechanical subcoolers typically used to transfer a part of the refrigeration load from a lower-temperature system to a more efficient higher-temperature system,

6)    allows the use of liquid suction heat exchangers which will improve the cycle efficiency for some refrigerants,

7)    models three condenser fan types,

8)    allows the user to keep track of refrigerant inventory,

9)    does not assume that the compressor and condenser capacity is sufficient to meet the case loads, but carries unmet load over to the next time step,

10) provides optional suction piping heat gain for comparison to distribution piping heat gain for secondary systems. [Note, these piping heat gains are also reflected in the zone heat balance. This piping heat gain is not to be confused with the pressure change in the suction piping, even though this pressure change is typically expressed in terms of an change in the saturated suction temperature].

#### Refrigeration System Loads and Convergence

The refrigeration loads for refrigerated cases and walk-ins are added to provide the first value for the refrigeration load on a detailed system, as well as the evaporating temperature. (If there are no cases or walk-ins served directly by a system, that system is not solved until the energy transfer loads are available.) The user can also choose to include suction pipe heat gain as a load on the system. The performance of refrigeration compressors is dependent upon the condensing and evaporating temperatures. The calculation starts with an estimated condensing temperature, which is used to calculate the compressor power use.

<div>$${\dot Q_{{\rm{Refrigeration}}}} = \sum {{{\dot Q}_{case}}}  + \sum {{{\dot Q}_{walkin}}} ( + \sum {{{\dot Q}_{PipeHeatGain}}} )$$</div>

<div>$${\dot Q_{System,Estimated}} = {\dot Q_{{\rm{Refrigeration}}}} + {P_{Compressors,Estimated}}$$</div>

These values are in turn used to determine the total heat rejection load on the condenser, which produces a new estimate for the condensing temperature. A few iterations are usually necessary to converge upon the final condensing temperature and compressor power for each time step for each system.

After each detailed refrigeration system has been solved, all energy transfers (subcoolers, secondary loops, and cascade condensers) among the systems are made.

<div>$$\begin{array}{*{20}{c}}{{{\dot Q}_{Transfer}} = \sum {{{\dot Q}_{CascadeCondenser}} + \sum {{{\dot Q}_{SecondaryLoop}} + \sum {{{\dot Q}_{MechanicalSubcooler}}} } } }\\ {{{\dot Q}_{{\rm{Refrigeration}}}} = \sum {{{\dot Q}_{Case}} + \sum {{{\dot Q}_{WalkIn}} + \sum {{{\dot Q}_{Transfer}}( + \sum {{{\dot Q}_{PipeHeatGain}}} )} } } }\end{array}$$</div>

This two step process is repeated twice to ensure that all the energy transfers among systems are balanced.

Suction piping heat gain is an optional element in the load calculation.  Typically, the suction pipe heat gain is small compared to the other loads.  However, when comparing DX systems to secondary systems, this portion of the total load can be very different. (Hinde, D., et al. 2009)  To calculate the pipe heat gain load, the user must first calculate the U-value and area for the suction piping.  The U-value is the total conductance from the inside skin coefficient to the outside skin coefficient. This value must be multiplied by the area to provide the “sum of the UA in W/C,”  required in the input.

#### Compressor Energy Use

The compressor object (Refrigeration:Compressor) calculations start with the determination of the inlet (suction) and outlet (discharge) conditions. The suction pressure is defined by the saturated suction temperature (equal to the evaporating temperature in the refrigeration loads connected to the suction group) minus the pressure drop in the suction pipes. With proper design, this pressure drop typically corresponds to a saturated suction temperature drop of about 1C. The saturated discharge pressure is defined by the condensing temperature plus the pressure drop in the discharge pipes. With proper design, this discharge pipe pressure drop typically corresponds to a saturated discharge temperature increase of about 0.5C (ASHRAE 2006a). These two temperatures are then used with the manufacturer’s performance curves for each compressor. The performance curves are defined in ARI Standard 540 and take the following form (ARI 2004):

<div>$$\begin{array}{l}X = {C_1} + {C_2}(S) + {C_3}(D) + {C_4}({S^2}) + {C_5}(SD) + {C_6}({D^2}) + {C_7}({S^3}) + {C_8}(D{S^2}) + {C_9}(S{D^2}) + {C_{10}}({D^3})\\S = {T_{evap}} - 1.\\D = {T_{condense}} + 0.5\end{array}$$</div>

where:

X    = can represent power input (W), or cooling capacity(W)

C      = compressor performance coefficient (be sure to see the IO Reference guide because the Energy Plus input order for this equation does not match this ARI form)

S    = Saturation temperature corresponding to the suction pressure (C)

D    = Saturation temperature corresponding to the discharge pressure (C)

T<sub>evap</sub>            = Evaporating temperature (C)

The rated values for the cooling capacity and power consumption from the manufacturer include a specified amount of subcooling before the thermal expansion valve and a certain amount of superheat in the suction gas. Adjustments must be made to these rated values to reflect the actual subcooling and superheat conditions. Actual subcooling is determined by the condenser’s rated subcooling and by the subcooling provided by optional subcoolers. The actual superheat is determined by the refrigerated case superheat (usually set to ensure that there is no liquid in the suction lines leading to the compressors), set here at 4C, and the effect from any optional subcoolers(ASHRAE 2006b). These various state points are shown in Figure 280.

![CorrectedPHcycledrawing](EngineeringReference/media/image6275.png)

Figure 280. State Points and Energy Flows for Detailed Refrigeration System

Once the corrected capacity is calculated for each compressor, the compressors are dispatched one at a time until the system load is met. The last compressor dispatched is assumed to run at full load for the fraction of the time step necessary to meet the load, That is, the model neglects compressor cycling losses at part-load conditions. Using the state point identification from Figure 280, these corrections are shown in the following equations. If the capacity available from all the compressors is less than the sum of the case loads for that time period, the unmet load is accumulated to be met in succeeding time steps. If this accumulated unmet load becomes too great, a warning message is generated.

<div>$$\begin{array}{*{20}{c}}{Ca{p_{corrected}} = \frac{{{\rho_{1b}}}}{{{\rho_{1c}}}} \times \frac{{({h_{1b}} - {h_4})}}{{({h_{1c}} - {h_{4c}})}}Ca{p_{rated}}}\\ {\dot m = \frac{{Ca{p_{corrected}}}}{{({h_{1b}} - {h_4})}}}\end{array}$$</div>

where:

<span>$\dot m$</span>= mass flow rate of refrigerant, kg/s

ρ    = density, kg/m<sup>3</sup>

h    = enthalpy, J/kg

Cap            = refrigeration capacity of an individual compressor, W

Compressor performance can also be improved by allowing the suction pressure to rise whenever the sum of the loads on the refrigerated cases served by the compressors is less than the design load. The calculation of the maximum allowable evaporator temperature is described in “Variable Evaporator Temperature” in the discussion of Refrigeration Cases.

#### Two-Stage Compression Systems

In addition to the single-stage compression refrigeration system illustrated above, two-stage compression systems can be modeled.  For low temperature applications where the pressure ratio between the low- and high-pressure sides of the system could be 1:10 or more, it may be beneficial to utilize two stages of compressions (Evans 2008).  Two smaller compressors in series have a smaller displacement and usually operate more efficiently than one large compressor that covers the entire pressure range from the evaporator to the condenser.  This is especially true in ammonia refrigeration systems due to the large amount of superheating that occurs during the compression process (ASHRAE 2009b).

Between the two stages of compression, an intercooler is used to cool the discharge gas exiting the low-stage compressor before it enters the high-stage compressor.  The cooling is performed within the intercooler by refrigerant at an intermediate pressure.  The degree to which intercooling reduces the power requirement of a refrigeration cycle depends on the refrigerant which is being used as well as the temperature lift between the evaporator and the condenser.

Several methods of two-stage compression and intercooling have been used.  For large industrial refrigeration systems, typical of ammonia systems used in refrigerated warehouses, both shell-and-coil intercooling (Figure 281) and flash intercooling (Figure 282) are used.  The two stages of compression in these systems may be performed by separate low- and high-stage compressors or with a compound compressor containing both the low and high stages within the same compressor body.

![](EngineeringReference/media/image6278.png)

Figure 281.  Two-Stage Compression System with a Shell-and-Coil Intercooler.



![](EngineeringReference/media/image6279.png)

Figure 282.  Two-Stage Compression System with a Flash Intercooler.

For two-stage compression systems with intercooling, there is an optimum intermediate pressure that minimizes the total power consumption of the system.  In the case of an ideal intercooler in which the refrigerant gas enters the high-stage compressor at the same temperature as it enters the low-stage compressor, the minimum compressor work is achieved using the same pressure ratio across both compressors (Baek et al. 2005).  Typically, the optimum intermediate pressure is approximated as the geometric mean pressure of the system as follows:

<div>$${P_{{\mathop{\rm int}} ercooler}} = \sqrt {\left( {{P_{evaporator}}} \right)\left( {{P_{condenser}}} \right)} $$</div>

where *P<sub>intercooler</sub>* is the pressure within the intercooler shell, *P<sub>evaporator</sub>* is the evaporating pressure and *P<sub>condenser</sub>* is the condensing pressure.

The low-stage compressors operate between the evaporator pressure and the intercooler pressure while the high-stage compressors operate between the intercooler pressure and the condensing pressure.  The performance of both the low-stage and high-stage compressors are modeled using the compressors’ performance curves defined by ARI Standard 540 (ARI 2004), as discussed previously in the “Compressor Energy Use” section.  In addition, capacity corrections are applied to the compressor performance curves to account for deviations between the actual operating conditions and the rated conditions.

Refering to Figure 281 for a two-stage system with a shell-and-coil intercooler, the performance of the intercooler is modeled with a “Shell-and-Coil Intercooler Effectiveness”, defined as follows:

<div>$$\eta  = \frac{{{T_4} - {T_{5a}}}}{{{T_4} - {T_3}}}$$</div>

where *η* is the shell-and-coil intercooler effectiveness, *T*<sub>4</sub> is the inlet temperature of the liquid refrigerant at Location 4, *T*<sub>5*a*</sub> is the outlet temperature of the liquid refrigerant at Location 5a, and *T*<sub>3</sub> is the saturated refrigerant temperature within the intercooler shell.  Valid values for the effectiveness range from 0.0 to 1.0.  An effectiveness of zero indicates that no heat is transferred from the refrigerant in the shell-side of the intercooler to the liquid refrigerant in the coil-side of the the intercooler, and thus, there is no change in the temperature of the liquid refrigerant from Location 4 to Location 5a.  An effectiveness of 1.0 indicates that the temperature of the liquid exiting the coil-side of the intercooler at Location 5a is equal to the temperature of the saturated refrigerant in the shell-side of the intercooler.  The user may specify a value for the intercooler effectiveness and a default value of 0.8 is used if no value is specified.  Furthermore, it is assumed that saturated vapor refrigerant exits the shell-and-coil intercooler at Location 9.

For the flash intercooler shown in Figure 282, it is assumed that saturated liquid exits the intercooler at Location 3a and saturated vapor refrigerant exits the intercooler at Location 7.

The two-stage compression refrigeration system may include an optional mechanical subcooler or liquid-suction subcooler.  These subcoolers cool the liquid refrigerant which exits the intercooler before the refrigerant enters the thermal expansion valve.  Further details regarding the modeling of mechanical and liquid-suction subcoolers may be found in the “Subcoolers” section.

#### Condenser Performance

Only one condenser is allowed per system. However, multiple refrigeration systems can reject heat through the same condenser. If a single condenser is used by multiple refrigeration systems, the code will iterate just as it does for loads transferred between systems to ensure that the total load on the condenser is accounted for in determining the saturated condensing temperature.

The condenser can be modeled as dry air cooling, wet evaporative cooling, water loop cooling, or cascade cooling. (The detailed system can not be used for a compressor rack discharging heat into a conditioned zone.) The condenser performance is modeled to determine: (1) the condensing temperature and enthalpy of the refrigerant entering the refrigerated cases attached to the suction group, both of which will influence the efficiency of the compressors, (2) auxiliary power consumption for fans and pumps, and (3) water consumption for evaporative and water-cooled condensers.

EnergyPlus can simulate waste heat being reclaimed from a detailed refrigeration system for use by refrigerant-to-air and refrigerant-to-water heating coils. (Refer to objects Coil:Heating:Desuperheater and Coil:WaterHeating:Desuperheater for a complete description of how these coils are modeled.) Heat reclaimed from the detailed refrigeration system is limited to the portion of the rejected heat in the superheat region. Using the state point nomenclature from Figure 280, this value is calculated by the detailed compressor and condenser models each time step as follows:

<span>$$</span><span>${\dot Q_{AvailableSuperheat}} = \dot m\left( {{h_{{\rm{2}}a}} - {h_{2b}}} \right)$</span>

Heat reclaimed for hot gas or hot brine defrost is not limited to the superheat range. However, if an excessive amount of the system rejected heat is diverted for that purpose, a warning is issued advising the user to increase the diversity of the defrost schedules.

The total heat rejection load on the condenser is the sum of the case and walk-in loads, any transfer loads (e.g., mechanical subcooler or secondary system (see object Refrigeration:SecondarySystem)) on the system(s), and the total compressor power. The condenser load is reduced by any heat reclaimed by desuperheating coils for HVAC or water heating purposes and hot gas or hot brine defrost. If a secondary system or cascade condenser is served by the system(s) using this condenser, any defrost heat rejection credits from loads on the secondary system are assigned to this condenser.

<div>$${\dot Q_{Rejected}} = \sum {{{\dot Q}_{System}}}  - \sum {{{\dot Q}_{Reclaimed}}} $$</div>

where:

<sub><span>${\dot Q_{Rejected}}$</span></sub>     = Heat rejected by the condenser (W)

<span>$\sum {{{\dot Q}_{Reclaimed}}} $</span>= Sum of all the heat reclaimed by desuperheater coils and hot gas and hot brine defrost (W)

Depending upon the condenser type, the heat rejection environment is set to the ambient conditions, conditions corresponding to a defined ouside air node (sometimes used to represent condensers located above ground level) or zone node, to a temperature specified for a water-cooled condenser, or according to the evaporating temperature for a higher-temperature loop (used for cascade condensers).

The enthalpy of the condensed refrigerant leaving the condenser is equal to:

<div>$${h_{condenser,out}} = {h_{sat,liquid}}({T_{condense}}) - {c_{p,sat,liquid}}({T_{condense}}) \times \Delta {T_{RatedSubcooling}}$$</div>

where

h<sub>condenser,out</sub>     = enthalpy leaving the condenser, J/kg

h<sub>sat,liquid</sub>         = enthalpy of saturated liquid at the condensing temperature, J/kg

c<sub>p,sat,liquid             </sub> = specific heat of saturated liquid at the condensing temperature, J/kg-C

ΔT<sub>RatedSubcooling</sub>            = Amount of subcooling included in condenser rated heat rejection, C

A minimum condensing temperature is specified for the detailed refrigeration system, and is usually required to maintain acceptable thermal expansion valve performance. When the calculated condensing temperature is less than this minimum, the air flow for air and evaporative-cooled condensers is reduced to reduce the condenser capacity and maintain the required condensing temperature.

##### Air-Cooled Condensers

The heat rejection capacity of a dry air-cooled condenser object (Refrigeration:Condenser:AirCooled) is directly proportional to the difference between the condensing temperature and the drybulb temperature for the heat rejection environment. The manufacturers typically provide the performance data, at one standard atmosphere, in a linear relationship between heat rejection and temperature difference. A correction factor is applied to account for the variation in air density with elevation (Carrier 1999).

<div>$$\begin{array}{l}Hre{j_{Rated}} = {C_1} + {C_2} \times ({T_{condense}} - {T_{drybulb}})\\Hre{j_{Rated,corrected}} = Hre{j_{Rated}} \times \left( {1 - 7.17E - 5 \times Elevation} \right)\end{array}$$</div>

where:

Hrej<sub>Rated              </sub> = Manufacturer’s rated heat rejected by the condenser (W)

C<sub>1</sub>   = Intercept taken from manufacturer’s condenser performance data (W)

C<sub>2</sub>   = Coefficient taken from the manufacturer’s condenser performance data (W/C)

T<sub>condense</sub> = Condensing temperature (C)

T<sub>drybulb</sub>  = Drybulb temperature for the local environment (C)

Elevation = Local elevation (m)

The manufacturer’s form of performance data is used internally to define the condensing temperature as a function of the heat rejection load.

<div>$${T_{condense}} = {T_{drybulb}} + \left( {\frac{{Hrej - {C_1}}}{{{C_2}}}} \right) \div (1 - 7.17E - 5 \times Elevation)$$</div>

This calculated condensing temperature is then compared to the minimum condensing temperature allowed for that system. If necessary, the air flow to the condenser is reduced to maintain the condensing temperature at or above that minimum value.

##### Condenser Fan Energy Use

Condenser fan power for air-cooled condensers is determined by the type of fan control, fixed, variable speed, or two-speed. For all three fan control types, the fan power is set equal to the rated fan power whenever the calculated condensing temperature is greater than or equal to the minimum allowed condensing temperature. If the calculated temperature is less than the minimum allowed, the condenser air flow must be reduced. The reduced rated capacity is calculated using the previous equation for *Hrej<sub>Rated</sub>* with the specified minimum condensing temperature. (Note, the minimum condensing temperature is often determined by the expansion valve performance, and is therefore input with the system description, not with the condenser description.) The air flow for the reduced condenser capacity is:

<div>$$\begin{array}{l}Hrej \propto {\left( {AirVelocity} \right)^N}\\ {\rm{Air Velocity}} \propto {\left( {Hrej} \right)^{1/N}}\\ {\rm{Air Volume Ratio}} = {\left( {\frac{{Hrej}}{{Hre{j_{Rated}}}}} \right)^{1/N}}\end{array}$$</div>

where:

N    =          0.633 for turbulent air flow over cylinders (ASHRAE 2005)

The Air Volume Ratio is limited by a minimum value, which may be specified by the user. The default for this value is 0.2,



Four fan curves are built into the condenser fan model to represent four types of fan control, as shown in Figure 283. (Lawrence Berkeley Laboratory and Resource Dynamics, April 2003)

![](EngineeringReference/media/image6291.svg.png)

Figure 283. Condenser fan power curve options

For a fixed-speed fan, the air flow is reduced through either the use of dampers or by cycling the fan on and off.

For a cycling fan, the power variation with air flow volume is approximately linearabove the minimum air volume ratio as shown in the following equation for the option “FixedLinear”:

<div>$${P_{CondFan}} = ({\rm{Air Volume Ratio}}){P_{CondFan,design}}$$</div>

where:

<span>${P_{CondFan}}$</span>                  = output variable “Refrigerated Case Condenser Fan Electric Power [W]”, not allowed to exceed the design condenser fan power

<span>${P_{CondFan,design}}$</span>           = design condenser fan power (W)

For a fixed speed fan with damper (corresponding to the option “Fixed”), the shape of the power fraction curve is as shown above, and calculated using:

<div>$${P_{CondFan}} = ({\rm{Air Volume Ratio}}){e^{(1 - {\rm{Air Volume Ratio}})}}{P_{CondFan,design}}$$</div>

For an ideal variable speed fan, the power is proportional to the cube of the air flow. To reflect non-ideal real systems, an exponent of 2.5 is used as shown in the following equation:

<div>$${P_{CondFan}} = {({\rm{Air Volume Ratio}})^{2.5}}{P_{CondFan,design}}$$</div>

For a two-speed fan, the fan power is varied as for a constant speed fan with dampers for Air Volume Ratios greater than or equal to 0.6. For lower Air Volume Ratios,  which correspond to a half-speed fan setting, the power is reduced to the variable fan power value at that point and then varied as for damper control below Air Volume Ratios of 0.6.

<div>$$\begin{array}{*{20}{c}}{{P_{CondFan}} = ({\rm{Air Volume Ratio}})\left( {{e^{(1 - {\rm{Air Volume Ratio}})}}} \right){P_{CondFan,design}}{\rm{      for Air Volume Ratio}} \ge 0.6}\\ {{P_{CondFan}} = \left( {\frac{{{\rm{Air Volume Ratio }} + {\rm{ 0}}{\rm{.4}}}}{{{{\rm{2}}^{{\rm{2}}{\rm{.5}}}}}}} \right)\left( {{e^{(1 - {\rm{Air Volume Ratio}})}}} \right)\left( {{P_{CondFan,design}}} \right){\rm{    for Air Volume Ratio }} < {\rm{ 0}}{\rm{.6}}}\end{array}$$</div>

For a water cooled condenser, there is no fan load at the condenser (i.e., the  water/refrigerant heat exchanger). Any fan load would be related to and accounted for at the heat rejection object (e.g., cooling tower)

##### Evaporative-Cooled Condensers

The input object Refrigeration:Condenser:EvaporativeCooled allows using evaporative cooling rather than dry air cooling which will allow for more efficient condenser heat rejection based on the entering air approaching the wet-bulb temperature rather than the dry-bulb temperature. Analyses under the International Energy Agency’s (IEA) Heat Pumping Programme Annex 26 indicates that this measure can improve refrigeration system efficiency by up to 10% (IEA 2003). The basin heater energy and water pumping power consumption for evaporative condensers in the detailed refrigeration system is modeled as described for the Refrigeration:CompressorRack. Just as for air-dried condensers, an elevation correction is needed to adjust for the variation in density of the air. This correction factor was derived by combining the barometric pressure correction from ARI 490 and a standard correlation for barometric pressure as a function of elevation(ARI 2008, NASA 1976).

<div>$$\begin{array}{l}Hre{j_{Rated,Corrected}} = Hre{j_{Rated}} \times \left[ {1 + {k_1}B{P_{std}}(1 - {e^{(A \times Elev)}})} \right]\\A = \frac{{{g_0} \times {M_0}}}{{{R^*} \times {T_b}}} =  - 0.00012{m^{ - 1}}\end{array}$$</div>

where

k<sub>1</sub>               =          0.0023 for pressure stated in kPa, (ARI 2008)

BP<sub>std</sub>           =          Standard atmosphere at rating conditions (101.0 kPa)

g<sub>0</sub>               =          Gravitational constant (9.80665 m/s<sup>2</sup>)

R\*               =          Universal gas constant (8.31432E3 N-m/kmol-K

M<sub>0</sub>              =          Molar mass of air (28.9644 kg/kmol)

T<sub>b</sub>               =          Standard temperature (288.15 K)

Although based upon an exponential relationship, the resulting correction is very nearly linear within the range of elevations found upon dry land, so the following form of correction is used:

<div>$$Hre{j_{Rated,Corrected}} = Hre{j_{Rated}} \times (1 - 3.07E - 5 \times Elevation)$$</div>

To calculate the condensing temperature for an evaporative cooled condenser, it is necessary to provide the manufacturer’s performance data. The manufacturers typically provide this data as a table of condensing temperature as a function of both entering wet-bulb temperature and the ratio of the heat rejected to the rated heat rejected. This data can be well represented, as shown in Figure 284, by a regression of the form:

<div>$$\begin{array}{l}({T_{condense}} - {T_{wetbulb}}) = {C_1} + {C_2} \times HRCF + \frac{{{C_3}}}{{HRCF}} + {C_4}{T_{wetbulb}},or\\ {T_{condense}} = {C_1} + {C_2} \times HRCF + \frac{{{C_3}}}{{HRCF}} + (1 + {C_4}){T_{wetbulb}}\\ {\rm{where:  }}HRCF = \frac{{Hre{j_{Rated}}}}{{Hrej}}\end{array}$$</div>

C<sub>1</sub>, C<sub>2</sub>, C<sub>3</sub>, and C<sub>4</sub>     =          Coefficients determined by regression from manufacturer’s data.

Figure 284 shows a comparison between this equation form, which produced an adjusted R<sup>2</sup> of 0.998 and a maximum residual of 0.7C, for one manufacturer of evaporative condensers. Data from two other manufacturers showed similar agreement with this parameterization.

![](EngineeringReference/media/image6301.svg.png)

Figure 284. Comparison of the condensing temperature predicted by four-factor equation to manufacturer's data

Again, the condensing temperature is not allowed to fall below the system’s minimum allowed condensing temperature. Just as with an air-cooled condenser, the air flow through the condenser is controlled to maintain this minimum condensing temperature and the air velocity reduction is a function of the decreased capacity (Manske, 1999). For an evaporative condenser, relevant capacity is not the amount of heat rejected, but the rated capacity at that reduced air flow. That decreased rated capacity must first be calculated based upon the specified minimum condensing temperature. Using Equation , the specified condensing temperature is used to calculate the reduced HRCF, which is used with the current heat rejection to calculate the “reduced Rated Heat Rejection”.

<div>$$\begin{array}{l}{\rm{0}} = {C_2} \times HRC{F^2} + (({C_1} + {C_4}{T_{wetbulb}} - ({T_{condense}} - {T_{wetbulb}})) \times HRCF + {C_3}\\ {\rm{Reduced Rated Heat Rejection}} = HRCF \times Hrej\\ {\rm{Air Volume Ratio}} = {\left( {\frac{{{\rm{Reduced Rated Heat Rejection}}}}{{Hre{j_{Rated}}}}} \right)^{1/N}}\end{array}$$</div>

where:

N = exponent for evaporative condensers, set to 0.76 (Manske, 1999)

The water consumption for an evaporative condenser is calculated based upon the air flow rate, the total heat rejection, and the heat rejection environment. The amount of water consumption also includes the amount of water that is purged to reduce the concentration of contaminants. The purge water is estimated as proportional to the heat rejection, at a rate of 5.0E-10 m<sup>3</sup>/s per Watt of heat rejection (B.A.C., 2007). (This value, which corresponds to 3 gal./min. per 100 tons, is slightly more conservative than the value quoted by ASHRAE, 2004.) For the compressor racks, the condenser effectiveness was input as a function of the environmental wetbulb temperature. For the detailed evaporative condenser, the input data instead describes the capacity as a function of environmental conditions and loading. From that data, the water evaporation is calculated using the effectiveness corresponding to a fully loaded condenser. When the condenser is operating outside the bounds of the manufacturer’s data, the effectiveness is limited to a maximum value of 0.9.

<div>$$\begin{array}{l}\eta  = \frac{{Hrej}}{{{{\dot V}_{air,rated}} \times {\rho_{air}} \times ({{\left. h \right|}_{Tcondense,sat}} - {h_{air,in}})}}\\ {h_{air,out}} = {h_{air,in}} + \eta  \times ({\left. h \right|_{Tcondense,sat}} - {h_{air,in}})\\ {T_{air,out}} = {T_{saturated}}({h_{air,out}},{P_{barometric}})\\ {{\dot V}_{evaporation}} = \frac{{AirVolumeRatio \times {{\dot V}_{air,rated}} \times {\rho_{air,dry}} \times ({\omega_{air,out}} - {\omega_{air,in}})}}{{{\rho_{water}}}}\\ {{\dot V}_{makeup}} = {{\dot V}_{evaporation}} + {{\dot V}_{purge}}\end{array}$$</div>

where:

<span>${\left. h \right|_{Tcondense,sat}}$</span>=enthalpy of saturated air at the calculated condensing temperature

h<sub>air,out</sub> = enthalpy of the air leaving the condenser,

h<sub>air,in</sub> = enthalpy of the inlet air, psychometric function of inlet air drybulb temperature and humidity ratio

<span>${\dot V_{air,rated}}$</span>= rated volumetric air flow for the evaporative condenser (input value) m<sup>3</sup>/s

ρ<sub>air</sub> = density of air evaluated at environmental conditions

ρ<sub>air,dry</sub> = density of dry air evaluated at environmental temperature

T<sub>air,out</sub> = air temperature leaving the condenser, psychometric function of saturated air at the enthalpy leaving the condenser and the barometric pressure

<span>${\dot V_{evaporation}}$</span>= Volumetric rate of water evaporation in the condenser, m<sup>3</sup>/s

ω<sub>air,out</sub>= humidity ratio (kg<sub>water</sub>/kg<sub>dry\\ air</sub>) of the air leaving the condenser, psychometric function of T<sub>air,out</sub> and the barometric pressure

ω<sub>air,in</sub>= humidity ratio (kg<sub>water</sub>/kg<sub>dry\\ air</sub>) of the air at environmental conditions

ρ<sub>water</sub> = density of water evaluated at the environmental wetbulb temperature (kg/m<sup>3</sup>)

<span>${\dot V_{purge}}$</span>= Volumetric rate of water purged in the condenser, m<sup>3</sup>/s

<span>${\dot V_{makeup}}$</span>= Volumetric rate of water makeup in the condenser, m<sup>3</sup>/s

The source of the makeup water may be specified as a water storage tank. If not specified, the makeup water is assumed to come from the building mains (Ref. Water Mains Temperatures).

An evaporative condenser can be scheduled, using the Evaporative Condenser Availability Schedule described previously, so that it operates in a dry mode for a portion of the year. This is important in climates subject to freezing weather in order to avoid excessive ice formation on the condenser surfaces and surroundings. (The Availability Schedule is the correct way to model the use of evaporative condensers in cold climates. However, some users may take a single input description and use it to model a building with a refrigeration system in a variety of climates. To avoid modeling the use of evaporative coolers in freezing weather, the code includes a cutout to switch to dry operation whenever the outdoor drybulb temperature drops below 4C.) Dry operation can also reduce water use when the dry heat rejection capacity of the equipment is sufficient to meet the load during times of the year when the outside drybulb temperature is reduced. In dry operation, the condenser heat rejection capacity is approximately one third of the rated wetted heat rejection capacity(Manske, 2000). In dry operation, the condensing temperature is estimated by using the same four-factor equation, but using the air drybulb temperature instead of the wetbulb temperature and using the reduced heat rejection capacity factor.

<div>$$\begin{array}{l}HRC{F_{{\rm{dry operation}}}} = HRC{F_{{\rm{wet operation}}}}/3.0\\ {T_{{\rm{condense,dry operation}}}} = {C_1} + {C_2} \times HRC{F_{{\rm{dry operation}}}} + \frac{{{C_3}}}{{HRC{F_{{\rm{dry operation}}}}}} + (1 + {C_4}){T_{drybulb}}\end{array}$$</div>

##### Water-Cooled Condensers

If the condenser heat rejection is specified as water cooled (input object Refrigeration:Condenser:WaterCooled), the model uses the same algoithms described above for Refrigeration Compressor Racks. The condensing temperature is set equal to the inlet water temperature plus an approach temperature equal to the difference between the rated values for water inlet temperature and condensing temperature.

##### Cascade Condensers

A cascade condenser joins two full detailed refrigeration systems; that is, both systems joined by the cascade condenser have loads, compressor(s), and a condenser, as shown in Figure 285.

![Cascade](EngineeringReference/media/image6310.png)

Figure 285. A cascade condenser is used to reject heat from a low-temperature detailed refrigeration system to a higher-temperature detailed refrigeration system

The input object, Refrigeration:Condenser:Cascade, allows the use of a higher temperature refrigeration system (primary system) to serve as a heat rejection sink for a lower temperature refrigeration system (secondary system). The selection of the condensing temperature represents a trade-off in performance between the primary system absorbing the heat rejection and the secondary system rejecting heat. (Lee et al., 2006) If the condensing temperature control type is ‘fixed,’ then the secondary system condensing temperature is held constant at the temperature specified for that cascade condenser (which should be greater than or equal to the secondary system’s specified minimum condensing temperature). If the condensing temperature control type is ‘float’, the condensing temperature is allowed to float according to the minimum required evaporating temperature for other loads served by the primary system.

For fixed control:  T<sub>condense</sub> = T<sub>condense,rated</sub>

For floating control: T<sub>condense</sub> = ΔT<sub>approach</sub> + T<sub>evap,min</sub>

where

T<sub>condense,rated</sub>    =          Rated condensing temperature for the cascade condenser, C

ΔT<sub>approach</sub>      =          Rated approach temperature difference for the cascade condenser, DeltaC

T<sub>evap,min</sub>         =          Evaporating temperature required to meet other loads on the primary system, C.

The approach temperature difference (the difference between the condensing and evaporating temperatures) in the cascade condenser, is held constant at the rated value.  That is, the approach temperature difference is not varied according to the load on the condenser.

For cases and walk-ins served by cascade condensers, energy needed for hot brine or hot gas defrost is reclaimed from the primary system.  The refrigeration load the cascade condenser places upon the primary system is classified as a ‘transfer load’, because it transfers load from one system to another. This load is the sum of all case and walk-in loads served by the secondary system, any suction piping heat gains on the secondary loop, plus the secondary loop’s compressor power. The same name (Ref. Refrigeration:Condenser:Cascade, field “Name”) used to identify the condenser in the secondary loop is used to identify the transfer load on the primary system.

<div>$${\dot Q_{{\rm{Cascade}}}} = {\sum {\dot Q}_{{\rm{Case}}}} + \sum {{{\dot Q}_{{\rm{Walkin}}}} + } \sum {{{\dot Q}_{{\rm{Compressor}}}}} \left( { + \sum {{{\dot Q}_{{\rm{PipeHeatGain}}}}} } \right)$$</div>

where

<span>${\dot Q_{Cascade}}$</span>      = Total refrigeration load the cascade condenser places upon the primary system, W

<span>${\dot Q_{Case}}$</span>         = Case load on the secondary loop , W

<span>${\dot Q_{Walkin}}$</span>        = Walk-in load on the secondary loop, W

<span>${\dot Q_{Compressor}}$</span>   = Power input to a compressor on the secondary loop, W

<span>${\dot Q_{PipeHeatGain}}$</span>= Heat gain in secondary loop suction pipe, W

**Even though a cascade condenser is considered to be a part of a secondary loop, that loop is described with the Refrigeration:System object, not with the object, Refrigeration:SecondarySystem, described below.**

#### Subcoolers

Subcooler objects (Refrigeration:Subcooler) reduce the temperature of the liquid refrigerant after it leaves the condenser and before it reaches the thermal expansion valve, corresponding to state point, 3b, on Figure 280. The detailed refrigeration system permits the use of two type of subcoolers, mechanical and liquid suction. A mechanical subcooler is used to transfer refrigeration load from a lower-temperature system to a higher-temperature system. For example, the compressors that are used to provide cooling for dairy products could be used to subcool the refrigerant in another system that is serving frozen food cases. For the system providing the cooling, the mechanical subcooler acts like another refrigerated case load. For the system receiving the cooling, the mechanical subcooler reduces the enthalpy of the refrigerant from point 3a to point 3b on Figure 280, and thus reduces the required refrigerant flow rate. Mechanical subcooler performance is defined by the controlled temperature of the subcooled liquid as follows:

<div>$$\begin{array}{l}\dot Q = \dot m \times {c_p}({T_{3a}} - {T_{control}})\\ {h_{3b}} = {h_{3a}} - {c_{p,liquid}}({T_{3a}} - {T_{control}})\end{array}$$</div>

where:

<span>$\dot Q$</span>= subcooler load, W

<span>$\dot m$</span>= mass flow rate of refrigerant, kg/s

c<sub>p,liquid</sub>          = specific heat of saturated liquid at the condensing temperature, J/kg-C

T<sub>control</sub>           =control temperature specified for the mechanical subcooler, C

h    = enthalpy, J/kg

A liquid suction heat exchanger (LSHX) subcooler uses the cold gas exiting the refrigerated cases to subcool the condensed liquid refrigerant in the same system. Depending upon the shape of the refrigerant’s saturation curve and the operating condensing and evaporating temperature, this can save significant energy by reducing the required refrigerant flow (ASHRAE 2006a). (This model neglects the pressure drop through the suction side of the heat exchanger, although this pressure drop will cause the compressor to operate at a lower suction pressure.) A liquid suction heat exchanger is defined by specifying the design values for: inlet liquid temperature, inlet vapor temperature, and liquid temperature change. A liquid suction heat exchanger subcooler will also increase the superheat of the gas returning to the compressor, as shown by the difference between state points 1a and 1b in Figure 280:

<div>$$\begin{array}{l}{\eta_{LSHX}} = \frac{{\Delta {T_{Design}}}}{{\left( {{T_{{\rm{Liquid Design}}}} - {T_{{\rm{Vapor Design}}}}} \right)}}\\ dot Q = \dot m \times {c_{p,liquid}}{\eta_{LSHX}}({T_{3a}} - {T_{1a}})\\ {T_{1b}} = {T_{1a}} + \frac{{\dot Q}}{{\dot m{c_{p,vapor}}}}\\ {h_{3b}} = {h_{3a}} - \frac{{\dot Q}}{{\dot m}}\end{array}$$</div>

where:

ηLSHX        = subcooler effectiveness, dimensionless

c<sub>p,vapor</sub>          = specific heat of saturated vapor at the evaporating temperature, J/kg-C

ΔT<sub>Design</sub>        =design liquid temperature difference, DeltaC

T<sub>LiquidDesign</sub>     = design liquid inlet temperature, C

T<sub>VaporDesign</sub>     = design vapor inlet temperature, C

If a system is subcooled by both a mechanical subcooler and a liquid subcooler, the liquid subcooler will follow the mechanical subcooler and those points labeled ‘3a’ in the liquid suction equations would correspond to the points labeled ‘3b’ in the mechanical subcooler equations, that is, the inlet of the LSHX would be the outlet of the mechanical subcooler.

Any one system can be cooled (i.e., have energy removed between points ‘3a’ and ‘3b’) by at most one liquid suction heat exchanger and one mechanical subcooler. However, a system can provide cooling to multiple mechanical subcoolers. For example if a building had one high temperature refrigeration system (perhaps cooling fresh produce) and three low temperature systems (perhaps cooling frozen foods and meat), each of the three low temperature systems could include a mechanical subcooler with the refrigeration energy for all three absorbed by the one high-temperature system. For the compressors and condenser on the high-temperature system, these three mechanical subcoolers would represent a load very similar to that of the refrigerated cases served by that system.

#### Suction Piping Heat Gains

Suction piping heat gain is an optional element in the load calculation.  Typically, the suction pipe heat gain is small compared to the other loads.  However, when comparing DX systems to secondary systems, this portion of the total load can be very different. (Hinde, D., et al. 2009)  To include the suction pipe heat gain load, the user must first calculate the U-value and outer surface area for the suction piping. The U-value is the total conductance from the inside skin coefficient, through the pipe insulation, to the outside skin coefficient. This value must be multiplied by the external surface area of the pipe insulation to provide the sum of the UA required in the input.  These piping heat gains are also reflected in the zone heat balance.

<span>${\dot Q_{PipeHeatGain}}$</span> = ∑U\*A (T<sub>zone</sub> – T<sub>SaturatedSuction</sub>)

Where:

    <span>${\dot Q_{PipeHeatGain}}$</span>  =  Heat load on the detailed refrigeration system due to suction pipe heat gains (W)

    ∑U\*A =   Sum of the product of the conductance times the surface area for the suction piping (W/C)

### Secondary Refrigeration Systems

The object, Refrigeration:SecondarySystem, is used to model systems that do not have compressors, but have a circulating pump and a heat exchanger (called the secondary evaporator) where evaporating refrigerant in the primary loop absorbs heat rejected by the secondary loop.  The purpose of the secondary refrigeration system model is to determine: the refrigerating load placed upon the primary system via the Secondary Evaporator, the required evaporating temperature in the Secondary Evaporator, any heat recovered for defrost purposes, and the total pump power.

If your secondary loop includes compressors and a cascade condenser, do NOT use a Refrigeration:SecondarySystem object.  Use a Refrigeration:System object with a Refrigeration:Condenser:Cascade object and list that condenser as a transfer load in the input description of the primary system.

In the secondary loop shown in Figure 286, the secondary evaporator serves to chill a brine or glycol solution (single phase) that in turn chills the refrigeration loads on the secondary loop.  In Figure 287, the secondary evaporator serves as a condenser for a refrigerant that has been partially vaporized(two-phase) while circulating through the refrigeration loads on the secondary loop. Every secondary system includes a refrigeration load made up of refrigerated cases and/or walkins, a heat exchanger (called the Secondary Evaporator), and circulating pump(s). The loop performance at any one time step is determined by the effectiveness of the heat exchanger, the refrigeration load, and the pumping power needed to meet that load. The fluid temperature entering the cases and walk-ins is maintained at a set value.



![brinesecondary](EngineeringReference/media/image6323.png)

Figure 286. Secondary loop with brine or glycol solution circulation



![liquidoverfeedsecondary](EngineeringReference/media/image6324.png)

Figure 287. Secondary loop with liquid-overfeed refrigerant circulation

For both types of secondary loops, the primary refrigeration system absorbs the load by providing cold refrigerant that evaporates in the secondary evaporator.  We classify this secondary load as a ‘transfer load’ because it transfers load from one ‘system’ to another. (Cascade condenser loads are also considered transfer loads.) Just as with any DX refrigeration evaporator, the variable load from the secondary system is served by varying the primary system refrigerant flow to the evaporator side of the secondary evaporator.  Unmet load will be carried over to the next time step anytime the load on the secondary condenser/evaporator exceeds the rated capacity for the specified temperatures.  (A warning will be generated if the total unmet energy grows excessively large.)  The main differences between the single-phase secondary loop model and the two-phase secondary loop model lie in the definition and performance of the secondary evaporator and the way input data is processed to define evaporator capacity.

For a brine system, the secondary loop capacity is matched to the case and walk-in load by varying the brine flow rate. (*Throughout this section, ‘brine’ will be used when referring to the secondary loop heat transfer fluid for systems where the secondary circulating fluid remains in the liquid state.)* When selecting the brine loop design parameters, it is important to consider the performance trade-off between pumping energy and the temperature difference, or range, in the heat exchanger. The circulating fluid selection is also critical in determining the performance of brine loop, with large variations caused by differences in viscosity and density (which impact pumping power requirements) and specific heat (which determines the required fluid flow rate).  (Kazachki, G. S., and Hinde, D. K., 2006, Faramarzi, R. T., and Walker, D. H. 2004, ASHRAE. 2006c)

For a secondary loop to accommodate a two-phase secondary coolant, additional hardware is required and the system control mode changes. A separator/receiver is required to separate the wet mixture of liquid and gas returning from the refrigeration load, as shown in Figure 287.  (In the following discussion, we will refer to the secondary fluid in a liquid-overfeed system as CO<sub>2</sub>.) In Figure 288, which focuses in on the secondary loop alone, the gaseous CO<sub>2</sub> moves via thermosiphon effect to the secondary evaporator, where heat is absorbed by the primary system to condense the CO<sub>2</sub>, which then returns via gravity flow to the separator/revceiver.  The liquid CO<sub>2</sub> is pulled from the bottom of the separator/receiver and pumped to the load. The term ‘liquid overfeed ratio’ refers to the ratio of the total pumped mass flow rate (at the point labeled “1” on Figure 288) of CO<sub>2</sub> to the mass rate of CO<sub>2</sub> evaporated at the load (vapor portion of the flow at the point labled “5” on Figure 288). With a variable flow rate(obtained with either a variable-speed pump or multiple constant-speed pumps), the liquid overfeed ratio is maintained at or above the specified value. With a constant flow rate (obtained by specifying a single constant-speed pump), the liquid overfeed ratio will vary to match the capacity of the variable refrigeration load.(Hinde et al 2009) Even though a greater amount of CO<sub>2</sub> is circulated than is evaporated, the pumping power requirements are still much less than those for a single-phase secondary coolant.

![DanfossCO2cycle](EngineeringReference/media/image6325.png)

Figure 288. Thermodynamic cycle for a liquid overfeed secondary loop

If the defrost type for any of the cases or walkins on the secondary loop is ‘HotBrine’ or ‘HotGas’, the defrost energy is assumed to come from the hot compressed gas leaving the compressors on the primary system, as shown in Figure 286 and Figure 287.(Minea, V. 2007) Therefore, the amount of heat rejected by the condenser for that primary system is reduced by the amount needed for defrost. Some research has shown that the defrost times for cases and walk-ins defrosted using hot brine can be significantly shorter than defrost times for electric or hot gas.(Terrell, W. J. Jr., 1999) The user should consider this factor when describing the input data for cases and walk-ins served by a secondary loop.

#### Secondary Evaporator in a Single-Phase Secondary Loop (Brine or Glycol Loop)

For a single-phase secondary system, the heat exchanger effectiveness is calculated based upon the input rating data, which includes the evaporating temperature, approach and range temperature differences, and heat exchanger capacity. The rated capacity for the heat exchanger can be specified by either providing the capacity in Watts, or the rated mass flow rate. The density and specific heat both correspond to those properties at the average temperature of the heat exchange fluid within the secondary loop heat exchanger.

These variables are specified by the chiller manufacturer at rated conditions:

  ΔT<sub>Approach</sub>                = the approach temperature difference, DeltaC

  ΔT<sub>Range</sub>                  = range temperature difference, DeltaC

  T<sub>EvapDesign</sub>                =  heat exchanger evaporating temperature, C

  Flow<sub>RatedVolume</sub>          = brine flow rate through the heat exchanger  (kg/s)

  Capacity<sub>Rated</sub>          = Heat exchanger cooling capacity (W)

The rated conditions are used to calculate:

  T<sub>BrineOutRated</sub> = T<sub>EvapDesign</sub> + ΔT<sub>Approach</sub>

  T<sub>BrineInRated</sub>  = T<sub>BrineOutRated</sub> + ΔT<sub>Range</sub>

  Eta = Capacity<sub>Rated</sub> / (Flow<sub>RatedMass</sub> \* C<sub>pBrine</sub> \* (T<sub>BrineInRated</sub> - T<sub>EvapDesign</sub>))

  T<sub>BrineAverage</sub>= (T<sub>BrineOutRated</sub> + T<sub>BrineInRated</sub>)/2

If the capacity is specified and the flow rate is not, then the flow rate is calculated as:

Flow<sub>RatedMass</sub>= Capacity<sub>Rated</sub>/(C<sub>pBrine</sub>\*ΔT<sub>Range</sub>)

Flow<sub>RatedVol </sub> = Flow<sub>RatedMass</sub> / ρ<sub>Brine</sub>

If the flow rate is specified and the capacity is not, the capacity is calculated as:

Flow<sub>RatedMass</sub> =Flow<sub>RatedVol</sub>\*ρ<sub>Brine</sub>

Capacity<sub>Rated</sub> = Flow<sub>RatedMass</sub> \* C<sub>pBrine</sub>\*ΔT<sub>Range</sub>

Where:

  Eta                       = heat exchanger effectiveness, dimensionless and less than one

  T<sub>BrineInRated\\      </sub>            = heat exchanger brine inlet temperature at rated conditions (C)

  T<sub>BrineOutRated</sub>              = heat exchanger brine outlet temperature at rated conditions (C)

  T<sub>BrineAverage</sub>               = average brine temperature in the heat exchanger (C)

  Flow<sub>RatedMass</sub>           = brine flow rate through the heat exchanger  (kg/s)

  Flow<sub>RatedVol</sub>             = brine flow rate through the heat exchanger  (m<sup>3</sup>/s)

  C<sub>pBrine</sub>                    = brine specific heat (J/kg-C)

  ρ<sub>Brine</sub>                      = brine density (kg/m<sup>3</sup>)

After the heat exchanger effectiveness has been calculated, the value for the heat exchanger design brine flow rate is compared to the design flow rate for the secondary loop pump(s).  The maximum flow rate in the loop is limited to the smaller of these two values. The heat transfer capacity corresponding to this maximum flow rate is then calculated and compared to the rated heat exchanger capacity. The maximum load on the heat exchanger is limited to the lesser of these two values, the rated heat exchanger capacity or the capacity corresponding ot the maximum loop flow rate.

Flow<sub>MaxVol</sub> = Minimum(Flow<sub>RatedVol</sub> ,Flow<sub>RatedPumpVol</sub>)

Capacity<sub>AtMaxVolFlow</sub> =Flow<sub>MaxVol</sub> \*Eta\*( C<sub>pBrine</sub> \* Density<sub>Brine</sub>)\*( T<sub>BrineInRated</sub> – T<sub>EvapDesign</sub>)

Capacity<sub>Max</sub> = Minmum(Capacity<sub>Rated</sub> , Capacity<sub>AtMaxVolFlow</sub>)

Where:

Flow<sub>MaxVol</sub>                 = Maximum loop volume flow, limited by either the pump rating or the heat exchanger rating (m<sup>3</sup>/s)

Capacity<sub>AtMaxVolFlow</sub>     = Secondary loop capacity corresponding to the maximum loop flow rate (W)

Capacity<sub>Max</sub>              = Maximum secondary evaporator capacity (W)

#### Secondary Evaporator in a Two-Phase Secondary Loop  (Liquid-Overfeed Loop, e.g., CO<sub>2</sub>)

For a two-phase system, the secondary evaporator effectiveness is not calculated. Both the evaporating and condensing sides of the heat exchanger are assumed to operate at fixed temperatures.  If the capacity of the secondary evaporator is not input, it will be calculated as the sum of the rated loads plus the rated pump power.

<div>$$\begin{array}{*{20}{c}}{Capacit{y_{{\rm{Rated}}}} = {\rm{Input,  OR}}}\\ {Capacit{y_{{\rm{Rated}}}} = \sum {{{\dot Q}_{{\rm{Case}}}} + \sum {{{\dot Q}_{{\rm{WalkIn}}}} + Powe{r_{{\rm{Pump}}}}} } }\\ {Capacit{y_{{\rm{Max}}}} = Capacit{y_{{\rm{Rated}}}}}\end{array}$$</div>

If the flow rate through the evaporator is not input, it will be calculated based upon the input value for the Circulating Rate.

<div>$$Flo{w_{{\rm{RatedVol}}}} = \frac{{\sum {{{\dot Q}_{{\rm{Case}}}} + \sum {{{\dot Q}_{{\rm{WalkIn}}}} + Powe{r_{{\rm{Pump}}}}} } }}{{{\rho_{Liquid}}\Delta {h_{fg}}}}$$</div>

Where:

  Ρ<sub>Liquid</sub>                     = liquid density (kg/m<sup>3</sup>)

Δh<sub>fg</sub>                        = heat of vaporization (J/kg)

#### Secondary Loop Distribution Piping and Receiver Shell Heat Gains

Distribution piping and receiver shell heat gains are optional elements in the load calculation.  Typically, the distribution pipe and receiver shell heat gains are small compared to the other loads.  However, when comparing direct expansion systems to secondary systems, this portion of the total load can be very different. (Hinde, D., et al. 2009) To calculate the pipe heat gain load, the user must first calculate the U-value and area for the distribution piping. The U-value is the total conductance from the inside skin coefficient to the outside skin coefficient. This value must be multiplied by the piping external surface area to provide the sum of the UA required in the input.  Note that these piping and receiver shell heat gains are also reflected in the zone heat balance, similar to the zone cooling credits provided by refrigerated cases.

<span>${\dot Q_{PipeHeatGain}}$</span> = ∑U\*A (T<sub>zone</sub> – T<sub>BrineAverage</sub>)

Where:

<span>${\dot Q_{PipeHeatGain}}$</span>  =  Heat load on the secondary loop due to pipe heat gains, output variable “Refrigeration Secondary Loop Pipe Heat Gain Rate [W]”

∑U\*A =   Sum of the product of the conductance times the surface area for the piping (W/C)

The receiver shell heat gains are calculated in the same manner.

#### Secondary Loop Pumping Power and Secondary Loop Load

Pump ratings are typically given in the form of curves. The input values for the pumps should correspond to the full-load design conditions, with respect to fluid viscosity, density, and temperature, as well as pressure drop. For these conditions, the user provides either the total pump power or the total head, as well as the flow rate. *These values must be representative of the selected heat transfer fluid at the average loop operating temperature and pressure.* If the pump head at design conditions is specified, the pump power is calculated as:

Power<sub>PumpRated</sub> = Flow<sub>RatedPumpVol</sub>\* Head<sub>Rated</sub>/ (Efficiency<sub>PumpImpeller</sub>\*Efficiency<sub>PumpMotor</sub>)

Where:

Power<sub>PumpRated</sub>           =   Total pumping power for the secondary loop at rated conditions (W)

Head<sub>Rated</sub>                 =  Pressure drop through the entire secondary loop circulation at rated conditions, including at the pumps, the chiller, supply and return piping, and through the case and walk-in coils (pipes are typically sized to produce a total head ranging from 0.25E6 to 0.3E6 Pa (ASHRAE. 2006c))(Pa)

Efficiency<sub>PumpImpeller</sub>   = Pump impeller efficiency, dimensionless

Efficiency<sub>PumpMotor</sub>     = Pump motor efficiency, dimensionless

The pump impeller efficiency is assumed to be 78%. (ASHRAE 2006c) The pump motor efficiency is assumed to be 85%.(ITT 2009)  If a semi-hermetic motor is specified, all the pump power is translated to heat within the fluid. The total heat load placed upon the loop by the pumps is therefore:

<span>${\dot Q_{Pump}}$</span> = Power<sub>PumpRated</sub> \* Ratio<sub>PowertoHeat</sub>

Where:

<span>${\dot Q_{Pump}}$</span>                     = total heat load placed upon the secondary loop by the pumps (W)

Ratio<sub>PowertoHeat</sub>           = Ratio of total motor energy rejected to the circulating fluid to the total pump power used (input by the user, suggest 1.0 for semi-hermetic motors and 0.85 for others)

A variable speed pump can be modeled by providing a cubic curve for pump power as a function of the ratio of total flow needed to the total flow specified at full load design conditions.

<div>$${\dot Q_{Pump}} = \left[ {A{{\left( {L{F_{Pump}}} \right)}^3} + B{{\left( {L{F_{Pump}}} \right)}^2} + C\left( {L{F_{Pump}}} \right) + D} \right] \times {\rm{Powe}}{{\rm{r}}_{{\rm{PumpRated}}}} \times {\rm{Rati}}{{\rm{o}}_{{\rm{PowertoHeat}}}}$$</div>

Where:

LF<sub>Pump</sub>         = ratio of total flow needed to the total flow specified at full load design conditions

The user may also specify multiple constant-speed pumps.  Multiple pumps, or pump staging, are often used to reduce the total pumping power requirements while still providing the capacity and constant pressure drop needed to meet peak design loads.(Faramarzi, R. T., and Walker, D. H. 2004) When multiple pumps are specified, the flow rate provided by one pump is compared to the flow rate needed to meet the refrigeration load on the loop during that time step. If that flow rate is insufficient, another pump is added, and the process is continued until the needed flow rate is met or all the pumps are included. The incremental power for each pump is added to determine the total pump power for the loop. Each pump is assumed to operate at full load if it is needed at all.  A bypass is assumed to carry any fluid flow not needed to meet the load.  An iterative solution is required for the total pump load on the heat exchanger because the flow rate is determined by the load, which includes the pump power that is determined by the necessary flow rate. For the first estimate, the pump power load is assumed to be zero.

<div>$$\begin{array}{*{20}{c}}{{{\dot Q}_{{\rm{Refrigeration}}}} = \sum {{{\dot Q}_{{\rm{Case}}}} + \sum {{{\dot Q}_{{\rm{WalkIn}}}}} } }\\ {{{\dot Q}_{{\rm{TotalSecondary}}}} = {{\dot Q}_{{\rm{Refrigeration}}}} + {{\dot Q}_{{\rm{Pump}}}} + \left( {\sum {{{\dot Q}_{{\rm{Pipe and Receiver Shell heat gains}}}}} } \right)}\\ {{\rm{Flo}}{{\rm{w}}_{{\rm{needed}}}}{\rm{ }} = {\rm{ }}\frac{{{{\dot Q}_{{\rm{TotalSecondary}}}}}}{{Eta({C_{{\rm{p,Brine}}}})({\rho_{{\rm{Brine}}}})({T_{{\rm{BrineOutRated}}}} - {T_{{\rm{evap}}}})}}}\end{array}$$</div>

Where:

<span>${\dot Q_{{\rm{Refrigeration}}}}$</span> = output variable “Refrigeration Secondary Loop Load Heat Transfer Rate”

<span>${\dot Q_{{\rm{TotalSecondary}}}}$</span> = Total load the secondary loop transfers to the primary system, output variable “Refrigeration Secondary Loop Total Heat Transfer Rate [W]”

<span>${\dot Q_{{\rm{Pump}}}}$</span> = Pump power, function of Flow<sub>Needed</sub>, output variable “Refrigeration Secondary Loop Pump Electric Power [W]”

Flow<sub>Needed</sub> = Flow rate needed to meet the loop refrigeration load, , output variable “Refrigeration Secondary Loop Volume Flow Rate [m3/]s”

The needed flow rate is used to determine the number of pumps required and the total pumping power, which produces a new estimate for the total load. A few iterations converge upon the final secondary loop load for each time step.  The total load on the heat exchanger is therefore the sum of the refrigeration loads, any pipe heat gains, and the portion of the pump power that is absorbed by the circulating fluid.

### Transcritical CO<sub>2</sub> Refrigeration System

The Refrigeration:TranscriticalSystem object allows users to model detailed transcritical carbon dioxide (CO<sub>2</sub>) booster refrigeration systems used in supermarkets.  The object allows for modeling either a single stage system with medium-temperature loads or a two stage system with both medium- and low-temperature loads.

The input objects required to model a detailed transcritical CO<sub>2</sub> refrigeration system include the following:

n One Refrigeration:TranscriticalSystem object,

n At least one refrigeration load object which may include any combination of the following:

n Refrigeration:Case,

n Refrigeration:WalkIn,

n Refrigeration:CaseAndWalkInList (may include both cases and/or walk-in cooler names),

n At least one Refrigeration:Compressor object (multiple compressors are entered using a Refrigeration:CompressorList),

n One Refrigeration:GasCooler:AirCooled object,

Output variables are available to describe the total heat exchange between all the refrigeration objects and the zones containing these objects.

At least one refrigeration load object must be defined which may be one of two types of loads, including a refrigerated display case and a walk-in cooler, (Ref. Refrigeration:Case, and Refrigeration:WalkIn).  If multiple loads are served by the same system, the user should use the refrigerated case and walk-in list object available to assign all cases and walk-ins cooled directly by this system (Ref. Refrigeration:CaseAndWalkInList).

The name of at least one compressor must be defined and a list object is available if the system is served by more than one compressor (Ref. Refrigeration:Compressor and Refrigeration:CompressorList).

Heat is rejected to the outdoors via an air-cooled gas cooler (Ref. Refrigeration:GasCooler:AirCooled).

The Refrigeration:TranscriticalSystem object coordinates the energy flows between the other refrigeration objects and is used to set system parameters.

The inputs for the refrigeration system object, in addition to the names of the other refrigeration objects described above, include a name for this system, the minimum condensing temperature, and the refrigeration system working fluid.  Optional input fields are also provided for users seeking to keep track of refrigerant inventory and suction pipe heat gains.

#### Transcritical CO<sub>2</sub> Refrigeration Cycles

Transcritical CO<sub>2</sub> refrigeration cycles are characterized by a subcritical evaporation process and a supercritical “gas cooling” process.  In the subcritical evaporation process which occurs in the evaporator, the CO<sub>2</sub> changes phase from a liquid and vapor mixture to a superheated vapor.  In doing so, the CO<sub>2</sub> absorbs heat, thereby creating the cooling effect.  This process is similar to the evaporation process in a standard vapor-compression refrigeration cycle.

After the CO<sub>2</sub> exits the evaporator and is compressed into the supercritical region, the CO<sub>2</sub> gas is cooled.  This gas cooling process differs from the condensation process which occurs in the standard vapor-compression refrigeration system.  In the standard refrigeration cycle, the refrigerant vapor is first desuperheated and then condensed to a liquid in the condenser.  In the transcritical CO<sub>2</sub> cycle, a “gas cooler” rather than a condenser is used to cool the supercritical CO<sub>2</sub> from the compressor discharge temperature to the expansion device inlet temperature.  No condensation occurs in this process.  Rather, the temperature and density of the CO<sub>2</sub> continuously changes from that at the compressor discharge to that at the expansion device inlet.

EnergyPlus is capable of modeling the transcritical booster refrigeration cycle. Figure 289 shows a schematic of the booster cycle while Figure 290 shows the corresponding pressure-enthalpy (*p-H*) diagram of the booster cycle.



![](EngineeringReference/media/image6337.png)

Figure 289.  Schematic of the Transcritical CO<sub>2</sub> Booster Refrigeration Cycle.



![](EngineeringReference/media/image6338.png)

Figure 290.  Pressure-Enthalpy (*p-H*) Diagram for the Transcritical CO<sub>2</sub> Booster Refrigeration Cycle.

Carbon dioxide exits the gas cooler at Location 1 and passes through the suction line heat exchanger, exiting at Location 2, during which the refrigerant is cooled by the suction gas.  An intermediate expansion occurs between Locations 2 and 3, and saturated CO<sub>2</sub> enters the receiver.  Saturated liquid CO<sub>2</sub> exits the receiver at Location 6, which is then expanded and fed to the medium-temperature loads (between Locations 7 and 8) and the low-temperature loads (between Locations 9 and 10).  Saturated vapor CO<sub>2</sub> exits the receiver bypass at Location 4 and is expanded to the medium-temperature pressure level at Location 5.  Carbon dioxide vapor exiting the low temperature loads is compressed to the medium-temperature pressure level (Location 10 to 11).  The CO<sub>2</sub> from the discharge of the low pressure compressors, the outlet of the medium-temperature loads and the outlet of the receiver bypass are then combined at Location 13.  The CO<sub>2</sub> suction gas then passes through the suction line heat exchanger where the refrigerant is heated, exiting at Location 14.  The carbon dioxide is finally compressed to the gas cooler pressure level at Location 15 and heat is rejected to the surroundings in the gas cooler between Locations 15 and 1.

#### CO<sub>2</sub> Compressor Performance Modeling

To model the performance of the CO<sub>2</sub> compressors during subcritical and transcritical operation, cubic polynomials are used to curve fit manufacturers’ performance data.  This technique is similar to that described in AHRI Standard 540 (AHRI 2004).  For subcritical operation, the power consumption and cooling capacity of a CO<sub>2</sub> compressor is a function of the saturated suction temperature, *t<sub>ss</sub>* (°C), and the saturated discharge temperature, *t<sub>sd</sub>* (°C), as follows:

<div>$$z = {C_1} + {C_2}{t_{ss}} + {C_3}{t_{sd}} + {C_4}t_{ss}^2 + {C_5}{t_{ss}}{t_{sd}} + {C_6}t_{sd}^2 + {C_7}t_{ss}^3 + {C_8}t_{ss}^2{t_{sd}} + {C_9}{t_{ss}}t_{sd}^2 + {C_{10}}t_{sd}^3$$</div>

where *z* is either power consumption (W) or cooling capacity (W) and *C<sub>x</sub>* are the corresponding correlation coefficients.

For transcritical operation, the power consumption (in Watts) of a CO<sub>2</sub> compressor, *W*, is a function of the saturated suction temperature and the gas cooler pressure, *p<sub>gc</sub>* (Pa), as follows (Ge and Tassou 2011):

<div>$$W = {C_1} + {C_2}{t_{ss}} + {C_3}{p_{gc}} + {C_4}t_{ss}^2 + {C_5}{t_{ss}}{p_{gc}} + {C_6}p_{gc}^2 + {C_7}t_{ss}^3 + {C_8}t_{ss}^2{p_{gc}} + {C_9}{t_{ss}}p_{gc}^2 + {C_{10}}p_{gc}^3$$</div>

The cooling capacity (in Watts) of a transcritical CO<sub>2</sub> compressor, *Q*, is a function of the saturated suction temperature and the gas cooler outlet enthalpy, *h<sub>go</sub>* (J/kg), as follows (Ge and Tassou 2011):

<div>$$Q = {C_1} + {C_2}{t_{ss}} + {C_3}{h_{go}} + {C_4}t_{ss}^2 + {C_5}{t_{ss}}{h_{go}} + {C_6}h_{go}^2 + {C_7}t_{ss}^3 + {C_8}t_{ss}^2{h_{go}} + {C_9}{t_{ss}}h_{go}^2 + {C_{10}}h_{go}^3$$</div>

The correlation coefficients, *C<sub>x</sub>*, are obtained either directly from CO<sub>2</sub> compressor manufacturers or from cubic curve fits performed on their published CO<sub>2</sub> compressor performance data.  For convenience, correlation coefficients for CO<sub>2</sub> compressors from several manufacturers have been included in the EnergyPlus refrigeration compressor coefficient database.

The rated values for the cooling capacity and power consumption from the manufacturer include a specified amount of subcooling before the thermal expansion valve and a certain amount of superheat in the suction gas.  Adjustments must be made to these rated values to reflect the actual subcooling and superheat conditions.  Actual subcooling is determined by the condenser’s rated subcooling and by the subcooling provided by optional subcoolers. The actual superheat is determined by the refrigerated case superheat (usually set to ensure that there is no liquid in the suction lines leading to the compressors), set here at 10°C, and the effect from any optional subcoolers.  See the section, “Detailed Refrigeration Systems”, for a description of the compressor corrections.

Once the corrected capacity is calculated for each compressor, the compressors are dispatched one at a time until the system load is met.  The last compressor dispatched is assumed to run at full load for the fraction of the time step necessary to meet the load.  That is, the model neglects compressor cycling losses at part-load conditions.  If the capacity available from all the compressors is less than the sum of the case loads for that time period, the unmet load is accumulated to be met in succeeding time steps.  If this accumulated unmet load becomes too great, a warning message is generated.

#### Gas Cooler Performance

Only one gas cooler is allowed per transcritical refrigeration system. However, multiple refrigeration systems can reject heat through the same gas cooler.  Currently, only air-cooled gas coolers are modeled.  The gas cooler performance is modeled to determine the gas cooler pressure, gas cooler outlet temperature and outlet enthalpy of the refrigerant, and the auxiliary power consumption for the fans.

##### Optimal Gas Cooler Pressure for Transcritical CO<sub>2</sub> Cycles

When the compressor discharge conditions are such that the CO<sub>2</sub> is in the supercritical region, then the high-side operating pressure is independent of the gas cooler exit temperature (Sawalha 2008).  Thus, for a given gas cooler exit temperature, there is an optimum pressure to achieve the maximum coefficient of performance (COP).  Figure 291 illustrates the variation in COP of a transcritical CO<sub>2</sub> cycle with discharge pressure at different gas cooler exit temperatures.

![](EngineeringReference/media/image6342.png)

Figure 291.  COP of CO<sub>2</sub> Transcritical Cycle vs. Discharge Pressure at Different Gas Cooler Exit Temperatures (Sawalha 2008).

Several researchers have developed correlations to determine the optimum gas cooler pressure in CO<sub>2</sub> refrigeration systems (Chen and Gu 2005; Ge and Tassou 2011; Kauf 1998; Liao and Zhao 2000; Sawalha 2008).  Using a similar curve-fitting procedure, the following optimum gas cooler pressure correlations are used in EnergyPlus:

<div>$${p_{gc}} = \left\{ {\begin{array}{*{20}{c}}{7.5 \times {{10}^6},{\rm{}}![](1101-1200/html/1101-1200_files/image145.png) {T_{amb}} < 27}\\ {2.3083 \times {{10}^5}{T_{amb}} + 1.190 \times {{10}^6},{\rm{}}![](1101-1200/html/1101-1200_files/image145.png) {T_{amb}} \ge 27}\end{array}} \right.$$</div>

where *p<sub>gc</sub>* is the optimum gas cooler pressure (Pa) and *T<sub>amb</sub>* (°C) is the ambient temperature surrounding the gas cooler.  The corresponding gas cooler exit temperature, *T<sub>gco</sub>* (°C), is determined as follows:

<div>$${T_{gco}} = {T_{amb}} + \Delta {T_{approach}}$$</div>

where Δ*T<sub>approach</sub>* is the approach temperature of the gas cooler, defined as the difference between the gas cooler exit temperature and the entering ambient air temperature.

During transcritical operation, the gas cooler outlet pressure is not allowed to fall below 7.5 × 10<sup>6</sup> Pa to ensure proper operation.

##### Condensing Temperature and Pressure for Subcritical Operation

During subcritical operation, the gas cooler behaves as a condenser and the condensing pressure is allowed to float with the ambient conditions.  The condensing temperature, *T<sub>cond</sub>* (°C), is determined according to the following:

<div>$${T_{cond}} = \left\{ {\begin{array}{*{20}{c}}{{T_{cond,min}},{\rm{}}![](1101-1200/html/1101-1200_files/image147.png) {T_{amb}} \le {T_{cond,min}} - \Delta T}\\ {{T_{amb}} + \Delta T,{\rm{}}![](1101-1200/html/1101-1200_files/image147.png) {T_{cond,min}} - \Delta T < {T_{amb}} \le {T_{trans}} - \Delta T}\\ {{T_{trans}},{\rm{}}![](1101-1200/html/1101-1200_files/image147.png) {T_{trans}} - \Delta T < {T_{amb}} < {T_{trans}}}\\ {{T_{sat,{\rm{}}P = 7.2{\rm{}}MPa}},{\rm{}}![](1101-1200/html/1101-1200_files/image147.png) {T_{trans}} \le {T_{amb}} < 30.978}\end{array}} \right.$$</div>

where *T<sub>amb</sub>* is the ambient temperature (°C), Δ*T* is the temperature difference between the condensing temperature and the ambient temperature (°C), *T<sub>cond</sub>*<sub>,*min*</sub> is the minimum allowable condensing temperature (°C), and *T<sub>trans</sub>* is the ambient air transition temperature between subcritical and transcritical operation (°C).  The condensing pressure, *P<sub>cond</sub>* (Pa), is determined as the saturation pressure corresponding to the condensing temperature.

##### Gas Cooler Fan Energy Use

Gas cooler fan power for air-cooled gas coolers is determined by the type of fan control, which can either be fixed, variable speed, or two-speed.  For all three fan control types, the gas cooler fan energy is calculated in the same fashion as that for air-cooled condensers, as described in the section, “Detailed Refrigeration Systems”.

#### Suction Line Heat Exchanger

The performance of the transcritical CO<sub>2</sub> booster system can be enhanced by using a suction line heat exchanger.  As shown in Figure 289, the suction gas entering the heat exchanger at location 13 is used to cool the refrigerant after it leaves the gas cooler at location 1.  The performance of this heat exchanger is modeled with the heat exchanger effectiveness, ε:

<div>$$\varepsilon  = \frac{{{h_{14}} - {h_{13}}}}{{{h_{{T_1},{P_{13}}}} - {h_{13}}}} = \frac{{{h_1} - {h_2}}}{{{h_{{T_1},{P_{13}}}} - {h_{13}}}}$$</div>

where *h*<sub>1</sub>, *h*<sub>2</sub>, *h*<sub>13</sub>, and *h*<sub>14</sub> are the enthalpies of carbon dioxide at the respective locations in the refrigeration cycle, as shown in Figure 289 and Figure 290, and <span>${h_{{T_1},{P_{13}}}}$</span> is the enthalpy of carbon dioxide evaluated at temperature *T*<sub>1</sub> and pressure *P*<sub>13</sub>.

In EnergyPlus, the value of the suction line heat exchanger effectiveness, ε, is specified by the user as an input, and the enthalpies at the exit of the heat exchanger, *h*<sub>2</sub> and *h*<sub>14</sub>, are determined from the definition of heat exchanger effectiveness given above.  In EnergyPlus, the default value of heat exchanger effectiveness is 0.4.

**Thermodynamic Properties of CO<sub>2</sub>**

Modeling of transcritical CO<sub>2</sub> booster refrigeration cycles requires the thermodynamic properties of CO<sub>2</sub> in the saturated (liquid and vapor), superheated and supercritical regions.  The refrigerant properties database within EnergyPlus includes saturated, superheated and supercritical thermodynamic data for CO<sub>2</sub>, including temperature, pressure, density, enthalpy and specific heat.

### References

AHRI, 2001. Standard 410, Forced-Circulation Air-Cooling and Air-Heating Coils, Section 6.2.1, Air-Conditioning Heating & Refrigeration Institute

ARI. 2003. Standard for Remote Mechanical-Draft Evaporatively-Cooled Refrigerant Condensers, Standard 490, Air-Conditioning & Refrigeration Institute, Arlington, VA

ARI. 2004. Standard for Performance Rating of Positive Displacement Refrigerant Compressors and Compressor Units, Standard 540, Air-Conditioning & Refrigeration Institute, Arlington, VA

ARI. 2005. Standard for Performance Rating of Remote Mechanical-Draft Air-Cooled Refrigerant Condensers, Standard 460, Air-Conditioning & Refrigeration Institute, Arlington, VA

ARI. 2007. Standard for Performance Rating of Water-Cooled Refrigerant Condensers, Remote Type, Standard 450, Air-Conditioning & Refrigeration Institute, Arlington, VA

ASHRAE. 2002. *Refrigeration Handbook*, Chapter 47. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2004. *HVAC Systems and Equipment Handbook*, Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2006a. *Refrigeration Handbook*, Chapter 2. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2006b. *Refrigeration Handbook*, Chapter 44. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2006c. *Refrigeration Handbook*, Chapter 4. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2006d. *Refrigeration Handbook*, Chapter 13. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2009. *Fundamentals Handbook*, Chapter 1. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE. 2009b. *Fundamentals Handbook*, Chapter 2. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

B.A.C. 2007. Baltimore AirCoil Company Product and Application Handbook, Volume II, Baltimore, MD

Baek, J.S., Groll, E.A., and Lawless, P.B. 2005. Theoretical Perfromance of Transcritical Carbon Dioxide Cycle with Two-Stage Compression and Intercooling. *Proceedings of the Institution of Mechanical Engineers, Part E: Journal of Process Mechanical Engineering* 219, 187-195.

Baxter, V. D., Mei, V.C. 2002.Warm Liquid Defrosting Technology For Supermarket Display Cases, P.S. Hrnjak, Ed., International Conference New Technologies in Commercial Refrigeration, University of Illinois at Urbana-Champaign, Urbana, IL, July 22-23, 2002

Chen, Y., and Gu, J. 2005. The Optimum High Pressure for CO<sub>2</sub> Transcritical Refrigeration Systems with Internal Heat Exchangers. *International Journal of Refrigeration* 28(8), 1238-1249.

Evans, J. 2008. Chapter 15, Minimising Energy Consumption Associated with Chilling, Refrigerated Storage and Cooling Systems in the Food Industry. In *Handbook of Water and Energy Management in Food Processing*. Cambridge:  Woodhead Publishing Limited.

Faramarzi, R. T., and Walker, D. H. 2004. Investigation of Secondary Lop Supermarket Refrigeration Systems, prepared for California Energy Commission Public Interest Energy Research Program, prepared by Southern California Edison and Foster-Miller, PIER 500-04-013

Ge, Y., and Tassou, S. 2011. Performance Evaluation and Optimal Design of Supermarket Refrigeration Systems with Supermarket Model "Supersim", Part I: Model Description and Validation. *International Journal of Refrigeration* 34(2), 527-539.

Gosney, W.B., Olama, G.A.-L. 1975. Heat and Enthalpy Gains through Cold Room Doorways,  Proceedings of the Institute of Refrigeration, vol. 72, pp 31-41

Henderson, H.I. and Khattar, M. 1999. Measured Impacts of Supermarket Humidity Level on Defrost Performance and Refrigerating System Energy Use. *ASHRAE Transactions* 105(1), 508-520. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Hinde, D., Zha, S., and Lan, L. 2009. Carbon Dioxide in North American Supermarkets, ASHRAE Journal, Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.,February 2009

Howell, R.H. 1993. Effects of Store Relative Humidity on Refrigerated Display Case Performance. *ASHRAE Transactions* 99(1), 667-678. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Howell, R.H. 1993. Calculation of Humidity Effects on Energy Requirements of Refrigerated Display Cases. *ASHRAE Transactions* 99(1), 679-693. Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

IEA Heat Pump Centre. 2003. *Advanced Supermarket Refrigeration/Heat Recovery Systems Vol. 1 - Executive Summary*, Report HPP-AN26-2, April.

ITT. 2009. Goulds Pumps Industrial  Products Moter Terms

Kauf, F. 1998. Determination of the Optimum High Pressure for Transcritical CO<sub>2</sub>-Refrigeration Cycles. *International Journal of Thermal Sciences* 38(4), 325-330.

Kays, W.M., A.L. London, 1964, compact Heat Exchangers, Second Edition, Chap. 2, pp 15-24, McGraw-Hill Book Company

Kazachki, G. S., and Hinde, D. K. 2006, Secondary Cooplant Systems for Supermarkets, ASHRAE Journal, Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc., September 2006

Lawrence Berkeley Laboratory and Resource Dynamics, Improving Fan Systrem Performance, A Sourcebook for Industry, DOE/GO-102003-1294, April 2003

Lee, T-S., Liu, C-H., and Chen, T-W. 2006. Thermodynamic Analysis of Optimal Condensing Temperature of Cascade-Condenser in CO<sub>2</sub>/NH<sub>3</sub> Cascade Refrigeration Systems, International Journal of Refrigeration 29 (2006) 1100-1108, Elsevier Ltd.

Liao, S., and Zhao, T. J. 2000. A Correlation of Optimal Heat Rejection Pressures in Transcritical Carbon Dioxide Cycles. *Applied Thermal Engineering* 20(9), 831-841.

Manske, K.A., 2000. Performance Optimization of Industrial Refrigeration Systems, M.S.Thesis Mechanical Engineering, Solar Energy Laboratory, University of Wisconsin-Madison.

Minea, V. 2007. Supermarket Refrigeration System with Completely Secondary Loops, ASHRAE Journal, Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.,  September 2007

Mitchell, J.W., et al. 1992.Analysis of Supermarket Dehumidification Alternatives. Final Report to Electric Power Research Institute, Report TR-100352, November.

NASA. 1976. U. S. Standard Atmosphere, NASA-TM-74335, National Oceanic and Atmosperic Administration , National Aeronautics and Space Administration

Nelson, B. I., 2010, Refrigeration Air Cooler Rating Methods, ASHRAE Journal, American Society of Heating, Refrigeration and Air-Conditioning Engineers, Inc., August

Sawalha, S. 2008. Theoretical Evaluation of Trans-Critical CO<sub>2</sub> Systems in Supermarket Refrigeration. Part I: Modeling, Simulation and Optimization of Two System Solutions. *International Journal of Refrigeration* 31, 516-524.

Terrell, W.J.Jr., Mao, Y., Hrnjak, P.S. 1999. Evaluation of Secondary Fluids for Use in Low-Temperature Supermarket Applications, ACRC CR-15, Air Conditioning and Refrigeration Center, University of Illinois, Urbana, IL, April 1999.

Setpoint Managers <a name="SetpointManagers"></a>
-----------------

### Overview

Setpoint Managers are one of the high-level control constructs in EnergyPlus. A Setpoint Manager is able to access data from any of the HVAC system nodes and use this data to calculate a setpoint (usually a temperature setpoint) for one or more other HVAC system nodes. Setpoints are then used by Controllers as a goal for their control actions.

Setpoint managers are executed at the start of each HVAC time step, and they reside outside the HVAC system iteration loops. Thus, the Setpoint Managers are executed once per HVAC time step, and they use previous time step information (except for zone load) to calculate their setpoints.

All temperatures in the following descriptions are in degrees C, loads are in Watts, mass flow rates are in kg/s.

### Scheduled

The input object SetpointManager:Scheduled provides the simplest setpoint manager that allows the user to specify a seasonal (or other) scheduled reset, for example, of the supply air temperature setpoint.

<div>$${T_{set}} = {T_{sched}}$$</div>

where <span>${T_{set}}$</span>is the supply air temperature setpoint and <span>${T_{sched}}$</span>is the current value (°C) from the user input temperature schedule. In this case, <span>${T_{set}}$</span>will be applied to the node or nodes specified in the input object SetpointManager:Scheduled.  There are a number of other types of setpoints that can be set, by choosing different control variables in the object, including:

1)   Maximum temperature of fluid at node (°C)

2)   Minimum temperature of fluid at node (°C)

3)   Humidity ratio of fluid at node (kg water/ kg dry air)

4)   Maximum humidity ratio of fluid at node (kg water/ kg dry air)

5)   Minimum humidity ratio of fluid at node (kg water/ kg dry air)

6)   Mass flow rate of fluid at node (kg/s)

7)   Maximum mass flow rate of fluid at node (kg/s)

8)   Minimum mass flow rate of fluid at node (kg/s)

### Outdoor Air Reset

The input object SetpointManager:OutdoorAirReset provides a setpoint manager that implements an outdoor air reset strategy for the supply air temperature. The user defines a reset rule for this strategy by specifying two setpoint temperatures at two outside drybulb temperatures. Generally the lower setpoint temperature is matched with the higher drybulb temperature and the higher setpoint temperature with the lower drybulb temperature. The user can specify two reset rules and schedule their usage. A schedule value of 1 indicates use of the 1st rule; 2 indicates use of the 2nd.

IF *SchedVal =2*

<div>$${T_{out,low}} = {T_{2,out,low}}$$</div>

<div>$${T_{out,high}} = {T_{2,out,high}}$$</div>

<div>$${T_{set,atOAlow}} = {T_{2,set,atOAlow}}$$</div>

<div>$${T_{set,atOAhigh}} = {T_{2,set,atOAhigh}}$$</div>

otherwise

<div>$${T_{out,low}} = {T_{1,out,low}}$$</div>

<div>$${T_{out,high}} = {T_{1,out,high}}$$</div>

<div>$${T_{set,atOAlow}} = {T_{1,set,atOAlow}}$$</div>

<span>${T_{set,atOAhigh}} = {T_{1,set,atOAhigh}}$</span>.

If <span>${T_{out,low}} < {T_{out,high}}$</span>and <span>${T_{set,atOAlow}} > {T_{set,atOAhigh}}$</span> then

      If <span>${T_{out}} \le {T_{out,low}}$</span> then

      <span>${T_{set}} = {T_{out,low}}$</span>

      if <span>${T_{out}} \ge {T_{out,high}}$</span> then

      <span>${T_{set}} = {T_{out,high}}$</span>

      otherwise

      <span>${T_{set}} = {T_{set,atOAlow}} - (({T_{out}} - {T_{out,low}})/({T_{out,high}} - {T_{out,low}}))\cdot ({T_{set,atOAlow}} - {T_{set,atOAhigh}})$</span>

otherwise

      <span>${T_{set}} = 0.5({T_{set,atOAlow}} + {T_{set,atOAhigh)}}$</span>.

*<span>${T_{set}}$</span>*will be applied to the node or nodes specified in the *SetpointManager:OutdoorAirReset* object input.

### Single Zone Reheat Heating and Cooling

The input object SetpointManager:SingleZone:Reheat provides a setpoint manager that is used to implement a variable supply air setpoint temperature in which the setpoint is varied  each timestep to meet the heating or cooling load in a control zone. The manager operates in the following manner.

<div>$${T_{set}} = {T_z} + {\dot Q_z}/({C_{p,air}}\cdot {\dot m_z})$$</div>

where <span>${T_z}$</span>is the control zone temperature, <span>${\dot Q_z}$</span>is the zone load (greater than zero for heating, less than zero for cooling), <span>${\dot m_z}$</span>is the zone supply air mass flow rate, and <span>${C_{p,air}}$</span>is the specific heat of air. If <span>${\dot m_z}$</span>is very small (<span>$ \le .001$</span> kg/s) <span>${T_{set}}$</span> is set equal to <span>${T_{set,min}}$</span> if the control zone has a cooling load and to <span>${T_{set,max}}$</span>if the control zone has a heating load. <span>${T_{set,min}}$</span> is the user specified minimum setpoint and <span>${T_{set,max}}$</span> is the user specified maximum setpoint. <span>${T_{set}}$</span>will be applied to the node or nodes specified in the SetpointManager:SingleZone:Reheat object input.

### Single Zone Heating Only

The input object SetpointManager:SingleZone:Heating provides a model that detects the control zone load to meet the current heating setpoint (Report Variable "Zone Predicted Sensible Load to Heating Setpoint Heat Transfer Rate [W]", zone inlet node flow rate, and zone node temperature, and calculates a setpoint temperature for the supply air that will satisfy the zone heating load for the control zone.  "Zone Predicted Sensible Load to Heating Setpoint Heat Transfer Rate [W]" &gt; 0 indicates a heating load.  The following rules are applied:

·        If there is no zone heating load, then the setpoint is set at the specified minimum supply air temperature.

·        If there is a zone heating load  and the zone supply mass flow rate is less than 0.001 kg/s, then the setpoint is set at the specified maximum supply air temperature.

·        If there is a zone heating load  and the zone supply mass flow rate is greater than 0.001 kg/s, then the setpoint is set calculated as follows:

*SetPoint = ZoneTemp + ZoneLoadtoHeatSP/(CpAir\*ZoneMassFlow)*

where:

*SetPoint =* Setpoint temperature applied to the specified setpoint node(s)

*ZoneTemp =* Current zone temperature

*ZoneLoadtoHeatSP =* Zone heating load (Report Variable " Zone Predicted Sensible Load to Heating Setpoint Heat Transfer Rate [W]")

*CpAir =* Specific heat of zone supply air

*ZoneMassFlow =* Zone supply air mass flow rate

### Single Zone Cooling Only

The input object SetpointManager:SingleZone:Cooling provides a model that detects the control zone load to meet the current cooling setpoint (Report Variable "Zone Predicted Sensible Load to Cooling Setpoint Heat Transfer Rate [W]", zone inlet node flow rate, and zone node temperature, and calculates a setpoint temperature for the supply air that will satisfy the zone cooling load for the control zone.  "Zone Predicted Sensible Load to Cooling Setpoint Heat Transfer Rate [W]" &lt; 0 indicates a cooling load.  The following rules are applied:

·        If there is no zone cooling load, then the setpoint is set at the specified maximum supply air temperature.

·        If there is a zone cooling load  and the zone supply mass flow rate is less than 0.001 kg/s, then the setpoint is set at the specified minimum supply air temperature.

·        If there is a zone cooling load  and the zone supply mass flow rate is greater than 0.001 kg/s, then the setpoint is set calculated as follows:

*SetPoint = ZoneTemp + ZoneLoadtoCoolSP/(CpAir\*ZoneMassFlow)*

where:

*SetPoint* = Setpoint temperature applied to the specified setpoint node(s)

*ZoneTemp* = Current zone temeprature

*ZoneLoadtoCoolSP* = Zone cooling load (Report Variable "Zone Predicted Sensible Load to Cooling Setpoint Heat Transfer Rate [W]")

*CpAir* = Specific heat of zone supply air

*ZoneMassFlow* = Zone supply air mass flow rate

### Single Zone Minimum Humidity

The input object SetpointManager:SingleZone:Humidity:Minimum provides a model where the zone moisture load from ZoneTempPredictorCorrector (via DataZoneEnergyDemands) is used to calculate the minimum/maximum supply air humidity ratio needed to meet minimum/maximum zone relative humidity requirement.  For the Max setpoint manager is currently used in Controller:WaterCoil, when the control variable "TemperatureAndHumidityRatio".  A negative MoistureLoad means a dehumidification load for the coil controller.  This could be used for any system.

### Single Zone Maximum Humidity

The input object SetpointManager:SingleZone:Humidity:Maximum provides a setpoint manager that allows the control of high air humidity levels in a single zone. This setpoint manager, used in conjunction with object ZoneControl:Humidistat, detects the air humidity level in a single control zone and uses air/moisture mass balances to calculate the supply air humidity ratio needed to maintain the zone relative humidity at or below a given setpoint. The calculated supply air humidity ratio is then entered as a setpoint on a designated supply air stream node. A dehumidification component placed upstream of this node can then use the humidity ratio setpoint to control its moisture removal rate (e.g. desiccant dehumidifiers). In the case of a chilled water coil which is used for both temperature and high humidity control, this setpoint manager works in conjunction with a Controller:WaterCoil object to determine the minimum supply air temperature required to meet both the temperature (sensible) and humidity (latent) load in the control zone. (Ref: Controller:WaterCoil).

#### Model Description

The user must input the required information according to the IO Reference Manual (ref: SetpointManager:SingleZone:Humidity:Maximum). Specific inputs include an object name, control variable (HumidityRatio), name of the schedule defining the maximum relative humidity for the control zone, setpoint node name or list, and the zone air node name associated with the control zone (ref: ZoneHVAC:EquipmentConnections). The schedule name must refer to a valid schedule type (range 0-1) and contain values of fractional relative humidity.

This setpoint manager first converts the desired relative humidity setpoint for the control zone to humidity ratio based on the control zone dry-bulb temperature, the scheduled maximum relative humidity setpoint and outdoor barometric pressure.

<div>$${\omega_{sp}} = \,{\rm{PsyWFnTdbRhPb}}\left( {{T_{db}},R{H_{sp}},P} \right)$$</div>

where:

<span>${\omega_{sp}}$</span> = humidity ratio setpoint, kg H<sub>2</sub>O/kg air

PsyWFnTdbRHPb = EnergyPlus psychrometric function, returns humidity ratio as a function of dry-bulb temperature, relative humidity, and barometric pressure

<span>${T_{db}}$</span>= dry-bulb temperature in the control zone, °C

<span>$R{H_{sp}}$</span>= maximum relative humidity setpoint, fraction

<span>$P$</span> = outdoor barometric pressure, Pa

The model then calculates the supply air humidity ratio required to reduce the control zone relative humidity to the desired level. Using the humidity ratio setpoint (<span>${\omega_{sp}}$</span>) calculated above,

<div>$${\omega_{sa}} = \,{\omega_{sp}} + \frac{{{{\mathop Q\limits^ \bullet  }_l}}}{{\mathop m\limits^ \bullet  }}$$</div>

where:

<span>${\omega_{sa}}$</span> = maximum supply air humidity ratio setpoint, kg H<sub>2</sub>O/kg air

<span>$\mathop {{Q_l}}\limits^ \bullet  $</span> = control zone latent load, kg H<sub>2</sub>O/s (calculated by Zone Control:Humidistat)

<span>$\mathop m\limits^ \bullet  $</span> = control zone mass flow rate, kg/s

All setpoint managers are executed at the beginning of the simulation time step. Therefore, the calculated setpoint is based on the resulting control zone air temperature and air mass flow rate for the previous simulation time step.

The maximum supply air humidity ratio setpoint is placed on the node(s) specified in the input for this object (using node property Humidity Ratio Maximum).

### Mixed Air

The input object SetpointManager:MixedAir provides a setpoint manager that takes an already established setpoint (usually the supply air outlet node setpoint temperature), subtracts the supply fan heat gain, and applies the result as the setpoint temperature at the mixed air node (or any other node the user specifies).

<div>$${T_{set}} = {T_{set,ref}} - ({T_{fan,outlet}} - {T_{fan,inlet}})$$</div>

### Outdoor Air Pretreat

The input object SetpointManager:OutdoorAirPretreat provides a setpoint manager that is meant to be used in conjunction with an OutdoorAir:Mixer. The outdoor air pretreat setpoint manager is used to establish a temperature or humidity ratio setpoint in the outdoor air stream flowing into the outdoor air stream node of an outdoor air mixer. This setpoint manager determines the required setpoint in the outdoor air stream to produce the reference setpoint in the mixed air stream after mixing with return air. For example, if the temperature setpoint at the mixed air node is 15C, the return air temperature is 20C, and the outdoor air flow fraction is 0.5, the outdoor air pretreat setpoint would be set to 10C. This setpoint manager references four user-specified nodes to obtain the following values:

·        Reference setpoint node – desired mixed flow condition = RefNodeSetPoint

·        Mixed air stream node – mixed air flow rate = MixedOutNodeMassFlowRate

·        Outdoor air stream node – outdoor air flow rate = OAInNodeMassFlowRate

·        Return air stream node – return air condition = ReturnInValue

The following calculations are used to determine the new setpoint value (SetPoint):

*OAFraction = OAInNodeMassFlowRate / MixedOutNodeMassFlowRate*

*SetPoint = ReturnInValue + (RefNodeSetPoint - ReturnInValue)/OAFraction*

Depending on the specified control variable type, the setpoints and conditions may be humidity ratio (max or min) or temperature.  Note that zero is not allowed as the computed setpoint humidity ratio, because zero is used as a special value to indicate that no humidification or dehumidification is needed.  If the reference humidity ratio setpoint value is zero, the zero value will be passed directly to the setpoint Node(s).

### Warmest Zone Supply Air Reset

The input object SetpointManager:Warmest provides a setpoint manager that attempts to establish a supply air setpoint that will meet the cooling load of the zone needing the coldest air at the maximum zone supply air flowrate. The algorithm loops over all the zones that the system can cool and calculates

<div>$${T_{set,z}} = {T_z} + {\dot Q_z}/({C_{p,air}}\cdot {\dot m_{z,max}})$$</div>

Note that for cooling <span>${\dot Q_z} < 0.$</span>The lowest <span>${T_{set,z}}$</span>is chosen as <span>${T_{set}}$</span>. <span>${T_{set}}$</span>is constrained to be less than or equal to the maximum setpoint temperature (user input) and greater than or equal to the minimum setpoint temperature (user input). If the sum of the zone cooling loads is very small, the setpoint temperature is set to the maximum. <span>${T_{set}}$</span>will be applied to the node or nodes specified in the SetpointManager:Warmest object input.

### Coldest Zone Supply Air Reset

The input object SetpointManager:Coldest provides a setpoint manager that attempts to establish a supply air setpoint that will meet the heating load of the zone needing the warmest air at the maximum zone supply air flowrate. The algorithm loops over all the zones that the system can heat and calculates

<div>$${T_{set,z}} = {T_z} + {\dot Q_z}/({C_{p,air}}\cdot {\dot m_{z,max}})$$</div>

Note that for heating <span>${\dot Q_z} > 0.$</span>The highest <span>${T_{set,z}}$</span>is chosen as <span>${T_{set}}$</span>. <span>${T_{set}}$</span>is constrained to be less than or equal to the maximum setpoint temperature (user input) and greater than or equal to the minimum setpoint temperature (user input). If the sum of the zone heating loads is very small, the setpoint temperature is set to the minimum. <span>${T_{set}}$</span>will be applied to the node or nodes specified in the SetpointManager:Coldest object input.

### Return Air Bypass Flow

The input object SetpointManager:ReturnAirBypassFlow provides a setpoint manager that sets the air flow rate in a bypass duct such that when the bypassed and non-bypassed air are mixed the resutant air stream will be at the user-specified setpoint temperature.

The user specifies the desired setpoint temperature *T<sub>set</sub>* through a input temperature schedule.

This temperature is modified to account for any potential fan heat gain:

<div>$${T_{set,mod}} = {T_{set}} - ({T_{loop,out}} - {T_{mixer,out}})$$</div>

Here <span>${T_{loop,out}}$</span>is the temperature at the air loop outlet node and <span>${T_{mixer,out}}$</span> is the temperature at the outlet node of the bypass – nonbypass air mixer. Depending on the system configuration these may be the same node. Then

<div>$${\dot m_{bypass}} = ({\dot m_{tot}}\cdot {T_{set,mod}} - {\dot m_{nonbypass}}\cdot {T_{nonbypass}})/{T_{bypass}}$$</div>

where <span>${\dot m_{tot}}$</span>is the total supply air flowrate in kg/s sent to the zones, <span>${\dot m_{nonbypass}}$</span>is the nonbypassed air flowrate (the conditioned air), <span>${T_{nonbypass}}$</span>is the corresponding temperature just before mixing with the bypassed air, and <span>${T_{bypass}}$</span>is the temperature of the bypassed (unconditioned) air. The resulting <span>${\dot m_{bypass}}$</span> is the mass flow rate setpoint for the bypass air branch.

### Warmest Temp Flow

The input object SetpointManager:WarmestTemperatureFlow provides a setpoint manager that attempts to establish a supply air setpoint that will meet the cooling load of the zone needing the coldest air at the maximum zone supply air flowrate. The supply air temperature setpoint is established by SetpointManager:WarmestTemperatureFlow using one of two strategies: 'Temp First' sets the supply air temperature to the highest temperature that will meet the cooling load of the coolest zone at minimum cfm. 'Flow First' sets the supply air temperature to the highest temperature that will meet the cooling load of the warmest zone at maximum cfm.  'Temp First' gives higher priority to reducing fan energy whereas 'Flow First' gives higher priority to reducing chiller energy.

The algorithm loops over all the zones that the system can cool and calculates according to strategy:

**Temp First:**

<div>$${T_{set,z}} = {T_z} + {\raise0.7ex\hbox{${{{\dot Q}_z}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_z}} {({C_{p,air}}\cdot {{\dot m}_{z,\min }})}}}\right.}\!\lower0.7ex\hbox{${({C_{p,air}}\cdot {{\dot m}_{z,\min }})}$}}$$</div>

**Flow First:**

<div>$${T_{set,z}} = {T_z} + {\raise0.7ex\hbox{${{{\dot Q}_z}}$} \!\mathord{\left/ {\vphantom {{{{\dot Q}_z}} {({C_{p,air}}\cdot {{\dot m}_{z,\max }})}}}\right.}\!\lower0.7ex\hbox{${({C_{p,air}}\cdot {{\dot m}_{z,\max }})}$}}$$</div>

where <span>${\dot m_{z,\min }}$</span>is the minimum air flow rate to the zone produced by reducing the capacity of the supply fan or by reducing the opening of the damper in the terminal box, if present, and  <span>${\dot m_{z,\max }}$</span> is the design air flow rate to the zone.

Note that for cooling <span>${\dot Q_z} < 0.$</span> The lowest <span>${T_{set,z}}$</span>is chosen as <span>${T_{set}}$</span>. <span>${T_{set}}$</span>is constrained to be less than or equal to the maximum setpoint temperature (user input) and greater than or equal to the minimum setpoint temperature (user input). If the unconstrained value of <span>${T_{set}}$</span>is less than the minimum setpoint temperature and there are no VAV terminal boxes, the fan capacity is increased so as to meet the zone cooling loads with the constrained value of <span>${T_{set}}$</span>:



<div>$${\dot m_{fan}} = \sum\limits_z {{{\dot m}_{z,\min }}}  = \sum\limits_z {{{\dot Q}_z}/[{C_{p,air}} \cdot ({T_{set}} - {T_z})]} $$</div>

 This is more likely to occur in the ‘Temp First’ case. If the sum of the zone cooling loads is very small, the setpoint temperature is set to the maximum. <span>${T_{set}}$</span>will be applied to the node or nodes specified in the SetpointManager:WarmestTemperatureFlow object input.

### Multizone Heating Average

The input object SetpointManager:MultiZone:Heating:Average provides a setpoint manager that attempts to establish a supply air heating setpoint that will meet the heating load of multiple zones served by an HVAC air loop. The algorithm aggregates the predicted heating loads for all controlled zones served by an air loop (i.e., zones that have a thermostat object), and calculates the multizone average supply air heating setpoint temperature as follows:



IF ( <span>${\dot Q_{zj}}$</span>&gt; 0 ) THEN

<div>$$\overline {{T_{SP}}}  = \overline {{T_Z}}  + \left( {\frac{{\sum\limits_{j = 1}^{NumControlZones} {{{\dot Q}_{Zi}}} }}{{\sum\limits_{j = 1}^{NumControlZones} {{{\dot m}_{Zi}}\cdot C{p_j}} }}} \right)$$</div>

END IF

<div>$${\bar T_z} = {{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{zj}} \bullet } C{p_j} \bullet {T_{zj}}} \right)} \mathord{\left/ {\vphantom {{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{zj}} \bullet } C{p_j} \bullet {T_{zj}}} \right)} {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{zj}} \bullet } C{p_j}} \right)}}} \right. } {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{zj}} \bullet } C{p_j}} \right)}}$$</div>



where,

<span>${\bar T_{SP}}$</span>                  = average supply air setpoint temperature (°C)

<span>$NumControlZones$</span>= number of controlled zones (i.e., zones that contain thermostat objects) served by the air loop (-)

<span>${\dot Q_{Zj}}$</span>= sensible heating load required to reach the zone air temperature setpoint for the *j*<sup>th</sup> controlled zone at current time step (W)

<span>${\dot m_{Zj}}$</span>= air mass flow rate being supplied by the air loop to the *j*<sup>th</sup> controlled zone, lagged by one HVAC simulation time step (kg/s)

<span>$C{p_j}$</span>= specific heat of supply air for the j<sup>th</sup> controlled zone (J/kg-K)

<span>${T_{Zj}}$</span>= air node temperature for the *j*<sup>th</sup> controlled zone (°C)

<span>${\overline T_Z}$</span>= average zone air node temperature weighted by the heat capacity rate of the supply air streams for the controlled zones served by the air loop (°C)

<span>$TotZones$</span>= total number of zones served by the air loop (-)

Note that for heating <span>${\dot Q_{Zj}} > 0.$</span> The average supply air setpoint temperature <span>${\bar T_{SP}}$</span> is constrained to be less than or equal to the maximum setpoint temperature (user input) and greater than or equal to the minimum setpoint temperature (user input). If the sum of the zone sensible heating loads is extremely small (i.e., no heating load), the setpoint temperature is set to the minimum. <span>${\bar T_{SP}}$</span>will be applied to the setpoint node or nodes specified in the SetpointManager:MultiZone:Heating:Average object.

### Multizone Cooling Average

The input object SetpointManager:MultiZone:Cooling:Average provides a setpoint manager that attempts to establish a supply air cooling setpoint that will meet the cooling load of multiple zones served by an HVAC air loop. The algorithm aggregates the predicted cooling loads for all controlled zones served by an air loop (i.e., zones that have a thermostat object), and calculates the multizone average supply air cooling setpoint temperature as follows:



IF ( <span>${\dot Q_{zj}}$</span>&lt; 0 ) THEN

<div>$$\overline {{T_{SP}}}  = \overline {{T_Z}}  + \left( {\frac{{\sum\limits_{j = 1}^{NumControlZones} {{{\dot Q}_{Zi}}} }}{{\sum\limits_{j = 1}^{NumControlZones} {{{\dot m}_{Zi}}\cdot C{p_j}} }}} \right)$$</div>

END IF

<div>$${\bar T_z} = {{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{Zj}} \bullet } C{p_j} \bullet {T_{zj}}} \right)} \mathord{\left/ {\vphantom {{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{Zj}} \bullet } C{p_j} \bullet {T_{zj}}} \right)} {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{Zj}} \bullet } C{p_j}} \right)}}} \right. } {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{Zj}} \bullet } C{p_j}} \right)}}$$</div>

Note that for cooling <span>${\dot Q_{Zj}} < 0.$</span> The average supply air setpoint temperature <span>${\bar T_{SP}}$</span>is constrained to be less than or equal to the maximum setpoint temperature (user input) and greater than or equal to the minimum setpoint temperature (user input). If the sum of the zone sensible cooling loads is extremely small (i.e., no cooling load), the setpoint temperature is set to the maximum. <span>${\bar T_{SP}}$</span>will be applied to the setpoint node or nodes specified in the SetpointManager:MultiZone:Cooling:Average object.

### Multizone Minimum Humidity Average

The input object SetpointManager:MultiZone:MinimumHumidity:Average provides a setpoint manager that attempts to establish a supply air minimum humidity ratio setpoint that will meet the humidification load of multiple zones served by an HVAC air loop.  This setpoint manager, used in conjunction with object ZoneControl:Humidistat, detects the air humidity level for all controlled zones served by an air loop (i.e., zones that have a humidistat object with a humidifying setpoint schedule), and uses moisture mass balances to calculate the average supply air minimum humidity ratio setpoint as follows:

IF ( <span>${\dot Q_{lzj}}$</span>&gt; 0 ) THEN

<div>$${\bar \omega_{SP}} = {\bar \omega_Z} + {{\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot Q}_{l,Zj}}} } \right)} \mathord{\left/ {\vphantom {{\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot Q}_{l,Zj}}} } \right)} {\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot m}_{ZJ}}} } \right)}}} \right. } {\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot m}_{ZJ}}} } \right)}}$$</div>

END IF

<div>$${\bar \omega_Z}{ =_\,}{{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}\cdot {\omega_{Zj}}} } \right)} \mathord{\left/ {\vphantom {{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}\cdot {\omega_{Zj}}} } \right)} {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}} } \right)}}} \right. } {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}} } \right)}}$$</div>

where,

<span>${\bar \omega_{SP}}$</span>= average supply air minimum humidity ratio setpoint (kg H<sub>2</sub>O/kg air)

<span>$NumControlZones$</span>= number of controlled zones (i.e., zones that contain humidistat objects with humidifying setpoint schedule) served by the air loop (-)

<span>${\dot Q_{lZj}}$</span>= latent (humidification) load required to reach the zone air humidifying setpoint for the *j*<sup>th</sup> controlled zone at current time step (kg H<sub>2</sub>O/s)

<span>${\dot m_{Zj}}$</span>= air mass flow rate being supplied by the air loop to the *j*<sup>th</sup> controlled zone, lagged by one HVAC simulation time step (kg/s)

<span>${\omega_{Zj}}$</span>= air node humidity ratio for the jth controlled zone (kg H<sub>2</sub>O/kg air)

<span>${\bar \omega_Z}$</span>= average zone air node humidity ratio weighted by supply air mass flow rate for the controlled zones served by the air loop (kg H<sub>2</sub>O/kg air)

<span>$TotZones$</span>= total number of zones served by the air loop (-)

Note that a positive latent load means humidification is required. The average supply air minimum humidity ratio setpoint <span>${\bar \omega_{SP}}$</span>is constrained to be less than or equal to the maximum setpoint humidity ratio (user input) and greater than or equal to the minimum setpoint humidity ratio (user input). If the sum of the zone latent humidification loads is extremely small (i.e., no humidification load), the humidity ratio setpoint is set to the minimum. <span>${\bar \omega_{SP}}$</span>will be applied to the setpoint node or nodes specified in the SetpointManager:MultiZone:MinimumHumidity:Average object. A humidification component (e.g., an electric humidifier) placed upstream of this node can then use the humidity ratio setpoint to control its moisture addition rate.

All setpoint managers are executed at the beginning of the simulation time step. Therefore, the calculated setpoint is based on the resulting zone air node humidity ratios and supply air mass flow rates for the previous simulation time step.

### Multizone Maximum Humidity Average

The input object SetpointManager:MultiZone:MaximumHumidity:Average provides a setpoint manager that attempts to establish a supply air maximum humidity ratio setpoint that will meet the dehumidification load of multiple zones served by an HVAC air loop. This setpoint manager, used in conjunction with object ZoneControl:Humidistat, detects the air humidity level for all controlled zones served by an air loop (i.e., zones that have a humidistat object with a dehumidifying setpoint schedule), and uses moisture mass balances to calculate the average supply air maximum humidity ratio as follows:

IF ( <span>${\dot Q_{lzj}}$</span>&lt; 0 ) THEN

<div>$${\bar \omega_{SP}} = {\bar \omega_Z} + {{\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot Q}_{l,Zj}}} } \right)} \mathord{\left/ {\vphantom {{\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot Q}_{l,Zj}}} } \right)} {\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot m}_{ZJ}}} } \right)}}} \right. } {\left( {\sum\limits_{j = 1}^{NumControlZones} {{{\dot m}_{ZJ}}} } \right)}}$$</div>

END IF

<div>$${\bar \omega_Z}{ =_\,}{{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}\cdot {\omega_{Zj}}} } \right)} \mathord{\left/ {\vphantom {{\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}\cdot {\omega_{Zj}}} } \right)} {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}} } \right)}}} \right. } {\left( {\sum\limits_{j = 1}^{TotZones} {{{\dot m}_{\,Zj}}} } \right)}}$$</div>

Note that a negative latent load means dehumidification is required. The average supply air maximum humidity ratio setpoint <span>${\bar \omega_{SP}}$</span>is constrained to be less than or equal to the maximum setpoint humidity ratio (user input) and greater than or equal to the minimum setpoint humidity ratio (user input). If the sum of the zone latent dehumidification loads is extremely small (i.e., no dehumidification load), the humidity ratio setpoint is set to the maximum. <span>${\bar \omega_{SP}}$</span>will be applied to the setpoint node or nodes specified in the SetpointManager:MultiZone:MaximumHumidity:Average object. A dehumidification component (e.g., an desiccant dehumidifier) placed upstream of this node can then use the humidity ratio setpoint to control its moisture removal rate. In the case of a chilled water coil which is used for both temperature and high humidity control, this setpoint manager works in conjunction with a Controller:WaterCoil object to determines the minimum supply air temperature required to meet both the temperature (sensible) and humidity (latent) load in the control zone (ref: Controller:WaterCoil).

### MultiZone Minimum Humidity Supply Air Reset

The input object SetpointManager:MultiZone:Humidity:Minimum provides a setpoint manager that attempts to establish a supply air minimum humidity ratio setpoint that will meet the humidification load of zone with the critical humidification requirement at each time step served by an HVAC air loop at the zone actual supply air mass flow rate.  This setpoint manager, used in conjunction with object ZoneControl:Humidistat, detects the air humidity level for all controlled zones served by an air loop (i.e., zones that have a humidistat object with a humidifying setpoint schedule), and uses moisture mass balances to calculate the supply air minimum humidity ratio setpoint.  The algorithm loops over all the zones that the system can humidify and calculates the setpoint based on a zone with the highest humidity ratio setpoint requirement as follows:

IF (<span>${\dot Q_{lzj}}$</span>&gt; 0) THEN

<div>$${\omega_{SP\;Zj}} = {\omega_{Zj}} + {{{{\dot Q}_{lZj}}} \mathord{\left/ {\vphantom {{{{\dot Q}_{lZj}}} {{{\dot m}_{Zj}}}}} \right. } {{{\dot m}_{Zj}}}}$$</div>

END IF

<div>$${\omega_{SP\;Zj}} = MAX\left( {{\omega_{SP\;Zj}},\;{\omega_{SP\;Min}}} \right)$$</div>

<div>$${\omega_{SP}} = MIN\left( {{\omega_{SP\;Zj}},\;{\omega_{SP\;Max}}} \right)$$</div>

where,

<span>${\omega_{SP}}$</span>= supply air humidity ratio setpoint (kg/kg)

<span>${\dot Q_{lzj}}$</span>= latent load required to reach the zone air setpoint for the *j*<sup>th</sup> controlled zone at current time step (kg H<sub>2</sub>O/s)

<span>${\dot m_{Zj}}$</span>= actual mass flow rate supplied by the air loop to the *j*<sup>th</sup> controlled zone, (kg/s)

<span>${\omega_{Zj}}$</span>= air node humidity ratio for the j<sup>th</sup> controlled zone (kg/kg)

<span>${\omega_{SP\;Zj}}$</span>= supply air humidity ratio setpoint for the j<sup>th</sup> controlled zones (kg/kg)

<span>${\omega_{SP\;Min}}$</span>= user-specified supply air minimum humidity ratio setpoint (kg/kg)

<span>${\omega_{SP\;Max}}$</span>= user-specified supply air maximum humidity ratio setpoint (kg/kg)

Note that a positive latent load means humidification is required. The supply air minimum humidity ratio setpoint <span>${\omega_{SP}}$</span>is constrained to be less than or equal to the maximum setpoint humidity ratio (user input) and greater than or equal to the minimum setpoint humidity ratio (user input). If the humidification load for all zones in the air loop is extremely small (i.e., no humidification load), the humidity ratio setpoint is set to the user input minimum value. <span>${\omega_{SP}}$</span>will be applied to the setpoint node or nodes specified in the SetpointManager:MultiZone:Humidity:Minimum object. A humidification component (e.g., an electric humidifier) placed upstream of this node can then use the humidity ratio setpoint to control its moisture addition rate.

### MultiZone Maximum Humidity Supply Air Reset

The input object SetpointManager:MultiZone:Humidity:Maximum provides a setpoint manager that attempts to establish a supply air maximum humidity ratio setpoint that will meet the dehumidification load of the zone with the critical dehumidification requirement at each time step served by an HVAC air loop at the zone actual supply air mass flow rate. This setpoint manager, used in conjunction with object ZoneControl:Humidistat, detects the air humidity level for all controlled zones served by an air loop (i.e., zones that have a humidistat object with a dehumidifying setpoint schedule), and uses moisture mass balances to calculate the supply air maximum humidity ratio setpoint.  The algorithm loops over all the zones that the system can dehumidify and calculates the setpoint based on a zone with the lowest humidity ratio setpoint requirement as follows:

IF (<span>${\dot Q_{lzj}}$</span>&lt; 0) THEN

<div>$${\omega_{SP\;Zj}} = {\omega_{Zj}} + {{{{\dot Q}_{lZj}}} \mathord{\left/ {\vphantom {{{{\dot Q}_{lZj}}} {{{\dot m}_{Zj}}}}} \right. } {{{\dot m}_{Zj}}}}$$</div>

END IF

<div>$${\omega_{SP\;Zj}} = MAX\left( {{\omega_{SP\;Zj}},\;{\omega_{SP\;Min}}} \right)$$</div>

<div>$${\omega_{SP}} = MIN\left( {{\omega_{SP\;Zj}},\;{\omega_{SP\;Max}}} \right)$$</div>

Note that a negative latent load means dehumidification is required. The supply air maximum humidity ratio setpoint <span>${\omega_{SP}}$</span>is constrained to be less than or equal to the maximum setpoint humidity ratio (user input) and greater than or equal to the minimum setpoint humidity ratio (user input). If the dehumidification load for all zones in the air loop is extremely small (i.e., no dehumidification load), the humidity ratio setpoint is set to the user input maximum value. <span>${\omega_{SP}}$</span>will be applied to the setpoint node or nodes specified in the SetpointManager:MultiZone:Humidity:Maximum object. A dehumidification component (e.g., an desiccant dehumidifier) placed upstream of this node can then use the humidity ratio setpoint to control its moisture removal rate. In the case of a chilled water coil which is used for both temperature and high humidity control, this setpoint manager works in conjunction with a Controller:WaterCoil object to determines the minimum supply air temperature required to meet both the temperature (sensible) and dehumidification (latent) load in the control zone (ref: Controller:WaterCoil).

### Follow Outdoor Air Temperature

The input object SetpointManager:FollowOutdoorAirTemperature provides a setpoint manager that is used to place a temperature setpoint on a system node that is derived from the current outdoor air environmental conditions.  The outdoor air conditions are obtained from the weather information during the simulation.

IF (ReferenceTemperatureType == OutdoorWetBulb)

    Setpoint = OutdoorWetBulbTemp + OffSet

ELSEIF (ReferenceTemperatureType == OutdoorDryBulb)

    Setpoint = OutdoorDryBulbTemp + OffSet

ENDIF

Setpoint = MAX(Setpoint, MinSetPoint)

Setpoint = MIN(Setpoint, MaxSetPoint)

MinSetPoint, MaxSetPoint and Offset are specified by the user as the input in object SetpointManager:FollowOutdoorAirTemperature.

### Follow System Node Temperature

The input object SetpointManager:FollowSystemNodeTemperature provides a temperature setpoint on a system node that is derived from the current temperatures at a separate system node.  The current value of the temperature at a reference node are obtained and used to generate setpoint on a second system node.  If the reference node is also designated to be an outdoor air (intake) node, then this setpoint manager can be used to follow outdoor air conditions that are adjusted for altitude.

IF (ReferenceTemperatureType == NodeWetBulb)

    Setpoint = NodeWetbulbTemp + OffSet

ELSEIF (ReferenceTemperatureType == NodeDryBulb)

    Setpoint = NodeDrybulbTemp + OffSet

ENDIF



Setpoint = MAX(Setpoint, MinSetPoint)

Setpoint = MIN(Setpoint, MaxSetPoint)

MinSetPoint, MaxSetPoint and Offset are specified by the user as the input in object SetpointManager:FollowSystemNodeTemperature.

### Follow Ground Temperature

The input object SetpointManager:FollowGroundTemperature provides a temperature setpoint on a system node that is derived from a current ground temperature.  The ground temperatures are specified in different Site:GroundTemperature:\* objects and used during the simulation.  This setpoint manager is primarily intended for condenser or plant loops using some type of ground heat exchanger.



IF (ReferenceGroundTemperatureObjectType == BuildingSurface)

    Setpoint = GroundTemp + OffSet

ELSEIF (ReferenceGroundTemperatureObjectType == Shallow)

    Setpoint = GroundTemp\_Surface + OffSet

ELSEIF (ReferenceGroundTemperatureObjectType == Deep)

    Setpoint = GroundTemp\_Deep + OffSet

ELSEIF (ReferenceTGroundTemperatureObjectType == FCfactorMethod)

    Setpoint = GroundTemp\_FC + OffSet

ENDIF

Setpoint = MAX(Setpoint, MinSetPoint)

Setpoint = MIN(Setpoint, MaxSetPoint)

* *

Where,

GroundTemp = Current ground temperature (C)

(Ref: Site:GroundTemperature:BuildingSurface)

GroundTemp\_Surface = Current surface ground temperature  (C)

(Ref: Site:GroundTemperature:Shallow)

GroundTemp\_Deep  = Current deep ground temperature  (C)

(Ref: Site:GroundTemperature:Deep)

GroundTemp\_FC = Current ground temperature defined F or C factor method (C)

(Ref: Site:GroundTemperature:FCfactorMethod)

MinSetPoint, MaxSetPoint and Offset are specified by the user as the input in object SetpointManager:FollowGroundTemperature.

### Condenser Entering Water Temperature Reset

The object resets the condenser entering water temperature to the optimal cooling tower water set point temperature that will result in minimum net energy consumption for the chiller and cooling tower plant. This chiller-tower optimization scheme uses one curve to determine the optimum condenser entering water temperature for a given time step and two other curves to place boundary conditions on the “optimized” set point value. The optimized condenser entering water temperature may not be valid every timestep then will be limited algorithmically by two boundary curves. The first of these boundary curves is given by:

*MinDsnWB = C1 + C2\*OaWb + C3\*WPLR + C4\*TwrDsnWB + C5\*NF*

where:

*C1-C5* = curve coefficients

*OaWb* = outside air wetbulb for current timestep, C

*TwrDsnWB* = Tower design inlet Air Wet-Bulb Temperature, C

*WPLR* = Weighted PLR

    = ChillerCoolingLoadThisTimestep / NominalChillerCapacity

NF = Normalized condenser water flow per unit of tower capacity, m3/W

      = Design Tower Flow Rate / Design Tower Capacity *(typically 5.382E-8 m3/s, i.e., 3 gpm/ton)*

MinDsnWB is compared against the design tower wetbulb. This curve is usually a function of Weighted PLR and NF. So if NF is constant at 5.382E-8 m3/s (3 gpm/ton), the curve can be depicted as follows:

![闒粀闀粀](EngineeringReference/media/image6482.png)

Figure 292. Minimum Tower Design Wet Bulb Boundary Condition

The second boundary curve is given by:

*MinActualWb = C1 + C2\*MinDsnWB + C3\*WPLR + C4\*TwrDsnWB + C5\*NF*

where,

*C1-C5 = curve coefficients*

*MinDsnWB = from first boundary equation, C*

*TwrDsnWB = Tower design inlet Air Wet-Bulb Temperature, C*

*WPLR = Weighted PLR*

*           = ChillerCoolingLoadThisTimestep / NominalChillerCapacity*

*NF = Normalized condenser water flow per unit of tower capacity, m3/W*

*      = Design Tower Flow Rate / Design Tower Capacity (typically 5.382E-8 m3/s, i.e., 3 gpm/ton)*

MinActualWb is compared against this time step’s outside air wet bulb. This curve is usually a function of MinDesignWB, WeightedRatio and TwrDesignWB. So if TwrDesignWB is constant at 25.6 °C (78 °F), and NF = 5.382E-8 m3/s (3 gpm/ton), the curve can be depicted as follows:

![闒粀闀粀](EngineeringReference/media/image6483.png)

Figure 293. Minimum Wet Bulb Boundary Condition

The Optimized Condenser Entering Water Temperature is calculated with this equation:

*OptCondEntTemp = C1 + C2\*OaWb + C3\*WPLR + C4\*TwrDsnWB + C5\*NF*

where,

*C1-C5 = curve coefficients*

*OaWB = this timestep’s outside air wetbulb, C*

*TwrDsnWB = Tower design inlet Air Wet-Bulb Temperature, C*

*WPLR = Weighted PLR*

*           = ChillerCoolingLoadThisTimestep / NominalChillerCapacity*

*NF = Normalized condenser water flow per unit of tower capacity, m3/W*

*      = Design Tower Flow Rate / Design Tower Capacity (typically 5.382E-8 m3/s, i.e., 3 gpm/ton)*

A graph of the curve can be depicted as follows:

![闒粀闀粀](EngineeringReference/media/image6484.png)

Figure 294. Optimum EWT vs PLR & OaWb



The optimized condenser entering water temperature is calculated but is not necessarily used each timestep. If OptCondEntTemp does not fall within the bounds established by MinDsnWB and MinActualWb, then the value from the Default Condenser Entering Water Temperature Schedule is used for the Condenser Entering Water Set Point instead.

### Ideal Condenser Entering Water Temperature Reset

The object determines a “near-optimal” condenser water entering set point at each time step that will result in minimum net energy consumption for the chiller and cooling tower plant. The “ideal” chiller-tower optimization scheme uses a search algorithm to find the ideal optimal setpoint at a given timestep. This requires resimulating HVAC systems at each timestep until finding an “optimal” condenser water entering setpoint (OptSetpoint) which gives the minimum total chiller, cooling tower, chilled water pump and condenser water pump power consumption (TEC). The OptSetpoint falls between realistic minimum and maximum boundaries, which are set by the user. The minimum boundary is determined based on the minimum lift (user input) and evaporator leaving water temperature. The maximum boundary is specified by the user. It is assumed that a single minimum point exists between these boundaries. The following steps are used to find “optimal” setpoint:

1)   Set an initial setpoint value for the iteration to a user-defined maximum condenser entering water temperature (Toptset<sub>1</sub>) and calculate TEC.

2)   Decrease the setpoint value by 1˚C (Toptset<sub>2</sub>=Toptset<sub>1</sub>–1˚C) and calculate TEC.

3)   Compare the TEC in Step 1 (TEC<sub>1</sub>) and TEC in Step 2 (TEC<sub>2</sub>), i.e., (dTEC<sub>1</sub>=TEC<sub>1</sub>–TEC<sub>2</sub>).

4)   If dTEC<sub>1</sub> is negative, stop the iteration and set the “optimal” setpoint to Toptset<sub>1</sub>.

5)   If dTEC<sub>1</sub> is positive, Decrease the setpoint value by 1˚C and calculate TEC. Compare the TECs and repeat this step (i.e., dTEC<sub>N</sub>=TEC<sub>N</sub>–TEC<sub>N+1</sub>) until either Toptset<sub>N+1</sub> reaches to the minimum boundary value or dTEC<sub>N</sub> becomes negative.

6)   If Toptset<sub>N</sub> reaches to the minimum boundary value and still dTEC<sub>N</sub> is positive, set the “optimal” setpoint to Toptset<sub>N+1</sub>.

7)   If TEC<sub>N</sub> becomes negative, decrease Toptset<sub>N-1</sub> by 0.2˚C and calculate TEC. Compare the TECs and repeat this step (i.e., dTEC<sub>M</sub>=TEC<sub>M</sub>–TEC<sub>M+1</sub>) until dTEC<sub>M</sub> becomes negative. Then set the “optimal” setpoint to Toptset<sub>M+1</sub>.

Solar Collectors <a name="SolarCollectors"></a>
----------------

Solar collectors are devices that convert solar energy into thermal energy by raising the temperature of a circulating heat transfer fluid.  The fluid can then be used to heat water for domestic hot water usage or space heating.  Flat-plate solar collectors using water as the heat transfer fluid, Integral-Collector Storage solar collectors using water and unglazed transpired solar collectors using air are currently the only types of collector available in EnergyPlus.

### Flat-Plate Solar Collectors

The input object SolarCollector:FlatPlate:Water provides a model for flat-plate solar collectors that are the most common type of collector.  Standards have been established by ASHRAE for the performance testing of these collectors (ASHRAE 1989; 1991) and the Solar Rating and Certification Corporation (SRCC) publishes a directory of commercially available collectors in North America (SRCC 2003).

The EnergyPlus model is based on the equations found in the ASHRAE standards and Duffie and Beckman (1991).  This model applies to glazed and unglazed flat-plate collectors, as well as banks of tubular, i.e. evacuated tube, collectors.

#### Solar and Shading Calculations

The solar collector object uses a standard EnergyPlus surface in order to take advantage of the detailed solar and shading calculations.  Solar radiation incident on the surface includes beam and diffuse radiation, as well as radiation reflected from the ground and adjacent surfaces.  Shading of the collector by other surfaces, such as nearby buildings or trees, is also taken into account.  Likewise, the collector surface can shade other surfaces, for example, reducing the incident radiation on the roof beneath it.

#### Thermal Performance

The thermal efficiency of a collector is defined as the ratio of the useful heat gain of the collector fluid versus the total incident solar radiation on the gross surface area of the collector.

<div>$$\eta  = \frac{{(q/A)}}{{{I_{solar}}}}$$</div>

where

q = useful heat gain

A = gross area of the collector

I<sub>solar</sub> = total incident solar radiation

Notice that the efficiency h is only defined for I<sub>solar</sub> &gt; 0.

An energy balance on a solar collector with double glazing shows relationships between the glazing properties, absorber plate properties, and environmental conditions.

<div>$$\frac{q}{A} = {I_{solar}}{\tau_{g1}}{\tau_{g2}}{\alpha_{abs}} - \frac{{T_{abs}^4 - T_{g2}^4}}{{{R_{rad}}}} - \frac{{{T_{abs}} - {T_{g2}}}}{{{R_{conv}}}} - \frac{{{T_{abs}} - {T_{air}}}}{{{R_{cond}}}}$$</div>

where

t<sub>g1</sub> = transmittance of the first glazing layer

t<sub>g2</sub> = transmittance of the second glazing layer

a<sub>abs</sub> = absorptance of the absorber plate

R<sub>rad</sub> = radiative resistance from absorber to inside glazing

R<sub>conv</sub> = convective resistance from absorber to inside glazing

R<sub>cond</sub> = conductive resistance from absorber to outdoor air through the insulation

T<sub>abs</sub> = temperature of the absorber plate

T<sub>g2</sub> = temperature of the inside glazing

T<sub>air</sub> = temperature of the outdoor air

The equation above can be approximated with a simpler formulation as:

<div>$$\frac{q}{A} = {F_R}\left[ {{I_{solar}}(\tau \alpha ) - {U_L}({T_{in}} - {T_{air}})} \right]$$</div>

where

F<sub>R</sub> = an empirically determined correction factor

(ta) = the product of all transmittance and absorptance terms

U<sub>L</sub> = overall heat loss coefficient combining radiation, convection, and conduction terms

T<sub>in</sub> = inlet temperature of the working fluid

Substituting this into Equation ,

<div>$$\eta  = {F_R}(\tau \alpha ) - {F_R}{U_L}\frac{{({T_{in}} - {T_{air}})}}{{{I_{solar}}}}$$</div>

A linear correlation can be constructed by treating F<sub>R</sub>(ta) and -F<sub>R</sub>U<sub>L</sub> as characteristic constants of the solar collector:

<div>$$\eta  = {c_0} + {c_1}\frac{{\left( {{T_{in}} - {T_{air}}} \right)}}{{{I_{solar}}}}$$</div>

Similarly, a quadratic correlation can be constructed using the form:

<div>$$\eta  = {c_0} + {c_1}\frac{{\left( {{T_{in}} - {T_{air}}} \right)}}{{{I_{solar}}}} + {c_2}\frac{{{{\left( {{T_{in}} - {T_{air}}} \right)}^2}}}{{{I_{solar}}}}$$</div>

Both first- and second-order efficiency equation coefficients are listed in the *Directory of SRCC Certified Solar Collector Ratings*.

#### Incident Angle Modifiers

As with regular windows the transmittance of the collector glazing varies with the incidence angle of radiation.  Usually the transmittance is highest when the incident radiation is normal to the glazing surface.  Test conditions determine the efficiency coefficients for normal incidence.  For off-normal angles, the transmittance of the glazing is modified by an *incident angle modifier* coefficient.

<div>$${K_{\tau \alpha }} = \frac{{\left( {\tau \alpha } \right)}}{{{{\left( {\tau \alpha } \right)}_n}}}$$</div>

Additional testing determines the incident angle modifier as a function of incident angle q.  This relationship can be fit to a first-order, linear correlation:

<div>$${K_{\tau \alpha }} = 1 + {b_0}\left( {\frac{1}{{\cos \theta }} - 1} \right)$$</div>

or a second-order, quadratic correlation:

<div>$${K_{\tau \alpha }} = 1 + {b_0}\left( {\frac{1}{{\cos \theta }} - 1} \right) + {b_1}{\left( {\frac{1}{{\cos \theta }} - 1} \right)^2}$$</div>

The incident angle modifier coefficients *b<sub>0</sub>* and *b<sub>1</sub>* are usually negative, although some collectors have a positive value for *b<sub>0</sub>*.  Both first- and second-order incident angle modifier equation coefficients are listed in the *Directory of SRCC Certified Solar Collector Ratings*.

The SRCC incident angle modifier equation coefficients are only valid for incident angles of 60 degrees or less.  Because these curves can be valid yet behave poorly for angles greater than 60 degree, the EnergyPlus model cuts off collector gains for incident angles greater than 60 degrees.

For flat-plate collectors, the incident angle modifier is generally symmetrical.  However, for tubular collectors the incident angle modifier is different depending on whether the incident angle is parallel or perpendicular to the tubes.  These are called bi-axial modifiers.  Some special flat-plate collectors may also exhibit this asymmetry.  The current model cannot yet handle two sets of incident angle modifiers.  In the meantime it is recommended that tubular collectors be approximated with caution using either the parallel or perpendicular correlation.

Incident angle modifiers are calculated separately for sun, sky, and ground radiation.  The net incident angle modifier for all incident radiation is calculated by weighting each component by the corresponding modifier.

<div>$${K_{\tau \alpha ,net}} = \frac{{{I_{beam}}{K_{\tau \alpha ,beam}} + {I_{sky}}{K_{\tau \alpha ,sky}} + {I_{gnd}}{K_{\tau \alpha ,gnd}}}}{{{I_{beam}} + {I_{sky}} + {I_{gnd}}}}$$</div>

For sky and ground radiation the incident angle is approximated using Brandemuehl and Beckman's equations:

<div>$${\theta_{sky}} = 59.68 - 0.1388\phi  + 0.001497{\phi ^2}$$</div>

<div>$${\theta_{ground}} = 90.0 - 0.5788\phi  + 0.002693{\phi ^2}$$</div>

where f is the surface tilt in degrees.

The net incident angle modifier is then inserted into the useful heat gain equation :

<div>$$\frac{q}{A} = {F_R}\left[ {{I_{solar}}{K_{\tau \alpha ,net}}{{(\tau \alpha )}_n} - {U_L}({T_{in}} - {T_{air}})} \right]$$</div>

Equation is also modified accordingly.

<div>$$\eta  = {F_R}{K_{\tau \alpha ,net}}{(\tau \alpha )_n} - {F_R}{U_L}\frac{{({T_{in}} - {T_{air}})}}{{{I_{solar}}}}$$</div>

#### Outlet Temperature

Outlet temperature is calculated using the useful heat gain q as determined by Equation , the inlet fluid temperature T<sub>in</sub>, and the mass flow rate available from the plant simulation:

<div>$$\frac{q}{A} = \dot m{c_p}({T_{out}} - {T_{in}})$$</div>

where

<span>$\dot m$</span> = fluid mass flow rate through the collector

c<sub>p</sub> = specific heat of the working fluid

Solving for T<sub>out</sub>,

<div>$${T_{out}} = {T_{in}} + \frac{q}{{\dot m{c_p}A}}$$</div>

If there is no flow through the collector, T<sub>out</sub> is the stagnation temperature of the fluid.  This is calculated by setting the left side of Equation to zero and solving for T<sub>in</sub> (which also equals T<sub>out</sub> for the no flow case).

#### References

ASHRAE.  1989.  ASHRAE Standard 96-1980 (RA 89):  Methods of Testing to Determine the Thermal Performance of Unglazed Flat-Plate Liquid-Type Solar Collectors.  Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

ASHRAE.  1991.  ASHRAE Standard 93-1986 (RA 91):  Methods of Testing to Determine the Thermal Performance of Solar Collectors.  Atlanta: American Society of Heating, Refrigerating and Air-Conditioning Engineers, Inc.

Duffie, J. A., and Beckman, W. A.  1991.  Solar Engineering of Thermal Processes, Second Edition.  New York:  Wiley-Interscience.

Solar Rating and Certification Corporation.  2004.  Directory of SRCC Certified Solar Collector Ratings, OG 100.  Cocoa, Florida:  Solar Rating and Certification Corporation.

### Integral-collector-storage (ICS) Solar Collector

Solar collectors with integral storage unit models use SolarCollector:IntegralCollectorStorage object, and the characteristics parameter inputs of this collector are provided by the SolarCollectorPerformance:IntegralCollectorStorage object. This model is based on detailed Energy Balance equations of solar collectors that integrates storage in it. This model has two options to represent the collector bottom outside boundary conditions: AmbientAir, and OtherSideConditionsModel. AmbientAir simply applies outside air temperature using combined convection and radiation conductance, and the OtherSideConditionsModel applies combined radiation and convection models that exiats in a naturally ventilated cavity to represent the collector bottom outside boundary condition. The later boundary condition accounts for the shading of the collector on the underlying surface, hence, the ICS collector can be assumed as an integral part of the building envelope. Schematic diagram of a rectangular ICS solar collector is shown in Figure 295 below:

![](EngineeringReference/media/image6502.png)

Figure 295. Schematic diagram of rectangular Integrated Collector Storage unit

#### Solar and Shading Calculations

The solar collector object uses a standard EnergyPlus surface in order to take advantage of the detailed solar and shading calculations. Solar radiation incident on the surface includes beam and diffuse radiation, as well as radiation reflected from the ground and adjacent surfaces. Shading of the collector by other surfaces, such as nearby buildings or trees, is also taken into account. Likewise, the collector surface shades the roof surface beneath it, hence no direct solar radiation incident on the roof surface. The collector and the roof outside boundary conditions should be specified as OtherSideConditionModel to account for solar collector shading impact on the roof surface.

#### Mathematical Model

The integral-collector-storage (ICS) solar collector is represented using two transient energy balance equations shown below.  These equations represent the energy balance equation for the absorber plate, and the water in the collector.

<div>$${m_p}{C_p}\frac{{d{T_p}}}{{dt}} = A \cdot \left[ {{{\left( {\tau \alpha } \right)}_e} \cdot {I_t} - {h_{pw}}\left( {{T_p} - {T_w}} \right) - {U_t}\left( {{T_p} - {T_a}} \right)} \right]$$</div>

<div>$${m_w}{C_w}\frac{{d{T_w}}}{{dt}} = A \cdot \left[ {{h_{pw}}\left( {{T_p} - {T_w}} \right) - {U_b}\left( {{T_w} - {T_{OSC}}} \right) - {U_s}\left( {{T_w} - {T_a}} \right)} \right] - {\dot m_w}{C_w}\left( {{T_w} - {T_{wi}}} \right)$$</div>

Where,

*m<sub>p</sub>C<sub>p</sub>*<sub>      </sub>= thermal capacity of the absorber surface, J/°C

A        = collector gross area, m<sup>2</sup>

*(ta)*<sub>e</sub>    = transmittance-absorptance product of the absorber plate and cover system

*I<sub>t</sub>*        = total solar irradiation, (W/m<sup>2</sup>)

*h<sub>pw</sub>*      = convective heat transfer coefficient from absorber plate to water, (W/m2°K)

*U<sub>t</sub>*        = overall heat loss coefficient from absorber to the ambient air, (W/m2 °K)

*T<sub>p</sub>*        = absorber plate average temperature, (°C)

*T<sub>w</sub>*       = collector water average temperature, (°C)

*T<sub>a</sub>*        = ambient air temperature, (°C)

*m<sub>w</sub>C<sub>pw</sub>* = thermal capacity of the water mass in the collector, (J/°C)

*U<sub>s</sub>*       = area-weighted conductance of the collector side insulation, (W/m<sup>2</sup>×°K)

*U<sub>b</sub>*       = conductance of the collector bottom insulation, (W/m<sup>2</sup>×°K)

*T<sub>osc</sub>*      =    outside temperature of bottom insulation determined from the other side condition model, (°C)

*T<sub>wi</sub>*       = Entering makeup or mains water temperature, (°C)

<span>${\dot m_w}{C_w}$</span>= water capacity flow through the collector, (W/°C)

The other side condition model boundary condition represented by the *T<sub>osc</sub>*, allows us to apply a realistic outside boundary condition for a collector mounted on a building roof.  This also accounts for the shading impact of the collector on the under-laying surface (roof).  On the other hand if ambient air boundary condition is specified, then the collector does not shade the underlying surface it is mounted on.

The two energy balance equation can be written as non-homogeneous first order DE with constant coefficients. The initial conditions for these equations are the absorber plate average temperature and the collector water average temperature at previous time steps.

<div>$$\frac{{d{T_p}}}{{dt}} = {a_1}{T_p} + {a_2}{T_w} + {a_3}$$</div>

<div>$$\frac{{d{T_w}}}{{dt}} = {b_1}{T_p} + {b_2}{T_w} + {b_3}$$</div>

<div>$${a_1} =  - \left( {A \cdot {h_{pw}} + A \cdot {U_t}} \right)/\left( {{m_p} \cdot {C_p}} \right)$$</div>

<div>$${a_2} = A \cdot {h_{pw}}{T_w}/\left( {{m_p} \cdot {C_p}} \right)$$</div>

<div>$${a_3} = A \cdot {\left( {\tau \alpha } \right)_e} \cdot {I_t} + A \cdot {U_t}{T_a}$$</div>

<div>$${b_1} = A \cdot {h_{pw}}{T_p}/\left( {{m_w} \cdot {C_w}} \right)$$</div>

<div>$${b_2} =  - \left( {A \cdot {h_{pw}} + A \cdot {U_b} + A \cdot {U_s} + {{\dot m}_w}{C_w}} \right)$$</div>

<div>$${{\rm{b}}_{\rm{3}}} = {\rm{ }}\left( {A \cdot {U_b}{T_{osc}} + A \cdot {U_s}{T_a} + {{\dot m}_w}{C_w}{T_{wi}}} \right)$$</div>

The two coupled first order differential equation are solved analytically.  Auxiliary equation of the the coupled homogeneous differential equation is given by:

<div>$${\lambda ^2} - ({a_1} + {b_2}) + ({a_1}{b_2} - {a_2}{b_1}) = 0$$</div>

This auxiliary quadratic equation has always two distinct real roots (l<sub>1</sub> and l<sub>2</sub>) hence the solution of the homogeneous equation is exponential, and the general solutions of the differential equations are given by:

<div>$${T_p} =  {c_1}{e^{{l_1}t}} + {c_2}{e^{{l_2}t}} + A$$</div>

<div>$${T_w} =  {r_1}{c_1}{e^{{l_1}t}} + {r_2}{c_2}{e^{{l_2}t}} + B$$</div>

The constant terms *A* and *B* are the particular solution of the non-homogeneous differential equations, the coefficients of the exponential terms (*c<sub>1</sub>*, *c<sub>2</sub>*, *r<sub>1</sub>*, and *r<sub>2</sub>*) are determined from the initial conditions of the absorber and collector water temperatures (*T<sub>p0</sub>*, *T<sub>w0</sub>*) and are given by:

<div>$${r_1} =  ({l_1} - {a_1})/{a_2};\quad {r_2} =  ({l_2} - {a_1})/{a_2}$$</div>

<div>$$A =  ( - {a_3}{b_2} + {b_3}{a_2})/({a_1}{b_2} - {b_1}{a_2});\quad B =  ( - {a_1}{b_3} + {b_1}{a_3})/({a_1}{b_2} - {b_1}{a_2})$$</div>

<div>$${c_1} =  ({r_2}{T_{p0}} - {T_{w0}} - {r_2}A + B)/({r_2} - {r_1});\quad {c_2} =  ({T_{w0}} - {r_1}{T_{p0}} + {r_1}A - B)/({r_2} - {r_1})$$</div>

#### Thermal Network Model:

The thermal network model requires energy balance for each of the collector covers as well.  The heat balance equation of the collector covers is assumed to obey steady state formulation by ignoring their thermal mass. The thermal-network representation of the ICS collector is shown in Figure 296. Also, the heat balance at each cover surface requires knowledge of the amount of solar fraction absorbed, which is determined from the ray tracing analysis. For the thermal network model shown above the overall top heat loss coefficient is determined from combination of the resistances in series as follows:

<div>$${U_t} = {\left[ {{R_1} + {R_2} + {R_3}} \right]^{ - 1}}$$</div>

Or

<div>$${U_t} = {\left[ {\frac{1}{{{h_{c,\,c1 - a}} + {h_{r,\,c1 - a}}}} + \frac{1}{{{h_{c,\,c2 - c1}} + {h_{r,\,c2 - c1}}}} + \frac{1}{{{h_{c,\,p - c2}} + {h_{r,\,p - c2}}}}} \right]^{ - 1}}$$</div>

The convection and radiation heat transfer coefficients in equation above are calculated based on temperatures at the previous time step and determined as described in the *Heat Transfer Coefficients* section.

![](EngineeringReference/media/image6522.png)

Figure 296. Thermal network diagram for ICS Solar Collector

***Collector Cover Heat Balance***

Ignoring the thermal mass of the collector cover, a steady state heat balance equations are formulated for each cover that allow us to determine cover temperatures.  The cover surface heat balance representation is shown in Figure 297 below.

![](EngineeringReference/media/image6523.png)

Figure 297. Collector Cover Surface Heat Balance

The steady state cover heat balance equation is given by:

<div>$${q_{LWR,{\kern 1pt} 1}} + {q_{CONV,{\kern 1pt} 1}} + {q_{solar,{\kern 1pt} abs}} + {q_{LWR,{\kern 1pt} 2}} + {q_{CONV,{\kern 1pt} 2}} = 0$$</div>

Linearizing the longwave radiation exchange and representing the convection terms using the classical equation for Newton’s law of cooling, the equations for the temperatures of covers 1 and 2 are given by:

<div>$${T_{c{\rm{1}}}} = \frac{{{\alpha_{c1}}{I_t} + {h_{r,{\kern 1pt} c1 - a}}{T_a} + {h_{c,{\kern 1pt} c1 - a}}{T_a} + {h_{r,{\kern 1pt} c2 - c1}}{T_{c2}} + {h_{c,{\kern 1pt} c2 - c1}}{T_{c2}}}}{{{h_{r,{\kern 1pt} c1 - a}} + {h_{c,{\kern 1pt} c1 - a}} + {h_{r,{\kern 1pt} c2 - c1}} + {h_{c,{\kern 1pt} c2 - c1}}}}$$</div>

<div>$${T_{c2}} = \frac{{{\alpha_{c2}}{I_t} + {h_{r,{\kern 1pt} c2 - c1}}{T_{c1}} + {h_{c,{\kern 1pt} c2 - c1}}{T_{c1}} + {h_{r,{\kern 1pt} p - c2}}{T_p} + {h_{c,{\kern 1pt} p - c2}}{T_p}}}{{{h_{r,{\kern 1pt} c2 - c1}} + {h_{c,{\kern 1pt} c2 - c1}} + {h_{r,{\kern 1pt} p - c2}} + {h_{c,{\kern 1pt} p - c2}}}}$$</div>

Where,

*a<sub>c</sub>*   = the weighted average solar absorptance of covers *1* and *2*, (-)

*h<sub>r,c1-a</sub>*           = adjusted radiation heat transfer coefficient between cover *1* and the ambient air, (W/m<sup>2</sup>×K)

*h<sub>c,c1-a</sub>*           = convection heat transfer coefficient between cover *1* and the ambient, (W/m<sup>2</sup>×K)

*h<sub>r,c2-c1</sub>*          = radiation heat transfer coefficient between covers *1* and *2*, (W/m<sup>2</sup>×K)

*h<sub>c,c2-c1</sub>*          = convection heat transfer coefficient between covers *1* and *2*, (W/m<sup>2</sup>×K)

*h<sub>r,p-c2</sub>*           = radiation heat transfer coefficient between covers *2* and the absorber plate, (W/m<sup>2</sup>×K)

*h<sub>c,p-c2</sub>*           = convection heat transfer coefficient between covers *2* and the absorber plate, (W/m<sup>2</sup>×K)

*q<sub>LWR,1</sub>*          = longwave radiation exchange flux on side *1* of the collector cover, (W/m<sup>2</sup>)

*q<sub>CONV,1</sub>*         = convection heat flux on side *1* of the collector cover, (W/m<sup>2</sup>)

*q<sub>LWR,2</sub>*          = longwave radiation exchange flux on side *2* of the collector cover, (W/m<sup>2</sup>)

*q<sub>CONV,2</sub>*         = convection heat flux on side *2* of the collector cover, (W/m<sup>2</sup>)

*q<sub>solar,abs</sub>*         = net solar radiation absorbed by the collector cover, (W/m<sup>2</sup>)

*R*    = thermal resistance for each section along the heat flow path, (m<sup>2</sup>K/W)

#### Other Side Condition Model

ICS Solar Collectors are commonly mounted on building heat transfer surfaces hence the collectors shade the underlying heat transfer surface and require a unique boundary condition that reflects the air cavity environment created between the bottom of the collector surface and the underlying surface. The other side condition model that allows us to estimate the other side temperature, *T<sub>osc</sub>*, can be determined based on steady state heat balance using the known collector water temperature at the previous time step.

![](EngineeringReference/media/image6527.png)

Figure 298. Illustration for Other Side Condition Model

Ignoring thermal mass of the collector bottom insulation, steady state surface heat balance can be formulated on the outer plane of the collector bottom surface facing the cavity as shown in Figure 4.  The heat balance equation on the outer plane of the collector bottom surface is given by:

<div>$${q_{cond}} + {q_{conv,{\kern 1pt} cav}} + {q_{rad,{\kern 1pt} cav}} = 0$$</div>

Substituting the equations for each term in the above equation yields:

<div>$${U_L}\left( {{T_w} - {T_{osc}}} \right) + {h_{c,{\kern 1pt} cav}}\left( {{T_{a,{\kern 1pt} cav}} - {T_{osc}}} \right) + {h_{r,{\kern 1pt} cav}}\left( {{T_{so}} - {T_{osc}}} \right) = 0$$</div>

Simplifying yields the bottom insulation other side condition temperature:

<div>$${T_{osc}} = \frac{{{U_L}{T_w} + {h_{c,{\kern 1pt} cav}}{T_{a,{\kern 1pt} cav}} + {h_{r,{\kern 1pt} cav}}{T_{so}}}}{{{U_L} + {h_{c,{\kern 1pt} cav}} + {h_{r,{\kern 1pt} cav}}}}$$</div>

The cavity air temperature is determined from cavity air heat balance as follows:

<div>$${T_{a,{\kern 1pt} cav}} = \frac{{{h_{c,{\kern 1pt} cav}}A{T_{osc}} + {{\dot m}_{vent}}Cp{T_a} + {h_{c,{\kern 1pt} cav}}A{T_{so}}}}{{{h_{c,{\kern 1pt} cav}}A + {{\dot m}_{vent}}Cp + {h_{c,{\kern 1pt} cav}}A}}$$</div>

Where

*h<sub>r,\\ cav</sub>*            = linearized radiation coefficient for underlying surface in the cavity, (W/m<sup>2</sup>×K)

*h<sub>c,\\ cav</sub>*           = convection coefficient for underlying surface in the cavity, (W/m<sup>2</sup>×K)

*T<sub>so</sub>*   = the outside face temperature of the underlying heat transfer surface, (ºC)

<span>${\dot m_{vent}}$</span>          = air mass flow rate due to natural ventilation, (kg/s)

*q<sub>cond</sub>*            = conduction heat flux though the insulation bottom and, (W/m<sup>2</sup>)

*q<sub>conv,cav</sub>*         = convection heat flux between the collector bottom outside surface and the cavity air, (W/m<sup>2</sup>)

*q<sub>rad,cav</sub>*          =          longwave radiation exchange flux between the collector bottom outside surface and the outside surface of the underlying surface, (W/m<sup>2</sup>)

The cavity air temperature is determined from the cavity air energy balance.  The air heat balance requires the ventilated cavity air natural ventilation rates.  The calculation of the ventilation rate is described else where in this document. The SurfaceProperty:ExteriorNaturalVentedCavity, object is required to describe the surface properties, the characteristics of the cavity and opening for natural ventilation.

#### Heat Transfer Coefficients

The equations used to determine for the various heat transfer coefficients in the absorber and water heat balance equations are given below. The absorbed solar energy is transferred to the water by convection.  Assuming natural convection dominated heat transfer for a hot surface facing down and a clod surface facing down the following correlation for Nusselt number by Fujii and Imura (1972).  The Nusselt number for hot surface facing down ward is given by:

<div>$$Nu = 0.56{\left( {Gr \cdot \Pr  \cdot cos{\kern 1pt} \theta } \right)^{1/5}}\quad {10^5} < Gr \cdot Pr < {10^{11}}$$</div>

The Nusselt number for hot surface upward and cold surface facing down is given by:

<div>$$Nu = 0.13{\left( {Gr \cdot \Pr } \right)^{1/3}}\quad Gr \cdot Pr < 5.0 \times {10^8}$$</div>

<div>$$Nu = 0.16{\left( {Gr \cdot \Pr } \right)^{1/3}}\quad Gr \cdot Pr > 5.0 \times {10^8}$$</div>

<div>$$Gr = {{g{\beta_{\rm{v}}}\left( {{T_p} - {T_w}} \right)L_c^3} \mathord{\left/ {\vphantom {{g{\beta_{\rm{v}}}\left( {{T_p} - {T_w}} \right)L_c^3} {{\nu ^2}}}} \right. } {{\nu ^2}}}$$</div>

<div>$$\Pr  = {\nu  \mathord{\left/ {\vphantom {\nu  \alpha }} \right. } \alpha }$$</div>

<div>$${T_r} = {T_p} - 0.25\left( {{T_p} - {T_w}} \right)$$</div>

<div>$${h_w} = {{Nu \cdot k} \mathord{\left/ {\vphantom {{Nu \cdot k} {{L_c}}}} \right. } {{L_c}}}$$</div>

Where,

<span>$\theta $</span>= angle of inclination of the collector to the vertical, radians

*g*    = gravitation force constant, 9.806 (m/s<sup>2</sup>)

*T<sub>r</sub>*   = reference properties where the thermo-physical properties are calculated, (°C)

*L<sub>c</sub>*   = characteristic length for the absorber plate, (m)

*k*    = thermal conductivity of water at reference temperature, (W/m×K)

*n*    = kinematic viscosity of water at reference temperature, (m<sup>2</sup>/s)

*a*    = thermal diffusivity of water at reference temperature, (m<sup>2</sup>/s)

*β<sub>v</sub>*   = volumetric expansion coefficient evaluated at Tv, Tv =Tw+0.25(Tp-Tw), (K-1)

*Nu*  = Nusselt number calculated for water properties at the reference temperature, (-)

*Gr*   = Grashof number calculated for water properties at the reference temperature, (-)

*Pr*   = Prandtle number calculated for water properties at the reference temperature, (-)

The various radiation and convection heat transfer coefficients are given by the following equations.  The convection heat transfer coefficients between the covers and the absorber plate are estimated from the empirical correlation for the Nusselt number for air gap between two parallel plates developed by Hollands et al. (1976) is:

<div>$$N{u_a} = 1 + 1.44\left\{ {1 - \frac{{1708{{\left( {\sin 1.8\beta } \right)}^{1.6}}}}{{Ra\cos \beta }}} \right\}{\left\{ {1 - \frac{{1708}}{{Ra\cos \beta }}} \right\}^ + } + {\left\{ {{{\left( {\frac{{Ra\cos \beta }}{{5830}}} \right)}^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 3}}\right.}\!\lower0.7ex\hbox{$3$}}}} - 1} \right\}^ + }$$</div>

<div>$${h_c} = {{Nu \cdot k} \mathord{\left/ {\vphantom {{Nu \cdot k} L}} \right. } L}$$</div>

<div>$${h_{rp - c2}} = \frac{{\sigma \left( {{T_p} + {T_{c2}}} \right)\left( {T_p^2 + T_{c2}^2} \right)}}{{1/{\varepsilon_p} + 1/{\varepsilon_{c2}} - 1}}$$</div>

<div>$${h_{rc1 - c2}} = \frac{{\sigma \left( {{T_{c1}} + {T_{c2}}} \right)\left( {T_{c1}^2 + T_{c2}^2} \right)}}{{1/{\varepsilon_{c1}} + 1/{\varepsilon_{c2}} - 1}}$$</div>

The long wave radiation exchange coefficients between the outer collector cover and the sky and ground referencing the ambient air temperature for mathematical simplification are given.

<div>$${h_{rc1 - s}} = \frac{{{F_s}{\varepsilon_{c1}}\sigma \left( {{T_{c1}} + {T_s}} \right)\left( {T_{c1}^2 + T_s^2} \right)\left( {{T_{c1}} - {T_s}} \right)}}{{\left( {{T_{c1}} - {T_a}} \right)}}$$</div>

<div>$${h_{rc1 - g}} = \frac{{{F_g}{\varepsilon_{c1}}\sigma \left( {{T_{c1}} + {T_g}} \right)\left( {T_{c1}^2 + T_g^2} \right)\left( {{T_{c1}} - {T_g}} \right)}}{{\left( {{T_{c1}} - {T_a}} \right)}}$$</div>

<div>$${h_{cc1 - a}} = {h_{cc1 - s}} + {h_{cc1 - g}}$$</div>

The convection heat transfer coefficient from the outer cover to the surrounding air is given by:

<div>$${h_{cc1 - a}} = 2.8 + 3.0{V_w}$$</div>

When the bottom surface boundary condition is AmbientAir, the combined conductance from the outer cover to the surrounding is calculated from the equation below (Duffie and Beckman, 1991).

<div>$${h_{comb}} = 5.7 + 3.8{V_w}$$</div>

The overall loss coefficient through the bottom and side of the collector-storage is estimated as follows:

<div>$${U_b} = {U_{Lb}}\left( {{A_b}/A} \right)$$</div>

<div>$${U_s} = {\left[ {\frac{1}{{{U_{Ls}}\left( {{A_s}/A} \right)}} + \frac{1}{{{h_{comb}}}}} \right]^{ - 1}}$$</div>

Where,

*e<sub>c1</sub>*   = thermal emissivity of collector cover *1*, (-)

*e<sub>c2</sub>*   = thermal emissivity of collector cover *2*, (-)

*F<sub>s</sub>*   = view factor from the collector to the sky, (-)

*F<sub>g</sub>*   = view factor from the collector to the ground, (-)

*T<sub>c1</sub>* = temperature of collector cover *1*, (K)

*T<sub>c2</sub>* = temperature of collector cover *2*, (K)

*T<sub>s</sub>*   = sky temperature, (K)

*T<sub>g</sub>*   = ground temperature, (K)

*k*    = thermal conductivity of air, (W/m K)

*L*    = air gap between the covers, (m)

*β*    = inclination of the plates or covers to the horizontal, (radian)

*V<sub>w</sub>* = wind speed, (m/s)

*U<sub>Lb</sub>*  = user specified bottom heat loss conductance, W/m<sup>2</sup>×K

*U<sub>Ls</sub>*  = user specified side heat loss conductance, W/m<sup>2</sup>×K

*A<sub>b</sub>*   = collector bottom heat transfer area, m<sup>2</sup>

*A<sub>s</sub>*   = collector side area, m<sup>2</sup>

*h<sub>comb</sub>*            = combined conductance from the outer cover to the ambient air, W/m<sup>2</sup>×K

***Transmittance-Absorptance Product***

The transmittance-absorptance product of solar collector is determined using ray tracing method for any incident angle (Duffie and Beckman, 1991).  This requires optical properties of the cover and absorber materials and the the transmittance-absorptance product for any incident angle is given by:

<div>$${\left( {\tau \alpha } \right)_\theta } = \frac{{\tau \alpha }}{{1 - \left( {1 - \alpha } \right){\rho_d}}}$$</div>

The transmittance of the cover system for single and two cover are given by:

<div>$$\tau  = \frac{1}{2}\left[ {{{\left( {\frac{{{\tau_1} \cdot {\tau_2}}}{{1 - {\rho_1}{\rho_2}}}} \right)}_ \bot } + {{\left( {\frac{{{\tau_1} \cdot {\tau_2}}}{{1 - {\rho_1}{\rho_2}}}} \right)}_\parallel }} \right]$$</div>

<div>$$\rho  = \frac{1}{2}\left[ {{{\left( {{\rho_1} + \frac{{\tau  \cdot {\rho_2} \cdot {\tau_1}}}{{{\tau_2}}}} \right)}_ \bot } + {{\left( {{\rho_1} + \frac{{\tau  \cdot {\rho_2} \cdot {\tau_1}}}{{{\tau_2}}}} \right)}_\parallel }} \right]$$</div>

The effective transmittance, reflectance and absorptance of a single cover are given by:

<div>$$\tau  = \frac{{{\tau_a}}}{2}\left\{ {\frac{{1 - {r_ \bot }}}{{1 + {r_ \bot }}}\left[ {\frac{{1 - r_ \bot ^2}}{{1 - {{\left( {{r_ \bot }{\tau_a}} \right)}^2}}}} \right] + \frac{{1 - {r_\parallel }}}{{1 + {r_\parallel }}}\left[ {\frac{{1 - r_\parallel ^2}}{{1 - {{\left( {{r_\parallel }{\tau_a}} \right)}^2}}}} \right]} \right\}$$</div>

<div>$$\rho  = \frac{1}{2}\left\{ {\left[ {{r_ \bot } + \frac{{{{\left( {1 - {r_ \bot }} \right)}^2}\tau_a^2{r_ \bot }}}{{1 - {{\left( {{r_ \bot }{\tau_a}} \right)}^2}}}} \right] + \left[ {{r_\parallel } + \frac{{{{\left( {1 - {r_\parallel }} \right)}^2}\tau_a^2{r_\parallel }}}{{1 - {{\left( {{r_\parallel }{\tau_a}} \right)}^2}}}} \right]} \right\}$$</div>

<div>$$\alpha  = \frac{{\left( {1 - {\tau_a}} \right)}}{2}\left\{ {\left( {\frac{{1 - {r_ \bot }}}{{1 - {r_ \bot }{\tau_a}}}} \right) + \left( {\frac{{1 - {r_\parallel }}}{{1 - {r_\parallel }{\tau_a}}}} \right)} \right\}$$</div>

The transmittance of the cover system with absorption only considered *t*<sub>a</sub>, is defined as:

<div>$${\tau_a} = \exp \left( { - \frac{{KL}}{{\cos \,{\theta_2}}}} \right)$$</div>

<div>$${\theta_2} = {\sin ^{ - 1}}\left( {\sin {\theta_1} \cdot \frac{{{n_1}}}{{{n_2}}}} \right)$$</div>

The reflectance of un-polarized radiation on passing from medium 1 with reflective index *n*<sub>1</sub> to medium 2 with reflective index *n*<sub>2</sub> is given by:

 <span>${r_ \bot } = \frac{{{{\sin }^2}\left( {{\theta_2} - {\theta_1}} \right)}}{{{{\sin }^2}\left( {{\theta_2} + {\theta_1}} \right)}}$</span>

<div>$${r_\parallel } = \frac{{{{\tan }^2}\left( {{\theta_2} - {\theta_1}} \right)}}{{{{\tan }^2}\left( {{\theta_2} + {\theta_1}} \right)}}$$</div>

The sky and ground reflected diffuse radiations average equivalent incident angles are approximated by Brandemuehl and Beckman correlation (Duffie and Beckman, 1991) as follows:

<div>$${\theta_{sd}} = 59.68 - 0.1388\beta  + 0.001497{\beta ^2}$$</div>

<div>$${\theta_{gd}} = 90 - 0.5788\beta  + 0.002693{\beta ^2}$$</div>

where,

*t*     = transmittance of the cover system, (-)

*t*<sub>1</sub>    = transmittance of the cover 1, (-)

*t*<sub>2</sub>    = transmittance of the cover 2, (-)

*a*    = absorptance of the absorber plate, (-)

*r*<sub>d</sub>    = diffuse reflectance of the inner cover, (-)

*L*    = thickness of a cover material, (m)

*K*    = extinction coefficient of a cover material, (m<sup>-1</sup>)

*q*<sub>1</sub>   = angle of incidence, degree

*q*<sub>2</sub>    = angle of refraction, degree

<span>${r_ \bot }$</span>  = parallel component of reflected un-polarized radiation, (-)

<span>${r_\parallel }$</span>   = perpendicular component of reflected un-polarized radiation, (-)

*b*    = slope of the collector, degree

*q*<sub>sd</sub> = equivalent incident angle for sky diffuse solar radiation, degree

*q*<sub>gd</sub>  = equivalent incident angle for ground diffuse solar radiation, degree

The integral collector storage unit thermal performance parameters are calculated as follows:

<div>$${Q_{delivered}} = {\dot m_w}{C_w}\left( {{T_w} - {T_{wi}}} \right)$$</div>

<div>$${Q_{Stored}} = {m_w}{C_w}\frac{{d{T_w}}}{{dt}}$$</div>

<div>$${Q_{SkinLoss}} = A \cdot \left[ {{U_t}\left( {{T_p} - {T_w}} \right) + {U_b}\left( {{T_w} - {T_{OSC}}} \right) + {U_s}\left( {{T_w} - {T_a}} \right)} \right]$$</div>

<div>$${\eta_{thermal}} = \frac{{{m_w}{C_w}\frac{{d{T_w}}}{{dt}} + {{\dot m}_w}{C_w}\left( {{T_w} - {T_{wi}}} \right)}}{{A \cdot {I_t}}}$$</div>

### References:

Duffie, J.A., and W.A. Beckman. 1991. *Solar Engineering of Thermal Processes,* 2d ed. New York: John Wiley & Sons.

Kumar, R. and M.A. Rosen. Thermal performance of integrated collector storage solar water heater with corrugated absorber surface. Applied Thermal Engineering:  30 (2010) 1764–1768.

Fujii, T., and H. Imura. Natural convection heat transfer from aplate with arbitrary inclination. International Journal of Heat and Mass Transfer: 15(4), (1972), 755-764.

### Photovoltaic Thermal Flat-Plate Solar Collectors

Photovoltaic-Thermal solar collectors (PVT) combine solar electric cells and thermal working fluid to collect both electricity and heat.  Athough there are currently comparatively few commercial products, PVT research has been conducted for the past 30 years and many different types of collectors have been studied.  Zondag (2008) and Charalambous et. al (2007) provide reviews of the PVT literature.  Because PVT is much less commercially-mature, there are no standards or rating systems such as for thermal-only, hot-water collectors.  EnergyPlus currently has one simple model based on user-defined efficiencies but a more detailed model based on first-principles and a detailed, layer-by-layer description is under development.

The PVT models reuse the PV models for electrical production. These are described elsewhere in this document in the section on Photovoltaic Arrays-Simple Model

#### Simple PVT Thermal Model

The input object SolarCollector:FlatPlate:PhotovoltaicThermal provides a simple PVT model that is provided for quick use during design or policy studies.  The user simply provides values for a thermal efficiency and the incident solar heats the working fuild.  The model also includes a cooling mode for air-based systems where a user-provided surface emmittance is used to model cooling of the working fluid to the night sky (water-based cooling will be made available once a chilled water storage tank is available).  No other details of the PVT collector’s construction are required as input data.

The simple model can heat either air or liquid.  If it heats air, then the PVT is part of HVAC air system loop with air nodes connected to an air system.  If it heats liquid, then the PVT is part of plant loop with nodes connected to a plant loop and the plant operating scheme determines flows.

Air-system-based PVT modeling include a modulating bypass damper arrangement.  Control logic decides if the air should bypass the collector to better meet setpoint.  The model requires a drybulb temperature setpoint be placed on the outlet node.  The model assume the collector is intended and available for heating when the incident solar is greater than 0.3 W/m<sup>2</sup> and otherwise it is intended for cooling.  The inlet temperature is compare to the setpoint on the outlet node to determine if cooling or heating are beneficial.  If they are, then the PVT thermal models are applied to condition the air stream.  If they are not beneficial, then the PVT is completely bypassed and the inlet node is passed directly to the outlet node to model a completely bypassed damper arrangement.  A report variable is available for bypass damper status.

Plant-based PVT do not include a bypass (although one could be used in the plant loop).  The collector requests its design flow rate but it otherwise relies on the larger plant loop for control.

When the PVT themal collector is controlled to be “on,” in heating mode, and working fluid is flowing, the model calculates the outlet temperature based on the inlet temperature and the collected heat using the following equations.

<div>$${Q_{therm}} = {A_{surf}} \cdot {f_{activ}} \cdot {G_T} \cdot {\eta_{thermal}}$$</div>

where,

<span>${Q_{therm}}$</span> is the thermal energy collected [W]

<span>${A_{surf}}$</span> is the net area of the surface [m<sup>2</sup>]

<span>${f_{activ}}$</span>is the fraction of surface aire with active PV/T collector, and

<span>${\eta_{thermal}}$</span>is the thermal conversion efficiency.

<div>$${T_{out}} = {T_{in}} + \frac{{{Q_{therm}}}}{{\dot m{c_p}}}$$</div>

where,

<span>${T_{out}}$</span> is the temperature of the working fluid leaving the PV/T

<span>${T_{in}}$</span> is the temperature of the working fluid entering the PV/T

<span>$\dot m$</span> is the entire mass flow of the working fluid through the PV/T

<span>${c_p}$</span> is the specific heat of the working fluid.

For air-based systems, the value of <span>${T_{out}}$</span>is then compared to the temperature setpoint on the outlet node.  If <span>${T_{out}}$</span> exceeds the desired outlet temperature, <span>${T_{set,out}}$</span>,then a bypass fraction is calculated to model a modulating bypass damper using:

<div>$${f_{bypass}} = \frac{{\left( {{T_{set,out}} - {T_{out}}} \right)}}{{\left( {{T_{in}} - {T_{out}}} \right)}}$$</div>

When the PVT themal collector is controlled to be “on,” in cooling mode, and working fluid is flowing, the model calculates the outlet temperature based on the inlet temperature and the heat radiated and convected to the ambient using a heat balance on the outside face of the collector:

<div>$$\dot m{c_p}\left( {{T_{in}} - {T_{out}}} \right) = {\dot Q_{LWR}} + {\dot Q_{conv}}$$</div>

Where,

<span>${\dot Q_{LWR}}$</span> is the net rate of long wavelength (thermal) radiation exchange with the air, night sky, and ground.  See the section “External Longwave Radiation” in the Outside Surface Heat Balance, for full discussion of how this modeled in EnergyPlus using linearized radiation coefficients.

<span>${\dot Q_{conv}}$</span> is the net rate of convective flux exchange with outdoor air. See the section “Exterior/External Convection” in the Outside Surface Heat Balance, for full discussion of how this modeled in EnergyPlus.  The surface roughness is assumed to be “very smooth.”

The simple model assumes that the effective collector temperature, <span>${T_{col}}$</span>, is the average of the working fluid inlet and outlet temperatures so that we can make the following substitution:

<div>$${T_{out}} = 2{T_{col}} - {T_{in}}$$</div>

Substituting and solving for <span>${T_{col}}$</span> we obtain the following model for collector temperatures during a (possible) cooling process :

<div>$${T_{col}} = \frac{{2\dot m{c_p}{T_{in}} + {A_{surf}}{f_{activ}}\left( {{h_{r,gnd}}{T_{gnd}} + {h_{r,sky}}{T_{sky}} + {h_{r,air}}{T_{air}} + {h_{c,ext}}{T_{air}}} \right)}}{{2\dot m{c_p} + {A_{surf}}{f_{activ}}\left( {{h_{r,gnd}} + {h_{r,sky}} + {h_{r,air}} + {h_{c,ext}}} \right)}}$$</div>

Then the outlet temperature can be calculated and heat losses determined.  However, the model allows only sensible cooling of the air stream and limits the outlet temperature to not go below the dewpoint temperature of the inlet.

PVT collectors have a design volume flow rate for the working fluid that is autosizable.  For air-based systems used as pre-conditioners, the volume flow rate is sized to meet the maximum outdoor air flow rate.  For water-based systems on the supply side of a plant loop, each of the PVT collectors are sized to the overall loop flow rate.  For water-based systems on the demand side of a plant loop, the collectors are sized using a rule-of-thumb for typical flow rates per unit of collector area.  This rule-of-thumb is based on a constant factor of 1.905x10<sup>-5</sup> m<sup>3</sup>/s-m<sup>2</sup> that was developed by analyzing SRCC data set for conventional solar collectors (see data set SolarCollectors.idf) and averaging the ratio for all 171 different collectors.

#### References

Charalambous, P.G., Maidment, G.G., Kalagirou, S.A., and Yiakoumetti, K., Photovoltaic thermal (PV/T) collectors: A review. Applied Thermal Engineering 27 (2007) 275-286.

Zondag, H.A. 2008. Flat-plate PV-Thermal collectors and systems: A review.  Renewable and Sustainable Energy Reviews 12 (2008) 891-959.

### Unglazed Transpired Solar Collectors

The input object SolarCollector:UnglazedTranspired provides a model for transpired collectors that are perhaps one of the most efficient ways to collect solar energy with demonstrated instantaneous efficiencies of over 90% and average efficiencies of over 70%.  They are used for preheating outdoor air needed for ventilation and processes such as crop drying.

In EnergyPlus, an unglazed transpired solar collector (UTSC) is modeled as a special component attached to the outside face of a heat transfer surface that is also connected to the outdoor air path.  A UTSC affects both the thermal envelope and the HVAC air system.  From the air system’s point of view, a UTSC is heat exchanger and the modeling needs to determine how much the device raises the temperature of the outdoor air.  From the thermal envelope’s point of view, the presence of the collector on the outside of the surface modifies the conditions experienced by the underlying heat transfer surfaces.  EnergyPlus models building performance throughout the year and the UTSC will often be “off” in terms of forced airflow, but the collector is still present.  When the UTSC is “on” there is suction airflow that is assumed to be uniform across the face.  When the UTSC is “off” the collector acts as a radiation and convection baffle situated between the exterior environment and the outside face of the underlying heat transfer surface.  We distinguish these two modes of operation as *active* or *passive* and model the UTSC component differently depending on which of these modes it is in.

#### Heat Exchanger Effectiveness

The perforated absorber plate is treated as a heat exchanger and modeled using a traditional effectiveness formulation.  The heat exchanger effectiveness, <span>${\varepsilon_{HX}}$</span>, is determined from correlations derived from small-scale experiments.  Two correlations available in the literature are implemented in EnergyPlus.  The first is based on research by Kutscher at the National Renewable Energy Laboratory. The second is based on the research by Van Decker, Hollands, and Brunger at the University of Waterloo.  Because both correlations are considered valid, the choice of which correlation to use is left to the user.



#### Kutscher Correlation

Kutscher’s (1994) correlation encompasses surface convection between the collector and the incoming outdoor air stream that occurs on the front face, in the holes, and along the back face of the collector. The correlation uses a Reynolds number based on the hole diameter as a length scale and the mean velocity of air as it passes through the holes as the velocity scale:

<div>$${{\mathop{\rm Re}\nolimits}_D} = \frac{{{V_h}D}}{\nu }$$</div>

where,

      <span>${V_h}$</span> is the velocity through the holes [m/s]

      <span>$D$</span> is the hole diameter [m]

      <span>$\nu $</span> is the kinematic viscosity of air  [m<sup>2</sup>/s]

The correlation is a function of Reynolds number, hole geometry, the free stream air velocity, and velocity through the holes:

<div>$$N{u_D} = 2.75\left[ {{{\left( {\frac{P}{D}} \right)}^{ - 1.2}}{\mathop{\rm Re}\nolimits}_D^{0.43} + 0.011\sigma {{{\mathop{\rm Re}\nolimits} }_D}{{\left( {\frac{{{U_\infty }}}{{{V_h}}}} \right)}^{0.48}}} \right]$$</div>

where,

      <span>$P$</span> is the pitch, or distance between holes, [m],

      <span>$D$</span> is the diameter of the holes, [m],

      <span>$\sigma $</span> is the porosity, or area fraction of the holes, [dimensionless],

      <span>${V_h}$</span> is the mean velocity of air passing through the holes, [m/s],

      <span>${U_\infty }$</span> is the free stream velocity (local wind speed) [m/s].

The Nusselt number is formulated as:

<div>$$N{u_D} = \frac{{U\;D}}{k}$$</div>

where,

      <span>$U$</span>is the overall heat transfer coefficient based on log mean temperature difference, [W/m<sup>2</sup>·K], and

      <span>$k$</span> is the thermal conductivity of air [W/m·K].

The heat exchanger effectiveness is:

<div>$${\varepsilon_{HX}} = 1 - {e^{\left[ { - \frac{{U\,A}}{{\dot m\,{c_p}}}} \right]}}$$</div>

Kutscher’s relation was formulated for triangular hole layout, but based on Van Decker et al. (2001) we allow using the correlation for square hole layout and scale <span>$P$</span> by a factor of 1.6.

#### Van Decker, Hollands, and Brunger Correlation

Van Decker et. al. extended Kutscher’s measurements to include a wider range of collector parameters including plate thickness, pitch, suction velocities, and square hole patterns.  Their model formulation differs from Kutscher’s in that the model was built up from separate effectiveness models for the front, back, and holes of the collector.  Their published correlation is:

<div>$${\varepsilon_{HX}} = \left[ {1 - \left( {1 + {{{\mathop{\rm Re}\nolimits} }_s}Max{{\left( {1.733{\mathop{\rm Re}\nolimits}_w^{ - {\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 2}}\right.}\!\lower0.7ex\hbox{$2$}}},0.02136} \right)}^{ - 1}}} \right)} \right] \times \left[ {1 - {{\left( {1 + 0.2273{\mathop{\rm Re}\nolimits}_b^{{\raise0.7ex\hbox{$1$} \!\mathord{\left/ {\vphantom {1 2}}\right.}\!\lower0.7ex\hbox{$2$}}}} \right)}^{ - 1}}} \right] \times {e^{\left( { - 0.01895\frac{P}{D} - \frac{{20.62}}{{{{{\mathop{\rm Re}\nolimits} }_D}}}\frac{t}{D}} \right)}}$$</div>

where,

      <span>${{\mathop{\rm Re}\nolimits}_s} = \frac{{{V_s}P}}{v}$</span>

      <span>${{\mathop{\rm Re}\nolimits}_w} = \frac{{{U_\infty }P}}{v}$</span>

      <span>${{\mathop{\rm Re}\nolimits}_b} = \frac{{{V_h}P}}{v}$</span>

      <span>${V_s}$</span> is the average suction velocity across the front face of the collector [m/s]

      <span>$t$</span> is the collector plate thickness



#### Heat Exchanger Leaving Temperature

Using either of the correlations above allows determining the heat exchanger effectiveness from known values.  By definition the heat exchanger effectiveness is also:

<div>$${\varepsilon_{HX}} = \frac{{{T_{a,HX}} - {T_{amb}}}}{{{T_{s,coll}} - {T_{amb}}}}$$</div>

where,

      <span>${T_{{\rm{a,HX}}}}$</span> is the temperature of the air leaving the collector and entering the plenum [ºC]

      <span>${T_{s,coll}}$</span> is the temperature of the collector’s absorber plate, [ºC], and

      <span>${T_{amb}}$</span> is the temperature of the ambient outdoor air [ºC].

By rewriting equation to solve for <span>${T_{{\rm{a,HX}}}}$</span> we see that the temperature of the heated outdoor air entering the plenum can be determined once the collector surface temperature is known,

<div>$${T_{a,HX}} = {\varepsilon_{HX}}{T_{s,coll}} + \left( {1 - {\varepsilon_{HX}}} \right){T_{amb}}$$</div>

#### Collector Heat Balance

The collector is assumed to be sufficiently thin and high-conductivity so that it can be modeled using a single temperature (for both sides and along its area).  This temperature <span>${T_{s,coll}}$</span>is determined by formulating a heat balance on a control volume that just encapsulates the collector surface.  The heat balances are formulated separately for active and passive modes and are diagrammed in the following figure.

Observe that for the passive case, we do not use the heat exchanger relations to directly model the interaction of ventilating air with the collector.  This is because these relations are considered to not apply when the UTSC is in passive mode.  They were developed for uni-directional flow (rather than the balanced-in-and-out flow expected from natural forces) and for specific ranges of suction face velocity.  Therefore, this heat transfer mechanism is handled using classical surface convection models (as if the collector was not perforated).  (Air exchanges are modeled as ventilation in the plenum air heat balance but do not interact with the hole edges in the collector surface.)

![](EngineeringReference/media/image6620.png)

Figure 299.  Transpired Collector Heat Balance

When the UTSC is active, the heat balance on the collector surface control volume is:

<div>$${q''_{\alpha sol}} + {q''_{LWR,Env}} + {q''_{conv,wind}} - {q''_{HX}} + {q''_{LWR,plen}} + {q''_{source}} = 0$$</div>

where:

<sub><span>${q''_{\alpha sol}}$</span> </sub>is absorbed direct and diffuse solar (short wavelength) radiation heat flux.

<span>${q''_{LWR,Env}}$</span> is net long wavelength (thermal) radiation flux exchange with the air and surroundings.

<span>${q''_{conv,wind}}$</span> is surface convection flux exchange with outdoor air under high wind and rain conditions.  Note that this term is usually assumed to be zero in UTSC model development but we add the term to allow for deteriorated performance of the UTSC under poor conditions.

<sub><span>${q''_{HX}}$</span> </sub> is heat exchanger flux from collector to incoming outdoor air.

<sub><span>${q''_{LWR,plen}}$</span> </sub>is net long wavelength (thermal) radiation flux exchange with the outside face of the underlying surface(s).

<span>${q''_{source}}$</span> is a source/sink term that accounts for energy exported out of the control volume when the collecter’s absorber plate is a hybrid device such as a photovoltaic panel.

While the heat balance on the passive collector surface control volume is:

<div>$${q''_{\alpha sol}} + {q''_{LWR,Env}} + {q''_{conv,Env}} + {q''_{LWR,plen}} + {q''_{conv,plen}} + {q''_{source}} = 0$$</div>

where:

<sub><span>${q''_{conv,Env}}$</span> </sub>= surface convection flux exchange with outdoor air.

<sub><span>${q''_{conv,plen}}$</span> </sub>= surface convection flux exchange with plenum air.

All terms are positive for net flux to the collector except the heat exchanger term, which is taken to be positive in the direction from collector to incoming air stream.  Each of these heat balance components is introduced briefly below.

#### External SW Radiation

<sub><span>${q''_{\alpha sol}}$</span> </sub> is calculated using procedures presented elsewhere in this manual and includes both direct and diffuse incident solar radiation absorbed by the surface face.  This is influenced by location, surface facing angle and tilt, shading surfaces, surface face material properties, weather conditions, etc.

#### External LW Radiation

<span>${q''_{LWR,Env}}$</span> is a standard radiation exchange formulation between the surface, the sky, the ground, and the atmosphere.  The radiation heat flux is calculated from the surface absorptivity, surface temperature, sky, air, and ground temperatures, and sky and ground view factors.  Radiation is modeled using linearized coefficients.

#### External Convection

<sub><span>${q''_{conv,Env}}$</span> </sub>is modeled using the classical formulation: <span>${q''_{conv}}$</span> <sub> </sub>= h<sub>co</sub>(T<sub>air</sub> - T<sub>o</sub>) where h<sub>co</sub>, is the convection coefficient.  This coefficient will differ depending on whether or not the UTSC is active or passive.  When the UTSC is passive, h<sub>co</sub> is treated in the same way as an outside face with ExteriorEnvironment conditions.  When the UTSC is active, the special suction airflow situation of a transpired collector during operation means that h<sub>co</sub> is often zero because the suction situation can eliminate mass transport away from the collector.  However when the winds are high, the strong turbulence and highly varying pressures can cause the suction flow situation to breakdown.  Therefore, we include the <span>${q''_{conv,wind}}$</span> term in the heat balance and use a special coefficient <span>${h_{c,wind}}$</span> to model this lost heat transfer.  In addition, when it is raining outside, we assume the collector gets wet and model the enhanced surface heat transfer using a large value for <span>${h_{c,wind}}$</span>.

#### Heat Exchanger

<sub><span>${q''_{HX}}$</span> </sub>is modeled using the classical formulation <span>${q''_{HX}} = \frac{{\dot m{c_p}({T_{a,HX}} - {T_{amb}})}}{A}$</span><sub> </sub>where <span>${T_{{\rm{a,HX}}}}$</span> is determined using correlations described above.  When the UTSC is active, the air mass flow is determined from the operation of the outdoor air mixer component.  When the UTSC is off, this term is zero.

#### Plenum LW Radation

<span>${q''_{LWR,plen}}$</span>is a standard radiation exchange formulation between the collector surface and the underlying heat transfer surface located across the plenum.  Radiation is modeled using linearized coefficients.

#### Plenum Convection

<sub><span>${q''_{conv,plen}}$</span> </sub>is modeled using the classical formulation: <span>${q''_{conv}}$</span> <sub> </sub>= h<sub>cp</sub>(T<sub>air</sub> - T<sub>o</sub>) where h<sub>cp</sub>, is the convection coefficient.  This coefficient is taken as zero when the UTSC is operating because of the suction airflow situation.  When the UTSC is off, the value for h<sub>cp</sub> is obtained from correlations used for window gaps from ISO (2003) standard 15099.

Substituting models into and solving for <span>${T_{s,coll}}$</span> yields the following equation when the UTSC is active (“on”):



<div>$${T_{s,coll}} = \frac{{\left( {{I_s}\alpha  + {h_{r,atm}}{T_{amb}} + {h_{r,sky}}{T_{sky}} + {h_{r,gnd}}{T_{amb}} + {h_{r,plen}}{T_{so}} + {h_{c,wind}}{T_{amb}} + \frac{{\dot m{c_p}}}{A}{T_{amb}} - \frac{{\dot m{c_p}}}{A}\left( {1 - {\varepsilon_{HX}}} \right){T_{amb}} + {{q''}_{source}}} \right)}}{{\left( {{h_{r,atm}} + {h_{r,sky}} + {h_{r,gnd}} + {h_{r,plen}} + {h_{c,wind}} + \frac{{\dot m{c_p}}}{A}{\varepsilon_{HX}}} \right)}}$$</div>

and substituting into yields the following equation when the UTSC is passive (“off”):

<div>$${T_{s,coll}} = \frac{{\left( {{I_s}\alpha  + {h_{co}}{T_{amb}} + {h_{r,atm}}{T_{amb}} + {h_{r,sky}}{T_{sky}} + {h_{r,gnd}}{T_{amb}} + {h_{r,plen}}{T_{so}} + {h_{c,plen}}{T_{a,plen}} + {{q''}_{source}}} \right)}}{{\left( {{h_{co}} + {h_{r,air}} + {h_{r,sky}} + {h_{r,gnd}} + {h_{r,plen}} + {h_{c,plen}}} \right)}}$$</div>

where,

      <span>${I_s}$</span> is the incident solar radiation of all types [W/m<sup>2</sup>],

      <span>$\alpha $</span> is the solar absorptivity of the collector [dimensionless],

      <span>${h_{r,atm}}$</span>is the linearized radiation coefficient for the surrounding atmosphere [W/m<sup>2</sup>·K],

      <span>${T_{amb}}$</span> is the outdoor drybulb from the weather data, also assumed for ground surface [ºC],

      <span>${h_{r,sky}}$</span> is the linearized radiation coefficient for the sky [W/m<sup>2</sup>·K],

      <span>${T_{sky}}$</span> is the effective sky temperature [ºC],

      <span>${h_{r,gnd}}$</span> is the linearized radiation coefficient for the ground [W/m<sup>2</sup>·K],

      <span>${h_{r,plen}}$</span> is the linearized radiation coefficient for the underlying surface [W/m<sup>2</sup>·K],

      <span>${h_{c,wind}}$</span> is the convection coefficient for the outdoor environment when the UTSC is active and winds are high or it is raining [W/m<sup>2</sup>·K],

      <span>${T_{so}}$</span> is the temperature of the outside face of the underlying heat transfer surface [ºC],

      <span>$\dot m$</span> is the air mass flow rate when in active mode [kg/s],

      <span>${c_p}$</span> is the specific heat of air at constant pressure [J/kg·K],

      <span>$A$</span> is the area of the collector [m<sup>2</sup>],

      <span>${h_{co}}$</span> is the convection coefficient for the outdoor environment [W/m<sup>2</sup>·K],

      <span>${h_{c,plen}}$</span> is the convection coefficient for the surfaces facing the plenum [W/m<sup>2</sup>·K], and

      <span>${T_{a,plen}}$</span> is the air drybulb for air in the plenum and entering the outdoor air system [ºC].



#### Plenum Heat Balance

The *plenum* is the volume of air located between the collector and the underlying heat transfer surface.  The plenum air is modeled as well-mixed.  The uniform temperature of the plenum air, <span>${T_{a,plen}}$</span>, is determined by formulating a heat balance on a control volume of air as diagrammed below.

Note that we have formulated the control volumes with slight differences for the active and passive cases.  For the active case, the suction air situation and heat exchanger effectiveness formulations dictate that the collector surface control volume encompass part of the air adjacent to both the front and back surfaces of the collector.  However for the passive case, the collector surface control volume has no air in it and the plenum air control volume extends all the way to the surface of the collector. 



![](EngineeringReference/media/image6664.png)

Figure 300.  Transpired Collector Plenum Air Heat Balance



When the UTSC is active, the heat balance on the plenum air control volume is:

<div>$${\dot Q_{air}} + {\dot Q_{co}}_{} = 0$$</div>

where,

<span>${\dot Q_{air}}$</span>is the net rate of energy added by suction air convecting through the control volume.

<sub><span>${\dot Q_{co}}$</span> </sub> is the net rate of energy added by surface convection heat transfer with the underlying surface.



When the UTSC is passive, the heat balance on the plenum air control volume is:

<div>$${\dot Q_{vent}} + {\dot Q_{co}} + {\dot Q_{c,coll}} = 0$$</div>

where,

      <span>${\dot Q_{vent}}$</span> is the net rate of energy added from infiltration – where outdoor ambient air exchanges with the plenum air.

      <span>${\dot Q_{c,coll}}$</span>is the net rate of energy added by surface convection heat transfer with the collector.



Substituting into and solving for <span>${T_{a,plen}}$</span> yields the following equation for when the UTSC is active:

<div>$${T_{a,plen}} = \frac{{\left( {\dot m{c_p}{T_{a,HX}} + {h_{c,plen}}A\,{T_{so}}} \right)}}{{\left( {\dot m{c_p} + {h_{c,plen}}A} \right)}}$$</div>

And substituting into yields the following equation when the UTSC is passive:

<div>$${T_{a,plen}} = \frac{{\left( {{h_{c,plen}}A\,{T_{so}} + {{\dot m}_{vent}}{c_p}{T_{amb}} + {h_{c,plen}}A\,{T_{s,coll}}} \right)}}{{\left( {{h_{c,plen}}A + {{\dot m}_{vent}}{c_p} + {h_{c,plen}}A} \right)}}$$</div>

where,

      <span>${\dot m_{vent}}$</span> is the air mass flow from natural forces [kg/s]

The literature on UTSC does not appear to address the passive mode of operation and no models for <span>${\dot m_{vent}}$</span> have been identified.  Nevertheless, natural buoyancy and wind forces are expected to drive air exchange between the plenum and ambient and some method of modeling <span>${\dot m_{vent}}$</span> is needed.  Reasoning that the configuration is similar to single-side natural ventilation, we elect to use correlations for natural ventilation presented in Chapter 26. of ASHRAE HOF (2001).



<div>$${\dot m_{vent}} = \rho \,{{\rm{\rlap{--} \dot V}}_{{\rm{tot}}}}$$</div>

where,

      <span>$\rho $</span> is the density of air [kg/m<sup>3</sup>], and

      <span>${{\rm{\rlap{--} \dot V}}_{{\rm{tot}}}} = {{\rm{\rlap{--} \dot V}}_{{\rm{wind}}}} + \,{{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}}$</span> is the total volumetric flow rate of air ventilating in and out of the plenum.



<div>$${{\rm{\rlap{--} \dot V}}_{{\rm{wind}}}} = {C_v}{A_{in}}{U_\infty }$$</div>

<span>${{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}} = {C_D}{A_{in}}\sqrt {2g\Delta {H_{NPL}}\left( {{T_{a,plen}} - {T_{amb}}} \right)/{T_{a,plen}}} $</span>  (if <span>${T_{a,plen}} > {T_{amb}}$</span>)

<span>${{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}} = {C_D}{A_{in}}\sqrt {2g\Delta {H_{NPL}}\left( {{T_{amb}} - {T_{a,plen}}} \right)/{T_{amb}}} $</span>  (if <span>${T_{amb}} > {T_{a,plen}}$</span> and UTSC vertical)

<span>${C_v}$</span> is the effectiveness of the openings that depends on opening geometry and the orientation with respect to the wind.  ASHRAE HoF (2001) indicates values ranging from 0.25 to 0.6.  In the UTSC model, this value is available for user input and defaulted to 0.25.

<span>${C_D}$</span> is the discharge coefficient for the opening and depends on opening geometry.  In the UTSC model, this value is available for user input and defaulted to 0.65.

Mass continuity arguments lead to modeling the area of the openings as one half of the total area of the holes, so we have:

<div>$${A_{in}} = \frac{{A\,\sigma }}{2}$$</div>

<span>$g$</span> is the gravitational constant taken as 9.81 [m/s<sup>2</sup>].

<span>$\Delta {H_{NPL}}$</span> is the height from midpoint of lower opening to the Neutral Pressure Level.  This is taken as one-fourth the overall height of the UTSC if it is mounted vertically.  For tilted collectors, the nominal height is modified by the sine of the tilt.  If the UTSC is mounted horizontally (e.g. on the roof) then the <span>$\Delta {H_{NPL}}$</span> is taken as the gap thickness of the plenum.

If the UTSC is horizontal and <span>${T_{amb}} > {T_{a,plen}}$</span> then <span>${{\rm{\rlap{--} \dot V}}_{{\rm{thermal}}}}{\rm{  =  0}}$</span> because this is a stable situation.

#### Underlying Heat Transfer Surface

The UTSC is applied to the outside of a heat transfer surface.  This surface is modeled using the usual EnergyPlus methods for handling heat capacity and transients – typically the CTF method.  These native EnergyPlus Heat Balance routines are used to calculate <span>${T_{so}}$</span>.  The UTSC model is coupled to the underlying surface using the OtherSideConditionsModel mechanism.  The UTSC model provides values for <span>${h_{r,plen}}$</span>,<span>${T_{s,coll}}$</span>, <span>${h_{c,plen}}$</span>, and <span>${T_{a,plen}}$</span> for use with the Heat Balance Model calculations for the outside face of the underlying surface (described elsewhere in this manual).



#### Solar and Shading Calculations

The transpired collector object uses a standard EnergyPlus surface in order to take advantage of the detailed solar and shading calculations.  Solar radiation incident on the surface includes beam and diffuse radiation, as well as radiation reflected from the ground and adjacent surfaces.  Shading of the collector by other surfaces, such as nearby buildings or trees, is also taken into account.

#### Local Wind Speed Calculations

The outdoor wind speed affects terms used in modeling UTSC components.  The wind speed in the weather file is assumed to be measured at a meteorological station located in an open field at a height of 10 m.  To adjust for different terrain at the building site and differences in the height of building surfaces, the local wind speed is calculated for each surface.

The wind speed is modified from the measured meteorological wind speed by the equation (ASHRAE 2001):

<div>$${U_\infty } = {V_{met}}{\left( {\frac{{{\delta_{met}}}}{{{z_{met}}}}} \right)^{{a_{met}}}}{\left( {\frac{z}{\delta }} \right)^a}$$</div>

where z is the height of the centroid of the UTSC, z<sub>met</sub> is the height of the standard metereological wind speed measurement, and a and d are terrain-dependent coefficients.  d is the boundary layer thickness for the given terrain type.  The values of a and d are shown in the following tables:

Table 77. Terrain-Dependent Coefficients (ASHRAE 2001).

<table class="table table-striped">







<tr>
<td>Terrain</td>
<td>Description</td>
<td>Exponent, a</td>
<td>Layer Thickness,d (m)</td>
</tr>
<tr>
<td>1</td>
<td>Flat, open country</td>
<td>0.14</td>
<td>270</td>
</tr>
<tr>
<td>2</td>
<td>Rough, wooded country</td>
<td>0.22</td>
<td>370</td>
</tr>
<tr>
<td>3</td>
<td>Towns and cities</td>
<td>0.33</td>
<td>460</td>
</tr>
<tr>
<td>4</td>
<td>Ocean</td>
<td>0.10</td>
<td>210</td>
</tr>
<tr>
<td>5</td>
<td>Urban, industrial, forest</td>
<td>0.22</td>
<td>370</td>
</tr>

</table>

The UTSC can be defined such that it has multiple underlying heat transfer surfaces.  The centroid heights for each surface are area-weighted to determine the average height for use in the local wind calculation.

#### Convection Coefficients

UTSC modeling requires calculating up to three different coefficients for surface convection heat transfer.  These coefficients are defined in the classic way by:

<div>$${h_c} = \frac{{{T_{air}} - {T_{surf}}}}{{{{q''}_{conv}}}}$$</div>

First, <span>${h_{co}}$</span> is the convection coefficient for the collector surface facing the outdoors when the UTSC is passive.  It is modeled in exactly the same way as elsewhere in EnergyPlus and will depend on the user setting for Outside Convection Algorithm – Outside Surface Heat Balance entry elsewhere in this document.



Second, <span>${h_{c,plen}}$</span> is the convection coefficient for surfaces facing the plenum.  This coefficient is applied to just the underlying surface’s convection when the UTSC is active and to both the collector and the underlying surface when the UTSC is passive.  When the UTSC is active, we use the convection correlation for forced air developed by McAdams (1954) as published by ASHRAE HoF (2001):

<div>$${h_{c,plen}} = 5.62 + 3.9{V_p}$$</div>

where,

      <span>${V_p}$</span> is the mean velocity in the plenum determined from <span>${V_p} = \frac{{\dot m}}{{2\rho \,{A_p}}}$</span> where <span>${A_p}$</span> is the effective cross section area of the plenum perpendicular to the primary flow direction.  When the UTSC is passive, we model the convection in the same way used in EnergyPlus to model air gaps in windows.  These correlations vary by Rayleigh number and surface tilt and are based on the work of various research including Hollands et. al., Elsherbiny et. al., Wright, and Arnold.  The formulations are documented in ISO (2003) standard 15099.  For the UTSC implementation, the routines were adapted from Subroutine NusseltNumber in WindowManager.f90 (by F. Winkelmann), which itself was derived from Window5 subroutine “nusselt”.

Third, <span>${h_{c,wind}}$</span> is the convection coefficient used to degrade the UTSC performance under environmental conditions with high wind or rain.  If the weather file indicates it is raining, then we set <span>${h_{c,wind}}$</span> = 1000.0 which has the effect of making the collector the same temperature as ambient air.  The heat exchanger effectiveness correlations described above account for a moderate amount of wind, but the correlations appear confined to the range 0 to 5.0 m/s.  Therefore we set <span>${h_{c,wind}}$</span> equal to zero if <span>${U_\infty }$</span> is &lt;= 5.0 m/s.  If <span>${U_\infty }$</span> is &gt; 5.0 m/s then we use the McAdams correlation but with a reduced velocity magnitude:

<span>$$</span><span>${h_{c,wind}} = 5.62 + 3.9({U_\infty } - 5.0)$</span>

#### Radiation Coefficients

UTSC modeling requires calculating up to four different linearized coefficients for radiation heat transfer.  Whereas radiation calculations usually use temperature raised to the fourth power, this greatly complicates solving heat balance equations for a single temperature.  Linearized radiation coefficients have the same units and are used in the same manner as surface convection coefficients and introduce very little error for the temperature levels involved.

The radiation coefficient, <span>${h_{r,plen}}$</span>, is used to model thermal radiation between the collector surface and the outside face of the underlying heat transfer surface.  We assume a view factor of unity.  It is calculated using:

<div>$${h_{r,plen}} = {\sigma_{SB}}{e_{coll}}{e_{so}}\frac{{\left( {T_{s,coll}^4 - T_{so}^4} \right)}}{{\left( {{T_{s,coll}} - {T_{so}}} \right)}}$$</div>

where,

      all temperatures are converted to Kelvin,

      <span>${\sigma_{SB}}$</span> is the Stefan-Boltzmann constant,

      <span>${e_{coll}}$</span> is the longwave thermal emmittance of the collector, and

      <span>${e_{so}}$</span> is the longwave thermal emmittance of the underlying heat transfer surface.

The three other coefficients, <span>${h_{r,atm}}$</span>, <span>${h_{r,sky}}$</span>, and <span>${h_{r,gnd}}$</span> are used elsewhere in EnergyPlus for the outside face surface heat balance and are calculated in the same manner as equation for UTSC collectors.  [This is accomplished by calling subroutine InitExteriorConvectionCoeffs in the file HeatBalanceConvectionCoeffs.f90. ]

#### Bypass Control

The UTSC is assumed to be arranged so that a bypass damper controls whether or not air is drawn directly from the outdoors or through the UTSC.  The control decision is based on whether or not it will be beneficial to heat the outdoor air.  There are multiple levels of control including an availability schedule, whether or not the outdoor air is cooler than the mixed air setpoint, or whether or not the zone air temperature is lower than a so-called free heating setpoint.

#### Sizing Warnings

Although the design of the transpired collector is left to the user, the program issues warnings when the suction airflow velocity falls outside the range 0.003 to 0.08 m/s.

#### Overall Efficiency

The overall thermal efficiency of the UTSC is a useful output report and is defined as the ratio of the useful heat gain of the entire system versus the total incident solar radiation on the gross surface area of the collector.

<div>$$\eta  = \frac{{(\dot Q/A)}}{{{I_{sc}}}} = \frac{{\dot m\,{c_p}\left( {{T_{a,plen}} - {T_{amb}}} \right)}}{{{I_{sc}}A}}$$</div>

where

<span>$\dot Q$</span> is useful heat gain

<span>${I_{sc}}$</span> is total incident solar radiation

Note that the efficiency <span>$\eta $</span> is only defined for <span>${I_{solar}} > 0$</span>.  This efficiency includes heat recovered from the underlying wall and can exceed 1.0.

#### Collector Efficiency

The thermal efficiency of the collector is a useful output report and is defined as the ratio of the useful heat gain of the collector fluid versus the total incident solar radiation on the gross surface area of the collector.

<div>$$\eta  = \frac{{\dot m\,{c_p}\left( {{T_{a,HX}} - {T_{amb}}} \right)}}{{{I_{sc}}A}}$$</div>

Note that the efficiency <span>$\eta $</span> is only defined for <span>${I_{solar}} > 0$</span>

#### References

Kutscher, C.F. 1994. Heat exchange effectiveness and pressure drop for air flow through perforated plates with and without crosswind. *Journal of Heat Transfer*. May 1994, Vol. 116, p. 391. American Society of Mechanical Engineers.

Van Decker, G.W.E., K.G.T. Hollands, and A.P. Brunger. 2001. Heat-exchange relations for unglazed transpired solar collectors with circular holes on a square of triangular pitch. *Solar Energy*. Vol. 71, No. 1. pp 33-45, 2001.

ISO. 2003. ISO 15099:2003. Thermal performance of windows, doors, and shading devices – Detailed calculations. International Organization for Standardization.

System Availability Managers <a name="AvailManagers"></a>
----------------------------

### Overview

System availability managers, or AvailabilityManagers, are one of the high-level control constructs in EnergyPlus. An AvailabilityManager is able to access data from any of the HVAC system nodes and use this data to set flags telling a central air system or plant loop to turn on or off. Also, some of the HVACZone:\* components can use these same availability managers to turn their supply air fan on or off. Each type of availability manager encapsulates a specific high-level on-off control strategy. For instance, the input object AvailabilityManager:NightVentilation allows the user to specify a control strategy for pre-cooling the building with night-time ventilation.

Availability managers are contained in the program module *SystemAvailabilityManager*. The Availability managers are executed at the start of each HVAC time step by a call to *ManageSystemAvailability*, and they reside outside the HVAC system iteration loops. Thus, the availability managers are executed once per HVAC time step, and they use previous time step information to calculate their control actions.

If a given instance of an AvailabilityManager is specific to an AirLoopHVAC or to a PlantLoop, then in the input, each loop references its availability managers through a AvailabilityManagerAssignmentList. Once the data has been read in and processed, the AvailabilityManager data for each loop is stored in array *PriAirSysAvailMgr* in *DataAirLoop* (for AirLoopHVAC) and in array *PlantAvailMgr*  in *DataPlant* for plant loops.

The availability status for each AirLoopHVAC (*PriAirSysAvailMgr*) is also passed to a zone equipment availability status array (*ZoneEquipAvail*) for possible use by the zones served by that air loop. This sets the availability for certain zone equipment which are assumed to operate in conjunction with the air loop. Specifically, the availability of zone exhaust fans (Ref. Fan:ZoneExhaust) and terminal unit fans (Ref. AirTerminal:SingleDuct:SeriesPIU: Reheat, AirTerminal:SingleDuct: ParallelPIU:Reheat, and AirTerminal:SingleDuct:VAV: Reheat:VariableSpeedFan), if specified in the input, will be the same as the corresponding AirLoopHVAC availability if an AvailabilityManager is specified. Other zone equipment are not affected by the AirLoopHVAC system availability managers (e.g., Window AC, PTAC and PTHP).

However, system availability managers can separately be specified for zone components (currently only allowed for Window AC, PTAC, PTHP, Unit Heater, Unit Ventilator, Zone Water to Air Heat Pump, Zone Terminal Unit (VRF), Standalone Energy Recovery Ventilator, Outdoor Air Unit, Fan Coil Unit, and Ventilated Slab). Similar to AirLoopHVAC or PlantLoop, inputs of these zone components refer to their availability managers through a AvailabilityManagerAssignmentList. System availability managers only operate when zone components are available. If the Window AC (or any other unit) is scheduled off then the system availability manager will not operate until the Window AC is scheduled on. The functioning of the system availability manager for zone components is same as for AirLoopHVAC or PlantLoop. Except night ventilation SAM, all other SAMs can be specified for these zone components.

The actual action of turning on or off a loop is taken by the loop prime movers: fans for AirLoopHVACs and pumps for plant loops. For instance when a fan is deciding whether it is on or off, it checks its on/off schedule and whether the loop availability status flag is *CycleOn* or *ForceOff*. If the schedule is on and the status flag is *ForceOff*, the fan will be off. If the fan schedule says off and the status flag is *CycleOn*, the fan will be on. Thus the availability managers overrule the fan on/off schedule.

### Scheduled

The input object AvailabilityManager:Scheduled provides the simplest availability manager. The sole input for this manager is a schedule name. If the current schedule value is &gt; 0.0, the availability status flag is set to *CycleOn*; otherwise it is set to *ForceOff*.

### Scheduled On

An alternative to the AvailabilityManager:Scheduled object is the *AvailabilityManager:ScheduledOn* that is used specifically to turn equipment on while other availability managers may be used to turn the equipment off. The sole input for this manager is a schedule name. If the current schedule value is &gt; 0.0, the availability status flag is set to *CycleOn*; otherwise it is set to *NoAction*.

### Scheduled Off

An alternative to the AvailabilityManager:Scheduled object is the *AvailabilityManager:ScheduledOff* that is used specifically to turn equipment off while other availability managers may be used to turn the equipment on. The sole input for this manager is a schedule name. If the current schedule value is = 0.0, the availability status flag is set to *ForceOff*; otherwise it is set to *NoAction*.

### Night Cycle

The input object AvailabilityManager:NightCycle is to specify when a system that has been scheduled off during unoccupied hours should cycle on to prevent building temperatures from becoming too hot or too cold. This manager can not be used to force a system off. The inputs are:

·        A manager applicability schedule;

·        The name of the fan schedule this manager will override;

·        The control type: *Stay Off*, *Cycle On Any*, *Cycle On Control Zone*, or *Cycle On Any - Zone Fans Only*;

·        Thermostat on/off tolerance *T<sub>tol</sub>* (degrees C);

·        Cycling run time in seconds; used to calculate a stop time (in time steps since the start of the current run period) once the status has become *Cycle On*.

If the fan schedule current value is &gt; 0 or the applicability schedule value is <span>$ \le $</span> 0 or if the program is in warmup, *AvailStatus = NoAction*.

Otherwise,

1.    if current time (in time steps since the start of the run period) is greater than the start time and less than the stop time, *AvailStatus = CycleOn* (or *CycleOnZoneFansOnly* if the control type is *Cycle On Any – Zone Fans only*).

2.    If the current time equals the stop time, *AvailStatus = NoAction*  and the fan schedule will determine if the system is on.

3.     If the current time is greater than the stop time, the manager can potentially cycle the system on.

a.    For control types *Cycle On Any* and *Cycle On Any – Zone Fans Only* the manger looks at each zone served by the air loop and detects whether the zone temperature at the thermostat is greater than the cooling setpoint plus ½*T<sub>tol</sub>* or less than the heating setpoint minus ½*T<sub>tol</sub>*. If it is, *AvailStatus* is set to *CycleOn* (or *CycleOnZoneFansOnly*). If not, *AvailStatus* is set to *NoAction*.

b.   For control type *Cycle On Control Zone*, the manager does the same check just for the control zone.

Lastly if the new status is CycleOn the start time is reset to the current time and the stop time is reset. When this availability manager is specified for a zone component then the only allowed control types are *Stay Off* *and* *Cycle On Control Zone.*

### Night Ventilation

The input object AvailabilityManager:NightVentilation is a manager that looks at indoor and outdoor conditions to see if night ventilation might be beneficial. In addition to being able to cycle the air system on, this manager can specify what the ventilation air flow rate should be.  The inputs are:

·        A manager applicability schedule;

·        The name of the fan schedule this manager will override;

·        A ventilation temperature schedule;

·        A ventilation delta T;

·        A ventilation low limit temperature;

·        The night ventilation flow fraction;

·        The name of the control zone.

If the fan schedule current value is &gt; 0 or the applicability schedule value is <span>$ \le $</span> 0 or if the program is in warmup, *AvailStatus = NoAction*.

Otherwise, the manager performs 3 limit checks.

1)    If for all the zones connected to the air loop the room temperature at the thermostat of any zone is greater than the ventilation temperature schedule value, this check is true.

2)    If for all the zones connected to the air loop the room temperature at the thermostat of any zone is less than the ventilation low limit temperature, this check is true.

3)    If the difference between the control zone room temperature at the thermostat and the outside temperature is greater than the specified night venting delta T, this check is true.

If 1) and 3) are true and 2) is false, the status is set to *CycleOn*; otherwise the status is *NoAction*.  If the status is *CycleOn* this manager sets some additional values in the *AirLoopControlInfo* data structure (a flag is set to indicate night ventilation is occurring and a flag is set to indicate that the air system flow rate has been specified by a manager) and in the * AirLoopFlow* data structure (the system flow fraction is specified). The night ventilation flag indicates to the fan that it should use alternate performance characteristics if they have been specified in a FanPerformance:NightVentilation object.

### Differential Thermostat

The input object AvailabilityManager:DifferentialThermostat is a manager that overrides fan or pump schedules depending on the temperature difference between two nodes. A typical use would be for one node to be an outdoor air node and the other a zone node. The inputs are:

·        name of the hot node;

·        name of the cold node;

·        temperature difference for turning the system on (*DeltaT<sub>on</sub>*);

·        temperature difference for turning the system off (*DeltaT<sub>off</sub>*).

Note that there is no applicability schedule for this manager. Also, this manager always returns a status of *CycleOn* or *ForceOff*, never *NoAction*.

*DeltaT* = *T<sub>hot\\ node</sub>* – *T<sub>cold\\ node</sub>*

If *DeltaT* &gt;= *DeltaT<sub>on</sub>*  then

*AvailStatus = CycleOn*

      Else if *DeltaT* &lt;= *DeltaT<sub>off</sub>*  then

*AvailStatus = ForceOff*

Else

*AvailStatus* remains in its previous state.

### High Temperature Turn Off

The input object AvailabilityManager:HighTemperatureTurnOff is used to turn off a central air system or a plant loop if a sensed node temperature exceeds a temperature limit. The inputs are:

·        name of the sensed node;

·        limit temperature (*T<sub>u</sub>*).

If *T<sub>sensed\\ node</sub>* &gt;= *T<sub>u</sub>* then

*AvailStatus* = *ForceOff*

Else

*AvailStatus* = *NoAction*

### High Temperature Turn On

The input object AvailabilityManager:HighTemperatureTurnOn is used to turn on a central air system or a plant loop if a sensed node temperature exceeds a temperature limit. The inputs are:

·        name of the sensed node;

·        limit temperature (*T<sub>u</sub>*).

If *T<sub>sensed\\ node</sub>* &gt;= *T<sub>u</sub>* then

*AvailStatus* = *CycleOn*

Else

*AvailStatus* = *NoAction*

### Low Temperature Turn Off

The input object AvailabilityManager:LowTemperatureTurnOff is used to turn off a central air system or a plant loop if a sensed node temperature is lower than a temperature limit. The inputs are:

·        name of the sensed node;

·        limit temperature (*T<sub>l</sub>*);

·        applicability schedule name.

If the applicability schedule exists and has a current value of &lt;= 0, the manager returns an availability status of *NoAction*.

Otherwise,

If *T<sub>sensed\\ node</sub>* &lt;= *T<sub>l</sub>*  then

*AvailStatus* = *ForceOff*

Else

*AvailStatus* = *NoAction*

### Low Temperature Turn On

The input object AvailabilityManager:LowTemperatureTurnOn is used to turn on a central air system or a plant loop if a sensed node temperature is less than a temperature limit. The inputs are:

·        name of the sensed node;

·        limit temperature (*T<sub>l</sub>*).

If *T<sub>sensed\\ node</sub>* &lt;= *T<sub>l</sub>*  then

*AvailStatus* = *CycleOn*

Else

*AvailStatus* = *NoAction*

### Hybrid Ventilation Control

The input object AvailabilityManager:HybridVentilation serves two purposes: 1) it prevents simultaneous natural ventilation and HVAC system operation, and 2) it allows users to examine various strategies to maximize natural ventilation in order to reduce heating/cooling loads. This availability manager works with either the AirflowNetwork model or the simple airflow objects to provide controlled natural ventilation. The controlled natural ventilation objects referred to here are either AirflowNetwork:Multizone:ComponentDetailedOpening and AirflowNetwork:Multizone:ComponentSimpleOpening objects, or ZoneVentilation and ZoneMixing objects. The simple airflow objects are not allowed to work with the AirflowNetwork objects simultaneously. If there is no air loop, this availability manager can still be applied to controlled zone specified in the object. In order to apply hybrid ventilation manager to the controlled zone not served by any air loop, the HVAC air loop name input field must be left blank. Currently, zone component objects such as unit heater, unit ventilator, packaged terminal air conditioner, packaged terminal heat pump, zone water source heat pump, window air conditioner, variable refrigerant flow, energy recovery ventilator, outdoor air unit, fan coil unit, and ventilated slab can individually use hybrid ventilation managers to make a decision regarding whether their fan should be on or off. Also, hybrid ventilation manager can be applied to zones served by the ideal load zone component to turn them off when natural ventilation is active. Currently, hybrid ventilation manager is restricted to one per zone. It can either be applied through the air loop or directly to the zone. If hybrid ventilation manager is applied to an air loop and one of the zones served by the air loop also has hybrid ventilation manager, then zone hybrid ventilation manager is disabled. This availability manager performs somewhat differently from the other availability managers:

n This availability manager is called before the program estimates (predicts) the cooling or heating load that needs to be met by the cooling/heating systems for the simulation time step. On the other hand, the other availability managers are called after the system cooling/heating load prediction. The main reason for calling AvailabilityManager:HybridVentilation early is that this manager determines whether natural ventilation is allowed or not, and the loads from natural ventilation are used to predict system loads.

n This availability manager has its own control schedule and does not work in tandem with *AvailabilityManager:Scheduled*.

n AvailabilityManager:HybridVentilation works completely independent of the other system availability managers, so this manager is not a valid system availability manager type in the AvailabilityManagerAssignmentList object.

#### Control logic

The control logic for each ventilation control mode is described below.

#### Temperature control

This control mode checks whether the outdoor air dry-bulb temperature is between the Minimum Outdoor Temperature and Maximum Outdoor Temperature specified. If the outdoor temperature is between the two values then natural ventilation is allowed, else natural ventilation is not allowed.

When natural ventilation is allowed, the control then checks the temperature difference between the zone temperature and the temperature setpoint(s) in the controlled zone based on the specified temperature control type (four available temperature control types) to make a final decision:

*Single Heating Setpoint:*

If the zone temperature is below the setpoint, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid overcooling a space, which could result in additional heating load.

*Single Cooling Setpoint:*

If the zone temperature is above the setpoint, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid overheating a space, which could result in additional cooling load.

*Single Heating Cooling Setpoint:*

Since this temperature control type requires only a single setpoint, natural ventilation is not allowed. A recurring warning message is issued.

*Dual Setpoint with DeadBand:*

If the zone temperature is beyond the deadband, the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid either overcooling a space, which could result in additional heating load when the zone temperature is below the heating setpoint, or overheating a space, which could result in additional cooling load when the zone temperature is above the cooling setpoint.

#### Enthalpy control

This control mode checks whether the outdoor air enthalpy is between the Minimum Outdoor Enthalpy and Maximum Outdoor Enthalpy specified. If the outdoor enthalpy is between the two values then natural ventilation is allowed, else natural ventilation is not allowed.

When natural ventilation is allowed, the control then checks the temperature difference between the zone temperature and the temperature setpoint(s) in the controlled zone based on the specific temperature control type to make a final decision. This procedure is the same as defined above for the temperature control mode.

*Single Heating Setpoint:*

If the zone temperature is below the setpoint, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid overcooling a space, which could result in additional heating load.

*Single Cooling Setpoint:*

If the zone temperature is above the setpoint, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid overheating a space, which could result in additional cooling load.

*Single Heating Cooling Setpoint:*

Since this temperature control type requires only a single setpoint, natural ventilation is not allowed. A recurring warning message is issued.

*Dual Setpoint with DeadBand:*

If the zone temperature is beyond the deadband, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid either overcooling a space, which could result in additional heating load when the zone temperature is below the heating setpoint, or overheating a space, which could result in additional cooling load when the zone temperature is above the cooling setpoint.

#### Dew-Point control

This control mode checks whether the outdoor air dewpoint temperature is between the Minimum Outdoor Dew-Point and Maximum Outdoor Dew-Point specified. If the outdoor dewpoint temperature is between the two values then natural ventilation is allowed, else national ventilation is not allowed.

When natural ventilation is allowed and a humidistat is available in the controlled zone, the control then checks the humidity ratio difference between the zone air humidity ratio and humidistat setpoint in the controlled zone to make a final decision. It should be pointed out that the humidistat object provides the setpoint of relative humidity, the value of relative humidity has to be converted into the setpoint of humidity ratio using the actual zone air temperature for comparison. Since the humidistat only provides a single value for relative humidity, there are two possible scenarios:

If the actual zone air humidity ratio is below the humidity ratio setpoint and the controlled zone needs humidification as the first scenario, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid dehumidifying a space, which could result in additional humidification load.

If the actual zone air humidity ratio is above the humidity ratio setpoint and the controlled zone needs dehumidification as the second scenario, then the initial decision is overridden and natural ventilation is not allowed. This is intended to avoid humidifying a space, which could result in additional dehumidification load.

#### Outdoor ventilation air control

This control mode does not require any additional checks. The control only works with Airflow Network opening objects only, and is not allowed to work with ZoneVentilation and ZoneMixing objects.

#### Availability Status

After the hybrid ventilation control determines whether natural ventilation is allowed or not, the availability status flag is set as follows:

If *Natural Ventilation* then

*AvailStatus* = *CycleOn*

Else

*AvailStatus = ForceOn*

### **Optimum Start Controls**

#### Overview

Optimum start is often also referred to as optimum recovery time. Commercial buildings are often operated intermittently by lowering heating set-point and increasing cooling set-point during unoccupied period. The building should return to set-point just before occupancy period starts. Therefore it is important to start the operation of heating and cooling plant before building is occupied. If the operation is started too early before the occupants return, energy is wasted. If it is started too late the occupants will be uncomfortable. An optimum start time for operation will save energy without compromising comfort.

![](EngineeringReference/media/image6731.png)

Figure 301. Optimal Start Control

In practice a few proprietary algorithms are used to predict this start time value for preheating and precooling operation. ASHRAE Handbook refers to work done by (Seem, Armstrong, & Hancock, 1989) which compares seven different equations and suggests a set of equations for preheating and precooling time prediction.

#### Algorithms

There are a few algorithms to predict the start time for the HVAC system. Among these algorithms following are the promising ones that can be implemented in a simulation environment.

#### Constant Start Time

This is the simplest format of the optimum start algorithm. The HVAC system will start the HVAC system at a fixed number of hours before occupancy as specified by the user.

#### Constant Temperature Gradient

In practice most of the HVAC control manufacturers use a temperature gradient as a thermal capacity factor, in which temperature rise per unit time i.e. °C/hour is measured for the unoccupied building and then the difference between space temperature and set-point temperature is divided by this factor to calculate the actual number of hours before occupancy are needed to start the HVAC system.

#### Adaptive Temperature Gradient

Adaptive control is used to modify the temperature gradient depending on the time required to meet the set-point on the prior days. The adaptive algorithm takes the arithmetic average of the actual temperature gradients calculated for the specified number of previous days. 

#### Adaptive ASHRAE Algorithm

The equations suggested in the ASHRAE Handbook are used in combination with a recursive linear least square method to determine the optimum start/recovery time empirically. Depending on heating or cooling operation the start time is categorized as preheating or precooling time. According to (Seem, Armstrong, & Hancock, 1989) the preheating time is a strong function of outdoor temperature whereas precooling time is not strong function of outdoor temperature if space temperature is close or less than the setback temperature. Thus, two different equations are suggested for preheating and precooling time.

n Precooling time

<div>$${t_i} = {a_0} + {a_1}{T_{z,i}} + {a_2}T_{z,i}^2$$</div>



Preheating time

<div>$${t_i} = {a_0} + \left( {1 - {w_i}} \right)({a_1}{T_{z,i}} + {a_2}T_{z,i}^2) + {w_i}{a_3}{T_{o,i}}$$</div>

Where, on *i*<sup>th</sup> day

*t<sub>i</sub>* = start/recovery time,

*T<sub>z,i</sub>* =           zone temperature

*T<sub>o,i</sub>* =           outdoor temperature

‘*w<sub>i</sub>*’ is a weighting factor which determines weighting given to outside and zone temperature.

<div>$${w_i} = {1000^{ - \frac{{\left( {{T_{z,i}} - {T_{unocc}}} \right)}}{{\left( {{T_{occ}} - {T_{unocc}}} \right)}}}}$$</div>

*T<sub>unocc</sub>* and *T<sub>occ</sub>* are setpoint temperatures during unoccupied (setback) and occupied periods.

Coefficients *a<sub>0</sub>, a<sub>1</sub>, a<sub>2</sub>* (and *a<sub>3</sub>*) are separately calculated for heating and cooling operation and are updated from the optimum times from last three days thus; these coefficients carry history and adapt the trend from previous days.

The optimum time for past days is determined using,

<div>$${t_{opt,\left( {i - 1} \right)}} = {k_{\left( {i - 1} \right)}}\Delta t - \Delta t\left( {1 - \frac{{{q_{\left( {i - 1} \right)}}}}{{{q_{max}}}}} \right)$$</div>

*k* = time steps required for recovery

Δ*t* =            time-step

*t<sub>opt,(i-1)</sub>* = recovery time on (*i*-1)<sup>th</sup> day

*q<sub>(i-1)</sub>* =          energy extracted or added during last time step

*q<sub>max</sub>* =          maximum capacity of the equipments


Occupant Thermal Comfort <a name="ThermalComfort"></a>
------------------------

The integration of a sophisticated building thermal analysis tool with thermal comfort models allows one to perform an energy analysis on a zone and simultaneously determine if the environmental control strategy will be sufficient for the occupants to be thermally comfortable. This chapter is intended to provide background on thermal comfort, present an overview of state of the art thermal comfort models and present the mathematical models that have been incorporated into Energy Plus.

Thermal comfort modeling is controlled primarily by the People input object. This includes input for selecting the type of thermal comfort model that is desired by the user as well as parameters that serve as inputs to all of the thermal comfort models. This includes the activity level, the work efficiency, the air velocity, and the clothing insulation level for people within the space.  All four of these parameters can be scheduled. More information on the People input object can be found in the EnergyPlus Input/Output Reference. More information on how each of these parameters is used and the specific modeling equations for the thermal comfort models can be found below.

### Background on Thermal Comfort Models

Throughout the last few decades, researchers have been exploring the thermal, physiological and psychological response of people in their environment in order to develop mathematical models to predict these responses. Researchers have empirically debated building occupants' thermal responses to the combined thermal effect of the personal, environmental and physiological variables that influence the condition of thermal comfort.

There are two personal variables that influence the condition of thermal comfort: the thermal resistance of the clothing (I<sub>cl</sub>), and the metabolic rate (H/A<sub>Du</sub>). The thermal resistance of the clothing (I<sub>cl</sub>) is measured in units of "clo." The 1985 ASHRAE Handbook of Fundamentals (ASHRAE 1985) suggests multiplying the summation of the individual clothing items clo value by a factor of 0.82 for clothing ensembles.

The metabolic rate (H/A<sub>Du</sub>), is a measure of the internal heat production rate of an occupant (H) w/hr. in per unit of "Dubois" body surface area (A<sub>Du</sub>) in units of m<sup>2</sup>. The DuBois body surface area is given by :

<div>$${A_{Du}} = 0.202{(weight)^{0.425}}{(height)^{0.725}}$$</div>

Using this equation, an area of 1.8 m<sup>2</sup> represents the surface area of an average person of weight 70 kg. and height 1.73 m (Fanger 1967). The metabolic rate is measured in mets, where 1 met = 58.2 W/m<sup>2</sup>.

The environmental variables that influence the conditions of thermal comfort include:

(1) Air Temperature (T<sub>a</sub>),

(2) Mean Radiant Temperature (T<sub>r</sub>),

(3) Relative air velocity (v),

(4) Water vapor pressure in ambient air (P<sub>a</sub>)

The Air Temperature (T<sub>a</sub>), a direct environmental index, is the dry-bulb temperature of the environment. The Mean Radiant Temperature (T<sub>r</sub>) is a rationally derived environmental index defined as the uniform black-body temperature that would result in the same radiant energy exchange as in the actual environment. The Relative air velocity (v) a direct environmental index is a measure of the air motion obtainable via a hot wire or vane anemometers. The Water vapor pressure in ambient air (P<sub>a</sub>) is a direct environmental index.

The physiological variables that influence the conditions of thermal comfort include:

(1) Skin Temperature (T<sub>sk</sub>),

(2) Core or Internal Temperature (T<sub>cr</sub>),

(3) Sweat Rate,

(4) Skin Wettedness (w),

(5) Thermal Conductance (K) between the core and skin.

Where the Skin Temperature (T<sub>sk</sub>), the Core Temperature (T<sub>cr</sub>) and the Sweat Rate are physiological indices. The Skin Wettedness (w) is a rationally derived physiological index defined as the ratio of the actual sweating rate to the maximum rate of sweating that would occur if the skin were completely wet.

One more consideration is important in dealing with thermal comfort - the effect of asymmetrical heating or cooling. This could occur when there is a draft or when there is a radiant flux incident on a person (which is what is of primary interest to us here). Fanger (1967) noted that the human regulatory system is quite tolerant of asymmetrical radiant flux. A reasonable upper limit on the difference in mean radiant temperature (T<sub>r</sub>) from one direction to the opposing direction is 15°C. (ASHRAE 1984). This limit is lower if there is a high air velocity in the zone.

Table 78.  General Nomenclature list for Thermal Comfort Models

<table class="table table-striped">








<tr>
<td>Mathematical variable</td>
<td>Description</td>
<td>Units
 </td>
<td>Range</td>
<td>FORTRAN variable</td>
</tr>
<tr>
<td>A<sub>Du</sub></td>
<td>Dubois body surface area</td>
<td>m<sup>2</sup></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>H</td>
<td>Internal heat production rate of an occupant per unit area
= M – W</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>IntHeatProd</td>
</tr>
<tr>
<td>I<sub>cl</sub></td>
<td>Thermal resistance of the clothing</td>
<td>clo</td>
<td>-</td>
<td>CloUnit</td>
</tr>
<tr>
<td>M</td>
<td>Metabolic rate per unit area</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ActLevel</td>
</tr>
<tr>
<td>P<sub>a</sub></td>
<td>Water vapor pressure in ambient air</td>
<td>Torr</td>
<td>-</td>
<td>VapPress</td>
</tr>
<tr>
<td>T<sub>a</sub></td>
<td>Air temperature</td>
<td>°C</td>
<td>-</td>
<td>AirTemp</td>
</tr>
<tr>
<td>T<sub>cr</sub></td>
<td>Core or internal temperature</td>
<td>°C</td>
<td>-</td>
<td>CoreTemp</td>
</tr>
<tr>
<td>T<sub>r</sub></td>
<td>Mean radiant temperature</td>
<td>°C</td>
<td>-</td>
<td>RadTemp</td>
</tr>
<tr>
<td>T<sub>sk</sub></td>
<td>Skin temperature</td>
<td>°C</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>v</td>
<td>Relative air velocity</td>
<td>m/s</td>
<td>-</td>
<td>AirVel</td>
</tr>
<tr>
<td>W</td>
<td>The rate of heat loss due to the performance of work</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>WorkEff</td>
</tr>
<tr>
<td>w</td>
<td>Skin wettedness</td>
<td>-</td>
<td>-</td>
<td>-</td>
</tr>

</table>

### Mathematical Models for Predicting Thermal Comfort

Many researchers have been exploring ways to predict the thermal sensation of people in their environment based on the personal, environmental and physiological variables that influence thermal comfort. From the research done, some mathematical models that simulate occupants' thermal response to their environment have been developed. Most thermal comfort prediction models use a seven or nine point thermal sensation scale, as in the following tables.

Table 79.  Seven point Thermal Sensation Scale

<table class="table table-striped">





<tr>
<td>Sensation</td>
<td>Description</td>
</tr>
<tr>
<td>3</td>
<td>Hot</td>
</tr>
<tr>
<td>2</td>
<td>Warm</td>
</tr>
<tr>
<td>1</td>
<td>slightly warm</td>
</tr>
<tr>
<td>0</td>
<td>neutral</td>
</tr>
<tr>
<td>-1</td>
<td>slightly cool</td>
</tr>
<tr>
<td>-2</td>
<td>cool</td>
</tr>
<tr>
<td>-3</td>
<td>cold</td>
</tr>

</table>





Table 80.  Nine point Thermal Sensation Scale

<table class="table table-striped">





<tr>
<td>Sensation Value</td>
<td>Description</td>
</tr>
<tr>
<td>4</td>
<td>very hot</td>
</tr>
<tr>
<td>3</td>
<td>hot</td>
</tr>
<tr>
<td>2</td>
<td>warm</td>
</tr>
<tr>
<td>1</td>
<td>slightly warm</td>
</tr>
<tr>
<td>0</td>
<td>neutral</td>
</tr>
<tr>
<td>-1</td>
<td>slightly cool</td>
</tr>
<tr>
<td>-2</td>
<td>cool</td>
</tr>
<tr>
<td>-3</td>
<td>cold</td>
</tr>
<tr>
<td>-4</td>
<td>very cold</td>
</tr>

</table>

The most notable models have been developed by P.O. Fanger (the Fanger Comfort Model), the J. B. Pierce Foundation (the Pierce Two-Node Model), and researchers at Kansas State University (the KSU Two-Node Model). Berglund (1978) presents a detailed description of the theory behind these three models.

Note for all Thermal Comfort reporting:  Though the published values for thermal comfort “vote” have a discrete scale (e.g. –3 to +3 or –4 to +4), the calculations in EnergyPlus are carried out on a continuous scale and, thus, reporting may be “off the scale” with specific conditions encountered in the space.  This is not necessarily an error in EnergyPlus – rather a different approach that does not take the “limits” of the discrete scale values into account.

The main similarity of the three models is that all three apply an energy balance to a person and use the energy exchange mechanisms along with experimentally derived physiological parameters to predict the thermal sensation and the physiological response of a person due to their environment. The models differ somewhat in the physiological models that represent the human passive system (heat transfer through and from the body) and the human control system (the neural control of shivering, sweating and skin blood flow). The models also differ in the criteria used to predict thermal sensation. However, all three models use information from the People statement and the thermal comfort model is selected via the People statement in a user’s input file. Scheduled parameters such as the activity level, work efficiency, air velocity, and clothing insulation level all have a direct bearing on the thermal comfort models. For more information on the input of these parameters, see the People statement in the EnergyPlus Input/Output Reference. For more information on how each individual thermal comfort model uses these parameters, please consult the next several sections.

The main similarity of the three models is that all three apply an energy balance to a person and use the energy exchange mechanisms along with experimentally derived physiological parameters to predict the thermal sensation and the physiological response of a person due to their environment. The models differ somewhat in the physiological models that represent the human passive system (heat transfer through and from the body) and the human control system (the neural control of shivering, sweating and skin blood flow). The models also differ in the criteria used to predict thermal sensation.

### Fanger Comfort Model

Fanger's Comfort model was the first one developed. It was published first in 1967 (Fanger 1967) and then in 1970 (Fanger 1970), and helped set the stage for the other two models. The mathematical model developed by P.O. Fanger is probably the most well known of the three models and is the easiest to use because it has been put in both chart and graph form.

#### Fanger Model Nomenclature List

Table 81.  Nomenclature list for Fanger model

<table class="table table-striped">








<tr>
<td>Mathematical variable</td>
<td>Description</td>
<td>Units</td>
<td>Range</td>
<td>FORTRAN variable</td>
</tr>
<tr>
<td>A<sub>Du</sub></td>
<td>Dubois body surface area</td>
<td>m<sup>2</sup></td>
<td>-</td>
<td>BodySurfaceArea</td>
</tr>
<tr>
<td>C<sub>res</sub></td>
<td>The rate of dry respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>DryRespHeatLoss</td>
</tr>
<tr>
<td>E<sub>dif</sub></td>
<td>The rate of heat loss from the diffusion of water vapor through the skin</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>EvapHeatLossDiff</td>
</tr>
<tr>
<td>E<sub>res</sub></td>
<td>The rate of latent respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>LatRespHeatLoss</td>
</tr>
<tr>
<td>E<sub>rsw,req</sub></td>
<td>The rate of heat loss from the evaporation of regulatory sweating at the state of comfort</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>EvapHeatLossRegComf</td>
</tr>
<tr>
<td>E<sub>sk</sub></td>
<td>Total evaporative heat loss from skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLoss</td>
</tr>
<tr>
<td>f<sub>cl</sub></td>
<td>The ratio of clothed body</td>
<td>-</td>
<td> </td>
<td>CloBodyRat</td>
</tr>
<tr>
<td>f<sub>eff</sub></td>
<td>The fraction of surface effective for radiation
(= 0.72)</td>
<td>-</td>
<td>-</td>
<td>RadSurfEff</td>
</tr>
<tr>
<td>H</td>
<td>Internal heat production rate of an occupant per unit area (= M – W)</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>IntHeatProd</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Convective heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td>-</td>
<td>Hc</td>
</tr>
<tr>
<td>L</td>
<td>All the modes of energy loss from body</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>M</td>
<td>Metabolic rate per unit area</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ActLevel</td>
</tr>
<tr>
<td>P<sub>a</sub></td>
<td>Water vapor pressure in ambient air</td>
<td>Torr</td>
<td>-</td>
<td>VapPress</td>
</tr>
<tr>
<td>PMV</td>
<td>Predicted Mean Vote</td>
<td>-</td>
<td>-4~4</td>
<td>PMV</td>
</tr>
<tr>
<td>PPD</td>
<td>Predicted Percentage of Dissatisfied</td>
<td>-</td>
<td>0~100%</td>
<td>PPD</td>
</tr>
<tr>
<td>P<sub>sk</sub></td>
<td>Saturated water vapor pressure at required skin temperature</td>
<td>Torr</td>
<td>-</td>
<td>SatSkinVapPress</td>
</tr>
<tr>
<td>Q<sub>c</sub></td>
<td>The rate of convective heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ConvHeatLoss</td>
</tr>
<tr>
<td>Q<sub>dry</sub></td>
<td>Sensible heat flow from skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>DryHeatLoss</td>
</tr>
<tr>
<td>Q<sub>r</sub></td>
<td>The rate of radiative heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>RadHeatLoss</td>
</tr>
<tr>
<td>Q<sub>res</sub></td>
<td>The rate of respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>RespHeatLoss</td>
</tr>
<tr>
<td>T<sub>a</sub></td>
<td>Air temperature</td>
<td>°C</td>
<td>-</td>
<td>AirTemp</td>
</tr>
<tr>
<td>T<sub>cl</sub></td>
<td>Clothing surface temperature</td>
<td>°C</td>
<td>-</td>
<td>CloSurfTemp</td>
</tr>
<tr>
<td>T<sub>cla</sub></td>
<td>Clothing surface temperature (Absolute)</td>
<td>°K</td>
<td>-</td>
<td>AbsCloSurfTemp</td>
</tr>
<tr>
<td>T<sub>ra</sub></td>
<td>Mean radiant temperature</td>
<td>°K</td>
<td>-</td>
<td>AbsRadTemp</td>
</tr>
<tr>
<td>T<sub>skr</sub></td>
<td>Skin temperature required to achieve thermal comfort</td>
<td>°C</td>
<td> </td>
<td>SkinComfTemp</td>
</tr>
<tr>
<td>W</td>
<td>The rate of heat loss due to the performance of work</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>WorkEff</td>
</tr>
<tr>
<td>e</td>
<td>The emissivity of clothing-skin surface</td>
<td>-</td>
<td>-</td>
<td>SkinEmiss</td>
</tr>
<tr>
<td>s</td>
<td>The Stefan-Boltzman constant (= 5.67×10<sup>-8</sup>)</td>
<td>W/m<sup>2</sup>K<sup>4</sup></td>
<td>-</td>
<td>StefanBoltz</td>
</tr>

</table>

#### Description of the model and algorithm

Fanger developed the model based on the research he performed at Kansas State University and the Technical University of Denmark. Fanger used the seven-point form of a thermal sensation scale along with numerous experiments involving human subjects in various environments. He related the subjects in response to the variables, which influence the condition of thermal comfort. Fanger's model is based upon an energy analysis that takes into account all the modes of energy loss (L) from the body, including: the convection and radiant heat loss from the outer surface of the clothing, the heat loss by water vapor diffusion through the skin, the heat loss by evaporation of sweat from the skin surface, the latent and dry respiration heat loss and the heat transfer from the skin to the outer surface of the clothing. The model assumes that the person is thermally at steady state with his environment.

<span>$M = L$</span>                                                                                     W/m<sup>2</sup>

<span>$L = {Q_{res}} + {Q_{dry}} + {E_{sk}} + W$</span>                                                         W/m<sup>2</sup>

<span>${Q_{res}} = {E_{res}} + {C_{res}} = 0.0023M(44 - {P_a}) + 0.0014M(34 - {T_a})$</span>     W/m<sup>2</sup>

LatRespHeatLoss = 0.0023\*ActLevel\*(44. - VapPress)

DryRespHeatLoss = 0.0014\*ActLevel\*(34.- AirTemp)

RespHeatLoss = LatRespHeatLoss + DryRespHeatLoss

<span>${Q_c} = {h_c} \times {f_{cl}}({T_{cl}} - {T_a})$</span>                                                               W/m<sup>2</sup>

<span>${Q_r} = {f_{eff}}{f_{cl}}\varepsilon \sigma ({T_{cla}}^4 - {T_{ra}}^4)$</span>                                                       W/m<sup>2</sup>

<span>${Q_{dry}} = {Q_c} + {Q_r}$</span>                                                                         W/m<sup>2</sup>

ConvHeatLos = CloBodyRat\*Hc\*(CloSurfTemp - AirTemp)

RadHeatLoss = RadSurfEff\*CloBodyRat\*SkinEmiss\*StefanBoltz &

\*(AbsCloSurfTemp\*\*4 - AbsRadTemp\*\*4)

DryHeatLoss = ConvHeatLoss + RadHeatLoss

For<span>$H > 58.2$</span>, <span>${E_{rsw}} = 0.42(H - 58.2)$</span>                                      W/m<sup>2</sup>

For <span>$H \le 58.2$</span>, <span>${E_{rsw}} = 0$</span>                                                           W/m<sup>2</sup>

<span>${E_{diff}} = 0.68 \times 0.61({P_{sk}} - {P_a}) = 0.4148({P_{sk}} - {P_a})$</span>                        W/m<sup>2</sup>

<span>${E_{sk}} = {E_{rsw}} + {E_{diff}}$</span>                                                                      W/m<sup>2</sup>

EvapHeatLossRegComf = 0.42\*(IntHeatProd - ActLevelConv)

EvapHeatLossRegComf = 0.0

EvapHeatLossDiff = 0.4148\*(SkinComfVpress - VapPress)

EvapHeatLoss = EvapHeatLossRegComf + EvapHeatLossDiff

Where,

0.68 is the passive water vapor diffusion rate, (g/h·m<sup>2</sup>·Torr)

0.61 is the latent heat of water, (W·h/g)

P<sub>sk</sub> is the saturated water vapor pressure at the skin temperature required to achieve the thermal comfort

<span>${P_{sk}} = 1.92{T_{skr}} - 25.3$</span>                                                                Torr

SatSkinVapPress = 1.92\*SkinTempComf - 25.3

<span>${T_{skr}} = 35.7 - 0.028H$</span>                                                               °C

SkinTempComf = 35.7 - 0.028\*IntHeatProd

By determining the skin temperature and evaporative sweat rate that a thermally comfortable person would have in a given set of conditions, the model calculates the energy loss (L). Then, using the thermal sensation votes from subjects at KSU and Denmark, a Predicted Mean Vote (PMV) thermal sensation scale is based on how the energy loss (L) deviates from the metabolic rate (M) in the following form:

<div>$$PMV = (0.303{e^{ - 0.036M}} + 0.028)(H - L)$$</div>

ThermSensTransCoef = 0.303\*EXP(-0.036\*ActLevel) + 0.028

PMV = ThermSensTransCoef\*(IntHeatProd - EvapHeatLoss - RespHeatLoss - DryHeatLoss)

Predicted Percent of Dissatisfied (PPD) people at each PMV is calculated as follows:

PPD = 100.0 - 95.0\*EXP(-0.03353\*PMV\*\*4 - 0.2179\*PMV\*\*2)

### Pierce Two-Node Model

The Pierce Two-Node model was developed at the John B. Pierce Foundation at Yale University. The model has been continually expanding since its first publication in 1970 (Gagge et.al. 1970). The most recent version on the model appears in the 1986 ASHRAE Transactions (Gagge et.al. 1986).

#### Pierce Two-Node Model Nomenclature List

Table 82.  Nomenclature list for Pierce Two-Node model

<table class="table table-striped">








<tr>
<td>Mathematical variable</td>
<td>Description</td>
<td>Units
 </td>
<td>Range</td>
<td>FORTRAN variable</td>
</tr>
<tr>
<td>C<sub>dil</sub></td>
<td>Constant for skin blood flow</td>
<td> </td>
<td> </td>
<td>SkinBloodFlowConst</td>
</tr>
<tr>
<td>C<sub>res</sub></td>
<td>The rate of dry respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>DryRespHeatLoss</td>
</tr>
<tr>
<td>C<sub>sw</sub></td>
<td>Proportionality constant for sweat control</td>
<td>g/m<sup>2</sup>hr</td>
<td> </td>
<td>SweatContConst</td>
</tr>
<tr>
<td>DISC</td>
<td>Predicted discomfort vote</td>
<td>-</td>
<td>-5~5</td>
<td>DISC</td>
</tr>
<tr>
<td>E<sub>dif</sub></td>
<td>The rate of heat loss from the diffusion of water vapor through the skin</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>EvapHeatLossDiff</td>
</tr>
<tr>
<td>E<sub>max</sub></td>
<td>Maximum evaporative heat loss</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLossMax</td>
</tr>
<tr>
<td>E<sub>sk</sub></td>
<td>Total evaporative heat loss from skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLoss</td>
</tr>
<tr>
<td>E<sub>res</sub></td>
<td>The rate of latent respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>LatRespHeatLoss</td>
</tr>
<tr>
<td>E<sub>rsw</sub></td>
<td>The rate of heat loss from the evaporation of regulatory sweating</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>EvapHeatLossRegSweat</td>
</tr>
<tr>
<td>E<sub>rsw,req</sub></td>
<td>The rate of heat loss from the evaporation of regulatory sweating at the state of comfort</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLossRegComf</td>
</tr>
<tr>
<td>ET*</td>
<td>Effective Temperature</td>
<td>°C</td>
<td>-</td>
<td>ET</td>
</tr>
<tr>
<td>f<sub>cl</sub></td>
<td>The ratio of clothed body</td>
<td>-</td>
<td> </td>
<td>CloBodyRat</td>
</tr>
<tr>
<td>f<sub>eff</sub></td>
<td>The fraction of surface effective for radiation
(= 0.72)</td>
<td>-</td>
<td>-</td>
<td>RadSurfEff</td>
</tr>
<tr>
<td>H</td>
<td>Internal heat production rate of an occupant per unit area (= M – W)</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>IntHeatProd</td>
</tr>
<tr>
<td>h</td>
<td>Combined heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td> </td>
<td>H</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Convective heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td>-</td>
<td>Hc</td>
</tr>
<tr>
<td>h<sub>e</sub>’</td>
<td>Combined evaporative heat transfer coefficient</td>
<td>W/(m<sup>2</sup>kP<sub>a</sub>)</td>
<td> </td>
<td>-</td>
</tr>
<tr>
<td>h<sub>r</sub></td>
<td>Radiant heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td>-</td>
<td>Hr</td>
</tr>
<tr>
<td>I<sub>cl</sub></td>
<td>Clothing insulation</td>
<td>m<sup>2</sup>°C/W</td>
<td> </td>
<td>-</td>
</tr>
<tr>
<td>L</td>
<td>All the modes of energy loss from body</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>L<sub>ET*</sub></td>
<td>All the modes of energy loss from body at ET*</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>-</td>
</tr>
<tr>
<td>L<sub>SET*</sub></td>
<td>All the modes of energy loss from body at SET*</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>-</td>
</tr>
<tr>
<td>M</td>
<td>Metabolic rate per unit area</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ActLevel</td>
</tr>
<tr>
<td>M<sub>act</sub></td>
<td>Metabolic heat production due to activity</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>-</td>
</tr>
<tr>
<td>M<sub>shiv</sub></td>
<td>Metabolic heat production due to shivering</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>ShivResponse</td>
</tr>
<tr>
<td>P<sub>a</sub></td>
<td>Water vapor pressure in ambient air</td>
<td>Torr</td>
<td>-</td>
<td>VapPress</td>
</tr>
<tr>
<td>PMV*</td>
<td>Predicted Mean Vote modified by ET* or SET*</td>
<td>-</td>
<td>-4~4</td>
<td>PMVET
PMVSET</td>
</tr>
<tr>
<td>P<sub>SET*</sub></td>
<td>Water vapor pressure at SET*</td>
<td>°C</td>
<td> </td>
<td>StdVapPressSET</td>
</tr>
<tr>
<td>P<sub>sk</sub></td>
<td>Saturated water vapor pressure at required skin temperature</td>
<td>Torr</td>
<td>-</td>
<td>SatSkinVapPress</td>
</tr>
<tr>
<td>Q<sub>c</sub></td>
<td>The rate of convective heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ConvHeatLoss</td>
</tr>
<tr>
<td>Q<sub>crsk</sub></td>
<td>Heat flow from core to skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>HeatFlow</td>
</tr>
<tr>
<td>Q<sub>dry</sub></td>
<td>Sensible heat flow from skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>DryHeatLoss</td>
</tr>
<tr>
<td>Q<sub>r</sub></td>
<td>The rate of radiative heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>RadHeatLoss</td>
</tr>
<tr>
<td>Q<sub>res</sub></td>
<td>The rate of respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>RespHeatLoss</td>
</tr>
<tr>
<td>S<sub>cr</sub></td>
<td>Heat storage in core compartment</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>CoreheatStorage</td>
</tr>
<tr>
<td>SET*</td>
<td>Standard Effective Temperature</td>
<td>°C</td>
<td>-</td>
<td>SET</td>
</tr>
<tr>
<td>SIG<sub>b</sub></td>
<td>Thermal signal of body</td>
<td>°C</td>
<td> </td>
<td>BodyThermSigCold
BodyThermSigWarm</td>
</tr>
<tr>
<td>SIG<sub>cr</sub></td>
<td>Thermal signal of core</td>
<td>°C</td>
<td> </td>
<td>CoreThermSigCold
CoreThermSigWarm</td>
</tr>
<tr>
<td>SIG<sub>sk</sub></td>
<td>Thermal signal of skin</td>
<td>°C</td>
<td> </td>
<td>SkinThermSigCold
SkinThermSigWarm</td>
</tr>
<tr>
<td>SKBF</td>
<td>Skin blood flow</td>
<td>L/m<sup>2</sup>hr</td>
<td> </td>
<td>SkinBloodFlow</td>
</tr>
<tr>
<td>S<sub>sk</sub></td>
<td>Heat storage in skin compartment</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>SkinHeatStorage</td>
</tr>
<tr>
<td>S<sub>tr</sub></td>
<td>Constriction constant of skin blood flow for average person</td>
<td> </td>
<td> </td>
<td>Str</td>
</tr>
<tr>
<td>SW<sub>reg</sub></td>
<td>The rate of regulatory sweating</td>
<td>g/m<sup>2</sup>hr</td>
<td> </td>
<td>RegSweat</td>
</tr>
<tr>
<td>T<sub>a</sub></td>
<td>Air temperature</td>
<td>°C</td>
<td>-</td>
<td>AirTemp</td>
</tr>
<tr>
<td>T<sub>b</sub></td>
<td>Mean body temperature</td>
<td> </td>
<td> </td>
<td>AvgBodyTemp</td>
</tr>
<tr>
<td>T<sub>b-c</sub></td>
<td>Mean body temperature when DISC is zero (lower limit)</td>
<td>°C</td>
<td> </td>
<td>AvgBodyTempLow</td>
</tr>
<tr>
<td>T<sub>b-h</sub></td>
<td>Mean body temperature when HSI is 100 (upper limit)</td>
<td>°C</td>
<td> </td>
<td>AvgBodyTempHigh</td>
</tr>
<tr>
<td>T<sub>cl</sub></td>
<td>Clothing surface temperature</td>
<td>°C</td>
<td>-</td>
<td>CloSurfTemp</td>
</tr>
<tr>
<td>T<sub>cr</sub></td>
<td>Core or internal temperature</td>
<td>°C</td>
<td>-</td>
<td>CoreTemp</td>
</tr>
<tr>
<td>T<sub>r</sub></td>
<td>Mean radiant temperature</td>
<td>°C</td>
<td>-</td>
<td>RadTemp</td>
</tr>
<tr>
<td>TSENS</td>
<td>Thermal sensation vote</td>
<td>-</td>
<td>-5~5</td>
<td>TSENS</td>
</tr>
<tr>
<td>T<sub>sk</sub></td>
<td>Skin temperature</td>
<td>°C</td>
<td> </td>
<td>SkinTemp</td>
</tr>
<tr>
<td>W</td>
<td>The rate of heat loss due to the performance of work</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>WorkEff</td>
</tr>
<tr>
<td>w<sub>dif</sub></td>
<td>Skin wettedness due to diffusion trough the skin</td>
<td> </td>
<td> </td>
<td>SkinWetDiff</td>
</tr>
<tr>
<td>w<sub>rsw</sub></td>
<td>Skin wettedness due to regulatory sweating</td>
<td> </td>
<td> </td>
<td>SkinWetSweat</td>
</tr>
<tr>
<td>e</td>
<td>The emissivity of clothing-skin surface</td>
<td>-</td>
<td>-</td>
<td>SkinEmiss</td>
</tr>
<tr>
<td>s</td>
<td>The Stefan-Boltzman constant (= 5.67×10<sup>-8</sup>)</td>
<td>W/m<sup>2</sup>K<sup>4</sup></td>
<td>-</td>
<td>StefanBoltz</td>
</tr>

</table>

#### Description of the model and algorithm

The Pierce model thermally lumps the human body as two isothermal, concentric compartments, one representing the internal section or core (where all the metabolic heat is assumed to be generated and the skin comprising the other compartment). This allows the passive heat conduction from the core compartment to the skin to be accounted for. The boundary line between two compartments changes with respect to skin blood flow rate per unit skin surface area (SKBF in L/h•m<sup>2</sup>) and is described by alpha – the fraction of total body mass attributed to the skin compartment (Doherty and Arens 1988).

<div>$$\alpha  = 0.0417737 + 0.7451832/(SKBF + 0.585417)$$</div>

SkinMassRat = 0.0417737 + 0.7451832/(SkinBloodFlow + 0.585417)

Furthermore, the model takes into account the deviations of the core, skin, and mean body temperature weighted by alpha from their respective setpoints. Thermoregulatory effector mechanisms (Regulatory sweating, skin blood flow, and shivering) are defined in terms of thermal signals from the core, skin and body (Doherty and Arens 1988).

<span>$SI{G_{cr}} = {T_{cr}} - 36.8$</span>                                                                    °C

<span>$SI{G_{sk}} = {T_{sk}} - 33.7$</span>                                                                    °C

<span>$SI{G_b} = {T_b} - 36.49$</span>                                                                    °C

SkinThermSigWarm = SkinTemp - SkinTempSet

SkinThermSigCold = SkinTempSet - SkinTemp

CoreThermSigWarm = CoreTemp - CoreTempSet

CoreThermSigCold = CoreTempSet - CoreTemp

BodyThermSigWarm = AvgBodyTemp - AvgBodyTempSet

BodyThermSigCold = AvgBodyTempSet-AvgBodyTemp

<span>$SKBF = (6.3 + C{}_{dil} \times SI{G_{cr}})/(1 + {S_{tr}} \times ( - SI{G_{sk}}))$</span>                      L/hr•m<sup>2</sup>

VasodilationFac = SkinBloodFlowConst\*CoreWarmDelTemp

VasoconstrictFac = Str\*SkinColdDelTemp

SkinBloodFlow = (6.3 + VasodilationFac)/(1. + VasoconstrictFac)

<span>$S{W_{reg}} = {C_{sw}}SI{G_b}{e^{(SI{G_{sk}}/10.7)}}$</span>                                                       g/hr•m<sup>2</sup>

RegSweat = SweatContConst\*BodyWarmDelTemp\*EXP(SkinWarmDelTemp/10.7)

<span>${M_{shiv}} = 19.4( - SI{G_{cr}})( - SI{G_{sk}})$</span>                                                 W/m<sup>2</sup>

ShivResponse = 19.4\*SkinThermSigCold\*CoreThermSigCold

The latest version of the Pierce model (Fountain and Huizenga 1997) discusses the concepts of SET\* and ET\*. The Pierce model converts the actual environment into a "standard environment" at a Standard Effective Temperature, SET\*. SET\* is the dry-bulb temperature of a hypothetical environment at 50% relative humidity for subjects wearing clothing that would be standard for the given activity in the real environment. Furthermore, in this standard environment, the same physiological strain, i.e. the same skin temperature and skin wettedness and heat loss to the environment, would exist as in the real environment. The Pierce model also converts the actual environment into a environment at an Effective Temperature, ET\*, that is the dry-bulb temperature of a hypothetical environment at 50% relative humidity and uniform temperature (Ta = MRT) where the subjects would experience the same physiological strain as in the real environment.

In the latest version of the model it is suggested that the classical Fanged PMV be modified by using ET\* or SET\* instead of the operative temperature. This gives a new index PMV\* which is proposed for dry or humid environments. It is also suggested that PMV\* is very responsive to the changes in vapor permeation efficiency of the occupants clothing.

<span>$M = {M_{act}} + {M_{shiv}}$</span>                                                                     W/m<sup>2</sup>

ActLevel = ActLevel + ActShiv

<span>$L = {Q_{res}} + {Q_{dry}} + {E_{sk}} + W$</span>                                                         W/m<sup>2</sup>

<span>$\begin{array}{l}{Q_{res}} = {E_{res}} + {C_{res}} = 0.0023M(44 - {P_{a(torr)}}) + 0.0014M(34 - {T_a})\\ = 0.017251M(5.8662 - {P_{a(kPa)}}) + 0.0014M(34 - {T_a})\end{array}$</span>W/m<sup>2</sup>

LatRespHeatLoss = 0.017251\*ActLevel\*(5.8662 - VapPress)

DryRespHeatLoss = 0.0014\*ActLevel\*(34.- AirTemp)

RespHeatLoss = LatRespHeatLoss + DryRespHeatLoss

<span>${Q_c} = {h_c} \times {f_{cl}}({T_{cl}} - {T_a})$</span>                                                               W/m<sup>2</sup>

<span>${Q_r} = {h_r} \times {f_{cl}}({T_{cl}} - {T_r})$</span>                                                               W/m<sup>2</sup>

<span>${Q_{dry}} = {Q_c} + {Q_r}$</span>                                                                         W/m<sup>2</sup>

DryHeatLoss = CloBodyRat\*(Hc\*(CloSurfTemp - AirTemp) + Hr\*(CloSurfTemp - RadTemp))

In Pierce model, the convective heat transfer coefficient, h<sub>c</sub>, varies with the air velocity around body and metabolic rate. The model uses the maximum value of following equations.

<span>${h_c} = 8.6 \times {v^{_{0.53}}}$</span>                                                                           W/m<sup>2</sup>°C

<span>${h_c} = 5.66{(M/58.2 - 0.85)^{0.39}}$</span>                                                  W/m<sup>2</sup>°C

Hc = 8.6\*AirVel\*\*0.53

HcAct = 5.66\*(ActMet - 0.85)\*\*0.39

Also, in the model, the radiant heat transfer coefficient, h<sub>r</sub>, is defined by following equation (Doherty and Arens 1988):

<span>${h_r} = 4. \times {f_{eff}}\varepsilon \sigma {(({T_{cl}} + {T_r})/2 + 273.15)^3}$</span>                                    W/m<sup>2</sup>°C

Hr = 4.\*RadSurfEff\*StefanBoltz\*((CloSurfTemp + RadTemp)/2. + TAbsConv)\*\*3

In the Pierce model, T<sub>cl</sub> is estimated by each iteration using following equation:

<span>${T_{cl}} = ({T_{sk}}/{I_{cl}} + {f_{cl}}({h_c}{T_a} - {h_r}{T_r}))/(1/{I_{cl}} + {f_{cl}}({h_c} + {h_r}))$</span>              °C

CloSurfTemp = (CloCond\*SkinTemp + CloBodyRat\*(Hc\*AirTemp &

+ Hr\*RadTemp))/(CloCond + CloBodyRat\*(Hc + Hr))

Total evaporative heat loss from the skin, E<sub>sk</sub>, includes evaporation of water produced by regulatory sweating, E<sub>rsw</sub>, and evaporation of water vapor that diffuses through the skin surface, E<sub>diff</sub>.

<span>${E_{sk}} = {E_{rsw}} + {E_{diff}}$</span>                                                                      W/m<sup>2</sup>

EvapHeatLoss = EvapHeatLossRegSweat + EvapHeatLossRegDiff

<span>${E_{rsw}} = 0.68 \times S{W_{reg}}$</span>                                                                  W/m<sup>2</sup>

<span>${E_{diff}} = {w_{diff}} \times {E_{\max }}$</span>                                                                    W/m<sup>2</sup>

RegHeatLoss = 0.68\*RegSweat

DiffHeatLoss = SkinWetDiff\*MaxEvapHeatLoss

Where,

0.68 is the passive water vapor diffusion rate in g/h·m<sup>2</sup>·Torr

and,

<div>$${w_{diff}} = 0.06(1 - {w_{rsw}})$$</div>

<span>${E_{\max }} = {h_e}'({P_{sk}} - {P_a})$</span>                                                                 W/m<sup>2</sup>

<div>$${w_{rsw}} = {E_{rsw}}/{E_{\max }}$$</div>

SkinWetDiff = (1.-SkinWetSweat)\*.06

MaxEvapHeatLoss = (1./TotEvapHeatResist)\*(SatSkinVapPress - VapPress)

SkinWetSweat = EvapHeatLossRegSweat/MaxEvapHeatLoss

The Pierce model has one additional heat flow term describing the heat transfer between the internal core compartment and the outer skin shell (Doherty and Arens 1988).

<span>${Q_{crsk}} = (5.28 + 1.163SKBF)({T_{cr}} - {T_{sk}})$</span>                                     W/m<sup>2</sup>

HeatFlow = (CoreTemp-SkinTemp)\*(5.28 + 1.163\*SkinBloodFlow)

Where

5.28 is the average body tissue conductance in W/m<sup>2</sup>•°C

1.163 is the thermal capacity of blood in W•h/L•°C

Thus, individual heat balance equations for core and skin compartments are expressed using this term, Q<sub>c-s</sub>. New temperatures of core, skin and body are calculated by each iteration from rates of heat storage in the core and skin.

<span>${S_{sk}} = {Q_{c - s}} - {Q_c} - {Q_r} - {E_{sk}}$</span>                                                        W/m<sup>2</sup>°C

SkinHeatStorage = HeatFlow - DryHeatLoss - EvapHeatLoss

<span>${S_{cr}} = M - W - {Q_{res}} - {Q_{c - s}}$</span>                                                        W/m<sup>2</sup>°C

CoreHeatStorage = IntHeatProd - RespHeatLoss  - HeatFlow

Thus,

<div>$$PMVET = (0.303{e^{ - 0.036M}} + 0.028)(H - {L_{ET*}})$$</div>

<div>$$PMVSET = (0.303{e^{ - 0.036M}} + 0.028)(H - {L_{SET*}})$$</div>

ThermSensTransCoef = 0.303\*EXP(-0.036\*ActLevel) + 0.028

PMVET = ThermSensTransCoef\*(IntHeatProd - EvapHeatLossDiff  &

- EvapHeatLossRegComf - RespHeatLoss - DryHeatLossET)

PMVSET = ThermSensTransCoef\*(IntHeatProd - EvapHeatLossDiff  &

- EvapRegHeatLossReg Comf - RespHeatLoss - DryHeatLossSET)

Besides PMV\*, the Pierce Two Node Model uses the indices TSENS and DISC as predictors of thermal comfort. Where TSENS is the classical index used by the Pierce foundation, and is a function of the mean body temperature. DISC is defined as the relative thermoregulatory strain that is needed to bring about a state of comfort and thermal equilibrium. DISC is a function of the heat stress and heat strain in hot environments and equal to TSENS in cold environments. In summary, the Pierce Model, for our purposes, uses four thermal comfort indices; PMVET-a function of ET\*, PMVSET- a function of SET\*, TSENS and DISC.

<span>${T_{b - c}} = (0.185/58.2)(M - W) + 36.313$</span>                                    °C

<span>${T_{b - h}} = (0.359/58.2)(M - W) + 36.664$</span>                                    °C

<span>$TSEN{S_c} = 0.68175({T_b} - {T_{b - c}})$</span>                                                  <span>${T_b} \le {T_{b - c}}$</span>

<span>$TSEN{S_h} = 4.7({T_b} - {T_{b - c}})/({T_{b - h}} - {T_{b - c}})$</span>                                      <span>${T_b} > {T_{b - c}}$</span>

<div>$$DISC = 5.({E_{rsw}} - {E_{rsw - comf}})/({E_{\max }} - {E_{rsw - comf}} - {E_{diff}})$$</div>

AvgBodyTempLow = (0.185/ActLevelConv)\*IntHeatProd + 36.313

AvgBodyTempHigh = (0.359/ActLevelConv)\*IntHeatProd + 36.664

TSENS = .68175\*(AvgBodyTemp-AvgBodyTempLow)

TSENS = 4.7\*(AvgBodyTemp - AvgBodyTempLow)/ &

(AvgBodyTempHigh - AvgBodyTempLow)

DISC = 5.\*(EvapHeatLossRegSweat - EvapHeatLossRegComf)/ &

(MaxEvapHeatLoss - EvapHeatLossRegComf - DiffHeatLoss)

### KSU Two-Node Model

The KSU two-node model, developed at Kansas State University, was published in 1977 (Azer and Hsu 1977). The KSU model is quite similar to that of the Pierce Foundation. The main difference between the two models is that the KSU model predicts thermal sensation (TSV) differently for warm and cold environment.

#### KSU Two Node Model Nomenclature List

Table 83.  Nomenclature list for KSU Two-Node model

<table class="table table-striped">








<tr>
<td>Mathematical variable</td>
<td>Description</td>
<td>Units
 </td>
<td>Range</td>
<td>FORTRAN variable</td>
</tr>
<tr>
<td>C<sub>cr</sub></td>
<td>Specific heat of body core</td>
<td>Whr/kg°C</td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>C<sub>sk</sub></td>
<td>Specific heat of skin</td>
<td>Whr/kg°C</td>
<td> </td>
<td> </td>
</tr>
<tr>
<td>C<sub>res</sub></td>
<td>The rate of dry respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>DryRespHeatLoss</td>
</tr>
<tr>
<td>E<sub>dif</sub></td>
<td>The rate of heat loss from the diffusion of water vapor through the skin</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>EvapHeatLossDiff</td>
</tr>
<tr>
<td>E<sub>max</sub></td>
<td>Maximum evaporative heat loss</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLossMax</td>
</tr>
<tr>
<td>E<sub>sk</sub></td>
<td>Total evaporative heat loss from skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLoss</td>
</tr>
<tr>
<td>E<sub>sw</sub></td>
<td>Equivalent evaporation heat loss from the sweat secreted</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>EvapHeatLossSweat</td>
</tr>
<tr>
<td>E<sub>sw.d</sub></td>
<td>Sweat function for warm and dry skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>DrySweatRate</td>
</tr>
<tr>
<td>E<sub>res</sub></td>
<td>The rate of latent respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>LatRespHeatLoss</td>
</tr>
<tr>
<td>F<sub>cl</sub></td>
<td>The Burton thermal efficiency factor for clothing</td>
<td> </td>
<td>-</td>
<td>CloThermEff</td>
</tr>
<tr>
<td>F<sub>pcl</sub></td>
<td>Permeation efficiency factor for clothing</td>
<td> </td>
<td>-</td>
<td>CloPermeatEff</td>
</tr>
<tr>
<td>H</td>
<td>Internal heat production rate of an occupant per unit area
= M - W</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>IntHeatProd</td>
</tr>
<tr>
<td>H</td>
<td>Combined heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td> </td>
<td>H</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>Convective heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td>-</td>
<td>Hc</td>
</tr>
<tr>
<td>h<sub>r</sub></td>
<td>Radiant heat transfer coefficient</td>
<td>W/m<sup>2</sup>°C</td>
<td>-</td>
<td>Hr</td>
</tr>
<tr>
<td>KS</td>
<td>Overall skin thermal conductance</td>
<td>W/m<sup>2</sup>°C</td>
<td> </td>
<td>ThermCndct</td>
</tr>
<tr>
<td>KS<sub>o</sub></td>
<td>Skin conductance at thermal neutrality</td>
<td>W/m<sup>2</sup>°C</td>
<td> </td>
<td>ThermCndctNeut</td>
</tr>
<tr>
<td>KS<sub>(-4)</sub></td>
<td>Skin conductance at thermal sensation very cold</td>
<td>W/m<sup>2</sup>°C</td>
<td> </td>
<td>ThermCndctMin</td>
</tr>
<tr>
<td>M</td>
<td>Metabolic rate per unit area</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ActLevel</td>
</tr>
<tr>
<td>M<sub>shiv</sub></td>
<td>Metabolic heat production due to shivering</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>ShivResponse</td>
</tr>
<tr>
<td>P<sub>a</sub></td>
<td>Water vapor pressure in ambient air</td>
<td>Torr</td>
<td>-</td>
<td>VapPress</td>
</tr>
<tr>
<td>P<sub>sk</sub></td>
<td>Saturated water vapor pressure at required skin temperature</td>
<td>Torr</td>
<td>-</td>
<td>SatSkinVapPress</td>
</tr>
<tr>
<td>PT<sub>accl</sub></td>
<td>The pattern of acclimation</td>
<td> </td>
<td> </td>
<td>AcclPattern</td>
</tr>
<tr>
<td>Q<sub>c</sub></td>
<td>The rate of convective heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>ConvHeatLoss</td>
</tr>
<tr>
<td>Q<sub>dry</sub></td>
<td>Sensible heat flow from skin</td>
<td>W/m<sup>2</sup></td>
<td> </td>
<td>DryHeatLoss</td>
</tr>
<tr>
<td>Q<sub>r</sub></td>
<td>The rate of radiative heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>RadHeatLoss</td>
</tr>
<tr>
<td>Q<sub>res</sub></td>
<td>The rate of respiratory heat loss</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>RespHeatLoss</td>
</tr>
<tr>
<td>RH</td>
<td>Relative humidity</td>
<td> </td>
<td> </td>
<td>RelHum</td>
</tr>
<tr>
<td>T<sub>a</sub></td>
<td>Air temperature</td>
<td>°C</td>
<td>-</td>
<td>AirTemp</td>
</tr>
<tr>
<td>T<sub>cr</sub></td>
<td>Core or internal temperature</td>
<td>°C</td>
<td>-</td>
<td>CoreTemp</td>
</tr>
<tr>
<td>T<sub>o</sub></td>
<td>Operative temperature</td>
<td>°C</td>
<td>-</td>
<td>OpTemp</td>
</tr>
<tr>
<td>T<sub>r</sub></td>
<td>Mean radiant temperature</td>
<td>°C</td>
<td>-</td>
<td>RadTemp</td>
</tr>
<tr>
<td>T<sub>sk</sub></td>
<td>Skin temperature</td>
<td>°C</td>
<td> </td>
<td>SkinTemp</td>
</tr>
<tr>
<td>TSV</td>
<td>Thermal sensation vote</td>
<td> </td>
<td>-4~4</td>
<td>TSV</td>
</tr>
<tr>
<td>V</td>
<td>Relative air velocity</td>
<td>m/s</td>
<td>-</td>
<td>AirVel</td>
</tr>
<tr>
<td>W</td>
<td>The rate of heat loss due to the performance of work</td>
<td>W/m<sup>2</sup></td>
<td>-</td>
<td>WorkEff</td>
</tr>
<tr>
<td>W</td>
<td>Skin wettedness</td>
<td>-</td>
<td>-</td>
<td>SkinWet</td>
</tr>
<tr>
<td>W<sub>cr</sub></td>
<td>Mass of body core per unit body surface</td>
<td>kg/m<sup>2</sup></td>
<td> </td>
<td>-</td>
</tr>
<tr>
<td>w<sub>rsw</sub></td>
<td>Skin wettedness due to regulatory sweating</td>
<td> </td>
<td> </td>
<td>SkinWetSweat</td>
</tr>
<tr>
<td>w<sub>rsw-o</sub></td>
<td>Skin wettedness at thermal neutrality</td>
<td> </td>
<td> </td>
<td>SkinWetSweatNeut</td>
</tr>
<tr>
<td>W<sub>sk</sub></td>
<td>Mass of skin per unit body surface</td>
<td>kg/m<sup>2</sup></td>
<td> </td>
<td>-</td>
</tr>

</table>

#### Description of the model and algorithm

The KSU two-node model is based on the changes that occur in the thermal conductance between the core and the skin temperature in cold environments, and in warm environments it is based on changes in the skin wettedness.

In this model metabolic heat production is generated in the core which exchanges energy with the environment by respiration and the skin exchanges energy by convection and radiation. In addition, body heat is dissipated through evaporation of sweat and/or water vapor diffusion through the skin. These principles are used in following passive system equations.

<span>${W_{cr}}{C_{cr}}d{T_{cr}}/dt = M - W - {Q_{res}} - KS({T_{cr}} - {T_{sk}})$</span>                         W/m<sup>2</sup>

<span>${W_{sk}}{C_{sk}}d{T_{sk}}/dt = KS({T_{cr}} - {T_{sk}}) - {Q_{dry}} - {E_{sk}}$</span>                               W/m<sup>2</sup>

Where

<span>${Q_{res}} = {E_{res}} + {C_{res}} = 0.0023M(44 - {P_{a(torr)}}) + 0.0014M(34 - {T_a})$</span>               W/m<sup>2</sup>

LatRespHeatLoss = 0.0023\*ActLevelTot\*(44. - VapPress)

DryRespHeatLoss = 0.0014\*ActLevelTot\*(34. - AirTemp)

RespHeatLoss = LatRespHeatLoss + DryRespHeatLoss

<span>${Q_{dry}} = {Q_c} + {Q_r} = {h_{}}{f_{cl}}{F_{cl}}({T_{sk}} - {T_o})$</span>                                           W/m<sup>2</sup>

DryHeatLoss = H\*CloBodyRat\*CloThermEff\*(SkinTemp - OpTemp)

<span>$h = {h_c} + {h_r}$</span>                                                                               W/m<sup>2</sup>°C

<span>${h_c} = 8.3\sqrt v $</span>                                                                              W/m<sup>2</sup>°C

<span>${h_r} = 3.87 + 0.031{T_r}$</span>                                                                  W/m<sup>2</sup>°C

H = Hc + Hr

Hc = 8.3\*SQRT(AirVel)

Hr = 3.87 + 0.031\*RadTemp

<span>${T_o} = ({h_c}{T_a} + {h_r}{T_r})/({h_c} + {h_r})$</span>                                                      °C

OpTemp = (Hc\*AirTemp + Hr\*RadTemp)/H

and

For <span>${E_{sw}} \le {E_{\max }}$</span>, <span>${E_{sk}} = {E_{sw}} + (1 - {w_{rsw}}){E_{diff}}$</span>                               W/m<sup>2</sup>

For <span>${E_{sw}} > {E_{\max }}$</span>, <span>${E_{sk}} = {E_{\max }}$</span>                                                      W/m<sup>2</sup>

<span>${E_{diff}} = 0.408({P_{sk}} - {P_a})$</span>                                                             W/m<sup>2</sup>

<span>${E_{\max }} = 2.2{h_c}{F_{pcl}}({P_{sk}} - {P_a})$</span>                                                        W/m<sup>2</sup>

EvapHeatLoss = SkinWetSweat\*EvapHeatLossMax+(1. - SkinWetSweat)\*EvapHeatLossDiff

SkinWetSweat = EvapHeatLossDrySweat/EvapHeatLossMax

EvapHeatLossDiff = 0.408\*(SkinVapPress - VapPress)

EvapHeatLossMax = 2.2\*Hc\*(SkinVapPress - VapPress)\*CloPermeatEff

Here, control signals, based on setpoint temperatures in the skin and core, are introduced into passive system equations and these equations are integrated numerically for small time increments or small increments in core and skin temperature. The control signals modulate the thermoregulatory mechanism and regulate the peripheral blood flow, the sweat rate, and the increase of metabolic heat by active muscle shivering. The development of the controlling functions of skin conductance (KS), sweat rate (E<sub>sw</sub>), and shivering (M<sub>shiv</sub>) is based on their correlation with the deviations in skin and core temperatures from their setpoints.

<div>$$\begin{array}{l}KS = 5.3 + [6.75 + 42.45({T_{cr}} - 36.98) + 8.15{({T_{cr}} - 35.15)^{0.8}}({T_{sk}} - 33.8)]\\/[1.0 + 0.4(32.1 - {T_{sk}})]\end{array}$$</div>

SkinCndctDilation = 42.45\*CoreSignalWarmMax &

+ 8.15\*CoreSignalSkinSens\*\*0.8\*SkinSignalWarmMax

SkinCndctConstriction = 1.0 + 0.4\*SkinSignalColdMax

ThermCndct = 5.3+(6.75+SkinCndctDilation)/SkinCndctConstriction

<div>$$\begin{array}{l}{E_{sw}} = \phi  \times [260({T_{cr}} - 36.9) + 26({T_{sk}} - 33.8)]\exp [({T_{sk}} - 33.8)/8.5]\\/[1.0 + 0.05{(33.37 - {T_{sk}})^{2.4}}]\end{array}$$</div>

WeighFac = 260.+70.\*AcclPattern

SweatCtrlFac = 1. + 0.05\*SkinSignalSweatColdMax\*\*2.4

DrySweatRate = ((WeighFac\*CoreSignalSweatMax &

+ 0.1\*WeighFac\*SkinSignalSweatMax) &

\*EXP(SkinSignalSweatMax/8.5))/SweatCtrlFac

Where

<span>$\phi  = 1.0$</span>                                                                                    <span>$w \le 0.4$</span>

<span>$\phi  = 0.5 + 0.5\exp [ - 5.6(w - 0.4)]$</span>                                              <span>$w > 0.4$</span>

SweatSuppFac = 1.

SweatSuppFac = 0.5 + 0.5\*EXP(-5.6\*SkinWetSignal)

<span>${M_{shiv}} = 20(36.9 - {T_{cr}})(32.5 - {T_{sk}}) + 5(32.5 - {T_{sk}})$</span>                     W/m<sup>2</sup>

ShivResponse = 20.\*CoreSignalShivMax\*SkinSignalShivMax + 5.\*SkinSignalShivMax

In KSU model, two new parameters are introduced and used in correlating thermal sensations with their associated physiological responses. In stead of correlating warm thermal sensations with skin wettedness, it is here correlated with a wettedness factor defined by

<div>$${\varepsilon_{wsw}} = ({w_{rsw}} - {w_{rsw - o}})/(1.0 - {w_{rsw - o}})$$</div>

SkinWetFac = (SkinWetSweat - SkinWetNeut)/(1. - SkinWetNeut)

Where

<div>$${w_{wsw}} = {E_{sw}}/{E_{\max }}$$</div>

<div>$${w_{wsw - o}} = 0.2 + 0.4\{ 1.0 - \exp [ - 0.6(H/58.2 - 1.0)]\} $$</div>

SkinWetSweat = DrySweatRate/EvapHeatLossMax

SkinWetNeut = 0.02 + 0.4\*(1.-EXP(-0.6\*(IntHeatProdMetMax - 1.)))

and instead of correlating cold thermal sensation with the skin temperature, it is here correlated with a factor identified as vasoconstriction factor defined by

<div>$${\varepsilon_{vc}} = (K{S_o} - KS)/(K{S_o} - K{S_{( - 4)}})$$</div>

VasoconstrictFac = (ThermCndctNeut - ThermCndct) &

/(ThermCndctNeut - ThermCndctMin)

Thus, TSV in the cold is a function of a vasoconstriction factor (ε<sub>vc</sub>) as:

<div>$$TSV =  - 1.46 \times {\varepsilon_{vc}} + 3.75 \times {\varepsilon_{vc}}^2 - 6.17 \times {\varepsilon_{vc}}^3$$</div>

TSV = -1.46153\*VasoconstrictFac + 3.74721\*VasoconstrictFac\*\*2 &

                 - 6.168856\*VasoconstrictFac\*\*3

and for the warm environments, TSV is defined as:

<div>$$TSV = [5.0 - 6.56(RH - 0.5)] \times {\varepsilon_{wsw}}$$</div>

TSV = (5. - 6.56\*(RelHum - 0.50))\*SkinWetFac

The KSU model's TSV was developed from experimental conditions in all temperature ranges and from clo levels between .05 clo to 0.7 clo and from activities levels of 1 to 6 mets (Berglund 1978).

**Adaptive Comfort Model**

Adaptive comfort model, intended for use in naturally ventilated buildings, determines the acceptability of indoor conditions given the monthly mean outdoor air temperature and the indoor operative temperature. This is used as an index for occupant adaptation to outdoor conditions, and determines the acceptability of indoor conditions. The model also accounts for people’s clothing adaptation in naturally conditioned spaces by relating the acceptable range of indoor temperatures to the outdoor climate, so it is not necessary to estimate the clothing values for the space. No humidity or air-speed limits are required when this option is used. This section summarizes the adaptive comfort models based on the ASHRAE Standard 55-2010 and CEN 15251. Details are available in the two standards.

**Adaptive Comfort Model Based on ASHRAE Standard 55-2010**

In ASHRAE Standard 55, the monthly mean outdoor air temperature, used in the adaptive comfort model, is defined as the simple running average of the previous thirty daily average outdoor air temperatures.

The model defines two comfort regions: 80% Acceptability, and 90% Acceptability. If the monthly mean outdoor air temperature is not within the specified domain, the model is not applicable.

![](EngineeringReference/media/image6814.png)

Figure 302. Acceptable operative temperature ranges for naturally conditioned spaces (ASHRAE Standard 55-2010)

The central line of the model (shown in red), or comfort temperature, is defined as

<div>$${T_{ot}} = 0.31\cdot {T_o} + 17.8$$</div>

Where

T<sub>ot</sub> – operative temperature (°C), calculated as the average of the indoor air dry-bulb temperature and the mean radiant temperature of zone inside surfaces

T<sub>o</sub> – monthly mean outdoor air dry-bulb temperature (°C).

If the .stat file is provided for the simulation, T<sub>o</sub> is drawn directly from the daily average temperatures in the .stat file, which provides a value for each month.  If no .stat file is provided, the monthly mean outdoor temperature is a simple running average of the previous thirty daily average temperatures, calculated directly from the weather file (.epw):

<div>$${T_o} = \frac{{\left( {{T_{od - 1}} + {T_{od - 2}} + ... + {T_{od - 30}}} \right)}}{{30}}$$</div>

<div>$${T_o} = (1 - \alpha )\cdot {T_{od - 1}} + \alpha \cdot {T_{od - 1}}$$</div>

<div>$$\alpha  = \frac{{29}}{{30}}$$</div>

T<sub>od-i</sub> is defined as the daily average temperature of the i<sup>th</sup> previous day.

Note that the weather file must be a standard .epw containing a full year of data.

The comfort regions for 80% and 90% acceptability are symmetric about the central line.

90% Acceptability Limits: T<sub>ot</sub> = 0.31\* T<sub>o</sub> + 17.8± 2.5

80% Acceptability Limits: T<sub>ot</sub> = 0.31\* T<sub>o</sub> + 17.8± 3.5

If, using either method, T<sub>o</sub> is less than 10°(C) or greater than 33.5°(C), the model is not applicable.

For a detailed description of this model, please see *ASHRAE Standard 55-2010, Thermal Environmental Conditions for Human Occupancy*.

### Adaptive Comfort Model Based on European Standard EN15251-2007

The EN15251-2007 is similar to ASHRAE 55-2010, but with slightly different curves of the indoor operative temperature and acceptability limits (Fig. 2). The model, intended for use in naturally ventilated buildings, determines the acceptability of indoor conditions given the 7-day weighted mean outdoor air temperature and the indoor operative temperature. The 7-day weighted mean outdoor air temperature (T<sub>rm</sub>) is defined as the weighted running average of the previous 7 daily average outdoor air temperatures.

This weighted running average is calculated from a full annual weather file that must be specified for the simulation. This is used as an index for occupant adaptation to outdoor conditions, and determines the acceptability of indoor conditions. The model also accounts for people’s clothing adaptation in naturally conditioned spaces by relating the acceptable range of indoor temperatures to the outdoor climate, so it is not necessary to estimate the clothing values for the space. No humidity or air-speed limits are required when this option is used. The model defines three comfort regions: Category I (90%) Acceptability, Category II (80%) Acceptability, and Category III (65%) Acceptability. If T<sub>rm</sub> is not within the specified domain, the model is not applicable.

![](EngineeringReference/media/image6819.png)

Figure 303. Categories for European Standard EN15251-2007



![](EngineeringReference/media/image6820.png)

Figure 304. Acceptable operative temperature ranges for naturally conditioned spaces (CEN EN15251-2007)

Central line (shown as redFigure 304): Tot = 0.33\*To + 18.8

Category I, 90% Acceptability Limits: Tot = 0.33\*To + 18.8± 2.0

Category II, 80% Acceptability Limits: Tot = 0.33\*To + 18.8± 3.0

Category III, 65% Acceptability Limits: Tot = 0.33\*To + 18.8± 4.0

For 10°(C) &lt; T<sub>rm</sub> &lt; 15°(C), the comfort temperature of the lower boundaries of the comfort regions is T<sub>comf</sub> = 23.75°(C). That is, the lower boundaries are constant according to the same ranges above:

Category I, 90% Acceptability Limits: Tot = 23.75- 2.0

Category II, 80% Acceptability Limits: Tot = 23.75 - 3.0

Category III, 65% Acceptability Limits: Tot = 23.75 -4.0

Where

Tot – operative temperature (°C) , calculated as the average of the indoor air dry-bulb temperature and the mean radiant temperature of zone inside surfaces

To – mean outdoor air dry-bulb temperature (°C), calculated as the weighted mean of the previous 7-day daily mean outdoor air dry-bulb temperature (T<sub>od</sub>):

T<sub>o</sub> = (1 - α)\*{T<sub>od-1</sub> + α \*T<sub>od-2</sub> + α<sup>2</sup> \*T<sub>od-3</sub> + α<sup>3</sup> \*T<sub>od-4</sub> + α<sup>4</sup> \*T<sub>od-5</sub> + α<sup>5</sup> \*T<sub>od-6</sub> + α<sup>6</sup> \*T<sub>od-7</sub>}

T<sub>o</sub> = (1 - α)\*T<sub>od-1</sub> + α \*T<sub>o-1</sub>

α  = 0.8

### Dynamic Clothing Model

In most building energy simulations, thermal comfort condition is calculated based on the assumption that the clothing insulation is equal to a constant value of 0.5 clo during the cooling season and 1.0 clo during heating season. Usually those two values are used and the change from 0.5 to 1 or vice-versa is made suddenly from one day to another. In addition, there is no standardized guideline on how to set clothing insulation schedules in the international standards. This simplified assumption may lead to systems that are incorrectly sized and operated and to the incorrect assessment of comfort conditions. In reality, occupants frequently adjust their clothing depending on the thermal conditions around them, as opposed to the assumption of constant clothing values. Therefore, the clothing insulation variation should be captured during the building simulation to realistically model HVAC systems. In order to overcome the limitations of the constant clothing insulation assumption, three new predictive clothing insulation models were developed by Schiavon and Lee (2012) based on 6,333 selected observations taken from ASHRAE RP-884 and RP-921 databases. The first and third models vary the clothing insulation as a function of outdoor air temperature measured at 6 o’clock and the second model takes into account both 6 o’clock outdoor air temperature and indoor operative temperature when adjusting the clothing insulation. The dynamic clothing models should be implemented in dynamic building energy simulation.

The model proposed to ASHRAE 55 is described below.

For t<sub>a(out,6) </sub> &lt; -5°C, <span>${I_{cl}} = 1$</span>.00

For -5°C ≤ t<sub>a(out,6)</sub> &lt; 5°C, <span>${I_{cl}} = 0.818 - 0.0364{\rm{*}}{t_{a\left( {out,6} \right)}}$</span>

For 5°C ≤ t<sub>a(out,6)</sub> &lt; 26°C <span>${I_{cl}} = {10^{\left( { - 0.1635 - 0.0066{\rm{*}}{t_{a\left( {out,6} \right)}}} \right)}}$</span>

or t<sub>a(out,6)</sub> ≥ 26°C <span>${I_{cl}} = 0.46$</span>

Where, *I<sub>cl</sub>* is the clothing insulation value, *t<sub>a(out,\\ 6)</sub>* is the outdoor air temperature measured at 6 o’clock in the morning. The following figure illustrates the proposed clothing insulation model.

![](EngineeringReference/media/image6825.png)

Figure 305. Clothing Schedule Illustration

In the figure above, clothing insulation schedule for a fixed model (blue) typically used in energy simulation software and for the clothing model based on outdoor air temperature measured at 6 o’clock. Climate data for Chicago O’hare International Airport has been used.

The following figure illustrates the new clothing insulation model.

![](EngineeringReference/media/image6826.png)

Figure 306. Graphical representation of the proposed clothing insulation model

The dynamic predictive clothing insulation model is implemented into EnergyPlus for realistic energy simulation. Addenda A to ASHRAE 55 with the clothing model has been approved by the ASHRAE committee and the chance to be included in ASHRAE 55-2013 is high.

#### References

Schiavon S, Lee KH. 2013. Dynamic predictive clothing insulation models based on outdoor air and indoor operative temperatures. Building and Environment. Volume 59, 250-260. [http://dx.doi.org/10.1016/j.buildenv.2012.08.024](http://dx.doi.org/10.1016/j.buildenv.2012.08.024)  (link to the journal) [http://escholarship.org/uc/item/3338m9qf](http://escholarship.org/uc/item/3338m9qf)  (link to the freely available pre-print version)

Lee KH, Schiavon S. 2013. Influence of three dynamic predictive clothing insulation models on building energy use, HVAC sizing and thermal comfort. Submitted to Journal. [http://escholarship.org/uc/item/3sx6n876](http://escholarship.org/uc/item/3sx6n876)  (link to the freely available pre-print version)

### Mean Radiant Temperature Calculation

There are three options to calculate mean radiant temperature in the thermal comfort models. One is the zone averaged MRT, another is the surface weighted MRT, and the other is angle factor MRT. The zone averaged MRT is calculated on the assumption that a person is in the center of a space, whereas the surface weighted MRT is calculated in consideration of the surface that a person is closest to, and the angle factor MRT is calculated based on angle factors between a person and the different surfaces in a space. Here, the surface weighted MRT is the average temperature of the selected surface and zone averaged MRT and is intended to represent conditions in the limit as a person gets closer and closer to a particular surface.  In that limit, half of the person’s radiant field will be dominated by that surface and the other half will be exposed to the rest of the zone.  Note that the surface weighted MRT is only an approximation. The angle factor MRT is the mean temperature of the surrounding surface temperatures weighted according to the magnitude of the respective angle factors and allows the user to more accurately predict thermal comfort at a particular location within a space.

Table 84.  Nomenclature and variable list for MRT calculation

<table class="table table-striped">








<tr>
<td>Mathematical variable</td>
<td>Description</td>
<td>Units
 </td>
<td>Range</td>
<td>FORTRAN variable</td>
</tr>
<tr>
<td>T<sub>r</sub></td>
<td>Mean radiant temperature</td>
<td>°C</td>
<td>-</td>
<td>RadTemp</td>
</tr>
<tr>
<td>T<sub>r-avg</sub></td>
<td>Zone averaged radiant temperature</td>
<td>°C</td>
<td>-</td>
<td>ZoneRadTemp</td>
</tr>
<tr>
<td>T<sub>surf</sub></td>
<td>Surface temperature</td>
<td>°C</td>
<td>-</td>
<td>SurfaceTemp</td>
</tr>
<tr>
<td>F<sub>surf</sub></td>
<td>Angle factor between person and surface</td>
<td>-</td>
<td>0~1</td>
<td>AngleFactor</td>
</tr>

</table>

#### Description of the model and algorithm

The zone averaged MRT is calculated without weighting any surface temperature of the space.

<div>$${T_r} = {T_{r - avg}}$$</div>

RadTemp = MRT(ZoneNum)

The surface weighted MRT is the average temperature of the zone averaged MRT and the temperature of the surface that a person is closest to.

<div>$${T_r} = ({T_{r - avg}} + {T_{surf}})/2$$</div>

ZoneRadTemp = MRT(ZoneNum)

SurfaceTemp = GetSurfaceTemp(People(PeopleNum)%SurfacePtr)

RadTemp = (ZoneRadTemp + SurfaceTemp)/2.0

The angle factor MRT is the mean value of surrounding surface temperatures weighted by the size of the respective angle factors between a person and each surface.

<div>$${T_r} = {T_{surf - 1}}{F_{surf - 1}} + {T_{surf - 2}}{F_{surf - 2}} + ......... + {T_{surf - n}}{F_{surf - n}}$$</div>

SurfTempAngleFacSummed = SurfTempAngleFacSummed &

+ SurfaceTemp \* AngleFactorList(AngleFacNum)%AngleFactor(SurfNum)

RadTemp = SurfTempAngleFacSummed

### References

ASHRAE. 1984. “High Intensity Infrared Radiant Heating”, 1984 Handbook of Systems and Equipment, American Society of Heating, Refrigerating and Air Conditioning Engineers, Atlanta, GA, Chapter 18.

ASHRAE. 1985. “Physiological Principles for Comfort and Health,” 1985 Handbook of Fundamentals, American Society of Heating, Refrigerating and Air Conditioning Engineers, Atlanta, GA, Chapter 8.

ASHRAE. 1993. “Physiological Principles and Thermal Comfort”, 1993 ASHRAE Handbook of Fundamentals, American Society of Heating, Refrigerating and Air Conditioning Engineers, Atlanta, GA, Chapter 8.

ASHRAE. 2010. “Standard 55-2010 -- Thermal Environmental Conditions for Human Occupancy (ANSI approved)”, American Society of Heating, Refrigerating and Air Conditioning Engineers, Atlanta, GA.

Azer, N.Z., Hsu, S. 1977. “The prediction of Thermal Sensation from Simple model of Human Physiological Regulatory Response”, ASHRAE Trans., Vol.83, Pt 1.

Berglund, Larry. 1978. “Mathematical Models for Predicting the Thermal Comfort Response of Building Occupants”, ASHRAE Trans., Vol.84.

Doherty, T.J., Arens, E. 1988. “Evaluation of the Physiological Bases of Thermal Comfort Models”, ASHRAE Trans., Vol.94, Pt 1.

Du Bois, D. and E.F. 1916. “A Formula to Estimate Approximate Surface Area, if Height and Weight are Known”, Archives of internal Medicine, Vol.17.

CEN. 2007. “Standard EN15251 Indoor environmental input parameters for design and assessment of energy performance of buildings addressing indoor air quality, thermal environment, lighting and acoustics”. Bruxelles: European committee for Standardisation.

Fanger, P.O. 1970. Thermal Comfort-Analysis and Applications in Environmental Engineering, Danish Technical Press, Copenhagen.

Fanger, P.O. 1986. “Radiation and Discomfort”, ASHRAE Journal. February 1986.

Fanger P.O. 1967. “Calculation of Thermal Comfort: Introduction of a Basic Comfort Equation”, ASHRE Trans., Vol.73, Pt 2.

Fountain, Marc.E., Huizenga, Charlie. 1997 “A Thermal Sensation Prediction Tool for Use by the Profession”, ASHRAE Trans., Vol.103, Pt 2.

Gagge, A.P., Stolwijk, J. A. J., Nishi, Y. 1970. “An Effective Temperature Scale Based on a Simple Model of Human Physiological Regulatory Response”, ASHRAE Trans., Vol.70, Pt 1.

Gagge, A.P., Fobelets, A.P., Berglund, L. G. 1986. “A Standard Predictive Index of Human Response to the Thermal Environment”,  ASHRAE Trans., Vol.92, Pt 2.

Hsu, S. 1977. “A Thermoregulatory Model for Heat Acclimation and Some of its Application”, Ph. D. Dissertation, Kansas State University.

Int-Hout, D. 1990. “Thermal Comfort Calculation / A Computer Model”, ASHRAE Trans., Vol.96, Pt 1.

ISO. 1983. “Determination of the PMV and PPD Indices and Specification of the Conditions for Thermal Comfort”, DIS 7730, Moderate Thermal Environment, 1983.

Trombe Walls <a name="TrombeWalls"></a>
------------

Trombe walls are passive solar devices designed for thermal storage and delivery.  It consists of a thick wall (150mm to 300mm) [8" to 16"] faced with a selective surface solar absorber, air gap, and high transmissivity glass pane.  Trombe walls are usually South facing (in the Northern Hemisphere) for maximum sun exposure.  An overhang above the wall is used to decrease exposure in the summer when the sun is high in the sky and heating is not required, yet still allows for full exposure in the winter when the sun is low in the sky and heating is desirable.

In EnergyPlus, there is no Trombe wall object per se; rather, it is composed of other existing EnergyPlus objects in the input file (except for a special key choice for Zone Inside Convection Algorithm in the Zone input object).  This approach provides flexibility in specifying the various wall parameters and allows the freedom to explore unusual configurations.  On the other hand, this approach puts more of a burden on the user to be sure that all parts of the Trombe wall are correctly specified; otherwise unexpected results may be obtained.

To simulate the Trombe wall, a very narrow zone is coupled to the desired surface via an interzone partition.  The depth of the zone corresponds to the size of the air space usually 18mm to 150mm (¾" to 6").  In most cases the Trombe zone will be a sealed zone with no ventilation.  The exterior wall of the Trombe zone contains a single or double-pane window.  Optimally, the window covers nearly all of the wall area and has a very high transmissivity to allow the maximum amount of solar flux into the Trombe zone.  Frames and dividers can be defined as usual for the window.  The interior wall is usually constructed of very thick masonry materials with a solar absorber surface as the innermost layer of the wall.  The absorber is a selective surface material with very high absorptivity and very low emissivity, e.g. copper with a special black surface treatment.  It is important to make sure the Solar Distribution field in the **Building** object is set to FullInteriorAndExterior so that the majority of the solar flux is directed on the absorber surface and not just on the very small area of the Trombe zone floor.  The Zone Inside Convection Algorithm for the Trombe’s Zone object should also be set to TrombeWall to correctly model the air space.  As is the case for all interzone partitions, the wall construction of the adjoining zone must be the mirror image of the wall construction in the Trombe zone.  Finally, an overhang is optionally attached to the Trombe zone to control the amount of seasonal sun exposure.  Since the user selects all of the Trombe wall parameters in the input file, there is considerable freedom to experiment with different materials, sizes, and configurations.



![](EngineeringReference/media/image6830.png)

Figure 307. Building with Trombe Wall



### Passive Trombe Wall

Passive Trombe walls perform without the assistance of any additional mechanical equipment.  Most Trombe walls are passive Trombe walls.  They can be either sealed or naturally ventilated.

For a sealed or unvented Trombe wall, the *Zone Inside Convection Algorithm* field in the Zone object should be set to "TrombeWall".  This algorithm correctly calculates the convection coefficients for a narrow sealed vertical cavity based on the ISO 15099 standard.  Refer to the "Trombe Wall Algorithm" subsection (under Interior Convection, above) for a complete description of the algorithm.  The EnergyPlus modeling approach for the sealed passive Trombe wall has been validated with experimental data (Ellis 2003).

For a naturally ventilated Trombe wall, there is no built-in algorithm for calculating the correct convection coefficients on the inside of the cavity walls.  One option is to use the "Detailed" convection algorithm.  This algorithm takes into account some natural convection effects but is intended for a normal sized room.  Therefore, some error may be incurred when used with a narrow cavity.  Another option is to use the SurfaceProperty:ConvectionCoefficients object to schedule coefficients that have been determined beforehand by the user.

#### Input File

An input file (PassiveTrombeWall.idf) is provided to demonstrate a sample sealed Trombe wall implementation.  In this file two separated fictional buildings are simulated for summer and winter design days in Zion, Utah.  The buildings are identical in size and construction except that one has a Trombe wall and the other does not.  The buildings have uncontrolled zones with no internal loads and heavy insulation.  All floors use interzone partitions to disconnect them from the ground.  The window on the Trombe zone is a 3 mm, low iron, single pane glazing with very high transmissivity (0.913 visible, 0.899 solar).  The absorber surface is a Tabor solar absorber with an emittance of 0.05 and absorptance of 0.85.

#### Results

The resulting temperature profiles for winter and summer design days are plotted below.

![](EngineeringReference/media/image6831.png)

Figure 308. Passive Trombe Wall Winter



![](EngineeringReference/media/image6832.png)

Figure 309. Passive Trombe Wall Summer

#### References

Ellis, Peter G.  2003.  *Development and Validation of the Unvented Trombe Wall Model in EnergyPlus*, Master's Thesis, University of Illinois at Urbana-Champaign.

ISO 15099.  2000.  "Thermal Performance of Windows, Doors, and Shading Devices-Detailed Calculations".  International Standards Organization, Draft, July 18, 2000.



### Active Trombe Wall

The active Trombe wall is the same as the passive Trombe wall with the addition of a simple fan system to circulate air between the Trombe zone and the main zone.  The fan is scheduled to operate only during winter daylight hours to improve the heat transfer from the Trombe zone.

As with the passive Trombe wall, there is no EnergyPlus object for the active Trombe wall; it is simulated using a collection of other EnergyPlus objects.  Like the passive Trombe wall, the active Trombe wall uses a narrow zone coupled to the main zone with interzone partitions.  However, the unique part of the active Trombe wall is that the Trombe zone is used to define a zone supply plenum object which allows the Trombe zone to be integrated into the air system.  A constant volume fan is the main component of the air system.  To make the zone connections, the Direct Air component is used.

For the active Trombe wall, there is no built-in algorithm for calculating the correct convection coefficients due to forced convection on the inside of the cavity walls.  One approach is to use the SurfaceProperty:ConvectionCoefficients object to schedule coefficients that have been determined beforehand by the user.

#### Input File

An input file (ActiveTrombeWall.idf) is provided to demonstrate a sample active Trombe wall implementation.  The building and Trombe wall in this file are identical to the ones described above for PassiveTrombeWall.idf.  However, this input file adds a system in the form of a low flow rate (0.1 m<sup>3</sup>/s) constant volume fan and the necessary duct connections.  The fan is scheduled to operate October through March from 10 AM to 8 PM.

#### Results

The resulting temperature profile for the winter design day is plotted below.  The plot for the summer design day is not shown because it is identical to Figure 309 above since the fan is not scheduled to operate in the summer.

![](EngineeringReference/media/image6833.png)

Figure 310. Active Trombe Wall Winter

Water Thermal Tanks (includes Water Heaters) <a name="WaterTanks"></a>
--------------------------------------------

Water thermal tanks are devices for storing thermal energy in water.  The most common types are water heaters. devices for storing and heating water.  Typical water heater applications are for domestic hot water heating, low-temperature radiant space heating, and energy storage for solar hot water systems or waste heat recovery.  In EnergyPlus, water heater objects can be coupled to a plant loop simulation or used stand-alone.  There are also chilled water storage tanks that can be used to hold cold water

### Mixed Water Thermal Tank

The input object WaterHeater:Mixed provides a model that simulates a well-mixed water tank, i.e. non-stratified, and is appropriate for simulating many types of water heaters and storage tanks, including gas and electric residential water heaters, a variety of large commercial water heaters, and also instantaneous, tankless water heaters.  This model is used for both the mixed water heater and the mixed chilled water storage tanks.

#### Energy Balance

The well-mixed assumption implies that all water in the tank is at the same temperature.  To calculate the water temperature, the model analytically solves the differential equation governing the energy balance of the water tank:

<div>$$\rho V{c_p}\frac{{dT}}{{dt}} = {q_{net}}$$</div>

where

*r* = density of water

*V* = volume of the tank

*c<sub>p</sub>* = specific heat of water

*T* = temperature of the tank water

*t* = time

*q<sub>net</sub>* = net heat transfer rate to the tank water

The density and volume can be replaced with the total mass *m* of water in the tank to get:

<div>$$m{c_p}\frac{{dT}}{{dt}} = {q_{net}}$$</div>

The net heat transfer rate *q<sub>net</sub>* is the sum of gains and losses due to multiple heat transfer pathways.

<div>$${q_{net}} = {q_{heater}} + {q_{oncycpara}} + {q_{offcycpara}} + {q_{oncycloss}} + {q_{offcycloss}} + {q_{use}} + {q_{source}}$$</div>

where

*q<sub>heater</sub>* = heat added by the heating element or burner

*q<sub>oncycpara</sub>* = heat added due to on-cycle parasitic loads (zero when off)

*q<sub>offcycpara</sub>* = heat added due to off-cycle parasitic loads (zero when on)

*q<sub>oncycloss</sub>* = heat transfer to/from the ambient environment (zero when off)

*q<sub>offcycloss</sub>* = heat transfer to/from the ambient environment (zero when on)

*q<sub>use</sub>* = heat transfer to/from the use side plant connections

*q<sub>source</sub>* = heat transfer to/from the source side plant connections

*q<sub>oncycloss</sub>* and *q<sub>offcycloss</sub>* are defined as:

<div>$${q_{oncycloss}} = U{A_{oncyc}}\left( {{T_{amb}} - T} \right)$$</div>

<div>$${q_{offcycloss}} = U{A_{offcyc}}\left( {{T_{amb}} - T} \right)$$</div>

where

*UA<sub>oncyc</sub>* = on-cycle loss coefficient to ambient environment (zero when off)

*UA<sub>offcyc</sub>* = off-cycle loss coefficient to ambient environment (zero when on)

*T<sub>amb</sub>* = temperature of ambient environment

*q<sub>use</sub>*, and *q<sub>source</sub>* are defined as:

<div>$${q_{use}} = {\varepsilon_{use}}{\dot m_{use}}{c_p}\left( {{T_{use}} - T} \right)$$</div>

<div>$${q_{source}} = {\varepsilon_{source}}{\dot m_{source}}{c_p}\left( {{T_{source}} - T} \right)$$</div>

where

*e<sub>use</sub>* = heat exchanger effectiveness for the use side plant connections

<span>${\dot m_{use}}$</span>= mass flow rate for the use side plant connections

*T<sub>use</sub>* = inlet fluid temperature of the use side plant connections

*e<sub>source</sub>* = heat exchanger effectiveness for the source side plant connections

<span>${\dot m_{source}}$</span>= mass flow rate for the source side plant connections

*T<sub>source</sub>* = inlet fluid temperature of the use side plant connections

Incorporating all of these equations into the original differential equation,

<div>$$\begin{array}{c}m{c_p}\frac{{dT}}{{dt}} = {q_{heater}} + {q_{oncyc}} + {q_{offcyc}} + U{A_{oncyc}}\left( {{T_{amb}} - T} \right) + U{A_{offcyc}}\left( {{T_{amb}} - T} \right)\\ + {\varepsilon_{use}}{{\dot m}_{use}}{c_p}\left( {{T_{use}} - T} \right) + {\varepsilon_{source}}{{\dot m}_{source}}{c_p}\left( {{T_{source}} - T} \right)\end{array}$$</div>

Associating terms not dependent on temperature *T* and terms dependent on temperature *T* yields:

<div>$$\begin{array}{c}\frac{{dT}}{{dt}} = \left[ {\frac{1}{{m{c_p}}}\left( \begin{array}{l}{q_{heater}} + {q_{oncyc}} + {q_{offcyc}} + U{A_{oncyc}}{T_{amb}} + U{A_{offcyc}}{T_{amb}}\\ + {\varepsilon_{use}}{{\dot m}_{use}}{c_p}{T_{use}} + {\varepsilon_{source}}{{\dot m}_{source}}{c_p}{T_{source}}\end{array} \right)} \right]\\ + \left[ {\frac{{ - 1}}{{m{c_p}}}\left( {U{A_{oncyc}} + U{A_{offcyc}} + {\varepsilon_{use}}{{\dot m}_{use}}{c_p} + {\varepsilon_{source}}{{\dot m}_{source}}{c_p}} \right)} \right]T\end{array}$$</div>

The differential equation now has the form

<div>$$\frac{{dT}}{{dt}} = a + bT$$</div>

where

<div>$$a = \frac{1}{{m{c_p}}}\left( \begin{array}{l}{q_{heater}} + {q_{oncyc}} + {q_{offcyc}} + U{A_{oncyc}}{T_{amb}} + U{A_{offcyc}}{T_{amb}}\\ + {\varepsilon_{use}}{{\dot m}_{use}}{c_p}{T_{use}} + {\varepsilon_{source}}{{\dot m}_{source}}{c_p}{T_{source}}\end{array} \right)$$</div>

<div>$$b = \frac{{ - 1}}{{m{c_p}}}\left( {U{A_{oncyc}} + U{A_{offcyc}} + {\varepsilon_{use}}{{\dot m}_{use}}{c_p} + {\varepsilon_{source}}{{\dot m}_{source}}{c_p}} \right)$$</div>

The solution to the differential equation can be written in terms of *a* and *b* as:

<div>$$T\left( t \right) = \left( {\frac{a}{b} + {T_i}} \right){e^{bt}} - \frac{a}{b}$$</div>

where

*T(t)* = temperature of the tank water at time *t*

*T<sub>i</sub>* = initial temperature of the tank water at time *t* = 0

However, if *b* = 0, the solution instead is:

<div>$$T\left( t \right) = at + {T_i}$$</div>

Since the control algorithm must sometimes calculate the time needed to reach a specified temperature, the equations above can also be rearranged to solve for *t*.

<div>$$t = \frac{1}{b}\ln \left( {\frac{{{\raise0.7ex\hbox{$a$} \!\mathord{\left/ {\vphantom {a b}}\right.}\!\lower0.7ex\hbox{$b$}} + {T_f}}}{{{\raise0.7ex\hbox{$a$} \!\mathord{\left/ {\vphantom {a b}}\right.}\!\lower0.7ex\hbox{$b$}} + {T_i}}}} \right)$$</div>

or, if *b* = 0,

<div>$$t = \frac{{{T_f} - {T_i}}}{a}$$</div>

where

*T<sub>f</sub>* = final temperature of the tank water at time t.

In the special case where *b* = 0 and *a* = 0, and *T<sub>f</sub>* &lt;&gt; *T<sub>i</sub>*, the time *t* is infinity.

#### Water Heater Control Algorithm

For water heaters, control options allow the heater to cycle or modulate to meet the load.  When cycling, the heater element or burner is either on or off.  The heater remains fully on while heating the tank up to the setpoint temperature.  When the setpoint is reached, the heater turns off.  The heater remains off until the tank temperature falls below the "cut-in" temperature, i.e., the setpoint temperature minus the deadband temperature difference.  The heater continuously cycles on and off to maintain the tank temperature within the deadband.  Most storage-tank water heaters cycle.

When modulating, the heater power varies between the maximum and minimum heater capacities.  The heater stays on as long as the required total demand is above the minimum capacity.  Below the minimum capacity, the heater will begin to cycle on and off based on the deadband temperature difference.  Most tankless/instantaneous water heaters modulate.

Within a time step, the differential equation is solved separately for when the heater element or burner is "on" (on-cycle) and when it is "off" (off-cycle).  This approach allows ambient losses and parasitic loads to be divided into on-cycle and off-cycle effects and accounted for in detail.

An illustration of how the control algorithm cycles on and off is shown below.  Ambient losses cool the tank temperature until the bottom of the deadband is reached (50 C) at which point the heater cycles on and reheats the tank back to the setpoint (60 C).  A water draw causes hot water to be replaced with cold water from the water mains.  The incoming cold water rapidly cools the tank.  In this example the heater cannot keep up with the water draw and the tank temperature continues to drop until the water draw ends.

Although the instantaneous tank water temperature may vary considerably within a timestep (due to cycling, etc.), only the average temperature over the timestep is reported.  The model calculates the average by piece-wise integration of the area under the instantaneous temperature curve for each unique set of conditions.  The instantaneous temperature is preserved internally by the program and is propogated from the end of one timestep to the beginning of the next.

![](EngineeringReference/media/image6852.png)

Figure 311. Water Heater Cycle Control Algorithm

#### Chilled Water Tank Control Algorithm

The input objects ThermalStorage:ChilledWater:Mixed and ThermalStorage:ChilledWater:Stratified provide chilled water tank models that do not include active cooling elements, there is only indirect cooling by remote devices such as a chiller.  The tank’s setpoint controls are used to determine if flow is to be requested through the source side of the tank.  The setpont and deadband control scheme is similar to the water heater but the logic is flipped around for cooling instead of heating.  The setpoint temperatue is the “cut-out” temperature and the setpoint plus deadband is the “cut-in” temperature.  If the tank temperature ( or tank sensing node for stratified tanks) is above the “cut-in” temperature, then flow is requested.  If temperatures are below the “cut-out” temperature, then flow is not requested.  The chilled water tanks also have separate availability schedules for the use side and source side for additional control options.

#### Standard Ratings

For water heaters, the industry standard ratings of Recovery Efficiency and Energy Factor are calculated according to the 10CFR430 test procedure.  To emulate the test procedure, a 24-hour simulation of the water heater is performed internally using the specified test conditions:

n Setpoint Temperature = 57.2 C (135 F)

n Ambient Temperature = 19.7 C (67.5 F)

n Ambient Relative Humidity = 50% (used for heat pump water heaters)

n Inlet Temperature (Water Mains) = 14.4 C (58 F)

For heat pump water heaters, the water heater tank’s heating element and water heater tank parasitic loads are disabled and the user-defined water heating capacity, energy use, and parasitic loads for the heat pump are used to calculate Recovery Efficiency and Energy Factor.

The simulated test procedure performs six equal draws of approximately 0.041 m<sup>3</sup> (10.7 gal) in each of the first six hours of the simulation.  Each draw occurs over the first timestep of the hour.

The Recovery Efficiency is calculated when the water heater recovers to the setpoint after the first draw.

<div>$$RE = \frac{{{m_1}{c_p}\left( {57.2 - 14.4} \right)}}{{{E_1}}}$$</div>

where

*m<sub>1</sub>* = water mass of the first draw

*c<sub>p</sub>* = specific heat of water

*E<sub>1</sub>* = fuel energy consumed until the setpoint is recovered (including parasitics)

Note: When the standards rating for a heat pump water heater is calculated, the fuel energy consumed refers to the total energy consumed by the heat pump compressor, evaporator fan, condenser pump, and parasitic loads. It is assumed that the parasitic loads for a heat pump water heater do not contribute to heating the water (ref. Heat Pump Water Heater).

The Energy Factor is calculated at the end of the 24-hour simulation period.

<div>$$EF = \frac{{{m_{total}}{c_p}\left( {57.2 - 14.4} \right)}}{{{E_{total}}}}$$</div>

where

*m<sub>total</sub>* = total water mass of all six draws

*c<sub>p</sub>* = specific heat of water

*E<sub>total</sub>* = total fuel energy consumed over 24 hours (including parasitics)

Under certain input parameters, the rating method will not succeed and a warning message will be generated.  Problems occur when inputs do not allow the tank to recover to the setpoint temperature within the test period.  This can occur if the maximum heater capacity is undersized, or if the deadband temperature difference is large enough that the first draw of the test does not trigger the heater to come on.  In either case, the Recovery Efficiency test will not compute properly because recovery to the setpoint was not achieved.

#### References

10CFR430.  *Title 10, Code of Federal Regulations, Part 430 - Energy Conservation Program for Consumer Products, Appendix E to Subpart B - Uniform Test Procedure for Measuring the Energy Consumption of Water Heaters*.

### Heat Pump Water Heater

#### Overview

The input object WaterHeater:HeatPump provides a model for a heat pump water heater (HPWH) that is a compound object consisting of a water heater tank (e.g., WaterHeater:Mixed or WaterHeater:Stratified), a direct expansion (DX) “coil” (i.e., an air-to-water DX compression system which includes a water heating coil, air coil, compressor, and water pump), and a fan to provide air flow across the air coil associated with the DX compression system. These objects work together to model a system which heats water using zone air, outdoor air, or a combination of zone and outdoor air as the primary heat source.

Numerous configurations of tank location, inlet air source, and DX coil compressor location can be modeled. The DX coil compressor may be located in a zone, outdoors, or the ambient temperature surrounding the compressor may be scheduled. The location of the compressor controls the operation of its crankcase heater. The water heater tank location is specified in the water heater tank object and is independent of the compressor location. In addition, the inlet air configuration may be specified in one of several ways. The heat pump water heater air coil and fan assembly may draw its inlet air from the zone and outdoor air using an optional mixer and splitter assembly as shown in the first figure below. When used, the mixer and splitter air streams are controlled by a single inlet air mixer schedule. When the HPWH draws its inlet air solely from a zone, the mixer/splitter assembly is not required as shown in the second figure below. In this case, the inlet air to the evaporator and fan assembly is made up entirely of zone air and the heat pump outlet air is directed back to the zone. The final figure illustrates a HPWH that draws its inlet air solely from outdoors and exhausts its outlet air outdoors as well. Each of these configurations may also be connected to a plant hot water loop (via the water heater tank use nodes).

![HPWHSchematic\_EAplusOA](EngineeringReference/media/image6855.png)

Figure 312. Schematic of a heat pump water heater using optional mixer/splitter nodes

![HPWH](EngineeringReference/media/image6856.png)

Figure 313. Schematic of a Heat Pump Water Heater with Inlet Air from a Zone

![HPWHSchematic\_outdoors](EngineeringReference/media/image6857.png)

Figure 314. Schematic of a Heat Pump Water Heater with Inlet Air from Outdoors

Note: The water heater tank location shown in the figures above is completely independent of the heat pump water heater’s inlet air configuration and its compressor location. The water heater tank may be located outdoors, in a zone, or the ambient temperature surrounding the tank can be scheduled as described in the mixed water heater section below.

#### Model Description

The heat pump water heater input requires a compressor setpoint temperature schedule and dead band temperature difference, which are independent from the setpoint temperature schedule and dead band temperature difference for the heater (element or burner) associated with the water heater tank. The cut-in temperature for the heat pump compressor is defined as the heat pump compressor’s setpoint temperature minus its dead band temperature difference.

<div>$${T_{HP,\,cut - in}}\,\, = \,\,{T_{HP,set\,point}}\,\, - \,\,{T_{HP,dead\,band}}$$</div>

where:

<span>${T_{HP,\,cut - in}}$</span>     = Cut-in temperature for the heat pump compressor (°C)

<span>${T_{HP,set\,point}}$</span>   = Heat pump compressor setpoint temperature (°C)

<span>${T_{HP,dead\,band}}$</span> = Heat pump compressor dead band temperature difference (°C)

In this model, the heat pump water heater’s DX compression system is considered the primary heat source and the water tank’s heater (element or burner) provides supplemental heat as necessary. Therefore, the cut-in temperature for the heat pump compressor (setpoint minus dead band temperature difference) is usually higher than the setpoint temperature for the heater (element or burner) in the associated water heater tank object. At times when the water heater tank setpoint temperature is greater than the cut-in temperature of the heat pump compressor, the heat pump compressor is disabled and the tank’s heater is used to heat the water.

The simulation starts by first calculating the air conditions entering the air coil (evaporator)/fan assembly based on the inlet air configuration of the heat pump water heater and the presence of the optional mixer/splitter nodes. When the HPWH draws its inlet air from the zone and outdoors using the optional mixer/splitter nodes (i.e., Inlet Air Configuration = Zone and Outdoor Air), the inlet air conditions are calculated as follows:

<div>$$Frac = GetScheduleValue(MixerInletAirSchedule)$$</div>

<div>$${T_{inlet}} = {T_{outdoor}}\left( {Frac} \right) + {T_{zone}}\left( {1 - Frac} \right)$$</div>

<div>$${\omega_{inlet}} = {\omega_{outdoor}}\left( {Frac} \right) + {\omega_{zone}}\left( {1 - Frac} \right)$$</div>

where:

<span>$Frac$</span> = current value of the inlet air mixer schedule (fraction of outdoor air, 0-1)

<span>${T_{inlet}}$</span> = inlet air dry-bulb temperature to the HPWH evaporator/fan assembly (°C)

<span>${T_{outdoor}}$</span> = outdoor air dry-bulb temperature (°C)

<span>${T_{zone}}$</span>  = zone (exhaust) air dry-bulb temperature (°C)

<span>${\omega_{inlet}}$</span> = inlet air humidity ratio to the HPWH evaporator/fan assembly (kg/kg)

<span>${\omega_{outdoor}}$</span>= outdoor air humidity ratio (kg/kg)

<span>${\omega_{zone}}$</span>  = zone (exhaust) air humidity ratio (kg/kg)

When the heat pump water heater draws its inlet air solely from the zone (i.e., Inlet Air Configuration = Zone Air Only), the inlet air conditions to the evaporator/fan assembly are simply set equal to the zone (exhaust) air conditions. If the heat pump water heater draws its inlet air solely from outdoors (i.e., Inlet Air Configuration = Outdoor Air Only), the inlet air conditions to the evaporator/fan assembly are simply set equal to the outdoor air conditions. When the inlet air to the heat pump water heater evaporator and fan assembly is scheduled (i.e., Inlet Air Configuration = Schedule), the inlet air conditions are determined directly from the user-supplied schedules as follows.

<div>$${T_{inlet}} = GetScheduleValue(InletAirTemperatureSchedule)$$</div>

<div>$$RHinlet = GetScheduleValue(InletAirHumiditySchedule)$$</div>

<div>$${\omega_{inlet}} = PsyWFnTdbRhPb({T_{inlet}},R{H_{inlet}},OutBaroPress)$$</div>

where:

<span>$R{H_{inlet}}$</span>= inlet air relative humidity to heat pump water heater evaporator/fan assembly (0-1)

<span>$PsyWFnTdbRhPb$</span>= psychrometric function returning air humidity ratio given dry-bulb temperature, relative humidity, and barometric pressure

<span>$OutBaroPress$</span>= outdoor barometric pressure (Pa)

For each simulation time step, the heat pump water heating capacity, energy use, and air-side/water-side mass flow rates are set to zero and the water heater tank is simulated with the heat pump compressor disabled when any of the following conditions apply:

·        the HPWH is scheduled off by its availability schedule,

·        the water heater tank setpoint temperature is greater than or equal to the heat pump compressor cut-in temperature,

·        the inlet air dry-bulb temperature to the evaporator/fan assembly is less than the Minimum Inlet Air Temperature for Heat Pump Compressor Operation (as specified by the user in the HPWH input object), or

·        the HPWH setpoint temperature is greater than or equal to the Maximum Temperature Limit (specified in the Water Heater:Mixed object).

Otherwise, simulation of the heat pump water heater is based on its current mode of operation. This mode of operation is either floating (heat pump compressor is off and tank water temperature has not fallen below the heat pump compressor cut-in temperature) or heating (tank water temperature dropped below the compressor cut-in temperature on a previous time step but was unable to reach the compressor setpoint temperature). Each mode is handled differently and they will be discussed separately.

If the heat pump water heater is using the stratified tank model, then there is more than one value for the tank temperature.  The model includes input for where the heat pump controls detect the temperature in the form of six options for keyword choices:  Heater1, Heater2, SourceInlet, SourceOutlet, UseInlet, and UseOutlet.  The input data in the associated WaterHeater:Stratified includes the heights of these locations and the nearest stratified tank node is identified based on these heights.  When the heat pump model needs to evaluate the tank temperature of a stratified tank, it evaluates the temperature at the tank node associated with these locations.

#### Float Mode

When the heat pump water heater tank temperature is floating between the heat pump compressor’s cut-in and cut-out temperatures at the end of the previous simulation time step, both the heat pump compressor and the water heater tank’s heating element are disabled and a resulting tank temperature is calculated. If the resulting tank temperature is below the heat pump compressor’s cut-in temperature, the heat pump compressor part-load ratio is estimated using the ratio of the temperature differences shown below. The part-load ratio can not be less than zero or greater than one.

<div>$$PLR = MIN\left( {1.0,\,\,MAX\left( {0.0,\,\,\left( {\frac{{{T_{HP,\,cut - in}} - {T_{tank,float}}}}{{{T_{tank,initial}} - {T_{tank,float}}}}} \right)} \right)} \right)$$</div>

where:

<span>$PLR$</span>         = part-load ratio of the heat pump water heater compressor

<span>$Ttank,float$</span>    = tank temperature in float mode when heating capacity is set to zero(°C)

<span>${T_{tank,initial}}$</span>    = tank temperature at the beginning of the simulation time step (°C)

Since the pump and fan are assumed to cycle on and off with the heat pump compressor, the average condenser water and evaporator air mass flow rates for the simulation time step are calculated based on the PLR calculated above:

<div>$${\dot m_{water,avg}} = \dot Vwater\left( {{\rho_{water}}} \right)\left( {PLR} \right)$$</div>

<div>$$\dot mair,avg = \dot Vair\left( {{\rho_{air}}} \right)\left( {PLR} \right)$$</div>

where:

<span>$\dot mwater,avg$</span>       = average condenser water mass flow rate for the time step (kg/s)

<span>$\dot Vwater$</span>            = condenser water volumetric flow rate, user input (m<sup>3</sup>/s)

<span>${\rho_{water}}$</span>            = density of condenser inlet water (kg/m<sup>3</sup>)

<span>$\dot mair,avg$</span>         = average evaporator/fan air mass flow rate for the time step (kg/s)

<span>$\dot Vair$</span>               = evaporator/fan air volumetric flow rate, user input (m<sup>3</sup>/s)

<span>${\rho_{air}}$</span>              = density of evaporator/fan inlet air (kg/m<sup>3</sup>)

The water tank temperature is then calculated based on heat pump operation at the part-load ratio estimated above and with the water tank’s heating element enabled. If the resulting water tank temperature is above the heat pump compressor’s setpoint (cut-out) temperature, then the part-load ratio is reduced and the water heater tank is simulated again. The process is performed iteratively until the part-load ratio of the heat pump compressor achieves the desired setpoint temperature (to the extent possible).

#### Heating Mode

When the HPWH is in heating mode at the end of the previous simulation time step (i.e., the heat pump compressor operated during the previous simulation time step but was unable to achieve the setpoint temperature), both the heat pump compressor and the water heater tank’s heating element are enabled. The part-load ratio of the heat pump compressor is set to 1, and the condenser water and evaporator air mass flow rates are set to their maximum flow rates.

<div>$${\dot m_{water,avg}} = {\dot V_{water}}\left( {{\rho_{water}}} \right)$$</div>

<div>$$\dot mair,avg = \dot Vair\left( {\rho air} \right)$$</div>

If the resulting tank temperature is above the heat pump compressor’s setpoint (cut-out) temperature, the part-load ratio of the heat pump compressor is reduced and the water heater tank is simulated again. The process is performed iteratively until the part-load ratio of the heat pump compressor achieves the desired setpoint temperature (to the extent possible).

The air-side outlet conditions of the HPWH are calculated through simulation of the fan and DX coil with either a blow through or draw through fan placement (user selectable). If mixer/splitter nodes are used, the HPWH model splits the heat pump outlet air mass flow rate with exhaust air flow equaling the outdoor air flow, and the balance of the outlet air being sent to the zone supply air node (i.e., ensures that the heat pump water heater does not contribute to zone pressurization or depressurization). Calculations of heat pump water heating capacity, energy use, air-side performance, and water-side temperature difference are performed in the associated DX Coil object. See the engineering reference section for the Coil:WaterHeating:AirToWaterHeatPump object for details.

#### Model Outputs

After completing the float mode or heating mode calculations and the final part-load ratio has been determined, the output (report) variables are calculated as follows:

<div>$$Heat\,Pump\,Water\,Heater\,Compressor\,Part{\rm{ - }}Load\,Ratio = PLR\,\,$$</div>

<div>$$Heat\,Pump\,Water\,Heater\,\,On{\rm{ - }}Cycle\,Parasitic\,Electric\,Power\,(W)\,\, = \,\,{P_{parasitic,on}}\left( {PLR} \right)$$</div>

<span>$Heat\,Pump\,Water\,Heater\,\,On{\rm{ - }}Cycle\,Parasitic\,Electric\,Consumption\,(J)\,\, = \,\,{P_{parasitic,on}}\left( {PLR} \right)\left( {3600} \right){t_{sys}}$</span><span>$Heat\,Pump\,Water\,Heater\,\,Off{\rm{ - }}Cycle\,Parasitic\,Electric\,Power\,(W)\,\, = \,\,{P_{parasitic,off}}\left( {1 - PLR} \right)$</span><span>$Heat\,Pump\,Water\,Heater\,\,Off{\rm{ - }}Cycle\,Parasitic\,Electric\,Consumption\,(J)\,\, = \,\,{P_{parasitic,off}}\left( {1 - PLR} \right)\left( {3600} \right)\left( {{t_{sys}}} \right)$</span>

where:

<span>${P_{parasitic,on}}$</span>   = on-cycle parasitic electric load, user input (W)

<span>${P_{parasitic,off}}$</span>  = off-cycle parasitic electric load, user input (W)

<span>${t_{sys}}$</span>             = HVAC system simulation time step (hours)

Note: All heat pump water heater output variables, including off-cycle ancillary electric power and consumption, equal 0 when the heat pump water heater availability schedule equals 0 (i.e., the heat pump water heater is scheduled OFF).

### Stratified Water Thermal Tank

The input objects WaterHeater:Stratified and ThermalStorage:ChilledWater:Stratified provide models for a stratified water thermal tank that divides the water tank into multiple nodes of equal volume.  This model is used for both the stratified water heater and the stratified chilled water storage tank. The nodes are coupled by vertical conduction effects, internode fluid flow, and temperature inversion mixing.  The object simultaneously solves the differential equations governing the energy balances on the nodes using the Forward-Euler numerical method.  The system time step is divided into one second substeps that allow the simulation to capture events that occur on a very short time scale.

#### Energy Balance

Similar to the well-mixed model, the stratified model solves the same fundamental differential equation governing the energy balance on a mass of water:

<div>$$m{c_p}\frac{{dT}}{{dt}} = {q_{net}}$$</div>

where

*m* = mass of water

*c<sub>p</sub>* = specific heat of water

*T* = temperature of water

*t* = time

*q<sub>net</sub>* = net heat transfer rate

The difference for the stratified model is that it must solve the energy balance on *n* number of nodes simultaneously.  Node 1 is at the top of the water tank and node *n* is at the bottom of the water tank.

<div>$${m_n}{c_p}\frac{{d{T_n}}}{{dt}} = {q_{net,n}}$$</div>

where

*m<sub>n</sub>* = mass of water for node *n*

*c<sub>p</sub>* = specific heat of water

*T<sub>n</sub>* = temperature of water for node *n*

*t* = time

*q<sub>net,n</sub>* = net heat transfer rate for node *n*

The net heat transfer rate *q<sub>net</sub>* is the sum of gains and losses due to multiple heat transfer pathways.

<div>$$\begin{array}{l}{q_{net,n}} = {q_{heater,n}} + {q_{oncycpara,n}} + {q_{offcycpara,n}} + {q_{oncycloss,n}} + {q_{offcycloss,n}}\\ + {q_{cond,n}} + {q_{use,n}} + {q_{source,n}} + {q_{flow,n}} + {q_{invmix,n}}\end{array}$$</div>

where

*q<sub>heater,n</sub>* = heat added by Heater 1 or Heater 2

*q<sub>oncycpara,n</sub>* = heat added due to on-cycle parasitic loads (zero when off)

*q<sub>offcycpara,n</sub>* = heat added due to off-cycle parasitic loads (zero when on)

*q<sub>oncycloss,n</sub>* = heat transfer to/from the ambient environment (zero when off)

*q<sub>offcycloss,n</sub>* = heat transfer to/from the ambient environment (zero when on)

*q<sub>cond,n</sub>* = heat transfer due to conduction between the node above and below

*q<sub>use,n</sub>* = heat transfer to/from the use side plant connections

*q<sub>source,n</sub>* = heat transfer to/from the source side plant connections

*q<sub>flow,n</sub>* = heat transfer due to fluid flow from the node above and below

*q<sub>invmix,n</sub>* = heat transfer due to inversion mixing from the node above and below

*q<sub>oncycloss,n</sub>* and *q<sub>offcycloss,n</sub>* are defined as:

<div>$${q_{oncycloss,n}} = U{A_{oncyc,n}}({T_{amb}} - {T_n})$$</div>

<div>$${q_{offcycloss,n}} = U{A_{offcyc,n}}({T_{amb}} - {T_n})$$</div>

where

*UA<sub>oncyc,n</sub>* = on-cycle loss coefficient to ambient environment (zero when off)

*UA<sub>offcyc,n</sub>* = off-cycle loss coefficient to ambient environment (zero when on)

*T<sub>amb</sub>* = temperature of ambient environment

*q<sub>cond,n</sub>* is defined as:

<div>$${q_{cond,n}} = \frac{{k{A_{n + 1}}}}{{{L_{n + 1}}}}({T_{n + 1}} - {T_n}) + \frac{{k{A_{n - 1}}}}{{{L_{n - 1}}}}({T_{n - 1}} - {T_n})$$</div>

where

*k* = fluid thermal conductivity of water, 0.6 W/m-K

*A<sub>n+1</sub>* = shared surface area between node *n* and node *n+1*

*L<sub>n+1</sub>* = distance between the center of mass of node *n* and n*+1*

*T<sub>n+1</sub>* = temperature of node *n+1*

*A<sub>n-1</sub>* = shared surface area between node *n* and node *n-1*

*L<sub>n-1</sub>* = distance between the center of mass of node *n* and n*-1*

*T<sub>n-1</sub>* = temperature of node *n-1*

*q<sub>use,n</sub>*, and *q<sub>source,n</sub>* are defined as:

<div>$${q_{use}} = {\varepsilon_{use}}{\dot m_{use}}{c_p}\left( {{T_{use}} - T} \right)$$</div>

<div>$${q_{source}} = {\varepsilon_{source}}{\dot m_{source}}{c_p}\left( {{T_{source}} - T} \right)$$</div>

where

*e<sub>use</sub>* = heat exchanger effectiveness for the use side plant connections

<span>${\dot m_{use}}$</span>= mass flow rate for the use side plant connections

*T<sub>use</sub>* = inlet fluid temperature of the use side plant connections

*e<sub>source</sub>* = heat exchanger effectiveness for the source side plant connections

<span>${\dot m_{source}}$</span>= mass flow rate for the source side plant connections

*T<sub>source</sub>* = inlet fluid temperature of the source side plant connections

*q<sub>flow,n</sub>* is defined as:

<div>$${q_{flow,n}} = {\dot m_{n + 1}}{c_p}({T_{n + 1}} - {T_n}) + {\dot m_{n - 1}}{c_p}({T_{n - 1}} - {T_n})$$</div>

where

<span>${\dot m_{n + 1}}$</span>= mass flow rate from node *n+1*

<span>${\dot m_{n - 1}}$</span>= mass flow rate from node *n-1*

*q<sub>invmix,n</sub>* is defined as:

<div>$${q_{invmix,n}} = {\dot m_{invmix,n + 1}}{c_p}({T_{n + 1}} - {T_n}) + {\dot m_{invmix,n - 1}}{c_p}({T_{n - 1}} - {T_n})$$</div>

where

<span>${\dot m_{invmix,n + 1}}$</span>= mass flow rate from node *n+1* due to temperature inversion mixing

<span>${\dot m_{invmix,n - 1}}$</span>= mass flow rate from node *n-1* due to temperature inversion mixing

Inversion mixing occurs when the node below is warmer than the node above.  The difference in temperatures drives a difference in density that causes the nodes to mix.  Usually inversion mixing occurs very rapidly.  In this algorithm, the inversion mixing rate is selected to be the maximum value that will provide a stable solution given the node mass and the substep interval:

<div>$${\dot m_{invmix}} = 0.5*{m_n}/\Delta t$$</div>

where

*Dt* = the substep time interval.

The use and source fluid steam outlet temperatures calculation procedure depends on the values of the effectiveness.  If the effectiveness is 1.0, then complete mixing of these fluid steam and the tank water is assumed.  In this case the outlet temperatures for the use and source streams will be simply the tank water temperatures at point of the outlet nodes. When the effectiveness is less than 1.0, an indirect heat exchange is assumed between the use or source stream and the water in the stratified thermal storage tank.  When the effectiveness is less than 1.0, the use and source outlet temperatures are calculated using *Q<sub>use</sub>* and *Q<sub>source</sub>*, and energy balance equations as follows:

<div>$${T_{use\;out,\,n}} = {T_{use,\,n}} + \frac{{{q_{use,n}}}}{{{{\dot m}_{use}}{c_p}}}$$</div>

<div>$${T_{source\;out,\,n}} = {T_{source,\,n}} - \frac{{{q_{source,n}}}}{{{{\dot m}_{source}}{c_p}}}$$</div>

 where,

*T<sub>use\\ out</sub>*<sub> </sub>= outlet fluid temperature of the use side plant connections

*T<sub>source\\ out</sub>*<sub> </sub>= outlet fluid temperature of the source side plant connections

#### Numerical Solution

The system of simultaneous differential equations is solved using the Forward-Euler numerical method.  The system time step is divided into one-second substeps.  The new temperature for a given node is calculated using the following equation:

<div>$${T_n} = {T_{n,old}} + \frac{{{q_{net,n}}\Delta t}}{{{m_n}{c_p}}}$$</div>

All node temperatures for *q<sub>net,n</sub>* are the old temperatures from the previous substep.

Before each system time step is calculated the following evaluations are made:

§ Use and source inlet flow rates are applied to the inlet nodes

§ Internode flow is determined and net flow rates are determined

Before each substep is calculated, the following evaluations are made:

1)   Thermostatic controls for heater 1 and heater 2 are evaluated to determine if the heater elements should turn on or off

2)   Node 1 temperature is compared against the maximum limit to determine if venting is necessary

3)   Adjoining node temperatures are compared to determine if there are any temperature inversions for which the inversion mixing rate should be used.

The solution continues looping through all substeps until the system time step is completed.

#### References

Duffie, J., and W. Beckman. 1980. *Solar Engineering of Thermal Processes*.  John Wiley & Sons.

Newton, B. 1995. *Modeling of Solar Storage Tanks*.  Master's Dissertation, University of Wisconsin-Madison.

### Water Heating Sizing

Some inputs for water heaters can be autosized using the input object WaterHeater:Sizing.  This section describes the sizing calculations for water heaters.  There are six general methods for sizing tank volume and heating capacity.

#### Autosizing Tank Volume

The volume a water heater can be sized in the following ways depending on the design method chosen by the user.

·        Peak Draw.  The volume is determined from the loop design flow rate.  The water heater is positioned on the supply side of a plant loop.  After the plant sizing routines have run, the model  obtains the design flow rate for all components on the demand side.  The tank volume is then: <span>$V = {\dot V_{loop.des}}*{t_{draw}}$</span>,

·        Residential HUD-FHA Minimum.  The volume is determined from a set of rules defined by the table below.  This is from Chapter 48 of 1999 ASHRAE Handbook HVAC Applications, Americal Society of Heating Refrigeration and Air-conditioning Engineeers, Atlanta GA.  (also used in the Building America Benchmark).

Table 85. Residential HUD-FHA Minimum

Residential HUD-FHA Minimum DHW Storage and Burner Capacity (ASHRAE 1999)

** **

**\# Bedrooms**

**1**

**2**

**3**

**4**

**5**

**6**

**\# Bathrooms**

**All**

**≤1.5**

**2-2.5**

**≥3**

**≤1.5**

**2-2.5**

**≥3**

**≤1.5**

**2-2.5**

**≥3**

**All**

**All**

Gas

























   Storage (gal)

20

30

30

40

30

40

40

40

40

50

50

50

   Burner (kBtu/hr)

27

36

36

36

36

36

38

36

38

38

47

50

Electric

























   Storage (gal)

20

30

40

50

40

50

50

50

50

66

66

80

   Burner (kW)

2.5

3.5

4.5

5.5

4.5

5.5

5.5

5.5

5.5

5.5

5.5

5.5

·        Per Person.  The tank volume is determined by summing the design level of people in the model and multiplying by a user-entered volume per person factor.

·        Per Floor Area.  The tank volume is determined by summing the floor area in all the zones in the model and multiplying by a user-entered volume per floor area factor.

·        Per Unit.  The tank volume is determined by multiplying a user-entered volume per unit and a user-entered number of units.

·        Per Solar Collector Area.  The tank volume is determined by summing the collector area in all the hot water solar collectors in the model and multiplying by a user-entered volume per collector area factor.

#### Autosizing Heater Capacity

The heater capacity can be sized in the following ways depending on the design method chosen by the user.

·        Peak Draw.  The heater capacity is determined from the tank volume, assumed start and finish temperatures and a user defined time for recovery.  The heater capacity is then

<div>$$$$</div><span>${q_{heat}} = V\rho \,{c_p}({T_{finish}} - {T_{start}})$</span>

where,

<div>$${T_{finish}} = 57.2C$$</div>

<div>$${T_{start}} = 14.4C$$</div>

·        Residential HUD-FHA Minimum.  The heater capacity is determined from a set of rules defined by the table above.  This is from 1999 ASHRAE Handbook HVAC Applications, Americal Society of Heating Refrigeration and Air-conditioning Engineeers, Atlanta GA.  (also used the Building America Benchmark).

·        Per Person.  The heater capacity is determined by summing the design level of people in the model and using a user-entered factor for recovery capacity per person.  The heater capacity is then:

<div>$${q_{heat}} = \frac{{{N_{people}}{f_{{\mathop{\rm Re}\nolimits} {\mathop{\rm cov}} eryPerPerson}}({T_{finish}} - {T_{start}})\rho \,{c_p}}}{{3600}}$$</div>

·        Per Floor Area.  The heater capacity is determined by summing the floor area in all the zones in the model and using a user-entered factor for recovery capacity per floor area.  The heater capacity is then:

<div>$$$$</div><span>${q_{heat}} = \frac{{{A_{floors}}{f_{{\mathop{\rm Re}\nolimits} {\mathop{\rm cov}} eryPerFloorArea}}({T_{finish}} - {T_{start}})\rho \,{c_p}}}{{3600}}$</span>

·        Per Unit.  The heater capacity is determined from a user-entered Recovery Capacity per unit and a user-entered number of units.  The heater capacity is then:

<div>$${q_{heat}} = \frac{{{N_{units}}{f_{{\mathop{\rm Re}\nolimits} {\mathop{\rm cov}} eryPerUnit}}({T_{finish}} - {T_{start}})\rho \,{c_p}}}{{3600}}$$</div>

·        Per Solar Collector Area. The water heater is assumed to be used for solar hot water storage and the heater capacity is set to zero.

#### Autosizing Tank Height

If the water heater is Stratified, then the geometry is important and the height of the tank can be scaled with changes in volume.  For tank shapes of Vertical Cylinder, the user defined height aspect ratio, *AR*,  is used to calculate a tank height, *H*, using

<div>$$H = {\left( {\frac{{4\,V\;A{R^2}}}{\pi }} \right)^{1/3}}$$</div>

#### Autosizing Plant Connection Flow Rates

When the water thermal tank is connected to a plant loop, it is convient to autosize the design volume flow rates through the plant connections.  When the water thermal tank is connected to the supply side of plant loop and flow rates are autosized, the flow rate is the sum of the flow requests of all the various components on the demand side of that plant loop.  When the water thermal tank is connected on the demand side of a plant loop (e.g. as for indirect water heating with a boiler) and flow rates are autosized, the design flow rates are calculated with the following equation,

<div>$$\dot V =  - \left( {\frac{V}{{{t_{{\mathop{\rm Re}\nolimits} {\mathop{\rm cov}} er}} * 3600 * \varepsilon }}} \right) * Ln\left[ {\frac{{\left( {{T_{PlantDesign}} - {T_{Setpo{\mathop{\rm int}} }}} \right)}}{{\left( {{T_{PlantDesign}} - {T_{start}}} \right)}}} \right]$$</div>

where

*V* = volume of the tank

<span>${t_{{\mathop{\rm Re}\nolimits} {\mathop{\rm cov}} er}}$</span> = User parameter for the time it takes for the tank to recover from assumed starting temperature to an assumed setpoint temperature.  For water heaters, the starting temperature is 14.4ºC and the final assumed setpoint temperature is 57.2ºC.  For chilled water tanks, the starting temperature is 14.4 ºC and the final temperature is 9.0ºC.

<span>$\varepsilon $</span> = *e<sub>use</sub>*   or *e<sub>source</sub>*

<span>${T_{PlantDesign}}$</span>= the exit temperature specified in the Plant Sizing object

<span>${T_{setpo{\mathop{\rm int}} }}$</span> =  the final tank temperature of 57.2ºC for heaters and 9.0ºC for chilled water tanks.

<span>${T_{start}}$</span> = the initial tank temperature of 14.4ºC

If the demand side connections are autosized and a water heater’s tank volume is autosized, then the problem cannot be readily solved in EnergyPlus because the demand side connection flows need to be reported earlier in the simulation and the tank volume is not yet available.  This situation is resolved by using an interim, nominal tank volume for sizing the connections and the actual volume is calculated later in the simulation.

Water Systems  <a name="WaterSystems"></a>
-------------

Water systems include a variety of components that simulate water consumption, production, and storage, including:

1.    Water Use Equipment and Connections

2.    Rainwater Collection

3.    Groundwater Well

4.    Water Storage Tanks

### Water Mains Temperatures

The input object Site:WaterMainsTemperature provides a model for the temperature of water mains that deliver water to a building via underground pipes.  The water mains temperatures are an important input for plant equipment that require make-up water from the water mains, such as for domestic hot water systems.

Water mains temperatures are a function of outdoor climate conditions and vary with time of year.  A correlation has been formulated to predict water mains temperatures based on two weather inputs:

average annual outdoor air temperature (dry-bulb)

maximum difference in monthly average outdoor air temperatures

These values can be easily calculated from annual weather data using a spreadsheet.

The correlation was developed by Craig Christensen and Jay Burch and is described in Hendron et al. (2004).  The correlation is:



T<sub>mains</sub> = (T<sub>out,avg</sub> + 6) + ratio \* (ΔT<sub>out,maxdiff</sub> / 2) \* SIN(0.986 \* (day - 15 - lag) - 90)



where

T<sub>mains</sub> = water mains temperature (°F)

T<sub>out,avg</sub> = average annual outdoor air temperature (°F)

ΔT<sub>out,maxdiff</sub> = maximum difference in monthly average outdoor air temperatures (°F)

day = Julian day of the year (1-365)

ratio = 0.4 + 0.01 \* (Tamb,avg - 44)

lag = 35 - 1.0 \* (Tamb,avg - 44) (°F)



For the Chicago-O'Hare TMY2 weather file, T<sub>out,avg</sub> = 9.69 C and ΔT<sub>out,maxdiff</sub> = 28.1 C.  The resulting water mains temperature profile is graphed below.



![](EngineeringReference/media/image6936.png)

#### References

Hendron, R., Anderson, R., Christensen, C., Eastment, M., and Reeves, P.  2004.  "Development of an Energy Savings Benchmark for All Residential End-Uses", Proceedings of SimBuild 2004, IBPSA-USA National Conference, Boulder, CO, August 4 - 6, 2004.

### Water Use Equipment and Connections

Essential parts of most water systems are the end uses where the water is utilized for a purpose.  These end uses are characterized by familiar pieces of equipment such as sinks, showers, dishwashers, clothes washers, and toilets.  End uses can also include outdoor uses such as landscape irrigation and agricultural irrigation.

Water end-use modeling in EnergyPlus is accomplished via two input objects:

§ WaterUse:Equipment

§ WaterUse:Connections

The WaterUse:Equipment object simulates all different types of water end uses.  The WaterUse:Connections object manages multiple pieces of water equipment with a common supply and return, internally providing the services of a splitter and a mixer.  The WaterUse:Connections object also allows water consuming equipment to be simulated in a closed plant loop by supplying makeup water from the water mains.

### Unconnected Water Use Equipment

Common water equipment, such as sinks and showers, requires mixing of hot and cold water to provide a desired temperature at the tap.  Water use equipment that is simulated in "unconnected" mode, i.e., without being referenced by a WaterUse:Connections object, presents a relatively simple modeling problem illustrated by the diagram below:

![Water Use Connections ENG Diagram 1](EngineeringReference/media/image6937.png)

Figure 315. Hot and Cold Water Mixing

The variables are defined as:

<span>${\dot m_{hot}}$</span>= hot water supply mass flow rate

<span>${T_{hot}}$</span>= hot water supply temperature

<span>${\dot m_{cold}}$</span>= cold water supply mass flow rate

<span>${T_{cold}}$</span>= cold water supply temperature

<span>${\dot m_{target}}$</span>= target mass flow rate at the tap

<span>${T_{target}}$</span>= target temperature at the tap

The basic physics of the problem are described by two equations representing conservation of mass and conservation of energy respectively:

<div>$${\dot m_{target}} = {\dot m_{hot}} + {\dot m_{cold}}$$</div>

<div>$${\dot m_{target}}{T_{target}} = {\dot m_{hot}}{T_{hot}} + {\dot m_{cold}}{T_{cold}}$$</div>

The hot and cold water supply temperatures, <span>${T_{hot}}$</span> and <span>${T_{cold}}$</span>, are specified by the user with schedules (or indirectly from the water mains temperatures).  The target flow rate and target temperature, <span>${\dot m_{target}}$</span> and <span>${T_{target}}$</span>, at the tap are also specified with schedules.  The target conditions can be thought of as a way to simulate occupant behavior; a person at a sink will adjust the hot and cold flow rates to get the overall water flow and temperature that is desired.

The two equations above are easily solved to calculate the necessary hot and cold flow rates needed to attain the target conditions.

<div>$${\dot m_{hot}} = {\dot m_{target}}\left( {\frac{{{T_{target}} - {T_{cold}}}}{{{T_{hot}} - {T_{cold}}}}} \right)$$</div>

<div>$${\dot m_{cold}} = {\dot m_{target}} - {\dot m_{hot}}$$</div>

Even though hot and cold flow rates are unlimited in "unconnected" mode, it is still possible to fail to meet the target conditions if <span>${T_{target}}$</span> &gt; <span>${T_{hot}}$</span>.  In this case, the actual mixed water temperature at the tap, <span>${T_{mixed}}$</span>, is set equal to <span>${T_{hot}}$</span>.  The target flow rate is always met.

Water equipment that omits schedules for the target temperature and/or hot water suppy temperature implies that no hot water is needed.  The result is all cold water at the target flow rate.

For "unconnected" water equipment, the heating rate and energy that is required to supply the hot water is calculated by the following equations.

<div>$$Q = {\dot m_{hot}}{c_p}\left( {{T_{hot}} - {T_{cold}}} \right)$$</div>

<div>$$\Delta E = Q\Delta t$$</div>

where

<span>$Q$</span>= heating rate

<span>${c_p}$</span>= specific heat of water

<span>$\Delta E$</span>= heating energy

<span>$\Delta t$</span>= time step interval

All heating is assigned to "Purchased Heating".

### Zone Heat Gain from Water Use Equipment

Some water use equipment can be a significant source of sensible and latent heat gain when located in a zone.  Showers, for example, add a noticeable latent gain as some of the hot water evaporates into the zone air (and at the same time adding some sensible gain).  Other types of equipment may contribute greater sensible gain but less latent gain.

Calculating the amount of sensible and latent heat gain can be extremely complicated and depends on many variables.  One set of variables is related to the initial conditions of the entering water and the undisturbed zone air, namely:

§ Entering water temperature

§ Entering water flow rate

§ Ambient zone air temperature

§ Ambient zone humidity

§ Ambient zone barometric pressure

A second set of variables is tied to the specifics of the water equipment which describe the heat and mass transfer processes that occur as the water passes through the zone.  These variables might include the velocity of the water in the zone air, the surface area of water exposed to the zone air, the dwell time of water in the zone, and possibly others.  The complexity of these variables cannot be easily cast into a generalized EnergyPlus input object.  Consider that in a shower, the velocity of water droplets is increasing as they fall, and the surface area of the spray is increasing.  How to even determine the surface area of the spray at any point?

The approach taken here is to utilize the first set of initial condition variables and forego the overly-complex second set.  The initial conditions can be used to calculate a maximum possible change in sensible and latent energy between the entering water conditions and the leaving water conditions at an infinite time later.  Sensible and latent energy are calculated separately and represent the maximum heat gain, respectively, that could be added to the zone air.  The user simply specifies a fraction of the maximum heat gain for sensible and latent that is actually added to the zone air.  The fraction is specified with a schedule to account for different modes of operation.  The split between sensible and latent will vary depending on the type of equipment that is to be modeled.  Typically, both fractions should be small numbers.

![Water Use Connections ENG Diagram 2](EngineeringReference/media/image6962.png)

Figure 316.  Zone Heat Gain from Water Use Equipment

The maximum sensible heat gain rate is calculated by assuming that all of the water flow is allowed to cool to the zone dry-bulb temperature.  The actual sensible zone heat gain rate is found by multiplying the maximum by the user fraction.

<div>$${Q_{sens}} = {f_{sens}}{\dot m_{target}}{c_p}\left( {{T_{target}} - {T_{zone}}} \right)$$</div>

<div>$$\Delta {E_{sens}} = {Q_{sens}}\Delta t$$</div>

where

<span>${Q_{sens}}$</span> = sensible heat gain rate

<span>${f_{sens}}$</span> = user fraction of maximum sensible heat

<span>${\dot m_{target}}$</span>= target mass flow rate at the tap

<span>${c_p}$</span>= specific heat of water

<span>${T_{target}}$</span>= target temperature at the tap

<span>${T_{zone}}$</span> = zone dry-bulb air temperature

<span>$\Delta {E_{sens}}$</span>= sensible heat gain

<span>$\Delta t$</span>= time step interval

The maximum latent heat gain rate is calculated by assuming that the maximum amount of water is evaporated into the zone air during the time step.  The actual latent zone heat gain rate is found by multiplying the maximum by the user fraction.

<div>$${m_{evap,zonemax}} = \left( {{W_{sat}} - {W_{zone}}} \right){\rho_{zone}}{V_{zone}}$$</div>

<div>$${m_{evap,flowmax}} = {\dot m_{target}}\Delta t$$</div>

<div>$${m_{evap,max}} = MIN({m_{evap,zonemax}},{m_{evap,flowmax}})$$</div>

<div>$${m_{evap}} = {f_{lat}}{m_{evap,max}}$$</div>

<div>$${\dot m_{evap}} = {m_{evap}}/\Delta t$$</div>

<div>$${Q_{lat}} = {h_{fg}}{\dot m_{evap}}$$</div>

<div>$$\Delta {E_{lat}} = {Q_{lat}}\Delta t$$</div>

where

<span>${m_{evap,zonemax}}$</span>= mass of water that can be absorbed by the zone air in one timestep

<span>${W_{sat}}$</span>= fully-saturated zone humidity ratio (function of air temperature and pressure)

<span>${W_{zone}}$</span> = zone humidity ratio

<span>${\rho_{zone}}$</span> = zone dry-air density (function of air temperature and pressure)

<span>${V_{zone}}$</span> = zone air volume

<span>${m_{evap,flowmax}}$</span>= mass of water available in the flow in one timestep

<span>${\dot m_{target}}$</span>= target mass flow rate at the tap

<span>$\Delta t$</span>= time step interval

<span>${m_{evap,max}}$</span>= maximum mass of water that can be evaporated

<span>${m_{evap}}$</span>= actual mass of water evaporated into the zone air

<span>${f_{lat}}$</span> = user fraction of maximum latent heat

<span>${\dot m_{evap}}$</span>= mass rate of water evaporation into the zone air

<span>${Q_{lat}}$</span> = latent heat gain rate

<span>${h_{fg}}$</span>= heat of vaporization for water

<span>$\Delta {E_{lat}}$</span>= latent heat gain

Sensible and latent heat gains to the zone are lagged by one zone time step.

Note that this method allows the heat gain to vary dynamically according to changing water and zone conditions instead of the fixed or scheduled value that is traditionally used.  However, sensible and latent fractions may be difficult to estimate.  Experimental measurement is probably the best way to determine the fractions.

A related result of any zone heat and moisture gain is that the water undergoes an equal heat and moisture loss.  For a shower the water will generally leave the zone at a cooler temperature and slightly reduced flow rate when compared to the entering water conditions.

<div>$${\dot m_{drain}} = {\dot m_{target}} - {\dot m_{evap}}$$</div>

<div>$${T_{drain}} = \frac{{{{\dot m}_{target}}{c_p}{T_{target}} - {Q_{sens}} - {Q_{lat}}}}{{{{\dot m}_{drain}}{c_p}}}$$</div>

where

<span>${\dot m_{drain}}$</span>= drainwater mass flow rate at the drain

<span>${\dot m_{target}}$</span>= target mass flow rate at the tap

<span>${\dot m_{evap}}$</span>= mass rate of water evaporation into the zone air

<span>${T_{drain}}$</span>= water temperature at the drain

<span>${c_p}$</span>= specific heat of water

<span>${T_{target}}$</span>= target temperature at the tap

<span>${Q_{sens}}$</span> = sensible heat gain rate

<span>${Q_{lat}}$</span> = latent heat gain rate

The change in leaving water conditions has implications for drainwater heat recovery and storage tank conditions.

### Connected Water Use Equipment

Water use equipment referenced by a WaterUse:Connections object is considered to be in "connected" mode.  The WaterUse:Connections object manages multiple pieces of water equipment with a common supply and return, internally providing the services of a splitter and a mixer.  The connections object also offers three internal configurations for drainwater heat recovery.  External connections are available for coupling to plant loop nodes or water storage tanks for graywater reuse or reclamation.

Keep in mind that water use equipment in "connected" mode does not imply that it is connected to a plant loop.  WaterUse:Equipment objects are never directly connected to a plant loop; they are connected indirectly through the WaterUse:Connections object.  WaterUse:Connections can operate either within a plant loop or in stand-alone mode, i.e., without plant loop connections.

The WaterUse:Connections object overrides the hot and cold water supply temperatures of its subordinate WaterUse:Equipment objects based on the specified schedules, plant loop conditions, or water storage tank conditions.  But the WaterUse:Equipment objects still maintain their individual target flow rates and target temperatures.

Solving the water subsystem described by the WaterUse:Connections object is appreciably more difficult than solving a single, unconnected piece of water use equipment.  The subsystem is illustrated below.

![Water Use Connections ENG Diagram 3](EngineeringReference/media/image7005.png)

Figure 317. Water Use Connections Subsystem

The nomenclature here uses uppercase letters to indicate variables related to the connections object and lowercase letters to indicate variables related to the equipment objects.  The variables are defined as:

<span>${\dot M_{hot}}$</span>= hot water supply mass flow rate

<span>${T_{hot}}$</span>= hot water supply temperature

<span>${\dot M_{cold}}$</span>= cold water supply mass flow rate

<span>${T_{cold}}$</span>= cold water supply temperature

<span>${\dot M_{drain}}$</span>= drainwater mass flow rate at the drain

<span>${T_{drain}}$</span>= water temperature at the drain

<span>${T_{waste}}$</span>= wastewater temperature after the drain

<span>${\dot M_{return}}$</span>= return water mass flow rate back to the plant loop

<span>${T_{return}}$</span>= return temperature of makeup water back to the plant loop

### Water Use Equipment Calculations

The solution method proceeds in steps:

§ *InitConnectionsTemps*

§ *CalcConnectionsFlowRates*

§ *CalcConnectionsDrainTemp*

§ *UpdateConnectionsNodes*

#### Initialize Connections Temperatures

Initializes the hot and cold supply water temperatures, <span>${T_{hot}}$</span> and <span>${T_{cold}}$</span>, for the common supply to all the equipment.  If plant-coupled, <span>${T_{hot}}$</span> is taken from the plant loop inlet node.  If stand-alone, <span>${T_{hot}}$</span> is taken from the schedule.

<span>${T_{cold}}$</span> is taken from the supply water storage tank, if specified.  Otherwise <span>${T_{cold}}$</span> is taken from the schedule.  If a schedule is not specified, <span>${T_{cold}}$</span> is taken from the water mains.

#### Calculate Connections Flow Rates

First calls on each piece of equipment to simulate itself with the given supply water temperatures <span>${T_{hot}}$</span> and <span>${T_{cold}}$</span>.  The desired hot and cold flow rates for <span>${\dot m_{hot,i}}$</span> and <span>${\dot m_{cold,i}}$</span> are calculated (as described earlier) and passed back to the connections object.  The total flow rates for <span>${\dot M_{hot}}$</span> and <span>${\dot M_{cold}}$</span> are then calculated:

<span>${\dot M_{hot}} = \mathop \sum \limits_i {\dot m_{hot,i}}$</span>           <span>${\dot M_{cold}} = \mathop \sum \limits_i {\dot m_{cold,i}}$</span>

If plant-coupled, <span>${\dot M_{hot}}$</span> is compared to the maximum flow rate available in the plant loop (after the first HVAC iteration).  If <span>${\dot M_{hot}}$</span> &gt; <span>${\dot M_{hot,max}}$</span>, the actual flow rate is reset to equal the maximum:  <span>${\dot M_{hot}}$</span> = <span>${\dot M_{hot,max}}$</span>.  New hot and cold flow rates, <span>${\dot m'_{hot,i}}$</span> and <span>${\dot m'_{cold,i}}$</span>, at the equipment level are then recalculated, decreasing the hot flow rate and increasing the cold flow rate in order to still meet the target flow rate.

<div>$$\alpha  = \frac{{{{\dot M}_{hot,max}}}}{{{{\dot M}_{hot}}}}$$</div>

<div>$${\dot m'_{hot,i}} = \alpha {\dot m_{hot,i}}$$</div>

<div>$${\dot m'_{cold,i}} = {\dot m_{target,i}} - {\dot m'_{hot,i}}$$</div>

A new mixed water temperature is also recalculated at the equipment level.

Although water storage tanks can also have a maximum flow rate on the cold side, the cold flow rate is not limited in this implementation.

#### Calculate Connections Drain Temperature

At this point zone heat gains are calculated for all equipment in zones.  The final drainwater temperatures and flow rates are determined for each piece of equipment by subtracting the lost heat and moisture (see above).  The total drainwater temperature and flow rate for the subsystem are calculated:

<span>${\dot M_{drain}} = \mathop \sum \limits_i {\dot m_{drain,i}}$</span>           <span>${T_{drain}} = \frac{{\mathop \sum \limits_i {{\dot m}_{drain,i}}{t_{drain,i}}}}{{{{\dot M}_{drain}}}}$</span>

In the case of no drainwater heat recovery, the subsystem wastewater temperature, <span>${T_{waste}}$</span>, is equal to the drainwater temperature, <span>${T_{drain}}$</span>.  (For drainwater heat recovery, see below.)  The wastewater temperature and flow rate are propogated to the reclamation water storage tank, if specified.

#### Update Connections Nodes

Finally, if plant-coupled, the return water temperature, <span>${T_{return}}$</span>, is passed on to the plant outlet node.  <span>${T_{return}}$</span> is taken from the cold water supply schedule or the water mains.  The return flow rate is equal to the hot water supply flow rate in order to preserve a closed plant loop:  <span>${\dot M_{return}}$</span> = <span>${\dot M_{hot}}$</span>.

For "connected" water equipment, the heating rate and energy that is required to supply the hot water for individual water equipment is calculated by the following equations. 

<div>$$Q = {\dot m_{hot}}{c_p}\left( {{T_{hot}} - {T_{return}}} \right)$$</div>

<div>$$\Delta E = Q\Delta t$$</div>

where

<span>$Q$</span>= heating rate

<span>${c_p}$</span>= specific heat of water

<span>$\Delta E$</span>= heating energy

<span>$\Delta t$</span>= time interval

The heating rate and energy for the WaterUse:Connections is the sum of the values for its constituent water equipment objects.  If the WaterUse:Connections object is stand-alone, all heating is assigned to "Purchased Heating" by the individual water equipment objects.  If the WaterUse:Connections object is coupled to a plant loop, all heating is supplied by the plant loop equipment.

### Drainwater Heat Recovery

Drainwater heat recovery adds one more complication to the water connections subsystem.  A heat exchanger is added between the drain and the waste outlet to recover some heat from the water before it leaves the system.  The heat is usually recovered by preheating the incoming makeup water from the mains.

The heat exchanger can be modeled as "ideal", "counterflow", or "crossflow".  One common type of drainwater heat exchanger is the gravity-film exchanger (GFX).  The GFX can be approximated with a counterflow heat exchanger.

The destination of the preheated makeup water can be plumbed in three possible configurations:  "plant", "equipment", "plant and equipment".  In the "plant" configuration, all preheated water flow is returned to the plant loop to match the makeup water for the hot water supply flow.  In the "equipment" configuration, all preheated water flow is directed internally within the WaterUse:Connections object to provide the makeup water for the cold water supply flow for the local water use equipment.  In the "plant and equipment" configuration, the preheated water is split between both of the previous configurations.  This is the only configuration where the flow rate is equal on both sides of the heat exchanger.

![Water Use Connections ENG Diagram 4](EngineeringReference/media/image7054.png)

Figure 318. Water Use Connections Subsystem with Drainwater Heat Recovery

The new variables added here are defined as:

<span>${\dot M_{recovery}}$</span>= makeup water mass flow rate in the heat exchanger

<span>${T_{recovery}}$</span>= water temperature leaving the heat exchanger

<span>${T_{makeup}}$</span>= cold makeup water temperature supplied to various flows

Another subroutine is inserted into the solution method:

§ *InitConnectionsTemps*

§ *CalcConnectionsFlowRates*

§ *CalcConnectionsDrainTemp*

§ ***CalcConnectionsHeatRecovery***

§ *UpdateConnectionsNodes*

For the "equipment" and "plant and equipment" configurations, the solution requires iteration to solve because the preheated water leaving the heat exchanger is connected to the cold water supply water, creating a feedback loop.

#### Calculate Connections Heat Recovery

Based on the selected configuration, the flow rate through the heat exchanger is first determined.  For the "plant" configuration, <span>${\dot M_{recovery}} = {\dot M_{hot}}$</span>.  For the "equipment" configuration, <span>${\dot M_{recovery}} = {\dot M_{cold}}$</span>.  For the "plant and equipment" configuration, <span>${\dot M_{recovery}} = {\dot M_{hot}} + {\dot M_{cold}}$</span>.

The heat capacity rates on both sides of the heat exchanger are calculated and the minimum and maximum heat capacity rates, <span>${C_{min}}$</span> and <span>${C_{max}}$</span>, are determined.

<div>$${C_{drain}} = {\dot M_{drain}}{c_p}$$</div>

<div>$${C_{recovery}} = {\dot M_{recovery}}{c_p}$$</div>

<div>$${C_{min}} = MIN({C_{drain}},{C_{recovery}})$$</div>

<div>$${C_{max}} = MAX({C_{drain}},{C_{recovery}})$$</div>

<div>$${R_c} = \frac{{{C_{min}}}}{{{C_{max}}}}$$</div>

where <span>${R_c}$</span> = the heat capacity ratio.

The effectiveness <span>$\varepsilon $</span> is then calculated for the given type of heat exchanger.  For the "ideal" heat exchanger, <span>$\varepsilon  = 1$</span>.

For the "counterflow" and "crossflow" heat exchangers, the effectiveness is calculated using the effectiveness-NTU method, where:

<div>$$NTU = \frac{{UA}}{{{C_{min}}}}$$</div>

For the "counterflow" heat exchanger:

<span>$\varepsilon  = \frac{{NTU}}{{1 + NTU}}$</span>, if <span>${R_c}$</span> = 1

<span>$\varepsilon  = \frac{{1 - EXP\left( { - NTU\left( {1 - {R_c}} \right)} \right)}}{{1 - {R_c}EXP\left( { - NTU\left( {1 - {R_c}} \right)} \right)}}$</span>, if <span>${R_c}$</span> &lt; 1

For the "crossflow" heat exchanger:

<div>$$\varepsilon  = 1 - EXP\left( {\frac{{NT{U^{0.22}}}}{{{R_c}}}\left( {EXP\left( { - {R_c}NT{U^{0.78}}} \right) - 1} \right)} \right)$$</div>

The heat recovery rate is then calculated.

<div>$${Q_{recovery}} = \varepsilon {C_{min}}\left( {{T_{drain}} - {T_{makeup}}} \right)$$</div>

The outlet water temperatures can then be calculated for both sides of the heat exchanger.

<div>$${T_{recovery}} = {T_{makeup}} + \frac{{{Q_{recovery}}}}{{{{\dot M}_{recovery}}{c_p}}}$$</div>

<div>$${T_{waste}} = {T_{drain}} - \frac{{{Q_{recovery}}}}{{{{\dot M}_{drain}}{c_p}}}$$</div>

At each iteration the difference between <span>${T_{recovery}}$</span> and <span>${T_{cold}}$</span>is compared and checked for convergence.

<div>$$\Delta {T_{error}} = \left| {{T_{recovery}} - {T_{cold}}} \right|$$</div>

Once the temperatures have converged, the solution is complete.  <span>${T_{waste}}$</span> is then passed on to a storage tank, if specified.

Zone Controls <a name="ZoneControls"></a>
-------------

### Thermostatic Zone Control

The input object ZoneControl:Thermostat provides a way for the zone to be controlled to a specified temperature.  ZoneControl:Thermostat references a control type schedule and one or more control type objects which in turn reference one or more setpoint schedules.

The control type schedule and the list of control type/name pairs are directly related.  The schedule defines the type of control that is to be used during for each hour.  Valid control types are

0 - Uncontrolled (No specification or default)

1 - Single Heating Setpoint

2 - Single Cooling SetPoint

3 - Single Heating/Cooling Setpoint

4 - Dual Setpoint (Heating and Cooling) with deadband

If the schedule referenced in the ZoneControl statement has a value of 4 for a particular hour, this indicates that during that hour "dual setpoint with deadband control" is to be used.  The specific "dual setpoint with deadband" control object to be used is specified in the list of control type/name pairs.  Then the specific control type objects reference the thermostat setpoint temperature schedule to be used.  Because only one control can be specified for each control type in a ZoneControl statement, there are only four pairs possible in a particular ZoneControl type/name list.  This is because individual controls can be defined hourly, thus giving the user a full range of flexibility.  Since putting in the name of the control type directly in the schedule would be very cumbersome, the control types are assigned a number which is used in the hourly schedule profile.

For more information see ZoneControl:Thermostat in the Input Output Reference and succeeding sections in this document.

### Zone Thermostats

The schema for the current set of four zone thermostats is given below.  In each case, the keyword is accompanied by an identifying name and either one or two schedule names (depending on whether the control is a single or dual setpoint control).  The schedule defines a temperature setpoint for the control type.  The schedule would be defined through the standard schedule syntax described earlier in this document.  For an uncontrolled zone no thermostat is specified or necessary.  See the Input Output Reference for more details.

The control type schedule and the list of control type/name pairs are directly related.  The schedule defines the type of control that is to be used during for each hour.  Valid Control Types are

<table class="table table-striped">





<tr>
<td>Control Type Value</td>
<td>Control Type Name</td>
</tr>
<tr>
<td>0</td>
<td>Uncontrolled (No specification or default)</td>
</tr>
<tr>
<td>1</td>
<td>Single Heating Setpoint (input object ThermostatSetpoint:SingleHeating)</td>
</tr>
<tr>
<td>2</td>
<td>Single Cooling SetPoint (input object ThermostatSetpoint:SingleCooling)</td>
</tr>
<tr>
<td>3</td>
<td>Single Heating/Cooling Setpoint (input object ThermostatSetpoint:SingleHeatingOrCooling)</td>
</tr>
<tr>
<td>4</td>
<td>Dual Setpoint (Heating and Cooling) with deadband (input object ThermostatSetpoint:DualSetpoint)</td>
</tr>

</table>

For the Uncontrolled case no heating or cooling requirement is calculated for the system to meet.

CASE (0)

  ! Uncontrolled Zone

  LoadToHeatingSetPoint = 0.0

  LoadToCoolingSetPoint = 0.0

  ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = 0.0

For the Single Heating Setpoint there would be a heating only thermostat.  The setpoint can be scheduled and varied throughout the simulation but only heating is allowed with this control type.

CASE (SingleHeatingSetPoint)

  ! Determine zone load based on

  ! Qload + Qsys = 0 and Qsys = mCp(Tsys-Tzone)

  ! System Load Sign Convention:

  !     - -&gt; Cooling required to reach setpoint

  !     + -&gt; Heating required to reach setpoint



  LoadToHeatingSetPoint = (TempDepZnLd(ZoneNum) \*

                           TempZoneThermostatSetPoint(ZoneNum) –

                           TempIndZnLd(ZoneNum))



  IF ((ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired - 1.0) &lt; 0.0) THEN

    DeadBandOrSetback(ZoneNum) = .TRUE.

  ENDIF

For the Single Cooling Setpoint there would be a cooling only thermostat.  The setpoint can be scheduled and varied throughout the simulation but only cooling is allowed with this control type.

CASE (SingleCoolingSetPoint)



  LoadToCoolingSetPoint = (TempDepZnLd(ZoneNum) \*

                           TempZoneThermostatSetPoint(ZoneNum) –

                           TempIndZnLd(ZoneNum))



  ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = LoadToCoolingSetPoint



  IF ((ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired + 1.0) &gt; 0.0) THEN

    DeadBandOrSetback(ZoneNum) = .TRUE.

  ENDIF

For the Single Heat Cool Setpoint there would be a cooling only thermostat there would be a heating and cooling thermostat.  The setpoint can be scheduled and varied throughout the simulation for both heating and cooling. With this control type only 1 setpoint profile is needed or used.

CASE (SingleHeatCoolSetPoint)



  LoadToHeatingSetPoint = (TempDepZnLd(ZoneNum) \*

                           TempZoneThermostatSetPoint(ZoneNum) –

                           TempIndZnLd(ZoneNum))

  LoadToCoolingSetPoint = (TempDepZnLd(ZoneNum) \*

                           TempZoneThermostatSetPoint(ZoneNum) –

                           TempIndZnLd(ZoneNum))



! Possible combinations:

! 1/  LoadToHeatingSetPoint &gt; 0 & LoadToCoolingSetPoint &gt; 0 --&gt;  Heating required

! 2/  LoadToHeatingSetPoint &gt; 0 & LoadToCoolingSetPoint &lt; 0 --&gt;  Not Feasible

! 3/  LoadToHeatingSetPoint &lt; 0 & LoadToCoolingSetPoint &lt; 0 --&gt;  Cooling Required

! 4/  LoadToHeatingSetPoint &lt; 0 & LoadToCoolingSetPoint &gt; 0 --&gt;  Dead Band Operation



  IF (LoadToHeatingSetPoint &gt; 0.0 .AND. LoadToCoolingSetPoint &gt; 0.0) THEN

    ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = LoadToHeatingSetPoint

    ZoneSetPoint = ZoneThermostatSetPointLo(ZoneNum)

  ELSEIF (LoadToHeatingSetPoint &lt; 0.0 .AND. LoadToCoolingSetPoint &lt; 0.0) THEN

    ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = LoadToCoolingSetPoint

    ZoneSetPoint = ZoneThermostatSetPointHi(ZoneNum)

  ELSEIF (LoadToHeatingSetPoint &lt; 0.0 .AND. LoadToCoolingSetPoint &gt; 0.0) THEN

    ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = 0.0

    IF(Zone(ZoneNum)%SystemZoneNodeNumber &gt; 0) THEN

      ZoneSetPoint = Node(Zone(ZoneNum)%SystemZoneNodeNumber)%Temp

    ENDIF

    DeadBandOrSetback(ZoneNum) = .TRUE.

  ENDIF

For Dual Setpoint with DeadBand there would be a heating and cooling thermostat.  For this case both a heating and cooling setpoint can be scheduled for any given time period.  The setpoint can be scheduled and varied throughout the simulation for both heating and cooling.

CASE (DualSetPointWithDeadBand)



  LoadToHeatingSetPoint = (TempDepZnLd(ZoneNum) \*

                           ZoneThermostatSetPointLo(ZoneNum) –

                           TempIndZnLd(ZoneNum))

  LoadToCoolingSetPoint = (TempDepZnLd(ZoneNum) \*

                           ZoneThermostatSetPointHi(ZoneNum) –

                           TempIndZnLd(ZoneNum))



! Possible combinations:

! 1/  LoadToHeatingSetPoint &gt; 0 & LoadToCoolingSetPoint &gt; 0 --&gt;  Heating required

! 2/  LoadToHeatingSetPoint &gt; 0 & LoadToCoolingSetPoint &lt; 0 --&gt;  Not Feasible

! 3/  LoadToHeatingSetPoint &lt; 0 & LoadToCoolingSetPoint &lt; 0 --&gt;  Cooling Required

! 4/  LoadToHeatingSetPoint &lt; 0 & LoadToCoolingSetPoint &gt; 0 --&gt;  Dead Band Operation

  IF (LoadToHeatingSetPoint &gt; 0.0 .AND. LoadToCoolingSetPoint &gt; 0.0) THEN

    ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = LoadToHeatingSetPoint

    ZoneSetPoint = ZoneThermostatSetPointLo(ZoneNum)

  ELSEIF (LoadToHeatingSetPoint &lt; 0.0 .AND. LoadToCoolingSetPoint &lt; 0.0) THEN

    ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = LoadToCoolingSetPoint

    ZoneSetPoint = ZoneThermostatSetPointHi(ZoneNum)

  ELSEIF (LoadToHeatingSetPoint &lt; 0.0 .AND. LoadToCoolingSetPoint &gt; 0.0) THEN

    ZoneSysEnergyDemand(ZoneNum)%TotalOutputRequired = 0.0

    IF(Zone(ZoneNum)%SystemZoneNodeNumber &gt; 0) THEN

      ZoneSetPoint = Node(Zone(ZoneNum)%SystemZoneNodeNumber)%Temp

    ENDIF

    DeadBandOrSetback(ZoneNum) = .TRUE.

  ENDIF

### Operative Temperature Control

The input object ZoneControl:Thermostat:OperativeTemperature provides a model where the behavior of the zone thermostats described above can be modified to accommodate operative temperature control. The ZoneControl:Thermostat:OperativeTemperature input object is used to modify the behavior of any of the thermostatic control types described above.  When this object is used, the zone can be controlled by a weighted mixture of radiant and air temperatures (rather than just zone air temperatures).

In EnergyPlus, operative temperature, <span>${T_{OP}}$</span>, is defined as ,

<div>$${T_{OP}} = \gamma {T_{MRT}} + (1 - \gamma ){T_{drybulb}}$$</div>

where,

<span>$\gamma $</span>  is the radiative fraction,

<span>${T_{MRT}}$</span> is the mean radiant temperature for the thermal zone, and

<span>${T_{drybulb}}$</span>is the mean zone air temperature.

The radiative fraction <span>$\gamma $</span> is selected by the user and can be scheduled to vary during the simulation.  A typical value is 0.5.  The maximum value needs to be less than 0.9 and the minimum is 0.0.  A value of 0.0 is the same as controlling on only zone air temperature.  If air velocities are higher than 0.2 m/s, then lower values for radiative fraction might apply.  Niu and Burnett (1998) cite International Standard ISO 77300 in recommending the values for this fraction listed in the following table.

Table 86.  Operative Temperature - Radiative Fraction vs Air Velocity

<table class="table table-striped">







<tr>
<td>Air Velocity (m/s)</td>
<td>&lt; 0.2</td>
<td>0.2 to 0.6</td>
<td>0.6 to 1.0</td>
</tr>
<tr>
<td><span>$\gamma $</span></td>
<td>0.5</td>
<td>0.4</td>
<td>0.3</td>
</tr>

</table>

The control is accomplished using the load to setpoint formulation that is fundamental to HVAC system control in EnergyPlus. Although real systems will not know the loads and operate on temperature-based control, EnergyPlus needs to be able to function at zone timesteps up to one hour and this is too long of a timeframe for true temperature-based zone control.  Load-based control is an important method of determining the average HVAC system response to zone conditions over the time step.  For operative temperature control, the same methods and routines are used for calculating loads to setpoints but the setpoints are shifted to emulate operative temperature control rather than air temperature control.

The user-defined setpoint for <span>${T_{OP}}$</span> is an input in degrees Celsius. <span>${T_{MRT}}$</span> is continually modeled by the full zone heat balance method and includes all the interactions between thermal loads and HVAC systems.  A new setpoint for the zone’s <span>${T_{drybulb}}$</span> is obtained for each zone timestep by rearranging the definition of <span>${T_{OP}}$</span> to put <span>${T_{drybulb}}$</span> on the left hand side.

<div>$${T_{drybulb,setpo{\mathop{\rm int}} }} = \frac{{{T_{OP,setpo{\mathop{\rm int}} }} - \gamma {T_{MRT}}}}{{(1 - \gamma )}}$$</div>

This adjustment to the target zone air drybulb temperature is made every timestep for every zone immediately after the setpoints are obtained from the schedule.

Reference: J. Niu and J. Burnett. 1998. Integrating Radiant/Operative Temperature Controls into Building Energy Simulations. ASHRAE Transactions Vol. 104. Part 2. page 210.  ASHRAE.  Atlanta, GA.

### Temperature And Humidity Control

##### The input object ZoneControl:Thermostat:TemperatureAndHumidity is used to modify the behavior of ZoneControl:Thermostat objects (control types ThermostatSetpoint:SingleCooling and ThermostatSetpoint:DualSetpoint only) based on zone air humidity conditions. Specifically, this TemperatureAndHumidity zone control resets the ZoneControl:Thermostat’s cooling setpoint temperature downward when the zone air relative humidity exceeds the Dehumidifying Relative Humidity Setpoint defined in this object. The reduced cooling setpoint temperature typically results in longer cooling coil runtimes and additional dehumidification. While additional dehumidification (lower absolute humidity level in the zone air) may be achieved, the resulting dry-bulb temperature and absolute humidity of the zone air will determine if the zone air **relative humidity** is reduced.

##### The rate at which the cooling setpoint temperature is reduced is dictated by the user-specified Overcool Control Ratio. The maximum reduction in cooling setpoint temperature is defined by the user-entered Overcool Range, although the Overcool Range may be reduced from the user-defined value when this TemperatureAndHumidity control is used in tandem with a dual setpoint thermostat (see discussion below). Note that occupants are sensitive to overcooling and can experience discomfort if the overcool range is too large.

This control is accomplished using the load to setpoint formulation that is fundamental to HVAC system control in EnergyPlus. Although real systems will not know the loads and operate on temperature-based control, EnergyPlus needs to be able to function at zone timesteps up to one hour and this is too long of a timeframe for true temperature-based zone control. Load-based control is an important method of determining the average HVAC system response to zone conditions over the time step. For TemperatureAndHumidity control, the same methods and routines are used for calculating loads to setpoints but the cooling setpoint is shifted to emulate TemperatureAndHumidity control, as described above.

The overcool range limits the extent of the zone air temperature reduction below the cooling setpoint. When a dual setpoint thermostat is being modified by this TemperatureAndHumidity control, the maximum overcool range must be less than or equal to the temperature difference between the dual setpoint thermostat’s cooling and heating setpoints:

<div>$$\Delta {T_{OvercoolRange,MAX}} = MIN\left( {\Delta {T_{OvercoolRange}},\,\Delta {T_{Setpoints}}} \right)$$</div>

where,

<span>$\Delta {T_{OvercoolRange,MAX}}$</span>= maximum overcool range for the zone air (°C)

<span>$\Delta {T_{OvercoolRange}}$</span>= overcool range for the zone air (°C).  User input.

<span>$\Delta {T_{Setpoints}}$</span>= temperature difference between the cooling and heating setpoints (°C)

If a single cooling setpoint thermostat is being modified by this control, the maximum overcool range is equal to the user-defined overcool range.

The extent that the zone air relative humidity exceeds the user-entered dehumidifying relative humidity setpoint is given by:

<div>$$\Delta \phi  = MAX\left( {0.0,{\phi_{ZoneLagged}} - {\phi_{CSP}}} \right)$$</div>

The actual cooling setpoint reduction (overcooling) is calculated for the condition when the zone air relative humidity exceeds the dehumidifying setpoint (i.e., <span>$\Delta \phi $</span>&gt;0), as described below:

<div>$$\begin{array}{l}IF\,\,(\Delta \phi \, > \,0)\,\,THEN\\ ,\,\,\,\,\Delta {T_{Overcool,Actual}} = MIN\left( {\Delta {T_{OvercoolRange,MAX}},\,{{\Delta \phi } \mathord{\left/ {\vphantom {{\Delta \phi } {\Delta {\phi_{adjust}}}}} \right. } {\Delta {\phi_{adjust}}}}} \right)\\ELSE\\ ,\,\,\,\,\Delta {T_{Overcool,Actual}} = 0\\ENDIF\end{array}$$</div>

The cooling setpoint temperature is then adjustedas follows:

<span>${T_{CSP,adj}} = \left( {{T_{CSP}} - \Delta {T_{Overcool,Actual}}} \right)$</span>where,

<span>${T_{CSP,adj}}$</span>= adjusted cooling setpoint temperature (°C)

<span>${T_{CSP}}$</span>= zone air cooling setpoint temperature for the current time step (°C).  User input.

<span>$\Delta {\phi_{adjust}}$</span>= user-defined overcool control ratio (%/K)

<span>$\Delta \phi $</span>= difference between the zone air relative humidity and the user-defined dehumidifying setpoint (%)

<span>${\phi_{ZoneLagged}}$</span> = zone air relative humidity calculated at the last system time step (%)

<span>${\varphi_{CSP}}$</span>= dehumidifying relative humidity setpoint at the current time step (%).  User input.

This adjusted cooling setpoint temperature is made every timestep for every zone immediately after the original thermostat setpoint is obtained from the user-defined setpoint schedule.

### Humidistat

The input object ZoneControl:Humidistat provides a way for the zone to be controlled to a single relative humidity setpoint schedule, or dual humidity schedules (humidifying and dehumidifying with deadband). The schedules consist of relative humidities, expressed as a percentage (0-100), to be used for the zone moisture prediction calculation. Only one control statement can be specified for each zone.  Individual relative humidity values can be defined for every time step, thus giving the user a full range of flexibility. For a single setpoint humidistat, if the control relative humidity is below the calculated load and the equipment specified can humidify then that equipment will try and meet the requirement.  The opposite is true if the calculated value is above the setpoint and the equipment can dehumidify. For a dual setpoint humidistat, if the zone relative humidity is below the **humidifying** relative humidity setpoint and the equipment specified can humidify then that equipment will try and meet the zone’s humidification load. The opposite is true if the zone relative humidity is above the **dehumidifying** relative humidity setpoint and the equipment can dehumidify.

If the ZoneControl:Humidistat is used by a furnace or unitary system then no other objects are required. The signal from the humidistat is used directly by that component. If the Zone Control:Humidistat is used to control a Humidifier or used in conjunction with the Controller:Simple object with control variable "TemperatureAndHumidityRatio", then either the “SetpointManager:SingleZone:Humidity:Minimum”, “SetpointManager:MultiZone:Humidity:Minimum”,   “SetpointManager:SingleZone:Humidity:Maximum” or “SetpointManager:MultiZone:Humidity:Maximum” objects are required to determine a setpoint for those components to meet for the single setpoint humidistat. For a dual setpoint humidistat, a minimum humidity setpoint manager object  (“SetpointManager:SingleZone:Humidity:Minimum” or “SetpointManager:MultiZone:Humidity:Minimum”) and a maximum humidity setpoint manager object (“SetpointManager:SingleZone:Humidity:Maximum” or “SetpointManager:MultiZone:Humidity:Maximum”) are required to determine the setpoints for the corresponding humidification and dehumidification components. Note that the “SetpointManager:Scheduled” object can also be used to directly set humidity ratio setpoints on the exit node of the humidifier component.

For the single setpoint humidistat case, the model takes into account all of the moisture gains and/or losses from sources except the HVAC system contribution, and then calculates a moisture removal or addition rate based on the provided setpoint value, like the temperature predictor. The algorithm uses a 3rd Order derivative to predict zone moisture addition or removal to smooth the changes using the zone air capacitance. Positive values of moisture load mean that this amount of moisture must be added to the zone to reach the setpoint. Negative values represent the amount of moisture that must be removed by the system.

<div>$${\rm{MoistLoadHumidSetPoint = massflow}}\cdot {\rm{HumidityRatio = kg air/sec}}\cdot {\rm{kg }}{{\rm{H}}_{\rm{2}}}{\rm{O/kg air = kg }}{{\rm{H}}_{\rm{2}}}{\rm{O/sec}}$$</div>

This routine also calculates the zone required humidity ratio, Wsetpoint, which is required and takes into account the zone multiplier. At this time the Wsp is not stored in a derived type to make it available for SetpointManagers. It was setup to be analogous to the temperature thermostat.

For the dual setpoint humidistat case, the model takes into account all of the moisture gains and/or losses from sources except the HVAC system contribution, and then calculates moisture addition and removal rates based on the provided humidifying and dehumidifying setpoint values, like the temperature predictor. The algorithm uses a Third Order Backward Difference , Analytical Solution, or Euler Method in subroutine CalcPredictedHumidityRatio to predict zone moisture addition and removal to smooth the changes using the zone air capacitance. The program calculates the humidifying (addition) and dehumidifying (removal) moisture loads based on the specified humidifying and dehumidifying setpoints, respectively. The calculated humidifying moisture load is passed to subroutine CalcSingZoneMinHumSetPoint and CalcMultiZoneMinHumSetPoint in the SetpointManager module to calculate the requested supply air humidity ratio at the setpoint node (Ref. SetpointManager:SingleZone:Humidity:Minimum and SetpointManager:MultiZone:Humidity:Minimum objects). The calculated dehumidifying moisture load is passed to subroutine CalcSingZoneMaxHumSetPoint and CalcMultiZoneMaxHumSetPoint in the SetpointManager module to calculate the requested supply air humidity ratio at the setpoint node (Ref. SetpointManager:SingleZone:Humidity:Maximum and SetpointManager:MultiZone:Humidity:Maximum objects). At the same time, the dehumidifying load is also passed directly to a furnace or unitary system if it is defined for the simulation, and that system will operate to meet this load based on its configuration and control settings.

### Thermal Comfort Zone Control

The input object ZoneControl:Thermostat:ThermalComfort provides a way for the zone to be controlled to a specified temperature based on a selected thermal comfort model.  ZoneControl:Thermostat:ThermalComfort references a thermal comfort control type schedule and one or more thermal comfort control type objects which in turn reference one or more setpoint schedules.

The thermal comfort control type schedule and the list of thermal comfort control type/name pairs are directly related.  The schedule defines the type of thermal comfort control that is to be used during for each simulation time step.  Valid Control Types are

<table class="table table-striped">





<tr>
<td>Control Type</td>
<td>Control Type Name/Object</td>
</tr>
<tr>
<td>0</td>
<td>No thermal comfort control</td>
</tr>
<tr>
<td>1</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:SingleHeating</td>
</tr>
<tr>
<td>2</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:SingleCooling</td>
</tr>
<tr>
<td>3</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:SingleHeatingOrCooling</td>
</tr>
<tr>
<td>4</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:DualSetpoint</td>
</tr>

</table>

If the schedule referenced in the ZoneControl statement has a value of 4 for a particular time step, this indicates that during that time step "ThermostatSetpoint:ThermalComfort:Fanger:DualSetpoint” control is to be used.  The specific "ThermostatSetpoint:ThermalComfort:Fanger:DualSetpoint" control object to be used is specified in the list of thermal comfort control type/name pairs.  Then the specific thermal comfort control type objects reference the thermal comfort PMV setpoint schedule to be used.  Because only one thermal comfort control can be specified for each thermal comfort control type in a ZoneControl statement, there are only four pairs possible in a particular ZoneControl type/name list.  This is because individual thermal comfort controls can be defined for specific times, thus giving the user a full range of flexibility.  Since putting in the name of the thermal comfort control type directly in the schedule would be very cumbersome, the thermal comfort control types are assigned a number which is used in the schedule profile.

For more information see ZoneControl:Thermostat:ThermalComfort in the InputOutput Reference and Zone Fanger Thermal Comfort in the Engineering Documentation.

#### Zone Control Based on Fanger Thermal Comfort

The syntax for the current set (4) of zone thermal comfort control types is given below. In each case, the keyword is accompanied by an identifying name and either one or two schedule names (depending on whether the control type is a single or dual setpoint control). The schedule defines a PMV setpoint for the control type. The schedule would be defined through the standard schedule syntax described earlier in this document. For an uncontrolled thermal comfort zone, no Fanger thermal comfort object is specified or necessary. See the Input Output Reference for more details.

The control type schedule and the list of control type/name pairs are directly related.  The schedule defines the type of control that is to be used during for each hour.  Valid Control Types are

<table class="table table-striped">





<tr>
<td>Control Type</td>
<td>Control Type Name/Object</td>
</tr>
<tr>
<td>0</td>
<td>No thermal comfort control</td>
</tr>
<tr>
<td>1</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:SingleHeating</td>
</tr>
<tr>
<td>2</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:SingleCooling</td>
</tr>
<tr>
<td>3</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:SingleHeatingOrCooling</td>
</tr>
<tr>
<td>4</td>
<td>ThermostatSetpoint:ThermalComfort:Fanger:DualSetpoint</td>
</tr>

</table>

For the no thermal comfort control (uncontrolled) case, the control will revert to thermostat control if specified. If the thermal comfort control is specified as “uncontrolled” for a particular period and thermostat control is not specified in the input, then conditions will float.

For the ThermostatSetpoint:ThermalComfort:Fanger:SingleHeating case there would be a heating only thermal comfort setpoint temperature.  The setpoint is calculated based on the selected thermal comfort model and varied throughout the simulation but only heating is allowed with this thermal comfort control type.

      CASE (Single Thermal Comfort Heating Setpoint:Fanger)

      TempControlType(ZoneNum)= SingleHeatingSetpoint

      TempZoneThermostatSetPoint(ZoneNum) = Calculated Zone Setpoint from Fanger heating setpoint PMV

For the ThermostatSetpoint:ThermalComfort:Fanger:SingleCooling case there would be a cooling only thermal comfort setpoint temperature.  The setpoint is calculated based on the selected thermal comfort model and varied throughout the simulation but only cooling is allowed with this thermal comfort control type.

      CASE (Single Thermal Comfort Cooling Setpoint:Fanger)



      TempControlType(ZoneNum)= SingleCoolingSetPoint

      TempZoneThermostatSetPoint(ZoneNum) = Calculated Zone Setpoint from Fanger cooling setpoint PMV

For the ThermostatSetpoint:ThermalComfort:Fanger:SingleHeatingOrCooling there would be heating and cooling thermal comfort zone control objects.  The setpoint is calculated based on the selected thermal comfort model and varied throughout the simulation for both heating and cooling. With this thermal comfort control type only 1 setpoint profile is needed or used.

      CASE (Single Thermal Comfort Heating Cooling Setpoint:Fanger)



      TempControlType(ZoneNum)= SingleHeatCoolSetPoint

      TempZoneThermostatSetPoint(ZoneNum) = Calculated Zone Setpoint from Fanger heating and cooling

                                            setpoint PMV

For ThermostatSetpoint:ThermalComfort:Fanger:DualSetpoint there would be heating and cooling thermal comfort control objects.  For this case both a heating and cooling setpoint can be calculated based on the selected thermal comfort model for any given time period.  The thermal comfort setpoint temperature can be varied throughout the simulation for both heating and cooling.

      CASE (Dual Thermal Comfort Setpoint with Deadband:Fanger)



      TempControlType(ZoneNum)= DualSetPointWithDeadBand

      ZoneThermostatSetPointLo(ZoneNum) = Calculated Zone Setpoint from Fanger heating setpoint PMV

      ZoneThermostatSetPointHi(ZoneNum) = Calculated Zone Setpoint from Fanger cooling setpoint PMV

Zone Equipment and Zone Forced Air Units <a name="ZoneEquip"></a>
----------------------------------------

### Air Distribution Terminal Unit

#### Overview

The ZoneHVAC:AirDistributionUnit is a special piece of zone equipment – it connects centrally conditioned air with a zone. It encompasses the various types of air terminal units in EnergyPlus: *AirTerminal:DualDuct:ConstantVolume*, *AirTerminal:SingleDuct:VAV:Reheat*, etc. It is a generalized component that accesses the calculations for the different types of air terminal unit.

#### Model

The air distribution function is encapsulated in the module *ZoneAirEquipmentManager*. The object and module function only to invoke the individual air terminal unit simulations.

#### Inputs and Data

The data for this unit consists of the unit name, the air outlet node name (which should be the same as one of the zone inlet nodes), the type of air terminal unit (air distribution equipment), and the name of the air terminal unit.

All input data for air distribution units is stored in the array *AirDistUnit* in data module *DataDefineEquip*.

#### Calculation

There is no calculation associated with ZoneHVAC:AirDistributionUnit.

#### Simulation and Control

*SimZoneAirLoopEquipment* in module *ZoneAirEquipmentManager* calls the individual air terminal unit simulations.

#### References

No specific references.

### Inlet Side Mixer Air Terminal Unit

#### Overview

The input object AirTerminal:SingleDuct:InletSideSideMixer provides a means for using a zonal air conditioning unit as a terminal unit by mixing central system conditioned air with the inlet air stream of the zonal unit. Usually the central system would be a Direct Outside Air System (DOAS) providing centrally conditioned ventilation air to the zones.

#### Model

The inlet side mixer uses the equations for adiabatic mixing of two moist air streams. Namely, dry air mass balance, water mass balance, and enthalpy balance.

#### Inputs and Data

The only input data are the name and type of the zonal air conditioning unit plus the node names of the 2 input air nodes and the outlet air node. No flow rate data is needed.

All input data for the inlet side mixer air terminal unit is stored in the data structure *SysATMixer*.

#### Calculation

The following equations for the mixing of two moist air streams are used:

<div>$${\dot m_{da1}}{h_1} + {\dot m_{da2}}{h_2} = {\dot m_{da3}}{h_3}$$</div>

<div>$${\dot m_{da1}} + {\dot m_{da2}} = {\dot m_{da3}}$$</div>

<div>$${\dot m_{da1}}{W_1} + {\dot m_{da2}}{W_2} = {\dot m_{da3}}{W_3}$$</div>

where <span>${\dot m_{da}}$</span>is dry air mass flow rate in kg/s, *h* is specific enthalpy in J/kg, and W is humidity ratio in (kg of water)/(kg of dry air).

In this case, the outlet air mass flow rate has been set by the zonal unit. The air mass flow rate of one of the inlets - the primary air from the central system - is also known. So the air mass balance equation is used to obtain the secondary air mass flow rate.

The inlet conditions - specific enthalpy and humidity ratio - for both inlet air streams are known. Now that both inlet air streams' mass flow rate is known, the enthalpy and water mass balance equations are used to get the outlet conditions.

#### Simulation and Control

The inlet side mixer model is invoked from within the zonal AC model. Basically the inlet side mixer becomes a subcomponent of the zonal unit model. This allows the zonal unit to allow for the mixing of central supply air with its inlet stream in calculating how much cooling or heating it needs to do in order to meet the zone load.

#### References

See Chapter 1, page 1.17 of the 2013 ASHRAE Handbook of Fundamentals

### Supply Side Mixer Air Terminal Unit

#### Overview

The input object AirTerminal:SingleDuct:SupplySideSideMixer provides a means for using a zonal air conditioning unit as a terminal unit by mixing central system conditioned air with the outlet air stream of the zonal unit. Usually the central system would be a Direct Outside Air System (DOAS) providing centrally conditioned ventilation air to the zones.

#### Model

The supply side mixer uses the equations for adiabatic mixing of two moist air streams. Namely, dry air mass balance, water mass balance, and enthalpy balance. In this case the inlet conditions and flow rates are known so the outlet condition and flow rate is calculated.

#### Inputs and Data

The only input data are the name and type of the zonal air conditioning unit plus the node names of the 2 input air nodes and the outlet air node. No flow rate data is needed.

All input data for the supply side mixer air terminal unit is stored in the data structure *SysATMixer*.

#### Calculation

Given the needed inputs, the output is calculated in subroutine *CalcATMixer*. The input flow rates, humidity ratios, and enthalpies are taken from the inlet nodes' data. The balance equations are then used to calculate the outlet flow rate and conditions:

<div>$${\dot m_{da1}}{h_1} + {\dot m_{da2}}{h_2} = {\dot m_{da3}}{h_3}$$</div>

<div>$${\dot m_{da1}} + {\dot m_{da2}} = {\dot m_{da3}}$$</div>

<div>$${\dot m_{da1}}{W_1} + {\dot m_{da2}}{W_2} = {\dot m_{da3}}{W_3}$$</div>

where <span>${\dot m_{da}}$</span>is dry air mass flow rate in kg/s, *h* is specific enthalpy in J/kg, and W is humidity ratio in (kg of water)/(kg of dry air).

#### Simulation and Control

The supply side mixer model is invoked from within the zonal AC model. Basically the supply side mixer becomes a subcomponent of the zonal unit model. This allows the zonal unit to allow for the mixing of central supply air with its outlet stream in calculating how much cooling or heating it needs to do in order to meet the zone load.

#### References

See Chapter 1, page 1.17 of the 2013 ASHRAE Handbook of Fundamentals

### Simple Duct Leakage Model

#### Overview

The input object ZoneHVAC:AirDistributionUnit also provides access to a model for duct leakage that can be a significant source of energy inefficiency in forced-air HVAC systems. Evaluating duct leakage energy losses can involve considerable user effort and computer resources if an airflow network is defined through a detailed description of the system components and airflow paths (including leakage paths). A nonlinear pressure-based solver is used to solve for pressures and flow rates in the network. By making certain assumptions and approximations for certain well defined configurations, however, it is possible to obtain accurate results with a simple mass and energy balance calculation and thus avoid the input and calculation costs of doing a full pressure-based airflow network simulation.

The Simple Duct Leakage Model (SDLM) assumes a central VAV air conditioning system with a constant static pressure setpoint. The model assumes that the leaks are in the supply ducts and that the system returns air through a ceiling plenum that contains the ducts. Thus, the ducts leak into the return plenum, and this part of the supply does not reach the conditioned zones. With the additional assumptions described below, it is possible to model this configuration with heat and mass balance equations and avoid the use of a nonlinear pressure-based solver. In the EnergyPlus context, this means that use of AirflowNetwork is avoided and the leakage calculations are obtained in the course of the normal thermal simulation.

#### Principles and Description

Constant Flow Rate

The airflow rate through a duct leak is a function of the pressure difference between the duct and the surrounding space:

<div>$${\dot V_{leak}} = {C_1} \cdot \Delta p_{duct - space}^n$$</div>

The exponent *n* is 0.5 for leaks that look like orifices (holes that are large relative to the thickness of the duct wall); for leaks that resemble cracks (e.g., lap joints), *n* is approximately 0.6 to 0.65.

For a duct with constant flow rate and a linear pressure drop through the duct, the average static pressure in the duct will equal half of the duct static pressure drop. Assuming turbulent flow in the duct, the duct pressure drop is proportional to the square of the airflow through the duct. This can be expressed as:

<div>$$\Delta {p_{duct - space}} = \frac{{\Delta {p_{duct}}}}{2} = {C_2}\left( {\frac{{\dot V_{duct}^2}}{2}} \right)$$</div>

Combining equations and and assuming the leaks are large holes (*n* equals 0.5). gives:

<div>$${\dot V_{leak}} = {C_1} \cdot \Delta p_{duct - space}^{0.5} = {C_3} \cdot {\dot V_{duct}}$$</div>

where

<div>$${C_3} = {C_1} \cdot {({C_2}/2)^{0.5}}$$</div>

Thus the leakage fraction *C*<sub>3</sub> remains constant regardless of the duct flow rate or static pressure. This result depends on the following assumptions:

·        the duct airflow is turbulent;

·        the duct pressure varies linearly along the duct;

·        the average duct pressure approximates the pressure drop across the duct;

·        the leaks are large and have pressure exponent 0.5.

Effects of Constant Pressure Upstream and Variable Flow and Pressure Downstrean

Commonly VAV systems maintain a constant static pressure at some point in the duct system upstream of the VAV terminal units. That is, airflow rate will vary depending on the cooling requirement, but a constant pressure will be maintained at the static pressure sensor. Consequently, the leakage flow for a leak upstream of the VAV boxes will be approximately constant. Or to put it another way, the leakage fraction will vary in proportion to the flow rate.

For leaks downstream of the VAV terminal units, the airflow through the duct and the pressure in the downstream duct will vary as the box damper modulates in response to the differential between the room temperature and the thermostat setpoint. In this case, the situation is similar to the constant flow case: for an orifice-like leak, the pressure difference across the leak will vary linearly with the air speed (or flow rate); i.e., the leakage fraction will be approximately constant.

SDLM

For SDLM, our leakage model is then:

·        for leaks upstream of the terminal units, the leakage flow rate will be constant;

·        for leaks downstream of the terminal units, the leakage fraction will be constant.

This model assumes, in addition to the assumptions given above, that the VAV system is controlled to a constant static pressure setpoint. In EnergyPlus SDLM is not currently applicable to systems using static pressure reset. Using SDLM would require knowledge of static pressure as a function of system air flow rate.

#### Inputs and Data

User data for the SDLM is entered through The ZoneHVAC:AirDistributionUnit (ADU) object. There are 2 data items per ADU:

1.    the upstream nominal leakage fraction;

2.    the downstream fixed leakage fraction.

Both inputs are leakage fractions. Input (1) is the leakage fraction at design flow rate, which together can be used to determine the constant leakage flow rate upstream of the VAV boxes; this leakage fraction varies with the flow rate. Input (2) is a fixed leakage fraction and is constant as the flow rate varies.

#### Implementation

The various zone mass flow rates are related in the following manner.

<div>$${\dot m_{s,us}} = {\dot m_{tu}} + {\dot m_{lk,us}}$$</div>

<div>$${\dot m_{tu}} = {\dot m_{lk,ds}} + {\dot m_{s,z}}$$</div>

<div>$${\dot m_{lk,us}} = Fra{c_{us}} \cdot {\dot m_{s,us,max}}$$</div>

<span>${\dot m_{lk,ds}} = Fra{c_{ds}} \cdot {\dot m_{tu}}$</span>                                                                                <span>$$</span>

Here

<span>${\dot m_{s,us}}$</span>is the constant zone supply air mass flow rate upstream of the leaks [kg/s];

<span>${\dot m_{tu}}$</span>is the air mass flow rate through the terminal unit [kg/s];

<span>${\dot m_{lk,us}}$</span>is the upstream leakage air mass flow rate [kg/s];

<span>${\dot m_{lk,ds}}$</span>is the downstream leakage air mass flow rate [kg/s];

<span>${\dot m_{s,us,max}}$</span>is the maximum upstream supply air mass flow rate (program input) [kg/s];

<span>${\dot m_{s,z}}$</span>is the supply air mass flow rate delivered to the zone [kg/s];

<span>$Fra{c_{us}}$</span>is the design upstream leakage fraction (program input);

<span>$Fra{c_{ds}}$</span>is the constant downstream leakage fraction (program input);

<span>${\dot m_{tu}}$</span>is calculated in the VAV terminal unit model in the usual manner: the mass flow rate is varied to meet the zone load. The limits on the mass flow rate variation are set by the <span>${\dot m_{MaxAvail}}$</span> and <span>${\dot m_{MinAvail}}$</span>values stored at the terminal unit’s air inlet node. To account for upstream leakage the maximum air mass flow rate available is reset to:

<div>$${\dot m'_{MaxAvail}} = {\dot m_{MaxAvail}} - {\dot m_{lk,us}}$$</div>

Downstream leakage must also be accounted for because not all of <span>${\dot m_{tu}}$</span>will reach the zone. This is done by having <span>${\dot m_{tu}}$</span>meet an adjusted zone load:

<div>$${\dot Q_{z,adjusted}} = \frac{1}{{1 - Fra{c_{ds}}}}{\dot Q_z}$$</div>

Here <span>${\dot Q_z}$</span>[watts] is the actual zone load (met by <span>${\dot m_{s,z}}$</span>) and <span>${\dot Q_{z,adjusted}}$</span>is the load used in the VAV terminal unit model to obtain <span>${\dot m_{tu}}$</span>.

Once <span>${\dot m_{tu}}$</span> is known, all the other flow rates can be calculated. <span>${\dot m_{s,us}}$</span>is assigned to the air distribution unit’s air inlet node and <span>${\dot m_{s,z}}$</span>is assigned to the unit’s air outlet node. Thus, air mass flow is not conserved through the unit: the two air leakage flow rates disappear. These two vanished flow rates are stored in the air distribution unit data structure. When the downstream return air plenum mass and energy balances are calculated, the leakage flow rate data is accessed and added back in as inlets to the return air plenum. Thus, the overall air system preserves a mass balance.

#### References

Wray, C.P. 2003. “Duct Thermal Performance Models for Large Commercial Buildings”, Lawrence Berkeley National Laboratory Report to the California Energy Commission. LBNL-53410.

Wray, C.P. and N.E. Matson. 2003. “Duct Leakage Impacts on VAV System Performance in California Large Commercial Buildings”, Lawrence Berkeley National Laboratory Report to the California Energy Commission. LBNL-53605.

Wray, C.P., R.C. Diamond, and M.H. Sherman. 2005. “Rationale for Measuring Duct Leakage Flows in Large Commercial Buildings”. Proceedings – 26th AIVC Conference, Brussels, Belgium, September. LBNL-58252.

### Fan Coil Unit

#### Overview

The input object ZoneHVAC:FourPipeFanCoil provides a model for a 4 pipe fan coil zonal hydronic unit that can supply heating and cooling to a zone. It contains a hot water coil, a chilled water coil, and a fan. It can supply a fixed amount of outdoor air, but can not operate in an economizer mode. The fan runs at constant speed – control is achieved by throttling the hot or cold water flow. The fan coil configuration and control is rather limited. The fan position is always *blow-through*, control is always by varying the water flow, never by holding the water flow constant and cycling the fan.

#### Model

The 4 pipe fan coil unit is modeled as a compound component consisting of 4 sub-components: an outdoor air mixer, a fan, a cooling coil, and a heating coil. In terms of EnergyPlus objects these are:

1.    *OutdoorAir:Mixer*

2.    *Fan:ConstantVolume*

3.    *Coil:Cooling:Water, Coil:Cooling:Water:DetailedGeometry,* or *CoilSystem:Cooling:Water:HeatExchangerAssisted*

4.    *Coil:Heating:Water*

The unit is a forward model: its inputs are defined by the state of its inlets: namely its 2 air streams – recirculated and outdoor air. The outputs of the model are the conditions of the outlet air stream: flow rate, temperature and humidity ratio. The unit data and simulation are encapsulated in the module *FanCoilUnits.*

#### Inputs and Data

The user describes the 4 pipe fan coil unit by inputting the names of the outdoor air mixer, the fan, the heating coil, and the cooling coil. The cooling coil type must also be specified.

The unit is connected to the overall HVAC system by specifying node names for the unit air inlet (for recirculated air) node, air outlet node, outdoor air node, relief node, inlet hot water node, and inlet chilled water node. The individual components comprising the fan coil must also be input and connected together properly. Specifically the outdoor air mixer mixed air node must be the same as the fan inlet node; the fan outlet node must be the same as the cooling coil air inlet node; the cooling coil air outlet node must be the same as the heating coil air inlet node; and the heating coil air outlet node must be the same as the unit air outlet node; the outdoor air mixer inlet nodes must match the unit inlet nodes; and the outdoor air mixer relief node must match the unit relief node.

The user needs to also specify (unless the unit is autosized) various maximum flow rates: the supply air flow rate, the outdoor air inlet flow rate, the maximum (and minimum) chilled water flow rate, and the maximum (and minimum) hot water flow rate. Heating and cooling convergence tolerances need to be specified or defaulted. And there is an on/off availability schedule for the unit.

All the input data for the fan coil unit is stored in the array *FanCoil*.

#### Calculation

Given the needed inputs, the output is calculated in subroutine *Calc4PipeFanCoil*. The temperature, humidity ratio and flow rate of the recirculated and outdoor air streams are taken from the inlet air nodes The inlet hot and chilled water flow rates have been set by local controllers – temperatures are taken from the inlet water nodes. Then

1.    The outdoor air mixer is simulated (Call *SimOAMixer*);

2.    the fan is simulated (Call *SimulateFanComponents*);

3.    the cooling coil is simulated (Call *SimulateWaterCoilComponents* or *SimHXAssistedCoolingCoil*);

4.    the heating coil is simulated (Call *SimulateWaterCoilComponents*).

The load met (sensible cooling or heating) is calculated and passed back to the calling routine:

   <span>${\dot Q_{sens,out}} = {\dot m_{tot}}\cdot ({\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{out}}{\rm{,}}{{\rm{W}}_{{\rm{in}}}}{\rm{) - }}{\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{in}},{W_{in}}))$</span>

where *PsyHFnTdbW* is the EnergyPlus function for calculating the specific enthalpy of air given the drybulb temperature and the humidity ratio. The subscript *in* indicates the conditions at the inlet recirculated air node.

#### Simulation and Control

From the result of the zone simulation we have the current heating/cooling demand on the unit <span>${\dot Q_{z,req}}$</span>. The first step is to decide whether the unit is on for the current time step. If the load is less than 1 watt or the flow rate is less than .001 kg/s, the unit is off. If the availability schedule is off, the mass flow rate is set to zero, so the second condition holds. When the unit is off there will be no air flow through the unit and outlet conditions will be equal to inlet conditions.

<span>${\dot Q_{z,req}}$</span> is not the demand on the heating or cooling coil. To obtain the actual coil load, we need to calculate the unit output with no heating or cooling by the coils (<span>${\dot Q_{unit,no{\rm{ }}hc}}$</span>). We obtain this by calling *Calc4PipeFanCoil* with the water flow rates set to zero. Then the coil loads are calculated:

<div>$${\dot Q_{hc}} = {\dot Q_{z,hsp}} - {\dot Q_{unit,no{\rm{ }}hc}}$$</div>

<div>$${\dot Q_{cc}} = {\dot Q_{z,csp}} - {\dot Q_{unit,no{\rm{ }}hc}}$$</div>

where <span>${\dot Q_{hc}}$</span>is the heating coil load, <span>${\dot Q_{z,hsp}}$</span>is the current zone load to the heating setpoint, <span>${\dot Q_{cc}}$</span>is the cooling coil load, and <span>${\dot Q_{z,csp}}$</span>is the current zone load to the cooling setpoint.

If the unit is on and <span>${\dot Q_{cc}}$</span>&lt; 0 and the thermostat type is not “single heating setpoint”, *ControlCompOutput* is called with the control node set to the cold water inlet node. *ControlCompOutput* is a general component control routine. In this case calls *Calc4PipeFanCoil* repeatedly while varying the cold water flow rate and minimizing <span>$({\dot Q_{sens,out}} - {\dot Q_{z,csp}})/{\dot Q_{z,csp}}$</span>to within the cooling convergence tolerance. Similarly if the unit is on and <span>${\dot Q_{hc}}$</span>&gt;0 and the thermostat type is not “single cooling setpoint”, *ControlCompOutput* is called with the control node set to the hot water inlet node. *ControlCompOutput* varies the hot water flow rate to minimize <span>$({\dot Q_{sens,out}} - {\dot Q_{z,hsp}})/{\dot Q_{z,hsp}}$</span> to within the heating tolerance. *ControlCompOutput* executes a slow but safe interval halving algorithm to do its minimization. Once control is achieved, the total cooling/heating output is calculated:

     <span>${\dot Q_{tot,out}} = \dot m\cdot ({\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{out}},{W_{out}}) - {\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{in,}}{W_{in}})$</span>

#### References

No specific references.



### Window Air Conditioner

#### Overview

The input object ZoneHVAC:WindowAirConditioner provides a model for a window air conditioner unit that is a packaged unit that supplies cooling to a zone (it is part of zone equipment, not part of the air loop equipment). It contains a fan, a DX cooling coil, and an outdoor air inlet. The coil meets the cooling load by cycling on/off. The fan can operate continuously or cycle on/off in conjunction with the coil.

#### Model

The window air conditioner is modeled as a compound component consisting of 3 sub-components: an outdoor air mixer, a fan, and a DX coil. In terms of EnergyPlus objects these are OutdoorAir:Mixer, Fan:ConstantVolume or Fan:OnOff, and Coil:Coolilng:DX:SingleSpeed or CoilSystem:Cooling:DX:HeatExchangerAssisted. The unit is a forward model: its inputs are defined by the state of its inlets: namely its 2 air streams – recirculated and outdoor air. The outputs of the model are the conditions of the outlet air stream: flow rate, temperature and humidity ratio. The model is also an averaged model: the performance of the unit is averaged over the time step. That is, the unit is assumed to cycle on/off during the time step and this on/off cycling is averaged over the simulation time step. The unit data and simulation are encapsulated in the module WindowAC.

#### Inputs and Data

The user describes the window air conditioner by inputting the names of the outdoor air mixer, the fan, and the cooling coil. The user can also choose fan placement – blow through or draw through; fan operation – cycling or continuous; and cooling coil type – normal DX or DX with heat exchanger assistance.

The connectivity of the unit needs to be specified: a recirculated (inlet) air node (same as a zone exhaust node); an air outlet node (same as a zone inlet node); an outdoor air inlet node; and a relief air node. The individual components comprising the window air conditioner must of course also be input and connected together properly. For instance, for a blow through fan configuration the outdoor air mixer mixed air node must be the same as the fan inlet node; the fan outlet node must be the same as the coil inlet node; the coil outlet node must be the same as the unit outlet node; the outdoor air mixer inlet nodes must match the unit inlet nodes; and the outdoor air mixer relief node must match the unit relief node.

The user also specifies the air conditioner flow rate delivered to the zone (when cycled on) and the outdoor air flow rate. The user also needs to specify an availability schedule for the unit (this is an on/off schedule).

Note that there is no input specifying the unit’s design cooling capacity. This is an input in the DX coil object and is not repeated here.

All the input data for the window air conditioner is stored in the array *WindAC*.

#### Calculation

Given the needed inputs, the output is calculated in subroutine CalcCyclingWindowAC. The temperature, humidity ratio and flow rate of the recirculated and outdoor air streams are taken from the inlet air nodes. The part load ratio is specified by the calling routine. Then

·        The outdoor air mixer is simulated (Call SimOAMixer);

·        For blow-through fan position:

·        the fan is simulated (Call SimulateFanComponents);

·        the coil is simulated (Call SimDXCoil or SimHXAssistedCoolingCoil).

For draw-through fan position, the simulation order of the fan and coil is reversed. Note that data is never explicitly passed between the sub-components. This is all handled automatically by the node connections and the data stored on the nodes.

#### Simulation and Control

From the result of the zone simulation we have the heating/cooling demand on the unit <span>${\dot Q_{z,req}}$</span>. The first step is to decide whether the unit is on for the current time step. For a unit with a cycling fan, the entire unit is assumed to be off if there is no cooling load, the cooling load is very small (less than 1 watt), the unit is scheduled off, or the zone temperature is in the deadband. For a unit with a continuous flow the fan operates if the unit is scheduled on, whether or not there is a cooling demand. The coil however only operates if there is a cooling demand and the zone temperature is not in the deadband.

If the unit is determined to be on, the next step is to find the unit part load fraction that will satisfy the cooling load. This is done in *ControlCycWindACOutput*. In this routine *CalcCyclingWindowAC*  is first called with part load fraction equal to 0, then with part load fraction equal to 1. These calls establish the minimum and maximum cooling output possible by the unit given the current conditions. An initial estimate of the part load fraction is then made:

<div>$$PLF = ({\dot Q_{z,req}} - {\dot Q_{out,min}})/|{\dot Q_{out,max}} - {\dot Q_{out,min}}|$$</div>

Since the unit’s cooling output is a nonlinear function of the part load fraction, this *PLF* will not give exactly the desired <span>${\dot Q_{z,req}}$</span>. To obtain the exact *PLF* that will give <span>${\dot Q_{z,req}}$</span>, it is necessary to iteratively call *CalcCyclingWindowAC*, varying *PLF* until the desired cooling output is obtained, within the error tolerance specified by the user in the input.

Once *PLF* is determined, *ControlCycWindACOutput* is exited. One last call to *CalcCyclingWindowAC* is made to establish the final outlet conditions at the unit’s air outlet node. Finally, the inlet and outlet node conditions are used to calculate the reporting variables: sensible and total cooling output.

<div>$${\dot Q_{sens,out}} = \dot m\cdot ({\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{out}},{W_{in}}) - {\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{in,}}{W_{in}}))$$</div>

<div>$${\dot Q_{sens,out}} = \dot m\cdot ({\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{out}},{W_{out}}) - {\mathop{\rm PsyHFnTdbW}\nolimits} ({T_{in,}}{W_{in}})$$</div>

where *PsyHFnTdb* is the EnergyPlus function giving enthalpy as a function of temperature and humidity ratio.

#### References

No specific references.



### Packaged Terminal Air Conditioner

#### Overview

The input object ZoneHVAC:PackagedTerminalAirConditioner provides a model for a packaged terminal air conditioner (PTAC) that is a compound object made up of other components. Each PTAC consists of an outdoor air mixer, direct expansion (DX) cooling coil, heating coil (gas, electric, hot water, or steam) and a supply air fan. While the figure below shows the PTAC with draw through fan placement, blow through fan placement can also be modeled by positioning the supply air fan between the outdoor air mixer and DX cooling coil. The packaged terminal air conditioner coordinates the operation of these components and is modeled as a type of zone equipment (Ref. ZoneHVAC:EquipmentList and ZoneHVAC:EquipmentConnections).

![PTAC\_Drawthrough](EngineeringReference/media/image7172.png)

Figure 319. Schematic of a Packaged Terminal Air Conditioner with Draw Through Fan Placement

The PTAC conditions a single zone and is controlled by a thermostat located in that zone. The PTAC operates to meet the zone sensible cooling or sensible heating requirements as dictated by the thermostat schedule. The model calculates the required part-load ratio for the air conditioner’s coils and the supply air fan to meet the cooling/heating requirements. The heating or cooling energy provided by the PTAC is delivered to the zone via the zone air inlet node.

The PTAC is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Supply air fan operation is coordinated with the use of a supply air fan operating mode schedule. Schedule values of 0 denote cycling fan operation (AUTO fan). Schedule values other than 0 denote continuous fan operation (fan ON). Fan:OnOff must be used to model AUTO fan (i.e. if schedule values of 0 occur in the supply air fan operating mode schedule), while Fan:OnOff or Fan:ConstantVolume can be used to model fan ON (i.e. if schedule values of 0 do not occur in the supply air fan operating mode schedule). The supply air fan operating mode schedule specified for the PTAC overrides the operating mode specified in the DX cooling coil object.

Output variables reported by the PTAC object include the supply air fan part-load ratio, the air conditioner’s part-load ratio (cooling or heating), and the electric consumption of the PTAC. Additional output variables report the total zone heating rate and the total zone cooling rate provided by the air conditioner. The sensible and latent components of zone cooling are also available as output variables. Reporting of other variables of interest for the PTAC (DX coil cooling rate, coil heating rate, crankcase heater power, fan power, etc.) is done by the individual system components (fan, DX cooling coil and heating coil).

#### Model Description

As described previously, the PTAC conditions a single zone and is controlled by a zone thermostat (ZoneControl:Thermostatic). Each simulation time step, EnergyPlus performs a zone air heat balance to determine if cooling or heating is required to meet the thermostat setpoints, excluding any impacts from PTAC operation. PTAC performance is then modeled with all heating/cooling coils off but the supply air fan operates as specified by the user. If the zone air heat balance plus the impact of PTAC operation with coils off results in no requirement for heating or cooling by the PTAC coils, or if the PTAC is scheduled off (via its availability schedule), then the PTAC coils do not operate and the air conditioner’s part-load ratio output variable is set to 0. If the model determines that cooling or heating is required and the PTAC is scheduled to operate, the model calculates the average air flow rate through the unit and the part-load ratio of the cooling and heating coils in order to meet the thermostat setpoint temperature.

The remainder of this section describes the calculations performed during the latter situation, when cooling or heating coil operation is required. For any HVAC simulation time step, the PTAC can only be cooling or heating, not both. Because the PTAC cycles its coil(s) on and off to meet the required load, the coil(s) operate for a portion of the time step and are off for the rest of the time step. If the user specifies continuous fan operation (i.e. supply air fan operating mode schedule value is greater than 0), then the supply air fan continues to operate at a user-specified flow rate even during periods when the coils cycle off. If the user specifies AUTO fan operation (i.e. supply air fan operating mode schedule value is equal to 0), then the supply air fan cycles on and off with the coils. The model accounts for these variations in air flow through the PTAC within a simulation time step when it determines the total cooling or heating energy delivered to the zone, the average supply air conditions and air flow rate, and the energy consumed by the air conditioner.

#### Cooling Operation

If EnergyPlus determines that the air conditioner must supply cooling to the zone in order to meet the zone air temperature setpoint, then the model first calculates the PTAC’s sensible cooling rate to the zone under two conditions: when the unit runs at full-load (steady-state) conditions and when the DX cooling coil is OFF. If the supply air fan cycles on/off with the compressor, then the sensible cooling rate is zero when the cooling coil is OFF. However if the fan is configured to run continuously regardless of coil operation, then the sensible cooling rate will not be zero when the cooling coil is OFF. Calculating the sensible cooling rate involves modeling the supply air fan (and associated fan heat), the outdoor air mixer, and the DX cooling coil. The heating coil is also modeled, but only to pass the air properties and mass flow rate from it’s inlet node to it’s outlet node. For each of these cases (full load and DX cooling coil OFF), the sensible cooling rate delivered to the zone by the PTAC is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{cooling,\,max\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,full\,\,load}}} \right){\left( {{h_{out,\,full\,\,load}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{cooling,\,min\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,coil\,\,off}}} \right){\left( {{h_{out,\,coil\,\,off}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{cooling,\,max\,}}$</span> = maximum PTAC sensible cooling rate with cooling coil ON, W

<span>${\mathop m\limits^ \bullet_{\,SA,full\,\,load}}$</span> = supply air mass flow rate at full-load (steady-state) conditions, kg/s

*h<sub>out,\\ full\\ load</sub>* = enthalpy of air exiting the PTAC at full-load conditions, J/kg

*h<sub>zone\\ air</sub>*<sub>            </sub> = enthalpy of zone (exhaust) air, J/kg

*HR<sub>min</sub>        =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the PTAC exiting air or the zone (exhaust) air

<span>${\mathop Q\limits^ \bullet_{cooling,\,min\,}}$</span>  = minimum PTAC sensible cooling rate with cooling coil OFF, W

<span>${\mathop m\limits^ \bullet_{\,SA,coil\,\,off}}$</span>   = supply air mass flow rate with the cooling coil OFF, kg/s

*h<sub>out,\\ coil\\ off</sub>*  = enthalpy of air exiting the PTAC with the cooling coil OFF, J/kg



With the calculated PTAC sensible cooling rates and the zone sensible cooling load to be met, the compressor part-load ratio for the PTAC is approximately equal to:

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{zone,cooling}} - {{\mathop Q\limits^ \bullet  }_{cooling,\,min\,}}} \right)}}{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{cooling,\,max\,}} - {{\mathop Q\limits^ \bullet  }_{cooling,\,min\,}}} \right)}}} \right)$$</div>

where:

<span>$PartLoadRatio$</span>= compressor part-load ratio required to meet the zone load

<span>${\mathop Q\limits^ \bullet_{zone,cooling}}$</span> = required zone sensible cooling rate to meet setpoint, W

Since the part-load performance of the DX cooling coil is frequently non-linear (Ref: DX Cooling Coil Model), and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the actual part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the individual PTAC component models) until the PTAC’s cooling output (including on/off cycling effects) matches the zone cooling load requirement.

If the PTAC has been specified with cycling fan/cycling coil (AUTO fan), then the user-defined supply air flow rate during cooling operation (volumetric flow rate converted to mass flow rate) is multiplied by the final PartLoadRatio value to determine the average supply air mass flow rate for the HVAC system simulation time step. For this case, the air conditions (temperature, humidity ratio and enthalpy) at nodes downstream of the cooling coil represent the full-load (steady-state) values when the coil is operating. If the supply air fan is specified to run continuously (fan ON), then the supply air mass flow rate is calculated as the average of the air mass flow rate when the compressor is on and the air mass flow rate when the compressor is off. In this case, the air conditions at nodes downstream of the cooling coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and mixed inlet air conditions when the coil is OFF). Additional discussion regarding the calculation of the average supply air flow and supply air conditions is provided later in this section.

#### Heating Operation

Calculations of the PTAC’s sensible heating rate delivered to the zone at full load and with the heating coil OFF are identical to the calculations described above for cooling operation.

<div>$${\mathop Q\limits^ \bullet_{heating,\,max\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,full\,\,load}}} \right){\left( {{h_{out,\,full\,\,load}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{heating,\,min\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,coil\,\,off}}} \right){\left( {{h_{out,\,coil\,\,off}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{heating,\,max\,}}$</span> = maximum PTAC sensible heating rate with heating coil ON, W

<span>${\mathop Q\limits^ \bullet_{heating,\,min\,}}$</span>  = minimum PTAC sensible heating rate with heating coil OFF, W



With the calculated PTAC sensible heating rates and the zone sensible heating load to be met, the heating coil part-load ratio for the PTAC is approximately equal to:

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{zone,heating}} - {{\mathop Q\limits^ \bullet  }_{heating,\,min\,}}} \right)}}{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{heating,\,max\,}} - {{\mathop Q\limits^ \bullet  }_{heating,\,min\,}}} \right)}}} \right)$$</div>

where:

<span>$PartLoadRatio$</span>= heating coil part-load ratio required to meet the zone load

<span>${\mathop Q\limits^ \bullet_{zone,heating}}$</span>             = required zone sensible heating rate to meet setpoint, W



Iterative calculations (successive modeling of the individual PTAC component models) are used to determine the final heating part-load ratio to account for the non-linear performance of the heating coil at part-load conditions and the variation in supply air fan heat for the case of cycling fan/cycling coil (AUTO fan). If heating coil operation at full load is unable to meet the entire zone heating load (e.g., the heating coil capacity is insufficient or the coil is scheduled OFF), the air conditioner’s part-load ratio is set to 1 to meet the zone heating load to the extent possible.

#### Average Air Flow Calculations

The packaged terminal air conditioner operates based on user-specified (or autosized) air flow rates. The PTAC’s supply air flow rate during cooling operation may be different than the supply air flow rate during heating operation. In addition, the supply air flow rate when no cooling or heating is required but the supply air fan remains ON can be different than the air flow rates when cooling or heating is required. The outdoor air flow rates can likewise be different in these various operating modes. The model takes these different flow rates into account when modeling the air conditioner, and the average air flow rate for each simulation time step is reported on the inlet/outlet air nodes of the various PTAC components in proportion to the calculated part-load ratio of the coil.

The average supply air and outdoor air mass flow rates through the air conditioner for the HVAC simulation time step are calculated based on the part-load ratio of the DX cooling coil or heating coil (whichever coil is operating) as follows:

<div>$$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\, = \,\,\mathop m\limits^ \bullet  {\,_{SA,coil\,\,on}}\left( {PartLoadRatio} \right) + \mathop m\limits^ \bullet  {\,_{SA,\,\,coil\,\,off}}\left( {1 - PartLoadRatio} \right)$$</div>

<div>$$\mathop m\limits^ \bullet  {\,_{OA,\,\,avg\,\,}} = \,\,\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,on}}\left( {PartLoadRatio} \right) + \mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,off}}\left( {1 - PartLoadRatio} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}$</span>      = average supply air mass flow rate during the time step, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{SA,coil\,\,on}}$</span>   = supply air mass flow rate when the coil is ON, kg/s

*PartLoadRatio* = part-load ratio of the coil (heating or cooling)

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,coil\,\,off}}$</span>  = supply air mass flow rate when the coil is OFF, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,avg\,\,}}$</span>    = average outdoor air mass flow rate during the time step, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,on}}$</span>  = average outdoor air mass flow rate when the coil is ON, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,off}}$</span>  = average outdoor air mass flow rate when the coil is OFF, kg/s



The supply air and outdoor air flow rates when the DX cooling coil or the heating coil is ON are specified by the user (i.e., supply air volumetric flow rate during cooling operation, supply air volumetric flow rate during heating operation, outdoor air volumetric air flow rate during cooling operation, and outdoor air volumetric air flow rate during heating operation) and are converted from volumetric to mass flow rate. If the user has specified cycling fan operation (i.e. supply air fan operating mode schedule value is equal to 0), then the supply air and outdoor air mass flow rates when the coil is OFF are zero. If the user has specified constant fan operation (i.e. supply air fan operating mode schedule value is greater than 0), then the user-defined air flow rates when no cooling or heating is needed are used when the coil is OFF.

There is one special case. If the supply air fan operating mode schedule value specifies constant fan operation and the user also specifies that the supply air volumetric flow rate when no cooling or heating is needed is zero (or field is left blank), then the model assumes that the supply air and outdoor air mass flow rates when the coil is OFF are equal to the corresponding air mass flow rates when the cooling or heating coil was last operating (ON).

#### Calculation of Outlet Air Conditions

When the supply air fan cycles on and off with the PTAC coils (AUTO fan), the calculated outlet air conditions (temperature, humidity ratio, and enthalpy) from the heating coil or the DX cooling coil at full-load (steady-state) operation are reported on the appropriate coil outlet air node. The air mass flow rate reported on the air nodes is the average air mass flow rate proportional to the part-load ratio of the coil (see Average Air Flow Calculations above).

When the supply air fan operates continuously while the PTAC coils cycle on and off (fan ON), the air mass flow rate reported on the air nodes is the average air mass flow rate proportional to the part-load ratio of the coil (see Average Air Flow Calculations above). Since the air flow rate can be different when the coil is ON compared to when the coil is OFF, then the average outlet air conditions from the heating coil or the DX cooling coil are reported on the appropriate coil outlet air node.

For hot water or steam coils, the water or steam mass flow rate is also proportional to the part-load ratio of the coil regardless of the supply air fan operating mode. Refer to the sections in the document that describe the heating and DX cooling coils for further explanation on how they report their outlet air (and water or steam) conditions.

#### Calculation of Zone Heating and Cooling Rates

At the end of each HVAC simulation time step, this compound object reports the heating or cooling rate and energy delivered to the zone, as well as the electric power and consumption by the air conditioner. In terms of thermal energy delivered to the zone, the sensible, latent and total energy transfer rate to the zone is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{Total}} = \left( {\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\,} \right)\left( {{h_{out,\,avg}} - {h_{zone\,\,air}}} \right)$$</div>

<div>$${\mathop Q\limits^ \bullet_{Sensible}} = \left( {\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\,} \right){\left( {{h_{out,\,avg}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{Latent}} = {\mathop Q\limits^ \bullet_{Total}} - {\mathop Q\limits^ \bullet_{Sensible}}$$</div>

where:

<sub><span>${\mathop Q\limits^ \bullet_{Total}}$</span>           </sub>= total energy transfer rate to the zone, W

<sub><span>${\mathop Q\limits^ \bullet_{Sensible}}$</span>        </sub>= sensible energy transfer rate to the zone, W

<sub><span>${\mathop Q\limits^ \bullet_{Latent}}$</span>        </sub>= latent energy transfer rate to the zone, W

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}$</span>      = average mass flow rate of the supply air stream, kg/s

*h<sub>out,avg</sub>*       = enthalpy of the air being supplied to the zone, J/kg



Since each of these energy transfer rates can be calculated as positive or negative values, individual reporting variables are established for cooling and heating and only positive values are reported. The following calculations are representative of what is done for each of the energy transfer rates:

IF (<span>${\mathop Q\limits^ \bullet_{Total}}$</span>* &lt; 0.0 )*THEN

                  <span>${\mathop Q\limits^ \bullet_{TotalCooling}}$</span> =  ABS (<span>${\mathop Q\limits^ \bullet_{Total}}$</span>)

                  <span>${\mathop Q\limits^ \bullet_{TotalHeating}}$</span><sub> </sub> =  *0.0*

ELSE

                  <span>${\mathop Q\limits^ \bullet_{TotalCooling}}$</span><sub> </sub> =  *0.0*

                  <span>${\mathop Q\limits^ \bullet_{TotalHeating}}$</span><sub> </sub> =  <span>${\mathop Q\limits^ \bullet_{Total}}$</span>



where:

<sub><span>${\mathop Q\limits^ \bullet_{TotalCooling}}$</span>   </sub>= output variable ‘Packaged Terminal Air Conditioner Total Zone Cooling Rate, W’

<sub><span>${\mathop Q\limits^ \bullet_{TotalHeating}}$</span>   </sub>= output variable ‘Packaged Terminal Air Conditioner Total Zone Heating Rate, W’



In addition to heating and cooling rates, the heating and cooling energy supplied to the zone is also calculated for the time step being reported. The following example for total zone cooling energy is representative of what is done for the sensible and latent energy as well as the heating counterparts.

<div>$$\,{Q_{TotalCooling}} = \,\,{\mathop Q\limits^ \bullet_{TotalCooling}}\,\, * \,\,TimeStepSys\,\, * \,\,3600.$$</div>

where:

<sub><span>${Q_{TotalCooling}}$</span>   </sub>= output variable ‘Packaged Terminal Air Conditioner Total Zone Cooling Energy, J’

*TimeStepSys* = HVAC system simulation time step, hr

### Packaged Terminal Heat Pump

#### Overview

The input object ZoneHVAC:PackagedTerminalHeatPump provides a model for a packaged terminal heat pump (PTHP) that is a compound object made up of other components. Each PTHP consists of an outdoor air mixer, direct expansion (DX) cooling coil, DX heating coil, supply air fan, and a supplemental heating coil. While the figure below shows the PTHP with draw through fan placement, blow through fan placement can also be modeled by moving the supply air fan before the DX cooling coil. The packaged terminal heat pump coordinates the operation of these components and is modeled as a type of zone equipment (Ref. ZoneHVAC:EquipmentList and ZoneHVAC:EquipmentConnections).

![PTHP](EngineeringReference/media/image7215.png)

Figure 320.  Schematic of a Packaged Terminal Heat Pump (Draw Through Fan Placement)

The PTHP conditions a single zone and is controlled by a thermostat located in that zone. The PTHP operates to meet the zone sensible cooling or sensible heating requirements as dictated by the thermostat schedule. The model calculates the required part-load ratio for the heat pump’s coils and the supply air fan to meet the cooling/heating requirements. The heating or cooling energy provided by the PTHP is delivered to the zone via the zone air inlet node.

The PTHP is able to model supply air fan operation in two modes: cycling fan – cycling coil (i.e., AUTO fan) and continuous fan – cycling coil (i.e., fan ON). Fan:OnOff must be used to model AUTO fan, while Fan:OnOff or Fan:ConstantVolume can be used to model fan ON.

Output variables reported by the PTHP object include the supply air fan part-load ratio, the compressor part-load ratio, and the electric consumption of the PTHP. Additional output variables report the total zone heating rate and the total zone cooling rate provided by the heat pump. The sensible and latent components of zone cooling are also available as output variables. Reporting of other variables of interest for the PTHP (DX coil cooling rate, DX coil heating rate, crankcase heater power, fan power, etc.) is done by the individual system components (fan, DX cooling coil, DX heating coil, and supplemental heating coil).

#### Model Description

As described previously, the PTHP conditions a single zone and is controlled by a zone thermostat (ZoneControl:Thermostat). Each simulation time step, EnergyPlus performs a zone air heat balance to determine if cooling or heating is required to meet the thermostat setpoints, excluding any impacts from PTHP operation. PTHP performance is then modeled with all heating/cooling coils off but the supply air fan operates as specified by the user. If the zone air heat balance plus the impact of PTHP operation with coils off results in no requirement for heating or cooling by the PTHP coils, or if the PTHP is scheduled off (via its availability schedule), then the PTHP coils do not operate and the compressor part-load ratio output variable is set to 0. If the model determines that cooling or heating is required and the PTHP is scheduled to operate, the model calculates the average air flow rate through the unit and the part-load ratio of the cooling and heating coils in order to meet the thermostat setpoint temperature.

The remainder of this section describes the calculations performed during the latter situation, when cooling or heating coil operation is required. For any HVAC simulation time step, the PTHP can only be cooling or heating, not both. Because the PTHP cycles its coil(s) on and off to meet the required load, the coil(s) operate for a portion of the time step and are off for the rest of the time step. If the user specifies continuous fan operation (supply air fan operating mode schedule value &gt; 0), then the supply air fan continues to operate at a user-specified flow rate even during periods when the coils cycle off. If the user specifies AUTO fan operation (supply air fan operating mode schedule value = 0), then the supply air fan cycles on and off with the coils. The model accounts for these variations in air flow through the PTHP within a simulation time step when it determines the total cooling or heating energy delivered to the zone, the average supply air conditions and air flow rate, and the energy consumed by the heat pump.

#### Cooling Operation

If EnergyPlus determines that the heat pump must supply cooling to the zone in order to meet the zone air temperature setpoint, then the model first calculates the PTHP’s sensible cooling rate to the zone under two conditions: when the unit runs at full-load (steady-state) conditions and when the DX cooling coil is OFF. If the supply air fan cycles on/off with the compressor, then the sensible cooling rate is zero when the cooling coil is OFF. However if the fan is configured to run continuously regardless of coil operation, then the sensible cooling rate will not be zero when the cooling coil is OFF. Calculating the sensible cooling rate involves modeling the supply air fan (and associated fan heat), the outdoor air mixer, and the DX cooling coil. The DX heating coil and the gas or electric supplemental heating coil are also modeled, but only to pass the air properties and mass flow rate from their inlet nodes to their outlet nodes. For each of these cases (full load and DX cooling coil OFF), the sensible cooling rate delivered to the zone by the PTHP is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{cooling,\,max\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,full\,\,load}}} \right){\left( {{h_{out,\,full\,\,load}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{cooling,\,min\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,coil\,\,off}}} \right){\left( {{h_{out,\,coil\,\,off}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{cooling,\,max\,}}$</span> = maximum PTHP sensible cooling rate with cooling coil ON, W

<span>${\mathop m\limits^ \bullet_{\,SA,full\,\,load}}$</span> = supply air mass flow rate at full-load (steady-state) conditions, kg/s

*h<sub>out,\\ full\\ load</sub>*   = enthalpy of air exiting the PTHP at full-load conditions, J/kg

*h<sub>zone\\ air</sub>*<sub> \\              </sub> = enthalpy of zone (exhaust) air, J/kg

*HR<sub>min</sub>        =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio of the PTHP exiting air or the zone (exhaust) air

<span>${\mathop Q\limits^ \bullet_{cooling,\,min\,}}$</span>  = minimum PTHP sensible cooling rate with cooling coil OFF, W

<span>${\mathop m\limits^ \bullet_{\,SA,coil\,\,off}}$</span>   = supply air mass flow rate with the cooling coil OFF, kg/s

*h<sub>out,\\ coil\\ off</sub>*    = enthalpy of air exiting the PTHP with the cooling coil OFF, J/kg

With the calculated PTHP sensible cooling rates and the zone sensible cooling load to be met, the compressor part-load ratio for the PTHP is approximately equal to:

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{zone,cooling}} - {{\mathop Q\limits^ \bullet  }_{cooling,\,min\,}}} \right)}}{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{cooling,\,max\,}} - {{\mathop Q\limits^ \bullet  }_{cooling,\,min\,}}} \right)}}} \right)$$</div>

where:

<span>$PartLoadRatio$</span>= compressor part-load ratio required to meet the zone load

<span>${\mathop Q\limits^ \bullet_{zone,cooling}}$</span> = required zone sensible cooling rate to meet setpoint, W

Since the part-load performance of the DX cooling coil is frequently non-linear (Ref: DX Cooling Coil Model), and the supply air fan heat varies based on cooling coil operation for the case of cycling fan/cycling coil (AUTO fan), the actual part-load ratio for the cooling coil compressor and fan are determined through iterative calculations (successive modeling of the individual PTHP component models) until the PTHP’s cooling output (including on/off cycling effects) matches the zone cooling load requirement within the cooling convergence tolerance that is specified.

If the PTHP is specified to operate with cycling fan/cycling coil (AUTO fan), then the user-defined supply air flow rate during cooling operation (volumetric flow rate converted to mass flow rate) is multiplied by the final PartLoadRatio value to determine the average supply air mass flow rate for the HVAC system simulation time step. For this case, the air conditions (temperature, humidity ratio and enthalpy) at nodes downstream of the cooling coil represent the full-load (steady-state) values when the coil is operating. If the supply air fan is specified to operate continuously (fan ON), then the supply air mass flow rate is calculated as the average of the air mass flow rate when the compressor is on and the air mass flow rate when the compressor is off. In this case, the air conditions at nodes downstream of the cooling coil are calculated as the average conditions over the simulation time step (i.e., the weighted average of full-load conditions when the coil is operating and mixed inlet air conditions when the coil is OFF). Additional discussion regarding the calculation of the average supply air flow and supply air conditions is provided later in this section.

#### Heating Operation

Calculations of the PTHP’s sensible heating rate delivered to the zone at full load and with the DX heating coil OFF are identical to the calculations described above for cooling operation.

<div>$${\mathop Q\limits^ \bullet_{heating,\,max\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,full\,\,load}}} \right){\left( {{h_{out,\,full\,\,load}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{heating,\,min\,}} = \left( {{{\mathop m\limits^ \bullet  }_{\,SA,coil\,\,off}}} \right){\left( {{h_{out,\,coil\,\,off}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

where:

<span>${\mathop Q\limits^ \bullet_{heating,\,max\,}}$</span> = maximum PTHP sensible heating rate with DX heating coil ON, W

<span>${\mathop Q\limits^ \bullet_{heating,\,min\,}}$</span>  = minimum PTHP sensible heating rate with DX heating coil OFF, W

With the calculated PTHP sensible heating rates and the zone sensible heating load to be met, the compressor part-load ratio for the PTHP is approximately equal to:

<div>$$PartLoadRatio = MAX\left( {0.0,\frac{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{zone,heating}} - {{\mathop Q\limits^ \bullet  }_{heating,\,min\,}}} \right)}}{{ABS\left( {{{\mathop Q\limits^ \bullet  }_{heating,\,max\,}} - {{\mathop Q\limits^ \bullet  }_{heating,\,min\,}}} \right)}}} \right)$$</div>

where:

<span>$PartLoadRatio$</span>= compressor part-load ratio required to meet the zone load

<span>${\mathop Q\limits^ \bullet_{zone,heating}}$</span>             = required zone sensible heating rate to meet setpoint, W

Iterative calculations (successive modeling of the individual PTHP component models) are used to determine the final heating part-load ratio to account for the non-linear performance of the DX heating coil at part-load conditions and the variation in supply air fan heat for the case of cycling fan/cycling coil (AUTO fan). If DX heating coil operating at full load is unable to meet the entire zone heating load (e.g., the DX heating coil capacity is insufficient or the coil is scheduled OFF, or the outdoor temperature is below the PTHP’s minimum outdoor dry-bulb temperature for compressor operation), the supplemental heating coil is activated to meet the remaining zone heating load to the extent possible.

#### Average Air Flow Calculations

The packaged terminal heat pump operates based on user-specified (or autosized) air flow rates. The PTHP’s supply air flow rate during cooling operation may be different than the supply air flow rate during heating operation. In addition, the supply air flow rate when no cooling or heating is required but the supply air fan remains ON can be different than the air flow rates when cooling or heating is required. The outdoor air flow rates can likewise be different in these various operating modes. The model takes these different flow rates into account when modeling the heat pump, and the average air flow rate for each simulation time step is reported on the inlet/outlet air nodes of the various PTHP components in proportion to the calculated part-load ratio of the DX coil compressor.

The average supply air and outdoor air mass flow rates through the heat pump for the HVAC simulation time step are calculated based on the part-load ratio of the DX cooling coil or DX heating coil (whichever coil is operating) as follows:

<div>$$\dot m{\,_{SA,\,\,avg}}\,\, = \,\,\dot m{\,_{SA,comp\,\,on}}\left( {PartLoadRatio} \right) + \dot m{\,_{SA,\,\,comp\,\,off}}\left( {1 - PartLoadRatio} \right)$$</div>

<div>$$\dot m{\,_{OA,\,\,avg\,\,}} = \,\,\dot m{\,_{OA,\,\,comp\,\,on}}\left( {PartLoadRatio} \right) + \dot m{\,_{OA,\,\,comp\,\,off}}\left( {1 - PartLoadRatio} \right)$$</div>

where:

<span>$\dot m{\,_{SA,\,\,avg}}$</span>      = average supply air mass flow rate during the time step, kg/s

<span>$\dot m{\,_{SA,comp\,\,on}}$</span>  = supply air mass flow rate when the DX coil compressor is ON, kg/s

*PartLoadRatio* = part-load ratio of the DX coil compressor (heating or cooling)

<span>$\dot m{\,_{SA,\,\,comp\,\,off}}$</span>            = supply air mass flow rate when the DX coil compressor is OFF, kg/s

<span>$\dot m{\,_{OA,\,\,avg\,\,}}$</span>    = average outdoor air mass flow rate during the time step, kg/s

<span>$\dot m{\,_{OA,\,\,comp\,\,on}}$</span> = average outdoor air mass flow rate when the DX coil compressor is ON, kg/s

<span>$\dot m{\,_{OA,\,\,comp\,\,off}}$</span>= average outdoor air mass flow rate when the DX coil compressor is OFF, kg/s

The supply air and outdoor air flow rates when the DX cooling or DX heating coil compressor is ON are specified by the user (e.g., supply air volumetric flow rate during cooling operation, supply air volumetric flow rate during heating operation, outdoor air volumetric air flow rate during cooling operation, and outdoor air volumetric air flow rate during heating operation) and are converted from volumetric to mass flow rate. If the user has specified cycling fan operation (supply air fan operating mode schedule value = 0), then the supply air and outdoor air mass flow rates when the DX compressor is OFF are zero. If the user has specified constant fan operation (supply air fan operating mode schedule value &gt; 0), then the user-defined air flow rates when no cooling or heating is needed are used when the DX compressor is OFF.

There is one special case. If the user has specified constant fan operation (supply air fan operating mode schedule value &gt; 0) and they specify that the supply air volumetric flow rate when no cooling or heating is needed is zero (or field is left blank), then the model assumes that the supply air and outdoor air mass flow rates when the DX coil compressor is OFF are equal to the corresponding air mass flow rates when the compressor was last operating (ON).

#### Calculation of Outlet Air Conditions

When the supply air fan cycles on and off with the PTHP coils (AUTO fan), the calculated outlet air conditions (temperature, humidity ratio, and enthalpy) from the DX heating or DX cooling coil at full-load (steady-state) operation are reported on the appropriate coil outlet air node. The air mass flow rate reported on the air nodes is the average air mass flow rate proportional to the part-load ratio of the DX coil compressor (see Average Air Flow Calculations above).

When the supply air fan operates continuously while the PTHP coils cycle on and off (fan ON), the air mass flow rate reported on the air nodes is the average air mass flow rate proportional to the part-load ratio of the DX coil compressor (see Average Air Flow Calculations above). Since the air flow rate can be different when the coil is ON compared to when the coil is OFF, then the average outlet air conditions from the DX heating or DX cooling coil are reported on the appropriate coil outlet air node.

Refer to the sections in the document that describe the DX heating and DX cooling coils for further explanation on how they report their outlet air conditions.

#### Calculation of Zone Heating and Cooling Rates

At the end of each HVAC simulation time step, this compound object reports the heating or cooling rate and energy delivered to the zone, as well as the electric power and consumption by the heat pump. In terms of thermal energy delivered to the zone, the sensible, latent and total energy transfer rate to the zone is calculated as follows:

<div>$${\dot Q_{Total}} = \left( {\dot m{\,_{SA,\,\,avg}}\,\,} \right)\left( {{h_{out,\,avg}} - {h_{zone\,\,air}}} \right)$$</div>

<div>$${\dot Q_{Sensible}} = \left( {\dot m{\,_{SA,\,\,avg}}\,\,} \right){\left( {{h_{out,\,avg}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\dot Q_{Latent}} = {\dot Q_{Total}} - {\dot Q_{Sensible}}$$</div>

where:

<sub><span>${\dot Q_{Total}}$</span>           </sub>= total energy transfer rate to the zone, W

<sub><span>${\dot Q_{Sensible}}$</span>       </sub>= sensible energy transfer rate to the zone, W

<sub><span>${\dot Q_{Latent}}$</span>          </sub>= latent energy transfer rate to the zone, W

<span>$\dot m{\,_{SA,\,\,avg}}$</span>      = average mass flow rate of the supply air stream, kg/s

*h<sub>out,avg</sub>*         = enthalpy of the air being supplied to the zone, J/kg

Since each of these energy transfer rates can be calculated as positive or negative values, individual reporting variables are established for cooling and heating and only positive values are reported. The following calculations are representative of what is done for each of the energy transfer rates:

IF (<span>${\dot Q_{Total}}$</span>*&lt; 0.0 )*THEN

                  <span>${\dot Q_{TotalCooling}}$</span> =  ABS (<span>${\dot Q_{Total}}$</span>)

                  <span>${\dot Q_{TotalHeating}}$</span><sub> </sub> =  *0.0*

ELSE

                  <span>${\dot Q_{TotalCooling}}$</span><sub> </sub> =  *0.0*

                  <span>${\dot Q_{TotalHeating}}$</span><sub> </sub> =  <span>${\dot Q_{Total}}$</span>

where:

<sub><span>${\dot Q_{TotalCooling}}$</span>         </sub>= output variable ‘Packaged Terminal Heat Pump Total Zone Cooling Rate, W’

<sub><span>${\dot Q_{TotalHeating}}$</span>         </sub>= output variable ‘Packaged Terminal Heat Pump Total Zone Heating Rate, W’

In addition to heating and cooling rates, the heating and cooling energy supplied to the zone is also calculated for the time step being reported. The following example for total zone cooling energy is representative of what is done for the sensible and latent energy as well as the heating counterparts.

<div>$${Q_{TotalCooling}} = {\dot Q_{TotalCooling}}*TimeStepSys*3600.$$</div>

where:

<sub><span>${Q_{TotalCooling}}$</span>   </sub>= output variable ‘Packaged Terminal Heat Pump Total Zone Cooling Energy, J’

*TimeStepSys* = HVAC system simulation time step, hr



### Zone Single Speed Water-To-Air Heat Pump

#### Overview

The input object ZoneHVAC:WaterToAirHeatPump provides a zone equipment model for a water-to-air heat pump that is a “virtual” component consisting of an on/off fan component, a water-to-air heat pump cooling coil, a water-to-air heat pump heating coil, and a gas or electric supplemental heating coil. The specific configuration of the blowthru heat pump is shown in the following figure. For a drawthru heat pump, the fan is located between the water-to-air heat pump heating coil and the supplemental heating coil. In addition, a water-to-air heat pump has a water loop connection on its source side. The water loop can be served by a condenser loop (like GHE for Ground source systems), or by a cooling tower/ boiler plant loop (for water loop systems).

![Schematic\_ZoneWSHP](EngineeringReference/media/image7258.png)

Figure 321.  Source Side and Load Side Configuration of a Zone WaterToAir Heat Pump

There are two models for zone water-to-air heat pump cooling and heating coils, i.e. Single-Speed and Variable-Speed Equation Fit models. Cooling and heating coils are modeled using the Equation Fit model described here.

#### Single Speed Equation-Fit Model:

This section describes the equation-fit model for Water-to-Air heat pump
  (Object names: Coil:Cooling:WaterToAirHeatPump:EquationFit and
 Coil:Heating:WaterToAirHeatPump:EquationFit). This documentation is derived from the M.S. dissertation of Tang (2005) which is available on the Oklahoma State University web site . The model uses five non-dimensional equations or curves to predict the heat pump performance in cooling and heating mode. The methodology involves using the generalized least square method to generate a set of performance coefficients from the catalog data at indicated reference conditions. Then the respective coefficients and indicated reference conditions are used in the model to simulate the heat pump performance. The variables or inlet conditions that influenced the water-to-air heat pump performance are load side inlet water temperature, source side inlet temperature, source side water flow rate and load side water flow rate. The governing equations for the cooling and heating mode are as following:

Cooling Mode:

<div>$$\frac{{{Q_{total}}}}{{{Q_{total,ref}}}} = A1 + A2\left[ {\frac{{{T_{wb}}}}{{{T_{ref}}}}} \right] + A3\left[ {\frac{{{T_{w,in}}}}{{{T_{ref}}}}} \right] + A4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + A5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

<div>$$\frac{{{Q_{sens}}}}{{{Q_{sens,ref}}}} = B1 + B2\left[ {\frac{{{T_{db}}}}{{{T_{ref}}}}} \right] + B3\left[ {\frac{{{T_{wb}}}}{{{T_{ref}}}}} \right] + B4\left[ {\frac{{{T_{w,in}}}}{{{T_{ref}}}}} \right] + B5\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + B6\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

<div>$$\frac{{Powe{r_c}}}{{Powe{r_{c,ref}}}} = C1 + C2\left[ {\frac{{{T_{wb}}}}{{{T_{ref}}}}} \right] + C3\left[ {\frac{{{T_{w,in}}}}{{{T_{ref}}}}} \right] + C4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + C5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

Heating Mode:

<div>$$\frac{{{Q_h}}}{{{Q_{h,ref}}}} = E1 + E2\left[ {\frac{{{T_{db}}}}{{{T_{ref}}}}} \right] + E3\left[ {\frac{{{T_{w,in}}}}{{{T_{ref}}}}} \right] + E4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + E5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

<div>$$\frac{{Powe{r_h}}}{{Powe{r_{h,ref}}}} = F1 + F2\left[ {\frac{{{T_{db}}}}{{{T_{ref}}}}} \right] + F3\left[ {\frac{{{T_{w,in}}}}{{{T_{ref}}}}} \right] + F4\left[ {\frac{{{{\dot V}_{air}}}}{{{{\dot V}_{air,ref}}}}} \right] + F5\left[ {\frac{{{{\dot V}_w}}}{{{{\dot V}_{w,ref}}}}} \right]$$</div>

Assuming no losses, the source side heat transfer rate for cooling and heating mode is calculated as following;

<div>$${Q_{source,c}} = {Q_{total}} + Powe{r_c}$$</div>

<div>$${Q_{source,h}} = {Q_h} - Powe{r_h}$$</div>

where:

<span>$A1 - F5$</span>     = Equation fit coefficients for the cooling and heating mode

<span>${{T_{ref}}}$</span>            = 283K

<span>${{T_{w,in}}}$</span>           = Entering water temperature, K

<span>${{T_{db}}}$</span>             = Entering air dry-bulb temperature, K

<span>${{T_{wb}}}$</span>            = Entering air wet-bulb temperature, K

<span>${{{\dot V}_{air}}}$</span>            = Load side air volumetric flow rate, m<sup>3</sup>/s

<span>${{{\dot V}_{w}}}$</span>                         = Source side water volumetric flow rate, m<sup>3</sup>/s

<span>${{Q_{total}}}$</span>          = Total cooling capacity, W

<span>${{Q_{sens}}}$</span>          = Sensible cooling capacity, W

<span>${Powe{r_c}}$</span>     = Power consumption (cooling mode), W

<span>${{Q_{source,c}}}$</span>      = Source side heat transfer rate (cooling mode), W

<span>${{Q_{h}}}$</span>                         = Total heating capacity, W

<span>${Powe{r_h}}$</span>     = Power consumption (heating mode), W

<span>${{Q_{source,h}}}$</span>      = Source side heat transfer rate (heating mode), W

The inlet conditions or variables are divided by the reference conditions. This formulation allows the coefficients to fall into smaller range of values. Moreover, the value of the coefficient indirectly represents the sensitivity of the output to that particular inlet variable. The reference conditions used when generating the performance coefficients must be the same as the reference conditions used later in the model. The reference temperature <span>${{T_{ref}}}$</span>is fixed at 283K. Temperature unit of Kelvin is used instead of Celsius to keep the ratio of the water inlet temperature and reference temperature positive should the water inlet temperature drop below the freezing point.

For cooling mode, the reference conditions; reference load side air volumetric flow rate <span>$\left( {{{\dot V}_{air,ref}}} \right)$</span>,reference source side water volumetric flow rate<span>$\left( {{{\dot V}_{w,ref}}} \right)$</span>,reference sensible capacity <span>$\left( {{Q_{sens,ref}}} \right)$</span> and reference power input <span>$\left( {Powe{r_{c,ref}}} \right)$</span> are the conditions when the heat pump is operating at the highest cooling capacity or reference cooling capacity<span>$\left( {{Q_{total,ref}}} \right)$</span> indicated in the manufacturer’s catalog. Note that the reference conditions for heating mode might differ from the reference conditions specified for the cooling mode.

#### Coefficient estimation procedure:

The generalized least square method is used to generate the coefficients. This method utilizes an optimization method which calculates the coefficients that will give the least amount of differences between the model outputs and the catalog data. A set of coefficients for the cooling mode is generated which includes A1-A5 for total cooling capacity, B1-B6 for sensible cooling capacity, and C1-C5 for power consumption. The same procedure is repeated for the heating mode to generate the coefficients E1-E5 (total heating capacity) and F1-F5 (power consumption). An information flow chart showing the inputs, reference conditions, performance coefficients and outputs are shown in the figure below:



![](EngineeringReference/media/image7286.png)

Figure 322. Information Flow Chart for Water-to-Air Heat Pump Equation Fit Model (Tang 2005)

### Zone Air DX Dehumidifier

#### Overview

This model, object name ZoneHVAC:Dehumidifier:DX, simulates the thermal performance and electric power consumption of conventional mechanical dehumidifiers. These systems use a direct expansion (DX) cooling coil to cool and dehumidify an airstream. Heat from the DX system’s condenser section is rejected into the cooled/dehumidified airstream, resulting in warm dry air being supplied from the unit. In EnergyPlus, this object is modeled as a type of zone equipment (ref. ZoneHVAC:EquipmentList and ZoneHVAC:EquipmentConnections).

![Dehumidifier\_Schematic](EngineeringReference/media/image7287.png)

Figure 323. Mechanical Dehumidifier Schematic

The model assumes that this equipment dehumidifies and heats the air. If used in tandem with another system that cools and dehumidifies the zone air, then the zone dehumidifier should be specified as the lowest cooling priority in the ZoneHVAC:EquipmentList object for best control of zone temperature and humidity levels. With this zone equipment prioritization, the other cooling and dehumidification system would operate first to meet the temperature setpoint (and possibly meet the high humidity setpoint as well). If additional dehumidification is needed, then the zone dehumidifier would operate. The sensible heat generated by the dehumidifier is carried over to the zone air heat balance for the next HVAC time step.

#### Model Description

The user must input water removal, energy factor and air flow rate at rated conditions (26.7°C, 60% RH).  Three performance curves must also be specified to characterize the change in water removal and energy consumption at part-load conditions:

1)    Water removal curve (function of inlet air temperature and relative humidity)

2)    Energy factor curve (function of inlet air temperature and relative humidity)

3)    Part load fraction correlation (function of part load ratio)

·        The water removal modifier curve is a biquadratic curve with two independent variables: dry-bulb temperature and relative humidity of the air entering the dehumidifier. The output of this curve is multiplied by the Rated Water Removal to give the water removal rate at the specific entering air conditions at which the dehumidifier is operating (i.e., at temperature/relative humidity different from the rating point conditions). If the output of this curve is negative, then a warning message is issued and it is reset to 0.0.

<div>$$WaterRemovalModFac = \,a + \,b\left( {{T_{in}}} \right)\,\, + \,\,c{\left( {{T_{in}}} \right)^2}\,\, + \,\,d\left( {R{H_{in}}} \right) + e{(R{H_{in}})^2} + f({T_{in}})(R{H_{in}})$$</div>

where

*T<sub>in</sub>*  = dry-bulb temperature of the air entering the dehumidifier, °C

*RH<sub>in</sub>* = relative of the air entering the dehumidifier, % (0-100)

·        The energy factor modifier curve is a biquadratic curve with two independent variables: dry-bulb temperature and relative humidity of the air entering the dehumidifier. The output of this curve is multiplied by the Rated Energy Factor to give the energy factor at the specific entering air conditions at which the dehumidifier is operating (i.e., at temperature/relative humidity different from the rating point conditions). If the output of this curve is negative, then a warning message is issued and it is reset to 0.0.

<div>$$EFModFac = \,a + \,b\left( {{T_{in}}} \right)\,\, + \,\,c{\left( {{T_{in}}} \right)^2}\,\, + \,\,d\left( {R{H_{in}}} \right) + e{(R{H_{in}})^2} + f({T_{in}})(R{H_{in}})$$</div>

·        The part load fraction (PLF) correlation curve is a quadratic or a cubic curve with the independent variable being part load ratio (PLR = water removal load to be met / dehumidifier steady-state water removal rate). The part load ratio is divided by the output of this curve to determine the dehumidifier runtime fraction. The part load fraction correlation accounts for efficiency losses due to compressor cycling.

<div>$$PartLoadFrac = PLF = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2}$$</div>

or

<div>$$PartLoadFrac = a + b\left( {PLR} \right) + c{\left( {PLR} \right)^2} + d{\left( {PLR} \right)^3}$$</div>

where

<div>$$PLR = \,part - load\,ratio\,\, = \left( {\frac{{water\,removal\,load\,to\,be\,met}}{{dehumidifier\,steady - state\,water\,removal\,rate}}} \right)$$</div>

The part load fraction correlation should be normalized to a value of 1.0 when the part load ratio equals 1.0 (i.e., no efficiency losses when the dehumidifier runs continuously for the simulation timestep). For PLR values between 0 and 1 (0 &lt;= PLR &lt; 1), the following rules apply:

0.7 &lt;= PLF &lt;= 1.0   and   PLF &gt;= PLR

If PLF &lt; 0.7 a warning message is issued, the program resets the PLF value to 0.7, and the simulation proceeds. The runtime fraction of the dehumidifier is defined as PLR/PLF. If PLF &lt; PLR, then a warning message is issued and the runtime fraction of the dehumidifier is set to 1.0.

Mechanical dehumidifier typically have long runtimes with minimal compressor cycling. So, a typical part load fraction correlation might be:

      PLF = 0.95 + 0.05(PLR)

If the user wishes to model no efficiency degradation due to compressor cycling, the part load fraction correlation should be defined as follows:

      PLF = 1.0 + 0.0(PLR)

All three part-load curves are accessed through EnergyPlus’ built-in performance curve equation manager (Curve:Quadratic, Curve:Cubic and Curve:Biquadratic). It is not imperative that the user utilize all coefficients shown in curve equations above if their performance equation has fewer terms (e.g., if the user’s PartLoadFrac performance curve is linear instead of quadratic, simply enter the values for a and b, and set coefficient c equal to zero).

For any simulation time step when there is a water removal load to be met, the dehumidifier is available to operate (via availability schedule), and the inlet air dry-bulb temperature is within the minimum and maximum dry-bulb temperature limits specified in the input file for this object, the water removal rate for the dehumidifier is calculated as follows:

<div>$${\dot m_{_{water,ss}}} = \frac{{{\rho_{water}}\left( {{{\dot V}_{_{water,rated}}}} \right)\left( {WaterRemovalModFac} \right)}}{{\left( {24\,hr/dy} \right)\left( {3600sec/hr} \right)\left( {1000L/{m^3}} \right)}}$$</div>

where

<span>${\dot m_{_{water,ss}}}$</span>  =  dehumidifier steady-state water removal rate, kg/s

<span>${\rho_{water}}$</span> = density of water, kg/m<sup>3</sup>

<span>${\dot V_{_{water,rated}}}$</span>  = rated water removal rate (user input), L/day

The Zone Dehumidifier Part-Load Ratio (output variable) is then calculated, with the result constrained to be from 0.0 to 1.0:

<div>$$PLR = \,\frac{{water\,removal\,load\,to\,be\,met}}{{{{\dot m}_{_{water,ss}}}}},\,\,\,0.0 \le PLR \le 1.0$$</div>

The steady-state and average electrical power consumed by the dehumidifier are calculated next using the following equations:

<div>$$\begin{array}{l}{P_{dehumid,ss}} = \frac{{{{\dot V}_{_{water,rated}}}\left( {WaterRemovalModFac} \right)\left( {1000\,\,W/kW} \right)}}{{E{F_{rated}}\left( {EFModFac} \right)\left( {24\,hr/day} \right)}}\\ {P_{dehumid,avg}} = {P_{dehumid,ss}}\left( {RTF} \right) + \left( {{P_{off - cycle}}*\left( {1 - RTF} \right)} \right)\end{array}$$</div>

where

<span>${P_{dehumid,ss}}$</span>= dehumidifier steady-state electric power, W

<span>${P_{dehumid,avg}}$</span>= Zone Dehumidifier Electric Power, W (output variable)

<div>$$RTF = \frac{{PLR}}{{PLF}}\, = \,Zone Dehumidifier\,\,Runtime\,\,Fraction (output variable)$$</div>

<span>$E{F_{rated}}$</span>  = rated energy factor (user input), L/kWh

<span>${P_{off - cycle}}$</span>  = off-cycle parasitic electric load (user input), W

If the dehumidifier is unavailable to operate for the time period (via the specified availability schedule) then Zone Dehumidifier Electric Power is set equal to zero.

The average water removal rate (kg/s) for the simulation time step is then calculated:

<div>$${\dot m_{water,\,avg}} = {\dot m_{water,\,ss}}\left( {PLR} \right) = {\rm{Zone Dehumidifier Removed Water Mass Flow Rate}},\;{\rm{kg/s}}\,\left( {{\rm{output}}\,{\rm{variable}}} \right)$$</div>

The Zone Dehumidifier Sensible Heating Rate (output variable) is calculated as follows:

<div>$${\dot Q_{_{sensible,avg}}} = {\dot m_{_{water,avg}}}\left( {{h_{fg}}} \right) + \,{P_{dehumid,avg}}$$</div>

where

*h<sub>fg</sub>* = enthalpy of vaporization of air, J/kg

The Zone Dehumidifier Sensible Heating Rate (W) is calculated during each HVAC simulation time step, and the results are averaged for the timestep being reported. However, this sensible heating is carried over to the zone air heat balance for the next HVAC time step (i.e., it is reported as an output variable for the current simulation time step but actually impacts the zone air heat balance on the following HVAC time step).

The air mass flow rate through the dehumidifier is determined using the Rated Air Flow Rate (m<sup>3</sup>/s) entered in the input, PLR, and converting to mass using the density of air at rated conditions (26.7C, 60% RH) and local barometric pressure accounting for altitude

p=101325\*(1-2.25577E-05\*Z)\*\*5.2559  where p=pressure in Pa and Z=altitude in m:

<div>$${\dot m_{_{air,avg}}} = {\rho_{air}}\left( {{{\dot V}_{_{air,rated}}}} \right)\left( {PLR} \right)$$</div>

where

<span>${\dot m_{_{air,avg}}}$</span>= average air mass flow rate through dehumidifier, kg/s

<span>${\dot V_{_{air,rated}}}$</span>= rated air flow rate (user input), m<sup>3</sup>/s

<span>${\rho_{air}}$</span> = density of air at 26.7°C , 60% RH and local barometric pressure, kg/m<sup>3</sup>

The dry-bulb temperature and humidity ratio of the air leaving the dehumidifier are calculated as follows:

<div>$$\begin{array}{l}{T_{out}} = {T_{in}} + \left( {\frac{{{P_{dehumid,ss}} + \left( {{{\dot m}_{_{water,ss}}}} \right)\left( {{h_{fg}}} \right)}}{{{\rho_{air}}\left( {{{\dot V}_{_{air,rated}}}} \right)\left( {{C_p}} \right)}}} \right)\,\\ {w_{out}} = {w_{in}} - \left( {\frac{{{{\dot m}_{_{water,avg}}}}}{{{{\dot m}_{air,avg}}}}} \right)\end{array}$$</div>

where

*T<sub>out</sub>* =    Zone Dehumidifier Outlet Air Temperature, C (output variable). Represents the

outlet air temperature when the dehumidifier is operating.

*T<sub>in</sub>* = inlet air dry-bulb temperature, C

<span>${C_p}$</span>= heat capacity of air, J/kg

*w<sub>in</sub>* = inlet air humidity ratio, kg/kg

*w<sub>out</sub>* = outlet air humidity ratio, kg/kg

If the dehumidifier does not operate for a given HVAC simulation time step, then the outlet air dry-bulb temperature and humidity ratio are set equal to the corresponding inlet air values.



Since the sensible heating rate impacts the zone air heat balance on the following HVAC time step and is passed to the heat balance via an internal variable, the dry-bulb temperature of the dehumidifier’s HVAC outlet air node (System Node Temperature) will always be set equal to the dehumidifier’s HVAC inlet air node temperature. Therefore, when the dehumidifier operates the Zone Dehumidifier Outlet Air Temperature (output variable) will not be equal to the System Node Temperature for the dehumidifier’s HVAC outlet node.

Finally, the following additional output variables are calculated:

<div>$${Q_{_{sensible}}} = {\dot Q_{_{sensible,avg}}}*TimeStepSys*3600.$$</div>

<div>$${E_{Dehumid}} = {P_{Dehumid,avg}}*TimeStepSys*3600.$$</div>

<div>$${P_{off - cycle,avg}} = {P_{off - cycle}}\left( {1 - RTF} \right)$$</div>

<div>$${E_{off - cycle}} = {P_{off - cycle,avg}}*TimeStepSys*3600.$$</div>

<div>$${m_{_{water}}} = {\dot m_{_{water,avg}}}*TimeStepSys*3600.$$</div>

<div>$${\dot V_{_{water,avg}}} = {\raise0.7ex\hbox{${{{\dot m}_{_{water,avg}}}}$} \!\mathord{\left/ {\vphantom {{{{\dot m}_{_{water,avg}}}} {{\rho_{water}}}}}\right.}\!\lower0.7ex\hbox{${{\rho_{water}}}$}}$$</div>

<div>$${V_{_{water}}} = {\dot V_{_{water,avg}}}*TimeStepSys*3600.$$</div>

where

*Q<sub>sensible  </sub>*= output variable ‘Zone Dehumidifier Sensible Heating Energy [J]’

*E<sub>dehumid</sub>*   = output variable ‘Zone Dehumidifier Electric Energy [J]’

*P<sub>off-cycle,avg</sub>* = output variable ‘Zone Dehumidifier Off Cycle Parasitic Electric Power [W]’

*E<sub>off-cycle</sub>* = output variable ‘Zone Dehumidifier Off Cycle Parasitic Electric Energy [J]’

*m<sub>water</sub>*= output variable ‘Zone Dehumidifier Removed Water Mass [kg]’

<span>${\dot V_{_{water,avg}}}$</span>*<sub> </sub>*= output variable ‘Zone Dehumidifier Condensate Volume Flow Rate [m<sup>3</sup>/s]’

<span>${V_{_{water}}}$</span>  = output variable ‘Zone Dehumidifier Condensate Volume [m<sup>3</sup>]’

### Energy Recovery Ventilator

The input object ZoneHVAC:EnergyRecoveryVentilator provides a model for a stand alone energy recovery ventilator (ERV) that is a single-zone HVAC component used for exhaust air heat recovery (see figure below). This compound object consists of three required components: a generic air-to-air heat exchanger (see object HeatExchanger:AirToAir:SensibleAndLatent), a supply air fan, and an exhaust air fan (see object Fan:OnOff). An optional controller (see object  ZoneHVAC:EnergyRecoveryVentilator:Controller) may be used to simulate economizer (free cooling) operation.

![Schematic\_StandAloneERV](EngineeringReference/media/image7321.png)

Figure 324. Schematic of the Energy Recovery Ventilator:Stand Alone compound object

This compound object models the basic operation of supply and exhaust air fans and an air-to-air heat exchanger. The stand alone ERV operates whenever the unit is scheduled to be available (Availability schedule). The stand alone ERV object can be used in conjunction with an economizer feature whereby heat exchange is suspended whenever free cooling is available (i.e., air flow is fully bypassed around a fixed-plate heat exchanger or the rotation of a rotary heat exchanger is stopped).

To model a stand alone ERV connected to a single zone, the input data file should include the following objects:

n ZoneHVAC:EnergyRecoveryVentilator

n HeatExchanger:AirToAir:SensibleAndLatent

n Fan:OnOff (supply air)

n Fan:OnOff (exhaust air)

n ZoneHVAC:EnergyRecoveryVentilator:Controller (if economizer [free cooling] operation is desired)

n SetpointManager:Scheduled (if supply air outlet temperature control is used, Ref. HeatExchanger:AirToAir:SensibleAndLatent)

n ZoneHVAC:EquipmentConnections

n ZoneHVAC:EquipmentList

n OutdoorAir:NodeList

#### Model Description

The purpose of this compound component is to simply call the individual component models and optional controller for each energy recovery ventilator. Since this equipment is not associated with an air loop, the compound object sets the supply and exhaust air mass flow rates through the ventilator. This compound object is also used to report the total, sensible and latent energy supplied to the zone, as well as the total electrical energy consumed by all of the individual components (supply air fan, exhaust air fan and heat exchanger parasitics).

During each simulation time step, the air mass flow rate at the supply air and exhaust air inlets is set based on the stand alone ERV’s availability schedule and the specified volumetric air flow rates as follows:

IF (availability schedule value &gt; 0) THEN

 <span>${\mathop m\limits^ \bullet_{Supply}} = \rho {\mathop V\limits^ \bullet_{Supply}}$</span>

<div>$${\mathop m\limits^ \bullet_{Exhaust}} = \rho {\mathop V\limits^ \bullet_{Exhaust}}$$</div>

ELSE

<div>$${\mathop m\limits^ \bullet_{Supply}} = {\mathop m\limits^ \bullet_{Exhaust}} = 0.0$$</div>

*where*:

<span>${\mathop m\limits^ \bullet_{Supply}}$</span>             = mass flow rate of the supply air stream, kg/s

<span>${\mathop m\limits^ \bullet_{Exhaust}}$</span>            = mass flow rate of the exhaust air stream, kg/s

<span>$\rho $</span>                    = density of dry air at local barometric pressure (adjusted for altitude)        and 20 ºC, kg/m<sup>3</sup>

<span>${\mathop V\limits^ \bullet_{Supply}}$</span>             = volumetric flow rate of the supply air stream, m<sup>3</sup>/s

<span>${\mathop V\limits^ \bullet_{Exhaust}}$</span>            = volumetric flow rate of the exhaust air stream, m<sup>3</sup>/s

With the supply and exhaust inlet air mass flow rates set, the compound object then calls the generic air-to-air heat exchanger model to determine its supply air and exhaust air exiting conditions based on the inputs specified in the heat exchanger object. The supply air and exhaust air fans are then modeled to determine the final conditions of the air streams exiting the stand alone energy recovery ventilator. The heat exchanger and fan models are described in detail elsewhere in this document (reference: HeatExchanger:AirToAir:SensibleAndLatent and Fan:OnOff).

The sensible heat transfer rate to the zone by the stand alone ventilator is then calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{Sensible}}\, = \,{\mathop {\,m}\limits^ \bullet_{Supply}}{\left( {{h_{SupplyOutlet}}\, - \,{h_{ExhaustInlet}}} \right)_{HR\min }}$$</div>

 where:

<sub><span>${\mathop Q\limits^ \bullet_{Sensible}}$</span>        </sub>= sensible energy transfer rate to the zone, W

<span>${\mathop m\limits^ \bullet_{Supply}}$</span>       = mass flow rate of the supply air stream, kg/s

*h<sub>SupplyOutlet</sub>*   = enthalpy of the air being supplied to the zone, J/kg

*h<sub>ExhaustInlet</sub>*<sub> \\     </sub> = enthalpy of the air being exhausted from the zone through the ventilator, J/kg

*HR<sub>min</sub>        =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio

   of the supply air outlet or the exhaust air inlet

The resulting sensible energy transfer rate is passed to the zone equipment manager and added to the zone load to be met by other heating or cooling equipment. Since the stand alone ERV is intended to reduce the outdoor air load through heat exchange and not meet that load completely, the stand alone heat exchanger must be modeled first in the list of zone equipment. This is accomplished by setting the stand alone ERV priority for cooling and heating higher than that of other zone cooling or heating equipment (reference: ZoneHVAC:EquipmentList).

When economizer (free cooling) operation is desired, a controller is coupled to the stand alone ERV by providing the name of the controller object in the ERV controller input field. This controller determines when the air-side economizer is active (i.e., air flow is fully bypassed around a fixed-plate heat exchanger or the rotation of a rotary heat exchanger is stopped) based on the controller inputs (Ref. ZoneHVAC:EnergyRecoveryVentilator:Controller).

At the end of each HVAC simulation time step, this compound object reports the heating or cooling rate and energy delivered to the zone, as well as the electric power and consumption by the ventilator. In terms of thermal energy delivered to the zone, the sensible, latent and total energy transfer rate to the zone is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{Total}}\, = \,\,{\mathop m\limits^ \bullet_{Supply}}{\left( {{h_{SupplyOutlet}}\, - \,{h_{ExhaustInlet}}} \right)_{}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{Sensible}}\, = \,\,{\mathop m\limits^ \bullet_{Supply}}{\left( {{h_{SupplyOutlet}}\, - \,{h_{ExhaustInlet}}} \right)_{HR\min }}$$</div>

<div>$${\mathop Q\limits^ \bullet_{Latent}}\, = \,\,{\mathop Q\limits^ \bullet_{Total}}\, - \,{\mathop Q\limits^ \bullet_{Sensible}}$$</div>

 where:

<sub><span>${\dot Q_{Total}}$</span>           </sub>= total energy transfer rate to the zone, W

<sub><span>${\dot Q_{Sensible}}$</span>        </sub>= sensible energy transfer rate to the zone, W

<sub><span>${\dot Q_{Latent}}$</span>        </sub>= latent energy transfer rate to the zone, W

<span>${\mathop m\limits^ \bullet_{Supply}}$</span>       = mass flow rate of the supply air stream, kg/s

*h<sub>SupplyOutlet</sub>*   = enthalpy of the air being supplied to the zone, J/kg

*h<sub>ExhaustInlet</sub>*<sub> \\     </sub> = enthalpy of the air being exhausted from the zone through the ventilator, J/kg

*HR<sub>min</sub>        =* enthalpies evaluated at a constant humidity ratio, the minimum humidity ratio

   of the supply air outlet or the exhaust air inlet



Since each of these energy transfer rates can be calculated as positive or negative values, individual reporting variables are established for cooling and heating and only positive values are reported. The following calculations are representative of what is done for each of the energy transfer rates:

IF (<span>${\dot Q_{Total}}$</span>* &lt; 0.0 )*THEN

                  <span>${\dot Q_{TotalCooling}}$</span> =  ABS (<span>${\dot Q_{Total}}$</span>)

                  <span>${\dot Q_{TotalHeating}}$</span><sub> </sub> =  *0.0*

ELSE

                  <span>${\dot Q_{TotalCooling}}$</span><sub> </sub> =  *0.0*

                  <span>${\dot Q_{TotalHeating}}$</span><sub> </sub> =  <span>${\dot Q_{Total}}$</span>



where:

<sub><span>${\dot Q_{TotalCooling}}$</span>   </sub>= output variable ‘Zone Ventilator Total Cooling Rate, W’

<sub><span>${\dot Q_{TotalHeating}}$</span>   </sub>= output variable ‘Zone Ventilator Total Heating Rate, W’



In addition to heating and cooling rates, the heating and cooling energy supplied to the zone is also calculated for the time step being reported. The following example for total cooling energy is representative of what is done for the sensible and latent energy as well as the heating counterparts.

<div>$${Q_{TotalCooling}} = {\dot Q_{TotalCooling}}*TimeStepSys*3600.$$</div>

where:

<sub><span>${\dot Q_{TotalCooling}}$</span>   </sub>= output variable ‘Zone Ventilator Total Cooling Energy, J’

*TimeStepSys* = HVAC system simulation time step, hr

### Zone Evaporative Cooler Unit

The input object ZoneHVAC:EvaporativeCoolerUnit provides a zone equipment model for evaporative cooling.  This is a compound object that combines a fan and one or two evaporative coolers in a zone unit.  The fan and evaporative cooler component models are described elsewhere. In this section we describe how the zone unit is controlled.

#### Controls

There are three choices for control methods.

**ZoneTemperatureDeadbandOnOffCycling**. This control method operates the cooler unit in a manner similar to how a normal, real-world themostat operates.  The control uses input for throttling temperature range, <span>$\Delta {T_{throttle}}$</span>, the most recent result for zone air node temperature, <span>${T_{zone}}$</span>, and the current cooling setpoint temperature, <span>${T_{set}}$</span>.  The controller also stores the history of whether or not the unit was operating during the previous timestep to model hysteresis control where the unit retains its mode when it passes through the throttling range (to avoid short cycling).

The following algorithm is used to determine if the unit will operate.

If <span>$\left[ {{T_{zone}} < \left( {{T_{set}} - 0.5*\Delta {T_{throttle}}} \right)} \right]$</span> is true, then do not operate cooler unit.

If <span>$\left[ {{T_{zone}} > \left( {{T_{set}} + 0.5*\Delta {T_{throttle}}} \right)} \right]$</span> is true, then operate the cooler unit (at full speed).

If zone air temperature is within the throttling range, <span>$\left[ {\left( {{T_{set}} - 0.5*\Delta {T_{throttle}}} \right) < {T_{zone}} < \left( {{T_{set}} + 0.5*\Delta {T_{throttle}}} \right)} \right]$</span>, then continue to operate the cooler if it was running during the previous timestep and do not operate the cooler if it was not running during the previous timestep.

Whenever the unit is operating, it runs at the full design air mass flow rate regardless if the fan is constant or variable speed.

**ZoneCoolingLoadOnOffCycling.** This control method operates the cooler similar to how a thermostat would behave, but instead of using temperatures it uses the predicted zone load to cooling setpoint.  The control uses input for the threshold value for a load that is considered a significant, <span>${\dot Q_{thresh}}$</span>, and the result from the Predictor for the zone’s load to cooling setpoint, <span>${\dot Q_{CoolLoad}}$</span>. The following algorithm is used to determine if the unit will operate.

If <span>$\left[ {{{\dot Q}_{CoolLoad}} \le {{\dot Q}_{thresh}}} \right]$</span> is true, then do not operate cooler unit.

If <span>$\left[ {{{\dot Q}_{CoolLoad}} > {{\dot Q}_{thresh}}} \right]$</span> is true, then operate the cooler unit (at full speed).

Whenever the unit is operating, it runs at the full design air mass flow rate regardless if the fan is constant or variable speed.

**ZoneCoolingLoadVariableSpeedFan.** This control method also operates the cooler using the predicted zone load to cooling setpoint but instead of on/off cycling, it modulates the fan speed to meet the cooling load.  This control method is only applicable to cooler units with variable speed supply fans. The control uses input for the threshold value for a load that is considered a significant, <span>${\dot Q_{thresh}}$</span>, and the result from the Predictor for the zone’s cooling load to setpoint, <span>${\dot Q_{CoolLoad}}$</span>. The following algorithm is used to determine if the unit will operate.

If <span>$\left[ {{{\dot Q}_{CoolLoad}} \le {{\dot Q}_{thresh}}} \right]$</span> is true, then do not operate cooler unit.

If <span>$\left[ {{{\dot Q}_{CoolLoad}} > {{\dot Q}_{thresh}}} \right]$</span> is true, then operate the cooler unit.

When the unit operates, the model first operates the unit at the highest fan speed, a fan speed ratio of 1.0, and determines the sensible cooling provided by the unit to the zone, <span>${\dot Q_{FullOutput}}$</span>.  If <span>${\dot Q_{FullOutput}} \le {\dot Q_{CoolLoad}}$</span>then the unit operates at full fan speed because the cooler cannot meet the entire zone cooling load.  If <span>${\dot Q_{FullOutput}} > {\dot Q_{CoolLoad}}$</span> then the model solves for a fan speed ratio between 0.0 and 1.0 that satisifies <span>$ABS\left( {\dot Q{}_{Output} - {{\dot Q}_{CoolLoad}}} \right) < 0.01$</span> using the non-linear numerical method called regula falsi.

### Unit Heater

(Note: Some of this information also appears in the Input Output Reference for EnergyPlus.  It is repeated here for clarity.)

The input object ZoneHVAC:UnitHeater provides a model for unit heaters that are zone equipment units which are assembled from other components and are a simplification of unit ventilators.  They contain only a fan and a heating coil. These components are described elsewhere in this document. The unit heater input simply requires the names of these components, which have to be described elsewhere in the input. The input also requires the name of an availability schedule, maximum airflow rate, and maximum and minimum hot water volumetric flow rates. The unit is connected to the zone inlet and exhaust nodes by specifying unit inlet and outlet node names. Note that the unit air inlet node should be the same as a zone exhaust node and the unit outlet node should be the same as a zone inlet node.

#### Controls

While the control of the heating coil is similar to the fan coil units and the unit ventilator, the overall control of the unit heater is much different.  There are four different modes in which a unit heat can operate based on the user input:

**OFF:** In this mode, the unit has been scheduled off.  All flow rates are set to zero, and the temperatures are set to zone conditions.

**NO LOAD OR COOLING/”NO”** for “Supply Air Fan Operation During No Heating” input field **:** In this mode, the unit is available, but there is no heating load.  With “No” specified for “Supply Air Fan Operation During No Heating” and the supply fan operating mode schedule value of 0, the fan will only run when there is a heating load.  Since there is no heating load in this mode and the fan is in cycling operating mode, all flow rates are set to zero, and the temperatures are set to zone conditions.  Since the unit heater is designed only to provide heating, the presence of a cooling load signifies that the unit should not be running.

**NO LOAD OR COOLING/”YES”** for “Supply Air Fan Operation During No Heating” input field**:** In this mode, the unit is available and the fan is controlled to be running continuously. For OnOff fan type the supply fan operating mode schedule value should be greater than 0.  If it is scheduled to be available and the supply fan operating mode schedule value is greater than 0, then the fan runs and circulates air to the space.  While no direct heating is provided, any heat added by the fan is introduced into the space with the circulation of the air.  If the fan is scheduled off, the fan will not run (this is identical to “NO” control with no load).

With “Yes” specified for “Supply Air Fan Operation During No Heating”, and the supply fan operating mode schedule value is 0  (for onOff fan type), then supply fan will not run.  Since there is no heating load in this mode and the fan is in cycling mode, all flow rates are set to zero. This control mode allows to schedule the supply fan operation by specifying different operating modes during the day regardless of the heating load.

**HEATING:** In this mode, the unit and fan are on/available, and there is a heating load.  The heating coil is modulated (constant fan speed) to meet the heating load.  When the fan is not cycling then the control of the heating coil and its flow rate is identical to the fan coil unit.  The flow rate of air through the unit is controlled by the user input and schedules. In the case of OnOff fan the fan cycles with heating coil if the current timestep supply fan operating mode schedule value is 0, or the supply fan runs continuously for the entire timestep if the current timestep fan operating mode schedule value is greater than 0.  When the fan is cycling the average supply air flow rate is proportional to the heating load at current time step, or else when the fan is scheduled to run continuously the fan supplies the maximum flow rate specified.

### Unit Ventilator

(Note: Some of this information also appears in the Input Output Reference for EnergyPlus.  It is repeated here for clarity.)

The input object ZoneHVAC:UnitVentilator provides a model for unit ventilators that are zone equipment units which are assembled from other components. They contain a built-in outdoor air mixer, a fan, a heating coil, and a cooling coil. These components are described elsewhere in this document, except the built-in outdoor air mixer which is contained within the unit ventilator statement. The unit ventilator input simply requires the names of these other three components, which have to be described elsewhere in the input. The input also requires the name of an availability schedule, maximum airflow rate, outdoor air control information (control type and schedules), an outdoor airflow rate, and maximum and minimum hot and cold water mass flow rates. The unit is connected to the zone inlet and exhaust nodes and the outdoor air by specifying unit inlet, outlet, outdoor air and exhaust (relief) air node names. Note that the unit air inlet node should be the same as a zone exhaust node and the unit outlet node should be the same as a zone inlet node. In general, the unit ventilator input is very similar to the fan coil unit input, and the unit is connected to a hot water loop (demand side) through its hot water coil and to a chilled water loop (demand side) through its cooling coil.

#### Controls and Outdoor Air

The main difference between the fan coil and unit ventilator input is that the unit ventilator has a built-in outdoor air mixer with its own specialized controls. The outdoor air control type can be selected from one of the following options: “variable percent”, “fixed temperature” or “fixed amount”. In fixed temperature control, the amount of outdoor air is varied between the minimum outdoor air fraction (specified by a schedule) and 100% outdoor air to obtain a mixed air temperature as close as possible to the temperature schedule defined in the input. Variable percent control will also vary the amount of outdoor air between the minimum and maximum fractions (both specified in input by the user) to meet the load without the use of a coil if possible. In fixed amount control, the outdoor air flow rate is fixed to the specified value by the user. In this control strategy, the maximum outdoor air flow rate and schedule are automatically set to be equal to the minimum outdoor air flow rate and schedule. These control types are based on the 2004 ASHRAE Systems and Equipment Handbook (pp. 31.1-31.3) description of unit ventilator systems.

The unit is controlled to meet the zone (remaining) heating or cooling demand. If there is a heating demand, the cooling coil is off and the hot water flow through the heating coil is throttled to meet the demand. The hot water control node must be specified (same as the hot water coil inlet node) as well as maximum and minimum possible hot water volumetric flow rates. If there is a cooling demand from the zone, the hot water coil is off and the chilled water flow through the cooling coil is throttled to meet the load. The cooling coil control node must be specified (same as the cooling coil inlet node) and the maximum and minimum chilled water volumetric flow rates must be given. Finally both heating and cooling require a convergence tolerance, which is the tolerance denoting how closely the fan coil unit will meet the heating or cooling load. The tolerance is always relative to the zone load.

Overall, control of the unit must consider the outdoor air for continuously running and cycling fans. For cycling fan operating mode, the outdoor air mass rate is capped by the actual supply air flow rate if the former is greater than the latter; otherwise, uses the amount calculated by the outdoor air control. Here is a more detailed description of the overall unit control:

**OFF:** Unit is schedule off or there is no load on it. All flow rates are set to zero and the temperatures are set to zone conditions (except for the outdoor air inlet). Outdoor air requirements will not override this condition.

**HEATING/NO COIL/VARIABLE PERCENT:** The unit is on, there is a heating load, no heating coil is present or it has been scheduled off, and variable percent outdoor air control type has been specified. In this case, the variable percent outdoor air controls what happens with the outdoor air. If the outside temperature is greater than the return temperature, then the outdoor air is set to the maximum as defined by the user input. If the outdoor air temperature is less than the return temperature from the zone, then the outdoor air is set to the minimum outdoor air flow rate as defined by the user. Since a coil is not present to further condition the supply air, the zone simply receives whatever temperature air results from the outdoor air controls.

**HEATING/NO COIL/FIXED TEMPERATURE:** The unit is on, there is a heating load, no heating coil is present or it has been scheduled off, and fixed temperature has been specified. The unit ventilator tries to use outdoor air as best as possible to meet the temperature goal. If it cannot meet this goal because the temperature goal is not between the zone return temperature and the outdoor air temperature, then the unit ventilator will either use the maximum or minimum outdoor air flow rate.

**HEATING/NO COIL/FIXED AMOUNT:** The unit is on, there is a heating load, no heating coil is present or it has been scheduled off, and fixed amount control has been specified. The unit ventilator fixes the outdoor air flow rate as defined by the user and sets the maximum and minimum outdoor air flow rate to be equal in order to avoid the variation of outdoor air flow rate between the maximum and minimum values. Since a coil is not present to further condition the supply air, the zone simply receives whatever temperature air results from the outdoor air controls.

**HEATING/WITH COIL/VARIABLE PERCENT:** The unit is on, there is a heating load, and variable percent control is specified. The outdoor air fraction is set to the minimum outdoor air fraction (schedule based), and the heating coil is activated. The heating coil attempts to meet the remaining load on the zone being served by the unit ventilator.

**HEATING/WITH COIL/FIXED AMOUNT:** The unit is on, there is a heating load, a heating coil is present and is scheduled on, and fixed amount control has been specified. The unit ventilator fixes the outdoor air flow rate as defined by the user and sets the maximum and minimum outdoor air flow rate to be equal in order to avoid the variation of outdoor air flow rate between the maximum and minimum values. The heating coil then attempts to meet any remaining zone heating load.

**COOLING/NO COIL/VARIABLE PERCENT:** The unit is on, there is a cooling load, no coil is present or it has been scheduled off, and variable percent outdoor air control type has been specified. In this case, the variable percent outdoor air controls what happens with the outdoor air. If the outside temperature is greater than the return temperature, then the outdoor air is set to the minimum as defined by the user input. If the outdoor air temperature is less than the return temperature from the zone, then the outdoor air is set to the maximum outdoor air flow rate as defined by the user. This may be somewhat simplistic in that it could result in overcooling of the space. However, since a temperature goal was not established, this is the best that can be done by the simulation. Since a coil is not present to further condition the supply air, the zone simply receives whatever temperature air results from the outdoor air controls.

**COOLING/NO COIL/FIXED TEMPERATURE:** The unit is on, there is a cooling load, no cooling coil is present or it has been scheduled off, and fixed temperature has been specified. The unit ventilator tries to use outdoor air as best as possible to meet the temperature goal. If it cannot meet this goal because the temperature goal is not between the zone return temperature and the outdoor air temperature, then the unit ventilator will either use the maximum or minimum outdoor air flow rate in the same fashion as the variable percent outdoor air control.

**COOLING/NO COIL/FIXED AMOUNT:** The unit is on, there is a cooling load, no cooling coil is present or it has been scheduled off, and fixed amount control has been specified. The unit ventilator fixes the outdoor air flow rate as defined by the user and sets the maximum and minimum outdoor air flow rate to be equal in order to avoid the variation of outdoor air flow rate between the maximum and minimum values. Since a coil is not present to further condition the supply air, the zone simply receives whatever temperature air results from the outdoor air controls.

**COOLING/WITH COIL/VARIABLE PERCENT:** The unit is on, there is a cooling load, a coil is present and is scheduled on, and variable percent outdoor air control type has been specified. In this case, the percentage of outdoor air is set to the minimum flow outdoor air flow rate. The coil then attempts to meet any remaining zone load.

**COOLING/WITH COIL/FIXED TEMPERATURE:** The unit is on, there is a cooling load, a cooling coil is present and is scheduled on, and fixed temperature has been specified. The unit ventilator tries to use outdoor air as best as possible to meet the temperature goal. If it cannot meet this goal because the temperature goal is not between the zone return temperature and the outdoor air temperature, then the unit ventilator will either use the maximum or minimum outdoor air flow rate in the same fashion as the fixed temperature outdoor air control for the “no coil” conditions. The cooling coil then attempts to meet any remaining zone load.

**COOLING/WITH COIL/FIXED AMOUNT:** The unit is on, there is a cooling load, a cooling coil is present and is scheduled on, and fixed amount control has been specified. The unit ventilator fixes the outdoor air flow rate as defined by the user and sets the maximum and minimum outdoor air flow rate to be equal in order to avoid the variation of outdoor air flow rate between the maximum and minimum values. The cooling coil then attempts to meet any remaining zone cooling load.

Note: the unit ventilator controls are strictly temperature based and do not factor humidity into the equation (not an enthalpy economy cycle but rather a simple return air economy cycle). In addition, temperature predictions are not strict energy balances here in the control routine though in the mixing routine an energy balance is preserved.

### Variable Refrigerant Flow Terminal Unit

Variable refrigerant flow zone terminal units are used exclusively with variable refrigerant flow (VRF) air conditioning systems (ref: AirConditioner:VariableRefrigerantFlow and ZoneTerminalUnitList). The terminal units operate to satisfy a heating or cooling load in a zone based on a zone thermostat temperature set point. A direct-expansion (DX) cooling and/or DX heating coil is specified depending on the operating mode required. Outdoor ventilation air is modeled with the use of an outside air mixer object. Outside air may be provided to the zone only when the coil is operating or can be supplied continuously even when the coil is not operating. A supply air fan is also required and can be modeled as either draw through as shown in the figure below or as blow through where the fan inlet node would be connected to the outside air mixer mixed air node. If an outside air mixer is not used, the fan inlet node would be connected to the zone exhaust node.

![](EngineeringReference/media/image7369.png)

Figure 325. Zone Terminal Unit Schematic

#### Overview

As described previously, the terminal units operate to satisfy a heating or cooling load in a zone based on a zone thermostat temperature set point (Zone Control:Thermostatic). Each simulation time step, EnergyPlus performs a zone air heat balance to determine if cooling or heating is required to meet the zone thermostat set points, excluding any impacts from zone terminal unit operation.

Terminal unit performance is then modeled with all heating/cooling coils off but the supply air fan operates as specified by the user. If the zone air heat balance plus the impact of terminal unit operation with coils off results in no requirement for heating or cooling by the terminal unit coils, or if the terminal unit is scheduled off (via its availability schedule), then the terminal unit coils do not operate and the terminal unit’s part-load ratio output variable is set to 0. If the model determines that cooling or heating is required and the terminal unit is scheduled to operate, the model calculates the part-load ratio of the cooling and heating coils in order to meet the thermostat set point temperature.

The following sections describe the performance calculations for cooling-mode and heating-mode.

#### Model Description

Zone terminal units meet a zone load as determined by a zone thermostat. The DX coils within a zone terminal unit will operate to meet a sensible zone load and all terminal units are controlled to either meet a zone sensible cooling load or a zone sensible heating load. This model does not provide for simultaneous cooling and heating.

Given a zone load, the model calculates the part-load ratio of the terminal unit such that the terminal unit’s “net” sensible capacity is equal to the zone load (if sufficient capacity is available). If it is determined that the part-load ratio of the zone terminal unit will be equal to 1, the DX cooling coil’s capacity is calculated in the same manner as described for single-speed DX cooling coils (ref: Coil:Cooling:DX:SingleSpeed). When it is determined that the part-load ratio of the zone terminal unit will be less than 1, the DX cooling coil’s capacity will be modulated through a reduction in refrigerant flow rate and an iterative solution technique will be used to calculate the performance of the DX cooling coil. For DX heating coils, capacity is calculated in the same manner as described for single-speed DX heating coils (ref: Coil:Heating:DX:SingleSpeed).

The “net” sensible full load cooling capacity is then compared to the zone sensible load. If the “net” sensible full load capacity is less than or equal to the absolute value of the zone sensible load, the DX coil operates at the *maximum* available capacity and, as a result, the zone air heat balance adjusts the zone air temperature. If the “net” sensible full load capacity is greater than the absolute value of the zone sensible load, an iterative solution technique is used to determine the total capacity required to meet the zone sensible load. This iteration loop entails successive modeling of DX coil performance and the loop iterates on the required total capacity until the operating “net” sensible capacity is equal to the zone sensible load.

#### Average Air Flow Calculations

The variable refrigerant flow (VRF) terminal unit operates based on user-specified (or autosized) air flow rates. The VRF terminal unit’s supply air flow rate during cooling operation may be different than the supply air flow rate during heating operation. In addition, the supply air flow rate when no cooling or heating is required but the supply air fan remains ON can be different than the air flow rates when cooling or heating is required. The outside air flow rates can likewise be different in these various operating modes. The model takes these different flow rates into account when modeling the terminal unit, and the average air flow rate for each simulation time step is reported on the inlet/outlet air nodes of the various VRF terminal unit components in proportion to the calculated cycling ratio of the heat pump condenser. If the compressor does not cycle for a specific simulation time step then the heating or cooling air flow rate as specified by the user is assumed for the entire time step.

The average supply air and outdoor air mass flow rates through the terminal unit for the HVAC simulation time step are calculated based on the cycling ratio of the heat pump condenser as follows:

<div>$$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\, = \,\,\mathop m\limits^ \bullet  {\,_{SA,coil\,\,on}}\left( {CyclingRatio} \right) + \mathop m\limits^ \bullet  {\,_{SA,\,\,coil\,\,off}}\left( {1 - CyclingRatio} \right)$$</div>

<div>$$\mathop m\limits^ \bullet  {\,_{OA,\,\,avg\,\,}} = \,\,\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,on}}\left( {CyclingRatio} \right) + \mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,off}}\left( {1 - CyclingRatio} \right)$$</div>

where:

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}$</span>      = average supply air mass flow rate during the time step, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{SA,coil\,\,on}}$</span>   = supply air mass flow rate when the coil is ON, kg/s

*CyclingRatio* = cycling ratio of the heat pump condenser (heating or cooling)

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,coil\,\,off}}$</span>  = supply air mass flow rate when the coil is OFF, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,avg\,\,}}$</span>    = average outside air mass flow rate during the time step, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,on}}$</span>  = average outside air mass flow rate when the coil is ON, kg/s

<span>$\mathop m\limits^ \bullet  {\,_{OA,\,\,coil\,\,off}}$</span>  = average outside air mass flow rate when the coil is OFF, kg/s

The supply air and outside air flow rates when the DX cooling coil or the DX heating coil is ON are specified by the user (i.e., supply air volumetric flow rate during cooling operation, supply air volumetric flow rate during heating operation, outside air volumetric air flow rate during cooling operation, and outside air volumetric air flow rate during heating operation) and are converted from volumetric to mass flow rate. If the user has specified cycling fan/cycling coil operation (i.e. supply air fan operating mode schedule value is equal to 0), then the supply air and outside air mass flow rates when the coil is OFF are zero. If the user has specified constant fan/cycling coil operation (i.e. supply air fan operating mode schedule value is greater than 0), then the user-defined air flow rates when no cooling or heating is needed are used when the coil is OFF.

There is one special case. If the supply air fan operating mode schedule value specifies constant fan operation and the user also specifies that the supply air volumetric flow rate when no cooling or heating is needed is zero (or field is left blank), then the model assumes that the supply air and outside air mass flow rates when the coil is OFF are equal to the corresponding air mass flow rates when the cooling or heating coil was last operating (ON).

#### Calculation of Outlet Air Conditions

When the supply air fan cycles on and off with the terminal unit coils (AUTO fan), the calculated outlet air conditions (temperature, humidity ratio, and enthalpy) from the DX heating coil or the DX cooling coil at full-load (steady-state) operation are reported on the appropriate coil outlet air node. The air mass flow rate reported on the air nodes is the average air mass flow rate proportional to the cycling ratio of the coil (see Average Air Flow Calculations above).

When the supply air fan operates continuously while the terminal unit coils cycle on and off (fan ON), the air mass flow rate reported on the air nodes is the average air mass flow rate proportional to the cycling ratio of the coil (see Average Air Flow Calculations above). Since the air flow rate can be different when the coil is ON compared to when the coil is OFF, then the average outlet air conditions from the DX heating coil or the DX cooling coil are reported on the appropriate coil outlet air node.

#### Calculation of Zone Heating and Cooling Rates

At the end of each HVAC simulation time step, this compound object reports the heating or cooling rate and energy delivered to the zone. In terms of thermal energy delivered to the zone, the sensible, latent and total energy transfer rate to the zone is calculated as follows:

<div>$${\mathop Q\limits^ \bullet_{Total}} = \left( {\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\,} \right)\left( {{h_{out,\,avg}} - {h_{zone\,\,air}}} \right)$$</div>

<div>$${\mathop Q\limits^ \bullet_{Sensible}} = \left( {\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}\,\,} \right){\left( {{h_{out,\,avg}} - {h_{zone\,\,air}}} \right)_{HRmin}}$$</div>

<div>$${\mathop Q\limits^ \bullet_{Latent}} = {\mathop Q\limits^ \bullet_{Total}} - {\mathop Q\limits^ \bullet_{Sensible}}$$</div>

where:

<sub><span>${\dot Q_{Total}}$</span>                 </sub> = total energy transfer rate to the zone, W

<sub><span>${\dot Q_{Sensible}}$</span>            </sub> = sensible energy transfer rate to the zone, W

<sub><span>${\dot Q_{Latent}}$</span>             </sub> = latent energy transfer rate to the zone, W

<span>$\mathop m\limits^ \bullet  {\,_{SA,\,\,avg}}$</span>= average mass flow rate of the supply air stream, kg/s

*h<sub>out,avg</sub>*          = enthalpy of the air being supplied to the zone, J/kg

The terminal unit’s energy transfer rate is used by the program in the zone air heat balance to determine the final zone air conditions. If the terminal unit is capable of meeting the zone thermostat set point temperature, then these report variables are indicative of the zone loads and may be compared directly to the report variables for predicted zone loads (ref: Output:Variable, e.g., Zone Predicted Sensible Load to Setpoint Heat Transfer Rate).

Since each of these energy transfer rates can be calculated as positive or negative values, individual reporting variables are established for cooling and heating and only positive values are reported. The following calculations are representative of what is done for each of the energy transfer rates:

IF (<span>${\dot Q_{Total}}$</span>* &lt; 0.0 )* THEN

      <span>${\dot Q_{TotalCooling}}$</span> =  ABS (<span>${\dot Q_{Total}}$</span>)

      <span>${\dot Q_{TotalHeating}}$</span><sub> </sub> =  *0.0*

ELSE

      <span>${\dot Q_{TotalCooling}}$</span><sub> </sub> =  *0.0*

      <span>${\dot Q_{TotalHeating}}$</span><sub> </sub> =  <span>${\dot Q_{Total}}$</span>

ENDIF

where:

<sub><span>${\dot Q_{TotalCooling}}$</span>    </sub> = output variable ‘Zone VRF Air Terminal Total Cooling Rate, W’

<sub><span>${\dot Q_{TotalHeating}}$</span>    </sub> = output variable ‘Zone VRF Air Terminal Total Heating Rate, W’

In addition to heating and cooling rates, the heating and cooling energy supplied to the zone is also calculated for the time step being reported. The following example for total zone cooling energy is representative of what is done for the sensible and latent energy as well as the heating counterparts.

<div>$${Q_{TotalCooling}} = {\dot Q_{TotalCooling}}*TimeStepSys*3600.$$</div>

where:

<sub><span>${\dot Q_{TotalCooling}}$</span>      </sub> = output variable ‘Zone VRF Air Terminal Total Cooling Energy, J’

*TimeStepSys* = HVAC system simulation time step, hr

### Ventilated Slab

#### Model Overview

The input object ZoneHVAC:VentilatedSlab provides a model for ventilated slab systems that in general use outdoor air to “precool” slabs with colder nighttime air. This method of precooling the thermal mass of a space can be very effective when nighttime temperatures are low and the mass of the system is high enough to provide a significant amount of cooling potential during the day to counteract internal heat gains within a zone. Nearly all ventilated slabs are simple systems such as that shown in the right side of Figure 326. The fan is shown in a blow through position, but the model will allow either a blow or draw through configuration.

![Slide1](EngineeringReference/media/image7396.png)

Figure 326. Basic System for the Ventilated Slab Module

It should be noted that in Figure 326 the use of “unit ventilator” and “low temperature radiant system” do not imply that the user must also specify these elements in the input file. The ventilated slab model combines aspects of these two existing EnergyPlus features into a single model that the user specifies through the input shown in the Input/Output Reference.

The ventilated slab system has been implemented in a fashion that is similar to the “unit ventilator” system in EnergyPlus. The unit ventilator is a system that allows the user to bring in outdoor air (ventilation) that may or may not be tempered with a heating or cooling coil as shown the left side of Figure 326. The air can be delivered to the slab only (Figure 327), to the slab then to the space(Figure 328), and to several slabs in different areas in series (Figure 329). The model essentially combines the functionality of the low temperature radiant system (using air as a transport medium rather than water) and the unit ventilator. In some cases, the system may not meet all the zone heating and cooling load because it is operated not by setpoint of the zone but control temperature range and coil outlet air temperature set by user input.**Note that no coils are shown in Figure 329 for diagram simplicity but the implementation of the system shown in Figure 329 includes coils as in Figure 327 and Figure 328.

![Slide2](EngineeringReference/media/image7397.png)

Figure 327. Model with Air Delivered to Slab. (Slab Only Mode)

![Slide3](EngineeringReference/media/image7398.png)

Figure 328. Zone Supply Model using Ventilated Slab (Slab and Zone mode)

![Slide4](EngineeringReference/media/image7399.png)

Figure 329. Multiple Slabs model with Several Zones (Series Slabs Mode)

#### Connections to the Heat Balances

The ventilated slab systems shown in the above diagrams connect or will connect to the various EnergyPlus heat balance equations in a variety of ways. All of the systems send outside or conditioned air through a slab or building element. This portion of the system acts in a fashion that is identical to the low temperature radiant systems. These surfaces that have the air being blown through them will impact the zone and air heat balances through the normal surface heat balances that interact with this surface. The ventilated slab will participate in the surface heat balances by exchanging radiation with other surfaces in the zone and in the air heat balances via convection to the zone air. So, the ventilated slab is handled identically to the low temperature radiant systems with respect to the zone and air heat balances. This information is valid for all three of the systems shown in the figures above.

Figure 328 shows that the air, instead of being circulated through the slab and then sent back to the ventilation portion of the system, gets circulated through the space after it gets sent through the slab. When this system is selected in EnergyPlus, it will have an additional impact on the zone air heat balance because air will be introduced into the space at conditions different than the zone air. Thus, it will have an energy impact on the air directly through the circulation of air from the slab to the zone and then back to the ventilated slab system. It will still have an impact on the slab surface convection and radiation as with the other systems.

For more information on the impact on the zone and air heat balances by the ventilated slab system, please consult the low temperature radiant system documentation and the EnergyPlus code.

### CoolTower

#### Overview

The Cool Tower (object ZoneCoolTower:Shower) is available for modeling a cooltower (which is sometimes referred to as s wind tower or a shower cooling tower) which is a component that is intended to model a passive downdraught evaporative cooling (PDEC) that is designed to capture the wind at the top of a tower and cool the outdoor air using water evaporation before delivering it to a space. The air flow in these systems is natural as the evaporation process increases the density of the air causing it to fall through the tower and into the space without the aid of a fan. A cooltower typically consists of a water spray or an evaporative pad, a shaft, and a water tank or reservoir. Wind catchers to improve the wind-driven performance at the top of the tower are optional. Water is pumped over an evaporative device by water pump which is the only component consumed power for this system. This water cools and humidifies incoming air and then the cool, dense air naturally falls down through shaft and leaves through large openings at the bottom of cooltowers.

The shower cooling tower shown in figure below is controlled by a schedule and the specification of maximum water flow rate and volume flow rate as well as minimum indoor temperature. The actual flow rate of water and air can be controlled as users specify the fractions of water loss and flow schedule. The required input fields include effective tower height and exit area to obtain the temperature and flow rate of the air exiting the tower. A schedule and rated power for the water pump are also required to determine the power consumed. The component typically has a stand-alone water system that is not added to the water consumption from mains. However, users are required to specify the water source through an optional field, the name of water supply storage tank, in case any water comes from a water main.

![cooltower config](EngineeringReference/media/image7400.svg.png)

Figure 330. Typical Cooltower Configuration

The cooltower model employing a model of the inertial shower cooling tower is intended to establish the actual mass flow rate of the air that leaves the cooltower and the evaporation rate consumed during the processes within the cooltower. Like infiltration, ventilation, and earth tubes, the air is assumed to be immediately mixed with the zone air. The determination of simultaneous heat and mass transfer that occurs during natural evaporative cooling in cooltower is complicated. Therefore, some assumptions have been made to obtain the conditions of the air and water. All cooltowers are executed at the start of each time step called by HVAC manager, and the conditions of air temperature and humidity ratio in the zone will be corrected with any other air that enters the zone.

All temperatures in the following descriptions are in degrees C, mass flow rates are in kg/s, and volume flow rates are in m3/s.

#### Model Description

The user must input the required information according to the Input Output Reference Manual (ref: ZoneCoolTower:Shower). The cooltower model requires a unique identifying name, an availability schedule, and the name of the zone being served. The schedule name must refer to a valid schedule type (range 0-1) and contain values of fractional cooltower operation as well as water pump operation. For the determination of the exit temperature and actual air volume flow rate, four additional inputs are required: effective tower height, exit area, fraction of flow schedule, and fraction of water loss. These define the conditions of the exit air, obtaining the conditions of outdoor air from the weather data and thus allow EnergyPlus to correct both the temperature and humidity level in the zone. The power consumed by the water pump can be directly determined by the schedule and rated power that the user inputs. The component is also controlled by the specification of minimum indoor temperature, maximum volume flow rate, and maximum water flow rate. These allow the model to prevent overcooling the zone or overestimation of the air volume flow rate. In addition, the user must input a flow control type according to the information that the user is able to obtain.

#### Simulation and Control

The cooltower model first determines the temperature and volume flow rate of the exit air.  Both parameters can be directly determined in case of water flow schedule control when the water flow rate is known. With the outdoor temperatures obtained from weather data, the exit air temperature (*T<sub>out</sub>)* can be directly determined as functions of outdoor dry bulb temperature (DB), outdoor wet bulb temperature (WB), effective tower height (*H*) and water flow rate (WF) in l/min by using following equation.

<div>$${T_{out}} = DB - (DB - WB)(1 - \exp ( - 0.8H))(1 - \exp ( - 0.15WF)$$</div>

The volume flow rate of the exit air (Q) can also be directly obtained as functions of water flow rate and effective tower height from the following equation.

<div>$$Q = 0.0125WF \cdot {H^{0.5}}$$</div>

In case of that the calculated air volume flow rate is greater than maximum air volume flow rate in this control, which leads to overestimation of actual volume flow rate of the exit air, the calculated air volume flow rate is replaced with the maximum.

For the simulation of wind-driven flow control where the water flow rate is unknown, the model determines velocity of the outlet air (*V<sub>out</sub>*) as functions of effective tower height and wind speed of outdoor air (WS) as

<div>$${V_{out}} = 0.7{H^{0.5}} + 0.47(WS - 1)$$</div>

The air volume flow rate (*Q*) is then calculated by

<div>$${Q_{estimate}} = A \cdot {V_{out}}$$</div>

where *A* is opening area at the bottom of cooltower.

Substituting the air flow rate to the previous equation for *Q,* water flow rate is obtained as

<div>$$WF = \frac{Q}{{0.0125 \cdot {H^{0.5}}}}$$</div>

Once water flow rate is determined, the model checks the limit of water flow rate that the user inputs, so that the model prevents overestimation of actual volume flow rate of the exit air. If the calculated water flow rate is greater than the maximum water flow rate, the maximum will be chosen. The model also replaces the calculated air volume flow rate with the maximum volume flow rate from the user input when the calculated is greater than the maximum. Then, the model calculates the air volume flow rate and exit temperature using the previous equation for *Q* and *T<sub>out</sub>*.

This cooltower model allows the user to specify water loss due to drift or blow down and the loss of air flow (example: a cooltower which delivers air to both the interior and exterior of the building). If the user inputs the fraction of water loss or flow schedule that means some amount of the air actually goes to outside, the fractional values will be applied to previously calculated ones so that the model calculates both actual water flow rate (*WF<sub>actual</sub>*) and air volume flow rate (*Q<sub>actual</sub>*) as follows:

<div>$$W{F_{actual}} = WF(1.0 + Fraction)$$</div>

<div>$${Q_{actual}} = Q(1.0 - Fraction)$$</div>

The model then determines the exit humidity ratio (<span>${\omega_{out}}$</span>) from the relation of mass balances below.

<div>$${\omega_{in}}({\dot m_{air}} + {\dot m_{water}}) = {\omega_{out}} \cdot {\dot m_{air}}$$</div>

In this case, actual mass flow rate at the inlet and outlet of cooltower cannot be correctly calculated with limited information. Thus, the model estimates initial conditions of the air based on the outdoor temperatures, the calculated exit air temperature, enthalpy of outdoor air (*H<sub>in</sub>*) and outdoor barometric pressure (P). Assuming no enthalpy changes and pressure drops between inlet air and the initialized air, the humidity ratio and mass flow of the initialized air can be obtained by using EnergyPlus psychrometric functions and the following equation.

<div>$${\omega_{in}} = PsyWRnTdbTwbPb({T_{d{b_{in}}}},{T_{w{b_{in}}}},P)$$</div>

<div>$${\omega_{initial}} = PsyWRnTdbH({T_{out}},{H_{in}},P)$$</div>

<div>$${\rho_{initial}}_{_{air}} = PsyRhoAirFnPbTdbW({T_{out}},{\omega_{initial}},P)$$</div>

<div>$${\dot m_{air}} = {\rho_{initia{l_{air}}}} \cdot {Q_{actual}}$$</div>

where <span>${\omega_{initial}}$</span>and <span>${\rho_{initial}}$</span> are the humidity ratio and air density of the initialized air and <span>${\omega_{in}}$</span>is the humidity ratio of outdoor air.

Therefore, the humidity ratio of exit air, <span>${\omega_{out}}$</span>, is

<div>$${\omega_{out}} = \frac{{{\omega_{in}}({{\dot m}_{air}} + {{\dot m}_{water}})}}{{{{\dot m}_{air}}}}$$</div>

Once the humidity ratio at the exit is determined, the model can obtain the actual density (<span>${\rho_{air}}$</span>), specific heat (<span>${c_p}_{,air}$</span>), and mass flow rate (<span>${\dot m_{cooltower}}$</span>) of the air leaving cooltower by using EnergyPlus psychrometric function and following equation.

<div>$${c_p}_{,air} = PsyCpAirFnWtdb({\omega_{out}},{T_{out}})$$</div>

<div>$${\rho_{air}} = PsyRhoAirFnPbTdbW({T_{out}},{\omega_{out}},P)$$</div>

<div>$${\dot m_{cooltower}} = {\rho_{air}} \cdot {Q_{actual}}$$</div>

Assuming that the water temperature equals to outdoor wet bulb temperature, the model eventually determines density of the water and evaporation rate as bellows.

<div>$${\rho_{water}} = RhoH2O({T_{w{b_{in}}}})$$</div>

<div>$${Q_{water}} = \frac{{{{\dot m}_a}({\omega_{out}} - {\omega_{in}})}}{{{\rho_{water}}}}$$</div>

### Earthtube

The earth tube model (input object ZoneEarthtube) provides a simple earth tube model that uses a complex ground heat transfer model to establish the temperature of the soil at the depth of the earth tube.  The following information defines the basis for the model including the assumptions and mathematical equations.  It supplements the information for the ZoneEarthtube input object given in the Input/Output Reference for EnergyPlus.

n Input Requirement

Pipe : Pipe radius(m), Pipe thickness(m), Pipe length(m)

Distance between the pipe outer surface and undisturbed soil (m),

Pipe thermal conductivity (W/m-C),

Air velocity inside pipe(m/s), Depth of the radial center of pipe below ground (m)

Soil : Soil density(kg/m<sup>3</sup>), Soil specific heat(J/kg°C),

Soil thermal Conductivity(W/m°C), Absorption coefficient,

Fraction of evaporation rate

n Assumption(s)

n Convection flow inside the pipe is hydrodynamically and thermally developed.

n Soil temperature in the pipe vicinity is uniform after the particular distance from the center of the pipe(thickness of the annulus), so that pipe surface temperature is uniform after the distance ‘r’ from the center of the pipe, where ‘r’is the pipe radius.

n The temperature profile in the pipe vicinity is not affected by the presence of the pipe, so that pipe surface temperature is uniform at axial direction.

n The soil surrounding the pipe has homogeneous thermal conductivity.

n Pipe has uniform cross section area at axial direction.

Wind velocity (m/s), u, is the annual average value. This is calculated from EnergyPlus weather data by averaging individual wind velocity values of the whole year. The convective heat transfer coefficient at the soil surface (W/m<sup>2</sup>°C), *h<sub>s</sub>*, is function of wind speed u. According to McAdams(1954) *h<sub>s</sub>* can be approximated by the following correlation (Krarti, 1995).

<div>$${h_s} = 5.7 + 3.8u$$</div>

In case of *h<sub>e</sub>* and *h<sub>r</sub>*, they can be determined by the following equations.

<div>$${h_e} = {h_s}\left( {1 + 0.0168af} \right)$$</div>

<div>$${h_r} = {h_s}\left( {1 + 0.0168a{r_a}f} \right)$$</div>

with a = 103 Pa/°C.

Average air temperature (°C), *T<sub>ma</sub>*, is also calculated from EnergyPlus weather data by averaging individual air temperature values of the whole year.

The appropriate value of hemispherical emittance of the ground surface, *ε,* is 0.93~0.96. Radiation constant (W/m<sup>2</sup>), *ΔR,* depends on soil radiative properties, air relative humidity, and effective sky temperature. An appropriate value of *ΔR* according to Krarti (1995) is 63 W/m<sup>2</sup>.

The absorption coefficient, *β*, depends on the soil absorptance and shading condition. The coefficient *β* is approximately equal to one minus the soil surface albedo. Albedo depends on soil cover and moisture content. Albedo=0.1 corresponds to wet soils, albedo=0.2 to moderate soils, and albedo=0.3 to dry soils.

Average solar radiation (W/m<sup>2</sup>), *S<sub>m</sub>*, is determined from EnergyPlus weather data by averaging individual global horizontal solar radiation values of the whole year.

The fraction of evaporation rate, *f*, also depends mainly on the soil cover and the soil moisture level. Based on the results reported by Penman, it is recommended to estimate the fraction f as follows. For bare soil, *f* is directly proportional to soil moisture content. For instance, f=1 corresponds to saturated soils, f=0.6~0.8 to wet soils, f=0.4~0.5 to moist soils, f=0.1~0.2 to arid soils. For dry soils, f = 0, since no evaporation occurs. For covered soils, the fraction f is obtained by multiplying 0.7 by the value of f for bare soil depending on the soil moisture content (Krarti, 1995).

Relative humidity, *r<sub>a</sub>*, is also calculated from EnergyPlus weather data by averaging individual relative humidity values of the whole year.

The soil thermal diffusivity (m<sup>2</sup>/s), *α<sub>s</sub>*, and conductivity (W/m°C), *k<sub>s</sub>*, varies with the density and moisture content. According to the 1991 ASHRAE Handbook of HVAC Applications (Table 4, pp. 11.4), the following values are recommended under different conditions.

<table class="table table-striped">






<tr>
<td>Soil condition</td>
<td>k<sub>s</sub> (W/m°C)</td>
<td>α<sub>s</sub> x 10<sup>-7</sup> (m<sup>2</sup>/s)</td>
</tr>
<tr>
<td>Heavy soil, saturated</td>
<td>2.42</td>
<td>9.04</td>
</tr>
<tr>
<td>Heavy soil, damp solid masonry</td>
<td>1.30</td>
<td>6.45</td>
</tr>
<tr>
<td>Heavy soil, dry</td>
<td>0.865</td>
<td>5.16</td>
</tr>
<tr>
<td>Light soil, damp</td>
<td>-</td>
<td>-</td>
</tr>
<tr>
<td>Light soil, dry</td>
<td>0.346</td>
<td>2.80</td>
</tr>

</table>



Annual angular frequency, *w*, is equal to 1.992 x 10<sup>-7</sup>rad/s, and dampening depth (m), D, is calculated from the following equation:

<div>$$D = \sqrt {\frac{{2{\alpha_s}}}{w}} $$</div>

The value of δ is evaluated as follows.

<div>$$\delta  = \frac{{1 + i}}{D}$$</div>

Amplitude of the air temperature (°C), *T<sub>va</sub>*, can be evaluated from EnergyPlus weather data by dividing the difference between the maximum and minimum air temperature value of the whole year by two. Similarly, amplitude of the solar radiation (W/m<sup>2</sup>), *S<sub>v</sub>*, can also be determined from weather data by dividing the difference between the maximum and minimum solar radiation value of the whole year by two.

Phase angle between the insolation and the air temperature (rad), *φ<sub>I</sub>* , is calculated by subtracting insolation phase angle from air temperature phase angle. Phase angle of insolation and air temperature is the point from the beginning of the year at which the insolation and air temperature respectively reaches the minimum value among the whole year.

Phase constant of the air (sec), *t<sub>0a</sub>*, is the time elapsed from the beginning of the year at which the air temperature reaches the minimum value in the year.

By using all the input parameters and variables described above, average soil surface temperature (°C), *T<sub>m</sub>*, amplitude of the soil surface temperature variation (°C), *A<sub>s</sub>*, phase constant of the soil surface (sec), *t<sub>0</sub>*, and phase angle difference between the air and soil surface temperature (rad), *Φ<sub>s</sub>*, can be evaluated as follows <sup>1)</sup>:

<div>$${T_m} = \frac{1}{{{h_e}}}\left[ {{h_r}{T_{ma}} - \varepsilon \Delta R + \beta {S_m} - 0.0168{h_s}fb\left( {1 - {r_a}} \right)} \right]$$</div>

<div>$${A_s} = \left\| {\frac{{{h_r}{T_{va}} - \beta {S_v}{e^{i{\phi_I}}}}}{{\left( {{h_e} + \delta {k_s}} \right)}}} \right\|$$</div>

<div>$${t_0} = {t_{0a}} + \frac{{{\phi_s}}}{w}$$</div>

<div>$${\phi_s} =  - Arg\left[ {\frac{{{h_r}{T_{va}} - \beta {S_v}{e^{i{\phi_I}}}}}{{\left( {{h_e} + \delta {k_s}} \right)}}} \right]$$</div>

(Note: T<sub>m</sub>, A<sub>s</sub>, and t<sub>0</sub> are calculated by the CalcSoilSurfTemp program and are inputs to EnergyPlus.  The remainder of this section describes what has been implemented in EnergyPlus.)

The symbols ||  || and Arg denote the modulus and the argument of a complex number respectively. In order to calculate *A<sub>s</sub>* and *Φ<sub>s</sub>*, the complex number under consideration can be rearranged as the following form:

<div>$$\begin{array}{l}\frac{{{h_r}{T_{va}} - \beta {S_v}{e^{i{\phi_I}}}}}{{\left( {{h_e} + \delta {k_s}} \right)}} = \\ frac{{\left( {{h_e} + \frac{{{k_s}}}{D}} \right)\left( {{h_r}{T_{va}} - \beta {S_v}\cos {\phi_I}} \right) + \frac{{{k_s}}}{D}\left( { - \beta {S_v}\sin {\phi_I}} \right)}}{{{{\left( {{h_e} + \frac{{{k_s}}}{D}} \right)}^2} + {{\left( {\frac{{{k_s}}}{D}} \right)}^2}}} + \\i\frac{{\left( {{h_e} + \frac{{{k_s}}}{D}} \right)\left( { - \beta {S_v}\sin {\phi_I}} \right) - \frac{{{k_s}}}{D}\left( {{h_r}{T_{va}} - \beta {S_v}\cos {\phi_I}} \right)}}{{{{\left( {{h_e} + \frac{{{k_s}}}{D}} \right)}^2} + {{\left( {\frac{{{k_s}}}{D}} \right)}^2}}}\end{array}$$</div>

Assuming a homogeneous soil of constant thermal diffusivity, the temperature at any depth z and time t can be estimated by the following expression <sup>2)</sup>.

<div>$${T_{z,t}} = {T_m} - {A_s}\exp \left[ { - z{{\left( {\frac{\pi }{{{\rm{365}}{\alpha_s}}}} \right)}^{1/2}}} \right]\cos \left\{ {\frac{{2\pi }}{{{\rm{365}}}}\left[ {t - {t_0} - \frac{z}{2}{{\left( {\frac{{{\rm{365}}}}{{\pi {\alpha_s}}}} \right)}^{1/2}}} \right]} \right\}$$</div>

In this expression, the unit of time, *t*, and phase constant of the soil surface, *t<sub>0</sub>*, should be converted into days. Similarly, the unit of soil thermal diffusivity, *α<sub>s</sub>*, should also be converted into m<sup>2</sup>/days.

By integrating the expression with respect to depth, the average temperature of a vertical soil profile ranging between depth z<sub>1</sub> and z<sub>2</sub> (°C ) can be determined as follows <sup>2)</sup>.

<div>$${T_{{z_1},{z_2},t}} = {T_m} + \frac{{{A_s}}}{{\left( {{z_2} - {z_1}} \right)\gamma \sqrt 2 }}\left\{ {{e^{ - \gamma {z_1}}}\cos \left[ {\frac{{2\pi }}{{{\rm{365}}}}\left( {t - {t_0} - {z_1}L - 45.6} \right)} \right] - {e^{ - \gamma {z_2}}}\cos \left[ {\frac{{2\pi }}{{{\rm{365}}}}\left( {t - {t_0} - {z_2}L - 45.6} \right)} \right]} \right\}$$</div>



where,

<div>$$\gamma  = {\left( {\pi /{\rm{365}}{\alpha_s}} \right)^{1/2}}$$</div>

<div>$$L = \frac{1}{2}{\left( {{\rm{365}}/\pi {\alpha_s}} \right)^{1/2}}$$</div>

As the final step with regard to the heat transfer between soil and earth tube system, thermal conductivity of air (W/m°C), *k<sub>air</sub>*, and kinetic viscosity of air (m<sup>2</sup>/s), υ, should calculated first <sup>3)</sup>.

<div>$${k_{air}} = 0.02442 + ({10^{ - 4}}(0.6992{T_a}))$$</div>

<div>$$\upsilon  = {10^{ - 4}}(0.1335 + 0.000925{T_a})$$</div>

By using the values of thermal conductivity of air, *k<sub>air</sub>*, and kinetic viscosity of air, υ, the convective heat transfer coefficient at the inner pipe surface (W/m<sup>2</sup>°C), *h<sub>c,</sub>* can be evaluated. It is a function of Reynolds number, Re, and Nusselt number, Nu <sup>4)</sup>, where

<div>$${h_c} = \frac{{Nu{k_{air}}}}{{2{r_1}}}$$</div>

<div>$$Nu = \frac{{({f_a}/2)({\mathop{\rm Re}\nolimits}  - 1000)\Pr }}{{1 + 12.7{{({f_a}/2)}^{1/2}}({{\Pr }^{2/3}} - 1)}}$$</div>

<div>$${f_a} = {(1.58\ln {\mathop{\rm Re}\nolimits}  - 3.28)^{ - 2}}$$</div>

<div>$${\mathop{\rm Re}\nolimits}  = \frac{{2{r_1}{V_a}}}{\nu }$$</div>

<div>$$\Pr  = \frac{\nu }{{{\alpha_{air}}}}$$</div>

where *r<sub>1</sub>* is inner pipe radius (m), and *V<sub>a</sub>* is average pipe air velocity (m/s).

After determining the convective heat transfer coefficient, *R<sub>c</sub>*, *R<sub>p</sub>* and *R<sub>s</sub>* are respectively calculated as follows.

<div>$${R_c} = \frac{1}{{2\pi {r_1}{h_c}}}$$</div>

<div>$${R_p} = \frac{1}{{2\pi {k_p}}}\ln \frac{{{r_1} + {r_2}}}{{{r_1}}}$$</div>

<div>$${R_s} = \frac{1}{{2\pi {k_s}}}\ln \frac{{{r_1} + {r_2} + {r_3}}}{{{r_1} + {r_2}}}$$</div>

where *R<sub>c</sub>* is thermal resistance due to convection heat transfer between the air in the pipe and the pipe inner surface (m-C/W), *R<sub>p</sub>* is thermal resistance due to conduction heat transfer between the pipe inner and outer surface (m-C/W), and *R<sub>s</sub>* is thermal resistance due to conduction heat transfer between the pipe outer surface and undisturbed soil (m-C/W). In addition *r<sub>2</sub>* is pipe thickness (m), *r<sub>3</sub>* is distance between the pipe outer surface and undisturbed soil (m), and *L* is pipe length (m).

Finally, the heat transfer between the soil and the air inside the pipe is equal to the amount of heat losses as air flows along the pipe (Jacovides and Mihalakakou, 1995).

<div>$${U_t}\,\,\left[ {{T_a}(y) - {T_{z,t}}} \right]dy =  - {\dot m_a}{C_a}\left[ {d{T_a}(y)} \right]$$</div>

with

<div>$${U_t} = \frac{1}{{{R_t}}}$$</div>

<div>$${R_t} = {R_c} + {R_p} + {R_s}$$</div>

where *U<sub>t</sub>* is overall heat transfer coefficient of the whole earth tube system (W/C-m), *T<sub>a</sub>(y)* is air temperature of the pipe at the distance y from the pipe inlet (°C), and *m<sub>a</sub>* is mass flow rate of ambient air through pipe (kg/s). *C<sub>a</sub>* is specific heat of air (J/kg°C) and *R<sub>t</sub>* is total thermal resistance between pipe air and soil (m-C/W).

Initial condition of inlet air temperature is equal to the ambient air temperature. Outlet air temperature is finally evaluated by solving the heat transfer equation above.

Table 87.  Nomenclature for Earthtube Model

<table class="table table-striped">






<tr>
<td>Variable</td>
<td>Description</td>
<td>Units</td>
</tr>
<tr>
<td>A<sub>s</sub></td>
<td>amplitude of the soil surface temperature variation</td>
<td>(°C)</td>
</tr>
<tr>
<td>C<sub>a</sub></td>
<td>specific heat of air</td>
<td>(J/kg°C)</td>
</tr>
<tr>
<td>h<sub>c</sub></td>
<td>convective heat transfer coefficient at the inner pipe surface</td>
<td>(W/m<sup>2</sup>°C)</td>
</tr>
<tr>
<td>h<sub>s</sub></td>
<td>convective heat transfer coefficient at the soil surface</td>
<td>(W/m<sup>2</sup>°C)</td>
</tr>
<tr>
<td>k<sub>air</sub></td>
<td>thermal conductivity of the air</td>
<td>(W/m°C)</td>
</tr>
<tr>
<td>k<sub>p</sub></td>
<td>pipe thermal conductivity</td>
<td>(W/m°C)</td>
</tr>
<tr>
<td>k<sub>s</sub></td>
<td>soil thermal conductivity</td>
<td>(W/m°C)</td>
</tr>
<tr>
<td>L</td>
<td>pipe length</td>
<td>(m)</td>
</tr>
<tr>
<td>m<sub>a</sub></td>
<td>mass flow rate of ambient air through pipe</td>
<td>(kg/s)</td>
</tr>
<tr>
<td>r<sub>a</sub></td>
<td>relative humidity</td>
<td> </td>
</tr>
<tr>
<td>R<sub>c</sub></td>
<td>thermal resistance due to convection heat transfer between the air in the pipe and the pipe inner surface</td>
<td>(m-C/W)</td>
</tr>
<tr>
<td>R<sub>p</sub></td>
<td>thermal resistance due to conduction heat transfer between the pipe inner and outer surface</td>
<td>(m-C/W)</td>
</tr>
<tr>
<td>R<sub>s</sub></td>
<td>thermal resistance due to conduction heat transfer between the pipe outer surface and undisturbed soil</td>
<td>(m-C/W)</td>
</tr>
<tr>
<td>R<sub>t</sub></td>
<td>total thermal resistance between pipe air and soil</td>
<td>(m-C/W)</td>
</tr>
<tr>
<td>ΔR</td>
<td>radiation constant</td>
<td>(63W/m<sup>2</sup>)</td>
</tr>
<tr>
<td>r<sub>1</sub></td>
<td>inner pipe radius</td>
<td>(m)</td>
</tr>
<tr>
<td>r<sub>2</sub></td>
<td>pipe thickness</td>
<td>(m)</td>
</tr>
<tr>
<td>r<sub>3</sub></td>
<td>distance between the pipe outer surface and undisturbed soil</td>
<td>(m)</td>
</tr>
<tr>
<td>S<sub>m</sub></td>
<td>average solar radiation</td>
<td>(W/m<sup>2</sup>)</td>
</tr>
<tr>
<td>S<sub>v</sub></td>
<td>amplitude of the solar radiation</td>
<td>(W/m<sup>2</sup>)</td>
</tr>
<tr>
<td>t</td>
<td>time elapsed from beginning of calendar year</td>
<td>(days)</td>
</tr>
<tr>
<td>T<sub>a</sub>(y)</td>
<td>air temperature of the pipe at the distance y from the pipe inlet</td>
<td>(°C)</td>
</tr>
<tr>
<td>T<sub>m</sub></td>
<td>average soil surface temperature</td>
<td>(°C)</td>
</tr>
<tr>
<td>T<sub>ma</sub></td>
<td>average air temperature</td>
<td>(°C)</td>
</tr>
<tr>
<td>t<sub>0</sub></td>
<td>phase constant of the soil surface</td>
<td>(sec; days)</td>
</tr>
<tr>
<td>t<sub>0a</sub></td>
<td>phase constant of the air</td>
<td>(sec; days)</td>
</tr>
<tr>
<td>T<sub>va</sub></td>
<td>amplitude of the air temperature</td>
<td>(°C)</td>
</tr>
<tr>
<td>T<sub>z,t</sub></td>
<td>ground temperature at time t and depth z</td>
<td>(°C)</td>
</tr>
<tr>
<td>T<sub>z1,z2,t</sub></td>
<td>soil profile temperature at time t, averaged over depths between z<sub>1</sub> and z<sub>2</sub></td>
<td>(°C)</td>
</tr>
<tr>
<td>u</td>
<td> wind velocity above the ground surface</td>
<td>(m/s)</td>
</tr>
<tr>
<td>U<sub>t</sub></td>
<td>overall heat transfer coefficient of the whole earth tube system</td>
<td>(W/m-C)</td>
</tr>
<tr>
<td>V<sub>a</sub></td>
<td>average pipe air velocity</td>
<td>(m/s)</td>
</tr>
<tr>
<td>z</td>
<td>depth of the radial center of pipe below soil surface</td>
<td>(m)</td>
</tr>
<tr>
<td>z<sub>1</sub></td>
<td>upper bounds of some vertical profile in soil</td>
<td>(m)</td>
</tr>
<tr>
<td>z<sub>2</sub></td>
<td>lower bounds of some vertical profile in soil</td>
<td>(m)</td>
</tr>
<tr>
<td>α<sub>s</sub></td>
<td>soil thermal diffusivity</td>
<td>(m<sup>2</sup>/s; m<sup>2</sup>/days)</td>
</tr>
<tr>
<td>β</td>
<td>soil absorption coefficient (= 1 – soil albedo)</td>
<td> </td>
</tr>
<tr>
<td>ε</td>
<td>hemispherical emittance of the ground surface</td>
<td> </td>
</tr>
<tr>
<td>φ<sub>I</sub></td>
<td>phase angle between the insolation and the air temperature</td>
<td>(rad)</td>
</tr>
<tr>
<td>Φ<sub>s</sub></td>
<td>phase angle difference between the air and soil surface temperature</td>
<td>(rad)</td>
</tr>
<tr>
<td>υ</td>
<td>kinetic viscosity of air</td>
<td>(m<sup>2</sup>/s)</td>
</tr>
<tr>
<td>w</td>
<td>annual angular frequency (=1.992 x 10<sup>-7</sup>rad/s)</td>
<td> </td>
</tr>

</table>

#### References

Krarti M., Lopez-Alonzo C., Claridge D. E. and Kreider J. F. 1995. Analytical model to predict annual soil surface temperature variation. Journal of Solar Energy Engineering 117, 91~99

Labs K. In: Cook J., editor. 1989. Passive cooling. Cambridge Massachusetts, London, England: MIT Press

Al-Ajmi F., Loveday D. L. and Hanby V. I. 2005. The Cooling Potential of Earth-air Heat Exchangers for Domestic Buildings in a Desert Climate, Building and Environment

Necati Ozisik M. 1885. Heat transfer: A basic approach, McGraw-Hill Book Company

Jacovides C. P. and Mihalakakou G. 1995. An Underground Pipe Systems as an Energy Source for Cooling/Heating Purposes. Renewable Energy 6, pp.893~900

### Thermal Chimney Model

The ZoneThermalChimney input object is available for modeling a thermal chimney which is a device that uses stack driven air movement to ventilate spaces within a building. These systems have been used successfully in buildings as small as the size of an outhouse up to large commercial buildings. The air within a thermal chimney is heated naturally using solar energy. The air increases in temperature which causes its density to drop. This drop in density results in a natural vertical movement of air and a local drop in pressure. The drop in pressure is relieved by drawing air from the building interior, and the heat gained within the thermal chimney does not enter the occupied portion of the building. These systems are often used in support of natural ventilation systems. The EnergyPlus model will seek to model the air heat balance effects of the thermal chimney, balance air movements caused by the thermal chimney, and report other appropriate system variables. The new model will be linked into the air heat balance in a fashion similar to the current infiltration and simple ventilation models but will not be linked to an HVAC air loop.  Any flow through the thermal chimney will be accounted for in the air mass balance in the HVAC calculations. However, other sophisticated ventilation strategies can be handled by other existing EnergyPlus components.

n Thermal Chimney Input Requirements

n Distance from the top of thermal chimney to each inlet (m),

n Relative ratio of air flow rates passing through each inlet,

n Width of the absorber wall (m),

n Discharge coefficient,

n Cross sectional area of air channel outlet (m<sup>2</sup>),

n Cross sectional areas of each air channel inlet (m<sup>2</sup>)

n  Assumptions

n Surface temperature of the glass cover is uniformly distributed.

n Surface temperature of the absorber wall is uniformly distributed.

n The inlet temperature of the air channel in the thermal chimney is equal to the room air temperature.

n Resistance to the air flow due to the surface friction is negligible.

n The discharged amount of interior air induced by the thermal chimney is replaced by the outdoor air infiltration.

![Thermal Chimney](EngineeringReference/media/image7454.png)

Figure 331. Basic Composition of Thermal Chimney

Mathematical model currently available for thermal chimneys has the capability to handle the thermal chimney having only one inlet. In other words, it is unlikely that thermal chimneys with multiple inlets due to multiple stories utilizing the common thermal chimney can be mathematically modeled without computational fluid dynamics. Therefore, if the thermal chimney to be modeled has multiple inlets, it will be assumed that it will have only one inlet. For this assumption, the user will be required to specify the relative ratio of air flow rates passing through each inlet to compute the overall length of the thermal chimney (m), *L*, overall room air temperature (K), *T<sub>r</sub>*, and overall cross sectional area of air channel inlet (m<sup>2</sup>), *A<sub>i</sub>*, as follows:

<div>$$L = \frac{{{L_1}{r_1}{E_1} + {L_2}{r_2}{E_2} + {L_3}{r_3}{E_3} +  \cdot  \cdot  \cdot  + {L_n}{r_n}{E_n}}}{{{r_1}{E_1} + {r_2}{E_2} + {r_3}{E_3} +  \cdot  \cdot  \cdot  + {r_n}{E_n}}}$$</div>

<div>$${T_r} = {T_{r1}}{r_1} + {T_{r2}}{r_2} + {T_{r3}}{r_3} +  \cdot  \cdot  \cdot  + {T_{rn}}{r_n}$$</div>

<div>$${A_i} = {A_{i1}} + {A_{i2}} + {A_{i3}} +  \cdot  \cdot  \cdot  + {A_{in}}$$</div>

Where, *A<sub>in</sub>* is the cross sectional area of nth air channel inlet (m<sup>2</sup>), *L<sub>n</sub>* is the distance from the top of thermal chimney to nth inlet (m), *E<sub>n</sub>* is the room air specific enthalpy corresponding to nth inlet (J/kg), *r<sub>n</sub>* is the relative ratio of air flow rate passing through nth inlet and *T<sub>rn</sub>* is the room air temperature corresponding to nth inlet (K). Among them, room air specific enthalpy, *E<sub>n</sub>*, and room air temperature corresponding to each inlet, *T<sub>rn</sub>*, are directly calculated inside EnergyPlus. In addition, the relative ratios should meet the following expression:

<div>$${r_1} + {r_2} + {r_3} +  \cdot  \cdot  \cdot  + {r_n} = 1$$</div>

After merging the multiple inlets into a single inlet condition based on the description above, the following algorithm which is widely used is employed for the modeling of the thermal chimney.

The key output parameter in the thermal chimney model is the enhanced amount of natural ventilation rate caused by the presence of a thermal chimney. In order to determine the enhanced ventilation, the discharge air temperature from a thermal chimney should be calculated, which, in turn, should be computed based on the information on the absorber wall temperature, glass cover temperature and the vertical air temperature distribution within the thermal chimney. Among them, energy balances for the absorber wall and the glass cover are carried out using the existing algorithm currently available in EnergyPlus, which has the similar approach to the Trombe wall. On the other hand, the vertical air temperature distribution and the resultant discharge air temperature of the thermal chimney are computed using the separate thermal chimney algorithm described in the following paragraphs.

Once the glass cover temperature and the absorber wall temperature are computed using the existing modeling algorithm in EnergyPlus, the energy balance for the fluid (air inside the thermal chimney) can be expressed as:

<div>$${h_{wf}}({T_w} - \overline {{T_f}} ) = {h_{gf}}(\overline {{T_f}}  - {T_g}) + \frac{{\dot m{C_p}}}{w}\frac{{d{T_f}}}{{dx}}$$</div>

Where, *m* is the total mass flow rate of the air (kg/s), *C<sub>p</sub>* is the specific heat of air (J/kg°C), *w* is the width of the absorber wall (m) and *x* is the elemental length of the absorber wall (m).

Since the initial condition of inlet air temperature in this differential equation is equal to the room air temperature (i.e. *x = 0, T<sub>f,i</sub> = T<sub>r</sub>*), the outlet air temperature, *T<sub>fo</sub>*, can be finally evaluated.

Finally, the total air flow rate caused by the thermal chimney (m<sup>3</sup>/s), *Q*, can be evaluated from the following expression [1]:

<div>$$Q = {C_d}{A_o}\sqrt {\frac{{2(\frac{{{T_{fo}} - {T_r}}}{{{T_r}}})gL}}{{{{(1 + {A_r})}^2}}}} $$</div>

<div>$${A_r} = {A_o}/{A_i}$$</div>

Where, *C<sub>d</sub>* is the discharge coefficient, *A<sub>o</sub>* and *A<sub>i</sub>* is the cross sectional areas of air channel outlet and inlet (m<sup>2</sup>), respectively, *T<sub>fo</sub>* is the outlet air temperature (K), *T<sub>r</sub>* is the room air temperature (K) and *L* is the total length of the thermal chimney (m).

Since multiple inlets are merged into a single inlet in the beginning, the air flow rate passing through each inlet due to the existence of the thermal chimney can be finally determined as follows:

<span>${Q_1} = Q{r_1}$</span>,    <span>${Q_2} = Q{r_2}$</span>,    <span>${Q_3} = Q{r_3}$</span>,    ∙∙∙,    <span>${Q_n} = Q{r_n}$</span>

Where, *Q<sub>n</sub>* is the air flow rate passing through nth inlet (m<sup>3</sup>/s) and *r<sub>n</sub>* is the relative ratio of air flow rate passing through nth inlet.

The discharged amount of interior air from each zone caused by the presence of the thermal chimney is assumed to be replaced by the outdoor air infiltration.



Table 88. Nomenclature of Thermal Chimney Model

**Model Nomenclature**

Variable

Description

*A<sub>i</sub>*

cross sectional area of air channel inlet (m<sup>2</sup>)

*A<sub>o</sub>*

cross sectional area of air channel outlet (m<sup>2</sup>)

*C<sub>d</sub>*

discharge coefficient

*C<sub>p</sub>*

specific heat of air (J/kg°C)

*E<sub>n</sub>*

room air specific enthalpy corresponding to nth inlet (J/kg)

*g*

acceleration due to gravity (9.8 m/s<sup>2</sup>)

*h<sub>gam</sub>*

convective heat transfer coefficients between the glass and ambient air (W/m<sup>2</sup>°C )

*h<sub>gf</sub>*

convective heat transfer coefficients between the glass and the fluid (W/m<sup>2</sup>°C )

*h<sub>iw</sub>*

convective heat transfer coefficients between absorber wall inner surface and the room air (W/m<sup>2</sup>°C )

*h<sub>wf</sub>*

convective heat transfer coefficients between absorber wall and the fluid (W/m<sup>2</sup>°C)

*h<sub>wind</sub>*

The convective heat transfer coefficient due to the wind (W/m<sup>2</sup>°C )

*H<sub>sr</sub>*

incident solar radiation on vertical surface (W/m<sup>2</sup>)

*k<sub>air</sub>*

thermal conductivity of air (W/m°C)

*L*

total length of the thermal chimney (m)

*M*

mass flow rate of the air (kg/s)

*r<sub>n</sub>*

relative ratio of air flow rate passing through nth inlet

*S<sub>g</sub>*

solar radiation absorbed by the glass cover (W/m<sup>2</sup>)

*S<sub>w</sub>*

solar radiation absorbed by the absorber wall (W/m<sup>2</sup>)

*T<sub>am</sub>*

ambient air temperature (K)

*T<sub>f</sub>*

fluid temperature averaged over the entire length of the thermal chimney (K)

*T<sub>fi</sub>*

inlet air temperature of the thermal chimney (K)

*T<sub>fo</sub>*

outlet air temperature of the thermal chimney (K)

*T<sub>g</sub>*

glass cover temperature (K)

*T<sub>r</sub>*

room air temperature (K)

*T<sub>s</sub>*

surface temperature (K)

*T<sub>w</sub>*

absorber wall temperature (K)

*T<sub>∞</sub>*

fluid temperature (K)

*u*

wind speed (m/s)

*U<sub>w</sub>*

Overall heat transfer coefficient from the room air and the absorber wall (W/m<sup>2</sup>°C)

*w*

width of the absorber wall (m)

*x*

elemental length of the absorber wall (m)

*α<sub>g</sub>*

absorptance of glass cover

*α<sub>w</sub>*

absorptance of absorber wall

*β*

air volumetric coefficient of expansion (K<sup>-1</sup>)

*ε<sub>g</sub>*

emissivity of the glass cover

*σ*

Stefan-Boltzmann constant (5.67x10<sup>-8</sup> W/m<sup>2</sup>K<sup>4</sup>)

*τ*

transmittance of the glass cover

*v*

kinematic viscosity of air (m<sup>2</sup>/s)



#### References

N. K. Bansal, R. Mathur and M. S. Bhandari, Solar Chimney for enhanced Stack Ventilation, Building and Environment, 28, pp.373-377, 1993

K. S. Ong, A Mathematical Model of a Solar Chimney, Renewable Energy, 28, pp.1047-1060, 2003

N. K. Bansal, R. Mathur and M. S. Bhandari, A Study of Solar Chimney Assisted Wind Tower System for Natural Ventilation in Buildings, Building and Environment, 29, pp.495-500, 1994

J. Marti-Herrero and M. R. Heras-Celemin, Dynamic Physical Model for a Solar Chimney, Solar Energy, 81, pp. 614-622, 2007

M. M. Aboulnaga and S. N. Abdrabboh, Improving Night Ventilation into Low-rise Buildings in Hot-arid Climates Exploring a Combined Wall-roof Solar Chimney, Renewable Energy, 19, pp. 47-54, 2000



### Zone Outdoor Air Unit

The zone outdoor air unit (object ZoneHVAC:OutdoorAirUnit) is intended to model systems such as zone make-up air units and dedicated outside air systems.  These components are “zone equipment” meaning that they do not require an air loop but serve a zone directly.  The system is comprised of a supply fan (in either draw through or blow through configuration), an optional exhaust fan, and a variety of components such as heating coils, cooling coils, heat recovery, etc.  The object of the zone outdoor air unit is to bring in additional ventilation air into a zone.  These might be used for high ventilation spaces such as kitchens or laboratories where another system is primarily responsible for space conditioning while the zone outside air unit is primarily responsible for fresh air delivery to the zone.  Most of the information necessary to configure a zone outdoor air unit is contained in the EnergyPlus Input/Output Reference.  A diagram of the zone outdoor air unit is shown below.  As this system is relatively simple and does not contain any unique operating algorithm or equations, the discussion here is limited to the application of the user defined controls and how it relates to the operation of the device.

![](EngineeringReference/media/image7466.png)

Figure 332. Zone Outdoor Air Unit Schematic

### Controls

Three input parameters control the operation of the zone outdoor air unit.  The unit control type has two options: neutral or temperature.  If the temperature control type is selected, the user must also provide a high and low air temperature control schedule.  The algorithm for controlling the zone outdoor air unit is dependent on these parameters which are used as described below.

***Neutral Control.***  If the user selects neutral control, the intent is to provide additional outside air to the zone without imposing any additional thermal load on the zone or any other systems serving the zone.  In other words, the unit will attempt to provide air to the zone at the zone mean air temperature.  Mathematically, this means:

<div>$${T_{out}} = {T_{MAT}}$$</div>

where:

      T<sub>out</sub> = the outlet temperature of the zone outdoor air unit

      T<sub>MAT</sub> = the mean air temperature of the zone being served by the unit

It should be noted that to avoid excessive iteration that the zone mean air temperature that is used is the mean air temperature from the previous time step.  This will result in a slight lagging that may introduce a slight thermal load, but this should be minimal.

***Temperature Control***.  If the user selects temperature control, the intent is to limit the outlet temperature of the unit for either heating or cooling or both or perhaps to provide unconditioned air to the space.  The algorithm used to determine the outlet temperature of the unit is as follows.  When the outdoor air temperature is at or below the low air temperature control schedule value, the outlet temperature is set to the low air temperature control schedule value and any heating equipment included in the unit description and available will attempt to provide enough heating to produce an outlet temperature equal to the low temperature schedule value.  When the outdoor air temperature is at or above the high air temperature control schedule value, the outlet temperature of the unit is set to the high air temperature control schedule value and any cooling equipment included in the unit description and available will attempt to provide enough cooling to produce an outlet air temperature equal to the high temperature schedule value.  When the outdoor air temperature is between the high and low temperature values, the unit will not provide any conditioning of outdoor air and will simply deliver it to the zone.  Mathematically, this can be summarized as:

<div>$${T_{out}} = \left\{ {\begin{array}{*{20}{c}}{{T_{high}}\;if\;{T_{oa}} \ge {T_{high}}}\\ {{T_{oa}}\;if\;{T_{low}} < {T_{oa}} < {T_{high}}}\\ {{T_{low}}\;if\;{T_{oa}} \le {T_{low}}}\end{array}} \right.$$</div>

where:

      T<sub>out</sub> = the outlet temperature of the zone outdoor air unit

      T<sub>oa</sub> = the outside air temperature

      T<sub>high</sub> = the high control air temperature schedule value

      T<sub>low</sub> = the low control air temperature schedule value

If the user wishes to provide “unconditioned” air all of the time, the high and low control temperature values can be set very high and very low, respectively, to always force the unit to provide unconditioned air.  The same effect can also be realized by not specifying any conditioning components (such as coils) in the unit.  The user can also limit the device to cooling only by specifying a low control temperature schedule with extremely low values.  Conversely, the user can limit the device to heating only by specifying a high control temperature schedule with extremely high values.  The user can also limit the equipment specified as part of the device to either cooling or heating components to get similar effects.  In essence, the temperature control provides a variety of options in a single control type through the use of the high and low control temperature schedules.

### Zone Exhaust Fan

The zone exhaust fan (Fan:ZoneExhaust) is a simple model to account for the fan electric energy use and impact on central air handlers from bathroom and hood exhaust.  Because the fan only extracts air from the zone, it doesn’t directly impact the zone itself.

The fan flow rate is either constant or variable depending on if the user input a flow fraction modifier schedule.   The value entered for maximum volume flow rate is converted to a design mass flow rate using standard (altitude-adjusted) density and used as the design flow rate.  If a flow fraction schedule is used, then its values, <span>${f_{Fract}}$</span>, are multiplied by the design flow rate to obtain the current mass flow.

<div>$${\dot m_{Des}} = {\dot V_{Max}}{\rho_{air,std}}$$</div>

<div>$$\dot m = {f_{Fract}}{\dot m_{Des}}$$</div>

The exhaust fan model is similar to, but simpler than, the models used for air system fans.  The electric power calculation is simplified and uses a constant overall efficiency.  All of the fan power is added to the air stream.

<div>$${\dot Q_{fan}} = \frac{{\dot m{\rm{}}\Delta P}}{{{e_{tot}}{\rho_{air}}}}$$</div>

<div>$${h_{out}} = {h_{in}} + \frac{{{{\dot Q}_{fan}}}}{{\dot m}}$$</div>

<div>$${w_{out}} = {w_{in}}$$</div>

<div>$${T_{out}} = PsyTdbFnHW\left( {{h_{out}},{w_{out}}} \right)$$</div>

The controls for determining if the the exhaust fan will operate can be based on a number of factors including: an on/off availability schedule, interaction with system availability managers, minimum zone air temperature control limits and a variable flow fraction schedule.  When the fan is coupled to the system availability managers then it will operate if either the local availability schedule or the system availability manager’s indicate that the fan should run.  When the fan is not coupled to the system availability manager, then it only uses the local availability schedule and ignores availability managers.  If using the flow fraction schedule and the resulting flow is zero, then fan will not run.  If using the minimum zone temperature limit schedule then the fan will only run if the fan inlet temperature is warmer than the limit.

The exhaust fan’s interaction with the air system depends on the value, <span>${f_{Bal}}$</span>, of the schedule for the fraction of the exhaust that is balanced.  The model tracks the exhaust flows in two ways, balanced and unbalanced. Balanced exhaust air flow is considered to have been made up from simple airflow from infiltration, ventilation or zone mixing.  Unbalanced exhaust air flow is considered to not be balanced by simple air flows and needs to be balanced by the air system operation.  Both of these types of flow are summed at the zone and whole air system level.   In a zone, the return air node flow rate is reduced from what it would be with no exhaust by the portion of the zone’s exhaust flow that is unbalanced.  In an air handler with an outdoor air system, the outdoor air flow rate may be increased so as to be sufficient to provide all the unbalanced exhaust air for all the zones on the air handler (when possible).

